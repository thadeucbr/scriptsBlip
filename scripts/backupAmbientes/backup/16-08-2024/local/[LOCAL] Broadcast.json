{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"8c0bd4bf-6b0b-4085-a335-8af27420c779","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"1f27e71b-3784-4a22-bac7-a65dae1ea5d1","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"d049a751-3b37-4bd1-a419-23c57abffc90","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"a0a30b4b-4eef-4689-bfc7-f362b6c53975","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8f7684ef-4d50-4a9a-8427-deb90a353964","$typeOfContent":"","type":"MergeContact","$title":"Set \"broadcastOrigem\"","$invalid":false,"settings":{"extras":{"broadcastOrigem":"{{contact.extras.campaignMessageTemplate}}"}},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.campaignMessageTemplate"},{"values":["-"],"source":"context","comparison":"notEquals","variable":"contact.extras.campaignMessageTemplate"}]},{"$id":"89e0776a-0832-45ce-900f-72ffdff82b8f","$typeOfContent":"","type":"MergeContact","$title":"Set \"campaignMessageTemplate\" to \"-\"","$invalid":false,"settings":{"extras":{"campaignMessageTemplate":"-"}},"conditions":[]},{"$id":"72fed6c1-fd0f-4069-98fb-0687dfd8b8e0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"fdba4a00-aa02-45c1-830e-7c1b79ef393e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"origemCampanhaPadrao\"","$invalid":false,"settings":{"function":"run","source":"function run(calendarDatetime, inputMessage, inputContent, broadcast, identity) {\n    const date = new Date(calendarDatetime);\n    \n    const dataFormatada = dataAtualFormatada(date);\n    let metadataCampanha = metadata(inputMessage);\n    const origem = origemCampanha(inputContent, metadataCampanha, broadcast);\n    const canal = origemCanal(identity);\n    metadataCampanha = metadataCampanha != \"\" ? metadataCampanha : \"nao possui campanha\";\n\n    const trackOrigemCampanha = `${dataFormatada} | ${identity} | ${metadataCampanha} | ${canal} | ${origem} | ${inputContent}`\n    \n    return { \n        trackOrigemCampanha,\n        canal\n    };\n}\n\nfunction dataAtualFormatada(data) {\n    const dia = data.getDate().toString();\n    const diaF = (dia.length == 1) ? '0' + dia : dia;\n    const mes = (data.getMonth() + 1).toString(); //+1 pois no getMonth Janeiro começa com zero.\n    const mesF = (mes.length == 1) ? '0' + mes : mes;\n    const anoF = data.getFullYear();\n    const hora = data.getHours().toString();\n    const horaF = (hora.length == 1) ? '0' + hora : hora;\n    const min = data.getMinutes().toString();\n    const minF = (min.length == 1) ? '0' + min : min;\n    const seg = data.getSeconds().toString();\n    const segF = (seg.length == 1) ? '0' + seg : seg;\n\n    return `${diaF}/${mesF}/${anoF} ${horaF}:${minF}:${segF}`;\n}\n\nfunction metadata(inputMessage) {\n    try {\n        let inputMessageFormatted = JSON.parse(inputMessage);\n        // let inputMessageFormatted = inputMessage;\n        let metadata = inputMessageFormatted.metadata;\n\n        if (metadata && metadata['#wa.referral.headline']) {\n            const metadataCampanha = `${metadata['#wa.referral.source_id']} | ${metadata['#wa.referral.source_url']} | ${metadata['#wa.referral.headline']} | ${metadata['#wa.referral.body']} | ${metadata['#wa.referral.source_type']} | ${metadata['#wa.referral.image.id']}`\n            return metadataCampanha;\n        } else {\n            const metadataCampanha = \"\"\n            return metadataCampanha;\n        }\n    } catch (err) {\n        const metadataCampanha = \"\";\n        return metadataCampanha;\n    }\n}\n\nfunction origemCampanha(inputContent, metadata, broadcast) {\n    try {\n        const sourceUrl = metadata;\n        if (sourceUrl != \"\") {\n            return \"Campanha\"\n        } else if(broadcast){\n            return `broadcast | ${broadcast}`\n        }\n        return \"organico\"\n    } catch (err) {\n        return \"organico\"\n    }\n}\n\nfunction origemCanal(identity) {\n    try {\n        const source = identity.split('@')[1].split('.')[0];\n        switch (source) {\n            case 'wa':\n                return \"whatsapp\";\n                break;\n            case 'businesschat':\n                return \"businesschat\";\n                break;\n            case '0mn':\n                return \"blipchat\";\n                break;\n            case 'messenger':\n                return \"messenger\";\n                break;\n            case 'telegram':\n                return \"telegram\";\n                break;\n            case 'instagram':\n                return \"instagram\";\n                break;\n            case 'mailgun':\n                return \"email\";\n                break;\n            case 'workplace':\n                return \"workchat\";\n                break;\n            case 'tunnel':\n                return \"whatsapp\";\n                break;\n            case 'abs':\n                return \"teams\";\n                break;\n            default:\n                return \"new\"\n                break;\n        }\n\n    } catch (error) {\n        return false;\n    }\n}","inputVariables":["calendar.datetime","input.message","input.content","contact.extras.broadcastOrigem","contact.identity"],"outputVariable":"origemCampanhaPadrao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dfe44f2b-7378-4221-8059-2c589d0ed9c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Origem campanha [[canal]]\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Origem campanha {{origemCampanhaPadrao@canal}}","action":"{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"origemCampanhaPadrao"},{"comparison":"exists","source":"context","values":[],"variable":"origemCampanhaPadrao@trackOrigemCampanha"}]},{"$id":"06b2da21-deca-437b-891a-509468dd3153","$typeOfContent":"","type":"SetVariable","$title":"Set \"userInput\" to \"{input.content}\"","$invalid":false,"settings":{"variable":"userInput","value":"{{input.content}}"},"conditions":[]},{"$id":"b73d2827-1f98-4885-b665-abb094018fd9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ca389ed-0b36-4604-89ff-cfd11cc6d828","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"veioDeOutroNumero\"","$invalid":false,"settings":{"function":"run","source":"function run(botId) {\n\ttry {\n\t\tif (botId !== 'routersafraprodwhatsapppj' || botId !== 'routerbetawhatsapppj') {\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["tunnel.owner"],"outputVariable":"veioDeOutroNumero","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c8e363c1-55d2-44e6-bd17-ec6b36e9829d","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-4856c172-1130-45c1-9d1e-634bb3c8005b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-36ccea5e-d5bb-4690-a6ec-6b4781bc7659","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7f6edf8e-a07e-473d-a7b7-629d31200e27","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-847a2c3f-f603-41e3-95e2-764bb0b4c6b3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"98px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ce4d5530-5502-4f59-9db1-f234569359c8","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2936feee-9a8c-488a-b210-940e102e6a53","typeOfStateId":"state","$connId":"con_8","$id":"b8d13fe8-ce23-406c-a2f1-63b2d6455e44","conditions":[{"source":"context","comparison":"equals","values":["input inesperado","inatividade"],"variable":"userInput"}],"$invalid":false},{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"ce8e103f-daa4-486a-b7c6-252124d2315b","$connId":"con_13","$invalid":false}],"$enteringCustomActions":[{"$id":"fe3adaaf-557c-454a-86a0-fccbea0b1aaa","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3f552317-4ca1-4eb8-a009-06d88216acc7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"72px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"78a63546-53b7-451d-951c-f0953819fb07","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"895fa7f0-cec1-4487-ba06-ab4d5692b6c8","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"blockDestinationId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b5b7636a-da52-44c4-9de8-86a4028ed472","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"f0eab05c-188d-4f3e-94cf-6809e0895611","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, templates, broadcastOrigem) {\n    try {\n        const parsedTemplates = JSON.parse(templates)\n        const broadcast = parsedTemplates[broadcastOrigem]\n        let blockDestionationId = '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n        if (broadcast) {\n            let id = broadcast[inputContent]\n            if (id) {\n                blockDestionationId = id\n            }\n            else if (broadcast[\"inicio display\"]) {\n                blockDestionationId = \"34c56f71-e624-4181-93bf-37099360c830\"; // Redirecionar Inicio Display Independente de Existir Botão\n            }\n            else {\n                blockDestionationId = broadcast\n            }\n        }\n        if (blockDestionationId.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/)) {\n            return blockDestionationId\n        }\n        return '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n    } catch (err) {\n        return '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n    }\n}","inputVariables":["input.content","resource.broadcastList","contact.extras.broadcastOrigem"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"22855679-4c75-46b4-96b8-d68e55a534bc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{blockDestinationId}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ebd7e378-08ad-43d2-9aae-fd96559025fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-be191058-ada6-4432-b130-3981e4c37fc2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","$title":"[BC.0.0.0] Identifica broadcast","$position":{"top":"417px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ac8d762b-d392-45db-9e20-84724d9d3da7":{"$contentActions":[{"action":{"$id":"ba95aa24-50ed-4f36-af04-50070981808c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9035fe13-9fac-4df5-946f-62ea350bc2aa","$typeOfContent":"text","type":"SendMessage","settings":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b21dda4-37cb-41cd-b52a-d020a742f2db","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"804c253e-be9f-42d4-bf03-18f3313fa15e","$typeOfContent":"","type":"TrackEvent","$title":"count_new_age_acesse_uso","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"count_new_age_acesse_uso","action":"1"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-58317255-cf4c-44d6-a90f-86cd4f52a1bf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ab328703-b9f4-4025-8670-e6c4f83c25fb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ac8d762b-d392-45db-9e20-84724d9d3da7","root":false,"$title":"[BC.1.0.0] Link New age","$position":{"top":"480.471px","left":"1418.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d4beee17-fca9-4e41-a016-ea05948c5598":{"$contentActions":[{"action":{"$id":"386b1f70-6cc5-461e-ae9a-7effc58f3836","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d9d8d36e-8d7a-46cf-ae50-5e21ee246f57","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf","metadata":{}},"$cardContent":{"document":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b54106c5-7c67-4690-95b9-857b0c52da99","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"49d1c76a-a1a0-4ec5-a4b4-b7435943a601","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-1e680dc9-200f-4ace-8898-8e0a58979092","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5ca10f3c-c778-471b-943e-8c007b7f8e9d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d4beee17-fca9-4e41-a016-ea05948c5598","root":false,"$title":"[BC.2.0.0] Link  boas vindas mbj ibj","$position":{"top":"467.429px","left":"1620.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"0e11155a-b0de-46f6-a922-b8cbec51b62f":{"$contentActions":[{"action":{"$id":"c52dae31-e901-44e6-80b6-b7b339c58157","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d22a1258-a613-4835-a1ad-a085074bd3b7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ca329296-0b20-4782-8f21-6a717c7b38f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bab02fd8-e12a-479a-b4f7-424951a17a67","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-6c0a7038-b591-4ec3-9f55-fb66810ce595","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a4d843a5-b1e8-478f-9be8-ce6838532545","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e11155a-b0de-46f6-a922-b8cbec51b62f","root":false,"$title":"[BC.3.0.0] Link de Pagamento","$position":{"top":"487px","left":"1824.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2326fdc6-1097-4ee3-8f29-4887cad6a036","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","typeOfStateId":"state","$connId":"con_18","$id":"f119e366-afab-407d-b15d-8ee3743b53fa","conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}],"$invalid":false},{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_23","$id":"285abc84-9314-4a9d-b08f-e74bde3e52e5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"82bbd11e-bebd-45dc-97e7-9075a02d79fb","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager"},"conditions":[]},{"$id":"29a34062-1abb-41ae-9f75-4bc3ac065951","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager2\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager2"},"conditions":[]},{"$id":"a86e8dc4-b761-47c7-a721-d9f71abce3c9","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager3\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager3"},"conditions":[]},{"$id":"e6837107-5f2d-41fe-a3d3-3e99a51331c9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3be2c783-fca5-440d-8f3c-f8eece073c35","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"023446de-0356-4af2-9e57-990b44f42e47","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"534b4d6b-f3d4-4ab9-9b69-a4f76b3c11b0","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" PHONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"7046570d-80a1-4b6f-888d-8599807e057e","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J | GET | {{statusAccountManager}} | {{bodyAccountManager}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-827d8634-354a-47dd-bf09-b99e2b3397ca","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-686e9ec0-f846-41ad-ae7f-ae66d94a3d0d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3e4d6b22-8019-4c7f-908e-c44ade3cbcc9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-878b3351-eca5-4ffb-9873-187440dc3ced","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe","root":false,"$title":"[BC.4.0.0] Atendimento humano","$position":{"top":"607px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e6db4fe9-f1a4-4c40-8925-f588c3122da0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6bbf7c9a-06a3-40bd-8571-ed0bbce05e06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d2962264-774c-4a6f-8995-d4ed33330cae","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6","root":false,"$title":"[BC.5.0.0] Redirect to Main","$position":{"top":"644.143px","left":"1414px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"698dee4c-6a3d-4aee-bed0-0f5210864d2b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"391edfeb-b8b2-4401-93f1-1e037f271fa4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3531026c-da75-4b6d-b3b0-a4aa88609019","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-03d612dd-4d92-439a-a22e-3dcbede03214","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"698dee4c-6a3d-4aee-bed0-0f5210864d2b","root":false,"$title":"[BC.6.0.0] Redirect to Finalização","$position":{"top":"649px","left":"1618.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a0438f36-f75b-4b4a-ab65-a95eefb35fa3":{"$contentActions":[{"action":{"$id":"ab4e8746-8a43-47df-8b0e-a5d5d5cd8b95","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43ae4c63-ecf8-4c6b-89fd-f3294442b8c7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ","metadata":{}},"$cardContent":{"document":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"333ee957-11c8-4bbd-a568-14ce2577d555","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8734c458-8d93-4764-bdd5-df63687a90c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-63ffe6a2-2dfe-4dde-ab03-c8bd810dfee2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-66fae3fc-f351-4850-8ab1-4b8d01cc3d6e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a0438f36-f75b-4b4a-ab65-a95eefb35fa3","root":false,"$title":"[BC.7.0.0] Link Pesquisa Pix","$position":{"top":"649.5px","left":"1819.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a8d2f811-ac89-4e91-9b16-c93b4b661447',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a8d2f811-ac89-4e91-9b16-c93b4b661447',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d824e92b-5831-450d-81a5-0c55416f0498","$typeOfContent":"","type":"MergeContact","$title":"Reset \"extras\"","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d8703a8a-ace5-4f03-914a-c66edf4cb9d6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5f7dc26d-f5b0-44e0-b155-924f30e23035","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-d4ff5176-5432-4c76-a2c0-d18a2e5241c5","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","root":false,"$title":"[Redirect] to Main (zera variaveis)","$position":{"top":"198px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"449e71de-a279-4ed5-9d44-33d273412a70":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst newState =  {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '5a9c72b7-bfaf-4105-86c1-9cf8be316c37', // [AH.2.2.0] Api horario atendimento\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t\tif (parsedContaSelecionada == false || parsedContaSelecionada.segmentoGerente === 'emp2') {\n\t\t\tnewState.stateDestination = '9a6f3021-b73e-4a50-8ada-691ed5fecfd8' // [AH.2.0.1] Finalização segmento emp2\n\t\t}\n\t\treturn newState\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","contaSelecionada"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3dca8f79-b87f-43f5-bf94-e86e38b83007","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-219d4bae-4753-4106-a5c2-cf1ed573aff7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"449e71de-a279-4ed5-9d44-33d273412a70","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"1268px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1":{"$contentActions":[{"action":{"$id":"1157f573-7664-44aa-9813-8ffcefc8e7a1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c0c436f9-1b47-4bb5-b460-c9b45c94b3ae","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento","metadata":{}},"$cardContent":{"document":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"809b569a-8f0e-4d3e-9823-aae35e2b21e0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"084d96a0-2b8c-481f-adfe-d1183cc13012","typeOfStateId":"state","$connId":"con_28","$id":"356ea3cf-f9b6-4306-9ff7-79057fba7002","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a1d9b64c-aa1f-4309-a1ad-3e07329bcf8c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-15f6668f-7c6c-499b-a8ba-f08df6d2b0d4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d5797bf4-0981-46e2-a87e-b277ea3a8f69","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","root":false,"$title":"[BC.4.1.0][MSG] Solicita CNPJ","$position":{"top":"619px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"084d96a0-2b8c-481f-adfe-d1183cc13012":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"6d518eb2-7541-4052-807c-590d1bf1daeb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","typeOfStateId":"state","$connId":"con_33","$id":"49eef362-cb6c-4e18-9be4-358351b14285","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"fadba59a-75b1-42e1-b0fa-f3f9eed4dd94","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(documento) {\n\tif (!documento) {\n\t\treturn 'inatividade'\n\t}\n\tdocumento = String(documento).replace(/\\D/g, '');\n\treturn verifyDoc(documento)\n}\nfunction verifyDoc(cnpj) {\n\tif (!cnpj || cnpj.length != 14\n\t\t|| cnpj == \"00000000000000\"\n\t\t|| cnpj == \"11111111111111\"\n\t\t|| cnpj == \"22222222222222\"\n\t\t|| cnpj == \"33333333333333\"\n\t\t|| cnpj == \"44444444444444\"\n\t\t|| cnpj == \"55555555555555\"\n\t\t|| cnpj == \"66666666666666\"\n\t\t|| cnpj == \"77777777777777\"\n\t\t|| cnpj == \"88888888888888\"\n\t\t|| cnpj == \"99999999999999\")\n\t\treturn 'input inesperado'\n\tvar tamanho = cnpj.length - 2\n\tvar numeros = cnpj.substring(0, tamanho)\n\tvar digitos = cnpj.substring(tamanho)\n\tvar soma = 0\n\tvar pos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tvar resultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(0)) return 'input inesperado';\n\ttamanho = tamanho + 1\n\tnumeros = cnpj.substring(0, tamanho)\n\tsoma = 0\n\tpos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tresultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(1)) return 'input inesperado'\n\treturn cnpj;\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5409cfb2-5097-429c-a723-a98905683b11","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"cnpj\"","$invalid":false,"settings":{"value":"cnpj","variable":"exceptionType"},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"9d68329a-9135-4cb8-bdd8-143f2f685d79","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"d89f5f8c-15c5-4e1f-a16e-e2215fea5082","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"60236687-a307-4961-bdf6-2399625116cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{userInput}} | {{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-150c7f8a-a0cd-4d41-94ad-675b13ab59e4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b233f45c-8fef-4f20-9387-076ebb37f5e7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-78b21bb3-9e2c-43b5-9c71-23e4af60b50f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-014b58ca-5cfa-4e55-8f2d-421e1ed02d5b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"084d96a0-2b8c-481f-adfe-d1183cc13012","root":false,"$title":"[BC.4.1.0][INPUT] Solicita CNPJ","$position":{"top":"837px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed7b8709-622d-4d93-8f2c-1a2d37438a8b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_38","$id":"15b3d251-e293-4c08-b5b8-2925bda572ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7cacb353-36e0-4d85-b635-f21e527d6b29","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"0bf971c6-ccdb-44a1-9600-2b702d5314a4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020 | GET | {{statusAccountManager2}} | {{bodyAccountManager}}"},"conditions":[]},{"$id":"fcd1cbac-87a0-416d-b975-33ed425eaa1b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]}]},{"$id":"6b1825e7-5dab-432e-b8a0-9960d0ddc372","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017 | GET | {{statusAccountManager3}} | {{bodyAccountManager}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-83e51acd-bb03-4460-a40c-c871e12ce99f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c57e7bfe-72cc-428e-8c2a-4f2cb434026d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","root":false,"$title":"[BC.4.2.0] Verifica carterização por CNPJ","$position":{"top":"1046px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8bea427a-b6e1-42d3-8844-958d7292ad16":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de40fb96-d81d-4d58-9486-f72ffb4ddfc0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"449e71de-a279-4ed5-9d44-33d273412a70","typeOfStateId":"state","$connId":"con_43","$id":"82ace0f2-c6f9-4628-a062-0a8cba05582f","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"contaSelecionada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1d423e8d-45d5-4a3d-b22d-348b756acc43","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function montaCnpj(baseDocumento, filialCnpj, digitoCpf) {\n  let digito = ''\n  if (digitoCpf < 10 && digitoCpf > 0) {\n    digito = \"0\" + digitoCpf\n  } else {\n    digito = digitoCpf\n  }\n\n  let doc = Number(baseDocumento) + \"000\" + Number(filialCnpj) + digito\n  while (doc.length < 14) {\n    doc = `0${doc}`\n  }\n  return doc\n}\n\nfunction apiPhone(apiResponse) {\n  const { id, codigoSegmento, nomeCliente, baseCpfCnpj, filialCnpj, digitoVerificadorCpfCnpj } = apiResponse\n  const contaSelecionada = {\n    filaGerente: id,\n    segmentoGerente: Number(codigoSegmento) === 17 ? 'emp2' : 'emp1',\n    nomeEmpresa: nomeCliente,\n    doc: montaCnpj(baseCpfCnpj, filialCnpj, digitoVerificadorCpfCnpj),\n    codigoSegmento\n  }\n  return contaSelecionada\n}\n\nfunction apiGerentes(apiResponse, doc) {\n  const { sigla, codigoSegmento, nomeSegmento } = apiResponse\n  const contaSelecionada = {\n    filaGerente: sigla,\n    segmentoGerente: Number(codigoSegmento) === 17 ? 'emp2' : 'emp1',\n    nomeEmpresa: nomeSegmento,\n    doc,\n    codigoSegmento\n  }\n  return contaSelecionada\n}\n\nfunction run(status1, status2, status3, bodyAccountManager, userInput) {\n  try {\n    const parsedBodyAccountManager = JSON.parse(bodyAccountManager).data\n    if (status1 == 200) {\n      return apiPhone(parsedBodyAccountManager)\n    } else {\n      return apiGerentes(parsedBodyAccountManager, userInput)\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["statusAccountManager","statusAccountManager2","statusAccountManager3","bodyAccountManager","userInput"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"21943588-88aa-4b27-be1a-2ce235a9665c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{userInput}} | {{input.content}} | {{contaSelecionada}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cfa6c133-8046-4d25-9d6a-16998b586741","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ff7dfd23-48e7-4cc3-90b3-d9e6d726b962","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"8bea427a-b6e1-42d3-8844-958d7292ad16","root":false,"$title":"[BC.4.3.0] Monta variavel contaSelecionada","$position":{"top":"1046px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2936feee-9a8c-488a-b210-940e102e6a53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-0ac619eb-ac4a-4373-8f3f-7ecc4298f357","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2936feee-9a8c-488a-b210-940e102e6a53","root":false,"$title":"[Redirect] To cascata","$position":{"top":"60px","left":"1577px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'fb94c3f1-88bc-4b44-b4f4-43dd60bce494',//sem pesquisa\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-435b6354-c2a5-4c28-84ee-d54ef4554791","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ae64bec5-4a12-4947-b510-3533c6b98549","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","root":false,"$title":"[Redirect] to Finalizacao (finalizado)","$position":{"top":"206px","left":"1576px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d049a751-3b37-4bd1-a419-23c57abffc90":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1347955c-7744-4057-9b55-d0b6ef4b98f7","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","typeOfStateId":"state","$connId":"con_48","$id":"49b206cd-7bb3-4049-b0d4-925a19a05dac","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"contact.extras.broadcastOrigem"},{"values":[],"source":"input","comparison":"exists"}],"$invalid":false},{"stateId":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","typeOfStateId":"state","$connId":"con_53","$id":"8ee4908a-5b2c-4e6a-ad1f-5f7a3a2cb6c2","conditions":[{"source":"context","comparison":"equals","values":["-"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"welcome","typeOfStateId":"state","$connId":"con_58","$id":"7ed1c7c3-5149-440e-bb54-627b4eb3ef5f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"83f149c4-16e5-44f7-ba6e-b2fab6c4fbfc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"542a59d9-4865-41a3-ac02-f292a3eccbb2","$typeOfContent":"","type":"ProcessHttp","$title":"DELETE \"statusDeleteBody\"","$invalid":false,"settings":{"headers":{"Organization":"safra","ContactIdentity":"{{contact.identity}}","BotAuthorization":"{{config.routerKey}}"},"method":"DELETE","uri":"https://flowassistant.cs.blip.ai/api-states","responseBodyVariable":"statusDeleteBody","responseStatusVariable":"statusDeleteStatus"},"conditions":[{"values":["routerbroadcastpj"],"source":"context","comparison":"notEquals","variable":"tunnel.owner"},{"values":["routerbroadcastpj@msging.net"],"source":"context","comparison":"notEquals","variable":"tunnel.owner"}]},{"$id":"a0ae68d4-9d62-4abe-93de-ea94c85f9475","$typeOfContent":"","type":"ProcessHttp","$title":"DELETE \"statusDeleteBodyBroad\" Router Broadcast","$invalid":false,"settings":{"headers":{"Organization":"safra","ContactIdentity":"{{contact.identity}}","BotAuthorization":"{{config.routerKeyBroadcast}}"},"method":"DELETE","uri":"https://flowassistant.cs.blip.ai/api-states","responseBodyVariable":"statusDeleteBodyBroad","responseStatusVariable":"statusDeleteStatusBroad"},"conditions":[{"values":["routerbroadcastpj"],"source":"context","comparison":"contains","variable":"tunnel.owner"}]},{"$id":"c70070af-7865-46f8-97dc-116ee6bd3320","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDeleteStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f2eae57-4f7d-495c-9d26-43cc521881fb","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | https://flowassistant.cs.blip.ai/api-states | DELETE | {{statusDeleteBody}} | {{statusDeleteStatus}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9b7d7fbc-e401-4cd2-ad0a-8854ea5baa5d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c983c96c-ef30-4bae-a559-a178350990ac","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a6b6adb7-6f4e-43e5-abb5-04ac130a2de5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"d049a751-3b37-4bd1-a419-23c57abffc90","root":false,"$title":"[BC.0.0.0][HTTP] Reseta State ID","$position":{"top":"260px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2263fe56-a32f-46e4-9eed-70ebb05ade8f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"025deace-6c0e-4f22-ad53-2666d5a1afea","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"59326cec-f665-46f1-acd5-b803ef616b57","typeOfStateId":"state","$connId":"con_63","$id":"ec96ea29-b475-423c-acf0-1c2a5cca0b4a","conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"veioDeOutroNumero"}],"$invalid":false},{"stateId":"25b2c3fb-2c9c-4858-93db-6970fb09d4ae","typeOfStateId":"state","$connId":"con_68","$id":"19fb844e-4f61-4b03-8f6e-2e10e739a8eb","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"identificaNumeroRoteador"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"25b2c3fb-2c9c-4858-93db-6970fb09d4ae","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","root":false,"$title":"[BC.0.0.1] Entrada organica","$position":{"top":"271px","left":"685px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"25b2c3fb-2c9c-4858-93db-6970fb09d4ae":{"$contentActions":[{"action":{"$id":"ccbe3f0d-d8d1-418e-8800-c7cf37b6f517","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa3a34ce-1476-4d52-8674-8f0b904662f0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa3a34ce-1476-4d52-8674-8f0b904662f0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1307"},{"action":{"$id":"de97d6d6-967e-4c23-8076-4a0b7b2dded9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:1308"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bdc5d440-326d-46e8-9c6a-7360435cc6f5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1309"}],"$conditionOutputs":[{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_73","$id":"6b546c13-4d03-460d-b60e-3a3283828d88","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1330"}],"$invalid":false,"$$hashKey":"object:1316"}],"$enteringCustomActions":[{"$id":"fe8fd6bb-e222-491d-8922-3917360fcb9e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"cta_url\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": \"Olá, *este número é dedicado ao envio de comunicações e ofertas do Safra Empresas.*\\n\\nSe você precisar *de ajuda com consultas, serviços e informações relacionadas à sua conta PJ,* é só tocar no botão abaixo que te levo para falar no nosso número oficial de atendimento.\"\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"name\": \"cta_url\",\n\t\t\t\t\t\"parameters\": {\n\t\t\t\t\t\t\"display_text\": \"Safra Empresas\",\n\t\t\t\t\t\t\"url\": \"https://bit.ly/4bwdVGv\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-76c5e058-ae0b-41f4-85f0-0fc74edbe2d0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-626b51be-4c1a-4d68-91e9-ba969db4863a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"25b2c3fb-2c9c-4858-93db-6970fb09d4ae","root":false,"$title":"[BC.0.0.2][MSG] Finalização","$position":{"top":"86px","left":"685px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59326cec-f665-46f1-acd5-b803ef616b57":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"537f4be6-f754-4e4c-a7f3-e08e430773b1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"59326cec-f665-46f1-acd5-b803ef616b57","root":false,"$title":"[GO TO] Bot main","$position":{"top":"283px","left":"421px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"34c56f71-e624-4181-93bf-37099360c830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `principal ${env || \"\"}`.trim(), //DISPLAY\n\t\t\tstateDestination: 'welcome', //inicio\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d58e001e-0722-4d5e-9098-8f9e53434760","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c4ff2b2-6283-45a5-920e-9447e108cb85","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"34c56f71-e624-4181-93bf-37099360c830","root":false,"$title":"[Redirect] to Display (inicio)","$position":{"top":"215.286px","left":"1770.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E. South America Standard Time"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false}}