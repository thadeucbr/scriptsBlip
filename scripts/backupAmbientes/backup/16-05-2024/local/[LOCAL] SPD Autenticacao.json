{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"414803ce-4551-4128-b58b-504ac5dc20ef","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"03bf054f-86ed-4456-8235-128f86692da7","typeOfStateId":"state","$connId":"con_3","$id":"e58eb2d3-b681-43cd-9bac-83d49f1d2a56","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["true"],"source":"context","comparison":"equals","variable":"config.skipKba"},{"values":["5518981851760@wa.gw.msging.net"],"source":"context","comparison":"notEquals","variable":"contact.identity"}],"$invalid":false},{"stateId":"d4828b51-2ba7-49ba-9eda-334ebbd18be0","typeOfStateId":"state","$connId":"con_8","$id":"ceba3554-2738-42b5-8732-105667f95dfe","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"bloquearKBA"}],"$invalid":false},{"stateId":"2eca4933-5928-4a93-9357-5583403426e7","typeOfStateId":"state","$connId":"con_13","$id":"fdfb5c0b-9abd-4140-a9aa-42d720920db4","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"authenticated"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"authenticated"}],"$invalid":false},{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"c5edaca9-b765-45ee-bcdc-7109469d41f3","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"welcome","typeOfStateId":"state","$connId":"con_18","$id":"74937f5d-c069-49e6-9402-ce94db8e34cc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a9932ec5-c8ca-43a3-8be0-cab677c0c3bb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"returnStateAuth\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(state, env, serviceName) {\n\ttry {\n\t\tconst { botOrigin, stateOrigin, lastInput, intent, userInput } = JSON.parse(state)\n\t\t\treturn {\n\t\t\t\tbotOrigin: serviceName,\n\t\t\t\tstateNameOrigin: 'aprovado',\n\t\t\t\tstateOrigin: 'aprovado',\n\t\t\t\tbotDestination: botOrigin,\n\t\t\t\tstateDestination: stateOrigin,\n\t\t\t\tuserInput,\n\t\t\t\tlastInput,\n\t\t\t\tintent\n\t\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","env","config.serviceName"],"outputVariable":"returnStateAuth","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"returnStateAuth"}]},{"$id":"d6448a28-f926-4974-b12d-fe0260221593","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"751d2b57-753a-4965-8e69-c91b59962c23","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"authenticated\"","$invalid":false,"settings":{"function":"run","source":"function run(authenticated, idSessao) {\n\ttry {\n\t\tif (authenticated === idSessao) {\n\t\t\treturn authenticated\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["authenticated","idSessao"],"outputVariable":"authenticated","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ec1d5ee0-0fa9-4371-9d7c-a4f77205235f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bloquearKBA\"","$invalid":false,"settings":{"function":"run","source":"function run(idSessao, bloquearKBA) {\n\ttry {\n\t\tif (!bloquearKBA) {\n\t\t\treturn false\n\t\t}\n\t\tif (bloquearKBA === idSessao) {\n\t\t\treturn authenticated\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["idSessao","bloquearKBA"],"outputVariable":"bloquearKBA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"461a2d3d-26cc-403f-863c-460ea6f4f9f2","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"cpf":"39947878821"}},"conditions":[{"values":["5518981851760@wa.gw.msging.net"],"source":"context","comparison":"equals","variable":"contact.identity"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b7782c3a-a509-479e-a39f-ab0050c9b451","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8ec2391b-ffb4-45ef-be62-0d43a17502fe","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-15ef1021-1651-41cd-a77a-063c878b07ef","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"211px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a8d5af2-a566-4dc4-b2dd-fab7805d39f4","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:614"}],"$conditionOutputs":[{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","typeOfStateId":"state","$connId":"con_23","$id":"5c459ed8-dccb-4ad0-aae4-abb8fefde1f6","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:630"}],"$invalid":false,"$$hashKey":"object:616"}],"$enteringCustomActions":[{"$id":"61eb6f35-70b7-4007-832e-5090b6cab8e7","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4c885163-5d4d-4dc3-b0e2-44d008661d24","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-40489f57-0775-4418-9041-62afcef8f15e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"41px","left":"849px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"13ba3eee-48ca-43ab-9cfb-a418c795692e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bc05ded3-8b7b-40cf-b01b-1f8fb93792dc","typeOfStateId":"state","$connId":"con_28","$id":"b6df4269-fdb3-4b01-94de-6e57975502f1","conditions":[{"source":"context","comparison":"equals","values":["bigId"],"variable":"tipoDesafio@proximoDesafio"}],"$invalid":false},{"stateId":"0417c99c-cc01-4fa7-bfef-75b599a63c95","typeOfStateId":"state","$connId":"con_33","$id":"f4a0444c-8241-4423-8786-7aafac9ab79e","conditions":[{"source":"context","comparison":"equals","values":["kba"],"variable":"tipoDesafio@proximoDesafio"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4873864c-6c2b-40f1-9853-2990f1ff0ca2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"requestBodyMFA\"","$invalid":false,"settings":{"function":"run","source":"const transacoes = {\n\t'taxas de venda': 'SAFRAPAY_TAXAS_E_CONDICOES',\n\t'taxas de antecipação': 'SAFRAPAY_TAXAS_E_CONDICOES',\n\t'consultar máquinas': 'SAFRAPAY_CONSULTA_MAQUINA',\n\t'domicilio bancário': 'SAFRAPAY_TAXAS_E_CONDICOES',\n\t'taxas pix na safrapay': 'SAFRAPAY_TAXAS_E_CONDICOES',\n\t'questionar uma cobrança': 'SAFRAPAY_ABERTURA_PROTOCOLOS',\n\t'pacotes contratados': 'SAFRAPAY_ABERTURA_PROTOCOLOS',\n\t'contratar antecipação': 'SAFRAPAY_TAXAS_E_CONDICOES'\n}\nfunction run(idSessao, randomGuid, cpf, contaSelecionada, returnStateAuth, contactPhone) {\n\tconst phone = contactPhone.split('@')[0]\n\tconst { codigoCliente, agencia, conta, nomeCompleto, shortname, usuario, codigoSegmento } = JSON.parse(contaSelecionada)\n\tconst { userInput } = JSON.parse(returnStateAuth)\n\tconst body = JSON.stringify({\n\t\t\"transacao\": transacoes[userInput.toLowerCase()] || 'SAFRAPAY_TAXAS_E_CONDICOES',\n\t\t\"idTransacao\": randomGuid,\n\t\t\"cliente\": {\n\t\t\t\"codigo\": parseInt(codigoCliente),\n\t\t\t\"agencia\": agencia,\n\t\t\t\"conta\": conta,\n\t\t\t\"numeroCelular\": phone,\n\t\t\t\"cpf\": cpf,\n\t\t\t\"nome\": nomeCompleto,\n\t\t\t\"shortname\": shortname,\n\t\t\t\"usuario\": usuario,\n\t\t\t\"codigoSegmento\": parseInt(codigoSegmento)\n\t\t},\n\t\t\"bot\": {\n\t\t\t\"id\": \"routersafraprodwhatsapppj\",\n\t\t\t\"idSessao\": idSessao\n\t\t}\n\t})\n\treturn body\n}","inputVariables":["idSessao","random.guid","contact.extras.cpf","contaSelecionada","returnStateAuth","contact.identity"],"outputVariable":"requestBodyMFA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"49adfd66-2b21-4083-a155-5d1a33cac424","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyMFA\" using \"POST\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"POST","body":"{{requestBodyMFA}}","uri":"{{config.urlCHT}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"statusMFA","responseBodyVariable":"bodyMFA"},"conditions":[]},{"$id":"9b12cb42-84c2-42ea-a1a0-b9572819ecd9","$typeOfContent":"","type":"SetVariable","$title":"Set \"respostas\" to \"[]\"","$invalid":false,"settings":{"variable":"respostas","value":"[]"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b3812606-0e2b-48d7-b093-8216b9ab5c12","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"tipoDesafio\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyMFA) {\n\tconst desafios = {\n\t\tdesafiosDisponiveis: [],\n\t\tproximoDesafio: 'bigId'\n\t}\n\ttry {\n\t\tconst { data } = JSON.parse(bodyMFA)\n\n\t\tif (data.acao.toLowerCase() === 'negar') {\n\t\t\treturn desafios\n\t\t}\n\n\t\tconst { desafiosDisponiveis } = data.detalhes\n\n\n\t\tif (desafiosDisponiveis.length > 0) {\n\t\t\tdesafios.proximoDesafio = desafiosDisponiveis[0]\n\t\t\tdesafiosDisponiveis.shift()\n\t\t\tdesafios.desafiosDisponiveis = desafiosDisponiveis\n\t\t}\n\t\treturn desafios\n\t} catch (err) {\n\t\treturn {\n\t\t\tdesafiosDisponiveis: [],\n\t\t\tproximoDesafio: 'bigId'\n\t\t}\n\t}\n}","inputVariables":["bodyMFA"],"outputVariable":"tipoDesafio","LocalTimeZoneEnabled":false},"conditions":[{"values":["ELEVAR","NEGAR"],"source":"context","variable":"bodyMFA@data.acao","comparison":"equals"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-037949f9-d0e3-4820-9cb1-c8db7e4719f6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c3700e32-9baa-42ae-9e3f-e4f2b4afa854","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-12e639c5-2977-464f-b90d-401cef34f3b7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"welcome","$title":"[A.0.0.0] Verifica tipo de autenticação","$position":{"top":"588px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f13e7fbd-372e-45ce-a30f-de575a5cb830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:457"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-20435c86-0e51-4140-bcfe-cba4095e75b8","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f13e7fbd-372e-45ce-a30f-de575a5cb830","root":false,"$title":"[Redirect] Cascata","$position":{"top":"30px","left":"1093px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"0417c99c-cc01-4fa7-bfef-75b599a63c95":{"$contentActions":[{"action":{"$id":"2ce5804b-68e9-4d22-a6b1-c5aeafdcaf3b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa030a47-ae02-4583-ab7e-eab842a276ac","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa030a47-ae02-4583-ab7e-eab842a276ac","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1ddd6525-d3be-4363-9d25-5d427386fdf1","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8e42c088-9693-48a1-8f76-0561b5d91f65","type":"text/plain","content":"Antes, vamos fazer algumas perguntas de segurança para confirmar sua identidade. 🔒","metadata":{}},"$cardContent":{"document":{"id":"8e42c088-9693-48a1-8f76-0561b5d91f65","type":"text/plain","content":"Antes, vamos fazer algumas perguntas de segurança para confirmar sua identidade. 🔒"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e047385d-2529-40e5-ade5-9d0d604e75b2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cfb40a48-e0ca-4ce4-8b3a-5e3dae8a1ccf","typeOfStateId":"state","$connId":"con_38","$id":"87007976-dd8a-4814-a5e0-e1cc4c867b22","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"023d7a86-8c57-478b-a91f-f704ed9adb86","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"desafios\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyMFA) {\n\ttry {\n\t\tconst { desafios } = JSON.parse(bodyMFA).data.detalhes\n\t\tconst kba = desafios.find(({ tipo }) => tipo === 'kba')\n\t\treturn kba\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyMFA"],"outputVariable":"desafios","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d73798a6-1474-4c4d-b0b0-f7833967ac83","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pergunta\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(desafios) {\n    try {\n        const { questao, alternativas } = JSON.parse(desafios).questoes[0]\n\n        let pergunta = `${questao}\\n\\n`\n        alternativas.forEach((alternativa, index) => pergunta += `*${index + 1}* - ${alternativa}\\n`)\n\n        return pergunta\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["desafios"],"outputVariable":"pergunta","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fd9542a5-8358-456a-9d20-b21a71f782dd","$typeOfContent":"","type":"SetVariable","$title":"Set \"respostas\" to \"[]\"","$invalid":false,"settings":{"variable":"respostas","value":"[]"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-559765e7-a5a7-45d0-bae0-2fc54d59bce6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d03abd80-f1c4-42ef-a20d-1ea2c1143211","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b23a6f1c-e1f4-48fc-90f4-fcbec851c4c1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0417c99c-cc01-4fa7-bfef-75b599a63c95","root":false,"$title":"[A.1.0.0] Autenticação via KBA","$position":{"top":"870px","left":"626px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c751af71-0473-4986-93bd-dd5c7f4c3d8e":{"$contentActions":[{"action":{"$id":"143ea980-8780-444d-8613-6311144d1412","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aeb84d1c-cb9d-4748-8129-950ee300f5bc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"aeb84d1c-cb9d-4748-8129-950ee300f5bc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7ff603bd-b825-4e1d-9d06-a6489bcffc6e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6f6447cb-e193-430f-8aac-b5dbffc52db6","type":"text/plain","content":"Biometria","metadata":{}},"$cardContent":{"document":{"id":"6f6447cb-e193-430f-8aac-b5dbffc52db6","type":"text/plain","content":"Biometria"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"71165b5c-3977-419f-b17a-8d81a9b1cbdc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9dd02d4c-8302-4541-ac6d-2bec869dee6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9dd02d4c-8302-4541-ac6d-2bec869dee6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fe3ec6c5-d3f6-408c-91e7-9180e8dcb251","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6bfa9319-8bab-4506-b402-3a6b09f29134","type":"text/plain","content":"Em construção","metadata":{}},"$cardContent":{"document":{"id":"6bfa9319-8bab-4506-b402-3a6b09f29134","type":"text/plain","content":"Em construção"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cd08070c-1d33-4214-979b-fe7ffe85aeab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ba16ec5c-e1b7-4186-a202-ef1af784da55","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c751af71-0473-4986-93bd-dd5c7f4c3d8e","root":false,"$title":"[A.2.0.0] Autenticação via Biometria","$position":{"top":"867px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5404bb47-2c80-451f-87c4-3d20373e4b33","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c8ff73a9-58ed-4c00-9cfd-625bfb0e7ee5","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" to \"{returnStateAuth}\"","$invalid":false,"settings":{"variable":"state","value":"{{returnStateAuth}}"},"conditions":[]},{"$id":"5272af2c-bda8-4441-810a-97d71314844e","$typeOfContent":"","type":"SetVariable","$title":"Set \"userInput\" to \"{state@lastInput}\"","$invalid":false,"settings":{"variable":"userInput","value":"{{state@lastInput}}"},"conditions":[]},{"$id":"f2352c40-7638-4d93-87fb-1180591c46d8","$typeOfContent":"","type":"SetVariable","$title":"Set \"returnStateAuth\" to \"false\"","$invalid":false,"settings":{"variable":"returnStateAuth","value":"false"},"conditions":[]},{"$id":"70993cbb-5c41-4f3b-9b16-d3424b550e58","$typeOfContent":"","type":"SetVariable","$title":"Set \"authenticated\" to \"{idSessao}\"","$invalid":false,"settings":{"variable":"authenticated","value":"{{idSessao}}","expiration":null},"conditions":[]},{"$id":"dce13eae-76a3-4f39-bb7b-54cfd13abca3","$typeOfContent":"","type":"SetVariable","$title":"Set \"bloquearKBA\" to \"false\"","$invalid":false,"settings":{"variable":"bloquearKBA","value":"false"},"conditions":[]}],"$leavingCustomActions":[{"$id":"21454a6a-3d03-4127-9fcb-736bdd79083c","type":"Redirect","$title":"Redirect to service","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5c6c7b09-e82a-4eb0-9563-f308e7a6c6fd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-efeeedc0-024c-401c-8bc3-e396f2b5e23f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28","root":false,"$title":"[Redirect] Usuario aprovado","$position":{"top":"2472px","left":"1440px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cfb40a48-e0ca-4ce4-8b3a-5e3dae8a1ccf":{"$contentActions":[{"action":{"$id":"2974ff30-5b2f-40fe-b27a-7936474ccbf8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b10511b6-943a-48e4-9979-f6dce47f7301","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b10511b6-943a-48e4-9979-f6dce47f7301","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"86b94865-3c34-4555-859d-b330eadb6bbb","$typeOfContent":"text","type":"SendMessage","settings":{"id":"498aff3f-7036-4f5c-b996-b9e57b1066e7","type":"text/plain","content":"{{pergunta}}","metadata":{}},"$cardContent":{"document":{"id":"498aff3f-7036-4f5c-b996-b9e57b1066e7","type":"text/plain","content":"{{pergunta}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ea2eae4-e43f-4da0-be54-be8fc450c274","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55bf55ff-4d78-4cb0-b36d-300bb28b97ae","typeOfStateId":"state","$connId":"con_43","$id":"99b1266f-4f3a-4766-b96d-77c16d7b91e3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-92ce1a7c-4bcd-458f-a531-de7eba3ffb57","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cfb40a48-e0ca-4ce4-8b3a-5e3dae8a1ccf","root":false,"$title":"[A.1.1.0] Exibe pergunta","$position":{"top":"1113px","left":"626px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55bf55ff-4d78-4cb0-b36d-300bb28b97ae":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c82613c3-64a4-4ab0-8182-6415899806e7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"dd6c1885-d516-42cd-adaf-9a918c2a5d81","typeOfStateId":"state","$connId":"con_48","$id":"7cc42fb7-16b4-43ae-bb93-1712f531d6bb","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["false"],"source":"context","comparison":"equals","variable":"pergunta"}],"$invalid":false},{"stateId":"cfb40a48-e0ca-4ce4-8b3a-5e3dae8a1ccf","typeOfStateId":"state","$connId":"con_53","$id":"56bc6483-b43f-4bfd-946c-0a1a9bc389de","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"75903b76-2518-49ca-a2de-af0733d08743","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, desafios) {\n\ttry {\n\t\tif (!inputContent) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst { alternativas } = JSON.parse(desafios).questoes[0]\n\t\tlet answer = false\n\t\tif (isNaN(inputContent)) {\n\t\t\tanswer = alternativas.find((alternativa) => alternativa.toLowerCase() == inputContent.toLowerCase())\n\t\t} else {\n\t\t\tanswer = alternativas[Number(inputContent) - 1]\n\t\t}\n\n\t\tif (answer) {\n\t\t\treturn answer\n\t\t}\n\t\treturn 'input inesperado'\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","desafios"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9213009a-3568-4bef-b099-2955217b21f3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"desafios\"","$invalid":false,"settings":{"function":"run","source":"function run(desafios) {\n\ttry {\n\t\tconst parsedDesafios = JSON.parse(desafios)\n        parsedDesafios.questoes.shift()\n\t\treturn parsedDesafios\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["desafios"],"outputVariable":"desafios","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"a4071827-90cb-4b02-8191-ed93907b5825","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pergunta\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(desafios) {\n    try {\n        const { questao, alternativas } = JSON.parse(desafios).questoes[0]\n        if (!questao || alternativas.length === 0) {\n            return false\n        }\n        let pergunta = `${questao}\\n\\n`\n        alternativas.forEach((alternativa, index) => pergunta += `*${index + 1}* - ${alternativa}\\n`)\n\n        return pergunta\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["desafios"],"outputVariable":"pergunta","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"5220853b-4a7d-432d-abcb-40acc915d3ce","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"respostas\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(userResponse, respostas) {\n\ttry {\n\t\tif (!respostas) {\n\t\t\treturn [userResponse]\n\t\t}\n\t\tconst parsedrespostas = JSON.parse(respostas)\n\t\tparsedrespostas.push(userResponse)\n\t\treturn parsedrespostas\n\t} catch (err) {\n\t\treturn respostas\n\t}\n}","inputVariables":["userInput","respostas"],"outputVariable":"respostas","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"1f9a6c1c-0796-4020-8595-ea86eaede21c","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"kba\"","$invalid":false,"settings":{"variable":"exceptionType","value":"kba"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3fbbbdfd-cdac-4ab3-ac7c-5adb40aac040","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2e725012-3662-4a72-bd05-d17bc065cfce","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-945445b3-e874-436b-b146-2cd3d696b181","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"55bf55ff-4d78-4cb0-b36d-300bb28b97ae","root":false,"$title":"[A.1.1.0] Confirma resposta do usuario","$position":{"top":"1321px","left":"626px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dd6c1885-d516-42cd-adaf-9a918c2a5d81":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ca29af67-7fbb-46a0-a13c-ec44f1b37bf0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28","typeOfStateId":"state","$connId":"con_58","$id":"7b4a9b48-fc5f-4304-8ed4-1c8325aa511e","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"bodyKbaValidar@data.acao"}],"$invalid":false},{"stateId":"e61b74d1-2341-495f-9729-2ca2813feb53","typeOfStateId":"state","$connId":"con_63","$id":"a385cadd-7b65-4920-804c-e9078a06d3d4","conditions":[{"source":"context","comparison":"notEquals","values":["APROVAR"],"variable":"bodyKbaValidar@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d2993c3-eabd-4adf-b61e-47bdcb5bd2d1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"requestBodyValidacaoKBA\"","$invalid":false,"settings":{"function":"run","source":"const transacoes = {\n\t'taxas de venda': 'SAFRAPAY_TAXAS_E_CONDICOES_VALIDACAO',\n\t'taxas de antecipação': 'SAFRAPAY_TAXAS_E_CONDICOES_VALIDACAO',\n\t'consultar máquinas': 'SAFRAPAY_CONSULTA_MAQUINA_VALIDACAO',\n\t'domicilio bancário': 'SAFRAPAY_TAXAS_E_CONDICOES_VALIDACAO',\n\t'taxas pix na safrapay': 'SAFRAPAY_TAXAS_E_CONDICOES_VALIDACAO',\n\t'questionar uma cobrança': 'SAFRAPAY_ABERTURA_PROTOCOLOS_VALIDACAO',\n\t'pacotes contratados': 'SAFRAPAY_ABERTURA_PROTOCOLOS_VALIDACAO',\n\t'contratar antecipação': 'SAFRAPAY_TAXAS_E_CONDICOES_VALIDACAO'\n}\nfunction run(idSessao, cpf, contaSelecionada, respostas, desafio, returnStateAuth, contactIdentity, bodyMFA) {\n\tconst idOperacao = JSON.parse(bodyMFA).data.detalhes.idOperacao\n\tconst phone = contactIdentity.split('@')[0]\n\tconst { codigoCliente, agencia, conta, nomeCompleto, shortname, usuario, codigoSegmento } = JSON.parse(contaSelecionada)\n\tconst { id } = JSON.parse(desafio)\n\tconst { userInput } = JSON.parse(returnStateAuth)\n\tconst body = JSON.stringify({\n\t\t\"transacao\": transacoes[userInput.toLowerCase()] || 'SAFRAPAY_TAXAS_E_CONDICOES_VALIDACAO',\n\t\tcliente: {\n\t\t\tcodigo: codigoCliente,\n\t\t\tagencia,\n\t\t\tconta,\n\t\t\tnumeroCelular: phone\n\t\t},\n\t\tautenticacao: {\n\t\t\tidOperacao,\n\t\t\tdesafio: {\n\t\t\t\ttipo: 'kba',\n\t\t\t\tid,\n\t\t\t\trespostas: JSON.parse(respostas)\n\t\t\t}\n\t\t}\n\t})\n\treturn body\n}","inputVariables":["idSessao","contact.extras.cpf","contaSelecionada","respostas","desafios","returnStateAuth","contact.identity","bodyMFA"],"outputVariable":"requestBodyValidacaoKBA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"db33e110-7f55-4d33-8f60-029cbbcbd4d7","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyKbaValidar\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"CHT"},"method":"POST","body":"{{requestBodyValidacaoKBA}}","uri":"{{config.urlCHT}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/kba/validar","responseStatusVariable":"statusKbaValidar","responseBodyVariable":"bodyKbaValidar"},"conditions":[]},{"$id":"d86ba8fd-42f8-4ddc-91ef-7d828380a28d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyKbaValidar, bloquearKBA) {\n\ttry {\n\t\tconst { acao } = JSON.parse(bodyKbaValidar).data\n\t\tlet buttons = []\n\t\tif (acao === 'BLOQUEAR' || bloquearKBA != 'false') {\n\t\t\tbuttons = [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\t\"title\": \"Menu principal\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t} else {\n\t\t\tbuttons = [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\t\"title\": \"Tentar novamente\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\t\"title\": \"Menu principal\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconst headerText = \"Lamento, mas não foi possível prosseguir com a autenticação. 😕\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["bodyKbaValidar","bloquearKBA"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a69d5955-7d5c-47fa-a50b-3138a4563e4d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-de87cc39-43fd-4ffd-8452-c275507a7e5c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"dd6c1885-d516-42cd-adaf-9a918c2a5d81","root":false,"$title":"[A.1.2.0] Valida respostas do KBA","$position":{"top":"1857px","left":"626px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e61b74d1-2341-495f-9729-2ca2813feb53":{"$contentActions":[{"action":{"$id":"14e8e7eb-21a8-4a2b-ad5f-27ba1cb43312","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a18a0a29-9ddf-4c21-9a7d-513465b6eb5f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a18a0a29-9ddf-4c21-9a7d-513465b6eb5f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f7906ad2-bafc-4e28-8f6f-723a90aad340","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"276bcd11-4f03-4df2-8a3e-c49893e4deba","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"aa495f49-cd0f-4ce5-9d26-686287f4dd8c","typeOfStateId":"state","$connId":"con_68","$id":"4085f273-6730-4c7d-98bd-8599bdf01427","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-31746758-e15b-4f2e-adfc-a6756b13a6ac","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e61b74d1-2341-495f-9729-2ca2813feb53","root":false,"$title":"[A.4.0.0] Usuario reprovado","$position":{"top":"1836px","left":"1442px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"aa495f49-cd0f-4ce5-9d26-686287f4dd8c":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d550335f-de01-4b66-968d-631b282f6b7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"395f93b5-1cf4-4d3e-b323-33635b9e9769","typeOfStateId":"state","$connId":"con_73","$id":"4d5d021f-afa5-416d-92ce-6ab1d10ee43d","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Tentar novamente"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"75de694b-8632-430a-ae9a-2b44fb0ec351","typeOfStateId":"state","$connId":"con_78","$id":"33c4970e-c9b2-4820-b7de-23e5c86f507f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Menu principal"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"e724df07-0bc3-4cf4-ac48-9dc88e218885","typeOfStateId":"state","$connId":"con_83","$id":"88d1f230-93d9-46fa-a51b-20ef0aef6e9c","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Encerrar"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"64df551b-be5b-403b-b967-706ca91dcee4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"03505656-7589-4402-9130-efc52e7c03f7","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-181c61a2-b4e4-450f-a160-2d4f2bbb41b2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-14335755-cba4-40ea-87e5-c4d8f70a3370","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-94dde688-7e6b-4a5b-af01-9d604dbd1662","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"aa495f49-cd0f-4ce5-9d26-686287f4dd8c","root":false,"$title":"[A.4.0.0] Valida resposta do usuario","$position":{"top":"2030px","left":"1442px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"395f93b5-1cf4-4d3e-b323-33635b9e9769":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a0de0cc8-7eb4-4f5b-901d-f1507d46e053","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"51a6983c-2d48-4c4e-8180-2cdc26688a41","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"desafios\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyMFA) {\n\ttry {\n\t\tconst { desafios } = JSON.parse(bodyMFA).data\n\t\tconst kba = desafios.find(({ tipo }) => tipo === 'kba')\n\t\treturn kba\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyKbaValidar"],"outputVariable":"desafios","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"95b0705f-dca4-47e0-9057-61c36177bdfc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pergunta\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(desafios) {\n    try {\n        const { questao, alternativas } = JSON.parse(desafios).questoes[0]\n\n        let pergunta = `${questao}\\n\\n`\n        alternativas.forEach((alternativa, index) => pergunta += `*${index + 1}* - ${alternativa}\\n`)\n\n        return pergunta\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["desafios"],"outputVariable":"pergunta","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"baf72298-06d9-4dcc-bc44-b12930304c17","$typeOfContent":"","type":"SetVariable","$title":"Set \"bloquearKBA\" to \"true\"","$invalid":false,"settings":{"variable":"bloquearKBA","value":"{{idSessao}}"},"conditions":[]},{"$id":"63387a84-7169-4355-9cfc-2d46da32ec21","$typeOfContent":"","type":"SetVariable","$title":"Set \"respostas\" to \"[]\"","$invalid":false,"settings":{"variable":"respostas","value":"[]"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-947a9a87-0e00-4929-b3be-4a6fd37eb148","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-63f86f32-e51d-4d4a-bbbb-fbe1248573fd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"395f93b5-1cf4-4d3e-b323-33635b9e9769","root":false,"$title":"[A.4.1.0] Tentar novamente","$position":{"top":"2230px","left":"1442px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bc05ded3-8b7b-40cf-b01b-1f8fb93792dc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8c3a18d-dbd0-414f-ad8d-db1da13cdd7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8198335c-5ca3-4c04-9f3c-c5eba45bde99","typeOfStateId":"state","$connId":"con_88","$id":"bd2ea699-267e-4879-8100-62f35080b462","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"55ed1d19-dd99-4d61-a8be-4fc3ad198f4e","type":"ProcessHttp","$title":"Process \"bodyTokenBigID\" using \"POST\"","$invalid":false,"settings":{"headers":{},"method":"POST","body":"{\n    \"login\": \"SAFRABIGIDAPI_BANKING\",\n    \"password\": \"zvasdp3t\",\n    \"expires\": 8750\n}","uri":"https://accesstoken.bigdatacorp.com.br/Generate","responseStatusVariable":"statusTokenBigID","responseBodyVariable":"bodyTokenBigID"},"conditions":[]},{"$id":"4c759438-bb0f-4e23-b57f-90a44332e4b7","type":"ProcessHttp","$title":"Process \"bodyQuestion\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyTokenBigID@token}}"},"uri":"https://bigid.bigdatacorp.com.br/Questions","method":"POST","body":"{\n    \"Group\": \"WHATS_PJ\",\n    \"Parameters\": [\n        \"CPF={{contact.extras.cpf}}\"\n    ]\n}","responseStatusVariable":"statusQuestion","responseBodyVariable":"bodyQuestion"},"conditions":[{"source":"context","comparison":"equals","variable":"statusTokenBigID","values":["200"]}]},{"$id":"fbc40500-f167-48aa-b805-c67c21a3c746","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pesquisaBigID\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyQuestion) {\n\ttry {\n\t\tconst parsedQuestions = JSON.parse(bodyQuestion)\n\n\t\tif (parsedQuestions.Questions.length > 0) {\n\t\t\tconst questionList = parsedQuestions.Questions.map(({ Question, Answers }) => ({\n\t\t\t\tquestao: Question,\n\t\t\t\talternativas: Answers\n\t\t\t}))\n\t\t\treturn {\n\t\t\t\tquestionList,\n\t\t\t\tquantidadePerguntas: questionList.length,\n\t\t\t}\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyQuestion"],"outputVariable":"pesquisaBigID","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusQuestion"}]}],"$leavingCustomActions":[{"$id":"176c99f3-dfa6-484c-b3b8-564dd41508b0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Intencoes {state.name}\"","$invalid":false,"settings":{"extras":{},"category":"SPD Intenções {{state.name}}","action":"Negado | {{statusQuestion}}"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"pesquisaBigID"}]},{"$id":"e615b48d-0fcd-495b-b552-46cbecdecef5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Intencoes {state.name} api status\"","$invalid":false,"settings":{"extras":{},"category":"SPD Intencoes {{state.name}} api status","action":"{{statusQuestion}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusQuestion"}]},{"$id":"f00a920b-cca5-428a-a427-106632dc9ea7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"autenticacao BigId sem pesquisa\"","$invalid":false,"settings":{"extras":{},"category":"Autenticacao BigID sem pesquisa","action":"{{phone}} | sem pesquisa"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"pesquisaBigID"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fbe928e3-5e9b-42c7-ade5-f949f3a6c343","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-1568f2e1-d7bd-4e8f-9fa4-1545023bb0aa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-89a38066-f438-4d44-81a3-1a85a326b0f2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"bc05ded3-8b7b-40cf-b01b-1f8fb93792dc","root":false,"$title":"[A.3.0.0] Autenticação via BigId","$position":{"top":"863px","left":"2172px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8198335c-5ca3-4c04-9f3c-c5eba45bde99":{"$contentActions":[{"action":{"$id":"226e31c9-fbd8-4c1f-bed6-9d878247e55c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"708b4c68-3b73-40da-bfc7-80c65dc1216f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"708b4c68-3b73-40da-bfc7-80c65dc1216f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c0aa6c1c-a8b7-49c7-b4a1-5ed10ec6b11a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2c25341-3046-4de7-ab1b-8aaeb85852ad","type":"text/plain","content":"Antes, vamos fazer algumas perguntas de segurança para confirmar sua identidade. 🔒","metadata":{}},"$cardContent":{"document":{"id":"f2c25341-3046-4de7-ab1b-8aaeb85852ad","type":"text/plain","content":"Antes, vamos fazer algumas perguntas de segurança para confirmar sua identidade. 🔒"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9396ac99-15f8-48ad-b118-9698d8afad4e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5d45a572-8812-4453-98fe-94be0f1a4b11","typeOfStateId":"state","$connId":"con_93","$id":"87bbf745-90d9-4de6-91ee-b34c8eb51937","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"56d9b505-18c0-4e06-970d-2271026b6c62","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Inicio {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Inicio {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"d3eb7dc5-2281-42b3-b399-de60eccbc3c7","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"perguntasBigID\"","$invalid":false,"settings":{"function":"run","source":"function run(pesquisa) {\n    try {\n        const parsedPesquisa = JSON.parse(pesquisa).questionList\n        const pergunta = `${parsedPesquisa[0].questao}\\n`\n        parsedPesquisa[0].alternativas.forEach((alternativa, index) => pergunta += `\\n*${index + 1}* - *${alternativa}*`)\n        return pergunta\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["pesquisaBigID"],"outputVariable":"perguntaBigID","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ab590b16-47b0-442d-a1d2-1947921734d2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a79c8ed0-26f9-43f9-a7d9-a8f4056a51ba","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9b75f684-d596-4f1a-84dc-ae956b033613","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"8198335c-5ca3-4c04-9f3c-c5eba45bde99","root":false,"$title":"[A.3.1.0] Inicio perguntas BigID","$position":{"top":"1141px","left":"2172px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b4e07d90-0bd9-4f51-b95d-05a0d996f856":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"50125810-f310-4c5b-99d3-c35a29a648a3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28","typeOfStateId":"state","$connId":"con_98","$id":"14f99cf6-4d21-45c5-94a3-7d0a2387656a","conditions":[{"source":"context","comparison":"equals","values":["Validated"],"variable":"bigIdValidationBody@ResultMessage"}],"$invalid":false},{"stateId":"e61b74d1-2341-495f-9729-2ca2813feb53","typeOfStateId":"state","$connId":"con_103","$id":"b9a81301-a798-4ee3-83d5-4b6a0bfa9ffe","conditions":[{"source":"context","comparison":"notEquals","values":["Validated"],"variable":"bigIdValidationBody@ResultMessage"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c543793b-5ce0-4926-a4cd-c3ea4394e4d8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"validationBody\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyQuestion, bigIdResponses) {\n\ttry {\n\t\tconst TicketId = JSON.parse(bodyQuestion).TicketId\n\t\tconst Parameters = JSON.parse(bigIdResponses)\n\t\treturn {\n\t\t\tTicketId,\n\t\t\tParameters\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyQuestion","bigIdResponses"],"outputVariable":"validationBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4b544c79-40a9-4858-a51b-550d22e0d223","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bigIdValidationBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyTokenBigID@token}}"},"method":"POST","body":"{{validationBody}}","responseStatusVariable":"bigIdStatus","responseBodyVariable":"bigIdValidationBody","uri":"https://app.bigdatacorp.com.br/bigid/kba/respostas"},"conditions":[]},{"$id":"dc92a7b0-0a6f-4cbd-ba86-9aa2ac3edbc6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Tentar novamente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Menu principal\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Lamento, mas não foi possível prosseguir com a autenticação. 😕\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b74ee9f4-f805-4c14-8522-082f8a83fb6b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Intencoes {state.name} resultado respostas\"","$invalid":false,"settings":{"extras":{},"category":"SPD Intencoes {{state.name}} resultado respostas","action":"{{bigIdValidationBody@ResultMessage}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bigIdValidationBody@ResultMessage"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-96a7b242-66aa-486b-8caf-4ecdce652fa6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-569644d8-31f3-4cab-ba13-c95286b759bc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-12f68747-2406-4046-85bc-57c549a5f334","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"b4e07d90-0bd9-4f51-b95d-05a0d996f856","root":false,"$title":"[D.3.3.0] Valida respostas BigID","$position":{"top":"1857px","left":"2172px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d45a572-8812-4453-98fe-94be0f1a4b11":{"$contentActions":[{"action":{"$id":"a6131128-e7d2-4a21-a78c-3dbc672d37ff","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7d84b072-2fee-451d-8626-0cf5220a0ae5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7d84b072-2fee-451d-8626-0cf5220a0ae5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"63ae2f31-323f-433a-a460-4315c37dc7de","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ceb3eb17-24dc-4dd3-b976-f2a98e2641f0","type":"text/plain","content":"{{perguntaBigID}}","metadata":{}},"$cardContent":{"document":{"id":"ceb3eb17-24dc-4dd3-b976-f2a98e2641f0","type":"text/plain","content":"{{perguntaBigID}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e530e31-1daa-4fc2-b6aa-ab7521ff821c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5cdebef6-9f42-4fe0-a3d0-76a95a4d03f5","typeOfStateId":"state","$connId":"con_108","$id":"a03e9512-91b5-452a-a426-7a00b25baf17","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9658b12-cfe2-43c7-8114-b9187abbe547","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5d45a572-8812-4453-98fe-94be0f1a4b11","root":false,"$title":"[A.3.2.0] Pergunta BigID","$position":{"top":"1362px","left":"2172px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5cdebef6-9f42-4fe0-a3d0-76a95a4d03f5":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b75b3c3e-fa80-4e55-aece-7a0fe6e2bdc5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b4e07d90-0bd9-4f51-b95d-05a0d996f856","typeOfStateId":"state","$connId":"con_113","$id":"7da70551-2e1c-45f8-8b55-3678e51ec05f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["false"],"source":"context","comparison":"equals","variable":"perguntaBigID"}],"$invalid":false},{"stateId":"5d45a572-8812-4453-98fe-94be0f1a4b11","typeOfStateId":"state","$connId":"con_118","$id":"a2d59bbf-a16e-4b19-85e6-69727d22ee09","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f0679de5-53e2-4310-9242-1366d1e83dd0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, pesquisaBigID) {\n\ttry {\n\t\tif (!inputContent) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst parsedPesquisa = JSON.parse(pesquisaBigID).questionList\n\t\tconst answer = ''\n\t\tif (isNaN(inputContent)) {\n\t\t\tanswer = parsedPesquisa[0].alternativas.find((alternativa) => alternativa.toLowerCase() == inputContent.toLowerCase())\n\t\t} else {\n\t\t\tanswer = parsedPesquisa[0].alternativas[Number(inputContent) - 1]\n\t\t}\n\n\t\tif (answer) {\n\t\t\treturn answer\n\t\t}\n\t\treturn 'input inesperado'\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","pesquisaBigID"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"76fc1756-ed10-43a7-bb89-62b7c78aca50","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bigIdResponses\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bigIdResponses, userResponse) {\n\ttry {\n\t\tif (!bigIdResponses) {\n\t\t\treturn [userResponse]\n\t\t}\n\t\tconst parsedBigIdResponses = JSON.parse(bigIdResponses)\n\t\tparsedBigIdResponses.push(userResponse)\n\t\treturn parsedBigIdResponses\n\t} catch (err) {\n\t\treturn bigIdResponses\n\t}\n}","inputVariables":["bigIdResponses","userInput"],"outputVariable":"bigIdResponses","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"5039dbfa-b19a-48fe-af18-c8e9293979f8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pesquisaBigID\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(pesquisaBigID) {\n\ttry {\n\t\tconst parsedPesquisaBigID = JSON.parse(pesquisaBigID)\n\t\tparsedPesquisaBigID.questionList.shift()\n\t\tparsedPesquisaBigID.quantidadePerguntas = parsedPesquisaBigID.questionList.length\n\t\treturn parsedPesquisaBigID\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["pesquisaBigID"],"outputVariable":"pesquisaBigID","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ab59e197-d294-4253-b8ec-9647323fb524","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"kba\"","$invalid":false,"settings":{"variable":"exceptionType","value":"kba"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"03c09ac4-6307-4d4b-a4b4-1d4799559894","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"perguntaBigID\"","$invalid":false,"settings":{"function":"run","source":"function run(pesquisa) {\n    try {\n        const parsedPesquisa = JSON.parse(pesquisa).questionList\n        const pergunta = `${parsedPesquisa[0].questao}\\n`\n        parsedPesquisa[0].alternativas.forEach((alternativa, index) => pergunta += `\\n*${index + 1}* - *${alternativa}*`)\n        return pergunta\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["pesquisaBigID"],"outputVariable":"perguntaBigID","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-367a869c-5b1c-46cc-8c28-f902158ad90c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-241237c4-0835-4042-afca-baad1cdc9b79","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-971f69b5-6224-4511-9998-6e27403ad539","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"5cdebef6-9f42-4fe0-a3d0-76a95a4d03f5","root":false,"$title":"[A.3.2.0][INPUT] Valida resposta big id","$position":{"top":"1577px","left":"2172px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75de694b-8632-430a-ae9a-2b44fb0ec351":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '30e39880-1d2a-439a-a0ed-1e7210966286',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]},{"$id":"479bc87e-332b-4ab5-8057-89165246b80e","$typeOfContent":"","type":"TrackEvent","$title":"Track ¨SPD Excecoes redirecionamento\"","$invalid":false,"settings":{"extras":{"idSessao":"{{idSessao}}"},"category":"SPD Excecoes redirecionamento","action":"Menu inicial"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0d300f64-c9a9-4f8d-bc55-bf391543f9b0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9c662789-11dd-4c40-a3d3-fe82b0a02fd4","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-b1d0f4db-efbb-46c1-822e-b9a03ceca757","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"75de694b-8632-430a-ae9a-2b44fb0ec351","root":false,"$title":"Redirecionar Main (Menu inicial)","$position":{"top":"2041px","left":"1189px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e724df07-0bc3-4cf4-ac48-9dc88e218885":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7deccff1-8250-47dd-acbf-cf84f5755798","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-234de859-e76b-42e5-852c-c17d18a997a4","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e724df07-0bc3-4cf4-ac48-9dc88e218885","root":false,"$title":"Redireciona serviço de Finalizacao (Welcome)","$position":{"top":"2018px","left":"1681px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"03bf054f-86ed-4456-8235-128f86692da7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"543b597a-4a39-479d-b905-d0fef38525e5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"03bf054f-86ed-4456-8235-128f86692da7","root":false,"$title":"[DEV|BETA] KBA Desligado","$position":{"top":"65px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2eca4933-5928-4a93-9357-5583403426e7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76ca18e5-e225-4ea9-83da-bdf80140c772","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0ca0fd73-07f4-4464-b2a5-ebbd8f3b0e28","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2eca4933-5928-4a93-9357-5583403426e7","root":false,"$title":"[A.0.0.1] Usuario autenticado","$position":{"top":"210px","left":"1120px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d4828b51-2ba7-49ba-9eda-334ebbd18be0":{"$contentActions":[{"action":{"$id":"0c4bdb6f-ef7a-4e7e-9cf0-d48bf03bb839","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9f32d8fe-d78e-4088-a51d-0838a67ca975","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9f32d8fe-d78e-4088-a51d-0838a67ca975","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"53e113f3-b6aa-4834-b292-67e423799303","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3b0896d0-cbd9-4932-8c47-c5ab392076bf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b9a93a3b-f2b3-4fc3-92ab-b758611527cc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyKbaValidar, bloquearKBA) {\n\ttry {\n\t\tconst { acao } = JSON.parse(bodyKbaValidar).data\n\t\tlet buttons = []\n\t\tif (acao === 'BLOQUEAR' || acao === 'NEGAR' || bloquearKBA) {\n\t\t\tbuttons = [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\t\"title\": \"Menu principal\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t} else {\n\t\t\tbuttons = [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\t\"title\": \"Menu principal\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\t\"reply\": {\n\t\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconst headerText = \"Lamento, mas não foi possível prosseguir com a autenticação. 😕\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodyKbaValidar","bloquearKBA"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"aa495f49-cd0f-4ce5-9d26-686287f4dd8c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b733c20a-249f-4e57-9799-443fcd8268a1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6419507f-ba63-4548-ad3c-cd73fe25ee5f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d4828b51-2ba7-49ba-9eda-334ebbd18be0","root":false,"$title":"[A.0.0.2] Usuario bloqueado","$position":{"top":"199px","left":"1607px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","urlCHT":"https://api-hml.safra.com.br","serviceName":"autenticacao","env":"Dev","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/devspdautenticacao2","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}