{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"7fc31a03-b1f7-4b65-b90f-67efc0704942","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"5e4fe04d-f76b-443a-ad26-1eded9a0d854","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"6476d17f-4f5c-4ea1-959e-0fad57cd8bc8","typeOfStateId":"state","$connId":"con_3","$id":"0ca63212-b834-4981-999f-aafae3f64b46","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"eb66a3a1-3bed-4680-9c95-6f5c8926bdb7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"bdbba0c6-f7b9-4d0b-bdc6-1c20fd265ff2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e833e0d1-7a81-4adc-9c72-9b149271ca9b","$typeOfContent":"","type":"SetVariable","$title":"Set idSessao IF NOT EXIST","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"idSessao"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-a8fe3f17-011c-4017-b74d-026d8f234e40","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-18abecb2-81d9-468a-bc45-9e7cfe68d6c2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d2fa9f6b-4730-4d27-99e1-f72af7523a69","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-dc29c9af-b8dc-411a-a360-f19d1e5debf4","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"117px","left":"3930px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d6cc6e16-4518-4ff0-9677-470b3397a857","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","typeOfStateId":"state","$connId":"con_8","$id":"dc9d8396-889f-40d8-942a-caaeddc460fe","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78bd990e-116e-4242-9cc2-6571f52fe228","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(previousBlockId, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Principal ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ce70daf4-def5-4390-9017-0282e40ed480","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-08c953c9-011f-444e-b8e5-33a22bd9b62a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"131px","left":"3016px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"99095867-01bc-4fb1-a47d-3168e590e328":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3207213c-5c1f-4009-bb71-9efd9faacd7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1836"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"e5c42afc-00c5-4267-b012-69a5a2cb1a30","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Principal ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'eddeb205-5810-40e9-9d0d-69b714415542',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Principal ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c7b0ddd7-9237-4036-93e3-41ef25b6be22","$typeOfContent":"","type":"Redirect","$title":"Redirect to {service} sending {state@lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-36b28c8b-ff5e-407d-b45a-440f7c2de354","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-12640bed-4584-4153-85f1-a58b23e127c2","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"99095867-01bc-4fb1-a47d-3168e590e328","root":false,"$title":"[Redirect] To Principal (Finalizacao)","$position":{"top":"110px","left":"3459px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dbea5aca-16ff-48d8-94e5-1cc1c37d3356":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"eceade33-1f3d-4151-b69a-a681756f42a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false,"$$hashKey":"object:2461"}],"$conditionOutputs":[{"stateId":"c192ff0b-f855-4c5e-b70f-991686d31f91","typeOfStateId":"state","$connId":"con_13","$id":"0a040f0f-5f66-49c1-b362-6358629b6012","conditions":[{"source":"context","comparison":"equals","values":["Protocolo válido"],"variable":"userInput","$$hashKey":"object:2478"}],"$invalid":false,"$$hashKey":"object:2464"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bb19dbdf-7604-4688-b763-c9df69486991","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n    const invalidInputMessage = 'input inesperado'\n    try {\n      if (!inputUsuario) {\n        return 'inatividade'\n      }\n      const regexDictionary = {\n        \"^\\\\d{14}$\": \"Protocolo válido\"\n      }\n      for (let regex in regexDictionary) {\n        if (new RegExp(regex, 'i').test(inputUsuario)) {\n          return regexDictionary[regex]\n        }\n      }\n      return invalidInputMessage\n    } catch (err) {\n      return invalidInputMessage\n    }\n  }","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c421f31e-2abe-4412-8d83-19f0e9dbd390","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroProtocolo\"","$invalid":false,"settings":{"variable":"numeroProtocolo","value":"{{input.content}}"},"conditions":[{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"883c546a-b6a2-4f9f-add4-89f4fa77ecb6","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"S.2.6.0\"","$invalid":false,"settings":{"variable":"exceptionType","value":"S.2.6.0"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput","$$hashKey":"object:2649"}]},{"$id":"260d0439-fb81-4f7b-b4d1-8aa37001a49d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"927a5019-bbc0-4041-b673-edb402f19ebe","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-1d67c9cb-5241-42ec-86b8-dab9bd3b287a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f6477365-aec4-49f8-87af-c821bc594248","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-67bfffaf-cc4e-4273-959d-2b124d313103","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-28635899-1686-4155-baab-6d68d57082a3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"dbea5aca-16ff-48d8-94e5-1cc1c37d3356","root":false,"$title":"[CP.2.0.0][INPUT] Consulta Protocolo Númerica","$position":{"top":"387px","left":"4331.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"e4d6612a-10e4-46cb-bb7a-fee228cb3415":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"eceade33-1f3d-4151-b69a-a681756f42a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6816ed87-a80a-4743-b76f-0bfbafb3f80d","typeOfStateId":"state","$connId":"con_18","$id":"0a040f0f-5f66-49c1-b362-6358629b6012","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"},{"values":["Sim"],"source":"context","comparison":"equals","variable":"protocoloEncontrado"}],"$invalid":false},{"stateId":"635bebe1-1780-40bc-9069-2292fe9d29c4","typeOfStateId":"state","$connId":"con_23","$id":"47a53f65-d8fe-4cb8-ae35-49a8500934b6","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"},{"values":["Não"],"source":"context","comparison":"equals","variable":"protocoloEncontrado"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c53be232-e007-460d-addf-0b3dd4966922","$typeOfContent":"","type":"SetVariable","$title":"Set statusConsultaOcorrenciaLista CLEAR","$invalid":false,"settings":{"variable":"statusConsultaOcorrenciaLista"},"conditions":[]},{"$id":"f5d908ba-6021-45aa-9fda-fc836452d96b","$typeOfContent":"","type":"SetVariable","$title":"Set bodyConsultaOcorrenciaLista CLEAR","$invalid":false,"settings":{"variable":"bodyConsultaOcorrenciaLista"},"conditions":[]},{"$id":"0bf92cb2-15aa-4e8c-a249-cdc82580e382","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"0da4cca7-1b3b-4ce8-ac79-c76ca8883b30","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyConsultaProtocolo\" (Consultar Protocolo)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Correlation-ID":"{{idSessao}}","Safra-Aplicacao":"CHT"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{numeroProtocolo}}","method":"GET","responseStatusVariable":"statusConsultaProtocolo","responseBodyVariable":"bodyConsultaProtocolo"},"conditions":[]},{"$id":"c4206f93-98bd-4eef-a06c-194ca98545ee","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyConsultaOcorrenciaLista\" (Consultar Ocorrencias Unico)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Correlation-ID":"{{idSessao}}","Safra-Aplicacao":"CHT"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?idProtocolo={{numeroProtocolo}}","method":"GET","responseStatusVariable":"statusConsultaOcorrenciaLista","responseBodyVariable":"bodyConsultaOcorrenciaLista"},"conditions":[]},{"$id":"f230bb72-fbb7-4bf5-90e7-ce2f41746bd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200 && status != 404 )) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusConsultaProtocolo","statusConsultaOcorrenciaLista"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aab17666-7d32-45ca-8400-bfa1c9ade33c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"protocoloEncontrado\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaProtocolo, numeroProtocolo, bodyConsultaOcorrenciaLista) {\n    try {\n        bodyConsultaProtocolo = JSON.parse(bodyConsultaProtocolo).data;\n        bodyConsultaOcorrenciaLista = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        var protocoloInProtocolo = bodyConsultaProtocolo.id == numeroProtocolo;\n        var protocoloInProtocoloLista = bodyConsultaOcorrenciaLista.some(item => item.idProtocolo == numeroProtocolo);\n        if (protocoloInProtocoloLista == true && protocoloInProtocolo == true) {\n            return \"Sim\"\n        }\n        return \"Não\"\n    }\n    catch (e) {\n        return \"Não\"\n    }\n}","inputVariables":["bodyConsultaProtocolo","numeroProtocolo","bodyConsultaOcorrenciaLista"],"outputVariable":"protocoloEncontrado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"82a4304c-747b-4d88-80d2-865a3937e91e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroDeOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(bodyConsultaOcorrenciaLista) {\n\ttry {\n\t\tlet ocorrencias = JSON.parse(bodyConsultaOcorrenciaLista).data;\n\t\tlet numInt = ocorrencias.length;\n\t\tif (numInt == 0) {\n\t\t\treturn \"ZERO\"\n\t\t}\n\t\tif (numInt == 1) {\n\t\t\treturn \"UM\"\n\t\t}\n\t\telse {\n\t\t\treturn numInt;\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"numeroDeProtocolos","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cd459105-5ad7-401e-ae0c-a6ef33f2531c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} protocolo encontrado dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} protocolo encontrado dados","action":"{{contact.extras.cpf}} | {{contact.extras.cpf}} | {{numeroProtocolo}} | {{protocoloEncontrado}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"protocoloEncontrado"}]},{"$id":"be67abfe-ef91-466e-ab03-a9f7bc67b60e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} protocolo encontrado validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} protocolo encontrado validacao","action":"{{protocoloEncontrado}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"protocoloEncontrado"}]},{"$id":"7a3ac1cd-c4fa-4572-a9e6-e93d5272cbc9","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"SPD Maquina Safrapay {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{numeroProtocolo}} | GET | {{statusConsultaProtocolo}} | {{bodyConsultaProtocolo}}"},"conditions":[]},{"$id":"d5dfafd8-6883-4d77-bd0a-bf60787616a0","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"SPD Maquina Safrapay {{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?idProtocolo={{numeroProtocolo}} | GET | {{statusConsultaProtocoloLista}} | {{bodyConsultaProtocoloLista}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-6a94f10d-b3e2-4cde-bef8-77c371b3288a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bc784fbe-c162-45aa-b00b-495a1141f0e4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-71d17c32-b9bc-43ec-808d-ea71c6289641","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-4c466357-39e5-4732-881d-60be0ed1fcab","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"e4d6612a-10e4-46cb-bb7a-fee228cb3415","root":false,"$title":"[CP.2.0.1] [HTTP] Api Consulta Status Protocolo","$position":{"top":"837px","left":"4331px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f13e7fbd-372e-45ce-a30f-de575a5cb830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"27dca3a5-7712-4630-a587-feb140493909","$typeOfContent":"","type":"SetVariable","$title":"Set userInput IF Input Not Exist","$invalid":false,"settings":{"variable":"userInput","value":"inatividade"},"conditions":[{"values":[],"source":"input","comparison":"notExists"}]},{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-f1f00684-b837-49f1-83f7-a001561b9c7f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ca296901-15e2-48c9-a410-c1b247d49532","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f13e7fbd-372e-45ce-a30f-de575a5cb830","root":false,"$title":"[Redirect] To cascata","$position":{"top":"119px","left":"3256px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"6476d17f-4f5c-4ea1-959e-0fad57cd8bc8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"076741d6-13b2-45ff-919a-dff3bda1dc37","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"44c346c4-2d0e-41e0-aa1e-63da89563f8c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6476d17f-4f5c-4ea1-959e-0fad57cd8bc8","root":false,"$title":"[GO TO] [CP.1.0.0][MSG] Inicio Protocolo","$position":{"top":"312px","left":"3930px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"635bebe1-1780-40bc-9069-2292fe9d29c4":{"$contentActions":[{"action":{"$id":"50e9f345-f01c-4419-a5fd-c9813eccfedc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3818d653-57a6-44fa-816d-bf2b8e43d968","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3818d653-57a6-44fa-816d-bf2b8e43d968","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6493ac36-7a3d-4e90-a3bf-b152d1e8ea6c","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1b46fdb-e03a-4cdc-9f02-8b9fa489f6f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"011aeeaf-900e-4f4b-95af-56c6a4169e6b","typeOfStateId":"state","$connId":"con_28","$id":"e9a15541-6359-4325-beae-5c811c715913","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1cad4baf-0b83-45eb-ac00-f3dacd10122a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Fazer nova consulta\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Ver o menu inicial\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = `Dei uma olhada aqui e não encontrei este protocolo. Verifica se o CPF que você informou é o mesmo de quem abriu o protocolo.\n\nO que você gostaria de fazer?`;\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["salesType"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f6ffe4c-9cef-400a-a402-f3fb8b5e76db","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-2ccbf303-a848-4505-af08-2522f27ea3e7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9638e32a-0e5d-4f75-b769-530d85d4d0d0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-69da5ce2-2d41-49aa-a23c-b8e2e4f64b51","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"635bebe1-1780-40bc-9069-2292fe9d29c4","root":false,"$title":"[CP.2.0.7][MSG] Como deseja prosseguir?","$position":{"top":"997.571px","left":"4913.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"011aeeaf-900e-4f4b-95af-56c6a4169e6b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d1b46fdb-e03a-4cdc-9f02-8b9fa489f6f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"921cb208-a3d7-4e7a-a484-7064959af433","typeOfStateId":"state","$connId":"con_33","$id":"d99aa798-0d98-498b-8b87-c9aeda7f3cc0","conditions":[{"source":"context","comparison":"equals","values":["Fazer nova consulta"],"variable":"userInput"}],"$invalid":false},{"stateId":"25cae0d3-7eca-4137-95df-b76ef613d04b","typeOfStateId":"state","$connId":"con_38","$id":"95f6a5b4-a27f-4ca3-b23a-b48dda40edf4","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"eb076e1b-c303-4df2-88eb-d9083b2c22bb","typeOfStateId":"state","$connId":"con_43","$id":"348d7ab5-97da-4fa7-87b0-ef95216963db","conditions":[{"source":"context","comparison":"equals","values":["Ver o menu inicial"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a244eb0d-dd86-42a9-b40b-039ebf20ad50","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"13b147fe-0ec1-440b-b844-0715b6388e4e","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"6494f030-bee4-449c-8b9c-7350ff498c97","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"cff66c25-fe11-4ba7-95ee-7c840e943aa4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-605789ae-10e0-41e9-a5d8-f60d05164e47","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-806d7de8-3de1-495e-a0bb-f223550bd105","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-dc11e673-1821-458a-bd7d-94727a9df683","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bafcf414-e46e-4a49-a76f-d486394df302","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"011aeeaf-900e-4f4b-95af-56c6a4169e6b","root":false,"$title":"[CP.2.0.7] [INPUT] Como deseja prosseguir?","$position":{"top":"1628px","left":"4913.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"25cae0d3-7eca-4137-95df-b76ef613d04b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6db7aa2-0222-4b55-a0c5-5498d09dc5a7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"25cae0d3-7eca-4137-95df-b76ef613d04b","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"1856px","left":"4915px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"921cb208-a3d7-4e7a-a484-7064959af433":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e38fd42f-e93d-4a4e-aaca-a4bd80a4eec8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"921cb208-a3d7-4e7a-a484-7064959af433","root":false,"$title":"[GO TO] S.2.0.0 Tentar Novamente","$position":{"top":"1855px","left":"5221px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eb076e1b-c303-4df2-88eb-d9083b2c22bb":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5cee436-1b27-415b-8f38-ae04973b6b99","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"eb076e1b-c303-4df2-88eb-d9083b2c22bb","root":false,"$title":"[GO TO] Redirect to Main (Menu Principal)","$position":{"top":"1861px","left":"4618px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e36dcaa0-0665-4b22-ae98-3e8605d7e557":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2152"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Principal  ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'ed2a5fb2-da6f-4961-b14d-e302fa57b991',//[PF.3.0.1][MSG] Menu Assuntos\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Principal  ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7b471ffe-0932-42e5-ad2d-6695e2b38475","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fe30cf9d-6c7e-4cf0-9c25-8f59fc6b9396","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","root":false,"$title":"[Redirect] Principal (Menu inicial)","$position":{"top":"114px","left":"3646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6816ed87-a80a-4743-b76f-0bfbafb3f80d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a960a336-a740-4c68-8bab-0967f271b0eb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"951b3eb5-7c14-4eb9-8b46-0b909846398b","typeOfStateId":"state","$connId":"con_48","$id":"4f22a19a-f779-4390-b05f-e7eac4404a8e","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"cpfLiberado"}],"$invalid":false},{"stateId":"635bebe1-1780-40bc-9069-2292fe9d29c4","typeOfStateId":"state","$connId":"con_53","$id":"9ddc9b6b-eef8-49e4-b143-606d694a7296","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"cpfLiberado"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"43e05fc3-4a2c-4d66-a98c-a1f667b4bb5d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"cpfLiberado\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaProtocolo,cpf) {\n\ttry {\n\t\tbodyConsultaProtocolo = JSON.parse(bodyConsultaProtocolo).data;\n\t\tif (cpf == bodyConsultaProtocolo.documento) {\n\t\t\treturn \"Sim\"\n\t\t}\n\t\treturn \"Não\"\n\t}\n\tcatch (e) {\n\t\treturn \"Não\"\n\t}\n}","inputVariables":["bodyConsultaProtocolo","contact.extras.cpf"],"outputVariable":"cpfLiberado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b771b12-a7a1-4bb9-935f-827d957b460f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"9c658471-98ce-4f5f-9b1a-60dba972a942","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao dados","action":"{{numeroProtocolo}} | {{contact.extras.cpf}} | {{cpfLiberado}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d69486ea-e8e7-4fc6-a090-3b4ac553d494","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d8aa2096-2421-417a-a599-2e60e5b7fb34","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"6816ed87-a80a-4743-b76f-0bfbafb3f80d","root":false,"$title":"[CP.2.0.1][SET] Cpf Liberado?","$position":{"top":"1020px","left":"4331px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"443ab8bd-9468-402d-b5d6-4c1afa3a7212":{"$contentActions":[{"action":{"$id":"03aad8d9-5b10-4bfb-b6e6-a15e05b51ce0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9b3c8634-e171-4440-80a6-fc89e34cf5ae","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b3c8634-e171-4440-80a6-fc89e34cf5ae","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a1ad81ac-b0f3-47d5-810a-5d266d27196a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4b0cde3d-c788-42f7-8623-f3df6958a7d9","type":"text/plain","content":"Por favor, digite o seu número de protocolo.\n\nComo neste exemplo:\n<b>12345678910112</b>","metadata":{}},"$cardContent":{"document":{"id":"4b0cde3d-c788-42f7-8623-f3df6958a7d9","type":"text/plain","content":"Por favor, digite o seu número de protocolo.\n\nComo neste exemplo:\n<b>12345678910112</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"eceade33-1f3d-4151-b69a-a681756f42a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"dbea5aca-16ff-48d8-94e5-1cc1c37d3356","typeOfStateId":"state","$connId":"con_58","$id":"a9dcb232-2792-47af-ac0a-494f6e5b658e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"93dcf09c-18c5-4f87-8f2d-1cb0f2041d7c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b91aab3b-916f-4e0b-91a7-adeff47f90d7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-45163ba1-b1bf-42e2-ae17-6c9114b52510","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","root":false,"$title":"[CP.2.0.0][MSG] Consulta Protocolo Númerica","$position":{"top":"106px","left":"4330.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"44c346c4-2d0e-41e0-aa1e-63da89563f8c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c20e1e53-f902-4a8c-821d-747708a4294b","typeOfStateId":"state","$connId":"con_63","$id":"94b0d318-57a3-4934-9b98-409233834812","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"e85e5032-c468-466c-accb-a81684067458","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\"","$invalid":false,"settings":{"variable":"assunto","value":"Consulta de Protocolo"},"conditions":[]},{"$id":"3da77a29-7ed8-404e-8c54-e13434044039","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"ces\"","$invalid":false,"settings":{"value":"ces","variable":"pesquisa"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8907a632-f4f9-42e1-bda5-1af99a00b67c","$typeOfContent":"","type":"SetVariable","$title":"Set msgOcorrencia CLEAR","$invalid":false,"settings":{"variable":"msgOcorrencia"},"conditions":[]},{"$id":"c9ec40e4-767f-44ba-9a7b-22e0f9fb84f6","$typeOfContent":"","type":"SetVariable","$title":"Set msgOcorrencias CLEAR","$invalid":false,"settings":{"variable":"msgOcorrencias"},"conditions":[]},{"$id":"c9171d5a-9e83-4f7a-b1e9-473bbf6d6050","$typeOfContent":"","type":"SetVariable","$title":"Set statusConsultaOcorrenciaLista CLEAR","$invalid":false,"settings":{"variable":"statusConsultaOcorrenciaLista"},"conditions":[]},{"$id":"a935f9e7-f165-41a0-b0a1-340658fa074e","$typeOfContent":"","type":"SetVariable","$title":"Set bodyConsultaOcorrenciaLista CLEAR","$invalid":false,"settings":{"variable":"bodyConsultaOcorrenciaLista"},"conditions":[]},{"$id":"715782f1-109c-412f-9e89-fbd70e40faeb","$typeOfContent":"","type":"SetVariable","$title":"Set numeroDeOcorrencias CLEAR","$invalid":false,"settings":{"variable":"numeroDeOcorrencias"},"conditions":[]},{"$id":"f931c343-4968-48d1-9cb6-a5f7010b26a0","$typeOfContent":"","type":"SetVariable","$title":"Set ocorrenciaEncontrada CLEAR","$invalid":false,"settings":{"variable":"ocorrenciaEncontrada"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a8a60854-e258-4adf-9783-519c9c863051","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3e18d738-8d26-4df3-bd25-4270cbf5b768","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"44c346c4-2d0e-41e0-aa1e-63da89563f8c","root":false,"$title":"[CP.1.0.0][MSG] Inicio Protocolo","$position":{"top":"0px","left":"6528.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c20e1e53-f902-4a8c-821d-747708a4294b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9773dbdb-c4a4-422a-a0a9-bd1f47189bcd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"50271819-701d-4321-9f69-1d3524b3dc4a","typeOfStateId":"state","$connId":"con_68","$id":"583db181-8751-48e3-ae06-352f76efa6b5","conditions":[{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d2b0312-2061-44d3-af22-25d4a301fd5d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intervaloDeDatas\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const hoje = new Date();\n    const DiasAtras = new Date();\n    DiasAtras.setDate(hoje.getDate() - 7);//Ultimos 7 dias\n    const formatarData = (data) => {\n        const ano = data.getFullYear();\n        const mes = String(data.getMonth() + 1).padStart(2, '0');\n        const dia = String(data.getDate()).padStart(2, '0');\n        return `${ano}-${mes}-${dia}`;\n    };\n    const periodo = `periodo.gte=${formatarData(DiasAtras)}&periodo.lte=${formatarData(hoje)}`;\n    return periodo;\n}","inputVariables":[],"outputVariable":"intervaloDeDatas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3ad17416-61f6-48ac-8c59-a73b7e211917","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyConsultaProtocoloLista\" (Consultar Protocolo Lista)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Correlation-ID":"{{idSessao}}","Safra-Aplicacao":"CHT"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?documentoCliente={{contact.extras.cpf}}&{{intervaloDeDatas}}","method":"GET","responseStatusVariable":"statusConsultaOcorrenciaLista","responseBodyVariable":"bodyConsultaOcorrenciaLista"},"conditions":[]},{"$id":"74af7a6f-7d3b-4346-8fda-c2e04239aec6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusConsultaOcorrenciaLista"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"68608304-18ff-40c1-b1a6-c9e306e2a544","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?documentoCliente={{contact.extras.cpf}}&{{intervaloDeDatas}} | GET | {{statusConsultaProtocoloLista}} | {{bodyConsultaProtocoloLista}}"},"conditions":[]},{"$id":"daae12b4-a4ef-4b02-ac88-5551d7406d4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a38bc161-e8bc-4707-af8f-5e48601cd747","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1a9f1803-7dcd-4963-b71e-630bd83f2b2a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-1d83e9ec-8a62-4204-b522-2660c05bc78a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"c20e1e53-f902-4a8c-821d-747708a4294b","root":false,"$title":"[CP.1.1.0] [HTTP] Consulta Ocorrencias","$position":{"top":"170.857px","left":"6528px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ed2a5fb2-da6f-4961-b14d-e302fa57b991":{"$contentActions":[{"action":{"$id":"278eb460-650c-4071-ba4d-52fa49ea806c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"fa378076-abf8-4f07-ba26-e248bab7588a","type":"text/plain","content":"Nos últimos 7 dias encontrei <b>{{numeroDeOcorrencias}}</b> protocolos.","metadata":{}},"$cardContent":{"document":{"id":"fa378076-abf8-4f07-ba26-e248bab7588a","type":"text/plain","content":"Nos últimos 7 dias encontrei <b>{{numeroDeOcorrencias}}</b> protocolos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"08c61e2c-d15f-42e3-8102-ebb442760d36","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2f9e7f20-742c-48d2-901d-373375d47540","typeOfStateId":"state","$connId":"con_73","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d7efd58a-d6d2-4cc0-b72c-c053f05bf774","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"a3ce436a-8a18-4245-92ae-8e2584bca12b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciasEncontradas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        // Order by dataHoraAbertura in ascending order\n        data.sort((a, b) => {\n            let dateA = new Date(a.dataHoraAbertura);\n            let dateB = new Date(b.dataHoraAbertura);\n            return dateA - dateB;\n        });\n        return data;\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciasEncontradas","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c884dbb2-ce1e-455e-a3c9-5d6c97a1533c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d15851eb-5480-4b14-8efc-5c1b70bc3fca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f28e7d42-ba88-4845-a215-398c2e60032f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","root":false,"$title":"[CP.2.4.0][MSG] Ocorrencias Encontradas","$position":{"top":"562.667px","left":"7069.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2277261f-1fd3-4041-ad2a-494985ee2067":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false,"$$hashKey":"object:2675"}],"$conditionOutputs":[{"stateId":"7b60ebcd-d719-48fc-b7de-d4d3e0774e1c","typeOfStateId":"state","$connId":"con_78","$id":"b1c9e975-9a1d-4abe-9282-9870c1633436","conditions":[{"source":"context","comparison":"equals","values":["Não encontrei o protocolo"],"variable":"userInput","$$hashKey":"object:2696"}],"$invalid":false,"$$hashKey":"object:2678"},{"stateId":"b370502b-e1bf-4c50-a4f1-39f401c3ba9a","typeOfStateId":"state","$connId":"con_83","$id":"b61d8545-ad87-4395-9ce8-ab94124b2db3","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput","$$hashKey":"object:2712"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput","$$hashKey":"object:2713"}],"$invalid":false,"$$hashKey":"object:2679"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, ocorrenciasEncontradas) {\n    try {\n        ocorrenciasEncontradas = JSON.parse(ocorrenciasEncontradas);\n        if (!inputUsuario) return 'inatividade'\n        if (inputUsuario == \"0\") return \"Não encontrei o protocolo\"\n        if (isNumber(inputUsuario)) {\n            let index = parseInt(inputUsuario) - 1;\n            if (index >= 0 && index < ocorrenciasEncontradas.length) {\n                return ocorrenciasEncontradas[index];\n            } else {\n                return 'input inesperado';\n            }\n        };\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}\nfunction isNumber(input) {\n    const regex = /^\\d+$/;\n    return regex.test(input);\n}","inputVariables":["input.content","ocorrenciasEncontradas"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d25ef70a-7b3c-498c-b27e-e63b3dcbb1ab","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada);\n\t\treturn ocorrenciaEncontrada;\n\t}\n\tcatch (e) {\n\t\treturn \"Não Encontrada\"\n\t}\n}","inputVariables":["userInput"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"S.2.4.0.1\"","$invalid":false,"settings":{"variable":"exceptionType","value":"S.2.4.0.1"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput","$$hashKey":"object:2897"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-295d04a5-eaf8-4820-9488-184c858b9dc1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c020570-05bd-482c-9111-fae56f7cdf17","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-067a12fc-668b-4a9f-95e7-a74b6b17af6e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8d063909-4667-459e-86af-e5ba361984b9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2277261f-1fd3-4041-ad2a-494985ee2067","root":false,"$title":"[CP.2.4.0.1][INPUT] Menu Lista de Ocorrencias","$position":{"top":"939.143px","left":"7065.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b20fb076-c6ef-4428-aa0d-84347f64c134":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4c41d929-318a-4a12-9354-3bdf63dcf68f","typeOfStateId":"state","$connId":"con_88","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Consultar 60 dias\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Fiz uma busca e nos últimos 7 dias não encontrei nenhum protocolo. Se preferir, posso te mostrar dos últimos 60 dias ou consultar um número específico.\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-222eeada-54e2-4315-9990-9f59c3a40f0c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-41dd7dab-3aa0-4d12-9faf-cf7ba3d7399b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-99acdd80-288c-4290-a17a-ed3e424b2933","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b20fb076-c6ef-4428-aa0d-84347f64c134","root":false,"$title":"[CP.2.3.1][MSG] Nenhum Protocolo","$position":{"top":"337.857px","left":"7519.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4c41d929-318a-4a12-9354-3bdf63dcf68f":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"4e9827e9-12c0-4947-814a-5c4657ca92e1","typeOfStateId":"state","$connId":"con_93","$id":"63d3e659-896e-4898-9d47-22d250699d08","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"73c400ff-6fac-4a40-9496-b33797582398","typeOfStateId":"state","$connId":"con_98","$id":"f2b14f53-bee6-4f03-9701-76da4fa528d8","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"1e1a9840-12e2-48e2-9d7a-a957dcfed181","typeOfStateId":"state","$connId":"con_103","$id":"c8e7b62b-51cd-46d5-b90d-6737d58d4dcf","conditions":[{"source":"context","comparison":"equals","values":["Consultar 60 dias"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3b0d61b5-e8de-4167-bb49-d2f2c41d2a08","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d5a824c7-8d1f-4553-8442-8b3b437d22de","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6acff6e3-2914-40ab-b110-8bb39e378d88","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9857db96-f38a-47c0-9e4e-b1de9f383740","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4c41d929-318a-4a12-9354-3bdf63dcf68f","root":false,"$title":"[CP.2.3.1][INPUT] Nenhum Protocolo","$position":{"top":"338.429px","left":"7788px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4e9827e9-12c0-4947-814a-5c4657ca92e1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8dae2f8d-827d-42f5-8b0a-4d8b022a0629","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"4e9827e9-12c0-4947-814a-5c4657ca92e1","root":false,"$title":"[GO TO] S.2.6.0 Digitar Número","$position":{"top":"617px","left":"7927px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"73c400ff-6fac-4a40-9496-b33797582398":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6db7aa2-0222-4b55-a0c5-5498d09dc5a7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"73c400ff-6fac-4a40-9496-b33797582398","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"612.429px","left":"7622px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"953ef71d-0751-4132-8abf-d93e9796d017":{"$contentActions":[{"action":{"$id":"41e88d1d-5eb3-4d58-afc3-790f0774283c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"51676aef-8b24-4bde-97ab-de677f016eeb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"51676aef-8b24-4bde-97ab-de677f016eeb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6204a6c1-eb31-4c64-b33c-31f8525d5f4b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9f2a4b4c-d38f-4459-8366-f0c96d6ff1a3","type":"text/plain","content":"Nos últimos 7 dias encontrei este protocolo.\n\nVou te mostrar o status dele.","metadata":{}},"$cardContent":{"document":{"id":"9f2a4b4c-d38f-4459-8366-f0c96d6ff1a3","type":"text/plain","content":"Nos últimos 7 dias encontrei este protocolo.\n\nVou te mostrar o status dele."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d6ba1ae-d71a-41d3-9a57-fc9cc38d90bf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"24f3ed8d-b58f-4387-9361-b21679366958","typeOfStateId":"state","$connId":"con_108","$id":"bda41ca7-cb5a-43b4-ae7c-f695a007a870","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f80eed1-ae64-4d3b-a3ed-cda2061985af","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"02d33333-0135-41b9-b32e-2b117a6e07c5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        return data[0];\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8b4d8109-63a7-4ffa-acc1-52a085dbb0f8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bae94d47-b4e0-4f91-81e8-d08e6447585c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1f62a3be-cb40-4ab6-a259-db788f6bc11c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"953ef71d-0751-4132-8abf-d93e9796d017","root":false,"$title":"[CP.2.2.1][MSG]Um Protocolo Encontrado","$position":{"top":"401px","left":"6117.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b8f75e1a-844f-4de1-bacc-0756666f4f99":{"$contentActions":[{"action":{"$id":"9dfe15ed-4061-4979-b19d-eacddba5cb83","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f758c4c6-28c6-4ac1-9c0a-a6a4901da60a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f758c4c6-28c6-4ac1-9c0a-a6a4901da60a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d08e2644-43c0-4299-9ef8-bc7978dc2d07","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f30789cb-d21b-4e3c-9d1c-839730d2f8c5","type":"text/plain","content":"{{msgOcorrencia}}","metadata":{}},"$cardContent":{"document":{"id":"f30789cb-d21b-4e3c-9d1c-839730d2f8c5","type":"text/plain","content":"{{msgOcorrencia}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2477b43e-f239-42c8-bbed-232d5d532e72","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"cdd8465a-f8d2-49ee-903d-86a90816f2a2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"221fbdcc-5904-4473-8bec-dde4034b87f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"221fbdcc-5904-4473-8bec-dde4034b87f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"cf7b3798-16dc-4735-9c5f-d6a6fb24d52c","typeOfStateId":"state","$connId":"con_113","$id":"07f3d340-804d-4c61-b873-e2a22db26c2e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"323eb431-7c73-43e6-92ce-940e2ae0e488","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"fb4dfe2f-bd40-4121-8e66-48e542086c4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\t\treturn `*Status*: ✔Encerrado\n\n${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}.${ocorrenciaEncontrada.id}\n*Aberto em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraAbertura)}\n*Fechado em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraEncerramento)}\n\n${obsExiste(ocorrenciaEncontrada.motivoResolucao)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠️Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔Encerrado\"\n\t} else {\n\t\treturn \"🔍Em análise\"\n\t}\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/0000\"\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b87042a3-c5c7-44ee-8b50-f5293bf3e9ca","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-faf3c87c-51af-48f1-b93e-a6b304a893bb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d74c08c2-cd93-400d-ac47-a71ed7f47a0e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b8f75e1a-844f-4de1-bacc-0756666f4f99","root":false,"$title":"[CP.2.2.2][MSG] Ocorrencia Encerrada","$position":{"top":"782px","left":"5895px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cea0a717-1eae-408f-948f-fc413d0c33bd":{"$contentActions":[{"action":{"$id":"6ee0a734-b070-430b-9324-15e4b5d2e119","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"124eae8e-7d62-498e-901f-f0043ddad5c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"124eae8e-7d62-498e-901f-f0043ddad5c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"63032d32-43ce-46d2-89d3-df18b8b56c5a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a7a6b601-71fd-4940-bfba-d8c2fa24bc2e","type":"text/plain","content":"{{msgOcorrencia}}","metadata":{}},"$cardContent":{"document":{"id":"a7a6b601-71fd-4940-bfba-d8c2fa24bc2e","type":"text/plain","content":"{{msgOcorrencia}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed1403fc-49a9-44a0-97d8-16cba5d08569","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"60ec71c1-d834-4085-97cb-53c38fc25f78","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1874f79b-b008-4da3-b21c-ef3e6f3e93d9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"1874f79b-b008-4da3-b21c-ef3e6f3e93d9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"5da6c41a-97cb-4e11-ac95-12981b4c8e97","typeOfStateId":"state","$connId":"con_118","$id":"4422ed4a-7f41-405c-8c62-f6aa12d13467","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7b85b0d9-3ffe-4f4b-bd5b-11ac904d9ee7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"ebf4d6ef-8f15-455c-a696-c72148ad6fcb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\n\t\treturn `*Status*: ${getStatus(ocorrenciaEncontrada.descricaoStatus)}\n\n${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}.${ocorrenciaEncontrada.id}\n*Aberto em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraAbertura)}\n*Retorno previsto*: ${getDataFormatada(ocorrenciaEncontrada.dataPrevistaEncerramento)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠️Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔Encerrado\"\n\t} else {\n\t\treturn \"🔍Em análise\"\n\t}\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/0000\"\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2d5aea10-e851-44ca-96da-ea9d286d87ae","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f5ae3835-1539-4c8d-82d4-7123a880e709","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e2c97c35-6f5c-4b6e-b7b6-848b7ad88c2a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cea0a717-1eae-408f-948f-fc413d0c33bd","root":false,"$title":"[CP.2.2.3][MSG] Ocorrencia Em Andamento","$position":{"top":"731px","left":"6546.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3fa87362-bf43-45cc-a49f-ed7a51b8e58f":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"77ec3a55-1bb8-4edf-8135-e59b9b6ba2c2","typeOfStateId":"state","$connId":"con_123","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Consultar 60 dias\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Era este o protocolo que você precisava?\n\nPosso consultar também os protocolos dos últimos 60 dias ou então se tiver um número específico, é só informar aqui.\n\nSelecione uma das opções:`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-34107199-267d-497c-9db6-0933f49312a9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3a54eb2e-fc9f-43aa-a9e2-5ab89c7f2818","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b3a0a760-6225-4bf6-8d39-214ae4306197","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3fa87362-bf43-45cc-a49f-ed7a51b8e58f","root":false,"$title":"[CP.2.2.4][MSG] Consultar Mais? (1 Ocorrencias)","$position":{"top":"1138px","left":"5639px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"77ec3a55-1bb8-4edf-8135-e59b9b6ba2c2":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"b13f4a09-dcce-4272-9a48-16f69c8b3db7","typeOfStateId":"state","$connId":"con_128","$id":"8109f2f0-4c9e-494a-80c8-843b8855dd81","conditions":[{"source":"context","comparison":"equals","values":["Consultar 60 dias"],"variable":"userInput"}],"$invalid":false},{"stateId":"b813cfdd-674b-4f6b-82d9-4c036c04f45d","typeOfStateId":"state","$connId":"con_133","$id":"ce62b26c-c12f-468e-9375-1244a9dd2c57","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"208abc39-52a5-4c49-bca6-0ff41be09e1b","typeOfStateId":"state","$connId":"con_138","$id":"40311f2f-2ad9-423b-97cf-a35e0db3af18","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-eeebe015-a692-43fc-8353-d3270701638a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b0bb866c-d2a5-4dc7-b200-0bfdc2b16675","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fb16fb11-d5ee-4004-a469-bac844f5429b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9df9affb-0cbb-422d-b157-6e6defe2b1e2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"77ec3a55-1bb8-4edf-8135-e59b9b6ba2c2","root":false,"$title":"[CP.2.2.4][INPUT] Consultar Mais? (1 Ocorrencias)","$position":{"top":"1375.25px","left":"5638.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5da6c41a-97cb-4e11-ac95-12981b4c8e97":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"80a2253d-1530-4d86-a4bd-bcc0090ae7c6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"51a41959-7fdc-4fcc-ae99-8fc67f677ec6","typeOfStateId":"state","$connId":"con_143","$id":"ac480b65-9aa3-475a-bc8b-0c24c380fd73","conditions":[{"source":"context","comparison":"equals","values":["Fora do prazo"],"variable":"dentroDoPrazo"}],"$invalid":false},{"stateId":"bed597ba-629b-4bff-8ae4-9135b1c21da3","typeOfStateId":"state","$connId":"con_148","$id":"4289372f-41cc-4ad8-9335-ef3138e2dd59","conditions":[{"source":"context","comparison":"equals","values":["Dentro do prazo"],"variable":"dentroDoPrazo"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dc0b9966-8bce-4205-965b-ae8e4773d486","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{numeroProtocolo}} | {{dentroDoPrazo}}"},"conditions":[]},{"$id":"49ddb0d3-31b5-4646-b3c0-a8a31ba36400","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dentroDoPrazo\"","$invalid":false,"settings":{"function":"run","source":"function run(ocorrenciaEncontrada) {\n    try {\n        ocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada);  \n        let dataAtual = new Date();\n        let itemAberto = ocorrenciaEncontrada;\n\n        if (itemAberto) {\n            let dataLimite = getDataFormatada(itemAberto.dataPrevistaEncerramento);\n            if (dataLimite < dataAtual) {\n                return `Fora do prazo`;\n            }\n        }\n        return `Dentro do prazo`;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\nfunction getDataFormatada(data) {\n    let dataHoraInclusao = new Date(data);\n    return dataHoraInclusao;\n};","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"dentroDoPrazo","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6ab88f20-e17d-440e-b26d-a49b04b5269b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6fd18374-13f7-4636-bd63-39d729703463","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"5da6c41a-97cb-4e11-ac95-12981b4c8e97","root":false,"$title":"[CP.2.2.5][SET] Valida SLA","$position":{"top":"984px","left":"6546px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"51a41959-7fdc-4fcc-ae99-8fc67f677ec6":{"$contentActions":[{"action":{"$id":"fae01ff2-78d7-4a1c-803e-9705d922c71a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7b88248e-8508-4d17-8ec6-24313231a67e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7b88248e-8508-4d17-8ec6-24313231a67e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e216291e-531e-4195-946c-441699fc3a34","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2aa81b5c-808a-4ae9-bba2-78d8338b6439","type":"text/plain","content":"Vi aqui que o prazo para dar um retorno já passou. Já acionei nosso time e estamos fazendo o possível para resolver o quanto antes.","metadata":{}},"$cardContent":{"document":{"id":"2aa81b5c-808a-4ae9-bba2-78d8338b6439","type":"text/plain","content":"Vi aqui que o prazo para dar um retorno já passou. Já acionei nosso time e estamos fazendo o possível para resolver o quanto antes."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1b46fdb-e03a-4cdc-9f02-8b9fa489f6f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d84bfa10-7d79-4375-af80-86eac63229a8","typeOfStateId":"state","$connId":"con_153","$id":"70ecf102-12cc-495c-8ab1-4c0a196b5766","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6548ab5a-027b-49cc-857a-3b4bbac94441","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"a87e3fb6-8488-49cf-a62a-56a32613436f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"requestComentarioOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(cpf) {\n\ttry {\n\t\treturn {\n\t\t\t\"idUsuario\": cpf,\n\t\t\t\"nomeUsuario\": cpf,\n\t\t\t\"origemAberturaOcorrencia\": \"SUSTENTACAO PJ\",\n\t\t\t\"comentario\": `Registro via chatbot WhatsApp PJ - O usuário portador do CPF: ${cpf}, solicita urgência no atendimento de sua demanda. O prazo máximo para a resolução já foi atingido, e sua situação requer atenção imediata.`\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["contact.extras.cpf"],"outputVariable":"requestComentarioOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b0e7d724-774a-40a1-ac05-bf3da939c9b8","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP POST \"bodyComentarioOcorrencia\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{idSessao}}"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{ocorrenciaEncontrada@idProtocolo}}/ocorrencias/{{ocorrenciaEncontrada@id}}/historicos","method":"POST","responseStatusVariable":"statusComentarioOcorrencia","responseBodyVariable":"bodyComentarioOcorrencia","body":"{{requestComentarioOcorrencia}}"},"conditions":[]},{"$id":"2e659540-d7a4-443c-b0cb-09ff9682176a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusComentarioOcorrencia"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87c8fa21-90d7-4ea3-bfa9-487092daefd3","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{numeroProtocolo}}/ocorrencias/{{idUltimaOcorrencia}}/historicos | POST | {{statusComentarioOcorrencia}} | {{bodyComentarioOcorrencia}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-511bf117-d64a-45c7-bf77-b3eed4ff44e3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-770e3189-0ccc-4d7b-b333-46e82f28811c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6a570333-c1d0-485b-864f-aa1aafcf424a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-cb7dd43d-a7f4-4ff8-98c6-a41b9e3a7e71","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"51a41959-7fdc-4fcc-ae99-8fc67f677ec6","root":false,"$title":"[CP.2.2.6][MSG][HTTP]Protocolo fora do Prazo","$position":{"top":"1181.43px","left":"6426.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"bed597ba-629b-4bff-8ae4-9135b1c21da3":{"$contentActions":[{"action":{"$id":"13d18022-762f-4806-ba88-f201a115da0b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fd821cfb-121e-42e6-9ae7-e92f92ad123e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fd821cfb-121e-42e6-9ae7-e92f92ad123e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b85ed1ed-64c1-4100-a727-efe77413443a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6ca88c3d-9a7f-435c-b01c-e86be2bd31b1","type":"text/plain","content":"Por aqui, estou trabalhando para te dar um retorno o quanto antes, e isso pode ocorrer até às 23:59 da data prevista.","metadata":{}},"$cardContent":{"document":{"id":"6ca88c3d-9a7f-435c-b01c-e86be2bd31b1","type":"text/plain","content":"Por aqui, estou trabalhando para te dar um retorno o quanto antes, e isso pode ocorrer até às 23:59 da data prevista."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"97c334c5-7414-4c06-885d-ad54444c8a0b","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d84bfa10-7d79-4375-af80-86eac63229a8","typeOfStateId":"state","$connId":"con_158","$id":"a319b6a0-0957-40d4-ba1c-8c49ad71e255","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fa2e76ef-acee-4d0c-991c-54eee525880b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-38332581-f17a-483b-9fff-a891ca58c117","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c90ff07a-5a14-4ce5-b9e6-441d54a3657b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bed597ba-629b-4bff-8ae4-9135b1c21da3","root":false,"$title":"[CP.2.2.7][MSG] Dentro do Prazo","$position":{"top":"1187.43px","left":"6678.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d84bfa10-7d79-4375-af80-86eac63229a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6db7aa2-0222-4b55-a0c5-5498d09dc5a7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d84bfa10-7d79-4375-af80-86eac63229a8","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"1434.43px","left":"6536.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"24f3ed8d-b58f-4387-9361-b21679366958":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d6ba1ae-d71a-41d3-9a57-fc9cc38d90bf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b8f75e1a-844f-4de1-bacc-0756666f4f99","typeOfStateId":"state","$connId":"con_163","$id":"eecef03a-cfc5-4f3f-a5c8-5971e35f482f","conditions":[{"source":"context","comparison":"equals","values":["ENCERRADO"],"variable":"ocorrenciaEncontrada@descricaoStatus"}],"$invalid":false},{"stateId":"cea0a717-1eae-408f-948f-fc413d0c33bd","typeOfStateId":"state","$connId":"con_168","$id":"033b187e-cecd-40ef-a5b4-ce63a156cd38","conditions":[{"source":"context","comparison":"notEquals","values":["ENCERRADO"],"variable":"ocorrenciaEncontrada@descricaoStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0456f120-30d8-494e-9a32-bc69801f3bb9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"ef0dc948-6a89-4638-a70f-27566c075292","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{ocorrenciaEncontrada@descricaoStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"ocorrenciaEncontrada@descricaoStatus"}]},{"$id":"0190499d-610e-47e1-af2d-60f4c51424b3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"consolidado protocolos exibidos dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"consolidado protocolos exibidos dados","action":"{{contact.identity}} | {{contact.extras.cpf}} | {{contact.extras.cpf}} | {{ocorrenciaEncontrada}} | {{calendar.datetime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2cf46d34-2136-4903-ba18-74f5b45d3074","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"24f3ed8d-b58f-4387-9361-b21679366958","root":false,"$title":"[CP.2.2.1.1][SET] Status da Ocorrencia","$position":{"top":"592px","left":"6118.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b370502b-e1bf-4c50-a4f1-39f401c3ba9a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8f19c9d7-dfe4-440f-b045-9ccf70498687","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"24f3ed8d-b58f-4387-9361-b21679366958","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"b370502b-e1bf-4c50-a4f1-39f401c3ba9a","root":false,"$title":"[GO TO] [CP.2.2.1.1][SET] Status da Ocorrencia","$position":{"top":"1100.33px","left":"7310.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cf7b3798-16dc-4735-9c5f-d6a6fb24d52c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2477b43e-f239-42c8-bbed-232d5d532e72","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3fa87362-bf43-45cc-a49f-ed7a51b8e58f","typeOfStateId":"state","$connId":"con_173","$id":"07f3d340-804d-4c61-b873-e2a22db26c2e","conditions":[{"source":"context","comparison":"equals","values":["UM"],"variable":"numeroDeOcorrencias"}],"$invalid":false},{"stateId":"bdd88035-84e9-4158-bf83-76ae9a17b5c3","typeOfStateId":"state","$connId":"con_178","$id":"855b41fc-402c-48a8-8257-e4fd0b855374","conditions":[{"source":"context","comparison":"notEquals","values":["UM"],"variable":"numeroDeOcorrencias"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"208184ec-1837-45d3-8ed8-c4d2e0a72501","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"fb4dfe2f-bd40-4121-8e66-48e542086c4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\t\treturn `*Status*: ✔${ocorrenciaEncontrada.descricaoStatus}}\n\n${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}.${ocorrenciaEncontrada.id}\n*Aberto em*: ${ocorrenciaEncontrada.dataHoraAbertura}\n*Fechado em*: ${ocorrenciaEncontrada.dataHoraEncerramento}\n\n${obsExiste(ocorrenciaEncontrada.motivoResolucao)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"26353d42-e30e-41ac-a3b3-c2093aa660be","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{numeroDeOcorrencias}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"numeroDeOcorrencias"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-eb195c2f-580e-4ec0-80c7-1018939cdcfd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-183ab54d-58f1-4307-b7cf-d1119e5eaa8b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"cf7b3798-16dc-4735-9c5f-d6a6fb24d52c","root":false,"$title":"[CP.2.2.2.2][SET] Quantidade de ocorrencia","$position":{"top":"968.857px","left":"5894px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bdd88035-84e9-4158-bf83-76ae9a17b5c3":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c154973d-aa74-4d66-be83-26620674ac23","typeOfStateId":"state","$connId":"con_183","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Consultar 60 dias\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Era este o protocolo que você precisava?\n\nPosso consultar também os protocolos dos últimos 60 dias ou então se tiver um número específico, é só informar aqui.\n\nSelecione uma das opções:`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8371d86e-6b2f-4632-9806-4cea6905cdc7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-68e68277-bc01-4672-b85d-d045d0cf5c0f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ef4897a4-a3e7-45da-94ba-447b79e07b56","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bdd88035-84e9-4158-bf83-76ae9a17b5c3","root":false,"$title":"[CP.2.2.7][MSG] Consultar Mais? (+ Ocorrencias)","$position":{"top":"1167.5px","left":"6085.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c154973d-aa74-4d66-be83-26620674ac23":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"6782f8e2-b0f2-47ab-8d2e-9c72eb6940a5","typeOfStateId":"state","$connId":"con_188","$id":"b7b46bbd-a7fa-4c42-879d-5f3288b4edef","conditions":[{"source":"context","comparison":"equals","values":["Ver opções novamente"],"variable":"userInput"}],"$invalid":false},{"stateId":"b13f4a09-dcce-4272-9a48-16f69c8b3db7","typeOfStateId":"state","$connId":"con_193","$id":"e72ab1ae-f6a0-4131-834d-21eaf1bf46cc","conditions":[{"source":"context","comparison":"equals","values":["Consultar 60 dias"],"variable":"userInput"}],"$invalid":false},{"stateId":"b813cfdd-674b-4f6b-82d9-4c036c04f45d","typeOfStateId":"state","$connId":"con_198","$id":"4450d719-e5cb-4d3f-9bb9-8979f48aee70","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"d84bfa10-7d79-4375-af80-86eac63229a8","typeOfStateId":"state","$connId":"con_203","$id":"7405dc3b-e48a-49bf-ad44-bc502c0febe0","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-522fd935-a531-464d-b707-96873b26f36a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-eed514c1-d476-48da-8a80-d826e05011ce","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-99516146-32cb-41e6-8f4e-8442e3cfa88d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3c284bae-3f0a-4900-87bf-021f4801978b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c154973d-aa74-4d66-be83-26620674ac23","root":false,"$title":"[CP.2.2.7][INPUT] Consultar Mais?  (+ Ocorrencias)","$position":{"top":"1370px","left":"6085px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b60ebcd-d719-48fc-b7de-d4d3e0774e1c":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c7786c74-a114-4419-9c16-ddf9441827d4","typeOfStateId":"state","$connId":"con_208","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Consultar 60 dias\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Entendi que você não encontrou o protocolo.\n\nPosso consultar também os protocolos dos últimos 60 dias ou então se você tiver o número específico, é só informar aqui.`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1f80a51-24fe-455b-af8f-f85ca77ea9c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-caa66eb8-deaf-4f0b-99db-3e709ba66cba","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0f591949-3016-461d-a37c-e77c4ab31aaa","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7b60ebcd-d719-48fc-b7de-d4d3e0774e1c","root":false,"$title":"[CP.2.4.1][MSG] Não encontrei o protocolo","$position":{"top":"1195.29px","left":"7066.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7786c74-a114-4419-9c16-ddf9441827d4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"20f8349e-19b6-4b1b-a83b-b16925671a32","typeOfStateId":"state","$connId":"con_213","$id":"cb511aa0-66b0-4987-b333-6301c6428ede","conditions":[{"source":"context","comparison":"equals","values":["Consultar 60 dias"],"variable":"userInput"}],"$invalid":false},{"stateId":"6d78d9f9-c648-4768-a4da-254606bad9e9","typeOfStateId":"state","$connId":"con_218","$id":"180780cc-9cda-40f0-ae70-68a51a3075db","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"35f56c8b-ee11-4cec-8af7-19d8a2923524","typeOfStateId":"state","$connId":"con_223","$id":"af7ebdb5-5d19-4f54-9414-7d9244b1a301","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6f61a4b1-eb29-4f12-9768-b77a099edc5c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-870e9f8e-3935-407a-8074-5b7a7b139988","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a9d3820f-1dfd-45a5-a599-136fa5594b3a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-463a323e-bb28-4ff4-ae06-e190a00e253f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c7786c74-a114-4419-9c16-ddf9441827d4","root":false,"$title":"[CP.2.4.1][INPUT] Não encontrei o protocolo","$position":{"top":"1527.29px","left":"7066.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20f8349e-19b6-4b1b-a83b-b16925671a32":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2dcb179d-c0df-419f-9d6f-cd3bf916613f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1e1a9840-12e2-48e2-9d7a-a957dcfed181","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"20f8349e-19b6-4b1b-a83b-b16925671a32","root":false,"$title":"[GO TO] [CP.2.7.0] [HTTP] Consulta Ocorrencias (60)","$position":{"top":"1790.29px","left":"7392.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6d78d9f9-c648-4768-a4da-254606bad9e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1347e9b7-7b4c-4cdb-bee2-72392190d012","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6d78d9f9-c648-4768-a4da-254606bad9e9","root":false,"$title":"[GO TO][CP.2.6.0][MSG] Consulta Protocolo Númerica","$position":{"top":"1780px","left":"7066px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"35f56c8b-ee11-4cec-8af7-19d8a2923524":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c4631998-71ca-45cd-90bc-95149e7f8af0","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"35f56c8b-ee11-4cec-8af7-19d8a2923524","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"1785.29px","left":"6740.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b13f4a09-dcce-4272-9a48-16f69c8b3db7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d84314f2-d464-4acd-83a8-d0189286de1f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1e1a9840-12e2-48e2-9d7a-a957dcfed181","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"b13f4a09-dcce-4272-9a48-16f69c8b3db7","root":false,"$title":"[GO TO] [CP.2.7.0] [HTTP] Consulta Ocorrencias (60)","$position":{"top":"2062.33px","left":"5868.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b813cfdd-674b-4f6b-82d9-4c036c04f45d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ae15ca15-5edf-4c65-8a8d-ecf5ecb96fd2","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"b813cfdd-674b-4f6b-82d9-4c036c04f45d","root":false,"$title":"[GO TO][CP.2.6.0][MSG] Consulta Protocolo Númerica","$position":{"top":"1620.86px","left":"5880.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"208abc39-52a5-4c49-bca6-0ff41be09e1b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"91fd6d8a-6980-4e0c-863c-7e814800fb5f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"208abc39-52a5-4c49-bca6-0ff41be09e1b","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"1633px","left":"5507.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6782f8e2-b0f2-47ab-8d2e-9c72eb6940a5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9431fae3-5cad-41ed-9d56-b6e3cf809122","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6782f8e2-b0f2-47ab-8d2e-9c72eb6940a5","root":false,"$title":"[GO TO] [CP.2.4.0][MSG] Menu Lista de Ocorrencias","$position":{"top":"1650.67px","left":"6217.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c192ff0b-f855-4c5e-b70f-991686d31f91":{"$contentActions":[{"action":{"$id":"ffd278b3-bcdb-4346-9e08-abfb5a0b0457","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5563f456-d911-4ae9-93b7-a52ea9327a76","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5563f456-d911-4ae9-93b7-a52ea9327a76","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"72a4f543-a6a1-4f9a-a65e-d385220bb628","$typeOfContent":"text","type":"SendMessage","settings":{"id":"22c557b4-dbe5-4741-ba35-8fed2a46c0af","type":"text/plain","content":"Aguarde só um momento, estou consultando as informações dele.","metadata":{}},"$cardContent":{"document":{"id":"22c557b4-dbe5-4741-ba35-8fed2a46c0af","type":"text/plain","content":"Aguarde só um momento, estou consultando as informações dele."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"09491573-193d-4807-87e5-4c02db01b07c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4d6612a-10e4-46cb-bb7a-fee228cb3415","typeOfStateId":"state","$connId":"con_228","$id":"816ea16f-488e-4219-9b42-c96c99388294","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"00c6007d-7c88-4bc5-b3f7-0c51e2630bdc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bddcaabf-17de-48d6-a086-faccf301e0b6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c66deb2f-c956-45f6-97f9-ea105460e505","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c192ff0b-f855-4c5e-b70f-991686d31f91","root":false,"$title":"[CP.2.6.0][MSG] Aguarde um momento","$position":{"top":"631px","left":"4331.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"50271819-701d-4321-9f69-1d3524b3dc4a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9773dbdb-c4a4-422a-a0a9-bd1f47189bcd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b20fb076-c6ef-4428-aa0d-84347f64c134","typeOfStateId":"state","$connId":"con_233","$id":"583db181-8751-48e3-ae06-352f76efa6b5","conditions":[{"source":"context","comparison":"equals","values":["ZERO"],"variable":"numeroDeOcorrencias"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"953ef71d-0751-4132-8abf-d93e9796d017","typeOfStateId":"state","$connId":"con_238","$id":"2980b334-72d8-4d37-8212-ef2d5c6bea5a","conditions":[{"source":"context","comparison":"equals","values":["UM"],"variable":"numeroDeOcorrencias"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","typeOfStateId":"state","$connId":"con_243","$id":"9204d041-1b22-4a0f-965f-b23dd7c74c65","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"},{"values":["2"],"source":"context","comparison":"greaterThanOrEquals","variable":"numeroDeOcorrencias"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"01c44938-7635-4891-8045-310ee759323f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{numeroDeOcorrencias}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"numeroDeOcorrencias"}]},{"$id":"47813d4f-dcea-4290-9394-935e11346710","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroDeOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(bodyConsultaOcorrenciaLista) {\n\ttry {\n\t\tlet ocorrencias = JSON.parse(bodyConsultaOcorrenciaLista).data;\n\t\tlet numInt = ocorrencias.length;\n\t\tif (numInt == 0) {\n\t\t\treturn \"ZERO\"\n\t\t}\n\t\tif (numInt == 1) {\n\t\t\treturn \"UM\"\n\t\t}\n\t\telse {\n\t\t\treturn numInt;\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"numeroDeOcorrencias","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-31da3303-d8cd-4b84-b8d5-bcaa99e5eea5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4f54ef64-06f8-4c60-ab57-c419f6b56ab4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"50271819-701d-4321-9f69-1d3524b3dc4a","root":false,"$title":"[CP.2.1.1][SET] Quantidade de Ocorrencias?","$position":{"top":"350.714px","left":"6528.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"951b3eb5-7c14-4eb9-8b46-0b909846398b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9773dbdb-c4a4-422a-a0a9-bd1f47189bcd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"635bebe1-1780-40bc-9069-2292fe9d29c4","typeOfStateId":"state","$connId":"con_248","$id":"583db181-8751-48e3-ae06-352f76efa6b5","conditions":[{"source":"context","comparison":"equals","values":["ZERO"],"variable":"numeroDeOcorrencias"}],"$invalid":false},{"stateId":"6cd5fdb5-6ad7-4ec2-b6be-3ed6e1544ad2","typeOfStateId":"state","$connId":"con_253","$id":"2980b334-72d8-4d37-8212-ef2d5c6bea5a","conditions":[{"source":"context","comparison":"equals","values":["UM"],"variable":"numeroDeOcorrencias"}],"$invalid":false},{"stateId":"43c69686-4102-4eed-a62b-920ad0f58610","typeOfStateId":"state","$connId":"con_258","$id":"9204d041-1b22-4a0f-965f-b23dd7c74c65","conditions":[{"values":["2"],"source":"context","comparison":"greaterThanOrEquals","variable":"numeroDeOcorrencias"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a6d10c7f-ec89-4032-895c-8d76be14967e","$typeOfContent":"","type":"SetVariable","$title":"Set numeroDeOcorrenciasCLEAR","$invalid":false,"settings":{"variable":"numeroDeOcorrencias"},"conditions":[]},{"$id":"47e42f67-b3d1-42c9-acca-3a6e7c1f6d5e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"47813d4f-dcea-4290-9394-935e11346710","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroDeOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(bodyConsultaOcorrenciaLista) {\n\ttry {\n\t\tlet ocorrencias = JSON.parse(bodyConsultaOcorrenciaLista).data;\n\t\tlet numInt = ocorrencias.length;\n\t\tif (numInt == 0) {\n\t\t\treturn \"ZERO\"\n\t\t}\n\t\tif (numInt == 1) {\n\t\t\treturn \"UM\"\n\t\t}\n\t\telse {\n\t\t\treturn numInt;\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"numeroDeOcorrencias","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0b4a2e53-3aa3-4700-89aa-6cf065af58b6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{numeroDeProtocolos}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"numeroDeProtocolos"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6654659d-28b3-488e-a14c-3eaf114006d9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c8b59ce5-8605-4798-b03b-4d66affdf514","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1559917d-6d05-4726-bba9-542e70952276","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"951b3eb5-7c14-4eb9-8b46-0b909846398b","root":false,"$title":"[CP.2.0.2][SET] Quantidade de Ocorrencias?","$position":{"top":"1217.57px","left":"4331.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0c32b967-ca59-4e42-8cd3-f9681597ca8f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dc1b2d41-452b-46ab-9331-4edc7ae553aa","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"24f3ed8d-b58f-4387-9361-b21679366958","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"0c32b967-ca59-4e42-8cd3-f9681597ca8f","root":false,"$title":"[GO TO] [CP.2.2.1.1][SET] Status da Ocorrencia","$position":{"top":"1679px","left":"4199px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"17076c47-4726-49c5-b63f-eec49c4be9d9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2d19da6a-a4e4-406a-bc91-774b1ececa09","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2f9e7f20-742c-48d2-901d-373375d47540","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"17076c47-4726-49c5-b63f-eec49c4be9d9","root":false,"$title":"[GO TO] [CP.2.4.0.1][MSG] Menu Lista de Ocorrencias","$position":{"top":"1670px","left":"4431px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e1a9840-12e2-48e2-9d7a-a957dcfed181":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9773dbdb-c4a4-422a-a0a9-bd1f47189bcd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"db3e0233-6506-41f8-84fa-9fdf9a88e799","typeOfStateId":"state","$connId":"con_263","$id":"583db181-8751-48e3-ae06-352f76efa6b5","conditions":[{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d2b0312-2061-44d3-af22-25d4a301fd5d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intervaloDeDatas\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const hoje = new Date();\n    const DiasAtras = new Date();\n    DiasAtras.setDate(hoje.getDate() - 60);//Ultimos 60 dias\n    const formatarData = (data) => {\n        const ano = data.getFullYear();\n        const mes = String(data.getMonth() + 1).padStart(2, '0');\n        const dia = String(data.getDate()).padStart(2, '0');\n        return `${ano}-${mes}-${dia}`;\n    };\n    const periodo = `periodo.gte=${formatarData(DiasAtras)}&periodo.lte=${formatarData(hoje)}`;\n    return periodo;\n}","inputVariables":[],"outputVariable":"intervaloDeDatas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3ad17416-61f6-48ac-8c59-a73b7e211917","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyConsultaProtocoloLista\" (Consultar Protocolo Lista)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Correlation-ID":"{{idSessao}}","Safra-Aplicacao":"CHT"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?documentoCliente={{contact.extras.cpf}}&{{intervaloDeDatas}}","method":"GET","responseStatusVariable":"statusConsultaOcorrenciaLista","responseBodyVariable":"bodyConsultaOcorrenciaLista"},"conditions":[]},{"$id":"74af7a6f-7d3b-4346-8fda-c2e04239aec6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusConsultaOcorrenciaLista"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"68608304-18ff-40c1-b1a6-c9e306e2a544","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?documentoCliente={{contact.extras.cpf}}&{{intervaloDeDatas}} | GET | {{statusConsultaProtocoloLista}} | {{bodyConsultaProtocoloLista}}"},"conditions":[]},{"$id":"daae12b4-a4ef-4b02-ac88-5551d7406d4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-40c4caa8-c171-4c04-8ac3-716e91543ab0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-17e44608-d5a5-42b1-b001-cc2a7754b4c2","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5da37387-b671-423b-b601-7a570dcd3dc9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"1e1a9840-12e2-48e2-9d7a-a957dcfed181","root":false,"$title":"[CP.2.7.0] [HTTP] Consulta Ocorrencias (60 Dias)","$position":{"top":"434.333px","left":"9281.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"db3e0233-6506-41f8-84fa-9fdf9a88e799":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9773dbdb-c4a4-422a-a0a9-bd1f47189bcd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a7e3a216-305d-44a8-9b77-12a033d47ca1","typeOfStateId":"state","$connId":"con_268","$id":"583db181-8751-48e3-ae06-352f76efa6b5","conditions":[{"source":"context","comparison":"equals","values":["ZERO"],"variable":"numeroDeOcorrencias"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"75347694-6b2e-4ad9-8154-4db70e6385be","typeOfStateId":"state","$connId":"con_273","$id":"2980b334-72d8-4d37-8212-ef2d5c6bea5a","conditions":[{"source":"context","comparison":"equals","values":["UM"],"variable":"numeroDeOcorrencias"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"afaddf71-ba7c-4292-bd62-84f094c25c3f","typeOfStateId":"state","$connId":"con_278","$id":"9204d041-1b22-4a0f-965f-b23dd7c74c65","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"},{"values":["2"],"source":"context","comparison":"greaterThanOrEquals","variable":"numeroDeOcorrencias"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47813d4f-dcea-4290-9394-935e11346710","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroDeOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(bodyConsultaOcorrenciaLista) {\n\ttry {\n\t\tlet ocorrencias = JSON.parse(bodyConsultaOcorrenciaLista).data;\n\t\tlet numInt = ocorrencias.length;\n\t\tif (numInt == 0) {\n\t\t\treturn \"ZERO\"\n\t\t}\n\t\tif (numInt == 1) {\n\t\t\treturn \"UM\"\n\t\t}\n\t\telse {\n\t\t\treturn numInt;\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"numeroDeOcorrencias","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ee1dfac9-67fc-4a08-96dc-5fc8c4e2d6e1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{numeroDeOcorrencias}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"numeroDeOcorrencias"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"44c346c4-2d0e-41e0-aa1e-63da89563f8c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-20e356c8-d8dd-4f7c-b864-22cc523084c1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9705564c-62a1-41d7-99bc-2ce3aaafef8e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"db3e0233-6506-41f8-84fa-9fdf9a88e799","root":false,"$title":"[CP.2.7.1][SET] Quantidade de Ocorrencias?","$position":{"top":"719.333px","left":"9281.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a7e3a216-305d-44a8-9b77-12a033d47ca1":{"$contentActions":[{"action":{"$id":"be8d165c-339f-41aa-9862-323eac1b4bee","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e4e14dc8-273d-472e-aab5-a01595489bc6","type":"text/plain","content":"Não encontrei nenhum protocolo nos últimos 60 dias. Se precisar consultar acima deste período, é só falar com a central de atendimento:\n\nCapital e Grande São paulo:\n(11) 3175-8248\n\nDemais localidades:\n0300 015 7575","metadata":{}},"$cardContent":{"document":{"id":"e4e14dc8-273d-472e-aab5-a01595489bc6","type":"text/plain","content":"Não encontrei nenhum protocolo nos últimos 60 dias. Se precisar consultar acima deste período, é só falar com a central de atendimento:\n\nCapital e Grande São paulo:\n(11) 3175-8248\n\nDemais localidades:\n0300 015 7575"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"action":{"$id":"a5d08b2a-b09d-4c6c-a933-d4799f4f5a4a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7b48284-de14-44b3-b897-d44ea8da822a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7b48284-de14-44b3-b897-d44ea8da822a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bdb96c32-f606-4787-8286-8b2bf8e82366","typeOfStateId":"state","$connId":"con_283","$id":"7656f80c-1054-4653-bf8d-4f83cad382b5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Você gostaria de consultar outro protocolo?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-430d5d0a-ce67-41a7-8843-8fd11fe21911","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a42eab38-a9cd-4b42-bcf4-f60484a1b444","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-be6d7335-17f4-4944-a1ad-db192bf1c093","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a7e3a216-305d-44a8-9b77-12a033d47ca1","root":false,"$title":"[CP.2.7.2][MSG] Nenhum Protocolo","$position":{"top":"830.333px","left":"9740.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75347694-6b2e-4ad9-8154-4db70e6385be":{"$contentActions":[{"action":{"$id":"41e88d1d-5eb3-4d58-afc3-790f0774283c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"51676aef-8b24-4bde-97ab-de677f016eeb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"51676aef-8b24-4bde-97ab-de677f016eeb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6204a6c1-eb31-4c64-b33c-31f8525d5f4b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9f2a4b4c-d38f-4459-8366-f0c96d6ff1a3","type":"text/plain","content":"Nos últimos 60 dias encontrei este protocolo.\n\nVou te mostrar o status dele.","metadata":{}},"$cardContent":{"document":{"id":"9f2a4b4c-d38f-4459-8366-f0c96d6ff1a3","type":"text/plain","content":"Nos últimos 60 dias encontrei este protocolo.\n\nVou te mostrar o status dele."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d6ba1ae-d71a-41d3-9a57-fc9cc38d90bf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"670f932a-db69-4a9f-a3c7-2183b01b4527","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b1a74c68-0b02-4072-9644-7aeaf058b576","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"b1a74c68-0b02-4072-9644-7aeaf058b576","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"425a0975-5ebc-4885-bc03-71fb3126b93e","typeOfStateId":"state","$connId":"con_288","$id":"b563a935-fe00-4b9b-9943-e56f7d15cf2b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"02d33333-0135-41b9-b32e-2b117a6e07c5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        return data[0];\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7f347294-b292-42bc-8356-f38662f78f97","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"8f751f93-e436-47e4-ac01-82c6f0670d33","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        return data[0];\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2df7b900-ed0a-4b64-809c-b1f19a51a3cc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c54fc636-693d-434d-b834-0a9e97bbf399","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-acbbebe9-1482-4e4f-b4f5-b397e3df350c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"75347694-6b2e-4ad9-8154-4db70e6385be","root":false,"$title":"[CP.2.7.3][MSG]Um Protocolo Encontrado","$position":{"top":"882px","left":"8218px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2f9e7f20-742c-48d2-901d-373375d47540":{"$contentActions":[{"action":{"$id":"ec36bddf-845f-4420-b691-66f0faaca720","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1656ae3d-ba81-48cd-bf9b-48c2d0c017e4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1656ae3d-ba81-48cd-bf9b-48c2d0c017e4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5018e172-a94f-4630-8fbb-89ba1c22bbed","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9fbb2f01-c5d1-44f5-9ffe-791a452ef0b5","type":"text/plain","content":"{{msgOcorrencias}}","metadata":{}},"$cardContent":{"document":{"id":"9fbb2f01-c5d1-44f5-9ffe-791a452ef0b5","type":"text/plain","content":"{{msgOcorrencias}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"08c61e2c-d15f-42e3-8102-ebb442760d36","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2277261f-1fd3-4041-ad2a-494985ee2067","typeOfStateId":"state","$connId":"con_293","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"19fb62e0-2c58-49c9-98fa-a96809a19a9c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"79114b61-ccff-4813-b7a9-f9f04043211c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"function run(ocorrenciasEncontradas) {\n    try {\n        ocorrenciasEncontradas = JSON.parse(ocorrenciasEncontradas);\n        let msg = \"De qual protocolo você quer ver mais detalhes? É só informar o número da opção, exemplo: *4*.\\n\";\n        for (let index = 0; index < ocorrenciasEncontradas.length; index++) {\n            msg += `\\n*${index + 1}*- ${ocorrenciasEncontradas[index].descricaoMotivo} - ${ocorrenciasEncontradas[index].descricaoSubmotivo}\nStatus: ${getStatus(ocorrenciasEncontradas[index].descricaoStatus)}\\n`;\n        }\n        msg += \"\\n*0*- Não encontrei o protocolo\"\n        return msg;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠️Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔Encerrado\"\n\t} else {\n\t\treturn \"🔍Em análise\"\n\t}\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/0000\"\n}","inputVariables":["ocorrenciasEncontradas"],"outputVariable":"msgOcorrencias","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-655ddb9b-4f0e-4219-a21f-504a20e322e1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-21f891cb-f368-4682-bf0e-af08cecb1ede","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4f44ac15-76ea-41dc-849b-5281d6e8c797","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"2f9e7f20-742c-48d2-901d-373375d47540","root":false,"$title":"[CP.2.4.0.1][MSG] Menu Lista de Ocorrencias","$position":{"top":"762.333px","left":"7069px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bdb96c32-f606-4787-8286-8b2bf8e82366":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e24c7f95-43c3-4696-88c5-59a276026c33","typeOfStateId":"state","$connId":"con_298","$id":"98d1c851-3cf7-4df3-a47c-2d9423783007","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"e0f75aea-a61d-40d9-8667-71f6d13835a1","typeOfStateId":"state","$connId":"con_303","$id":"178169cc-d0f1-45d3-a43c-3db31af2a3b3","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-97f922d9-fb23-4123-b2c9-1257ec692c67","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b04bcaf0-fb41-48f3-b82c-a05e89c10cce","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e240af08-d851-4662-b5d5-1c76586dec35","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bbeb3e70-77ca-4573-9c03-5f3e2581c384","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bdb96c32-f606-4787-8286-8b2bf8e82366","root":false,"$title":"[CP.2.7.2][INPUT] Nenhum Protocolo","$position":{"top":"1098.33px","left":"9738.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e24c7f95-43c3-4696-88c5-59a276026c33":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ae188bc8-2f91-48d4-aca2-47e42e3a1abe","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e24c7f95-43c3-4696-88c5-59a276026c33","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"1335.33px","left":"9590.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e0f75aea-a61d-40d9-8667-71f6d13835a1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8509510f-8aee-4e76-8977-dd641a745b2c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e0f75aea-a61d-40d9-8667-71f6d13835a1","root":false,"$title":"[GO TO][CP.2.6.0][MSG] Consulta Protocolo Númerica","$position":{"top":"1353.33px","left":"9938.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"afaddf71-ba7c-4292-bd62-84f094c25c3f":{"$contentActions":[{"action":{"$id":"278eb460-650c-4071-ba4d-52fa49ea806c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"fa378076-abf8-4f07-ba26-e248bab7588a","type":"text/plain","content":"Nos últimos 60 dias encontrei <b>{{numeroDeOcorrencias}}</b> protocolos.","metadata":{}},"$cardContent":{"document":{"id":"fa378076-abf8-4f07-ba26-e248bab7588a","type":"text/plain","content":"Nos últimos 60 dias encontrei <b>{{numeroDeOcorrencias}}</b> protocolos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"08c61e2c-d15f-42e3-8102-ebb442760d36","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3bf351da-2cbf-4efd-82b1-7c9ab791a63a","typeOfStateId":"state","$connId":"con_308","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"62daa057-8562-4e93-b11e-94f5fcfd548e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"196eed98-6a5e-46e6-9b76-5c77976b8716","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciasEncontradas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        // Order by dataHoraAbertura in ascending order\n        data.sort((a, b) => {\n            let dateA = new Date(a.dataHoraAbertura);\n            let dateB = new Date(b.dataHoraAbertura);\n            return dateA - dateB;\n        });\n        return data;\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciasEncontradas","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-da351666-b8dc-4e43-9823-10c09826fbab","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9c35bd02-2c05-446f-b5a3-1aa2f7aa8e8f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-334b65f9-3501-432f-9614-5d71ffa372c8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"afaddf71-ba7c-4292-bd62-84f094c25c3f","root":false,"$title":"[CP.2.7.3][MSG] Ocorrencias Encontradas","$position":{"top":"988.333px","left":"9281.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3bf351da-2cbf-4efd-82b1-7c9ab791a63a":{"$contentActions":[{"action":{"$id":"ec36bddf-845f-4420-b691-66f0faaca720","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1656ae3d-ba81-48cd-bf9b-48c2d0c017e4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1656ae3d-ba81-48cd-bf9b-48c2d0c017e4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5018e172-a94f-4630-8fbb-89ba1c22bbed","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9fbb2f01-c5d1-44f5-9ffe-791a452ef0b5","type":"text/plain","content":"{{msgOcorrencias}}","metadata":{}},"$cardContent":{"document":{"id":"9fbb2f01-c5d1-44f5-9ffe-791a452ef0b5","type":"text/plain","content":"{{msgOcorrencias}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"08c61e2c-d15f-42e3-8102-ebb442760d36","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c239d8bb-8cc5-42a6-9db2-127459f9595a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9be3021a-bd89-4920-8921-aeae75d4004e","typeOfStateId":"state","$connId":"con_313","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9d75f244-5296-4da9-a901-17a24f0c78fa","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"79114b61-ccff-4813-b7a9-f9f04043211c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"function run(ocorrenciasEncontradas) {\n    try {\n        ocorrenciasEncontradas = JSON.parse(ocorrenciasEncontradas);\n        let msg = \"De qual protocolo você quer ver mais detalhes? É só informar o número da opção, exemplo: *4*.\\n\";\n        for (let index = 0; index < ocorrenciasEncontradas.length; index++) {\n            msg += `\\n*${index + 1}*- ${ocorrenciasEncontradas[index].descricaoMotivo} - ${ocorrenciasEncontradas[index].descricaoSubmotivo}\nStatus: ${getStatus(ocorrenciasEncontradas[index].descricaoStatus)}\\n`;\n        }\n        msg += \"\\n*0*- Não encontrei o protocolo\"\n        return msg;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠️Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔Encerrado\"\n\t} else {\n\t\treturn \"🔍Em análise\"\n\t}\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/0000\"\n}","inputVariables":["ocorrenciasEncontradas"],"outputVariable":"msgOcorrencias","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9f4d81e3-6b4c-4e5c-b8be-1433c5cf1133","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-193b0fff-15da-4c5c-917c-f6a28202e7d1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3121e4f7-0d20-4f11-932d-bf86846bdb40","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3bf351da-2cbf-4efd-82b1-7c9ab791a63a","root":false,"$title":"[CP.2.7.4][MSG] Menu Lista de Ocorrencias","$position":{"top":"1246.33px","left":"9282.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9be3021a-bd89-4920-8921-aeae75d4004e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"621cc419-4554-41ec-a2f1-5de2c36b3342","typeOfStateId":"state","$connId":"con_318","$id":"b1c9e975-9a1d-4abe-9282-9870c1633436","conditions":[{"source":"context","comparison":"equals","values":["Não encontrei o protocolo"],"variable":"userInput"}],"$invalid":false},{"stateId":"4f600f97-b24d-422e-9787-bb42f25ef97b","typeOfStateId":"state","$connId":"con_323","$id":"e12f84a8-2b54-4dfb-8a3a-4669c3cfa432","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, ocorrenciasEncontradas) {\n    try {\n        ocorrenciasEncontradas = JSON.parse(ocorrenciasEncontradas);\n        if (!inputUsuario) return 'inatividade'\n        if (inputUsuario == \"0\") return \"Não encontrei o protocolo\"\n        if (isNumber(inputUsuario)) {\n            let index = parseInt(inputUsuario) - 1;\n            if (index >= 0 && index < ocorrenciasEncontradas.length) {\n                return ocorrenciasEncontradas[index];\n            } else {\n                return 'input inesperado';\n            }\n        };\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}\nfunction isNumber(input) {\n    const regex = /^\\d+$/;\n    return regex.test(input);\n}","inputVariables":["input.content","ocorrenciasEncontradas"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d25ef70a-7b3c-498c-b27e-e63b3dcbb1ab","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada);\n\t\treturn ocorrenciaEncontrada;\n\t}\n\tcatch (e) {\n\t\treturn \"Não Encontrada\"\n\t}\n}","inputVariables":["userInput"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"11260fac-a30c-4863-9a2e-29391c8f0689","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"S.2.4.0.1\"","$invalid":false,"settings":{"variable":"exceptionType","value":"S.2.4.0.1"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c2493e6c-f3bd-46b5-969c-926121339604","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a7de7776-e42a-47be-9d97-b97077496e58","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bea6a857-77e2-49bd-9b74-ae3dec258d6e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-55ea1e93-55d3-4060-a404-29659cbbd1c0","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"9be3021a-bd89-4920-8921-aeae75d4004e","root":false,"$title":"[CP.2.7.4][INPUT] Menu Lista de Ocorrencias","$position":{"top":"1493.33px","left":"9281.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"621cc419-4554-41ec-a2f1-5de2c36b3342":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e903ef19-0695-4781-b9b4-1e50cdb603a7","typeOfStateId":"state","$connId":"con_328","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Entendi que você não encontrou o protocolo.\n\nSe você tiver o número do protocolo é só informar aqui.`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0651d209-df3e-49f1-8681-c75eecbb3d1b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3189aafd-e5b8-4af7-916a-817a6130777a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ba600020-9a57-4a20-898e-abec0c010ea6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"621cc419-4554-41ec-a2f1-5de2c36b3342","root":false,"$title":"[CP.2.7.5][MSG] Não encontrei o protocolo","$position":{"top":"1758px","left":"9282px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e903ef19-0695-4781-b9b4-1e50cdb603a7":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"5d5de109-ede8-4b09-b292-23864239e93d","typeOfStateId":"state","$connId":"con_333","$id":"180780cc-9cda-40f0-ae70-68a51a3075db","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"c844130a-a5fe-4177-bc34-99bdac7a6eea","typeOfStateId":"state","$connId":"con_338","$id":"af7ebdb5-5d19-4f54-9414-7d9244b1a301","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a7d20a26-01b9-43f0-8c36-9686979aed77","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bbb758b9-6023-49c2-b139-932e09a9aaf6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-2657d5fd-1599-401c-a555-f93d65d43ba1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c2a26cdb-ff17-4e3d-9fd0-77780673768d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e903ef19-0695-4781-b9b4-1e50cdb603a7","root":false,"$title":"[CP.2.7.5][INPUT] Não encontrei o protocolo","$position":{"top":"2008.33px","left":"9282.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d5de109-ede8-4b09-b292-23864239e93d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ea0a9ca8-00fe-4231-8cdd-9480955d83d8","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"5d5de109-ede8-4b09-b292-23864239e93d","root":false,"$title":"[GO TO][CP.2.6.0][MSG] Consulta Protocolo Númerica ","$position":{"top":"2297.33px","left":"9173.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c844130a-a5fe-4177-bc34-99bdac7a6eea":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a7d1acf0-8b47-4386-b0bb-26d8ce124f92","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c844130a-a5fe-4177-bc34-99bdac7a6eea","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome) ","$position":{"top":"2302px","left":"9364.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"425a0975-5ebc-4885-bc03-71fb3126b93e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d6ba1ae-d71a-41d3-9a57-fc9cc38d90bf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8a7d398-d571-46b8-af62-2c12b59d1f2d","typeOfStateId":"state","$connId":"con_343","$id":"eecef03a-cfc5-4f3f-a5c8-5971e35f482f","conditions":[{"source":"context","comparison":"equals","values":["ENCERRADO"],"variable":"ocorrenciaEncontrada@descricaoStatus"}],"$invalid":false},{"stateId":"463b7c23-5575-468b-b49b-6806857b0e0a","typeOfStateId":"state","$connId":"con_348","$id":"033b187e-cecd-40ef-a5b4-ce63a156cd38","conditions":[{"source":"context","comparison":"notEquals","values":["ENCERRADO"],"variable":"ocorrenciaEncontrada@descricaoStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9c5ba34c-ef58-4a4f-bb8b-05aafcb83192","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{ocorrenciaEncontrada@descricaoStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"ocorrenciaEncontrada@descricaoStatus"}]},{"$id":"453f18bd-082a-4673-9931-b5c3e29b2a6b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"consolidado protocolos exibidos dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"consolidado protocolos exibidos dados","action":"{{contact.identity}} | {{contact.extras.cpf}} | {{contact.extras.cpf}} | {{ocorrenciaEncontrada}} | {{calendar.datetime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c6412422-d0cd-4846-8333-d8b419d43a13","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"425a0975-5ebc-4885-bc03-71fb3126b93e","root":false,"$title":"[CP.2.8.0][SET] Status da Ocorrencia","$position":{"top":"1190.5px","left":"8220.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8a7d398-d571-46b8-af62-2c12b59d1f2d":{"$contentActions":[{"action":{"$id":"9dfe15ed-4061-4979-b19d-eacddba5cb83","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f758c4c6-28c6-4ac1-9c0a-a6a4901da60a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f758c4c6-28c6-4ac1-9c0a-a6a4901da60a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d08e2644-43c0-4299-9ef8-bc7978dc2d07","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f30789cb-d21b-4e3c-9d1c-839730d2f8c5","type":"text/plain","content":"{{msgOcorrencia}}","metadata":{}},"$cardContent":{"document":{"id":"f30789cb-d21b-4e3c-9d1c-839730d2f8c5","type":"text/plain","content":"{{msgOcorrencia}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2477b43e-f239-42c8-bbed-232d5d532e72","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"60d067ae-effa-48fb-84fa-b8c83fa9168d","typeOfStateId":"state","$connId":"con_353","$id":"07f3d340-804d-4c61-b873-e2a22db26c2e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5617d262-77ba-4f79-bed5-83cc595fe105","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"fb4dfe2f-bd40-4121-8e66-48e542086c4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\t\treturn `*Status*: ✔Encerrado\n\n${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}.${ocorrenciaEncontrada.id}\n*Aberto em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraAbertura)}\n*Fechado em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraEncerramento)}\n\n${obsExiste(ocorrenciaEncontrada.motivoResolucao)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠️Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔Encerrado\"\n\t} else {\n\t\treturn \"🔍Em análise\"\n\t}\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/0000\"\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2a4da273-fa62-4f2c-b5f8-7f879304c94f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6b8c61cc-9bcc-408b-9cad-0541d24b44d7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e35a61e2-b0ab-49b5-be18-7d4b6b1b6cb0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e8a7d398-d571-46b8-af62-2c12b59d1f2d","root":false,"$title":"[CP.2.8.1][MSG] Ocorrencia Encerrada","$position":{"top":"1365.5px","left":"7992.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"463b7c23-5575-468b-b49b-6806857b0e0a":{"$contentActions":[{"action":{"$id":"6ee0a734-b070-430b-9324-15e4b5d2e119","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"124eae8e-7d62-498e-901f-f0043ddad5c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"124eae8e-7d62-498e-901f-f0043ddad5c8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"63032d32-43ce-46d2-89d3-df18b8b56c5a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a7a6b601-71fd-4940-bfba-d8c2fa24bc2e","type":"text/plain","content":"{{msgOcorrencia}}","metadata":{}},"$cardContent":{"document":{"id":"a7a6b601-71fd-4940-bfba-d8c2fa24bc2e","type":"text/plain","content":"{{msgOcorrencia}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed1403fc-49a9-44a0-97d8-16cba5d08569","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8bf1cf79-af4b-4618-ae0a-a895dcbaf99d","typeOfStateId":"state","$connId":"con_358","$id":"4422ed4a-7f41-405c-8c62-f6aa12d13467","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e173ad5e-3f30-481c-861d-013c1a194027","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"ebf4d6ef-8f15-455c-a696-c72148ad6fcb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\n\t\treturn `*Status*: ${getStatus(ocorrenciaEncontrada.descricaoStatus)}\n\n${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}.${ocorrenciaEncontrada.id}\n*Aberto em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraAbertura)}\n*Retorno previsto*: ${getDataFormatada(ocorrenciaEncontrada.dataPrevistaEncerramento)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠️Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔Encerrado\"\n\t} else {\n\t\treturn \"🔍Em análise\"\n\t}\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/0000\"\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-32b93c85-8c1b-4c56-be5c-f7e78895c51d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-94353a68-74fe-4a1f-9946-bc4c6ec816e5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c45667c6-a7e5-45cf-bbe9-3d99f2ecaddb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"463b7c23-5575-468b-b49b-6806857b0e0a","root":false,"$title":"[CP.2.8.2][MSG] Ocorrencia Em Andamento","$position":{"top":"1337.5px","left":"8635.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"60d067ae-effa-48fb-84fa-b8c83fa9168d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2477b43e-f239-42c8-bbed-232d5d532e72","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f8479797-dcdf-4c3e-a401-da8bdcb7d2d4","typeOfStateId":"state","$connId":"con_363","$id":"07f3d340-804d-4c61-b873-e2a22db26c2e","conditions":[{"source":"context","comparison":"equals","values":["UM"],"variable":"numeroDeOcorrencias"}],"$invalid":false},{"stateId":"3320463f-d231-4089-889d-fe003372aadc","typeOfStateId":"state","$connId":"con_368","$id":"855b41fc-402c-48a8-8257-e4fd0b855374","conditions":[{"source":"context","comparison":"notEquals","values":["UM"],"variable":"numeroDeOcorrencias"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fb4dfe2f-bd40-4121-8e66-48e542086c4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\t\treturn `*Status*: ✔${ocorrenciaEncontrada.descricaoStatus}}\n\n${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}.${ocorrenciaEncontrada.id}\n*Aberto em*: ${ocorrenciaEncontrada.dataHoraAbertura}\n*Fechado em*: ${ocorrenciaEncontrada.dataHoraEncerramento}\n\n${obsExiste(ocorrenciaEncontrada.motivoResolucao)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Observação*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4e1c6b42-2368-493a-a46c-1555541a49f2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"60d067ae-effa-48fb-84fa-b8c83fa9168d","root":false,"$title":"[CP.2.8.1.1][SET] Quantidade de ocorrencia","$position":{"top":"1595.5px","left":"7992.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8bf1cf79-af4b-4618-ae0a-a895dcbaf99d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"80a2253d-1530-4d86-a4bd-bcc0090ae7c6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"355c68db-7472-40df-91a1-341ef7e927f0","typeOfStateId":"state","$connId":"con_373","$id":"ac480b65-9aa3-475a-bc8b-0c24c380fd73","conditions":[{"source":"context","comparison":"equals","values":["Fora do prazo"],"variable":"dentroDoPrazo"}],"$invalid":false},{"stateId":"2cf161a2-1636-4a04-ae85-603e2d825c5f","typeOfStateId":"state","$connId":"con_378","$id":"4289372f-41cc-4ad8-9335-ef3138e2dd59","conditions":[{"source":"context","comparison":"equals","values":["Dentro do prazo"],"variable":"dentroDoPrazo"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dc0b9966-8bce-4205-965b-ae8e4773d486","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{numeroProtocolo}} | {{dentroDoPrazo}}"},"conditions":[]},{"$id":"49ddb0d3-31b5-4646-b3c0-a8a31ba36400","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dentroDoPrazo\"","$invalid":false,"settings":{"function":"run","source":"function run(ocorrenciaEncontrada) {\n    try {\n        ocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada);  \n        let dataAtual = new Date();\n        let itemAberto = ocorrenciaEncontrada;\n\n        if (itemAberto) {\n            let dataLimite = getDataFormatada(itemAberto.dataPrevistaEncerramento);\n            if (dataLimite < dataAtual) {\n                return `Fora do prazo`;\n            }\n        }\n        return `Dentro do prazo`;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\nfunction getDataFormatada(data) {\n    let dataHoraInclusao = new Date(data);\n    return dataHoraInclusao;\n};","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"dentroDoPrazo","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-acba4594-e1a9-4a1c-8869-338a889f92a7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bbfb3f3f-0146-4dd0-a3de-dfc0dfbea393","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"8bf1cf79-af4b-4618-ae0a-a895dcbaf99d","root":false,"$title":"[CP.2.8.8][SET] Valida SLA","$position":{"top":"1585px","left":"8632.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3320463f-d231-4089-889d-fe003372aadc":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"04fdebc0-7150-4666-a97d-e05210cf910f","typeOfStateId":"state","$connId":"con_383","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ver opções novamente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Era este o protocolo que você precisava?\n\nPosso consultar também os protocolos dos últimos 60 dias ou então se tiver um número específico, é só informar aqui.\n\nSelecione uma das opções:`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bcd681a7-41ed-4191-b4f1-ab695d763dcc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-99dcc773-226c-4853-b9ef-6d00a23107aa","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d33fded1-97db-4344-828c-4e3da27a6b41","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3320463f-d231-4089-889d-fe003372aadc","root":false,"$title":"[CP.2.8.4][MSG] Consultar Mais? (+ Ocorrencias)","$position":{"top":"1790.5px","left":"8143.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e4b128f9-85e7-4b61-a314-679b26acb2b5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c6e59ac8-9b50-46e7-8343-2803589d7436","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443ab8bd-9468-402d-b5d6-4c1afa3a7212","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e4b128f9-85e7-4b61-a314-679b26acb2b5","root":false,"$title":"[GO TO][CP.2.6.0][MSG] Consulta Protocolo Númerica  ","$position":{"top":"2280px","left":"7830px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f8479797-dcdf-4c3e-a401-da8bdcb7d2d4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3cc656d6-a590-443c-9edf-9a391913731c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"f8479797-dcdf-4c3e-a401-da8bdcb7d2d4","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)   ","$position":{"top":"1801.5px","left":"7717.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"355c68db-7472-40df-91a1-341ef7e927f0":{"$contentActions":[{"action":{"$id":"fae01ff2-78d7-4a1c-803e-9705d922c71a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7b88248e-8508-4d17-8ec6-24313231a67e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7b88248e-8508-4d17-8ec6-24313231a67e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e216291e-531e-4195-946c-441699fc3a34","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2aa81b5c-808a-4ae9-bba2-78d8338b6439","type":"text/plain","content":"Vi aqui que o prazo para dar um retorno já passou. Já acionei nosso time e estamos fazendo o possível para resolver o quanto antes.","metadata":{}},"$cardContent":{"document":{"id":"2aa81b5c-808a-4ae9-bba2-78d8338b6439","type":"text/plain","content":"Vi aqui que o prazo para dar um retorno já passou. Já acionei nosso time e estamos fazendo o possível para resolver o quanto antes."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1b46fdb-e03a-4cdc-9f02-8b9fa489f6f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"22db9c00-b001-4a6c-8983-795b50860595","typeOfStateId":"state","$connId":"con_388","$id":"c38be8eb-f37d-42f6-acd5-d5285c63689a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6548ab5a-027b-49cc-857a-3b4bbac94441","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"a87e3fb6-8488-49cf-a62a-56a32613436f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"requestComentarioOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(cpf) {\n\ttry {\n\t\treturn {\n\t\t\t\"idUsuario\": cpf,\n\t\t\t\"nomeUsuario\": cpf,\n\t\t\t\"origemAberturaOcorrencia\": \"SUSTENTACAO PJ\",\n\t\t\t\"comentario\": `Registro via chatbot WhatsApp PJ - O usuário portador do CPF: ${cpf}, solicita urgência no atendimento de sua demanda. O prazo máximo para a resolução já foi atingido, e sua situação requer atenção imediata.`\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["contact.extras.cpf"],"outputVariable":"requestComentarioOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b0e7d724-774a-40a1-ac05-bf3da939c9b8","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP POST \"bodyComentarioOcorrencia\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{idSessao}}"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{ocorrenciaEncontrada@idProtocolo}}/ocorrencias/{{ocorrenciaEncontrada@id}}/historicos","method":"POST","responseStatusVariable":"statusComentarioOcorrencia","responseBodyVariable":"bodyComentarioOcorrencia","body":"{{requestComentarioOcorrencia}}"},"conditions":[]},{"$id":"2e659540-d7a4-443c-b0cb-09ff9682176a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusComentarioOcorrencia"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87c8fa21-90d7-4ea3-bfa9-487092daefd3","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{numeroProtocolo}}/ocorrencias/{{idUltimaOcorrencia}}/historicos | POST | {{statusComentarioOcorrencia}} | {{bodyComentarioOcorrencia}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-cf427ab4-fae1-47f1-bc45-986631000a30","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-00e463c8-d276-4c9c-ae6a-552f55dcc90c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-933aebab-cf59-46dc-be4c-ace5e5e76c5e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-05dc368e-1e47-49d6-8396-30361428051b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"355c68db-7472-40df-91a1-341ef7e927f0","root":false,"$title":"[CP.2.8.8.1][MSG][HTTP]Protocolo fora do Prazo","$position":{"top":"1753px","left":"8423.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"2cf161a2-1636-4a04-ae85-603e2d825c5f":{"$contentActions":[{"action":{"$id":"13d18022-762f-4806-ba88-f201a115da0b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fd821cfb-121e-42e6-9ae7-e92f92ad123e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fd821cfb-121e-42e6-9ae7-e92f92ad123e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b85ed1ed-64c1-4100-a727-efe77413443a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6ca88c3d-9a7f-435c-b01c-e86be2bd31b1","type":"text/plain","content":"Por aqui, estou trabalhando para te dar um retorno o quanto antes, e isso pode ocorrer até às 23:59 da data prevista.","metadata":{}},"$cardContent":{"document":{"id":"6ca88c3d-9a7f-435c-b01c-e86be2bd31b1","type":"text/plain","content":"Por aqui, estou trabalhando para te dar um retorno o quanto antes, e isso pode ocorrer até às 23:59 da data prevista."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"97c334c5-7414-4c06-885d-ad54444c8a0b","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"22db9c00-b001-4a6c-8983-795b50860595","typeOfStateId":"state","$connId":"con_393","$id":"066f515d-b75a-4aa2-ada4-796f565768e7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dc2534f0-abae-4556-a599-3d5eed3bbac8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5fc95d79-5a67-43bb-84a3-8b5cf2e90a8e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8532880c-c6a8-45f0-910f-a9e2d5de9428","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"2cf161a2-1636-4a04-ae85-603e2d825c5f","root":false,"$title":"[CP.2.8.8.2][MSG] Dentro do Prazo","$position":{"top":"1772.67px","left":"8864.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"04fdebc0-7150-4666-a97d-e05210cf910f":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4b128f9-85e7-4b61-a314-679b26acb2b5","typeOfStateId":"state","$connId":"con_398","$id":"4450d719-e5cb-4d3f-9bb9-8979f48aee70","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"abbdb87d-1552-4dae-93d5-c3481cfea0c0","typeOfStateId":"state","$connId":"con_403","$id":"a37496e4-955c-413e-871f-b17d12f4c02f","conditions":[{"source":"context","comparison":"equals","values":["Ver opções novamente"],"variable":"userInput"}],"$invalid":false},{"stateId":"c126284e-2396-4eb5-9824-4417e5af86f4","typeOfStateId":"state","$connId":"con_408","$id":"4c7ef026-e016-47a2-8d39-a4ce9d9693cd","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} validacao","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-25974596-8ed2-4aa3-8324-35507a6afb1b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e09f9dca-bb03-46fa-982e-c7b853a6169f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d7013c6b-cf92-4c80-a008-b60863510165","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dc32df05-aa02-40bb-ae7f-14c4e54fc9a9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"04fdebc0-7150-4666-a97d-e05210cf910f","root":false,"$title":"[CP.2.8.4][INPUT] Consultar Mais? (+ Ocorrencias)","$position":{"top":"2047.67px","left":"8143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"abbdb87d-1552-4dae-93d5-c3481cfea0c0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"151faaed-b713-4ce7-84fb-ae0544cbb686","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3bf351da-2cbf-4efd-82b1-7c9ab791a63a","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"abbdb87d-1552-4dae-93d5-c3481cfea0c0","root":false,"$title":"[GO TO][CP.2.7.4][MSG] Menu Lista de Ocorrencias","$position":{"top":"2353px","left":"8142.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c126284e-2396-4eb5-9824-4417e5af86f4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"30b18653-45cf-498b-9218-e259071f95bc","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c126284e-2396-4eb5-9824-4417e5af86f4","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"2290px","left":"8498px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"22db9c00-b001-4a6c-8983-795b50860595":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3cc656d6-a590-443c-9edf-9a391913731c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"99095867-01bc-4fb1-a47d-3168e590e328","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"22db9c00-b001-4a6c-8983-795b50860595","root":false,"$title":"[GO TO] [Redirect] To Finalizacao (Welcome)","$position":{"top":"1897.33px","left":"8647.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4f600f97-b24d-422e-9787-bb42f25ef97b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8f19c9d7-dfe4-440f-b045-9ccf70498687","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"425a0975-5ebc-4885-bc03-71fb3126b93e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"4f600f97-b24d-422e-9787-bb42f25ef97b","root":false,"$title":"[GO TO] [CP.2.8.0][SET] Status da Ocorrencia","$position":{"top":"1615px","left":"9538.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6cd5fdb5-6ad7-4ec2-b6be-3ed6e1544ad2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"533ba9f1-9dd4-4214-9abe-43dece4debde","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0c32b967-ca59-4e42-8cd3-f9681597ca8f","typeOfStateId":"state","$connId":"con_413","$id":"00f82671-1ce8-485d-a7b6-1d077f2ee485","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4464c252-3bca-4a8d-afb0-34b42d57a39e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"cadf4252-c528-4820-96ab-226f948598b0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        return data[0];\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1de622c-4a1e-47bf-b33b-43d5b287cacb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c9ff5fd3-3549-4c67-8f22-c65a91040d8a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"6cd5fdb5-6ad7-4ec2-b6be-3ed6e1544ad2","root":false,"$title":"[CP.2.0.3][SET] Ocorrencia Encontrada","$position":{"top":"1464.67px","left":"4199px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"43c69686-4102-4eed-a62b-920ad0f58610":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"533ba9f1-9dd4-4214-9abe-43dece4debde","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"17076c47-4726-49c5-b63f-eec49c4be9d9","typeOfStateId":"state","$connId":"con_418","$id":"00f82671-1ce8-485d-a7b6-1d077f2ee485","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4464c252-3bca-4a8d-afb0-34b42d57a39e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}","AgConta":"{{contact.extras.agencia}}-{{contact.extras.conta}}","CPF":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"40b7a7fe-c953-4bd1-bfbc-4638024c70ff","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciasEncontradas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        // Order by dataHoraAbertura in ascending order\n        data.sort((a, b) => {\n            let dateA = new Date(a.dataHoraAbertura);\n            let dateB = new Date(b.dataHoraAbertura);\n            return dateA - dateB;\n        });\n        return data;\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciasEncontradas","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0e669eb1-6914-4d0c-9171-984f6d867b71","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ef07fd09-46c6-48a7-bb1e-c8b96db67d42","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"43c69686-4102-4eed-a62b-920ad0f58610","root":false,"$title":"[CP.2.0.4][SET] Ocorrencias Encontradas","$position":{"top":"1458px","left":"4432px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","botKey":"Key ZGV2cGZjb25zdWx0YXByb3RvY29sbzp5bGhPRkVUVmNuZktpbWM4cW1BbQ=="},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}