{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"8c0bd4bf-6b0b-4085-a335-8af27420c779","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"1f27e71b-3784-4a22-bac7-a65dae1ea5d1","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"d049a751-3b37-4bd1-a419-23c57abffc90","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"a0a30b4b-4eef-4689-bfc7-f362b6c53975","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8f7684ef-4d50-4a9a-8427-deb90a353964","$typeOfContent":"","type":"MergeContact","$title":"Set \"broadcastOrigem\"","$invalid":false,"settings":{"extras":{"broadcastOrigem":"{{contact.extras.campaignMessageTemplate}}"}},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.campaignMessageTemplate"},{"values":["-"],"source":"context","comparison":"notEquals","variable":"contact.extras.campaignMessageTemplate"}]},{"$id":"89e0776a-0832-45ce-900f-72ffdff82b8f","$typeOfContent":"","type":"MergeContact","$title":"Set \"campaignMessageTemplate\" to \"-\"","$invalid":false,"settings":{"extras":{"campaignMessageTemplate":"-"}},"conditions":[]},{"$id":"72fed6c1-fd0f-4069-98fb-0687dfd8b8e0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"fdba4a00-aa02-45c1-830e-7c1b79ef393e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"origemCampanhaPadrao\"","$invalid":false,"settings":{"function":"run","source":"function run(calendarDatetime, inputMessage, inputContent, broadcast, identity) {\n    const date = new Date(calendarDatetime);\n    \n    const dataFormatada = dataAtualFormatada(date);\n    let metadataCampanha = metadata(inputMessage);\n    const origem = origemCampanha(inputContent, metadataCampanha, broadcast);\n    const canal = origemCanal(identity);\n    metadataCampanha = metadataCampanha != \"\" ? metadataCampanha : \"nao possui campanha\";\n\n    const trackOrigemCampanha = `${dataFormatada} | ${identity} | ${metadataCampanha} | ${canal} | ${origem} | ${inputContent}`\n    \n    return { \n        trackOrigemCampanha,\n        canal\n    };\n}\n\nfunction dataAtualFormatada(data) {\n    const dia = data.getDate().toString();\n    const diaF = (dia.length == 1) ? '0' + dia : dia;\n    const mes = (data.getMonth() + 1).toString(); //+1 pois no getMonth Janeiro começa com zero.\n    const mesF = (mes.length == 1) ? '0' + mes : mes;\n    const anoF = data.getFullYear();\n    const hora = data.getHours().toString();\n    const horaF = (hora.length == 1) ? '0' + hora : hora;\n    const min = data.getMinutes().toString();\n    const minF = (min.length == 1) ? '0' + min : min;\n    const seg = data.getSeconds().toString();\n    const segF = (seg.length == 1) ? '0' + seg : seg;\n\n    return `${diaF}/${mesF}/${anoF} ${horaF}:${minF}:${segF}`;\n}\n\nfunction metadata(inputMessage) {\n    try {\n        let inputMessageFormatted = JSON.parse(inputMessage);\n        // let inputMessageFormatted = inputMessage;\n        let metadata = inputMessageFormatted.metadata;\n\n        if (metadata && metadata['#wa.referral.headline']) {\n            const metadataCampanha = `${metadata['#wa.referral.source_id']} | ${metadata['#wa.referral.source_url']} | ${metadata['#wa.referral.headline']} | ${metadata['#wa.referral.body']} | ${metadata['#wa.referral.source_type']} | ${metadata['#wa.referral.image.id']}`\n            return metadataCampanha;\n        } else {\n            const metadataCampanha = \"\"\n            return metadataCampanha;\n        }\n    } catch (err) {\n        const metadataCampanha = \"\";\n        return metadataCampanha;\n    }\n}\n\nfunction origemCampanha(inputContent, metadata, broadcast) {\n    try {\n        const sourceUrl = metadata;\n        if (sourceUrl != \"\") {\n            return \"Campanha\"\n        } else if(broadcast){\n            return `broadcast | ${broadcast}`\n        }\n        return \"organico\"\n    } catch (err) {\n        return \"organico\"\n    }\n}\n\nfunction origemCanal(identity) {\n    try {\n        const source = identity.split('@')[1].split('.')[0];\n        switch (source) {\n            case 'wa':\n                return \"whatsapp\";\n                break;\n            case 'businesschat':\n                return \"businesschat\";\n                break;\n            case '0mn':\n                return \"blipchat\";\n                break;\n            case 'messenger':\n                return \"messenger\";\n                break;\n            case 'telegram':\n                return \"telegram\";\n                break;\n            case 'instagram':\n                return \"instagram\";\n                break;\n            case 'mailgun':\n                return \"email\";\n                break;\n            case 'workplace':\n                return \"workchat\";\n                break;\n            case 'tunnel':\n                return \"whatsapp\";\n                break;\n            case 'abs':\n                return \"teams\";\n                break;\n            default:\n                return \"new\"\n                break;\n        }\n\n    } catch (error) {\n        return false;\n    }\n}","inputVariables":["calendar.datetime","input.message","input.content","contact.extras.broadcastOrigem","contact.identity"],"outputVariable":"origemCampanhaPadrao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dfe44f2b-7378-4221-8059-2c589d0ed9c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Origem campanha [[canal]]\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Origem campanha {{origemCampanhaPadrao@canal}}","action":"{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"origemCampanhaPadrao"},{"comparison":"exists","source":"context","values":[],"variable":"origemCampanhaPadrao@trackOrigemCampanha"}]},{"$id":"06b2da21-deca-437b-891a-509468dd3153","$typeOfContent":"","type":"SetVariable","$title":"Set \"userInput\" to \"{input.content}\"","$invalid":false,"settings":{"variable":"userInput","value":"{{input.content}}"},"conditions":[]},{"$id":"b73d2827-1f98-4885-b665-abb094018fd9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ca389ed-0b36-4604-89ff-cfd11cc6d828","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"veioDeOutroNumero\"","$invalid":false,"settings":{"function":"run","source":"function run(botId) {\n\ttry {\n\t\tif (botId.includes( 'routersafraprodwhatsapppj') || botId.includes( 'routerbetawhatsapppj')) {\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["tunnel.owner"],"outputVariable":"veioDeOutroNumero","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"374af24c-7162-4ff1-a800-8808906253da","$typeOfContent":"","type":"SetVariable","$title":"Set \"idSessao\"","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-050297a1-9d46-41f5-8e99-79cbe47bd8ad","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-14a9b6f6-8f44-4ca8-bbce-fa63f08c371b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a0c45bfa-1b62-4847-bc02-014160368d35","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ee86459a-f8ca-4379-8c9b-29121c380d8d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5fd66312-14a7-495c-bc57-80c1f1212cae","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"98px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ce4d5530-5502-4f59-9db1-f234569359c8","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2936feee-9a8c-488a-b210-940e102e6a53","typeOfStateId":"state","$connId":"con_8","$id":"b8d13fe8-ce23-406c-a2f1-63b2d6455e44","conditions":[{"source":"context","comparison":"equals","values":["input inesperado","inatividade"],"variable":"userInput"}],"$invalid":false},{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"ce8e103f-daa4-486a-b7c6-252124d2315b","$connId":"con_13","$invalid":false}],"$enteringCustomActions":[{"$id":"fe3adaaf-557c-454a-86a0-fccbea0b1aaa","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-94358a5c-add1-49d4-b31d-002d8dc1ae31","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"72px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"78a63546-53b7-451d-951c-f0953819fb07","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"895fa7f0-cec1-4487-ba06-ab4d5692b6c8","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"blockDestinationId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b5b7636a-da52-44c4-9de8-86a4028ed472","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"f0eab05c-188d-4f3e-94cf-6809e0895611","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, templates, broadcastOrigem) {\n    try {\n        const parsedTemplates = JSON.parse(templates)\n        const broadcast = parsedTemplates[broadcastOrigem]\n        let blockDestionationId = '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n        if (broadcast) {\n            let id = broadcast[inputContent]\n            if (id) {\n                blockDestionationId = id\n            }\n            else if (broadcast[\"inicio display\"]) {\n                blockDestionationId = \"34c56f71-e624-4181-93bf-37099360c830\"; // Redirecionar Inicio Display Independente de Existir Botão\n            }\n            else {\n                blockDestionationId = broadcast\n            }\n        }\n        if (blockDestionationId.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/)) {\n            return blockDestionationId\n        }\n        return '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n    } catch (err) {\n        return '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n    }\n}","inputVariables":["input.content","resource.broadcastList","contact.extras.broadcastOrigem"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"22855679-4c75-46b4-96b8-d68e55a534bc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{blockDestinationId}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1cf6e4b-fb5b-477b-8196-5f79a9e98d19","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-125b8cd9-f3a8-4b5d-ace6-edec0bf0dc50","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","$title":"[BC.0.0.0] Identifica broadcast","$position":{"top":"417px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ac8d762b-d392-45db-9e20-84724d9d3da7":{"$contentActions":[{"action":{"$id":"ba95aa24-50ed-4f36-af04-50070981808c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9035fe13-9fac-4df5-946f-62ea350bc2aa","$typeOfContent":"text","type":"SendMessage","settings":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b21dda4-37cb-41cd-b52a-d020a742f2db","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"804c253e-be9f-42d4-bf03-18f3313fa15e","$typeOfContent":"","type":"TrackEvent","$title":"count_new_age_acesse_uso","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"count_new_age_acesse_uso","action":"1"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-375b8470-6d65-40ff-a2b8-5e298df35b2c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-47684332-5f7a-4313-9e06-10d9abee2b53","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ac8d762b-d392-45db-9e20-84724d9d3da7","root":false,"$title":"[BC.1.0.0] Link New age","$position":{"top":"480.471px","left":"1418.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d4beee17-fca9-4e41-a016-ea05948c5598":{"$contentActions":[{"action":{"$id":"386b1f70-6cc5-461e-ae9a-7effc58f3836","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d9d8d36e-8d7a-46cf-ae50-5e21ee246f57","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf","metadata":{}},"$cardContent":{"document":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b54106c5-7c67-4690-95b9-857b0c52da99","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"49d1c76a-a1a0-4ec5-a4b4-b7435943a601","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-aaf9cf7d-332d-4919-9271-b21a40c73cb9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0b43af95-1294-4f20-b051-0b2687fe5f00","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d4beee17-fca9-4e41-a016-ea05948c5598","root":false,"$title":"[BC.2.0.0] Link  boas vindas mbj ibj","$position":{"top":"478px","left":"1620px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"0e11155a-b0de-46f6-a922-b8cbec51b62f":{"$contentActions":[{"action":{"$id":"c52dae31-e901-44e6-80b6-b7b339c58157","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d22a1258-a613-4835-a1ad-a085074bd3b7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ca329296-0b20-4782-8f21-6a717c7b38f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bab02fd8-e12a-479a-b4f7-424951a17a67","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-39ce5807-22b9-4856-a41b-0f552af4aa12","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-affe834d-f25c-483a-aed1-17d633a08983","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e11155a-b0de-46f6-a922-b8cbec51b62f","root":false,"$title":"[BC.3.0.0] Link de Pagamento","$position":{"top":"487px","left":"1823px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2326fdc6-1097-4ee3-8f29-4887cad6a036","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","typeOfStateId":"state","$connId":"con_18","$id":"f119e366-afab-407d-b15d-8ee3743b53fa","conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}],"$invalid":false},{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_23","$id":"285abc84-9314-4a9d-b08f-e74bde3e52e5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"82bbd11e-bebd-45dc-97e7-9075a02d79fb","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager"},"conditions":[]},{"$id":"29a34062-1abb-41ae-9f75-4bc3ac065951","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager2\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager2"},"conditions":[]},{"$id":"a86e8dc4-b761-47c7-a721-d9f71abce3c9","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager3\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager3"},"conditions":[]},{"$id":"e6837107-5f2d-41fe-a3d3-3e99a51331c9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3be2c783-fca5-440d-8f3c-f8eece073c35","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"023446de-0356-4af2-9e57-990b44f42e47","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"534b4d6b-f3d4-4ab9-9b69-a4f76b3c11b0","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" PHONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"7046570d-80a1-4b6f-888d-8599807e057e","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J | GET | {{statusAccountManager}} | {{bodyAccountManager}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-83fec82b-c7b5-4e56-b532-eb4151aa6c81","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8e46dc26-8ab8-4da8-9039-d95c471df420","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-874d1bc4-9f3f-468f-8f33-fc766d1d4cce","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9c0a38ce-1949-4a2a-8b3d-1b541312ed21","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe","root":false,"$title":"[BC.4.0.0] Atendimento humano","$position":{"top":"607px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e6db4fe9-f1a4-4c40-8925-f588c3122da0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6bbf7c9a-06a3-40bd-8571-ed0bbce05e06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-edce99c1-b655-49f2-b378-144fa8798928","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6","root":false,"$title":"[BC.5.0.0] Redirect to Main","$position":{"top":"644.143px","left":"1414px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"698dee4c-6a3d-4aee-bed0-0f5210864d2b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"391edfeb-b8b2-4401-93f1-1e037f271fa4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3531026c-da75-4b6d-b3b0-a4aa88609019","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-9ec8d1eb-2daf-4e05-b5cb-334d041068f9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"698dee4c-6a3d-4aee-bed0-0f5210864d2b","root":false,"$title":"[BC.6.0.0] Redirect to Finalização","$position":{"top":"649px","left":"1618.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a0438f36-f75b-4b4a-ab65-a95eefb35fa3":{"$contentActions":[{"action":{"$id":"ab4e8746-8a43-47df-8b0e-a5d5d5cd8b95","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43ae4c63-ecf8-4c6b-89fd-f3294442b8c7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ","metadata":{}},"$cardContent":{"document":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"333ee957-11c8-4bbd-a568-14ce2577d555","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8734c458-8d93-4764-bdd5-df63687a90c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-2772d18d-2bd6-4c37-a67d-4fc97ca4dab6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-25a6e225-2fe2-484e-a95a-c97ee2c1b5e0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a0438f36-f75b-4b4a-ab65-a95eefb35fa3","root":false,"$title":"[BC.7.0.0] Link Pesquisa Pix","$position":{"top":"649.5px","left":"1819.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a8d2f811-ac89-4e91-9b16-c93b4b661447',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a8d2f811-ac89-4e91-9b16-c93b4b661447',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d824e92b-5831-450d-81a5-0c55416f0498","$typeOfContent":"","type":"MergeContact","$title":"Reset \"extras\"","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-56a33e3e-b4ec-41f9-a109-a7e63a875cc2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7b4e14d2-45d2-49d5-86a1-f2d327374dbb","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-4ae97832-32af-4a4c-936f-045f7a158e24","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","root":false,"$title":"[Redirect] to Main (zera variaveis)","$position":{"top":"198px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"449e71de-a279-4ed5-9d44-33d273412a70":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst newState =  {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '5a9c72b7-bfaf-4105-86c1-9cf8be316c37', // [AH.2.2.0] Api horario atendimento\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t\tif (parsedContaSelecionada == false || parsedContaSelecionada.segmentoGerente === 'emp2') {\n\t\t\tnewState.stateDestination = '9a6f3021-b73e-4a50-8ada-691ed5fecfd8' // [AH.2.0.1] Finalização segmento emp2\n\t\t}\n\t\treturn newState\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","contaSelecionada"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-61b2eba1-be3f-4718-b572-3e66f0023a74","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-840f1a7e-a792-4266-9c1f-f3a45f81e826","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"449e71de-a279-4ed5-9d44-33d273412a70","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"1268px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1":{"$contentActions":[{"action":{"$id":"1157f573-7664-44aa-9813-8ffcefc8e7a1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c0c436f9-1b47-4bb5-b460-c9b45c94b3ae","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento","metadata":{}},"$cardContent":{"document":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"809b569a-8f0e-4d3e-9823-aae35e2b21e0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"084d96a0-2b8c-481f-adfe-d1183cc13012","typeOfStateId":"state","$connId":"con_28","$id":"356ea3cf-f9b6-4306-9ff7-79057fba7002","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a1d9b64c-aa1f-4309-a1ad-3e07329bcf8c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0311a513-ffd0-4148-8d63-38db584e3b6f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d726af06-e8e0-41b7-b676-d4036ec4d0af","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","root":false,"$title":"[BC.4.1.0][MSG] Solicita CNPJ","$position":{"top":"619px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"084d96a0-2b8c-481f-adfe-d1183cc13012":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"6d518eb2-7541-4052-807c-590d1bf1daeb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","typeOfStateId":"state","$connId":"con_33","$id":"49eef362-cb6c-4e18-9be4-358351b14285","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"fadba59a-75b1-42e1-b0fa-f3f9eed4dd94","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(documento) {\n\tif (!documento) {\n\t\treturn 'inatividade'\n\t}\n\tdocumento = String(documento).replace(/\\D/g, '');\n\treturn verifyDoc(documento)\n}\nfunction verifyDoc(cnpj) {\n\tif (!cnpj || cnpj.length != 14\n\t\t|| cnpj == \"00000000000000\"\n\t\t|| cnpj == \"11111111111111\"\n\t\t|| cnpj == \"22222222222222\"\n\t\t|| cnpj == \"33333333333333\"\n\t\t|| cnpj == \"44444444444444\"\n\t\t|| cnpj == \"55555555555555\"\n\t\t|| cnpj == \"66666666666666\"\n\t\t|| cnpj == \"77777777777777\"\n\t\t|| cnpj == \"88888888888888\"\n\t\t|| cnpj == \"99999999999999\")\n\t\treturn 'input inesperado'\n\tvar tamanho = cnpj.length - 2\n\tvar numeros = cnpj.substring(0, tamanho)\n\tvar digitos = cnpj.substring(tamanho)\n\tvar soma = 0\n\tvar pos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tvar resultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(0)) return 'input inesperado';\n\ttamanho = tamanho + 1\n\tnumeros = cnpj.substring(0, tamanho)\n\tsoma = 0\n\tpos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tresultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(1)) return 'input inesperado'\n\treturn cnpj;\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5409cfb2-5097-429c-a723-a98905683b11","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"cnpj\"","$invalid":false,"settings":{"value":"cnpj","variable":"exceptionType"},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"9d68329a-9135-4cb8-bdd8-143f2f685d79","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"d89f5f8c-15c5-4e1f-a16e-e2215fea5082","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"60236687-a307-4961-bdf6-2399625116cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{userInput}} | {{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c58bd7f0-8960-4217-b4b3-fcdeb36d0873","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-db659beb-2563-42d7-8d2e-c3c3a85bb8d8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6ff8c17f-0b5c-4aa5-839c-c6ec429e74b0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fe361f71-ec44-4e80-a208-f58222f85c97","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"084d96a0-2b8c-481f-adfe-d1183cc13012","root":false,"$title":"[BC.4.1.0][INPUT] Solicita CNPJ","$position":{"top":"837px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed7b8709-622d-4d93-8f2c-1a2d37438a8b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_38","$id":"15b3d251-e293-4c08-b5b8-2925bda572ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7cacb353-36e0-4d85-b635-f21e527d6b29","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"0bf971c6-ccdb-44a1-9600-2b702d5314a4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020 | GET | {{statusAccountManager2}} | {{bodyAccountManager}}"},"conditions":[]},{"$id":"fcd1cbac-87a0-416d-b975-33ed425eaa1b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]}]},{"$id":"6b1825e7-5dab-432e-b8a0-9960d0ddc372","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017 | GET | {{statusAccountManager3}} | {{bodyAccountManager}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1934697-4d5c-42f2-a4c3-d5e873cf6dca","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b664758e-d548-48e4-9e42-d2e8cf46ea92","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","root":false,"$title":"[BC.4.2.0] Verifica carterização por CNPJ","$position":{"top":"1046px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8bea427a-b6e1-42d3-8844-958d7292ad16":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de40fb96-d81d-4d58-9486-f72ffb4ddfc0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"449e71de-a279-4ed5-9d44-33d273412a70","typeOfStateId":"state","$connId":"con_43","$id":"82ace0f2-c6f9-4628-a062-0a8cba05582f","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"contaSelecionada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1d423e8d-45d5-4a3d-b22d-348b756acc43","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function montaCnpj(baseDocumento, filialCnpj, digitoCpf) {\n  let digito = ''\n  if (digitoCpf < 10 && digitoCpf > 0) {\n    digito = \"0\" + digitoCpf\n  } else {\n    digito = digitoCpf\n  }\n\n  let doc = Number(baseDocumento) + \"000\" + Number(filialCnpj) + digito\n  while (doc.length < 14) {\n    doc = `0${doc}`\n  }\n  return doc\n}\n\nfunction apiPhone(apiResponse) {\n  const { id, codigoSegmento, nomeCliente, baseCpfCnpj, filialCnpj, digitoVerificadorCpfCnpj } = apiResponse\n  const contaSelecionada = {\n    filaGerente: id,\n    segmentoGerente: Number(codigoSegmento) === 17 ? 'emp2' : 'emp1',\n    nomeEmpresa: nomeCliente,\n    doc: montaCnpj(baseCpfCnpj, filialCnpj, digitoVerificadorCpfCnpj),\n    codigoSegmento\n  }\n  return contaSelecionada\n}\n\nfunction apiGerentes(apiResponse, doc) {\n  const { sigla, codigoSegmento, nomeSegmento } = apiResponse\n  const contaSelecionada = {\n    filaGerente: sigla,\n    segmentoGerente: Number(codigoSegmento) === 17 ? 'emp2' : 'emp1',\n    nomeEmpresa: nomeSegmento,\n    doc,\n    codigoSegmento\n  }\n  return contaSelecionada\n}\n\nfunction run(status1, status2, status3, bodyAccountManager, userInput) {\n  try {\n    const parsedBodyAccountManager = JSON.parse(bodyAccountManager).data\n    if (status1 == 200) {\n      return apiPhone(parsedBodyAccountManager)\n    } else {\n      return apiGerentes(parsedBodyAccountManager, userInput)\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["statusAccountManager","statusAccountManager2","statusAccountManager3","bodyAccountManager","userInput"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"21943588-88aa-4b27-be1a-2ce235a9665c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{userInput}} | {{input.content}} | {{contaSelecionada}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b24988e1-cd98-4e62-9fbe-8fa2dc136e12","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c83df9de-81f5-4107-b914-3058993abb8a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"8bea427a-b6e1-42d3-8844-958d7292ad16","root":false,"$title":"[BC.4.3.0] Monta variavel contaSelecionada","$position":{"top":"1046px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2936feee-9a8c-488a-b210-940e102e6a53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-0219dc5b-f7b1-442c-a3f4-264ffa672e71","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2936feee-9a8c-488a-b210-940e102e6a53","root":false,"$title":"[Redirect] To cascata","$position":{"top":"60px","left":"1577px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'fb94c3f1-88bc-4b44-b4f4-43dd60bce494',//sem pesquisa\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-72a4edd7-ccf5-4a66-ab35-f9d7c42352df","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3d890bcd-0f62-4f4c-8376-7ad382286efc","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","root":false,"$title":"[Redirect] to Finalizacao (finalizado)","$position":{"top":"206px","left":"1576px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d049a751-3b37-4bd1-a419-23c57abffc90":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1347955c-7744-4057-9b55-d0b6ef4b98f7","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","typeOfStateId":"state","$connId":"con_48","$id":"49b206cd-7bb3-4049-b0d4-925a19a05dac","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"contact.extras.broadcastOrigem"},{"values":[],"source":"input","comparison":"exists"}],"$invalid":false},{"stateId":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","typeOfStateId":"state","$connId":"con_53","$id":"8ee4908a-5b2c-4e6a-ad1f-5f7a3a2cb6c2","conditions":[{"source":"context","comparison":"equals","values":["-"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"welcome","typeOfStateId":"state","$connId":"con_58","$id":"7ed1c7c3-5149-440e-bb54-627b4eb3ef5f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"83f149c4-16e5-44f7-ba6e-b2fab6c4fbfc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"542a59d9-4865-41a3-ac02-f292a3eccbb2","$typeOfContent":"","type":"ProcessHttp","$title":"DELETE \"statusDeleteBody\"","$invalid":false,"settings":{"headers":{"Organization":"safra","ContactIdentity":"{{contact.identity}}","BotAuthorization":"{{config.routerKey}}"},"method":"DELETE","uri":"https://flowassistant.cs.blip.ai/api-states","responseBodyVariable":"statusDeleteBody","responseStatusVariable":"statusDeleteStatus"},"conditions":[{"values":["routerbroadcastpj"],"source":"context","comparison":"notEquals","variable":"tunnel.owner"},{"values":["routerbroadcastpj@msging.net"],"source":"context","comparison":"notEquals","variable":"tunnel.owner"}]},{"$id":"a0ae68d4-9d62-4abe-93de-ea94c85f9475","$typeOfContent":"","type":"ProcessHttp","$title":"DELETE \"statusDeleteBodyBroad\" Router Broadcast","$invalid":false,"settings":{"headers":{"Organization":"safra","ContactIdentity":"{{contact.identity}}","BotAuthorization":"{{config.routerKeyBroadcast}}"},"method":"DELETE","uri":"https://flowassistant.cs.blip.ai/api-states","responseBodyVariable":"statusDeleteBodyBroad","responseStatusVariable":"statusDeleteStatusBroad"},"conditions":[{"values":["routerbroadcastpj"],"source":"context","comparison":"contains","variable":"tunnel.owner"}]},{"$id":"c70070af-7865-46f8-97dc-116ee6bd3320","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDeleteStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f2eae57-4f7d-495c-9d26-43cc521881fb","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | https://flowassistant.cs.blip.ai/api-states | DELETE | {{statusDeleteBody}} | {{statusDeleteStatus}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a786a0ec-a609-4912-ad6c-3bfced448b7f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ce2e0736-e9ba-49d1-826f-1cf64771945b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-81691391-8aaf-4544-8f6d-736901d7b7ba","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"d049a751-3b37-4bd1-a419-23c57abffc90","root":false,"$title":"[BC.0.0.0][HTTP] Reseta State ID","$position":{"top":"260px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2263fe56-a32f-46e4-9eed-70ebb05ade8f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"025deace-6c0e-4f22-ad53-2666d5a1afea","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"59326cec-f665-46f1-acd5-b803ef616b57","typeOfStateId":"state","$connId":"con_63","$id":"ec96ea29-b475-423c-acf0-1c2a5cca0b4a","conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"veioDeOutroNumero"}],"$invalid":false},{"stateId":"25b2c3fb-2c9c-4858-93db-6970fb09d4ae","typeOfStateId":"state","$connId":"con_68","$id":"19fb844e-4f61-4b03-8f6e-2e10e739a8eb","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"identificaNumeroRoteador"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"25b2c3fb-2c9c-4858-93db-6970fb09d4ae","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2263fe56-a32f-46e4-9eed-70ebb05ade8f","root":false,"$title":"[BC.0.0.1] Entrada organica","$position":{"top":"271px","left":"685px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"25b2c3fb-2c9c-4858-93db-6970fb09d4ae":{"$contentActions":[{"action":{"$id":"ccbe3f0d-d8d1-418e-8800-c7cf37b6f517","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa3a34ce-1476-4d52-8674-8f0b904662f0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa3a34ce-1476-4d52-8674-8f0b904662f0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"de97d6d6-967e-4c23-8076-4a0b7b2dded9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bdc5d440-326d-46e8-9c6a-7360435cc6f5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_73","$id":"6b546c13-4d03-460d-b60e-3a3283828d88","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fe8fd6bb-e222-491d-8922-3917360fcb9e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"cta_url\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": \"Olá, *este número é dedicado ao envio de comunicações e ofertas do Safra Empresas.*\\n\\nSe você precisar *de ajuda com consultas, serviços e informações relacionadas à sua conta PJ,* é só tocar no botão abaixo que te levo para falar no nosso número oficial de atendimento.\"\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"name\": \"cta_url\",\n\t\t\t\t\t\"parameters\": {\n\t\t\t\t\t\t\"display_text\": \"Safra Empresas\",\n\t\t\t\t\t\t\"url\": \"https://bit.ly/4bwdVGv\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c68c1b44-1495-4741-8fcf-888cb4b41196","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e111af1b-64bb-444f-ab6f-6c8d75ff049d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"25b2c3fb-2c9c-4858-93db-6970fb09d4ae","root":false,"$title":"[BC.0.0.2][MSG] Finalização","$position":{"top":"86px","left":"685px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59326cec-f665-46f1-acd5-b803ef616b57":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"537f4be6-f754-4e4c-a7f3-e08e430773b1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"59326cec-f665-46f1-acd5-b803ef616b57","root":false,"$title":"[GO TO] Bot main","$position":{"top":"283px","left":"421px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"34c56f71-e624-4181-93bf-37099360c830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `principal ${env || \"\"}`.trim(), //DISPLAY\n\t\t\tstateDestination: 'welcome', //inicio\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d78d89dc-e024-416e-bbc9-93ae8ca502c5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b845a63d-2f7e-4b35-a9f5-2cec79a426c1","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"34c56f71-e624-4181-93bf-37099360c830","root":false,"$title":"[Redirect] to Display (inicio)","$position":{"top":"215.286px","left":"1770.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62cebff0-f606-40ce-8690-9c8bec2b8022":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '9dfda985-0475-4fc8-9838-06933a9805a4',\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d6044f27-da63-40d7-a38f-fc9c95b2f189","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7f2cd889-d292-4137-af78-c6935f08e889","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"62cebff0-f606-40ce-8690-9c8bec2b8022","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"210px","left":"1961px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2a4c342c-512d-433f-81fd-0a65bdc2f3f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"07edcd34-e07f-4474-ad3e-90da00cfd273","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:574"}],"$conditionOutputs":[{"stateId":"ed72f47e-10eb-40d4-8e7c-21263d85a48e","typeOfStateId":"state","$connId":"con_78","$id":"fc6ce816-d231-4123-94f2-311be74b64b8","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:590"}],"$invalid":false,"$$hashKey":"object:576"}],"$enteringCustomActions":[{"$id":"89528ad6-1844-4157-9104-46fe2ff8cff6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"f64c29f0-4942-4f14-9546-d2a72e9a4228","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroProtocolo\"","$invalid":false,"settings":{"variable":"numeroProtocolo","value":"{{contact.extras.protocolo}}"},"conditions":[]},{"$id":"b412a7e5-0358-4138-b892-4f5de415a138","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroOcorrencia\"","$invalid":false,"settings":{"variable":"numeroOcorrencia","value":"{{contact.extras.ocorrencia}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c6115359-8bd8-4617-82cb-3e3816c1bfc1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d6d7d9a4-2182-4dae-96c5-ed5df9fce488","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"2a4c342c-512d-433f-81fd-0a65bdc2f3f7","root":false,"$title":"[BC.9.0.0] Exibe Status do Protocolo","$position":{"top":"807px","left":"1795px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2f9e7f20-742c-48d2-901d-373375d47540":{"$contentActions":[{"action":{"$id":"ec36bddf-845f-4420-b691-66f0faaca720","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1656ae3d-ba81-48cd-bf9b-48c2d0c017e4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1656ae3d-ba81-48cd-bf9b-48c2d0c017e4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2937"},{"action":{"$id":"5018e172-a94f-4630-8fbb-89ba1c22bbed","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9fbb2f01-c5d1-44f5-9ffe-791a452ef0b5","type":"text/plain","content":"{{msgOcorrencias}}","metadata":{}},"$cardContent":{"document":{"id":"9fbb2f01-c5d1-44f5-9ffe-791a452ef0b5","type":"text/plain","content":"{{msgOcorrencias}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2938"},{"action":{"$id":"776664f0-25c3-4e41-97f7-797b79e4ded3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4e62a4c5-7d33-4f47-8800-51af12ad1514","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4e62a4c5-7d33-4f47-8800-51af12ad1514","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2939"},{"action":{"$id":"3faad559-1c79-49b1-a46f-a8e27ffb0423","$typeOfContent":"text","type":"SendMessage","settings":{"id":"042e098a-8f81-451d-b8aa-cfb0163bc239","type":"text/plain","content":"Você também pode acompanhar o status da sua solicitação pelo aplicativo Safra Empresas e Internet Banking.","metadata":{}},"$cardContent":{"document":{"id":"042e098a-8f81-451d-b8aa-cfb0163bc239","type":"text/plain","content":"Você também pode acompanhar o status da sua solicitação pelo aplicativo Safra Empresas e Internet Banking."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2940"},{"action":{"$id":"d9616625-07ca-419d-86df-2a751f8b3b20","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6d194127-282d-467d-8761-62884ab25aad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6d194127-282d-467d-8761-62884ab25aad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2941"},{"action":{"$id":"a6fdd2c0-cd7a-485d-abcb-1945409ed378","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e0e32dba-1796-4a52-90b6-43e5a7a65a23","type":"text/plain","content":"Também encaminhamos um retorno detalhado no seu e-mail cadastrado no banco Safra.\nPedimos que verifique a sua caixa de entrada. Caso não encontre, não se esqueça de olhar na sua caixa de spam.","metadata":{}},"$cardContent":{"document":{"id":"e0e32dba-1796-4a52-90b6-43e5a7a65a23","type":"text/plain","content":"Também encaminhamos um retorno detalhado no seu e-mail cadastrado no banco Safra.\nPedimos que verifique a sua caixa de entrada. Caso não encontre, não se esqueça de olhar na sua caixa de spam."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2942"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2943"}],"$conditionOutputs":[{"stateId":"64589b8f-3923-48f8-8112-b1612dc8ab30","typeOfStateId":"state","$connId":"con_83","$id":"538ab647-335e-40e0-9aa2-29d333aa82be","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2985"}],"$invalid":false,"$$hashKey":"object:2975"}],"$enteringCustomActions":[{"$id":"19fb62e0-2c58-49c9-98fa-a96809a19a9c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"332c9be0-4499-4ada-a446-f2b148243d00","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciasEncontradas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        // Order by dataHoraAbertura in ascending order\n        data.sort((a, b) => {\n            let dateA = new Date(a.dataHoraAbertura);\n            let dateB = new Date(b.dataHoraAbertura);\n            return dateA - dateB;\n        });\n        return data;\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"ocorrenciasEncontradas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79114b61-ccff-4813-b7a9-f9f04043211c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"function run(ocorrenciasEncontradas) {\n    try {\n        ocorrenciasEncontradas = JSON.parse(ocorrenciasEncontradas);\n        let msg = \"\";\n        for (let index = 0; index < ocorrenciasEncontradas.length; index++) {\n            msg += `*Status*: ${getStatus(ocorrenciasEncontradas[index].descricaoStatus)}\n*Ocorrência*: ${ocorrenciasEncontradas[index].descricaoMotivo} - ${ocorrenciasEncontradas[index].descricaoSubmotivo}\n*Protocolo*: ${ocorrenciasEncontradas[index].idProtocolo}\n*Aberto em*: ${getDataFormatada(ocorrenciasEncontradas[index].dataHoraAbertura)}\n*Fechado em*: ${getDataFormatada(ocorrenciasEncontradas[index].dataHoraEncerramento)}\n${obsExiste(ocorrenciasEncontradas[index].motivoResolucao)}\\n`;\n        }\n\n        return msg;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n\n\nfunction getStatus(status) {\n    if (status == 'ABERTO') {\n        return \"⚠ Em aberto\"\n    }\n    if (status == 'ENCERRADO') {\n        return \"✔ Encerrado\"\n    } else {\n        return \"🔍 Em análise\"\n    }\n}\nfunction getDataFormatada(data) {\n    if (data) {\n        let partes = data.split(/[-\\/]/);\n        let ano = parseInt(partes[0], 10);\n        let mes = parseInt(partes[1], 10) - 1;\n        let dia = parseInt(partes[2], 10);\n        let dataHora = new Date(ano, mes, dia);\n\n        let diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n        let mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n        let anoFormatado = dataHora.getFullYear();\n\n        return `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n    }\n    return (\"00/00/0000\")\n\n}\n\nfunction obsExiste(obs) {\n    if (obs) {\n        return `*Mensagem encerramento*: ${obs}`\n    }\n    else\n        return '';\n}","inputVariables":["ocorrenciasEncontradas"],"outputVariable":"msgOcorrencias","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c94c465a-f367-4abf-bc78-890f4db8bc51","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-eab7365a-9e2a-4199-8fcc-a9ca2e3c6e2c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-85ac6a05-18af-496e-8741-589589e6f865","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"2f9e7f20-742c-48d2-901d-373375d47540","root":false,"$title":"[BC.9.0.5][MSG] Todas Ocorrencias","$position":{"top":"1439px","left":"2011px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"b8f75e1a-844f-4de1-bacc-0756666f4f99":{"$contentActions":[{"action":{"$id":"9dfe15ed-4061-4979-b19d-eacddba5cb83","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f758c4c6-28c6-4ac1-9c0a-a6a4901da60a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f758c4c6-28c6-4ac1-9c0a-a6a4901da60a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2244"},{"action":{"$id":"d08e2644-43c0-4299-9ef8-bc7978dc2d07","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f30789cb-d21b-4e3c-9d1c-839730d2f8c5","type":"text/plain","content":"{{msgOcorrencia}}","metadata":{}},"$cardContent":{"document":{"id":"f30789cb-d21b-4e3c-9d1c-839730d2f8c5","type":"text/plain","content":"{{msgOcorrencia}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2245"},{"action":{"$id":"57b02dad-f7b6-4504-9b97-aee93bd3aacb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ed7c40a9-4dba-4c7f-b1cf-9ff5216e520c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ed7c40a9-4dba-4c7f-b1cf-9ff5216e520c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2246"},{"action":{"$id":"9cff7ced-ccc3-432e-aa1f-e6859d837c3c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6607032e-ccb9-4cf7-8d72-39f2198a93b3","type":"text/plain","content":"Você também pode acompanhar o status da sua solicitação pelo aplicativo Safra Empresas e Internet Banking.","metadata":{}},"$cardContent":{"document":{"id":"6607032e-ccb9-4cf7-8d72-39f2198a93b3","type":"text/plain","content":"Você também pode acompanhar o status da sua solicitação pelo aplicativo Safra Empresas e Internet Banking."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2247"},{"action":{"$id":"8d4cc7e4-00e8-4800-aaa5-9fb494a851de","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5699d45a-a4e5-4b04-ad27-c2c002b72654","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5699d45a-a4e5-4b04-ad27-c2c002b72654","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2248"},{"action":{"$id":"02091348-d63f-4290-b777-7d80a2779c7c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d7e95a7c-7122-44bb-b4a0-3492fda7a3d3","type":"text/plain","content":"Também encaminhamos um retorno detalhado no seu e-mail cadastrado no banco Safra.\nPedimos que verifique a sua caixa de entrada. Caso não encontre, não se esqueça de olhar na sua caixa de spam.","metadata":{}},"$cardContent":{"document":{"id":"d7e95a7c-7122-44bb-b4a0-3492fda7a3d3","type":"text/plain","content":"Também encaminhamos um retorno detalhado no seu e-mail cadastrado no banco Safra.\nPedimos que verifique a sua caixa de entrada. Caso não encontre, não se esqueça de olhar na sua caixa de spam."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2249"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2477b43e-f239-42c8-bbed-232d5d532e72","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2250"}],"$conditionOutputs":[{"stateId":"64589b8f-3923-48f8-8112-b1612dc8ab30","typeOfStateId":"state","$connId":"con_88","$id":"5d6bfcd2-78e7-44cb-9902-ec3763602577","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2292"}],"$invalid":false,"$$hashKey":"object:2282"}],"$enteringCustomActions":[{"$id":"323eb431-7c73-43e6-92ce-940e2ae0e488","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"b0782b45-415a-437b-8050-0bd5b9862012","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ocorrenciaEncontrada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaOcorrenciaLista,idOcorrencia) {\n    try {\n        let data = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        let filteredData = filterById(data, idOcorrencia);\n        return filteredData;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n\nfunction filterById(data, id) {\n    let filtered = data.filter(item => item.id === id)[0];\n    if (!filtered) {\n        return \"Ocorrência não encontrada\";\n    }\n    return filtered;\n}\n","inputVariables":["bodyConsultaOcorrenciaLista","numeroOcorrencia"],"outputVariable":"ocorrenciaEncontrada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fb4dfe2f-bd40-4121-8e66-48e542086c4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOcorrencia\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(ocorrenciaEncontrada) {\n\ttry {\n\t\tocorrenciaEncontrada = JSON.parse(ocorrenciaEncontrada)\n\t\treturn `*Status*: ${getStatus(ocorrenciaEncontrada.descricaoStatus)}\n\n*Ocorrência*: ${ocorrenciaEncontrada.descricaoMotivo} - ${ocorrenciaEncontrada.descricaoSubmotivo}\n*Protocolo*: ${ocorrenciaEncontrada.idProtocolo}\n*Aberto em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraAbertura)}\n*Fechado em*: ${getDataFormatada(ocorrenciaEncontrada.dataHoraEncerramento)}\n${obsExiste(ocorrenciaEncontrada.motivoResolucao)}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction obsExiste(obs) {\n\tif (obs) {\n\t\treturn `*Mensagem encerramento*: ${obs}`\n\t}\n\telse\n\t\treturn '';\n}\n\nfunction getDataFormatada(data) {\n\tif (data) {\n\t\tlet partes = data.split(/[-\\/]/);\n\t\tlet ano = parseInt(partes[0], 10);\n\t\tlet mes = parseInt(partes[1], 10) - 1;\n\t\tlet dia = parseInt(partes[2], 10);\n\t\tlet dataHora = new Date(ano, mes, dia);\n\n\t\tlet diaFormatado = (\"0\" + dataHora.getDate()).slice(-2);\n\t\tlet mesFormatado = (\"0\" + (dataHora.getMonth() + 1)).slice(-2);\n\t\tlet anoFormatado = dataHora.getFullYear();\n\n\t\treturn `${diaFormatado}/${mesFormatado}/${anoFormatado}`;\n\t}\n\treturn \"00/00/000\"\n}\n\nfunction getStatus(status) {\n\tif (status == 'ABERTO') {\n\t\treturn \"⚠ Em aberto\"\n\t}\n\tif (status == 'ENCERRADO') {\n\t\treturn \"✔ Encerrado\"\n\t} else {\n\t\treturn \"🔍 Em análise\"\n\t}\n}","inputVariables":["ocorrenciaEncontrada"],"outputVariable":"msgOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-557e1252-d1c3-4f00-9260-40a5a9056428","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b5dad564-4c96-4981-9503-c3b80c9d8324","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1c968aeb-f03a-4318-a4cc-ad3325e3301f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b8f75e1a-844f-4de1-bacc-0756666f4f99","root":false,"$title":"[BC.9.0.4][MSG] Uma Ocorrencia","$position":{"top":"1445px","left":"1580px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"e348f7ae-0357-429b-b973-67f761f2fe43":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7bf2d4d2-ee38-442c-a469-1499643b0e4e","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:994"}],"$conditionOutputs":[{"stateId":"2f9e7f20-742c-48d2-901d-373375d47540","typeOfStateId":"state","$connId":"con_93","$id":"2aada147-998e-4a46-adbf-92f7639ef8f9","conditions":[{"source":"context","comparison":"equals","values":["todos"],"variable":"contact.extras.ocorrencia","$$hashKey":"object:1014"}],"$invalid":false,"$$hashKey":"object:996"},{"stateId":"b8f75e1a-844f-4de1-bacc-0756666f4f99","typeOfStateId":"state","$connId":"con_98","$id":"8e88994e-71d8-47ff-93dd-059cd882d6e1","conditions":[{"source":"context","comparison":"notEquals","values":["todos"],"variable":"contact.extras.ocorrencia","$$hashKey":"object:1030"}],"$invalid":false,"$$hashKey":"object:997"}],"$enteringCustomActions":[{"$id":"c8397837-30cb-4286-888b-854e92bba90c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"broadcast protocolo ocorrencia\"","$invalid":false,"settings":{"extras":{},"category":"broadcast protocolo ocorrencia","action":"{{contact.extras.ocorrencia}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.ocorrencia"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4fa6432e-c2da-483a-99f0-ab0fb5904970","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"e348f7ae-0357-429b-b973-67f761f2fe43","root":false,"$title":"[BC.9.0.3][SET] Valida Extras","$position":{"top":"1344px","left":"1794px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e4d6612a-10e4-46cb-bb7a-fee228cb3415":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"eceade33-1f3d-4151-b69a-a681756f42a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:765"}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_103","$id":"0a040f0f-5f66-49c1-b362-6358629b6012","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus","$$hashKey":"object:785"},{"values":["Sim"],"source":"context","comparison":"equals","variable":"protocoloEncontrado","$$hashKey":"object:786"}],"$invalid":false,"stateId":"e348f7ae-0357-429b-b973-67f761f2fe43","$$hashKey":"object:767"},{"stateId":"4ae632bf-24da-45d5-bb33-b01433e01bee","typeOfStateId":"state","$connId":"con_108","$id":"889bd4aa-b6b3-4688-8221-62e57c5e755f","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"protocoloEncontrado","$$hashKey":"object:812"}],"$invalid":false,"$$hashKey":"object:768"}],"$enteringCustomActions":[{"$id":"0bf92cb2-15aa-4e8c-a249-cdc82580e382","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Solucoes {state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"SPD Solucoes {{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"0da4cca7-1b3b-4ce8-ac79-c76ca8883b30","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyConsultaProtocolo\" (Consultar Protocolo)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Correlation-ID":"{{idSessao}}","Safra-Aplicacao":"CHT"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{numeroProtocolo}}","method":"GET","responseStatusVariable":"statusConsultaProtocolo","responseBodyVariable":"bodyConsultaProtocolo"},"conditions":[]},{"$id":"c4206f93-98bd-4eef-a06c-194ca98545ee","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyConsultaOcorrenciaLista\" (Consultar Ocorrencias Unico)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"{{application.identifier}}","Safra-Correlation-ID":"{{idSessao}}","Safra-Aplicacao":"CHT"},"uri":"{{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?idProtocolo={{numeroProtocolo}}","method":"GET","responseStatusVariable":"statusConsultaOcorrenciaLista","responseBodyVariable":"bodyConsultaOcorrenciaLista"},"conditions":[]},{"$id":"f230bb72-fbb7-4bf5-90e7-ce2f41746bd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200 && status != 404 )) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusConsultaProtocolo","statusConsultaOcorrenciaLista"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aab17666-7d32-45ca-8400-bfa1c9ade33c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"protocoloEncontrado\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyConsultaProtocolo, numeroProtocolo, bodyConsultaOcorrenciaLista) {\n    try {\n        bodyConsultaProtocolo = JSON.parse(bodyConsultaProtocolo).data;\n        bodyConsultaOcorrenciaLista = JSON.parse(bodyConsultaOcorrenciaLista).data;\n        var protocoloInProtocolo = bodyConsultaProtocolo.id == numeroProtocolo;\n        var protocoloInProtocoloLista = bodyConsultaOcorrenciaLista.some(item => item.idProtocolo == numeroProtocolo);\n        if (protocoloInProtocoloLista == true && protocoloInProtocolo == true) {\n            return \"Sim\"\n        }\n        return \"Não\"\n    }\n    catch (e) {\n        return \"Não\"\n    }\n}","inputVariables":["bodyConsultaProtocolo","numeroProtocolo","bodyConsultaOcorrenciaLista"],"outputVariable":"protocoloEncontrado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"82a4304c-747b-4d88-80d2-865a3937e91e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroDeOcorrencias\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(bodyConsultaOcorrenciaLista) {\n\ttry {\n\t\tlet ocorrencias = JSON.parse(bodyConsultaOcorrenciaLista).data;\n\t\tlet numInt = ocorrencias.length;\n\t\tif (numInt == 0) {\n\t\t\treturn \"ZERO\"\n\t\t}\n\t\tif (numInt == 1) {\n\t\t\treturn \"UM\"\n\t\t}\n\t\telse {\n\t\t\treturn numInt;\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyConsultaOcorrenciaLista"],"outputVariable":"numeroDeProtocolos","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cd459105-5ad7-401e-ae0c-a6ef33f2531c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} protocolo encontrado dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"{{state.name}} protocolo encontrado dados","action":"{{contact.extras.CPF}} | {{contaSelecionada@doc}} | {{numeroProtocolo}} | {{protocoloEncontrado}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"protocoloEncontrado"}]},{"$id":"be67abfe-ef91-466e-ab03-a9f7bc67b60e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} protocolo encontrado validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"{{state.name}} protocolo encontrado validacao","action":"{{protocoloEncontrado}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"protocoloEncontrado"}]},{"$id":"7a3ac1cd-c4fa-4572-a9e6-e93d5272cbc9","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"SPD Maquina Safrapay {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/protocolos/{{numeroProtocolo}} | GET | {{statusConsultaProtocolo}} | {{bodyConsultaProtocolo}}"},"conditions":[]},{"$id":"d5dfafd8-6883-4d77-bd0a-bf60787616a0","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}","CPF":"{{contact.extras.CPF}}"},"category":"SPD Maquina Safrapay {{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/operacoes-execucoes/servicos-operacionais/protocolos/assistente-virtual/v1/ocorrencias?idProtocolo={{numeroProtocolo}} | GET | {{statusConsultaProtocoloLista}} | {{bodyConsultaProtocoloLista}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-acd53740-b7fb-4bb7-8336-cdce76e01e0f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8c86c9c0-235c-4a55-ad47-e41b053755f7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c5bad9b8-5b73-46aa-b87c-012973304cb4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"e4d6612a-10e4-46cb-bb7a-fee228cb3415","root":false,"$title":"[BC.9.0.2][HTTP] Api Consulta Status Protocolo","$position":{"top":"1145px","left":"1794px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"invalidOutputs":true},"64589b8f-3923-48f8-8112-b1612dc8ab30":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"be995d4a-518e-48f6-9a34-9a416021ac7d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1694"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"64589b8f-3923-48f8-8112-b1612dc8ab30","root":false,"$title":"[GO TO][Redirect] to Finalizacao (finalizado)","$position":{"top":"1618px","left":"1795px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4ae632bf-24da-45d5-bb33-b01433e01bee":{"$contentActions":[{"action":{"$id":"6169cc8c-e886-450c-9d91-2c47618325dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0aa92b4b-4ad9-4968-9532-db204028dca4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0aa92b4b-4ad9-4968-9532-db204028dca4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c565599-891e-49bc-ae39-4a6ff7cc7872","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c43970e1-c31c-4319-a538-5017df838d02","type":"text/plain","content":"Tive um problema interno e não encontrei os dados do protocolo.\n\nPor gentileza, tente acessar as informações através dos autoserviços do chatbot.","metadata":{}},"$cardContent":{"document":{"id":"c43970e1-c31c-4319-a538-5017df838d02","type":"text/plain","content":"Tive um problema interno e não encontrei os dados do protocolo.\n\nPor gentileza, tente acessar as informações através dos autoserviços do chatbot."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f96b9906-5cd8-4a3d-b543-b000c8761765","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2914753b-9c0f-404e-8ca1-c56f455c4ed6","typeOfStateId":"state","$connId":"con_113","$id":"3b93a17d-37ec-49a5-a720-ab7f40e6f6a1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"64589b8f-3923-48f8-8112-b1612dc8ab30","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6ae88c7b-2641-4ebd-aac9-8c843a9e42fb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4ae632bf-24da-45d5-bb33-b01433e01bee","root":false,"$title":"[BC.9.0.6] Não Encontrado","$position":{"top":"1274.22px","left":"2247.44px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2914753b-9c0f-404e-8ca1-c56f455c4ed6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"be995d4a-518e-48f6-9a34-9a416021ac7d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2914753b-9c0f-404e-8ca1-c56f455c4ed6","root":false,"$title":"[GO TO][Redirect] to Finalizacao (finalizado)","$position":{"top":"1434.22px","left":"2247.44px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ed72f47e-10eb-40d4-8e7c-21263d85a48e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"314dd865-7fe1-4276-af20-5567014eb6a7","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4d6612a-10e4-46cb-bb7a-fee228cb3415","typeOfStateId":"state","$connId":"con_118","$id":"96cf25dc-61ff-491a-a21d-1375d2c3ed4b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f373a4d-0201-4c29-8e9a-5f151816d10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"fe319907-8b8e-446d-9bed-4223996dd5cf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fcbf5dea-5071-4b71-883f-ceb7cc0ddec2","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"1bdaf4da-b341-4c8b-8d9c-e3490030be0d","$typeOfContent":"","type":"SetVariable","$title":"Set \"idSessao\"","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-75b5c742-56d4-4290-b4b9-87ba0d0e956f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-eae02b2f-bc7a-4c2d-827e-4e78ea43d0a8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5f58626a-49e3-406d-8ad0-7cb4ecece02e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-8bd539f3-5002-4e02-843c-7fe0ffa31055","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ed72f47e-10eb-40d4-8e7c-21263d85a48e","$title":"[BC.9.0.1][MSG][HTTP] Criar Token","$position":{"top":"981px","left":"1795px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"broadcast","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/betabroadcastpessoajuridica","routerKey":"Key cm91dGVyYmV0YXdoYXRzYXBwcGo6Y28yQ3UxSGtoMW9tQVhTejNJSUI=","routerKeyBroadcast":"Key cm91dGVyYnJvYWRjYXN0cGo6eDZLODNkaW9LNDZ2MU5PejNyeW4="},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}