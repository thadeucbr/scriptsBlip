{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"f9dd120e-024a-4544-9c88-aad781313623","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"d7411888-b223-44ea-8adc-853b2be5fb0c","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","typeOfStateId":"state","$connId":"con_3","$id":"11a69cb0-0fe0-411d-b7e4-51b72e5b8773","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f6399094-beb7-4ea2-bf71-b205614f1e97","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"9ed83b55-8fac-4c5d-9645-3ce28ed48497","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-84bbe857-3947-41d5-982a-73a2829ba88a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fea54b9d-07cd-4055-a879-a2161c8d2225","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ebada0c1-328c-497d-b901-e90d79835257","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"36.3333px","left":"2065.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"127c233a-774d-4815-8878-b660a8e1b3d8","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"85c901f2-e8b4-49ca-97d4-e1becccc4cb1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$id":"b4906de6-3af7-45cd-bd5e-54da2289f776","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[{"$id":"76756741-01db-49f7-ad13-77eb651a785f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(previousBlockId, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"85c901f2-e8b4-49ca-97d4-e1becccc4cb1","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-e377553c-cc30-4a2a-9e6f-af9c1b8f3a48","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"34px","left":"164px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cac63fde-6671-4aa1-9a67-efc2f5336711":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5645aa88-959e-46a7-af25-0e32ed445e49","typeOfStateId":"state","$connId":"con_13","$id":"57625472-6942-43b7-acc1-422abf536dd2","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"55ffe85b-9014-42b0-bc52-2118de1c6299","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Chamada de API\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"consulta taxas de atencipação do plano"},"conditions":[]},{"$id":"e448899d-10fa-4137-81e9-3cf6f9cd8551","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao","responseStatusVariable":"taxaStatus","responseBodyVariable":"taxaBody"},"conditions":[]},{"$id":"695557b3-8de1-433c-9df5-df9491e5b200","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAntecipacao\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.data\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaBody"],"outputVariable":"taxaAntecipacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8a14a865-fe46-4720-a100-febd2918a05f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaModalidade\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.modalidade\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaModalidade","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"33134da2-5316-46f3-b06b-23738c3b2e35","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"e124f1ba-0f80-43e3-b22f-dccd563df622","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a30aca83-daca-4da9-88f4-19ae7374b1db","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"7bbfbe91-5ba8-4379-a8cf-6c66b30c3428","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["taxaStatus","taxaVendasStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ea090d9-c6dc-44f9-aa94-2aa424b7d682","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao | GET| {{taxaStatus}} | {{taxaBody}}"},"conditions":[]},{"$id":"56ee3b0c-33c8-4053-aad5-2984812f2309","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}} | GET| {{taxaVendasStatus}} | {{taxaVendasBody}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"039d734d-1018-497c-83da-7a9e5f1e8b1c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]},{"$id":"4839e6b5-2855-4473-af1a-2e8b91aff380","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaStatus"}]},{"$id":"b539c9a2-fc50-41f5-b2c3-6c5561710345","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"taxaStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-5dd514f1-d1bf-4f1e-9699-be86497379f0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3582830c-4698-4f1d-88fc-96bda3a376cc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-3a05bc4e-2f15-40ec-8935-3061af213a87","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7031e391-0c87-4472-8ae5-7ad520ab9ddd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"cac63fde-6671-4aa1-9a67-efc2f5336711","root":false,"$title":"[TC.3.0.0][HTTP] API Taxas de Antecipação","$position":{"top":"449px","left":"4250px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"24ee326c-2f65-4cf1-944e-2b178eaf2a82":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"45ec8433-22a9-4498-8005-c3c52f7ce6bc","typeOfStateId":"state","$connId":"con_18","$id":"c3cccbbb-a3c1-4124-945b-420030956119","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_23","$id":"53da15ed-8049-4435-a181-80e69abf758e","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["A"],"source":"context","comparison":"equals","variable":"tipoMaquina"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_28","$id":"2a189d77-5c94-47b5-bfbf-febebd903c24","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["C"],"source":"context","comparison":"equals","variable":"tipoMaquina"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"46f819c5-9a97-4c4c-9a09-e363d6736ae1","typeOfStateId":"state","$connId":"con_33","$id":"48a23afc-2c9c-4282-8bc9-376125d176ed","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["11"],"variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"bb74c3c9-73bc-4030-ae90-62acb134db5e","typeOfStateId":"state","$connId":"con_38","$id":"6a138384-8997-4175-9063-cb4f19baae61","conditions":[{"source":"context","comparison":"equals","values":["A"],"variable":"tipoMaquina"},{"values":["10"],"source":"context","comparison":"lessThanOrEquals","variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"bb74c3c9-73bc-4030-ae90-62acb134db5e","typeOfStateId":"state","$connId":"con_43","$id":"aec68847-2054-483c-8ae2-b5a28152d65e","conditions":[{"source":"context","comparison":"equals","values":["C"],"variable":"tipoMaquina"},{"values":["10"],"source":"context","variable":"sizeMaquinas","comparison":"lessThan"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"83910691-760e-4cc7-b210-e3aa8c707efa","typeOfStateId":"state","$connId":"con_48","$id":"1a8bd161-d3e3-4bcf-a358-1419b759434e","conditions":[{"source":"context","comparison":"lessThanOrEquals","values":["10"],"variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"46f819c5-9a97-4c4c-9a09-e363d6736ae1","typeOfStateId":"state","$connId":"con_53","$id":"5b1b40ec-7586-4185-bd08-b6ebc8a72f32","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"eeb8160f-35db-40c7-9e1c-6f35beaea83b","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Consulta máquinas disponíveis para EC."},"conditions":[]},{"$id":"a13ebe5a-7f0a-4cda-9ee7-5cec03846cd2","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"consultMaquina\" (Terminais)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/terminais?codigoEstabelecimentoComercial={{selectedEc@codigoEc}}","responseStatusVariable":"consultMaquinaStatus","responseBodyVariable":"consultMaquina"},"conditions":[]},{"$id":"67249656-098d-40c5-bb65-ca13fcdc48a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"tipoMaquina\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(consultMaquina) {\n  try {\n    let consultMaquina = JSON.parse(consultMaquina);\n\n    function retronarModalidadeA(value) {\n      if (value.modalidade == 'A')\n        return value;\n    }\n    function retronarModalidadeC(value) {\n      if (value.modalidade == 'C')\n        return value;\n    }\n    function retronarModalidadeV(value) {\n      if (value.modalidade == 'V')\n        return value;\n    }\n\n    let var1 = consultMaquina.data.filter(retronarModalidadeA);\n    let var2 = consultMaquina.data.filter(retronarModalidadeC);\n    let var3 = consultMaquina.data.filter(retronarModalidadeV);\n    let retorno = \"\"\n    if (var1.length > 0 && var3.length > 0 || var2.length > 0 && var3.length > 0) {\n      retorno = \"A e C\"\n    } else if (var1.length > 0 || var2.length > 0) {\n      retorno = \"A\"\n    } else {\n      retorno = \"C\"\n    }\n    return retorno;\n  } catch (e) {\n    return e.message;\n  }\n\n}","inputVariables":["consultMaquina"],"outputVariable":"tipoMaquina","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]},{"$id":"54d01726-4eac-4f8a-ae09-305086f7178b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sizeMaquinas\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina) {\n\ttry {\n\t\tlet consultMaquina = JSON.parse(consultMaquina);\n\t\tlet sizeMaquina = consultMaquina.data.length\n\t\treturn sizeMaquina;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["consultMaquina"],"outputVariable":"sizeMaquinas","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]},{"$id":"6b251080-10aa-4802-b35c-6155039fd27f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"modalidadeMaquina\"","$invalid":false,"settings":{"function":"run","source":"function run(tipoMaquina) {\n\ttry {\n\t\tif (tipoMaquina == \"A\") {\n\t\t\treturn \"Alugada\"\n\t\t}\n\t\telse {\n\t\t\treturn \"Comprada\"\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["tipoMaquina"],"outputVariable":"modalidadeMaquina","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"16d4e121-6af2-46fe-afaf-4f31b54688fa","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"ces\"","$invalid":false,"settings":{"variable":"pesquisa","value":"ces"},"conditions":[]},{"$id":"af2ef353-47c2-4a32-8408-672c7f3282f2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"08d7d24b-5e16-45e7-a4ee-70be9883bb6c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"e6862cf0-cf57-41e7-b2b1-07e5e6e90370","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["consultMaquinaStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"00575c53-9dc5-4af6-9d28-bd664c98d4d7","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/terminais?codigoEstabelecimentoComercial={{selectedEc@codigoEc}} | GET| {{consultMaquinaStatus}} | {{consultMaquina}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"73b7890c-1d3b-4f50-a276-4eb5eb14699b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"541ea020-0b25-478a-8e9d-6a0c97812fa6","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"nomeTipoEquipamento\"","$invalid":false,"settings":{"variable":"nomeTipoEquipamento"},"conditions":[]},{"$id":"acfd5218-7228-4815-9bde-46c364008291","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"numeroserie\"","$invalid":false,"settings":{"variable":"numeroserie"},"conditions":[]},{"$id":"9bc602fe-e7b0-4d49-8d78-ce76d9ff7e4f","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"valorTabela\"","$invalid":false,"settings":{"variable":"valorTabela"},"conditions":[]},{"$id":"6657d45e-9e92-40a2-b997-6cdb13bfde25","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"valorPago\"","$invalid":false,"settings":{"variable":"valorPago"},"conditions":[]},{"$id":"b7ca2944-7897-4bd5-95f9-9c991e1cae8c","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"faturamentoMensal\"","$invalid":false,"settings":{"variable":"faturamentoMensal"},"conditions":[]},{"$id":"9097bcd6-1bfb-4820-82c9-c6429263d9ed","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"faturamentoAnual\"","$invalid":false,"settings":{"variable":"faturamentoAnual"},"conditions":[]},{"$id":"e1befccd-127f-4747-bf79-3f4187753222","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"valorTabela\"","$invalid":false,"settings":{"variable":"valorTabela","value":""},"conditions":[]},{"$id":"44a9ebad-5310-449d-a68e-434c2188b576","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"faturamentoAnual\"","$invalid":false,"settings":{"variable":"faturamentoAnual","value":"0"},"conditions":[]},{"$id":"87389c53-a6da-472f-861b-d96b28a27607","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroSerie\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tlet numeroSerie = consultMaquina.data[0].numeroSerie\n\t\treturn numeroSerie;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["consultMaquina"],"outputVariable":"numeroSerie","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]},{"$id":"122234b9-5481-42a8-aa78-4808635e2a07","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroLogico\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tlet numeroLogico = consultMaquina.data[0].numeroLogico\n\t\treturn numeroLogico;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["consultMaquina"],"outputVariable":"numeroLogico","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f3ca2975-208b-4563-8c8b-8a630b06b181","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a9b8a7e4-bf67-447f-ab38-46c782bc8626","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-906fcd31-1ec4-44df-bfe7-2f4f539fec66","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c062997a-88b0-40d5-9bb3-42d7c801c6f1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"24ee326c-2f65-4cf1-944e-2b178eaf2a82","root":false,"$title":"[TC.4.0.0][HTTP] API Consultar Máquinas","$position":{"top":"378.889px","left":"1155.78px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4a101355-7808-4bb7-a96d-7053a966074a":{"$contentActions":[{"action":{"$id":"926c7202-1e44-49de-962a-349238c2cba8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4e2a9b99-e0af-42b7-baed-11cbbaa7369c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4e2a9b99-e0af-42b7-baed-11cbbaa7369c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"55a10321-ecb4-4ab7-a368-b65761bea3b8","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"722bd745-fd0f-4ade-9937-852d7db9e165","typeOfStateId":"state","$connId":"con_58","$id":"69ef53aa-1708-4fbb-91cb-a8d04011ba17","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6288fd61-64e2-4e1d-9dcb-569b499aea7a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Valor divergente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Cobrança duplicada\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Outros motivos\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Para podermos entender melhor, escolha uma das opções abaixo. 👇 \";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"be3510e5-7f5f-49aa-bcd5-35df5694c9e6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"4d426545-1d43-4f3a-984a-f0f255b4ea5d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]}],"$leavingCustomActions":[{"$id":"dc186f16-cee1-48e0-afb4-90d8615f9955","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-0f8c1e1e-0471-475a-94d8-39ebbbf91e8e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fcfbadb4-c84f-43d6-a62a-41ddae06fdec","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-95cd8f9f-09f0-4390-acac-f9e0b18bbacf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d2123fbd-9c12-4fbf-ad51-cb46beff45ea","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4a101355-7808-4bb7-a96d-7053a966074a","root":false,"$title":"[TC.7.0.0][MSG] Questionar uma cobrança","$position":{"top":"399px","left":"3266.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e912e94c-247f-4ad6-abec-f42562d981a0":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"fbfbbf55-3fd8-42df-9c52-1fa32ab0d86e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"82358327-d2c4-40da-a143-48cc6a090bad","typeOfStateId":"state","$connId":"con_63","$contentId":"8702cb7b-c61e-4284-b4e1-f75632e772f3","$id":"1c793d1b-4d9c-4025-90cd-698b39ed0f37","conditions":[{"source":"context","comparison":"equals","values":["Vendas Online","Vendas Físicas"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"11d3e430-a83a-412f-9a45-b815c8d231c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8d005c35-9919-4762-a56a-1808f568758b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, salesPaymentType) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"venda f[ií]sica\": \"Venda Física\",\n      \"venda online|venda digital\": \"Venda Online\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8b4d028-59bf-48d1-be68-5eb55bfbb0f9","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxModality\" with \"userInput\"","$invalid":false,"settings":{"value":"{{userInput}}","variable":"taxModality"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"639ae723-4c8f-4537-8c9c-15eafc103843","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"cc45bca6-a1e5-4bfb-80eb-37f50fb5bb08","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"63331023-2b40-48de-bf0a-7d63973d6574","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Vendas Online","Vendas Físicas"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-91f1216e-2f59-404f-80c0-ca9fee996bfa","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-910a9a1f-4cc0-4323-83f4-2f1c3126dbc6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-389c3148-111d-4a93-b99a-92d2ecb90d9f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-34459402-c6e9-4c72-afe5-65907ab7ef2c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e912e94c-247f-4ad6-abec-f42562d981a0","root":false,"$title":"[TC.2.0.2][INPUT] Modalidade de venda","$position":{"top":"1330.21px","left":"294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4dfbe4df-5b62-4c68-9130-ab7ccec1756b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06094d8f-981b-4ac3-a526-af631e3f4600","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"313d8fd3-b86e-48a6-91d5-803adf2aa7d6","typeOfStateId":"state","$connId":"con_68","$contentId":"0e9a72e1-c51b-497a-8f60-ae80a6000813","$id":"65252d08-2925-4a46-9e47-b8a888193b6b","conditions":[{"source":"context","comparison":"equals","values":["Visa","Elo","Amex","Master","Hiper"],"variable":"userInput"},{"values":[],"source":"context","comparison":"exists","variable":"taxasExibir@taxaDebitoAvistaEcommerce"}],"$invalid":false},{"stateId":"82358327-d2c4-40da-a143-48cc6a090bad","typeOfStateId":"state","$connId":"con_73","$id":"a42a1689-c4ea-4e9f-a5b8-6355014714a9","conditions":[{"source":"context","comparison":"equals","values":["Elo","Amex","Hiper","Master","Visa"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"05482743-ecc7-4eae-96d3-ee4227e6527a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a2f27600-bc34-4e24-acca-19c4613242ea","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxModality\" to \"Vendas Físicas\" if taxaDebitoAvistaEcommerce NOT EXIST","$invalid":false,"settings":{"variable":"taxModality","value":"Vendas Físicas"},"conditions":[]}],"$leavingCustomActions":[{"$id":"22544a01-53d2-4dcb-aced-ddb4bb463c2e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"Master\": \"Master\",\n      \"Visa\": \"Visa\",\n      \"Elo\": \"Elo\",\n      \"Amex\": \"Amex\",\n      \"Hiper\": \"Hiper\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c054b662-39ca-4707-92a1-404817bd887a","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"55c74ed8-2695-46aa-ac96-1cf27d4caa33","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxCardFlag\" with \"userInput\"","$invalid":false,"settings":{"value":"{{userInput}}","variable":"taxCardFlag"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ba43bc26-d89c-4d11-bda1-82dc51e510b9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxasExibir\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaVendasBody, bandeira) {\n\ttry {\n\t\tbandeira.toLowerCase();\n\t\tbandeira = bandeira.replace('master', 'MSTC').replace('visa', 'VISA').replace('hiper', 'HIPC').replace('elo', 'ELOC').replace('amex', 'AMXC');\n\t\ttaxaVendasBody = JSON.parse(taxaVendasBody);\n\t\ttaxaVendasBody = taxaVendasBody.data\n\t\ttaxaVendasBody = taxaVendasBody.filter(taxaVendasBody => (taxaVendasBody.codigoBandeira == bandeira))\n\t\ttaxaVendasBody = taxaVendasBody[0]\n\t\treturn JSON.stringify(taxaVendasBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaVendasBody","taxCardFlag"],"outputVariable":"taxasExibir","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"867b8492-1a86-4037-8bbd-4460a5c70194","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"89766afe-5cc2-4c7b-8525-7611f9729cf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Master","Visa","Elo","Amex","Hiper"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-9ccf72d9-6e42-4390-bb9f-f0ba2823910c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f16c4d8d-a247-4141-8a0a-f3e70f2f9b92","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5a006e0b-bea5-4aa6-8976-dba2936f48b5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9524ec9d-4f23-4805-ae38-1b9d8a6dada0","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4dfbe4df-5b62-4c68-9130-ab7ccec1756b","root":false,"$title":"[TC.2.0.1][INPUT] Selecao Bandeiras","$position":{"top":"839px","left":"321.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"82358327-d2c4-40da-a143-48cc6a090bad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e49b1f29-6b97-4331-a5e9-db2cad2b0715","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0f2ef715-e474-48e3-9642-ca975864c269","typeOfStateId":"state","$connId":"con_78","$id":"41318e27-1eba-4c23-952a-ce44edbcefe7","conditions":[{"source":"context","comparison":"equals","values":["Vendas Online"],"variable":"taxModality"},{"values":["Amex","Hiper"],"source":"context","comparison":"equals","variable":"taxCardFlag"}],"$invalid":false},{"stateId":"98c7523a-b7d2-49ab-bab8-c47926549497","typeOfStateId":"state","$connId":"con_83","$id":"77b3b24c-ec41-4614-85e9-ac4cfb7c2744","conditions":[{"source":"context","comparison":"equals","values":["Vendas Físicas"],"variable":"taxModality"},{"values":["Amex","Hiper"],"source":"context","comparison":"equals","variable":"taxCardFlag"}],"$invalid":false},{"stateId":"f518ebdc-b60f-4359-9584-38c43f13952d","typeOfStateId":"state","$connId":"con_88","$id":"ff7a7dd4-e58b-4b6e-bd9a-a6f7225748a6","conditions":[{"source":"context","comparison":"equals","values":["Vendas Online"],"variable":"taxModality"}],"$invalid":false},{"stateId":"e383d0a7-ef06-403b-9293-485753c8ceb0","typeOfStateId":"state","$connId":"con_93","$id":"4fef2789-2bfd-48cc-b907-f23ac2a31716","conditions":[{"source":"context","comparison":"equals","values":["Vendas Físicas"],"variable":"taxModality"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3095bc08-c646-4fcc-92c0-4c74df9052fc","$typeOfContent":"","type":"ExecuteScript","$title":"taxasExibir","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(taxaVendasBody, modalidade, bandeira) {\n\n\ttry {\n\n\n\t\tbandeira = bandeira.replace('Master', 'MSTC').replace('Visa', 'VISA').replace('Hiper', 'HIPC').replace('Elo', 'ELOC').replace('Amex', 'AMXC');\n\t\ttaxaVendasBody = JSON.parse(taxaVendasBody);\n\t\ttaxaVendasBody = taxaVendasBody.data\n\t\ttaxaVendasBody = taxaVendasBody.filter(taxaVendasBody => (taxaVendasBody.codigoBandeira == bandeira))\n\t\ttaxaVendasBody = taxaVendasBody[0]\n\n\n\t\tfunction formatarTaxa(taxa) {\n\t\t\treturn parseFloat(taxa).toFixed(2).toString().replace('.', ',');\n\t\t}\n\n\t\t// Formatar as taxas no objeto\n\t\ttaxaVendasBody.taxaDebitoAvista = formatarTaxa(taxaVendasBody.taxaDebitoAvista);\n\t\ttaxaVendasBody.taxaDebitoAvistaEcommerce = formatarTaxa(taxaVendasBody.taxaDebitoAvistaEcommerce);\n\t\ttaxaVendasBody.taxaDebitoPf = formatarTaxa(taxaVendasBody.taxaDebitoPf);\n\t\ttaxaVendasBody.taxaDebitoPfEcommerce = formatarTaxa(taxaVendasBody.taxaDebitoPfEcommerce);\n\t\ttaxaVendasBody.taxaCreditoAVista = formatarTaxa(taxaVendasBody.taxaCreditoAVista);\n\t\ttaxaVendasBody.taxaCreditoAVistaEcommerce = formatarTaxa(taxaVendasBody.taxaCreditoAVistaEcommerce);\n\t\ttaxaVendasBody.taxaCreditoParcLojista2a6 = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista2a6);\n\t\ttaxaVendasBody.taxaCreditoParcLojista2a6Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista2a6Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParcLojista7a12 = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista7a12);\n\t\ttaxaVendasBody.taxaCreditoParcLojista7a12Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista7a12Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParcEmissor = formatarTaxa(taxaVendasBody.taxaCreditoParcEmissor);\n\t\ttaxaVendasBody.taxaCreditoParcEmissorEcommerce = formatarTaxa(taxaVendasBody.taxaCreditoParcEmissorEcommerce);\n\t\ttaxaVendasBody.taxaCreditoParc2 = formatarTaxa(taxaVendasBody.taxaCreditoParc2);\n\t\ttaxaVendasBody.taxaCreditoParc2Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc2Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc3 = formatarTaxa(taxaVendasBody.taxaCreditoParc3);\n\t\ttaxaVendasBody.taxaCreditoParc3Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc3Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc4 = formatarTaxa(taxaVendasBody.taxaCreditoParc4);\n\t\ttaxaVendasBody.taxaCreditoParc4Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc4Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc5 = formatarTaxa(taxaVendasBody.taxaCreditoParc5);\n\t\ttaxaVendasBody.taxaCreditoParc5Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc5Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc6 = formatarTaxa(taxaVendasBody.taxaCreditoParc6);\n\t\ttaxaVendasBody.taxaCreditoParc6Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc6Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc7 = formatarTaxa(taxaVendasBody.taxaCreditoParc7);\n\t\ttaxaVendasBody.taxaCreditoParc7Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc7Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc8 = formatarTaxa(taxaVendasBody.taxaCreditoParc8);\n\t\ttaxaVendasBody.taxaCreditoParc8Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc8Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc9 = formatarTaxa(taxaVendasBody.taxaCreditoParc9);\n\t\ttaxaVendasBody.taxaCreditoParc9Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc9Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc10 = formatarTaxa(taxaVendasBody.taxaCreditoParc10);\n\t\ttaxaVendasBody.taxaCreditoParc10Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc10Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc11 = formatarTaxa(taxaVendasBody.taxaCreditoParc11);\n\t\ttaxaVendasBody.taxaCreditoParc11Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc11Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc12 = formatarTaxa(taxaVendasBody.taxaCreditoParc12);\n\t\ttaxaVendasBody.taxaCreditoParc12Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc12Ecommerce);\n\n\n\t\treturn JSON.stringify(taxaVendasBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaVendasBody","taxModality","taxCardFlag"],"outputVariable":"taxasExibir","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a802b057-33f7-4a54-bad9-e22e7e336276","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validacao","action":"{{taxModality}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxModality"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-0ffcf6ec-a8f0-46cf-9f8c-487e6db53d8e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ac35a05d-5239-484f-a88b-46fa23c42a7f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"82358327-d2c4-40da-a143-48cc6a090bad","root":false,"$title":"[TC.2.0.2][SET] \"taxasExibir\"","$position":{"top":"1765.75px","left":"323px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64033608-d1fe-4704-aebe-31662a651f61":{"$contentActions":[{"action":{"$id":"36baba7b-a8d0-4106-b820-6e6a8bd18365","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"18e6a934-a151-4bb7-872d-8887f80bac91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"18e6a934-a151-4bb7-872d-8887f80bac91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d6c68d38-7014-4fc3-bfdc-8c1441d50bae","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b6679cd5-e998-4a2e-8a3e-ed2446fb073c","type":"text/plain","content":"Por gentileza, digite, em poucas palavras, o motivo da sua solicitação de revisão de lançamento. ","metadata":{}},"$cardContent":{"document":{"id":"b6679cd5-e998-4a2e-8a3e-ed2446fb073c","type":"text/plain","content":"Por gentileza, digite, em poucas palavras, o motivo da sua solicitação de revisão de lançamento. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ea0411d0-285d-4394-bb28-7e700f3871d5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"faf5caf6-e19a-42eb-9d38-2e4e58acae88","typeOfStateId":"state","$connId":"con_98","$id":"60af1b1b-1cdc-4a88-bc52-d8f5e762df02","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6138dcc7-8d28-4836-9fec-7bd712c70b86","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"49787b51-0156-44fc-8565-77b607d79509","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-097e3652-09a5-4287-ad96-7e5a1b62a24d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-98571f64-c5b3-4bb8-a360-0c4970250ab8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"64033608-d1fe-4704-aebe-31662a651f61","root":false,"$title":"[TC.7.0.1][MSG] Outro Motivo","$position":{"top":"877.714px","left":"3546.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"83910691-760e-4cc7-b210-e3aa8c707efa":{"$contentActions":[{"action":{"$id":"b6502dd7-688f-4c38-ad87-7ae5cbdf9939","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2ff17d64-5871-485c-b2ec-ef3fc8c27323","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2ff17d64-5871-485c-b2ec-ef3fc8c27323","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"db9f433e-7884-4e29-a9a7-0755cfe8c739","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3576eedf-1d52-44fa-8018-41112a232738","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3468fd40-a03c-45dc-b438-f0066d5aee17","typeOfStateId":"state","$connId":"con_103","$id":"ea739db2-e6e6-48f2-8263-c98a9af09947","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"667c6ac4-bb04-4eaf-a048-20bc29f734f2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(salesType) {\n    try {\n        let buttons = [\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"1\",\n                    \"title\": \"Aluguel\"\n                }\n            },\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"2\",\n                    \"title\": \"Comprada\"\n                }\n            }\n        ];\n\n        const headerText = \"Você possui máquinas habilitadas nas modalidades Aluguel e Comprada. Selecione qual deseja consultar. \";\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"button\",\n                \"body\": {\n                    \"text\": headerText,\n                },\n                \"action\": {\n                    buttons\n                }\n            }\n        };\n    } catch (err) {\n        return false;\n    }\n}","inputVariables":["salesType"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0f98036-5458-49f0-b352-322f3681552e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-7586ba31-18c8-482a-88bf-c0fa2d48e876","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-12ac813c-cd4d-4048-af48-a53d1dca3223","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-12e76274-9d29-4f82-b86c-8a4a0f3e98bc","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"83910691-760e-4cc7-b210-e3aa8c707efa","root":false,"$title":"[TC.4.3.0][MSG] Alugada ou Comprada","$position":{"top":"681.889px","left":"1184.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5":{"$contentActions":[{"action":{"$id":"a7559ef9-604b-4b61-bb44-80a554f17f2b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3ff29f1b-1be6-412b-ab1c-5883b8f4f7b4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3ff29f1b-1be6-412b-ab1c-5883b8f4f7b4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6da4ea77-f424-47c6-86dd-b2a533224d46","$typeOfContent":"text","type":"SendMessage","settings":{"id":"29f8529d-076c-4c21-8e18-809d6b00838b","type":"text/plain","content":"{{mensagemMaquinaAlugada}}","metadata":{}},"$cardContent":{"document":{"id":"29f8529d-076c-4c21-8e18-809d6b00838b","type":"text/plain","content":"{{mensagemMaquinaAlugada}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0c472da-c63a-4870-9520-42afef193343","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"df93c738-b6f9-4397-b7d0-e675bb78c31a","typeOfStateId":"state","$connId":"con_108","$id":"dd243811-9c3f-4f57-8174-e2a5ef65144f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"743e198d-4686-487b-881b-25d8d49d3ece","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Consulta Máquinas e traz alugadas."},"conditions":[]},{"$id":"b4375fd5-30ea-4508-9cb1-8c0f6b52aa4d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroLogico\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, numeroSerie) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\t\tlet numeroLogico = consultMaquina[0].numeroLogico\n\t\treturn numeroLogico;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["consultMaquina","numeroSerie"],"outputVariable":"numeroLogico","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"notEquals","variable":"sizeMaquinas"}]},{"$id":"f945c26c-3927-4b58-ab32-2952c7ff388f","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyAlugueis\" (alugueis)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/alugueis?tipoFiltro=EC&valorFiltro={{selectedEc@codigoEc}}","responseStatusVariable":"statusAlugueis","responseBodyVariable":"bodyAlugueis"},"conditions":[]},{"$id":"ef93b2bc-a02a-4af5-973c-5c458110dede","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyApolice\" (apolices)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/vendas/seguros/assistente-virtual/v1/clientes/{{contaSelecionada@doc}}/apolices?codigoProduto=7105","responseStatusVariable":"statusApolice","responseBodyVariable":"bodyApolice"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusAlugueis"}]},{"$id":"ccc207e0-7789-4e3f-acd3-bf663d6f6534","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyFaturamentoAnual\" (Faturamento Anual)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/faturamentos?codigoEstabelecimentoComercial={{selectedEc@codigoEc}}&view=Anual","responseStatusVariable":"statusFaturamentoAnual","responseBodyVariable":"bodyFaturamentoAnual"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusAlugueis"}]},{"$id":"9bd06132-6d83-48c5-b4a0-2e51b97ecf41","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyFaturamentoMensal\" (Faturamento Mensal)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/faturamentos?codigoEstabelecimentoComercial={{selectedEc@codigoEc}}&view=Mensal","responseStatusVariable":"statusFaturamentoMensal","responseBodyVariable":"bodyFaturamentoMensal"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusAlugueis"}]},{"$id":"3e2d9fbf-e178-4d07-bfcb-f232e7753a58","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"nomeTipoEquipamento\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(numeroSerie, consultMaquina, tipoMaquina) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\t\tlet codigoTipoEquipamento = consultMaquina[0].codigoTipoEquipamento\n\t\tcodigoTipoEquipamento = codigoTipoEquipamento.toString()\n\t\tif (consultMaquina == \"C\") {\n\t\t\tif (codigoTipoEquipamento == 1 || codigoTipoEquipamento == 5) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t\t} else if (codigoTipoEquipamento == 2) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t\t} else if (codigoTipoEquipamento == 3) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t\t} else {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t\t}\n\t\t} else {\n\t\t\tif (codigoTipoEquipamento == 15) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t\t} else if (codigoTipoEquipamento == 5) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t\t} else if (codigoTipoEquipamento == 1) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t\t} else {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t\t}\n\t\t}\n\t\treturn codigoTipoEquipamento;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["numeroSerie","consultMaquina","tipoMaquina"],"outputVariable":"nomeTipoEquipamento","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"81a93fda-a400-4250-abe2-9795c97ee2a3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"descricaoStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyApolice) {\n\ttry {\n\t\tlet bodyApolice = JSON.parse(bodyApolice);\n\t\tlet descricaoStatus = bodyApolice.data[0].descricaoStatus\n\t\treturn descricaoStatus\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyApolice"],"outputVariable":"descricaoStatus","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusApolice"}],"continueOnError":true},{"$id":"3f09cd4c-bd14-4a30-8ceb-a0fd50182141","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"mensagemMaquinaAlugada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyApolice, bodyAlugueis, bodyFaturamentoMensal, bodyFaturamentoAnual, numeroSerie, numeroLogico, consultMaquina) {\n    try {\n        mensagem = ''\n        bodyAlugueis = JSON.parse(bodyAlugueis);\n        bodyApolice = JSON.parse(bodyApolice);\n        consultMaquina = JSON.parse(consultMaquina);\n        bodyFaturamentoMensal = JSON.parse(bodyFaturamentoMensal);\n        bodyFaturamentoAnual = JSON.parse(bodyFaturamentoAnual);\n\n        const formartValue = (valor) => {\n            return `R$ ${\n                parseFloat(valor)\n                    .toFixed(2)\n                    .replace(\".\", \",\")\n                    .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")}`;\n        }\n        if (consultMaquina.data) {\n            consultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie === numeroSerie))\n            mensagem += `<b>{{nomeTipoEquipamento}}</b>\\n<b>N° de série:</b> ${numeroSerie}\\n\\n`\n        }\n        if (bodyAlugueis.data.length > 0) {\n            bodyAlugueis = bodyAlugueis.data.filter(bodyAlugueis => (bodyAlugueis.numeroSerie === numeroSerie))\n            mensagem += `<b>Aluguel contratual:</b> ${formartValue(bodyAlugueis[0].valorTabela)}/ mês \\n<b>Último valor pago:</b> ${formartValue(bodyAlugueis[0].valorPago)}\\n\\n`\n        }\n        if (bodyApolice.data) {\n            bodyApolice = bodyApolice.data.filter(bodyApolice => (bodyApolice.numeroSerie === numeroSerie))\n            if (bodyApolice.descricaoStatus === 'Vigente') {\n                mensagem += `<b>Seguro:</b> R$9,90/ mês\\n\\n`\n            }\n        }\n        if (bodyFaturamentoMensal.data) {\n            if (bodyFaturamentoMensal.data.length > 0) {\n                bodyFaturamentoMensal = bodyFaturamentoMensal.data.filter(bodyFaturamentoMensal => (bodyFaturamentoMensal.numeroLogico === numeroLogico))\n                if (bodyFaturamentoMensal.length > 0) {\n                    mensagem += `Valor realizado até agora: \\n• <b>Mensal:</b> ${formartValue(bodyFaturamentoMensal[0].vopRealizado)} \\n`\n                }\n            }\n        }\n        if (bodyFaturamentoAnual.data) {\n            if (bodyFaturamentoAnual.data.length > 0) {\n                bodyFaturamentoAnual = bodyFaturamentoAnual.data.filter(bodyFaturamentoAnual => (bodyFaturamentoAnual.numeroLogico === numeroLogico))\n                if (bodyFaturamentoAnual.length > 0) {\n                    mensagem += `• <b>Anual:</b> ${formartValue(bodyFaturamentoAnual[0].valorVop)} \\n`\n                }\n            }\n        }\n        return mensagem\n\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyApolice","bodyAlugueis","bodyFaturamentoMensal","bodyFaturamentoAnual","numeroSerie","numeroLogico","consultMaquina"],"outputVariable":"mensagemMaquinaAlugada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"331d0cfe-8f21-4e6b-87ea-bd016f72fca6","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"a165671c-1bc6-43c1-8c62-d50531a04443","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"773fb672-7ef9-4df9-8e90-7fea3e31c9e0","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{statusAlugueis}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusAlugueis"}]},{"$id":"e51f1266-ddf0-4ee0-bb32-27cd18cd0f5a","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status 2","action":"{{statusApolice}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusApolice"}]},{"$id":"0ab29457-7b41-4896-9e3b-e7c99792296e","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status 3","action":"{{statusFaturamentoAnual}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusFaturamentoAnual"}]},{"$id":"f1b9ae80-d4d3-441e-9dc8-35273e3e2f1b","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status 4","action":"{{statusFaturamentoMensal}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusFaturamentoMensal"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-a24bbbf9-7e34-431f-9caf-035ee89aa4fe","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d259102a-a765-47b2-bb2e-2ab63ee755c1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-80561e1a-b24a-46bb-ba5e-3a756359f3d7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0811961d-be4a-495f-b3e3-d6bae94349b6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0606ba19-6171-4255-9aa7-4b3b10aa82cf","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","root":false,"$title":"[TC.4.5.0][HTTP][SET] Alugada","$position":{"top":"2083px","left":"1154.78px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"df93c738-b6f9-4397-b7d0-e675bb78c31a":{"$contentActions":[{"action":{"$id":"a71e0bce-a782-46b5-bf01-04c73b606c6f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"709715e4-9064-427f-88d0-49e875601b97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"709715e4-9064-427f-88d0-49e875601b97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c998f964-8494-4c94-bc53-3393584d5e54","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"73db3d78-b7a6-40d2-aed0-09ed45b00c7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a987eb86-a520-4671-9e28-bcc98388eff4","typeOfStateId":"state","$connId":"con_113","$id":"5a504020-bbcf-44d3-8358-f38efe497ed6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e89a9dc1-f632-4dda-8ae2-a187c0eda3fe","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a3c64b9c-7dbb-4838-bf79-71c6dbd8f1dc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada);\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Fazer outra Consulta\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tbuttons = buttons.filter((reply) => reply.reply.title !== 'Falar com gerente');\n\t\t}\n\t\t\n\t\tconst headerText = \"Como deseja prosseguir?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"873bff77-5942-43cf-b93e-c243b97775c1","$typeOfContent":"","type":"TrackEvent","$title":"Track validação","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{input.content}}"},"conditions":[{"values":["Fazer outra consulta","Encerrar"],"source":"input","comparison":"equals"}]},{"$id":"9a451ad2-91d5-434e-9fc7-77d891eabd8f","$typeOfContent":"","type":"TrackEvent","$title":"Track input inesperado","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["Fazer outra consulta","Encerrar"],"source":"input","comparison":"notEquals"},{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8269360c-e8b0-46d0-8fd5-735f9b2de804","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0ddf09db-dc32-43bc-bb0a-6451ff8074d5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-772c9483-f9d3-4d33-a0e2-965b1118a6e6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"df93c738-b6f9-4397-b7d0-e675bb78c31a","root":false,"$title":"[TC.4.6.0][MSG] Como deseja prosseguir?","$position":{"top":"2349.33px","left":"1126.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f518ebdc-b60f-4359-9584-38c43f13952d":{"$contentActions":[{"action":{"$id":"778d041a-aed1-4440-9b45-f0f691cf4ee6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4df37b47-c05d-4694-9b73-7d0527269b0f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>            \nDébito {{taxasExibir@taxaDebitoAvistaEcommerce}}%\n\nCrédito à vista {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x {{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%","metadata":{}},"$cardContent":{"document":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>            \nDébito {{taxasExibir@taxaDebitoAvistaEcommerce}}%\n\nCrédito à vista {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x {{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_118","$id":"8d328538-b312-4a47-b244-c1009e93ed53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ec98b5c3-6785-4cc0-a384-c4c54cd055ce","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-53ee9a6a-c248-4aed-b5aa-f9edf23adfa8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cbcdbea7-f9da-479a-a3f3-65964b1432d1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f518ebdc-b60f-4359-9584-38c43f13952d","root":false,"$title":"[TC.2.0.3][MSG] Vendas Online","$position":{"top":"2022px","left":"124px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c4fec3d1-c20d-43de-9160-8a93f67989eb":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"59d0589a-4bfe-427b-bcc3-37affdafab98","typeOfStateId":"state","$connId":"con_123","$id":"618ddfc5-3861-4bf8-bf0f-09716a47ed2f","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6351dc22-dbf5-45ef-8b20-20b11ec58f10","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Chamada de API\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"taxas de venda"},"conditions":[]},{"$id":"d26ebb81-ba5a-4b15-819d-0d6958cb3e2d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"d4ce97b8-edb3-4487-9f2e-fe595994d156","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"65307932-92ca-4dc3-bd89-e10747cf3189","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"782f10e2-21c3-45f2-a538-9e38096e71ac","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["taxaVendasStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4c7456f8-b627-4dad-9114-140625a2d85f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}} | GET| {{taxaVendasStatus}} | {{taxaVendasBody}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"cf099b84-c643-44a6-b404-de4b22643e5b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"taxaVendasStatus"}]},{"$id":"277fd422-273e-4a88-be82-1d17db2f376c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]},{"$id":"56f05097-38b4-44f2-ac67-51e8bf30bd7a","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-effd2fa2-15ed-44d0-af82-2f3e325e275c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0066d9c0-4694-404c-be0c-871a9ca8afc9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-547a99b6-4975-426f-a531-8d7eefa3ef64","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fdeba180-f549-4213-8cdb-ba00ea196aac","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"c4fec3d1-c20d-43de-9160-8a93f67989eb","root":false,"$title":"[TC.2.0.0][HTTP] API Taxas de Venda","$position":{"top":"418px","left":"323px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e383d0a7-ef06-403b-9293-485753c8ceb0":{"$contentActions":[{"action":{"$id":"a8268dd6-051b-4645-be9c-6d892c9de125","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ee0f713e-1ae3-4702-a494-79e02c4d66b2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>              \nDébito {{taxasExibir@taxaDebitoAvista}}%\n\nCrédito à vista {{taxasExibir@taxaCreditoAVista}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%","metadata":{}},"$cardContent":{"document":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>              \nDébito {{taxasExibir@taxaDebitoAvista}}%\n\nCrédito à vista {{taxasExibir@taxaCreditoAVista}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_128","$id":"2b19bb33-2cc7-40d2-929f-3a0129508c75","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b0aee7cc-d081-4b06-8483-6fe6978a463c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8090bc95-0d6f-4408-8f9f-2f6d35c51095","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ce1b3457-ac47-45ed-87bd-0beee12cfc02","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e383d0a7-ef06-403b-9293-485753c8ceb0","root":false,"$title":"[TC.2.0.4][MSG] Vendas Físicas","$position":{"top":"2016px","left":"512px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b8de541a-4234-4125-9502-46ade2ce536a":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0f933b67-ad42-44b2-bcfd-df79cd621cb1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"5d8a18cc-a583-4083-9025-67ca4d472aaf","typeOfStateId":"state","$connId":"con_133","$contentId":"5ee9ede9-f00e-4aa8-912e-ca7d4f80e845","$id":"3377e1e8-dab7-400d-85bf-33928652051d","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"9262b032-7ea2-45d2-b782-2649ddad61b9","typeOfStateId":"state","$connId":"con_138","$id":"686eaa78-4b81-443f-88e2-a0818ad41a76","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false},{"stateId":"4668cb14-a953-4cd6-a7c6-23dc18b0b548","typeOfStateId":"state","$connId":"con_143","$id":"def5478f-e050-4b82-be34-8769215f2dd6","conditions":[{"source":"context","comparison":"equals","values":["Falar com gerente"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e87ccb23-260e-4848-9c4d-86856a602879","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4a07e14c-4fff-4c1e-99e0-aba5811f4fa7","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"82cbc05c-b485-4cbd-b6cf-22003b02f606","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"da4c1bc5-231c-4d5d-9a14-8f6da7cb821e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-a88fe3f1-e62c-4a33-957f-0b34f187cf3e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0b6d5451-21f1-4559-a582-1dafb8945938","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4e34c94f-8de0-4ba8-8141-28d971831ad1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d5b31f61-dda0-4e5d-8f97-2c1c3d0e379b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b8de541a-4234-4125-9502-46ade2ce536a","root":false,"$title":"[TC.2.2.1][INPUT] Consultar Taxas","$position":{"top":"3225.7px","left":"349.435px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5645aa88-959e-46a7-af25-0e32ed445e49":{"$contentActions":[{"action":{"$id":"7dc6c119-7d10-4d3b-b6a6-ea3e5a8433e7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cdd809de-7203-4b20-81da-23a4f30cf05d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cdd809de-7203-4b20-81da-23a4f30cf05d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"97a00499-b5cf-430e-a016-5ffb5474ff9f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7a8e5044-1ad8-4261-b4d8-2bb8d6bb06c4","type":"text/plain","content":"Estas são as taxas de antecipação do seu plano:\n\nCrédito à vista: <b>{{taxaAnteAuto@taxaAVista}}%</b>\n\nCrédito parcelado: <b>{{taxaAnteAuto@taxaParcelado}}%</b>\n\nTaxa Link de Pagamento: <b>R$ 0,90 por transação + MDR E-commerce</b>","metadata":{}},"$cardContent":{"document":{"id":"7a8e5044-1ad8-4261-b4d8-2bb8d6bb06c4","type":"text/plain","content":"Estas são as taxas de antecipação do seu plano:\n\nCrédito à vista: <b>{{taxaAnteAuto@taxaAVista}}%</b>\n\nCrédito parcelado: <b>{{taxaAnteAuto@taxaParcelado}}%</b>\n\nTaxa Link de Pagamento: <b>R$ 0,90 por transação + MDR E-commerce</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"134f75db-4f3c-4658-91e9-26e165171534","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"368ed6d2-36d7-4631-a0b5-982523a88008","typeOfStateId":"state","$connId":"con_148","$id":"915085d6-f45c-432e-9da4-b2aa72db323a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ac61989a-4ee1-47fc-bfed-17ffe2bd31e1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAnteAuto\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.automatica\n\t\ttaxaBody.taxaAVista = parseFloat(taxaBody.taxaAVista).toFixed(2).toString().replace('.', ',')\n\t\ttaxaBody.taxaParcelado = parseFloat(taxaBody.taxaParcelado).toFixed(2).toString().replace('.', ',')\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaAnteAuto","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4a99a272-e297-495d-b3a5-3e10d0eeff74","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ad509b95-5b21-4906-b0b6-afded99d78c1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6e761193-fde7-4c62-ba80-86044f84959f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4deb3046-9f3b-494a-8361-b6bd218c49f3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5645aa88-959e-46a7-af25-0e32ed445e49","root":false,"$title":"[TC.3.1.0][MSG] Exibe Taxas de Antecipação","$position":{"top":"668.667px","left":"4250.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6159148f-ca32-497c-a843-838a5bc20b0e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e6e9700d-c3f2-487e-a7db-d5bd68c88280","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"ba86d697-73e1-47ee-9a6a-0c58a46a207b","typeOfStateId":"state","$connId":"con_153","$contentId":"6936603a-fa1f-4d47-be1b-68d6e7924e62","$id":"b872a097-7b98-44b8-a3d6-f9790c7a3217","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"e1923532-1bfa-4ab5-8de3-6eba5248bfa6","typeOfStateId":"state","$connId":"con_158","$contentId":"6936603a-fa1f-4d47-be1b-68d6e7924e62","$id":"85006734-a60f-4298-b5bf-a2ad964e01fb","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"13e8c63a-d63d-43c5-aba3-e2dffeb86b4b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const validInputMessage = \"Input inesperado\"\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    const regexDictionary = {\n      \"n[ãa]o|naum\": \"Não\",\n      \"sim|sin\": \"Sim\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return validInputMessage\n  } catch (err) {\n    return validInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"55b0637c-cd7c-4bda-ae00-0c782a849a39","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"dda0d594-7c05-4f4b-aa7c-d3b2160c4d54","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"a8298872-dd92-4fba-86ce-1bf343943c9a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-42153ab7-674e-461a-b02f-540b876fbec2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2e4d68db-8614-4938-b210-a8b44aedd368","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3a434fad-012a-4c93-ae0c-03ed20ffa253","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e30daca2-07eb-4288-8ce7-17c2ba20ff17","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6159148f-ca32-497c-a843-838a5bc20b0e","root":false,"$title":"[TC.2.2.2][INPUT] Taxa atual","$position":{"top":"3236px","left":"907.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a65258c3-241a-4ab6-94b7-d3b0cfdb7ccd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c950fde0-4616-49b2-9f39-a0ba859beab4","typeOfStateId":"state","$connId":"con_163","$id":"22905db9-e90e-43ff-8696-1c5190ea55bf","conditions":[{"source":"context","comparison":"equals","values":["SEM ARV","\"SEM ARV\""],"variable":"taxaModalidade"}],"$invalid":false},{"stateId":"c07b1d82-9004-40cc-a93c-f0cabb17f9a7","typeOfStateId":"state","$connId":"con_168","$id":"57625472-6942-43b7-acc1-422abf536dd2","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"taxaModalidade"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd4ca2d9-b36e-40a4-9cae-085b4e5e085a","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"consulta taxas de atencipação do plano"},"conditions":[]},{"$id":"e448899d-10fa-4137-81e9-3cf6f9cd8551","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaBody\" (taxa)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao","responseStatusVariable":"taxaStatus","responseBodyVariable":"taxaBody"},"conditions":[]},{"$id":"695557b3-8de1-433c-9df5-df9491e5b200","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAntecipacao\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.data\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaBody"],"outputVariable":"taxaAntecipacao","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"taxaStatus"}]},{"$id":"8a14a865-fe46-4720-a100-febd2918a05f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaModalidade\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.modalidade\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaModalidade","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"taxaStatus"}]},{"$id":"33134da2-5316-46f3-b06b-23738c3b2e35","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"d567bfc0-f86e-4dea-b20e-af94875bb1bc","$typeOfContent":"","type":"SetVariable","$title":"menuTaxaAntecipacao","$invalid":false,"settings":{"variable":"menuTaxaAntecipacao","value":"true"},"conditions":[]},{"$id":"8c64ff42-a17e-4704-b6db-f97d8a4fb8c6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"928746a8-2536-43c8-8978-eeeafd5edd6e","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]},{"$id":"fcc265ea-5b13-4088-aeeb-cd4b162e7049","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f9d5f884-6091-44e7-9bc4-9320c4ae654b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-546eb473-d2b6-4424-8a6c-b4fe11d13afa","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-907ca74e-fea5-4335-9d28-aff4155eef73","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a8d16c89-bf45-4ab1-9b05-6292298c7ef8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"a65258c3-241a-4ab6-94b7-d3b0cfdb7ccd","root":false,"$title":"[TC.2.2.0][HTTP] API Taxas de Antecipação","$position":{"top":"2724.3px","left":"616.652px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"17828cf7-5217-4cf1-bf9e-1393e96afaac":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b3f2fd0-0767-43e5-bf5c-0e68bd381735","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"ba86d697-73e1-47ee-9a6a-0c58a46a207b","typeOfStateId":"state","$connId":"con_173","$id":"bce4a201-43c2-46d5-a792-7893d09d71cc","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"9262b032-7ea2-45d2-b782-2649ddad61b9","typeOfStateId":"state","$connId":"con_178","$id":"74ac6ea0-7c09-48fe-8bf7-6e64f8221dcd","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"64b2db99-147a-41df-817a-5cec535467fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const validInputMessage = \"Input inesperado\"\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    const regexDictionary = {\n      \"n[ãa]o|naum\": \"Não\",\n      \"sim|sin\": \"Sim\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return validInputMessage\n  } catch (err) {\n    return validInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f3e7f55-532a-433c-804c-b2f0a140fc4f","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"10a069a8-1962-4edc-9831-5baf203f2394","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f50f4e4c-8aa0-4bf2-bc9e-646575d0c32b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Sim","Não"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f76abcc1-03bc-421e-b6b9-a2fe7d546393","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3cf73dd2-6157-4963-babf-347fd9967f43","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-16e45331-d977-4d93-8107-198999229eb8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dea5acda-6f77-4735-87de-5de84e157c5c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"17828cf7-5217-4cf1-bf9e-1393e96afaac","root":false,"$title":"[TC.2.2.3][INPUT] Questionar Transferência","$position":{"top":"3747px","left":"910.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"91dec6e6-2e08-462d-8d81-d38d2b223594":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e96a7ac0-b61c-4db5-b006-4b9ec1d43c9a","typeOfStateId":"state","$connId":"con_183","$id":"d55ad3ed-f8b1-496b-b01c-4626b5519d0f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2f2770af-6c97-4d04-80b0-169de09b0bc6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Chamada de API\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Taxas Pix na Safrapay"},"conditions":[]},{"$id":"e448899d-10fa-4137-81e9-3cf6f9cd8551","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao","responseStatusVariable":"taxaStatus","responseBodyVariable":"taxaBody"},"conditions":[]},{"$id":"33134da2-5316-46f3-b06b-23738c3b2e35","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"695557b3-8de1-433c-9df5-df9491e5b200","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAntecipacao\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.data\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaBody"],"outputVariable":"taxaAntecipacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8a14a865-fe46-4720-a100-febd2918a05f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaModalidade\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.modalidade\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaModalidade","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"491b740f-f7d9-45c5-af29-6333b4449505","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxasPix\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaVendas) {\n\ttry {\n\t\tlet taxaVendasBody = JSON.parse(taxaVendas);\n\t\ttaxaVendasBody = taxaVendasBody.data\n\t\ttaxaVendasBody = taxaVendasBody.filter(taxaVendasBody => (taxaVendasBody.codigoBandeira == 'PIXD'))\n\t\ttaxaVendasBody = taxaVendasBody[0].taxaDebitoAvista\n\t\ttaxaVendasBody = taxaVendasBody.toString().replace('.', ',')\n\t\treturn taxaVendasBody;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaVendasBody"],"outputVariable":"taxasPix","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"195009ac-5895-4746-930f-26f8df5c95b7","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"03a1c0ba-a345-4daa-a5de-905ae4b1e12f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"450b7e0a-0768-4f9e-a899-0aa21b56c4c5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"4127e20c-31ec-4313-80e2-d669c45b8ce3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["taxaStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"10214018-fed3-4950-aeb9-d697b527da11","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao | GET| {{taxaStatus}} | {{taxaBody}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a8a3b25a-5c56-4024-a862-6255368d2a1b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"7e15fb11-de23-458f-b2a4-f52a66f66f70","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{taxaStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaStatus"}]},{"$id":"43f159c7-9d9d-4fb3-be14-20f3a4df1ded","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status 2","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-55265a64-bf16-4e9c-82f3-763c7cac0838","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-eaa8ddd5-0b7b-4f5c-908c-41e11c633e10","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-415eb4cd-3751-4be9-99e0-7fb714bff03f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e707aaa4-7eec-4f94-bd5c-6e6d2d5527f0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"91dec6e6-2e08-462d-8d81-d38d2b223594","root":false,"$title":"[TC.5.0.0][HTTP] API Taxas Pix na SafraPay","$position":{"top":"449px","left":"4506px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"49787b51-0156-44fc-8565-77b607d79509":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"37286ef7-791d-4af5-938f-fd2600482e21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a93d6907-ae20-48eb-afeb-42de5c3bc9ba","typeOfStateId":"state","$connId":"con_188","$id":"1a57abde-00c0-4694-aad8-3bec7368dbe7","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"18eb9e2c-4309-4ebc-81ee-6eecba46c7a3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"ebf8e269-e204-4873-a66f-b1157e4c5094","$typeOfContent":"","type":"SetVariable","$title":"Set \"motivoProtocolo\" to \"questionarUmaCobranca\"","$invalid":false,"settings":{"variable":"motivoProtocolo","value":"questionarUmaCobranca"},"conditions":[]},{"$id":"d46ba7ea-d135-4cb2-9695-f43fc214c06e","type":"ExecuteScript","$title":"Process \"payloadProtocolo\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(contaSelecionada) {\n    try {\n        const { doc, codigoSegmento } = JSON.parse(contaSelecionada)\n        const payload = JSON.stringify({\n            origemDesc: \"CLIENTE\",\n            idSegmento: parseInt(codigoSegmento),\n            CpfCnpj: doc,\n            canalDesc: \"WHATSAPP\",\n            statusDesc: 'ABERTO',\n            usuarioInclusao: 'USR_SPD'\n        })\n        return payload;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\n","inputVariables":["contaSelecionada"],"outputVariable":"payloadProtocolo","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"70cd3530-a826-4b84-9381-0f299c51e143","type":"ProcessHttp","$title":"HTTP POST \"bodyProtocoloBpm\" (Cria Protocolo no Front)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}"},"method":"POST","body":"{{payloadProtocolo}}","uri":"{{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos","responseStatusVariable":"statusProtocoloBpm","responseBodyVariable":"bodyProtocoloBpm"},"conditions":[]},{"$id":"df5da49c-4330-4f1e-902f-115da63bca8a","type":"ExecuteScript","$title":"Process \"idProtocoloBpm\" (Pega Id do protocolo BPM)","$invalid":false,"settings":{"function":"run","source":"function run(protocolo) {\n    try {\n        const protocoloId = JSON.parse(protocolo);\n        return protocoloId.data.id;\n    }\n    catch (err) {\n        return \"Falha ao abrir protocolo, tente novamente em alguns instantes.\"\n    }\n}\n","inputVariables":["bodyProtocoloBpm"],"outputVariable":"idProtocoloBpm","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dd7ad50b-8d3d-4de6-b79e-0589d7bbb546","type":"ExecuteScript","$title":"Process \"descricacaoProtocolo\"","$invalid":false,"settings":{"function":"run","source":"function run(idProtocolo, idSubMotivo, motivoQuestionamentoCobranca, origemCobranca, localVisualizacaoCobranca, dataCobranca, valorCobranca, contaSelecionada, identity) {\n    try {\n        const { doc } = JSON.parse(contaSelecionada);\n        let phone = identity.split('@')[0];\n        const observacaoSolucaoAtendimento = `Criação automática WhatsApp PJ CPF/CNPJ: ${doc} | Telefone: ${phone} | Origem da cobrança: ${origemCobranca} | Local de visualização: ${localVisualizacaoCobranca} | Data da cobrança: ${dataCobranca} | Valor da cobrança: ${valorCobranca} | Motivo do questionamento: ${motivoQuestionamentoCobranca}`\n        return observacaoSolucaoAtendimento;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n","inputVariables":["idProtocoloBpm","idSubMotivo","motivoQuestionamentoCobranca","origemCobranca","localVisualizacaoCobranca","dataCobranca","valorCobranca","contaSelecionada","contact.identity"],"outputVariable":"descricacaoProtocolo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusProtocoloBpm","values":["200"]}]},{"$id":"1e6f0754-21fd-4a65-8ecf-d9945632b0e7","type":"ExecuteScript","$title":"Process \"payloadOcorrencia\" (Gera payload ocorrencia)","$invalid":false,"settings":{"function":"run","source":"function run(body, routerId, motivo, description) {\n    try {\n        const { tipoId, motivoId, subMotivoId } = JSON.parse(body)[routerId][motivo];\n        const newBody = {\n            tipoId,\n            motivoId,\n            subMotivoId,\n            statusProcessamentoDesc: 'ABERTO',\n            usuarioInclusao: 'USR_SPD',\n            observacaoSolucaoAtendimento: description || '',\n            origem: 'CLIENTE',\n        }\n        return newBody\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["resource.taxionomiaProtocolos","tunnel.owner","motivoProtocolo","descricacaoProtocolo"],"outputVariable":"payloadOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fa02da61-b215-4245-b6e4-9797d84c4640","type":"ProcessHttp","$title":"HTTP POST \"bodyOcorrencia\" (Cria nova ocorrencia)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"POST","body":"{{payloadOcorrencia}}","uri":"{{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos/{{idProtocoloBpm}}/ocorrencias","responseStatusVariable":"statusOcorrencia","responseBodyVariable":"bodyOcorrencia"},"conditions":[]},{"$id":"1a912343-f4cf-4034-9475-d65e6eb985c4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusOcorrencia","statusProtocoloBpm"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"9c568522-7ba7-443a-85ed-3614007b6b97","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusOcorrencia"}]},{"$id":"c23312f4-f674-4998-acbe-1c5b77ce59e8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"a079121b-0d85-4eb2-aea4-41eb9f3c20c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api resumo\" (POST) (PROTOCOLO)","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos | {{payloadProtocolo}} | {{statusProtocoloBpm}} | {{bodyProtocoloBpm}}","category":"{{state.name}} api resumo"},"conditions":[]},{"$id":"580ed6dc-82b4-4367-a2a3-a05c5676a816","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api resumo\" (POST) (OCORRENCIA)","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos/{{idProtocoloBpm}}/ocorrencias | {{payloadOcorrencia}} | {{statusOcorrencia}} | {{bodyOcorrencia}}","category":"{{state.name}} api resumo 2"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-4fe51c17-9201-4d46-9a17-79c0078d5b2e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dc25beed-c6e0-4c06-ad46-60287b4419b1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f69c2582-5979-46a5-8d22-8576148e57a4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-14d954c4-2e06-47c7-91ed-7d51a7d83eac","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"49787b51-0156-44fc-8565-77b607d79509","root":false,"$title":"[TC.7.4.0][HTTP] API Protocolo","$position":{"top":"2891px","left":"3067.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"46f819c5-9a97-4c4c-9a09-e363d6736ae1":{"$contentActions":[{"action":{"$id":"63f14278-b91e-4558-9eed-ed6d7a2eb3bb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"83d18b92-19f5-42ec-ae50-e0da12377812","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"83d18b92-19f5-42ec-ae50-e0da12377812","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2789570d-4fd6-40c0-9611-cc39778c9f02","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9d5499f9-da1f-4602-ab14-28cb51b8680c","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, por gentileza, digite o número de série da máquina que deseja consultar. ","metadata":{}},"$cardContent":{"document":{"id":"9d5499f9-da1f-4602-ab14-28cb51b8680c","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, por gentileza, digite o número de série da máquina que deseja consultar. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"08e89268-5095-4ea9-ad7f-0f0acce72de2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7ded1836-11d0-4d83-b483-f13d21231cc1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"7ded1836-11d0-4d83-b483-f13d21231cc1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d14aaf51-691e-4e5a-a959-0c27d9b4d9bf","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b36fd54d-2c70-4f38-b720-a2a46535d8ae","type":"text/plain","content":"Você encontra esse número digitando <b>998</b> na sua maquininha.","metadata":{}},"$cardContent":{"document":{"id":"b36fd54d-2c70-4f38-b720-a2a46535d8ae","type":"text/plain","content":"Você encontra esse número digitando <b>998</b> na sua maquininha."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"dfd199b8-ed5e-44e2-b226-65990f659223","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62786aa5-df6a-4069-9147-36ff1377b02c","typeOfStateId":"state","$connId":"con_193","$id":"4dd0c988-12da-4474-ae18-e5c5a8fa6be7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"96b77a4f-874d-4f45-b466-86bd372dc95b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a6ced512-ff16-421c-839a-6f984ac8a3e8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6eb0aa6e-60eb-4c35-8a13-2e7a4074152d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"46f819c5-9a97-4c4c-9a09-e363d6736ae1","root":false,"$title":"[TC.4.2.0][MSG] Numero de Série (Maquina> 10)","$position":{"top":"1194.67px","left":"927px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e96a7ac0-b61c-4db5-b006-4b9ec1d43c9a":{"$contentActions":[{"action":{"$id":"f8fa853e-700e-4f48-ba19-33f90b6e782f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e57eb20d-7921-4755-a04c-b41513ac6481","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e57eb20d-7921-4755-a04c-b41513ac6481","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff75ff17-3c6e-4acb-82bb-8a0e45e129c3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"dd1844a7-e15f-49a8-9ec9-9eebda2a8c7f","type":"text/plain","content":"É uma taxa de <b>{{taxasPix}}% </b> por transação, descontada de todo valor que você recebe vendendo por QR Code, Pix na maquininha e Pix no link de pagamento.","metadata":{}},"$cardContent":{"document":{"id":"dd1844a7-e15f-49a8-9ec9-9eebda2a8c7f","type":"text/plain","content":"É uma taxa de <b>{{taxasPix}}% </b> por transação, descontada de todo valor que você recebe vendendo por QR Code, Pix na maquininha e Pix no link de pagamento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a99a7d66-b761-4ad6-b03b-8a30b7f3fcca","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"368ed6d2-36d7-4631-a0b5-982523a88008","typeOfStateId":"state","$connId":"con_198","$id":"e129461f-b351-42cb-9ec3-954e34d3f701","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ea6d1af7-f481-4e9c-8c48-cb3937f7b9a0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3cca38ba-47cf-4dab-9270-640074399cfa","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3b7e88e0-44a4-4cc3-a634-b6cab7fddadb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e96a7ac0-b61c-4db5-b006-4b9ec1d43c9a","root":false,"$title":"[TC.5.1.0][MSG] Exibir Taxas Pix na SafraPay","$position":{"top":"682px","left":"4506px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e6bc8ca-977f-40d6-9ccf-23d15a44268b":{"$contentActions":[{"action":{"$id":"5f6b87a3-3944-4115-bc8e-f78cc3186984","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7e0aa8c5-c7e2-465c-adad-5f65ab2a9b85","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7e0aa8c5-c7e2-465c-adad-5f65ab2a9b85","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a167b679-ba67-479e-80f7-b1b7fccce5ff","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cde791f3-9c29-44ec-a661-3110b752a236","type":"text/plain","content":"<b>{{nomeTipoEquipamento}}</b>\n<b>N° de série:</b> {{numeroserie}}\n\n<b>Comprada em:</b> {{dataInstalacao}}\n","metadata":{}},"$cardContent":{"document":{"id":"cde791f3-9c29-44ec-a661-3110b752a236","type":"text/plain","content":"<b>{{nomeTipoEquipamento}}</b>\n<b>N° de série:</b> {{numeroserie}}\n\n<b>Comprada em:</b> {{dataInstalacao}}\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0c472da-c63a-4870-9520-42afef193343","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"df93c738-b6f9-4397-b7d0-e675bb78c31a","typeOfStateId":"state","$connId":"con_203","$id":"1593e51d-6927-4b74-b690-c37b1d5d1995","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"93340493-deb2-4640-810a-bf5562534f58","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Consulta Máquinas e traz compradas."},"conditions":[]},{"$id":"b4375fd5-30ea-4508-9cb1-8c0f6b52aa4d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroLogico\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(consultMaquina, numeroSerie) {\n\tlet consultMaquina = JSON.parse(consultMaquina);\n\tconsultMaquina = consultMaquina.data.filter( consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\tlet numeroLogico = consultMaquina[0].numeroLogico\n\treturn numeroLogico; \n}\n\n","inputVariables":["consultMaquina","numeroSerie"],"outputVariable":"numeroLogico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3e2d9fbf-e178-4d07-bfcb-f232e7753a58","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"nomeTipoEquipamento\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(numeroSerie, consultMaquina, tipoMaquina) {\n\tlet consultMaquina = JSON.parse(consultMaquina);\n\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\tlet codigoTipoEquipamento = consultMaquina[0].codigoTipoEquipamento\n\tcodigoTipoEquipamento = codigoTipoEquipamento.toString()\n\tif (consultMaquina == \"C\") {\n\t\tif (codigoTipoEquipamento == 1 || codigoTipoEquipamento == 5) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t} else if (codigoTipoEquipamento == 2) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t} else if (codigoTipoEquipamento == 3) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t} else {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t}\n\t} else {\n\t\tif (codigoTipoEquipamento == 15) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t} else if (codigoTipoEquipamento == 5) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t} else if (codigoTipoEquipamento == 1) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t} else {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t}\n\t}\n\treturn codigoTipoEquipamento;\n}\n\n","inputVariables":["numeroSerie","consultMaquina","tipoMaquina"],"outputVariable":"nomeTipoEquipamento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"151e23a0-7abf-48e2-a272-1471fc338f46","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataInstalacao\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(consultMaquina, numeroSerie) {\n\tlet consultMaquina = JSON.parse(consultMaquina);\n\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\tlet dataInstalacao = consultMaquina[0].dataInstalacao\n\n\n\t// Criando um objeto Date com a data fornecida\n\tconst dataObj = new Date(dataInstalacao);\n\n\t// Obtendo os componentes da data\n\tconst dia = String(dataObj.getDate()).padStart(2, '0');\n\tconst mes = String(dataObj.getMonth() + 1).padStart(2, '0'); // Os meses começam do zero, então somamos 1\n\tconst ano = dataObj.getFullYear();\n\n\t// Criando a string no formato desejado: DD/MM/YYYY\n\tconst dataFormatada = `${dia}/${mes}/${ano}`;\n\n\n\treturn dataFormatada;\n}\n\n","inputVariables":["consultMaquina","numeroSerie"],"outputVariable":"dataInstalacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85fd4b6a-c3fb-4d4c-b576-978af3f1de83","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"df93c738-b6f9-4397-b7d0-e675bb78c31a","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-1cb2f97f-811a-4022-9e6a-a147fccbc406","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-adc2f98c-2dc8-4147-9f01-0cada96fb556","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-56523b64-664e-4708-9aca-7c183ea438e7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","root":false,"$title":"[TC.4.5.1][MSG][SET] Comprada","$position":{"top":"1696px","left":"1114px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"bb74c3c9-73bc-4030-ae90-62acb134db5e":{"$contentActions":[{"action":{"$id":"28455e34-63ca-4fe3-95c1-e20694e88271","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f3ce0512-1fe9-4f1c-b290-983461954f53","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f3ce0512-1fe9-4f1c-b290-983461954f53","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"00dde603-ebd0-4723-9f48-f59e65dcdc31","$typeOfContent":"text","type":"SendMessage","settings":{"id":"326ac554-de3a-4273-83a8-5031ef1d92d4","type":"text/plain","content":"Foram encontradas as seguintes máquinas. ","metadata":{}},"$cardContent":{"document":{"id":"326ac554-de3a-4273-83a8-5031ef1d92d4","type":"text/plain","content":"Foram encontradas as seguintes máquinas. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"97dd9187-fee3-4a51-8ce1-f30c52e74098","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0501d701-210e-4b5d-afcd-3ca0d770bbdb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0501d701-210e-4b5d-afcd-3ca0d770bbdb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"91bfb221-581d-409a-8d4d-002d9b077ccc","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e69e16b4-16ee-473d-a011-60f82eb75eaf","type":"text/plain","content":"Por gentileza, digite a opção desejada.","metadata":{}},"$cardContent":{"document":{"id":"e69e16b4-16ee-473d-a011-60f82eb75eaf","type":"text/plain","content":"Por gentileza, digite a opção desejada."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cf8612be-9289-42f4-87c1-91cc95bc07b2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6ffeca96-9efe-41fb-bb2f-eebc9d113d05","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{}},"$cardContent":{"document":{"id":"6ffeca96-9efe-41fb-bb2f-eebc9d113d05","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5cd2d31f-56e0-46fb-82e2-ec919b529fe4","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"text/plain","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f72881e8-f826-4b73-bc74-af0c6c5c0994","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8e0fcca7-a496-4ef1-a91b-2549e02cacfc","typeOfStateId":"state","$connId":"con_208","$id":"50f092bc-48ac-4223-81df-ccc2f3632da4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"09b07a4f-c428-4128-b9cb-b8d9a45b0aa9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, tipoMaquina, modalidadeMaquina) {\n  try {\n\n    let consultMaquina = JSON.parse(consultMaquina);\n    consultMaquina = consultMaquina.data\n    let modalidadeMaquina = modalidadeMaquina.replace('Comprada', 'V')\n    var aux = '';\n    var count = 1;\n    if (modalidadeMaquina == 'V') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n    } else if (modalidadeMaquina != '') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n    }\n    consultMaquina.forEach(function (element) {\n      aux = aux.concat(\n        '<b>',\n        count,\n        '</b>',\n        ' - ',\n        'Nº série: ',\n        element.numeroSerie,\n        '\\n'\n      );\n      count++;\n    });\n\n    return aux;\n\n  }\n  catch (e) {\n    return e.message;\n  }\n\n}","inputVariables":["consultMaquina","tipoMaquina","modalidadeMaquina"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"372031cc-e467-405f-8c6c-fa19f48b6882","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sizeMaquinas\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, tipoMaquina, modalidadeMaquina) {\n  try {\n    let consultMaquina = JSON.parse(consultMaquina);\n    consultMaquina = consultMaquina.data\n    let modalidadeMaquina = modalidadeMaquina.replace('Comprada', 'V')\n    if (modalidadeMaquina == 'V') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n    } else if (modalidadeMaquina != '') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n    }\n\n    consultMaquina = consultMaquina.length\n    return consultMaquina\n  }\n  catch (e) {\n    return e.message;\n  }\n\n}","inputVariables":["consultMaquina","tipoMaquina","modalidadeMaquina"],"outputVariable":"sizeMaquinas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e789ac4a-274b-445a-9127-c69d64f88ed3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-423afeb8-be77-4727-ae90-621cd67825e3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0dec20db-cb12-49e2-be91-4dc3a5f34be5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-438dad61-a7ee-439f-9ffe-4ca787dff58b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bb74c3c9-73bc-4030-ae90-62acb134db5e","root":false,"$title":"[TC.4.4.0][MSG] Lista número S (Maquina< = 10)","$position":{"top":"1176.75px","left":"1520.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0f2ef715-e474-48e3-9642-ca975864c269":{"$contentActions":[{"action":{"$id":"778d041a-aed1-4440-9b45-f0f691cf4ee6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4df37b47-c05d-4694-9b73-7d0527269b0f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>                \nCrédito à vista {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x R${{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%","metadata":{}},"$cardContent":{"document":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>                \nCrédito à vista {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x R${{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_213","$id":"d9f34647-5a72-4f73-833b-68361b143449","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d50f971d-da7c-4c16-a789-c0bab627922e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-851cf741-04ee-444e-ae81-53ae51c8e181","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c23b2c9f-d535-4512-9624-6d5645d4dbb0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0f2ef715-e474-48e3-9642-ca975864c269","root":false,"$title":"Vendas Online - Amex e Hiper","$position":{"top":"2175.45px","left":"0px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"98c7523a-b7d2-49ab-bab8-c47926549497":{"$contentActions":[{"action":{"$id":"a8268dd6-051b-4645-be9c-6d892c9de125","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ee0f713e-1ae3-4702-a494-79e02c4d66b2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>                \nCrédito à vista {{taxasExibir@taxaCreditoAVista}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%","metadata":{}},"$cardContent":{"document":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"Estas são as taxas administrativas para a bandeira selecionada:\n\n<b>Taxas de Venda</b>                \nCrédito à vista {{taxasExibir@taxaCreditoAVista}}%\n\nCrédito parcelado\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_218","$id":"f3ab5963-fad2-418e-b947-47b833541ed8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd42b150-f365-444e-9f64-23b6d0d63000","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e5bdd6e3-f160-4f49-a6b8-5f1f8fd86a50","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4bb52443-b486-4c80-8907-7c6a1a7af14e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"98c7523a-b7d2-49ab-bab8-c47926549497","root":false,"$title":"Vendas Físicas - Amex e Hiper","$position":{"top":"2170px","left":"655px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"45ec8433-22a9-4498-8005-c3c52f7ce6bc":{"$contentActions":[{"action":{"$id":"9f914be7-a101-4c0c-b2a6-2e7756fbc90b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"29120039-d78c-42a0-b26c-65c4b3dfe7f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"29120039-d78c-42a0-b26c-65c4b3dfe7f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a116a8f2-171d-4a21-a6bb-4df55afa042e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cbc3333f-4381-4f46-a839-746660c1fbf5","type":"text/plain","content":"Desculpe, parece que você ainda não possui máquinas contratadas. ","metadata":{}},"$cardContent":{"document":{"id":"cbc3333f-4381-4f46-a839-746660c1fbf5","type":"text/plain","content":"Desculpe, parece que você ainda não possui máquinas contratadas. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b9fbbd09-86d7-4431-91f6-f7ac91644065","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ffee8e57-be55-4cc0-a112-feeb18c79b94","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ffee8e57-be55-4cc0-a112-feeb18c79b94","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6c0ee702-0049-4c0f-8017-a208c77d55ff","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b2ec0d82-b63d-40d7-aa6d-f5c8e49957a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"aece7772-1087-427c-9eb8-891be0b4a004","typeOfStateId":"state","$connId":"con_223","$id":"fbf59a0a-786f-42d6-bc61-d5bcf1913893","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b278a3b6-9248-46f6-b834-4ff244862109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(salesType) {\n    try {\n        let buttons = [\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"1\",\n                    \"title\": \"Sim\"\n                }\n            },\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"2\",\n                    \"title\": \"Não\"\n                }\n            }\n        ];\n\n        const headerText = \"Gostaria de saber mais sobre contratação de máquinas? \";\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"button\",\n                \"body\": {\n                    \"text\": headerText,\n                },\n                \"action\": {\n                    buttons\n                }\n            }\n        };\n    } catch (err) {\n        return false;\n    }\n}","inputVariables":["salesType"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c94dadc4-743e-44d7-ba34-264ff584ae59","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-853b0540-fe05-436d-b7e9-33449c46f486","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bed4e17e-1d64-4e64-b718-24793705d167","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-271cd10c-a2fa-4dab-a95f-f4a5c31d6510","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"45ec8433-22a9-4498-8005-c3c52f7ce6bc","root":false,"$title":"[TC.4.1.0][MSG] Sem máquinas","$position":{"top":"458px","left":"1761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ad3f23f8-0c79-4faf-8b19-06ad242f99d2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1463090-6db0-47f5-9840-36d1cd830c25","typeOfStateId":"state","$connId":"con_228","$id":"1c096d11-bece-4380-87e1-6a9548f52b86","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b0263ba7-3e7a-44d7-9be3-32b335524c22","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyDomicilio\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/domicilios?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"statusDomicilio","responseBodyVariable":"bodyDomicilio"},"conditions":[]},{"$id":"03bb27d6-949c-4096-b56b-b5ab0da3a021","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyGeraldomicilio\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/vendas-servicos/vendas/prospeccoes-clientes/assistente-virtual/v1/domicilios-bancarios","responseStatusVariable":"statusGeraldomicilio","responseBodyVariable":"bodyGeraldomicilio"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"config.domicilio"}]},{"$id":"62a8348e-035c-4db1-ad67-7d3acf50f585","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a7e2e2d2-d37b-411d-a590-9ab2346ef640","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"tamanhoRetornoDomicilio\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyDomicilio, bodyGeraldomicilio) {\n\ttry {\n\t\tbodyDomicilio = JSON.parse(bodyDomicilio);\n\t\tbodyGeraldomicilio = JSON.parse(bodyGeraldomicilio);\n\n\t\treturn {\n\t\t\t\"bodyDomicilio\": bodyDomicilio.data.length,\n\t\t\t\"bodyGeraldomicilio\": bodyGeraldomicilio.data.length,\n\t\t}\n\t}\n\tcatch (err) {\n\t\treturn {\n\t\t\t\"bodyDomicilio\": \"Erro\",\n\t\t\t\"bodyGeraldomicilio\": \"Erro\",\n\t\t\t\"Erro\":err.message\n\t\t}\n\t}\n}","inputVariables":["bodyDomicilio","bodyGeraldomicilio"],"outputVariable":"tamanhoRetornoDomicilio","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"953100b9-67d7-4a22-b584-845170bdef99","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} tamanho array dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} tamanho array dados","action":"{{tamanhoRetornoDomicilio@bodyDomicilio}} | {{tamanhoRetornoDomicilio@bodyGeraldomicilio}} | {{tamanhoRetornoDomicilio@Erro}}"},"conditions":[]},{"$id":"b4873d0d-a412-4033-b24a-e341a06f1660","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"4a8fb64c-ddf2-4b2a-a382-161a0d0fcfdc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"aa4bd660-a379-4cbb-b623-c82236a68bf5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDomicilio","statusGeraldomicilio"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2678cc4e-668a-40c9-8503-b33371d928c1","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/domicilios?idEstabelecimento={{selectedEc@codigoEc}} | GET| {{statusDomicilio}} | {{bodyDomicilio}}"},"conditions":[]},{"$id":"d698b742-0a2d-49fe-81d1-73c97b96ca6b","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/vendas-servicos/vendas/prospeccoes-clientes/assistente-virtual/v1/domicilios-bancarios | GET| {{statusGeraldomicilio}} | {{bodyGeraldomicilio}}"},"conditions":[]},{"$id":"4ac3327b-2456-4f3a-8824-dd13d5d77994","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{statusDomicilio}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusDomicilio"}]},{"$id":"4a76361b-8056-452c-a5bb-f0530aff8448","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status 2","action":"{{statusGeraldomicilio}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusGeraldomicilio"}]}],"$leavingCustomActions":[{"$id":"d10d0ba5-1077-4a9d-bded-8e1072db99ff","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"3d30b78a-c7f3-485d-938e-26118932c276","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-590464a5-6e89-48b3-93f1-6eb7d9b2f9cc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-51443f4d-ee07-41e5-8deb-4b01cd2686bd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-58e9468d-c57d-446e-99d4-81bb7159f02b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4c629330-326c-482b-9a8d-d25902d22845","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"ad3f23f8-0c79-4faf-8b19-06ad242f99d2","root":false,"$title":"[TC.6.0.0][HTTP] API Domicilio bancario","$position":{"top":"400px","left":"2282px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c27acb8-d48a-43b9-a815-6af6e6f03405":{"$contentActions":[{"action":{"$id":"244231f5-ccfb-4965-b257-4cbb6710d158","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"41855f54-55f9-45dc-a2f3-399f1b1be773","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"41855f54-55f9-45dc-a2f3-399f1b1be773","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"023344a3-819b-4047-961f-2f190e1f1d0a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4fcaae27-88c2-4843-adad-620602518acd","type":"text/plain","content":"Você receberá os pagamentos feitos na bandeira <b>{{taxCardFlag}}</b>, na conta bancária abaixo, da seguinte forma:","metadata":{}},"$cardContent":{"document":{"id":"4fcaae27-88c2-4843-adad-620602518acd","type":"text/plain","content":"Você receberá os pagamentos feitos na bandeira <b>{{taxCardFlag}}</b>, na conta bancária abaixo, da seguinte forma:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a3eaa0ee-47e0-42fd-9a2e-1548901ecc42","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4bbf8688-4625-416d-8f78-295ee386dc74","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4bbf8688-4625-416d-8f78-295ee386dc74","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"61fa1cf6-40a9-455d-b5e6-1c55c5832698","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0a62f500-54eb-427b-8266-7e81c85e01a0","type":"text/plain","content":"<b>Crédito</b>\n<b>Banco</b>: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                               ","metadata":{}},"$cardContent":{"document":{"id":"0a62f500-54eb-427b-8266-7e81c85e01a0","type":"text/plain","content":"<b>Crédito</b>\n<b>Banco</b>: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                               "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d62f8461-4a45-433f-b02b-7cd89d72ea4a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1840a1a5-4cc8-48c2-9926-908420e34bc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1840a1a5-4cc8-48c2-9926-908420e34bc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75e170b4-92d5-40c1-a211-a754270514c6","typeOfStateId":"state","$connId":"con_233","$id":"d974cc08-c322-44c8-9734-52dd8029267f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"40cc6e05-124c-4839-836b-43aa75b01b0b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bea48e3a-e632-4a25-89c0-24b87568d029","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-50a0e909-2cf2-4415-8717-af1ecdd479cc","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"8c27acb8-d48a-43b9-a815-6af6e6f03405","root":false,"$title":"[TC.6.1.1][MSG] Exibir Taxas Crédito","$position":{"top":"1129.89px","left":"1902px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b5f695eb-d85d-45fd-bb2e-20d377d958dd":{"$contentActions":[{"action":{"$id":"244231f5-ccfb-4965-b257-4cbb6710d158","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"41855f54-55f9-45dc-a2f3-399f1b1be773","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"41855f54-55f9-45dc-a2f3-399f1b1be773","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"023344a3-819b-4047-961f-2f190e1f1d0a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4fcaae27-88c2-4843-adad-620602518acd","type":"text/plain","content":"Você receberá os pagamentos feitos na bandeira <b>{{taxCardFlag}}</b>, na conta bancária abaixo, da seguinte forma:","metadata":{}},"$cardContent":{"document":{"id":"4fcaae27-88c2-4843-adad-620602518acd","type":"text/plain","content":"Você receberá os pagamentos feitos na bandeira <b>{{taxCardFlag}}</b>, na conta bancária abaixo, da seguinte forma:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5730f73d-45aa-4c87-97f2-941c88f20bd2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cf427407-3a18-4775-9216-7a99336c2fb1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cf427407-3a18-4775-9216-7a99336c2fb1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"128a4e69-277c-42fa-8f65-8b34ee83fedb","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cce9f01a-6302-412a-93bb-f8454dd65f7d","type":"text/plain","content":"<b>Débito</b>      \n<b>Banco</b>: {{domicilioDados@nomeBanco1}}\nAgência:{{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                             \n                              \n<b>Crédito</b>                  \n<b>Banco</b>: {{domicilioDados@nomeBanco2}}\nAgência: {{domicilioDados@codigoAgencia2}}\nConta Corrente: {{domicilioDados@contaCorrente2}}-{{domicilioDados@codigoDigito2}}","metadata":{}},"$cardContent":{"document":{"id":"cce9f01a-6302-412a-93bb-f8454dd65f7d","type":"text/plain","content":"<b>Débito</b>      \n<b>Banco</b>: {{domicilioDados@nomeBanco1}}\nAgência:{{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                             \n                              \n<b>Crédito</b>                  \n<b>Banco</b>: {{domicilioDados@nomeBanco2}}\nAgência: {{domicilioDados@codigoAgencia2}}\nConta Corrente: {{domicilioDados@contaCorrente2}}-{{domicilioDados@codigoDigito2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75e170b4-92d5-40c1-a211-a754270514c6","typeOfStateId":"state","$connId":"con_238","$id":"4685050e-7ceb-4328-b86b-ce847ec7e554","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4a7b6160-d93c-4dd3-a1ae-939c73e192df","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1cb24fa4-861f-4a5d-99d7-4a3d247e0177","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-24cf3003-fb0f-46ba-b3ed-5acaa2a519f8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b5f695eb-d85d-45fd-bb2e-20d377d958dd","root":false,"$title":"[TC.6.1.2][MSG] Exibir Taxas Ambos","$position":{"top":"1144px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"871d092b-90c5-4e0e-afbb-023cdb94f094":{"$contentActions":[{"action":{"$id":"244231f5-ccfb-4965-b257-4cbb6710d158","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"41855f54-55f9-45dc-a2f3-399f1b1be773","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"41855f54-55f9-45dc-a2f3-399f1b1be773","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"023344a3-819b-4047-961f-2f190e1f1d0a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4fcaae27-88c2-4843-adad-620602518acd","type":"text/plain","content":"Você receberá os pagamentos feitos na bandeira <b>{{taxCardFlag}}</b>, na conta bancária abaixo, da seguinte forma:","metadata":{}},"$cardContent":{"document":{"id":"4fcaae27-88c2-4843-adad-620602518acd","type":"text/plain","content":"Você receberá os pagamentos feitos na bandeira <b>{{taxCardFlag}}</b>, na conta bancária abaixo, da seguinte forma:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"80173726-3262-4bce-b360-68ff43d9679c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"44954c06-7e1e-406f-830d-0da8009da4e0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"44954c06-7e1e-406f-830d-0da8009da4e0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a4ea41e0-2f99-451d-9229-379b6925902c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e1958806-9dd6-49e1-85df-da631bf238c2","type":"text/plain","content":"<b>Débito</b>                    \n<b>Banco</b>: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                            ","metadata":{}},"$cardContent":{"document":{"id":"e1958806-9dd6-49e1-85df-da631bf238c2","type":"text/plain","content":"<b>Débito</b>                    \n<b>Banco</b>: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                            "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75e170b4-92d5-40c1-a211-a754270514c6","typeOfStateId":"state","$connId":"con_243","$id":"114ac98b-129e-4455-8e12-350a3d43074c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a7ce9db9-c492-49b5-906b-a4156915a769","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bf882bee-02d0-4109-85eb-d4c447041a99","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7269180c-d6c6-4135-b55c-f1e94458462a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"871d092b-90c5-4e0e-afbb-023cdb94f094","root":false,"$title":"[TC.6.1.3][MSG] Exibir Taxas Débito","$position":{"top":"1143.33px","left":"2638.56px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a9a96de6-7c5c-4625-8765-bd797a7e9c86":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"49787b51-0156-44fc-8565-77b607d79509","typeOfStateId":"state","$connId":"con_248","$id":"ed4b98d3-d6f8-4e76-9b69-fbeb08e72afd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c95438ca-ada8-4352-bc3d-48620479c866","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n    const invalidInputMessage = 'input inesperado';\n    try {\n        if (!inputUsuario) {\n            return 'inatividade';\n        }\n\n        let regex = /^(\\d{1,3}(\\.\\d{3})*|\\d+)(\\,\\d{1,2})?$/gmi;\n        let validInput = new RegExp(regex).test(inputUsuario);\n\n        if (validInput) {\n            return inputUsuario;\n        }\n        return invalidInputMessage;\n    } catch (err) {\n        return invalidInputMessage;\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"34019300-5d25-4ff2-98f8-b9d25d503ee0","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"valor\"","$invalid":false,"settings":{"variable":"exceptionType","value":"valor"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"8c3ab915-52f6-45d0-92ab-22c7133e3745","$typeOfContent":"","type":"SetVariable","$title":"Set \"valorCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"valorCobranca","value":"R$ {{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"99b1e8ad-0086-4a95-9fc8-bd03e20d5b10","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ce9800c9-f24b-454e-ba84-51c52e751181","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a88089fe-bb6a-4b29-9721-fcde654f451c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fd792402-ac1f-4e7f-a84d-cc58678491d3","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1fd79e3d-5c91-469a-82b8-706e9ede7565","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8e3be01f-cd4a-4d66-8a87-68ddb307560e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a9a96de6-7c5c-4625-8765-bd797a7e9c86","root":false,"$title":"[TC.7.3.0][INPUT] Solicita valor da cobrança","$position":{"top":"2661px","left":"3068.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f676f5a4-86d1-4e05-a2b8-485b8dd91725":{"$contentActions":[{"action":{"$id":"5506b830-1b9b-4ca6-89fa-06039b587e70","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d73b6cc2-9e25-4b12-97af-7d6d54a53677","$typeOfContent":"text","type":"SendMessage","settings":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Por favor, informe a data da compra.\n\nComo neste exemplo:\n👉 {{currentDate}}","metadata":{}},"$cardContent":{"document":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Por favor, informe a data da compra.\n\nComo neste exemplo:\n👉 {{currentDate}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7bf80e9d-79e9-4578-acba-c963f814037e","typeOfStateId":"state","$connId":"con_253","$id":"07dead61-4794-4857-95f0-1beaaa14e586","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8f6bbd3f-4073-4bf6-9597-ad195981452b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3b60736c-0bba-40af-b824-4866aa5c96e4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f6e0bd46-0006-492b-98ad-608023d2ce4f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f676f5a4-86d1-4e05-a2b8-485b8dd91725","root":false,"$title":"[TC.7.2.0][MSG] Solicita data da cobrança","$position":{"top":"1950.5px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bbc18d76-6b5d-4a90-ad31-fcabb1586308":{"$contentActions":[{"action":{"$id":"7a84390c-d7bf-45b1-af5d-460041b6dd5a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"97cc80c5-b47b-4c1a-9d46-d05db5123273","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"97cc80c5-b47b-4c1a-9d46-d05db5123273","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"250e83be-d97c-4677-a1ab-6f7bc5fc71ec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9cb5ee14-0641-4154-91a2-384720f31f85","typeOfStateId":"state","$connId":"con_258","$id":"288ee9a9-16a3-41fa-baf3-b580beaf0acd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"531aa867-6ced-4d5d-b2b7-a3f702c3ebdd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Aluguel\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"MDR\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"ARV\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Por gentileza, informe a origem da cobrança.👇\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3fac0be-f389-4dc0-a30d-1fd3ddac1a97","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9b412d25-0465-47c2-af24-5a8b27ec0278","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c3386468-8d8a-45ce-9782-a6a942b5c2b6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c8d7099d-c3f4-4039-919e-63bb6d0e5140","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","root":false,"$title":"[TC.7.0.2][MSG] Origem da cobrança","$position":{"top":"887.571px","left":"3069px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e695d17c-2f37-44ac-9508-6986fb99b351":{"$contentActions":[{"action":{"$id":"c48e492f-0ae6-45b7-a511-cd0a79ec93ee","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae8b5e52-a561-44e5-98d8-7c1c17f15ec8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae8b5e52-a561-44e5-98d8-7c1c17f15ec8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4d4404d0-777a-45ec-8b2a-10fb6c28cd88","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1d4c3b8a-0f56-437e-beec-2c5ba9efea28","typeOfStateId":"state","$connId":"con_263","$id":"98a6a3d9-9e3c-4464-ad66-768762d5fd76","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"905868b1-3dad-4266-a028-e8e981a0afc4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Conta Corrente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Agenda\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Certo, onde visualizou a cobrança?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b29a7541-0d10-4801-b01d-b444f13744fb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d34dca9f-3ffa-4e84-b80c-19efdf20d2f4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bd513756-a0ee-4531-ade1-6ce7ebebe1d5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-424f28d6-a44b-4bac-aa06-da5e3b41f954","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e695d17c-2f37-44ac-9508-6986fb99b351","root":false,"$title":"[TC.7.1.0][MSG] Onde visualizou a cobrança","$position":{"top":"1410px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"85c901f2-e8b4-49ca-97d4-e1becccc4cb1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cede0f5a-5453-45c2-a4fd-e95e478bdd14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c7eb5b06-ca45-4d7e-be53-b9e17da7fd6d","type":"Redirect","$title":"Redirect to {service} sending {state@lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fcc118c2-550e-4ff0-a108-a08d17bdb9f6","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"85c901f2-e8b4-49ca-97d4-e1becccc4cb1","root":false,"$title":"[Redirect] To cascata","$position":{"top":"21.6667px","left":"462.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59d0589a-4bfe-427b-bcc3-37affdafab98":{"$contentActions":[{"action":{"$id":"7b152004-8a47-4677-b19b-7ef84b9c72c4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bcdbce09-279f-438b-b1bd-b5d41903e9b5","type":"text/plain","content":"A Taxa administrativa (MDR) é cobrada sobre as transações realizadas de forma física (em uma máquina de cartão) ou de forma online (link de pagamento), tanto no crédito quanto no débito. \n","metadata":{}},"$cardContent":{"document":{"id":"bcdbce09-279f-438b-b1bd-b5d41903e9b5","type":"text/plain","content":"A Taxa administrativa (MDR) é cobrada sobre as transações realizadas de forma física (em uma máquina de cartão) ou de forma online (link de pagamento), tanto no crédito quanto no débito. \n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c810e386-4922-4496-9cf5-fb65ca671e9a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0c95b10d-9b80-4142-90e4-ec71b94e2c93","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0c95b10d-9b80-4142-90e4-ec71b94e2c93","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1733eb2d-e9c4-4fe4-97fe-6c879ae50803","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6741cd3e-4102-4382-b087-7b3268a1322b","type":"text/plain","content":"Todas as empresas que fornecem solução de pagamento, cobram esse tipo de taxa.\n","metadata":{}},"$cardContent":{"document":{"id":"6741cd3e-4102-4382-b087-7b3268a1322b","type":"text/plain","content":"Todas as empresas que fornecem solução de pagamento, cobram esse tipo de taxa.\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1cb8a46a-308e-4c07-8d8a-f0476c022498","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d82acf75-4b40-4e5c-a926-6e507dac5f6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d82acf75-4b40-4e5c-a926-6e507dac5f6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"86f79972-a169-4480-babb-4261f1b5a4f4","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"action":{"$id":"4d8a8eab-bedf-4943-8b9d-cc66c82d45c2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9b17c3aa-f9c2-4025-95d3-d4be61e16f01","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b17c3aa-f9c2-4025-95d3-d4be61e16f01","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b38e7f6a-5a97-4966-ba49-f9b7915d436e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4dfbe4df-5b62-4c68-9130-ab7ccec1756b","typeOfStateId":"state","$connId":"con_268","$id":"ece7e9ed-eee5-4361-abdc-46680eebb110","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"43c3a7b6-6035-4c73-b26a-1dece10ecbee","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Master\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Visa\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Elo\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Amex\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Hiper\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Selecione a bandeira desejada para conhecer as taxas administrativas.👇`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"99120e14-d345-44e3-baf8-0e6d1e8d7d6d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-97e9dcac-47cb-4812-ae35-c9517ce2c8e2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e959f6cd-5833-4a4c-82da-5597155d4282","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fdd68a13-5941-4450-8201-c57b7ce93155","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"59d0589a-4bfe-427b-bcc3-37affdafab98","root":false,"$title":"[TC.2.0.1] [MSG] Selecao Bandeira","$position":{"top":"631px","left":"321.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"313d8fd3-b86e-48a6-91d5-803adf2aa7d6":{"$contentActions":[{"action":{"$id":"b00b58af-c4a0-4b88-acc6-bfd375877d98","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"87cd5126-0e6d-401b-8e15-fc57f4b1139f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3541272-a652-4112-9a0f-665d23c0136e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e912e94c-247f-4ad6-abec-f42562d981a0","typeOfStateId":"state","$connId":"con_273","$id":"2dd516a5-7698-42c9-9e4b-a732f67c3279","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc6afd4-c708-460d-842d-5021f952c686","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Vendas Online\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Vendas Física\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Você possui as seguintes modalidades habilitadas, selecione qual deseja consultar.👇\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a9e89828-78fd-4d85-9b99-0e6f16e11dc7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-25d3028c-cc4e-415d-8970-51a92a6ee4ae","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f4d2f7ad-2147-4ea1-9b69-f6b062082b00","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0fec733e-687e-4a20-8d44-77e1d6f6cb4a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"313d8fd3-b86e-48a6-91d5-803adf2aa7d6","root":false,"$title":"[TC.2.0.2][MSG] Modalidade de venda","$position":{"top":"1090.43px","left":"293.357px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d75d80be-8d8a-4598-91c3-378a699d59c1":{"$contentActions":[{"action":{"$id":"63ffff3b-b00e-46a0-bdef-4647bb008ae0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"303cfc97-f485-485d-b20c-26afb9569905","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"303cfc97-f485-485d-b20c-26afb9569905","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5a9fe635-ca3b-454d-a94c-d284431b325e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"21b3d22d-2312-4cff-a73c-ae1b6746e33e","typeOfStateId":"state","$connId":"con_278","$id":"76dbdd35-3211-4aad-ac6d-633aa12b1051","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47aab5e5-83a4-43a0-bb83-13da9057c8b0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Gostaria de selecionar outra bandeira?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fecb3166-b76a-4d3f-83d2-9f1e5bc14837","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b633bbbb-eadd-4ee0-8390-d4e7565c56f4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8501b431-5065-415b-a33c-579283bfafa1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4524defd-1ef8-45c8-bd38-7177e09e3d3e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d75d80be-8d8a-4598-91c3-378a699d59c1","root":false,"$title":"[TC.2.1.0][MSG] Selecionar outra bandeira","$position":{"top":"2222.24px","left":"317.121px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"21b3d22d-2312-4cff-a73c-ae1b6746e33e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c12d2d8f-bda5-4363-a9eb-46662315b7ee","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8951280-a57e-494d-851d-140dbca41a1e","typeOfStateId":"state","$connId":"con_283","$id":"fc8a046a-31c9-431c-9b8b-97fefe95b232","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"a65258c3-241a-4ab6-94b7-d3b0cfdb7ccd","typeOfStateId":"state","$connId":"con_288","$id":"be379e42-cdaa-4cda-b698-77abfd0d3439","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f3f13f29-3b2b-445d-a0fb-b7b74579cd8a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const validInputMessage = \"Input inesperado\"\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    const regexDictionary = {\n      \"n[ãa]o|naum\": \"Não\",\n      \"sim|sin\": \"Sim\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return validInputMessage\n  } catch (err) {\n    return validInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e475018a-0819-41ec-9389-84a2334b2919","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"c46b65a2-9c94-4ee2-ae4e-a973b40a5618","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"3fa94059-5bc1-4a18-a151-3fe461a3d034","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-402da683-8825-4e70-91a2-fe79f0bd75a0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d2aa982b-e66e-4ebc-98a7-77484bf0b3d8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1031cba1-0531-4639-986c-b432e0af828a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dab7e1de-468e-4b64-ad65-53a846d25258","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"21b3d22d-2312-4cff-a73c-ae1b6746e33e","root":false,"$title":"[TC.2.1.0][INPUT] Selecionar outra bandeira","$position":{"top":"2493.29px","left":"317.071px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d8a18cc-a583-4083-9025-67ca4d472aaf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"88a86fe9-9c4e-4e81-8040-5cd06273375f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"cac63fde-6671-4aa1-9a67-efc2f5336711","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"5d8a18cc-a583-4083-9025-67ca4d472aaf","root":false,"$title":"[GO TO] TC.3.0.0 Taxas de Antecipação","$position":{"top":"3978px","left":"204.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8951280-a57e-494d-851d-140dbca41a1e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a7108ccd-d976-4326-8820-7ccb9966b66e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"59d0589a-4bfe-427b-bcc3-37affdafab98","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e8951280-a57e-494d-851d-140dbca41a1e","root":false,"$title":"[GO TO] TC.2.0.1 Selecao Bandeira","$position":{"top":"2708.13px","left":"34.913px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9262b032-7ea2-45d2-b782-2649ddad61b9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"582ae6c9-728b-49d6-afb5-8af40ffe3320","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9262b032-7ea2-45d2-b782-2649ddad61b9","root":false,"$title":"[GO GO] Redirect to Finalizacao","$position":{"top":"4001px","left":"484px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c07b1d82-9004-40cc-a93c-f0cabb17f9a7":{"$contentActions":[{"action":{"$id":"cb570a41-fc3b-4cbc-90be-16858e4c3eb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8bbd06a9-445f-4628-9901-cdf7a46d11a9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ddc5af8f-9630-479a-8623-8b37698ab647","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b8de541a-4234-4125-9502-46ade2ce536a","typeOfStateId":"state","$connId":"con_293","$id":"032ea9f2-4db4-4fd4-8520-500616ef7b9a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bc28845d-702b-47ec-91a2-ae6432e7b336","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada);\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tbuttons = buttons.filter((reply) => reply.reply.title !== 'Falar com gerente');\n\t\t}\n\n\t\tconst headerText = \"Gostaria de consultar as taxas de antecipação?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c914f7a1-0280-46c0-9ddd-7171ddfa515a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-93ef6718-7cdf-4e11-9a2e-3a2235e71fdb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f6e67b2d-87cb-4e7c-8927-51f277ba8491","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0d2eecb9-6bec-4a47-9de6-da54cf1694e6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c07b1d82-9004-40cc-a93c-f0cabb17f9a7","root":false,"$title":"[TC.2.2.1][MSG] Consultar Taxas","$position":{"top":"2918.35px","left":"349.435px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c950fde0-4616-49b2-9f39-a0ba859beab4":{"$contentActions":[{"action":{"$id":"cb570a41-fc3b-4cbc-90be-16858e4c3eb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8bbd06a9-445f-4628-9901-cdf7a46d11a9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ddc5af8f-9630-479a-8623-8b37698ab647","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6159148f-ca32-497c-a843-838a5bc20b0e","typeOfStateId":"state","$connId":"con_298","$id":"7ede612e-ed6f-4c1d-88c6-f9d9e142e389","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bc28845d-702b-47ec-91a2-ae6432e7b336","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = `Você pode contratar a antecipação automática e receber suas vendas na hora, ou em 1(um) dia. \n\nGostaria de aproveitar e contratar? 😍`;\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7c7a590f-a499-432a-8137-85bc594d397d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-54313cd7-f040-4cbb-98d1-adf05d4617e6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c56da473-a0f5-4dd6-9916-e0fc083f28dd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b5b46a9c-ea72-40bc-9c51-73e604bf0bbb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c950fde0-4616-49b2-9f39-a0ba859beab4","root":false,"$title":"[TC.2.2.2][MSG] Taxa atual","$position":{"top":"2930px","left":"908px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ba86d697-73e1-47ee-9a6a-0c58a46a207b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"07d40eca-e745-4092-bc11-bf6444a7a197","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ba86d697-73e1-47ee-9a6a-0c58a46a207b","root":false,"$title":"[GO TO] Redirect Atendimento Humano","$position":{"top":"3434px","left":"525.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e1923532-1bfa-4ab5-8de3-6eba5248bfa6":{"$contentActions":[{"action":{"$id":"2e9a6cda-a31d-442e-80cb-22546f176fcf","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6b9efbfa-cbfc-4a4c-a973-38023c32e235","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6b9efbfa-cbfc-4a4c-a973-38023c32e235","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a63fd407-f2dc-4b78-bc77-b5f5a72f1d6f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"efe77ef5-87d2-444e-9b46-bca0e9c012ca","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"17828cf7-5217-4cf1-bf9e-1393e96afaac","typeOfStateId":"state","$connId":"con_303","$id":"ee82c8ec-1c5e-40b1-88c7-a0586afd0ec0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f2a2f1cf-22af-4e91-84c3-5ff5677f11ef","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = `Gostaria de falar com um de nossos atendentes e conhecer mais?`;\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2c6c4e3e-7ba4-4a20-93c2-a40a67e3bfbb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d8bbf540-3238-4b5f-81f0-6760f3ed7d09","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-de32c1e2-4918-4a05-9fd8-a69ed031b67a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dae18663-d29c-4021-8619-1bb12c381202","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e1923532-1bfa-4ab5-8de3-6eba5248bfa6","root":false,"$title":"[TC.2.2.3][MSG] Questionar Transferência","$position":{"top":"3487px","left":"909.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1463090-6db0-47f5-9840-36d1cd830c25":{"$contentActions":[{"action":{"$id":"83e94468-aa05-4776-ad63-5972bf36598e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"150cd459-36ad-41eb-a7fc-e6c9d20e5d5b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"150cd459-36ad-41eb-a7fc-e6c9d20e5d5b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c45f0565-6dbc-40bf-977a-551769a50d76","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c13070f5-3f89-4975-90ec-c628e04a66ce","typeOfStateId":"state","$connId":"con_308","$id":"45492c8e-9956-43e8-ad06-63a1a6bc42be","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8622daec-b61a-4065-924a-263f45fe99d5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyDomicilio) {\n  try {\n    // Mapeamento de correção de texto para bandeiras\n    const correcaoTexto = {\n      \"ELO \": \"Elo\",\n      \"MCRD\": \"Master\",\n      \"VISA\": \"Visa\",\n      \"AMEX\": \"Amex\",\n      \"HIPR\": \"Hiper\"\n    };\n\n    // Filtrar os dados conforme as condições\n    let bodyDomicilio = JSON.parse(bodyDomicilio)\n    let bandeirasFiltradas = {};\n    bodyDomicilio.data.forEach(item => {\n      if (correcaoTexto[item.codigoBandeira] && (item.codigoProduto === '01' || item.codigoProduto === '02')) {\n        bandeirasFiltradas[item.codigoBandeira] = correcaoTexto[item.codigoBandeira];\n      }\n    });\n\n    // Preencher o menu com as bandeiras filtradas\n    let defaultMenuOptions = [];\n    for (const key in bandeirasFiltradas) {\n      defaultMenuOptions.push({\n        \"id\": key,\n        \"title\": bandeirasFiltradas[key]\n      });\n    }\n\n    return {\n      \"recipient_type\": \"individual\",\n      \"type\": \"interactive\",\n      \"interactive\": {\n        \"type\": \"list\",\n        \"header\": {\n          \"type\": \"text\",\n          \"text\": \"\"\n        },\n        \"body\": {\n          \"text\": `Selecione abaixo a bandeira, para saber onde vai receber as vendas feitas com ela (domicílio bancário).`\n        },\n        \"action\": {\n          \"button\": \"Escolha uma opção\",\n          \"sections\": [\n            {\n              \"title\": \"\",\n              \"rows\": defaultMenuOptions\n            }\n          ]\n        }\n      }\n    }\n  } catch (err) {\n    return err.message;\n  }\n}","inputVariables":["bodyDomicilio"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fd74f320-ccff-43b5-b472-f83f33f25dec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1cbc45ee-b90f-42c4-905d-fe22283e46e4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-451e9560-680d-4654-b927-ec1e203d2fb8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-26e652a5-3a0c-4e76-9d29-e2bfe9d01bdf","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a1463090-6db0-47f5-9840-36d1cd830c25","root":false,"$title":"[TC.6.1.0][MSG] Selecionar bandeira","$position":{"top":"635.75px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c13070f5-3f89-4975-90ec-c628e04a66ce":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"b5f695eb-d85d-45fd-bb2e-20d377d958dd","typeOfStateId":"state","$connId":"con_313","$id":"12e772c0-ad73-43a7-b064-1ee63332a2ac","conditions":[{"source":"context","comparison":"equals","values":["Ambos"],"variable":"domicilioDados@codigoProduto"},{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"8c27acb8-d48a-43b9-a815-6af6e6f03405","typeOfStateId":"state","$connId":"con_318","$id":"28f12109-2549-4963-a5b5-3a420c79f59c","conditions":[{"source":"context","comparison":"equals","values":["Crédito"],"variable":"domicilioDados@codigoProduto"},{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"871d092b-90c5-4e0e-afbb-023cdb94f094","typeOfStateId":"state","$connId":"con_323","$id":"7e85cde1-1409-4caf-bb85-559af437d35c","conditions":[{"source":"context","comparison":"equals","values":["Débito"],"variable":"domicilioDados@codigoProduto"},{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"25dc5f69-8be6-4e53-928a-b8a814402c0d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"Master\": \"Master\",\n      \"Visa\": \"Visa\",\n      \"Elo\": \"Elo\",\n      \"Amex\": \"Amex\",\n      \"Hiper\": \"Hiper\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e53ed1eb-46d7-4aed-b17f-4021e8926240","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxCardFlag\"","$invalid":false,"settings":{"variable":"taxCardFlag","value":"{{userInput}}"},"conditions":[]},{"$id":"704405c6-b4b7-4cf7-9b10-e8e0290a06df","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"c5e8a7ff-b292-4479-a667-d6589d6fb73f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"domicilioDados\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyDomicilio, bodyGeralDomicilio, bandeira) {\n    try {\n        const bodyDomicilioObj = JSON.parse(bodyDomicilio);\n        const bodyGeralDomicilioObj = JSON.parse(bodyGeralDomicilio);\n        let codigoBandeira = bandeira.toUpperCase();\n        codigoBandeira = codigoBandeira.replace('MASTER', 'MCRD').replace('VISA', 'VISA').replace('HIPER', 'HIPR').replace('ELO', 'ELO').replace('AMEX', 'AMEX');\n\n        const getDomicilioDataPorBandeira = (codigoBandeira, propriedade) => {\n            const filteredData = bodyDomicilioObj.data.filter(item =>\n                item.codigoBandeira.trim() == codigoBandeira.trim() &&\n                (item.codigoProduto == \"01\" || item.codigoProduto == \"02\")\n            );\n\n            return filteredData.map(item => {\n                if (propriedade == 'banco') {\n                    return item.domicilio[propriedade].replace(/^0+/, '').padStart(3, '0') || null;\n                }\n                if (propriedade == 'codigoProduto') {\n                    return item[propriedade] || 'null';\n                }\n                return item.domicilio[propriedade] || 'null';\n            });\n        }\n        const getNomeBancoPorCodigo = (codigoBanco) => {\n            return codigoBanco.map(codigo => {\n                const banco = bodyGeralDomicilioObj.data.find(item => item.codigo === codigo);\n                return banco ? banco.nome : null;\n            });\n        }\n\n        let domicilioDados = {};\n        const codigoProduto = getDomicilioDataPorBandeira(codigoBandeira, 'codigoProduto');\n        const codigosBanco = getDomicilioDataPorBandeira(codigoBandeira, 'banco');\n        const codigosAgencia = getDomicilioDataPorBandeira(codigoBandeira, 'agencia');\n        const codigosContaCorrente = getDomicilioDataPorBandeira(codigoBandeira, 'contaCorrente');\n        const codigosDigito = getDomicilioDataPorBandeira(codigoBandeira, 'digitoContaCorrente');\n        const nomesBanco = getNomeBancoPorCodigo(codigosBanco);\n\n        for (let i = 0; i < codigosBanco.length; i++) {\n            domicilioDados[`codigoBanco${i + 1}`] = codigosBanco[i];\n        }\n        for (let i = 0; i < codigosAgencia.length; i++) {\n            domicilioDados[`codigoAgencia${i + 1}`] = codigosAgencia[i].replace(/^0+/, '');\n        }\n        for (let i = 0; i < codigosDigito.length; i++) {\n            domicilioDados[`codigoDigito${i + 1}`] = codigosDigito[i];\n        }\n        for (let i = 0; i < nomesBanco.length; i++) {\n            domicilioDados[`nomeBanco${i + 1}`] = nomesBanco[i];\n        }\n        for (let i = 0; i < codigosContaCorrente.length; i++) {\n            domicilioDados[`contaCorrente${i + 1}`] = codigosContaCorrente[i].replace(/^0+/, '');\n        }\n        if (codigoProduto.includes(\"01\") && codigoProduto.includes(\"02\")) {\n            domicilioDados.codigoProduto = \"Ambos\";\n        }\n        else if (codigoProduto.includes(\"02\")) {\n            domicilioDados.codigoProduto = \"Crédito\";\n        } else if (codigoProduto.includes(\"01\")) {\n            domicilioDados.codigoProduto = \"Débito\";\n        }\n        return domicilioDados;\n\n    } catch (err) {\n        return err.message;\n    }\n}","inputVariables":["bodyDomicilio","bodyGeralDomicilio","taxCardFlag"],"outputVariable":"domicilioDados","LocalTimeZoneEnabled":false},"conditions":[{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"05a8fce7-4994-4940-a879-29def9504887","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"43cc4036-13c4-4808-9326-a488da59d88b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-51c7620d-1c21-4161-a400-c157e95d29cc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d0360601-88d1-4e44-a852-daf4d7e2c425","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9e545352-45cf-4971-815c-6d222a58c58c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ae57106c-ca07-4276-bb37-9c30c309f0e1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c13070f5-3f89-4975-90ec-c628e04a66ce","root":false,"$title":"[TC.6.1.0][INPUT] Selecionar bandeira","$position":{"top":"860px","left":"2282.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75e170b4-92d5-40c1-a211-a754270514c6":{"$contentActions":[{"action":{"$id":"b00b58af-c4a0-4b88-acc6-bfd375877d98","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"87cd5126-0e6d-401b-8e15-fc57f4b1139f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3541272-a652-4112-9a0f-665d23c0136e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"006286b7-e8d7-4b83-9872-ad9d389e8b86","typeOfStateId":"state","$connId":"con_328","$id":"c09edcfb-0f9f-4f6a-8645-bf6d48a01006","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc6afd4-c708-460d-842d-5021f952c686","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada);\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Outras bandeiras\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tbuttons = buttons.filter((reply) => reply.reply.title !== 'Falar com gerente');\n\t\t}\n\n\n\t\tconst headerText = \"Como deseja prosseguir?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0f33f515-fb87-4d9e-a1dd-91d3b3e1883f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-faec62fa-89b7-4dd9-bfd7-f57149da2c4b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bc931820-727c-4d8c-9213-7c4510fc36f0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-887142fa-1a82-4559-b34f-12c5f5478baf","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"75e170b4-92d5-40c1-a211-a754270514c6","root":false,"$title":"[TC.6.2.0][MSG] Prosseguir","$position":{"top":"1406.33px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"006286b7-e8d7-4b83-9872-ad9d389e8b86":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06094d8f-981b-4ac3-a526-af631e3f4600","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"1bd26f72-4287-4f83-9213-ca282c18ab23","typeOfStateId":"state","$connId":"con_333","$id":"208d9650-9890-4f86-940a-353bc6ce531e","conditions":[{"source":"context","comparison":"equals","values":["Encerrar"],"variable":"userInput"}],"$invalid":false},{"stateId":"dc6146ef-b6d2-4944-bc07-4b32c8467bd9","typeOfStateId":"state","$connId":"con_338","$id":"5a064d2e-f3b8-4cf7-a334-512f56c018c9","conditions":[{"source":"context","comparison":"equals","values":["Outras bandeiras"],"variable":"userInput"}],"$invalid":false},{"stateId":"7399f98b-a0d4-4892-901c-bb662285e254","typeOfStateId":"state","$connId":"con_343","$id":"5cf516a8-7b11-4ebc-9a2e-4bd74da495d3","conditions":[{"source":"context","comparison":"equals","values":["Falar com gerente"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"22544a01-53d2-4dcb-aced-ddb4bb463c2e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c054b662-39ca-4707-92a1-404817bd887a","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"b5d2c7d5-7c3b-4597-b21a-a1584163b867","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"765886d2-9abd-4add-8e03-45e58b1d809b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Master","Visa","Elo","Amex","Hiper"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-9f6ced81-28ab-4803-9a01-2ab5dbd6ea71","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c599b312-a1d8-48d5-abd5-9b95be6ba7fd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-847c74fd-c272-4017-8ce6-111dd5d0f884","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-82bd65d8-4691-4b2a-82d0-03d540978d30","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"006286b7-e8d7-4b83-9872-ad9d389e8b86","root":false,"$title":"[TC.6.2.0][INPUT] Prosseguir","$position":{"top":"1583.33px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"1bd26f72-4287-4f83-9213-ca282c18ab23":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d646fbe5-ed8c-4f61-a3c0-d14fa2ff76e1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1bd26f72-4287-4f83-9213-ca282c18ab23","root":false,"$title":"[GO TO] Finalizacao","$position":{"top":"1947px","left":"2086.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dc6146ef-b6d2-4944-bc07-4b32c8467bd9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e87965d8-8d76-4dd6-82df-338546e2c5eb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a1463090-6db0-47f5-9840-36d1cd830c25","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"dc6146ef-b6d2-4944-bc07-4b32c8467bd9","root":false,"$title":"[GO TO] TC.6.1.0 Selecionar bandeira","$position":{"top":"1929px","left":"2431px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"722bd745-fd0f-4ade-9937-852d7db9e165":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","typeOfStateId":"state","$connId":"con_348","$contentId":"b881df70-82f9-4f96-9e69-716b162fdb40","$id":"4f7480d3-8048-4b59-8455-ae5aedfbaef7","conditions":[{"source":"context","comparison":"equals","values":["Valor divergente"],"variable":"userInput"}],"$invalid":false},{"stateId":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","typeOfStateId":"state","$connId":"con_353","$contentId":"b881df70-82f9-4f96-9e69-716b162fdb40","$id":"2f99ccf7-df36-441d-ad0e-b5c793e89914","conditions":[{"source":"context","comparison":"equals","values":["Cobrança duplicada"],"variable":"userInput"}],"$invalid":false},{"stateId":"64033608-d1fe-4704-aebe-31662a651f61","typeOfStateId":"state","$connId":"con_358","$contentId":"b881df70-82f9-4f96-9e69-716b162fdb40","$id":"9a712681-4fac-4d7f-baa0-34fb7863e1fe","conditions":[{"source":"context","comparison":"equals","values":["Outros motivos"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"9409a2fd-7527-45fe-b569-22becbc867b8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"valor divergente|valor\": \"Valor divergente\",\n      \"cobran[cç]a duplicada\": \"Cobrança duplicada\",\n      \"outros motivos|outros\": \"Outros motivos\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0c0d83b-9bdb-4ebb-a5f2-300e12409057","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"b02e9c56-1603-4244-b2c6-792c3cedaa2e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"b8c2902e-5b08-4ffd-880b-0e14b21ee87f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Valor divergente","Cobrança duplicada","Outros motivos"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-0d85df11-f5bd-4ac9-8a9f-b90f3d34c24b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a810aee1-8a96-47f2-8590-f29d70ff70a8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5994bc7a-8075-431d-ab5e-6b2339c83037","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c0ef28b7-4109-4612-96ab-b0b268937399","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"722bd745-fd0f-4ade-9937-852d7db9e165","root":false,"$title":"[TC.7.0.0][INPUT] Questionar uma cobrança","$position":{"top":"673px","left":"3265.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"faf5caf6-e19a-42eb-9d38-2e4e58acae88":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"ea0411d0-285d-4394-bb28-7e700f3871d5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","typeOfStateId":"state","$connId":"con_363","$id":"b6242e51-095a-495f-bd48-1457612f253e","conditions":[{"source":"context","comparison":"notEquals","values":["inatividade"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"1e5a0305-f860-43b3-92ca-5ab64de4c1de","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    return inputUsuario\n    \n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"01f6aa41-2411-41e1-a1e4-5364dbde0813","$typeOfContent":"","type":"SetVariable","$title":"Set \"motivoChamado\" with userInput","$invalid":false,"settings":{"variable":"motivoChamado","value":"{{userInput}}"},"conditions":[]},{"$id":"0a63dbc9-395d-471a-a600-19d9db12e4f3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f5613662-6e68-459f-b205-cedc2e836b52","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-00e5dc15-47ef-4d3c-a4e1-deaf00e8ad7e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b77bcf0b-20d7-4500-bdcc-8bf8e4994ea3","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3956fdb2-225f-4284-959e-7deaaaaaceb0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4f2c18f1-2542-47e0-9930-444513e18c97","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"faf5caf6-e19a-42eb-9d38-2e4e58acae88","root":false,"$title":"[TC.7.0.1][INPUT] Outro Motivo","$position":{"top":"1087.86px","left":"3546.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"9cb5ee14-0641-4154-91a2-384720f31f85":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e695d17c-2f37-44ac-9508-6986fb99b351","typeOfStateId":"state","$connId":"con_368","$id":"288ee9a9-16a3-41fa-baf3-b580beaf0acd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bda34732-837d-43e2-ab6a-c26cfa80004d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tconst invalidInputMessage = 'input inesperado';\n\ttry {\n\t\tif (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst regexDictionary = {\n\t\t\t\"^aluguel$\": \"Aluguel\",\n\t\t\t\"^mdr$\": \"MDR\",\n\t\t\t\"^arv$\": \"ARV\"\n\t\t};\n\t\tfor (let regex in regexDictionary) {\n\t\t\tif (new RegExp(regex, 'i').test(inputUsuario)) {\n\t\t\t\treturn regexDictionary[regex];\n\t\t\t}\n\t\t}\n\t\treturn invalidInputMessage;\n\t} catch (err) {\n\t\treturn invalidInputMessage;\n\t}\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"452cb59f-11b3-49e9-b5cf-da9096835ee5","$typeOfContent":"","type":"SetVariable","$title":"Set \"origemCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"origemCobranca","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"6d2aaf40-ad2d-40a8-b4f5-7dca201fa403","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"275c4181-9284-4540-a618-de6d28fbefb4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"987328df-bfa7-4ef7-b39b-c5e03ac0aa7b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Aluguel","MDR","ARV"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-37c95e94-a03f-4ca1-80fe-225bc4778a39","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-33ab2c85-5132-4b02-b907-0fa960250a46","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f1937621-bddf-4188-86be-0b9aa0262f02","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6e636bb3-934c-468d-b3b8-0dfe945111ed","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"9cb5ee14-0641-4154-91a2-384720f31f85","root":false,"$title":"[TC.7.0.2][INPUT] Origem da cobrança","$position":{"top":"1118.57px","left":"3069.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1d4c3b8a-0f56-437e-beec-2c5ba9efea28":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"f676f5a4-86d1-4e05-a2b8-485b8dd91725","typeOfStateId":"state","$connId":"con_373","$id":"98a6a3d9-9e3c-4464-ad66-768762d5fd76","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bda34732-837d-43e2-ab6a-c26cfa80004d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado';\n  try {\n    if (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n    const regexDictionary = {\n      \"^c[oó]nt[aá]\\\\s*c[oó]rr[eé]nt[eé]$\": \"Conta corrente\",\n      \"^ag[eé]nd[aá]$\": \"Agenda\"\n    };\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex];\n      }\n    }\n    return invalidInputMessage;\n  } catch (err) {\n    return invalidInputMessage;\n  }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b77f2239-5e1d-4756-a5ab-f2aa237643d7","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"ce4db9f6-5647-4644-8abc-b0119d9e0493","$typeOfContent":"","type":"SetVariable","$title":"Set \"localVisualizacaoCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"localVisualizacaoCobranca","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ce585957-fc6f-481c-a6b9-9b6331f4c0d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ac17e99c-87e2-4b0b-9811-e16136d70cc1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Conta Corrente","Agenda"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-31ab610b-19c9-4511-86ad-a37b10fb77e1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3b386c85-8346-4bc3-8c2f-aa49291a17d6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-54fbea53-a5f6-41c8-a368-bcef72384f3b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-15e2f79d-dc81-4ecc-b22d-54bb8a462d18","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1d4c3b8a-0f56-437e-beec-2c5ba9efea28","root":false,"$title":"[TC.7.1.0][INPUT] Onde visualizou a cobrança","$position":{"top":"1685.57px","left":"3067.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7bf80e9d-79e9-4578-acba-c963f814037e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"604db07f-4e0d-4909-aaef-d23754b5bc65","typeOfStateId":"state","$connId":"con_378","$id":"ef04e652-526a-411f-9385-a603df4c7b38","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c95438ca-ada8-4352-bc3d-48620479c866","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tif (!data) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst regex = /^(\\d{2})[\\/\\-]?(\\d{2})[\\/\\-]?(\\d{4})$/;\n\t\tif (!regex.test(data)) return 'input inesperado';\n\n\t\tlet dia = parseInt(data.substring(0, 2));\n\t\tlet mes = parseInt(data.substring(3, 5));\n\t\tlet ano = parseInt(data.substring(6, 10));\n\n\t\tif (dia < 1 || dia > 31) return 'input inesperado';\n\t\tif (mes < 1 || mes > 12) return 'input inesperado';\n\t\tif ((mes == 4 || mes == 6 || mes == 9 || mes == 11) && dia == 31) return 'input inesperado';\n\t\tif (mes == 2) {\n\t\t\tconst bissexto = (ano % 4 == 0 && (ano % 100 != 0 || ano % 400 == 0));\n\t\t\tif (dia > 29 || (dia == 29 && !bissexto)) return 'input inesperado';\n\t\t}\n\t\treturn dia.toString().padStart(2, '0') + '/' + mes.toString().padStart(2, '0') + '/' + ano;\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f7d7e70b-45f0-457f-89e9-82943b64c561","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"data\"","$invalid":false,"settings":{"variable":"exceptionType","value":"data"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"ccce0800-0113-4088-b71c-3aae12d436d0","$typeOfContent":"","type":"SetVariable","$title":"Set \"dataCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"dataCobranca","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"d4776bf5-4b99-494e-a76c-049a18cd868f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"734a31ab-a5a0-41df-8fcb-fe7031f3c55c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a87f0634-6adc-477c-aaee-6e89ef747976","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d83d55f7-9244-4ad3-8455-0d9cf127419b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ee7f1f43-10fc-436d-afe8-ab69f603798b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7e0cb086-d8aa-4426-9e46-ab90724abdc5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7bf80e9d-79e9-4578-acba-c963f814037e","root":false,"$title":"[TC.7.2.0][INPUT] Solicita data da cobrança","$position":{"top":"2152px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"604db07f-4e0d-4909-aaef-d23754b5bc65":{"$contentActions":[{"action":{"$id":"5506b830-1b9b-4ca6-89fa-06039b587e70","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d73b6cc2-9e25-4b12-97af-7d6d54a53677","$typeOfContent":"text","type":"SendMessage","settings":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Por último, informe o valor exato da cobrança.\n\nComo neste exemplo:\n👉 3.500,00","metadata":{}},"$cardContent":{"document":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Por último, informe o valor exato da cobrança.\n\nComo neste exemplo:\n👉 3.500,00"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a9a96de6-7c5c-4625-8765-bd797a7e9c86","typeOfStateId":"state","$connId":"con_383","$id":"73a052ad-a897-4086-af37-45c8bf7a56e3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0f2b4506-1c0f-4e4a-a601-60a727e4d1ac","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-db4ea886-36fc-464b-a765-e01441a75a5f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3572f184-a342-4fa9-ae3d-6b9d495abe88","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"604db07f-4e0d-4909-aaef-d23754b5bc65","root":false,"$title":"[TC.7.3.0][MSG] Solicita valor da cobrança","$position":{"top":"2407.33px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a93d6907-ae20-48eb-afeb-42de5c3bc9ba":{"$contentActions":[{"action":{"$id":"289f49df-035c-409b-b964-e77f22a2e773","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d535b8e5-e90f-468c-a07b-49e1714c77b5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d535b8e5-e90f-468c-a07b-49e1714c77b5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac23b5d8-55c8-4e45-8cb9-7c5f919d8aa0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f8431b5c-018b-46fe-a5ae-d5ca83a2b909","type":"text/plain","content":"O seu pedido de revisão foi enviado com sucesso! \n\nEste é o número do seu protocolo \n<b>{{idProtocoloBpm}}</b>\n\nO prazo para análise é de até <b>4 dias úteis.</b>","metadata":{}},"$cardContent":{"document":{"id":"f8431b5c-018b-46fe-a5ae-d5ca83a2b909","type":"text/plain","content":"O seu pedido de revisão foi enviado com sucesso! \n\nEste é o número do seu protocolo \n<b>{{idProtocoloBpm}}</b>\n\nO prazo para análise é de até <b>4 dias úteis.</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"37286ef7-791d-4af5-938f-fd2600482e21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ce357aaf-62ad-433e-8e14-0695d22dd8c9","typeOfStateId":"state","$connId":"con_388","$id":"c5e218ce-0c5f-4d2a-b638-93dcb76cd382","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b6e6bd79-16cf-4654-b664-5d125d392d49","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-682dc429-3f41-4de0-8eec-07414b9f43e1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c7052cd2-44c5-421f-8af3-f316618e0fbe","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a93d6907-ae20-48eb-afeb-42de5c3bc9ba","root":false,"$title":"[TC.7.5.0][MSG] Protocolo Criado","$position":{"top":"3097.67px","left":"3066.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"ce357aaf-62ad-433e-8e14-0695d22dd8c9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"667f8c27-83a8-46b6-a0d6-22f1f3aaf496","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ce357aaf-62ad-433e-8e14-0695d22dd8c9","root":false,"$title":"[GO TO] Finalizacao ","$position":{"top":"3297.67px","left":"3067.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"aece7772-1087-427c-9eb8-891be0b4a004":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b2ec0d82-b63d-40d7-aa6d-f5c8e49957a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3eb16c87-6c3e-411d-b7ef-b9e49c13d2df","typeOfStateId":"state","$connId":"con_393","$id":"3db349a2-b3ca-4eec-b3f9-a644abf8841d","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"e40040f5-edd2-4063-b02c-b6d2d2490b53","typeOfStateId":"state","$connId":"con_398","$id":"e4631e8c-6545-4e15-aeb3-951eea10d7f0","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7f43624c-b91c-4c93-af22-e9716ed292f1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n  \n  function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { buttons } = JSON.parse(dynamicContent).interactive.action\n        buttons.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n            regexDictionary[key] = button.reply.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n  }","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"41261742-2361-4d4e-b1b3-066bb20246bb","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"47d922f8-1468-4475-a997-0eff3ac2f8cc","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"7a818d3d-00c5-4aa1-b3dd-54cc5e6c2966","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"24a1bb27-405d-41eb-8989-88e0a045d857","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6606655f-f34c-4101-a142-410d5d1ae557","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-87f0981e-9d37-4f6d-83d4-f8214cea657e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-605ceee8-bbda-4610-8529-553a45c0177e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2c181359-a6ec-4ebe-9574-272ae51c59d8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"aece7772-1087-427c-9eb8-891be0b4a004","root":false,"$title":"[TC.4.1.0][INPUT] Sem máquinas","$position":{"top":"656px","left":"1761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62786aa5-df6a-4069-9147-36ff1377b02c":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"dfd199b8-ed5e-44e2-b226-65990f659223","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_403","$id":"85090cee-f4fc-479b-aac1-028aef06464b","conditions":[{"source":"context","comparison":"equals","values":["Aluguel","Alugada"],"variable":"modalidadeMaquina"},{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_408","$id":"edb80c29-d63b-4d76-8371-02ea5457feac","conditions":[{"source":"context","comparison":"equals","values":["Comprada","Compra"],"variable":"modalidadeMaquina"},{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"5bf2a0db-0d48-4d71-8e84-d22c890f3b21","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n    try {\n        if (!userInput) {\n            return 'inatividade'\n        }\n        const alphanumericRegex = /^\\w+$/;\n        if (alphanumericRegex.test(userInput)) {\n            return \"Valido\"\n        }\n        return \"Input inesperado\"\n    }\n    catch (e) {\n        return \"Input inesperado\";\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"811c5e0e-585b-4b14-b865-b5c64a1564e9","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"numeroSerie\"","$invalid":false,"settings":{"variable":"exceptionType","value":"numeroSerie"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"fb1a70e8-f34e-4dfa-b57c-716e389d29eb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroSerie\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(userInput) {\n\ttry {\n\t\tuserInput = userInput.toString();\n\t\treturn `${userInput}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content"],"outputVariable":"numeroSerie","LocalTimeZoneEnabled":false},"conditions":[{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"3916ceef-75b5-4956-8bd4-11a107c43e60","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"291f6c32-bbc4-4531-b3f3-38add7613d92","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5a6589d0-4d5b-4e5e-8ce1-4f018bb0b2fb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f6f110d2-29f8-4bf8-a96a-a76d58c60b92","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6bf32638-48e1-4542-a6fd-8a47ee76a6d4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bf54627f-9539-4078-8733-5e0381c43c53","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"62786aa5-df6a-4069-9147-36ff1377b02c","root":false,"$title":"[TC.4.2.0][INPUT] Numero de Série","$position":{"top":"1462px","left":"927px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3468fd40-a03c-45dc-b438-f0066d5aee17":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"3576eedf-1d52-44fa-8018-41112a232738","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_413","$id":"490794ee-f656-48f1-8b54-03aa40ebe9ae","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["Aluguel"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_418","$id":"958376d9-52a0-4f92-a0c0-d9e20f895648","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["Comprada"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"bb74c3c9-73bc-4030-ae90-62acb134db5e","typeOfStateId":"state","$connId":"con_423","$id":"5c557a36-cee0-437b-8115-4716988b35a1","conditions":[{"source":"context","comparison":"lessThanOrEquals","values":["10"],"variable":"sizeMaquinas"},{"values":["Aluguel","Comprada"],"source":"context","variable":"userInput","comparison":"equals"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d20490b5-904a-4416-a731-06ac23f66cca","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n  \n  function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { buttons } = JSON.parse(dynamicContent).interactive.action\n        buttons.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n            regexDictionary[key] = button.reply.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n  }","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"40e65a97-519f-4ef8-b4db-25c479101d3b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"9ef7b366-4cbf-4bbb-8790-e8a8befc0e8e","$typeOfContent":"","type":"SetVariable","$title":"Set \"modalidadeMaquina\"","$invalid":false,"settings":{"variable":"modalidadeMaquina","value":"{{userInput}}"},"conditions":[{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"74f7c8ea-d813-4e50-a691-98c71491c048","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sizeMaquinas\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, modalidadeMaquina) {\n  try {\n    let consultMaquina = JSON.parse(consultMaquina);\n    consultMaquina = consultMaquina.data\n    let modalidadeMaquina = modalidadeMaquina.replace('Comprada', 'V')\n    if (modalidadeMaquina == 'V') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n    } else if (modalidadeMaquina != '') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n    }\n    consultMaquina = consultMaquina.length\n    return consultMaquina\n  }\n  catch (e) {\n    return e.message;\n  }\n}","inputVariables":["consultMaquina","modalidadeMaquina"],"outputVariable":"sizeMaquinas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6baaa566-b9aa-4df4-b7d0-046529d05cd4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"bd0b215d-8c11-43ae-a726-c8bd1f911fbc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Aluguel","Comprada"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8f3970bd-c505-4c2c-aeca-9374690e00f7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-746d5d1f-f8d8-4433-97c0-5e7abb1dad13","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f95ea038-61a1-4fe2-8365-5393b604a1f3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6474bda4-81f4-4871-bb35-c5959bb496b8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3468fd40-a03c-45dc-b438-f0066d5aee17","root":false,"$title":"[TC.4.3.0][INPUT] Alugada ou Comprada","$position":{"top":"988px","left":"1185px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"8e0fcca7-a496-4ef1-a91b-2549e02cacfc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"f72881e8-f826-4b73-bc74-af0c6c5c0994","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_428","$id":"d7fb1924-201b-4e29-8f70-6e777f865a04","conditions":[{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"},{"values":["Comprada"],"source":"context","comparison":"equals","variable":"modalidadeMaquina"}],"$invalid":false},{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_433","$id":"d38a6001-fe63-41df-bb96-bb9051d71203","conditions":[{"source":"context","comparison":"equals","values":["Valido"],"variable":"userInput"},{"values":["Aluguel","Alugada"],"source":"context","comparison":"equals","variable":"modalidadeMaquina"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"597789dd-9eee-4107-8355-8ea81ea0edb0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(sizeMaquinas, userInput) {\n\ttry {\n\t\tif (!userInput) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tlet selecao = parseInt(userInput)\n\t\tsizeMaquinas = parseInt(sizeMaquinas)\n\t\tif (selecao > sizeMaquinas) {\n\t\t\treturn \"Input inesperado\";\n\t\t}\n\t\tconst numericRegex = /^[1-9]+$/;\n\t\tif (numericRegex.test(userInput)) {\n\t\t\treturn \"Valido\"\n\t\t}\n\t\treturn \"Input inesperado\"\n\t}\n\tcatch (e) {\n\t\treturn \"Input inesperado\";\n\t}\n\n}","inputVariables":["sizeMaquinas","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"95509247-703a-4126-a125-02246fc47f23","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"listaNumerica\"","$invalid":false,"settings":{"variable":"exceptionType","value":"listaNumerica"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d1510921-7c4a-43c5-91ca-2295f39701b4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroSerie\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, modalidadeMaquina, index) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina).data;\n\t\tif (modalidadeMaquina == 'Comprada') {\n\t\t\tconsultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n\t\t} else if (modalidadeMaquina != '') {\n\t\t\tconsultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n\t\t}\n\t\tlet numeroSerie = consultMaquina[index - 1].numeroSerie\n\t\treturn numeroSerie;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["consultMaquina","modalidadeMaquina","input.content"],"outputVariable":"numeroSerie","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"36f7b9e5-515e-4fd7-b7a3-1340b551f8eb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"005b381c-b2a3-4491-827c-64597b4084c4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5aec8c44-ac05-432b-9709-e4a4f76ffb19","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a6d0bf7c-6b5e-4e2e-a041-28ddc8bf7654","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0f994bd0-7b9c-4b9a-b937-d319b12a5b4a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a67c06a2-ef0c-4170-9d94-165b16df03d4","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"8e0fcca7-a496-4ef1-a91b-2549e02cacfc","root":false,"$title":"[TC.4.4.0][INPUT] Lista número série","$position":{"top":"1858.75px","left":"1521px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e40040f5-edd2-4063-b02c-b6d2d2490b53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"efda90b4-9f46-480a-bb50-99aaa9fab7d3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e40040f5-edd2-4063-b02c-b6d2d2490b53","root":false,"$title":"[GO TO] Finalizacao   ","$position":{"top":"863px","left":"1861px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3eb16c87-6c3e-411d-b7ef-b9e49c13d2df":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"229f22dc-d3ef-4637-b03c-34bbe1bf1dcd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5724999e-4ebb-443e-8b1d-4c15ef40251e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3eb16c87-6c3e-411d-b7ef-b9e49c13d2df","root":false,"$title":"[GO TO] Redirect WhatsApp PJ (atendente)","$position":{"top":"850px","left":"1663px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a987eb86-a520-4671-9e28-bcc98388eff4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"73db3d78-b7a6-40d2-aed0-09ed45b00c7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"6509358e-b1fb-45d3-977c-cbf4b94cc5c4","typeOfStateId":"state","$connId":"con_438","$id":"e69b0346-b308-4615-abd4-6552913f322f","conditions":[{"source":"context","comparison":"equals","values":["Fazer outra consulta"],"variable":"userInput"}],"$invalid":false},{"stateId":"78b67e8d-1f89-44d8-955b-04e979597b42","typeOfStateId":"state","$connId":"con_443","$id":"9f7d87fe-79f3-4360-a478-690ad42d6183","conditions":[{"source":"context","comparison":"equals","values":["Encerrar"],"variable":"userInput"}],"$invalid":false},{"stateId":"963357f4-8de8-458d-afe0-50c1236f9d40","typeOfStateId":"state","$connId":"con_448","$id":"c8df77c9-a728-4c6f-bfdd-4e0270c0e481","conditions":[{"source":"context","comparison":"equals","values":["Falar com gerente"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dd68f93e-519d-433f-8787-edc0883dd5c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"61002fc4-da61-4953-b74d-595b0722758e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bd2f427e-8424-4eed-b643-112de920d73f","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"298d04e9-0948-499c-abdd-9965c3c463af","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"39d726e0-bba1-4817-a15c-9f20d340a7a3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Fazer outra consulta","Encerrar"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8f55d6ad-eda3-47cc-8eaa-43ae42a6bec0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f14141db-8275-48d5-add0-76370afe2d21","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6ef2d671-ac6b-49ee-9a96-9e45a2b1bb03","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9a401880-a14f-485c-b78f-4f82a2dda226","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a987eb86-a520-4671-9e28-bcc98388eff4","root":false,"$title":"[TC.4.6.0][INPUT] Como deseja prosseguir?","$position":{"top":"2578.5px","left":"1125.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"6509358e-b1fb-45d3-977c-cbf4b94cc5c4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c476535-bee3-4b71-acf9-506ce9c3db95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"24ee326c-2f65-4cf1-944e-2b178eaf2a82","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6509358e-b1fb-45d3-977c-cbf4b94cc5c4","root":false,"$title":"[GO TO] TC.4.0.0 Nova Consulta","$position":{"top":"2470px","left":"1436px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"78b67e8d-1f89-44d8-955b-04e979597b42":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17e3ccf6-6750-4341-81e5-fdbce4945d37","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"78b67e8d-1f89-44d8-955b-04e979597b42","root":false,"$title":"[GO TO] Finalizacao    ","$position":{"top":"2732px","left":"1430px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"820d335f-0c95-466f-9009-35cac24c6ea4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c658c7b5-387d-40d0-8508-205ad570d7d1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2458718f-7aa2-4eb0-8655-07cf8991b9a9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"820d335f-0c95-466f-9009-35cac24c6ea4","root":false,"$title":"[Redirect] To Finalizacao (Welcome)","$position":{"top":"0px","left":"957px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5724999e-4ebb-443e-8b1d-4c15ef40251e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"53ecccb3-e087-49da-8667-d20438985d9a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b0e87449-cedc-4403-99b9-f0a312c926bd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Whatsapp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: \"atendente\",\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"899b0fcf-a95a-42db-ab36-2b708dd3f4c9","$typeOfContent":"","type":"Redirect","$title":"Redirect to {service} sending \"atendente\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"atendente"},"address":"WhatsApp PJ"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d97eb3ea-8ce4-4eac-8a04-207c39bb7b90","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d94b5a97-4bd3-4734-8dbe-157bbb9e1e44","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5724999e-4ebb-443e-8b1d-4c15ef40251e","root":false,"$title":"[Redirect] To WhatsApp PJ (atendente)","$position":{"top":"0px","left":"1166px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5ddf643-13c0-4a81-a174-e1aa9dd86873":{"$contentActions":[{"action":{"$id":"66dcccdd-84cf-418f-921d-62b42de562cd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"351051cd-4798-413e-a702-ef0e2978bc81","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"351051cd-4798-413e-a702-ef0e2978bc81","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7712099a-1707-4bb2-ae75-112db962bb0d","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a893a955-6a21-4015-bd79-42b681faa3ce","typeOfStateId":"state","$connId":"con_453","$id":"a8589e38-4f1d-411c-96c1-79f84e25bbd0","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"97385bad-2724-4c43-8eda-2f52b32381f2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e condições {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e condições {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"c0af04a5-2b02-4fd8-9642-603e586aa13f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n    {\n        \"id\": \"6\",\n        \"title\": \"Questionar uma cobrança\",\n        \"description\": \"\"\n    }\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n    if (posicao > menuOptions.length) {\n        posicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n    }\n    if (menuOptions.find(option => option.id == posicao)) {\n        quantidadeItens = menuOptions.length\n        for (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n            menuOptions[i].id = (i + 2).toString()\n        }\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72) || ''\n        })\n    } else {\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72)\n        })\n    }\n    menuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n    // Parametro de busca é o title ou description da opção que deseja atualizar\n    const opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n    if (!opcao) {\n        return\n    }\n    menuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n    menuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao);\n\n    if (!opcao) {\n        return;\n    }\n\n    const hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n    if (hasPermission) {\n        return;\n    }\n\n    const index = menuOptions.indexOf(opcao);\n    if (index > -1) {\n        menuOptions.splice(index, 1);\n    }\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\nfunction removeDescricaoDoBotao({ tituloDoBotao, parteASerRemovida, listaPermissoes, permissaoNecessaria }) {\n    if (listaPermissoes.includes(permissaoNecessaria)) {\n        return\n    }\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions[index].description = menuOptions[index].description.replace(parteASerRemovida, '')\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada) {\n    try {\n        const { ec, permissoes } = JSON.parse(contaSelecionada)\n        if (ec) {\n            adicionaOpcaoNoMenu({ posicao: 1, title: 'Taxas de Venda', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 2, title: 'Taxas de Antecipação', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 3, title: 'Consultar Máquinas', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 4, title: 'Domicilio bancário', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 5, title: 'Taxas Pix na SafraPay', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 7, title: 'Contratar antecipação', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 8, title: 'Conciliação', description: '' })\n        }\n        verificaPermissao({ tituloDoBotao: 'Taxas de Antecipação', permissoesNecessarias: ['taxaDeAntecipacao'], permissoes })\n        verificaPermissao({ tituloDoBotao: 'Contratar antecipação', permissoesNecessarias: ['solicitarAntecipAuto', 'habilitarAntecipAutomatica', 'habilitarAntecipEventual'], permissoes })\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Certo! Sobre *Condições e Taxas*, do que você precisa?\n\t\t\t\t\t\nEscolha na lista a seguir:`\n                },\n                \"action\": {\n                    \"button\": \"Escolha uma opção\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": menuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return {\n            error: err.message,\n            exceptionType: 'reiniciarFluxo',\n            dynamicContent: {\n                \"type\": \"text/plain\",\n                \"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n            }\n        }\n    }\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f8f33c1d-6b2f-4964-acbc-5c85c1005522","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"0497fe76-a6d8-4063-ae55-f38ac8a74cfc","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"de339439-5404-44c2-a91a-563a7c1e20f3","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f88bdde1-b5b9-4a27-8d03-19232a3d95fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e51f30f8-8a75-4f29-83f3-dd5e5b643be2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fd82ac91-cb60-4742-ab2f-6bb0de78707f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8a4f91a0-60f7-42d4-a67a-741c099ae37e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$title":"[TC.1.0.0][MSG] Menu Taxas e condições","$position":{"top":"11.6667px","left":"2417.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a893a955-6a21-4015-bd79-42b681faa3ce":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"708a01ab-973e-404f-8e0f-fe4a312b5100","typeOfStateId":"state","$connId":"con_458","$id":"66cc2330-ecd8-4fae-8804-6a5918304e5d","conditions":[{"source":"context","comparison":"notEquals","values":["inatividade"],"variable":"userInput"},{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ff58f2fb-9134-4b51-a9c6-0f8c18db95be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n\nfunction run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12a40833-d247-4e44-bcf0-2bdba8ac1207","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"fcf8f81f-9420-4f56-8d83-0e0d398f8165","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"ccb97f39-b531-4101-a552-4924b142b8cd","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ef360673-a420-41df-a8d3-1970582a23df","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-84454deb-833c-4675-b467-74deb5cbecdc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c1864e9c-6f3a-4d80-b114-f18a2e5fde91","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5c331a4b-efb4-4572-b2aa-4d9ee3198779","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f3f051ec-4a27-48f1-95b4-b9c1b541d633","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a893a955-6a21-4015-bd79-42b681faa3ce","$title":"[TC.1.0.0][INPUT] Menu Taxas e condições","$position":{"top":"11.6667px","left":"2770.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"invalidOutputs":true},"708a01ab-973e-404f-8e0f-fe4a312b5100":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: '0e2bd49d-1b56-477b-883f-badf39288863',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d0e983cf-be61-4dfa-8344-1bc5f1be7955","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1ec3ec8e-2189-4018-87d7-634c054b15d3","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"708a01ab-973e-404f-8e0f-fe4a312b5100","root":false,"$title":"[Redirect] To \"Autenticacao\"","$position":{"top":"22.8571px","left":"3084.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"0e2bd49d-1b56-477b-883f-badf39288863":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{taxMenuDestinationId}}","typeOfStateId":"variable","$id":"fd0178bc-b7e5-4d2a-8cfe-4eb954a47cdc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1b70ffe8-7dfc-49a6-90ee-dd50830dbed9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxMenuDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n\tswitch (userInput) {\n\t\tcase 'Taxas de Venda':\n\t\t\treturn 'c4fec3d1-c20d-43de-9160-8a93f67989eb';\n\t\tcase 'Taxas de Antecipação':\n\t\t\treturn 'cac63fde-6671-4aa1-9a67-efc2f5336711';\n\t\tcase 'Consultar Máquinas':\n\t\t\treturn '24ee326c-2f65-4cf1-944e-2b178eaf2a82';\n\t\tcase 'Domicilio bancário':\n\t\t\treturn 'ad3f23f8-0c79-4faf-8b19-06ad242f99d2';\n\t\tcase 'Taxas Pix na SafraPay':\n\t\t\treturn '91dec6e6-2e08-462d-8d81-d38d2b223594';\n\t\tcase 'Contratar antecipação':\n\t\t\treturn 'f2c4d052-2f9b-4aa8-9925-48aa824fc35c';\n\t\tcase 'Questionar uma cobrança':\n\t\t\treturn '4a101355-7808-4bb7-a96d-7053a966074a';\n\t\tcase 'Conciliação':\n\t\t\treturn '5724999e-4ebb-443e-8b1d-4c15ef40251e';\n\t\tdefault:\n\t\t\treturn 'a5ddf643-13c0-4a81-a174-e1aa9dd86873';\n\t}\n}","inputVariables":["userInput"],"outputVariable":"taxMenuDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79bdff00-cb9b-438d-8530-a31a660423f2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}} | {{taxMenuDestinationId}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-77514e5b-8415-4186-8641-43dcf67ccd49","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5583120a-cd60-40c0-8609-a8f2ed320756","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0e2bd49d-1b56-477b-883f-badf39288863","$title":"[TC.1.0.0][SET] Menu Taxas e condições","$position":{"top":"17px","left":"3296.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"invalidOutputs":true},"f2c4d052-2f9b-4aa8-9925-48aa824fc35c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3557f98d-caff-49a2-89a4-71ffc80b5bb8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5907187f-5131-4cb6-a352-d0f1496b7299","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","root":false,"$title":"[Redirect] to Atendimento Humano","$position":{"top":"6.33333px","left":"1363.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b9a7f027-209a-4d73-ab4d-aa0086d480dc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'ed2a5fb2-da6f-4961-b14d-e302fa57b991',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2717e3e8-3351-4fcc-a9eb-f3bb9ed89916","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6bcdb3c4-fce8-4146-99d3-3e4b5659afd3","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"b9a7f027-209a-4d73-ab4d-aa0086d480dc","root":false,"$title":"[Redirect] to Finalizacao (F.4.0.0)","$position":{"top":"11.25px","left":"1556.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"368ed6d2-36d7-4631-a0b5-982523a88008":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d3f33e59-2d1a-4743-8950-eab3409746a4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40be20b8-777e-4426-8b10-5784fd180f18","typeOfStateId":"state","$connId":"con_463","$id":"ae3a7fbe-5e71-4316-9247-84e350d010e1","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"9654bbae-376f-439f-a7bd-5ce83c1939d4","typeOfStateId":"state","$connId":"con_468","$id":"3d82801a-bc18-492c-9c28-43985cb1a389","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1745a276-38a7-490b-a01d-9ae2a7722a87","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"7bf85e68-666b-477b-8282-b3bbdb0b8a3f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{state.previous.name}} | {{contaSelecionada@segmentoGerente}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9c5b1385-5408-45dc-9cd5-efedbdf39e84","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"368ed6d2-36d7-4631-a0b5-982523a88008","root":false,"$title":"[SET] Valida Carteirização","$position":{"top":"987px","left":"4366px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"40be20b8-777e-4426-8b10-5784fd180f18":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"845c49d1-02c2-4b51-b338-04c3bf582335","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"b9a7f027-209a-4d73-ab4d-aa0086d480dc"},"isAiGenerated":false,"$tags":[],"id":"40be20b8-777e-4426-8b10-5784fd180f18","root":false,"$title":"[GO TO] Redirect F.4.0.0 Finalização","$position":{"top":"1243px","left":"4144px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"9654bbae-376f-439f-a7bd-5ce83c1939d4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d558b48c-877c-41c8-a585-da2d3573e6d4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"isAiGenerated":false,"$tags":[],"id":"9654bbae-376f-439f-a7bd-5ce83c1939d4","root":false,"$title":"[GO TO] Redirect Finalização F.0.0.0","$position":{"top":"1244px","left":"4572px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"7399f98b-a0d4-4892-901c-bb662285e254":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f479326b-16fe-435b-85df-257d6fc38333","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7399f98b-a0d4-4892-901c-bb662285e254","root":false,"$title":"[GO TO] AH.0.0.0 Atendimento Humano","$position":{"top":"2105px","left":"2282.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"963357f4-8de8-458d-afe0-50c1236f9d40":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f479326b-16fe-435b-85df-257d6fc38333","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"963357f4-8de8-458d-afe0-50c1236f9d40","root":false,"$title":"[GO TO] AH.0.0.0 Atendimento Humano","$position":{"top":"2589px","left":"1679px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4668cb14-a953-4cd6-a7c6-23dc18b0b548":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ee5edbd4-f130-4d58-8f5b-cf20cf214bc7","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"4668cb14-a953-4cd6-a7c6-23dc18b0b548","root":false,"$title":"[GO TO] Atendimento Humano ","$position":{"top":"3805.67px","left":"348.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.65","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","builder:stateExpiration":"0.00:15:00","clientId":"BLIP","grantType":"client_credentials","urlToken":"urlToken/https://sts-api.safra.com.br","urlCHT":"https://api.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","domicilio":"true","serviceName":"Bot Taxas e Condições","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/prodspdtaxasecondicoes","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"04e03293-15b1-40c5-8c2d-b4b660510d4d","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"currentDate\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return getFormatDate();\n}\n\nfunction getFormatDate() {\n    const dataAtual = new Date();\n\n    const getDay = String(dataAtual.getDate()).padStart(2, '0');\n    const getMonth = String(dataAtual.getMonth() + 1).padStart(2, '0');\n    const getYear = dataAtual.getFullYear();\n    const getHour = String(dataAtual.getHours()).padStart(2, '0');\n    const getMinutes = String(dataAtual.getMinutes()).padStart(2, '0');\n    const getSeconds = String(dataAtual.getSeconds()).padStart(2, '0');\n\n    return `${getDay}/${getMonth}/${getYear}`;\n}","inputVariables":[],"outputVariable":"currentDate","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"96e30c46-c895-45fa-9967-3f3ebfc638a4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    if (!voltarState) {\n        const state = {}\n        state[botOrigin] = [blockId]\n        return state\n    }\n    const state = JSON.parse(voltarState)\n    try {\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}