{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"8c0bd4bf-6b0b-4085-a335-8af27420c779","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"1f27e71b-3784-4a22-bac7-a65dae1ea5d1","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"d049a751-3b37-4bd1-a419-23c57abffc90","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"a0a30b4b-4eef-4689-bfc7-f362b6c53975","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"fdba4a00-aa02-45c1-830e-7c1b79ef393e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"origemCampanhaPadrao\"","$invalid":false,"settings":{"function":"run","source":"function run(calendarDatetime, inputMessage, inputContent, broadcast, identity) {\n    const date = new Date(calendarDatetime);\n    \n    const dataFormatada = dataAtualFormatada(date);\n    let metadataCampanha = metadata(inputMessage);\n    const origem = origemCampanha(inputContent, metadataCampanha, broadcast);\n    const canal = origemCanal(identity);\n    metadataCampanha = metadataCampanha != \"\" ? metadataCampanha : \"nao possui campanha\";\n\n    const trackOrigemCampanha = `${dataFormatada} | ${identity} | ${metadataCampanha} | ${canal} | ${origem} | ${inputContent}`\n    \n    return { \n        trackOrigemCampanha,\n        canal\n    };\n}\n\nfunction dataAtualFormatada(data) {\n    const dia = data.getDate().toString();\n    const diaF = (dia.length == 1) ? '0' + dia : dia;\n    const mes = (data.getMonth() + 1).toString(); //+1 pois no getMonth Janeiro começa com zero.\n    const mesF = (mes.length == 1) ? '0' + mes : mes;\n    const anoF = data.getFullYear();\n    const hora = data.getHours().toString();\n    const horaF = (hora.length == 1) ? '0' + hora : hora;\n    const min = data.getMinutes().toString();\n    const minF = (min.length == 1) ? '0' + min : min;\n    const seg = data.getSeconds().toString();\n    const segF = (seg.length == 1) ? '0' + seg : seg;\n\n    return `${diaF}/${mesF}/${anoF} ${horaF}:${minF}:${segF}`;\n}\n\nfunction metadata(inputMessage) {\n    try {\n        let inputMessageFormatted = JSON.parse(inputMessage);\n        // let inputMessageFormatted = inputMessage;\n        let metadata = inputMessageFormatted.metadata;\n\n        if (metadata && metadata['#wa.referral.headline']) {\n            const metadataCampanha = `${metadata['#wa.referral.source_id']} | ${metadata['#wa.referral.source_url']} | ${metadata['#wa.referral.headline']} | ${metadata['#wa.referral.body']} | ${metadata['#wa.referral.source_type']} | ${metadata['#wa.referral.image.id']}`\n            return metadataCampanha;\n        } else {\n            const metadataCampanha = \"\"\n            return metadataCampanha;\n        }\n    } catch (err) {\n        const metadataCampanha = \"\";\n        return metadataCampanha;\n    }\n}\n\nfunction origemCampanha(inputContent, metadata, broadcast) {\n    try {\n        const sourceUrl = metadata;\n        if (sourceUrl != \"\") {\n            return \"Campanha\"\n        } else if(broadcast){\n            return `broadcast | ${broadcast}`\n        }\n        return \"organico\"\n    } catch (err) {\n        return \"organico\"\n    }\n}\n\nfunction origemCanal(identity) {\n    try {\n        const source = identity.split('@')[1].split('.')[0];\n        switch (source) {\n            case 'wa':\n                return \"whatsapp\";\n                break;\n            case 'businesschat':\n                return \"businesschat\";\n                break;\n            case '0mn':\n                return \"blipchat\";\n                break;\n            case 'messenger':\n                return \"messenger\";\n                break;\n            case 'telegram':\n                return \"telegram\";\n                break;\n            case 'instagram':\n                return \"instagram\";\n                break;\n            case 'mailgun':\n                return \"email\";\n                break;\n            case 'workplace':\n                return \"workchat\";\n                break;\n            case 'tunnel':\n                return \"whatsapp\";\n                break;\n            case 'abs':\n                return \"teams\";\n                break;\n            default:\n                return \"new\"\n                break;\n        }\n\n    } catch (error) {\n        return false;\n    }\n}","inputVariables":["calendar.datetime","input.message","input.content","contact.extras.broadcastOrigem","contact.identity"],"outputVariable":"origemCampanhaPadrao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dfe44f2b-7378-4221-8059-2c589d0ed9c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Origem campanha [[canal]]\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Origem campanha {{origemCampanhaPadrao@canal}}","action":"{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"origemCampanhaPadrao"},{"comparison":"exists","source":"context","values":[],"variable":"origemCampanhaPadrao@trackOrigemCampanha"}]},{"$id":"06b2da21-deca-437b-891a-509468dd3153","$typeOfContent":"","type":"SetVariable","$title":"Set \"userInput\" to \"{input.content}\"","$invalid":false,"settings":{"variable":"userInput","value":"{{input.content}}"},"conditions":[]},{"$id":"b73d2827-1f98-4885-b665-abb094018fd9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-adaef31e-2f7c-4b63-ad1d-b5af85752515","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b05fcf07-ee3d-455f-a4fb-c17a8e4a2642","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3e6ae76d-f41a-465e-a12c-4d392c0b90a0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d67f790d-732e-452d-94ea-053cff3a9f77","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"98px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ce4d5530-5502-4f59-9db1-f234569359c8","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2936feee-9a8c-488a-b210-940e102e6a53","typeOfStateId":"state","$connId":"con_8","$id":"b8d13fe8-ce23-406c-a2f1-63b2d6455e44","conditions":[{"source":"context","comparison":"equals","values":["input inesperado","inatividade"],"variable":"userInput"}],"$invalid":false},{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"ce8e103f-daa4-486a-b7c6-252124d2315b","$connId":"con_13","$invalid":false}],"$enteringCustomActions":[{"$id":"fe3adaaf-557c-454a-86a0-fccbea0b1aaa","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4491674e-30fc-4c54-a9f1-96bc59212057","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"72px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"78a63546-53b7-451d-951c-f0953819fb07","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"895fa7f0-cec1-4487-ba06-ab4d5692b6c8","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"blockDestinationId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b5b7636a-da52-44c4-9de8-86a4028ed472","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"f0eab05c-188d-4f3e-94cf-6809e0895611","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, templates, broadcastOrigem) {\n\ttry {\n\t\tconst parsedTemplates = JSON.parse(templates)\n\t\tconst broadcast = parsedTemplates[broadcastOrigem]\n\t\tlet blockDestionationId = '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n\t\tif (broadcast) {\n\t\t\tconst id = broadcast[inputContent]\n\t\t\tif (id) {\n\t\t\t\tblockDestionationId = id\n\t\t\t} else {\n\t\t\t\tblockDestionationId = broadcast\n\t\t\t}\n\t\t}\n\t\tif (blockDestionationId.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/)) {\n\t\t\treturn blockDestionationId\n\t\t}\n\t\treturn '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n\t} catch (err) {\n\t\treturn '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef' // [Redirect] to Main (zera variaveis)\n\t}\n}","inputVariables":["input.content","resource.broadcastList","contact.extras.broadcastOrigem"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"22855679-4c75-46b4-96b8-d68e55a534bc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{blockDestinationId}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2fc32750-1200-4a88-aa97-017bd6be52c5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fe4a4aa7-149d-4703-86bf-64d1c644be51","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","$title":"[BC.0.0.0] Identifica broadcast","$position":{"top":"417px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ac8d762b-d392-45db-9e20-84724d9d3da7":{"$contentActions":[{"action":{"$id":"ba95aa24-50ed-4f36-af04-50070981808c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9035fe13-9fac-4df5-946f-62ea350bc2aa","$typeOfContent":"text","type":"SendMessage","settings":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b21dda4-37cb-41cd-b52a-d020a742f2db","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"804c253e-be9f-42d4-bf03-18f3313fa15e","$typeOfContent":"","type":"TrackEvent","$title":"count_new_age_acesse_uso","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"count_new_age_acesse_uso","action":"1"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3f7d85cf-382d-4304-b653-8364e9f7a35a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2411a287-5df6-49ad-ac2d-efe39620d3e3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ac8d762b-d392-45db-9e20-84724d9d3da7","root":false,"$title":"[BC.1.0.0] Link New age","$position":{"top":"480.471px","left":"1418.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d4beee17-fca9-4e41-a016-ea05948c5598":{"$contentActions":[{"action":{"$id":"386b1f70-6cc5-461e-ae9a-7effc58f3836","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d9d8d36e-8d7a-46cf-ae50-5e21ee246f57","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf","metadata":{}},"$cardContent":{"document":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b54106c5-7c67-4690-95b9-857b0c52da99","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"49d1c76a-a1a0-4ec5-a4b4-b7435943a601","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-595486d5-73a8-4860-a651-33f1fd5efeca","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-974e19fb-23b5-4ef5-ada5-4a1d39e8f1e2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d4beee17-fca9-4e41-a016-ea05948c5598","root":false,"$title":"[BC.2.0.0] Link  boas vindas mbj ibj","$position":{"top":"467.429px","left":"1620.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"0e11155a-b0de-46f6-a922-b8cbec51b62f":{"$contentActions":[{"action":{"$id":"c52dae31-e901-44e6-80b6-b7b339c58157","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d22a1258-a613-4835-a1ad-a085074bd3b7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ca329296-0b20-4782-8f21-6a717c7b38f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bab02fd8-e12a-479a-b4f7-424951a17a67","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-64dd8d86-324d-4eaf-9f32-894080491729","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1b3732bd-8839-411b-82f0-70d37b90ca0a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e11155a-b0de-46f6-a922-b8cbec51b62f","root":false,"$title":"[BC.3.0.0] Link de Pagamento","$position":{"top":"487px","left":"1824.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2326fdc6-1097-4ee3-8f29-4887cad6a036","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","typeOfStateId":"state","$connId":"con_18","$id":"f119e366-afab-407d-b15d-8ee3743b53fa","conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}],"$invalid":false},{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_23","$id":"285abc84-9314-4a9d-b08f-e74bde3e52e5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"82bbd11e-bebd-45dc-97e7-9075a02d79fb","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager"},"conditions":[]},{"$id":"29a34062-1abb-41ae-9f75-4bc3ac065951","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager2\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager2"},"conditions":[]},{"$id":"a86e8dc4-b761-47c7-a721-d9f71abce3c9","$typeOfContent":"","type":"SetVariable","$title":"SET \"statusAccountManager3\" to Clear","$invalid":false,"settings":{"variable":"statusAccountManager3"},"conditions":[]},{"$id":"e6837107-5f2d-41fe-a3d3-3e99a51331c9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3be2c783-fca5-440d-8f3c-f8eece073c35","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"023446de-0356-4af2-9e57-990b44f42e47","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"534b4d6b-f3d4-4ab9-9b69-a4f76b3c11b0","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" PHONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"7046570d-80a1-4b6f-888d-8599807e057e","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J | GET | {{statusAccountManager}} | {{bodyAccountManager}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f6b8e392-af92-40b7-a833-a7c89026dbb6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ff57fe6a-f82a-41bf-af5c-f50b00c83d71","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cc501d79-9bc4-475c-a1c2-b0b1a06f358e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9f9c2dae-4806-41a4-ae97-4011b1ce213e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe","root":false,"$title":"[BC.4.0.0] Atendimento humano","$position":{"top":"607px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e6db4fe9-f1a4-4c40-8925-f588c3122da0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6bbf7c9a-06a3-40bd-8571-ed0bbce05e06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9e55259-59e8-4f3d-9a2a-e1a88fe3d778","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6","root":false,"$title":"[BC.5.0.0] Redirect to Main","$position":{"top":"644.143px","left":"1414px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"698dee4c-6a3d-4aee-bed0-0f5210864d2b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"391edfeb-b8b2-4401-93f1-1e037f271fa4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3531026c-da75-4b6d-b3b0-a4aa88609019","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-1de9099c-8af3-4bb3-a854-bfd530980a52","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"698dee4c-6a3d-4aee-bed0-0f5210864d2b","root":false,"$title":"[BC.6.0.0] Redirect to Finalização","$position":{"top":"649px","left":"1618.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a0438f36-f75b-4b4a-ab65-a95eefb35fa3":{"$contentActions":[{"action":{"$id":"ab4e8746-8a43-47df-8b0e-a5d5d5cd8b95","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43ae4c63-ecf8-4c6b-89fd-f3294442b8c7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ","metadata":{}},"$cardContent":{"document":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"333ee957-11c8-4bbd-a568-14ce2577d555","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8734c458-8d93-4764-bdd5-df63687a90c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-937eea37-b4e4-460e-be4a-74e6fca7321d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-06b9ecb6-6fe1-4c7b-bc05-a0aaf64dfdea","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a0438f36-f75b-4b4a-ab65-a95eefb35fa3","root":false,"$title":"[BC.7.0.0] Link Pesquisa Pix","$position":{"top":"649.5px","left":"1819.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a8d2f811-ac89-4e91-9b16-c93b4b661447',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a8d2f811-ac89-4e91-9b16-c93b4b661447',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d824e92b-5831-450d-81a5-0c55416f0498","$typeOfContent":"","type":"MergeContact","$title":"Reset \"extras\"","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-eb648027-9903-4324-885f-d558f43fa885","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-36339a5b-fa27-44c2-8757-25d0e66ac144","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-58962961-b9c5-4dda-8e98-4809bf9661c4","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","root":false,"$title":"[Redirect] to Main (zera variaveis)","$position":{"top":"198px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"449e71de-a279-4ed5-9d44-33d273412a70":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst newState =  {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '5a9c72b7-bfaf-4105-86c1-9cf8be316c37', // [AH.2.2.0] Api horario atendimento\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t\tif (parsedContaSelecionada == false || parsedContaSelecionada.segmentoGerente === 'emp2') {\n\t\t\tnewState.stateDestination = '9a6f3021-b73e-4a50-8ada-691ed5fecfd8' // [AH.2.0.1] Finalização segmento emp2\n\t\t}\n\t\treturn newState\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","contaSelecionada"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-73a0ed70-5093-4b55-873f-d119e1c072de","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-86e55c4b-6a15-4793-83ca-02c27fea0615","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"449e71de-a279-4ed5-9d44-33d273412a70","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"1268px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1":{"$contentActions":[{"action":{"$id":"1157f573-7664-44aa-9813-8ffcefc8e7a1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c0c436f9-1b47-4bb5-b460-c9b45c94b3ae","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento","metadata":{}},"$cardContent":{"document":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"809b569a-8f0e-4d3e-9823-aae35e2b21e0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"084d96a0-2b8c-481f-adfe-d1183cc13012","typeOfStateId":"state","$connId":"con_28","$id":"356ea3cf-f9b6-4306-9ff7-79057fba7002","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a1d9b64c-aa1f-4309-a1ad-3e07329bcf8c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-035758f5-3389-455b-822d-79fc80af2df4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-27be20d7-4ac8-42f7-a47b-73109db26a3e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","root":false,"$title":"[BC.4.1.0][MSG] Solicita CNPJ","$position":{"top":"619px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"084d96a0-2b8c-481f-adfe-d1183cc13012":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"6d518eb2-7541-4052-807c-590d1bf1daeb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","typeOfStateId":"state","$connId":"con_33","$id":"49eef362-cb6c-4e18-9be4-358351b14285","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"fadba59a-75b1-42e1-b0fa-f3f9eed4dd94","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(documento) {\n\tif (!documento) {\n\t\treturn 'inatividade'\n\t}\n\tdocumento = String(documento).replace(/\\D/g, '');\n\treturn verifyDoc(documento)\n}\nfunction verifyDoc(cnpj) {\n\tif (!cnpj || cnpj.length != 14\n\t\t|| cnpj == \"00000000000000\"\n\t\t|| cnpj == \"11111111111111\"\n\t\t|| cnpj == \"22222222222222\"\n\t\t|| cnpj == \"33333333333333\"\n\t\t|| cnpj == \"44444444444444\"\n\t\t|| cnpj == \"55555555555555\"\n\t\t|| cnpj == \"66666666666666\"\n\t\t|| cnpj == \"77777777777777\"\n\t\t|| cnpj == \"88888888888888\"\n\t\t|| cnpj == \"99999999999999\")\n\t\treturn 'input inesperado'\n\tvar tamanho = cnpj.length - 2\n\tvar numeros = cnpj.substring(0, tamanho)\n\tvar digitos = cnpj.substring(tamanho)\n\tvar soma = 0\n\tvar pos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tvar resultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(0)) return 'input inesperado';\n\ttamanho = tamanho + 1\n\tnumeros = cnpj.substring(0, tamanho)\n\tsoma = 0\n\tpos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tresultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(1)) return 'input inesperado'\n\treturn cnpj;\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5409cfb2-5097-429c-a723-a98905683b11","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"cnpj\"","$invalid":false,"settings":{"value":"cnpj","variable":"exceptionType"},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"9d68329a-9135-4cb8-bdd8-143f2f685d79","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"d89f5f8c-15c5-4e1f-a16e-e2215fea5082","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"60236687-a307-4961-bdf6-2399625116cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{userInput}} | {{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-567335f5-db9b-4717-9e01-0bdd110c1fa6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-274f8764-1144-43d1-abb4-d43609234a07","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d5ad9e7b-2c7a-4d8a-b4c9-6c8c563b8ca9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-13527e70-b333-400b-8915-ca26ea0f3d9f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"084d96a0-2b8c-481f-adfe-d1183cc13012","root":false,"$title":"[BC.4.1.0][INPUT] Solicita CNPJ","$position":{"top":"837px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed7b8709-622d-4d93-8f2c-1a2d37438a8b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_38","$id":"15b3d251-e293-4c08-b5b8-2925bda572ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7cacb353-36e0-4d85-b635-f21e527d6b29","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"0bf971c6-ccdb-44a1-9600-2b702d5314a4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020 | GET | {{statusAccountManager2}} | {{bodyAccountManager}}"},"conditions":[]},{"$id":"fcd1cbac-87a0-416d-b975-33ed425eaa1b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]}]},{"$id":"6b1825e7-5dab-432e-b8a0-9960d0ddc372","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017 | GET | {{statusAccountManager3}} | {{bodyAccountManager}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-da7e9392-e9d7-45d8-a43d-da992f4aa23b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b65fb832-edbb-43f1-ad2e-78aa47357c79","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","root":false,"$title":"[BC.4.2.0] Verifica carterização por CNPJ","$position":{"top":"1046px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8bea427a-b6e1-42d3-8844-958d7292ad16":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de40fb96-d81d-4d58-9486-f72ffb4ddfc0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3710"}],"$conditionOutputs":[{"stateId":"449e71de-a279-4ed5-9d44-33d273412a70","typeOfStateId":"state","$connId":"con_43","$id":"82ace0f2-c6f9-4628-a062-0a8cba05582f","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"contaSelecionada","$$hashKey":"object:3726"}],"$invalid":false,"$$hashKey":"object:3712"}],"$enteringCustomActions":[{"$id":"1d423e8d-45d5-4a3d-b22d-348b756acc43","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function montaCnpj(baseDocumento, filialCnpj, digitoCpf) {\n  let digito = ''\n  if (digitoCpf < 10 && digitoCpf > 0) {\n    digito = \"0\" + digitoCpf\n  } else {\n    digito = digitoCpf\n  }\n\n  let doc = Number(baseDocumento) + \"000\" + Number(filialCnpj) + digito\n  while (doc.length < 14) {\n    doc = `0${doc}`\n  }\n  return doc\n}\n\nfunction apiPhone(apiResponse) {\n  const { id, codigoSegmento, nomeCliente, baseCpfCnpj, filialCnpj, digitoVerificadorCpfCnpj } = apiResponse\n  const contaSelecionada = {\n    filaGerente: id,\n    segmentoGerente: Number(codigoSegmento) === 17 ? 'emp2' : 'emp1',\n    nomeEmpresa: nomeCliente,\n    doc: montaCnpj(baseCpfCnpj, filialCnpj, digitoVerificadorCpfCnpj),\n    codigoSegmento\n  }\n  return contaSelecionada\n}\n\nfunction apiGerentes(apiResponse, doc) {\n  const { sigla, codigoSegmento, nomeSegmento } = apiResponse\n  const contaSelecionada = {\n    filaGerente: sigla,\n    segmentoGerente: Number(codigoSegmento) === 17 ? 'emp2' : 'emp1',\n    nomeEmpresa: nomeSegmento,\n    doc,\n    codigoSegmento\n  }\n  return contaSelecionada\n}\n\nfunction run(status1, status2, status3, bodyAccountManager, userInput) {\n  try {\n    if ([status1, status2, status3].every(status => status !== 200)) {\n      return false\n    }\n    const parsedBodyAccountManager = JSON.parse(bodyAccountManager).data\n    if (status1 == 200) {\n      return apiPhone(parsedBodyAccountManager)\n    } else {\n      return apiGerentes(parsedBodyAccountManager, userInput)\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["statusAccountManager","statusAccountManager2","statusAccountManager3","bodyAccountManager","userInput"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"21943588-88aa-4b27-be1a-2ce235a9665c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{contact.extras.broadcastOrigem}} | {{userInput}} | {{userInput}} | {{input.content}} | {{contaSelecionada}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4ebbc4d1-24ed-48a7-83ea-d1ab5377e305","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f51d3914-a7ff-481b-ba2e-77203c00eb90","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"8bea427a-b6e1-42d3-8844-958d7292ad16","root":false,"$title":"[BC.4.3.0] Monta variavel contaSelecionada","$position":{"top":"1046px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2936feee-9a8c-488a-b210-940e102e6a53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-d4703838-3b42-4480-b474-55abaa740f33","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2936feee-9a8c-488a-b210-940e102e6a53","root":false,"$title":"[Redirect] To cascata","$position":{"top":"60px","left":"1577px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'fb94c3f1-88bc-4b44-b4f4-43dd60bce494',//sem pesquisa\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ac952674-c2c2-45fe-819b-bb4c85db914b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b629f81a-9978-401b-bf75-be5736b768c8","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","root":false,"$title":"[Redirect] to Finalizacao (finalizado)","$position":{"top":"206px","left":"1576px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d049a751-3b37-4bd1-a419-23c57abffc90":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1347955c-7744-4057-9b55-d0b6ef4b98f7","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","typeOfStateId":"state","$connId":"con_48","$id":"7ed1c7c3-5149-440e-bb54-627b4eb3ef5f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"83f149c4-16e5-44f7-ba6e-b2fab6c4fbfc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"542a59d9-4865-41a3-ac02-f292a3eccbb2","$typeOfContent":"","type":"ProcessHttp","$title":"DELETE \"statusDeleteBody\"","$invalid":false,"settings":{"headers":{"Organization":"safra","ContactIdentity":"{{contact.identity}}","BotAuthorization":"{{config.routerKey}}"},"method":"DELETE","uri":"https://flowassistant.cs.blip.ai/api-states","responseBodyVariable":"statusDeleteBody","responseStatusVariable":"statusDeleteStatus"},"conditions":[]},{"$id":"c70070af-7865-46f8-97dc-116ee6bd3320","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDeleteStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f2eae57-4f7d-495c-9d26-43cc521881fb","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | https://flowassistant.cs.blip.ai/api-states | DELETE | {{statusDeleteBody}} | {{statusDeleteStatus}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dce177f6-d2ef-4aa2-99e1-4857a2dfff20","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5a50cb10-da4e-4cbb-a3f9-dbc6f9a924e5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-73f1dc96-9ee9-4a28-9aa7-90b41d16138d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"d049a751-3b37-4bd1-a419-23c57abffc90","root":false,"$title":"[BC.0.0.0][HTTP] Reseta State ID","$position":{"top":"260px","left":"964px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E. South America Standard Time"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false}}