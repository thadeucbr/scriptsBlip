{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"765dc076-b87b-40d4-a571-f64fa62e7341","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"0e4a3f84-4473-4985-a879-6efe1da438a4","conditions":[{"values":["false"],"source":"context","variable":"blockDestinationId","comparison":"notEquals"}],"$invalid":false},{"stateId":"welcome","typeOfStateId":"state","$connId":"con_3","$id":"d7da0159-8b49-4eda-858f-06339a90237e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8c8cd4d0-da09-4045-8009-266626552731","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b39270fc-68ad-4103-98ef-cfd9a50f2079","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-055413da-b382-40bf-990e-07356fb0b0d3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"137px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bd18d48b-197a-4546-900b-5bd5cf12f99b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","typeOfStateId":"state","$connId":"con_8","$id":"41b772e3-09eb-4036-a1bf-83b66dc726fc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"18c6e28f-a1ec-41b6-89c8-4fbf15c2b8fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3596008-01fa-4e08-88d5-bf813e8b57d4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d562158e-1921-49c7-8e44-7574afaa9375","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"141px","left":"1134px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"4bd87cdf-8b20-4797-a08c-9eaa81374421","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! Boas-vindas ao atendimento virtual do Banco Safra para sua empresa. 😊","metadata":{}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! Boas-vindas ao atendimento virtual do Banco Safra para sua empresa. 😊"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"7041049f-fd4e-459b-bb19-e47d71e9580e","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"314dd865-7fe1-4276-af20-5567014eb6a7","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7e068d62-af04-4916-a1ff-eb223d8dcb99","typeOfStateId":"state","$connId":"con_13","$id":"f403b145-fa9f-499a-9342-b138d5c11025","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f373a4d-0201-4c29-8e9a-5f151816d10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"fe319907-8b8e-446d-9bed-4223996dd5cf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fcbf5dea-5071-4b71-883f-ceb7cc0ddec2","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"c32e574e-7a72-4845-b4e4-0d8252ddb4f8","$typeOfContent":"","type":"SetVariable","$title":"naoentendimento","$invalid":false,"settings":{"variable":"naoentendimento","value":"0"},"conditions":[]},{"$id":"8be340fd-eb7c-4dce-9e01-8aa6eb9fc7aa","$typeOfContent":"","type":"SetVariable","$title":"atendimento","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"40c8bc37-1623-4770-82c0-91f566fef78e","$typeOfContent":"","type":"SetVariable","$title":"autoservico","$invalid":false,"settings":{"variable":"autoservico","value":"não"},"conditions":[]},{"$id":"c45e707d-1fea-4add-b909-2600348ae4ea","$typeOfContent":"","type":"SetVariable","$title":"idSessao","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[]},{"$id":"9050bf5d-13ad-4128-b393-23a5def318ca","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]},{"$id":"43834797-fb29-4903-8309-f29579581759","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionTypeMedia\" to \"false\"","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"false"},"conditions":[]},{"$id":"2f89ee26-15b3-4f2d-bcc6-586a6f9fe20b","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"\"","$invalid":false,"settings":{"variable":"contaSelecionada"},"conditions":[]},{"$id":"6f9b0e43-7248-46a8-bc23-7507218b5e64","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"errorCounter\"","$invalid":false,"settings":{"variable":"errorCounter","expiration":1},"conditions":[]},{"$id":"5ee4c931-836b-4fd6-b01b-7bdd49322cc3","$typeOfContent":"","type":"SetVariable","$title":"Set \"returnStateAuth\" to \"false\"","$invalid":false,"settings":{"variable":"returnStateAuth","value":"false"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1154d2fc-4cb3-4982-83c8-399486742aef","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main input inicial\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main boas vindas input inicial","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"82c18de3-a766-4dac-ad75-28f3c2c10b4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api resumo\"","$invalid":false,"settings":{"extras":{},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlToken}}/api/oauth/token | {{encodingUrl}} | {{statusToken}} | {{bodyToken}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]},{"$id":"96054344-e00d-4816-8e97-7bb7adcce013","$typeOfContent":"","type":"SetVariable","$title":"doc","$invalid":false,"settings":{"variable":"doc","value":"0"},"conditions":[]},{"$id":"0a0ece1b-8afd-4242-87a6-e2046056a187","$typeOfContent":"","type":"SetVariable","$title":"statusContas","$invalid":false,"settings":{"variable":"statusContas","value":"0"},"conditions":[]},{"$id":"b1b09013-6a87-467a-9ec1-bf1c90399e40","$typeOfContent":"","type":"SetVariable","$title":"assunto","$invalid":false,"settings":{"variable":"assunto","value":"inicio"},"conditions":[]},{"$id":"a69b40c1-d95e-4c81-a07c-297064bfcbbf","$typeOfContent":"","type":"SetVariable","$title":"naoCliente","$invalid":false,"settings":{"variable":"naoCliente"},"conditions":[]},{"$id":"f9d75f7f-18e6-4d1c-bd6a-67ffef3e0722","$typeOfContent":"","type":"SetVariable","$title":"cpf","$invalid":false,"settings":{"variable":"cpf"},"conditions":[]},{"$id":"c9195cd0-2b03-449b-89f1-5efb5d48cf21","$typeOfContent":"","type":"SetVariable","$title":"nome","$invalid":false,"settings":{"variable":"nome"},"conditions":[]},{"$id":"5f704c90-0da6-4a90-bd1d-8af65ead98ea","$typeOfContent":"","type":"SetVariable","$title":"numeroSegmento","$invalid":false,"settings":{"variable":"numeroSegmento"},"conditions":[]},{"$id":"6d048ebe-b792-4ebf-bf50-18bbe18b796b","$typeOfContent":"","type":"SetVariable","$title":"statusContas","$invalid":false,"settings":{"variable":"statusContas"},"conditions":[]},{"$id":"cfd87c4c-f452-4a36-824f-ef931f31d3ce","$typeOfContent":"","type":"SetVariable","$title":"statusCarterizacao","$invalid":false,"settings":{"variable":"statusCarterizacao"},"conditions":[]},{"$id":"a21a79c7-f4cc-4aff-89cd-4c79f94a43d3","$typeOfContent":"","type":"SetVariable","$title":"statusDadosConta","$invalid":false,"settings":{"variable":"statusDadosConta"},"conditions":[]},{"$id":"41f86848-6f50-46b5-8dc9-41b152a66575","$typeOfContent":"","type":"SetVariable","$title":"autoservico","$invalid":false,"settings":{"variable":"autoservico"},"conditions":[]},{"$id":"c6087997-564f-428d-b53b-e2e618e7621f","$typeOfContent":"","type":"SetVariable","$title":"autenticadoKba","$invalid":false,"settings":{"variable":"autenticadoKba","value":"false"},"conditions":[]},{"$id":"a63feb13-b069-4c50-9104-0fd8dcd89891","$typeOfContent":"","type":"SetVariable","$title":"voltarState","$invalid":false,"settings":{"variable":"voltarState"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-159193c8-e03e-4f80-8676-666edd7b7856","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6fe41554-0e07-40f7-bad9-c65c8850041a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9469e271-fd69-4f57-a052-4aa3d652a8f1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-cf15aa84-adaf-4be9-ab3b-31dd2517a070","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c72c4db0-96e0-42d3-a2f0-a0930c99b416","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"welcome","$title":"[M.1.0.0][MSG][HTTP] Boas vindas","$position":{"top":"326px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7e068d62-af04-4916-a1ff-eb223d8dcb99":{"$contentActions":[{"action":{"$id":"de77b127-178b-4dad-bdc1-7f7468a7591f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Por gentileza, para seguirmos com o atendimento, precisamos que você informe o CPF do titular da conta.","metadata":{}},"$cardContent":{"document":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Por gentileza, para seguirmos com o atendimento, precisamos que você informe o CPF do titular da conta."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f64784f0-07f1-4543-aee4-dda0709eb450","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2108dc0d-7efc-4120-a380-d1624ed0e0b4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os números, como neste exemplo:👇\nCPF: 43913590806","metadata":{}},"$cardContent":{"document":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os números, como neste exemplo:👇\nCPF: 43913590806"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32fafead-1ba1-4524-94bb-6913efeee86c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","typeOfStateId":"state","$connId":"con_18","$id":"417421c1-8ac6-48ad-bb1f-b9d634898dc4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2adb915b-9570-4bb6-940a-9908820ad6f7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-89d2aa74-ce58-48fd-8a18-91653a851c3d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9f49056f-e198-4a3d-9ec3-f0cbe13a3337","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7e068d62-af04-4916-a1ff-eb223d8dcb99","root":false,"$title":"[M.2.0.0][MSG] Solicita CPF","$position":{"top":"505px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75b55cb8-4764-479d-b17d-48776ccc45c9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"05944f68-1d49-4a49-9782-622dee31cc95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"775e2746-a52f-48d0-9442-e17cd0c2fd82","typeOfStateId":"state","$connId":"con_23","$id":"6dd06b3f-39e7-44d9-ac8d-574696ee3d78","conditions":[{"values":["0"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":["unauthorized"],"source":"context","comparison":"notEquals","variable":"apiStatus"}],"$invalid":false},{"stateId":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","typeOfStateId":"state","$connId":"con_28","$id":"c8051bdc-1fcd-46fe-8b0d-6232681d6d3c","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}],"$invalid":false},{"stateId":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","typeOfStateId":"state","$connId":"con_33","$id":"b064be9b-d3c5-4a7c-b43c-ce5864fa1f62","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarContas@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fc784833-8d2f-4e3c-a9f6-a29e08d7b490","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyContas\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}}","responseStatusVariable":"statusContas","responseBodyVariable":"bodyContas"},"conditions":[]},{"$id":"cb7e2bdc-f341-44e7-9c67-eb82c80317a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyContas) {\n\ttry {\n\t\tconst contas = JSON.parse(bodyContas).data;\n\t\tlet arrContas = []\n\t\tlet totalLoops = 0;\n\n\t\tfor (let index = 0; index < contas.length; index++) {\n\t\t\tif (totalLoops > 100) break;\n\t\t\tfor (let indexB = 0; indexB < contas[index].contas.length; indexB++) {\n\t\t\t\tif (totalLoops > 100) break;\n\t\t\t\tconst novaConta = contas[index].contas[indexB];\n\t\t\t\tnovaConta.canal = contas[index].canal\n\t\t\t\tnovaConta.shortname = contas[index].shortname;\n\t\t\t\tnovaConta.usuario = contas[index].usuario\n\t\t\t\tnovaConta.codigoSegmento = contas[index].segmento\n\t\t\t\tarrContas.push(novaConta)\n\t\t\t\ttotalLoops++;\n\t\t\t}\n\t\t\ttotalLoops++;\n\t\t}\n\t\treturn {\n\t\t\tquantidadeContas: arrContas.length,\n\t\t\tcontas: arrContas\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tquantidadeContas: 0,\n\t\t\tcontas: []\n\t\t}\n\t}\n}","inputVariables":["bodyContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cab7169-21a8-41aa-aa30-5a74ceb7ddc4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"SPD Main {state.name} quantidade de contas\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} quantidade de contas","action":"{{contas@quantidadeContas}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contas@quantidadeContas"}]},{"$id":"fe38dc09-941f-4136-bcf0-a84d2114fcd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(data) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\treturn contas[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contas"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"}]},{"$id":"15fcf271-3186-45b1-89b2-c4f954b7e5e3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusContas"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"de1c5968-7160-4dfd-9b03-cf94d6d31aae","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarContas\"","$invalid":false,"settings":{"function":"run","source":"const replaceAt = (string, index, replacement) => {\n\treturn string.substr(0, index) + replacement + string.substr(index + replacement.length);\n};\n\n// function list(contas, maisContas) {\n// \ttry {\n// \t\tconst buttons = contas.map((conta, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: `${conta.agencia}-${conta.conta}`,\n// \t\t\t\ttitle: `AG${replaceAt(conta.agencia, 1, \"XXX\")} CC${replaceAt(conta.conta, 2, \"XXXX\")}`,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outras contas'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.\";\n// \t\tconst buttonTitle = \"Mostrar contas\";\n// \t\tconst headerText = \"Escolha uma conta\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn false;\n// \t}\n// }\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\tlet textoContas = ''\n\t\tcontas.slice(0, 100)\n\t\t\t.forEach((conta, index) => textoContas += `*${index + 1}* - AG ${replaceAt(conta.agencia, 1, \"XXX\")}\\nCC ${replaceAt(conta.conta, 2, \"XXXX\")}\\n`)\n\t\treturn textoContas\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["contas","state.name","idSessao"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarContas"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"}]},{"$id":"fd849d5e-7996-4de5-8ac4-92f1f18d707d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main script error","action":"{{exibeSelecionarContas@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarContas@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarContas@tracking"}]},{"$id":"ac7d3117-f8b5-4b22-b4fb-94bdccb70f82","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"1d578318-ae43-44ca-9716-3d5722d4af8f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}} | GET | {{statusContas}} | {{bodyContas}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-32f9a82b-664d-4c7d-b112-1c4a861359fd","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9707d2ca-c7e6-4c1a-9508-c6b8c647ef84","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3031159e-5059-46be-97aa-0c2a2eba1bfa","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"75b55cb8-4764-479d-b17d-48776ccc45c9","root":false,"$title":"[M.3.0.0][MSG][HTTP] Verifica contas","$position":{"top":"895px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ccd3d0b-0b52-4fef-9461-3b688137f8dd":{"$contentActions":[{"action":{"$id":"a0c6e498-307e-4a39-88a4-ee3ae564f480","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4ccbe2dd-f7c3-41c2-a5a5-9057f5e074e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4ccbe2dd-f7c3-41c2-a5a5-9057f5e074e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0b08869f-3c71-4e06-9631-117ca59b598a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87b70612-954e-4af0-bedc-5087f21df870","type":"text/plain","content":"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.","metadata":{}},"$cardContent":{"document":{"id":"87b70612-954e-4af0-bedc-5087f21df870","type":"text/plain","content":"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0aedb2ed-ce43-4be2-8c14-e3b930c10e33","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"afde8c23-50eb-48b6-8058-2b2d12f31d63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"afde8c23-50eb-48b6-8058-2b2d12f31d63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c3855dce-6b69-4b77-b2f3-e326807e1e11","$typeOfContent":"text","type":"SendMessage","settings":{"id":"42345d41-fdd9-46ab-b01a-50df57e2f6df","type":"text/plain","content":"Digite o número da opção escolhida. \nExemplo: *1*","metadata":{}},"$cardContent":{"document":{"id":"42345d41-fdd9-46ab-b01a-50df57e2f6df","type":"text/plain","content":"Digite o número da opção escolhida. \nExemplo: *1*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9a86d7f8-7fde-4106-ab85-790593c485be","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3f72e5a9-e1dc-4e82-bddb-7ccb329d38c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3f72e5a9-e1dc-4e82-bddb-7ccb329d38c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed7f19d1-e2d5-4928-b4dd-137383f4dfa2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"777b5cfc-09a5-4c63-8f94-d76bb4e2313b","type":"text/plain","content":"{{exibeSelecionarContas}}","metadata":{}},"$cardContent":{"document":{"id":"777b5cfc-09a5-4c63-8f94-d76bb4e2313b","type":"text/plain","content":"{{exibeSelecionarContas}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"83ae0e89-15eb-4001-8dd9-6073bb965b59","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","typeOfStateId":"state","$connId":"con_38","$id":"60fa561d-5338-454d-a2cd-641f936ca51e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48c846c9-dbf9-4efc-91ed-56921dc4595e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-227d990a-e482-45c4-b8ce-a9323589c213","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-36106219-e019-43df-bf52-ed7cb1b29391","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","root":false,"$title":"[M.3.1.0][MSG]Seleciona conta","$position":{"top":"1118px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"775e2746-a52f-48d0-9442-e17cd0c2fd82":{"$contentActions":[{"action":{"$id":"54831eb1-0ba8-4a8b-a6fe-37725d2e0c25","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d506add8-6da2-44d4-90d7-ceb4e7bdf17e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Parece que ainda não é nosso cliente. 🤔\n \nSó um instante, seu atendimento será transferido para um atendente.","metadata":{}},"$cardContent":{"document":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Parece que ainda não é nosso cliente. 🤔\n \nSó um instante, seu atendimento será transferido para um atendente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6a40c5ea-eb78-4056-8d3f-f4890e27497c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c","typeOfStateId":"state","$connId":"con_43","$id":"0c22bedb-8fff-4b14-8e4c-d722fb022b44","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a2e0fc43-30c6-4423-958d-6a9c1f2035d5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"6762adcf-fc02-40d1-822c-37f0b1c1da82","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\"","$invalid":false,"settings":{"variable":"naoCliente","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2f2ab18b-0775-427e-8ed6-d3d9286492f1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6786c877-77c0-4c46-a611-efff5cb29f39","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-77bbdabc-0605-438b-b8c7-bb7e6363a697","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"775e2746-a52f-48d0-9442-e17cd0c2fd82","root":false,"$title":"[M.3.0.1][MSG] Transbordo cliente não identificado","$position":{"top":"884px","left":"378px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"7b5bce4a-368f-48ac-8c8a-171e31e5b096":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","typeOfStateId":"state","$connId":"con_48","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"30e39880-1d2a-439a-a0ed-1e7210966286","typeOfStateId":"state","$connId":"con_53","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4afea420-704b-4f88-bc62-056d81224ff3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyDadosConta\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusDadosConta","responseBodyVariable":"bodyDadosConta"},"conditions":[]},{"$id":"0b6ff513-c46d-4619-b433-dc17203974a9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyUsuarios\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios","responseStatusVariable":"statusUsuarios","responseBodyVariable":"bodyUsuarios"},"conditions":[]},{"$id":"cb9f0cf9-050b-49e7-a0ca-4cad3e0181fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada, bodyDadosConta, bodyUsuarios, cpf) {\n\ttry {\n\t\t\n\t\tconst { tipoPessoa, baseDocumento, filialCnpj, digitoCpf } = JSON.parse(bodyDadosConta).data\n\t\tconst conta = JSON.parse(contaSelecionada)\n\t\tconst parsedBodyUsuarios = JSON.parse(bodyUsuarios).data\n\n\t\tconta['tipoPessoa'] = tipoPessoa\n\t\tconta['doc'] = cpf\n\t\tif (conta.usuario) {\n\t\t\tconta['usuario'] = conta.usuario.trim()\n\t\t}\n\t\tif (tipoPessoa === 'PJ') {\n\t\t\tlet doc = baseDocumento + \"000\" + filialCnpj\n\t\t\tlet digito = digitoCpf\n\t\t\tif (digitoCpf < 10) {\n\t\t\t\tdigito = \"0\"+digitoCpf\n\t\t\t}\n\t\t\tconta['doc'] = baseDocumento + \"000\" + filialCnpj + digito\n\t\t}\n\t\tif (parsedBodyUsuarios.length > 0) {\n\t\t\tlet primeiroNome = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome.split(' ')[0].toLowerCase()\n\t\t\tprimeiroNome = primeiroNome[0].toUpperCase() + primeiroNome.slice(1)\n\t\t\tconta['nomeCompleto'] = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome\n\t\t\tconta['primeiroNome'] = primeiroNome\n\t\t} else {\n\t\t\tconta['nomeCompleto'] = ''\n\t\t\tconta['primeiroNome'] = ''\n\t\t}\n\t\treturn conta\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["contaSelecionada","bodyDadosConta","bodyUsuarios","contact.extras.cpf"],"LocalTimeZoneEnabled":false,"outputVariable":"contaSelecionada"},"conditions":[]},{"$id":"068dbd3d-971c-4d11-b2f7-f05cb07c2169","$typeOfContent":"","type":"MergeContact","$title":"Set \"contactName\"","$invalid":false,"settings":{"extras":{},"name":"{{contaSelecionada@nomeCompleto}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@nomeCompleto"}]},{"$id":"ad6ae249-8b81-4b5e-93fa-74c1ab9dd3a4","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyEC\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/estabelecimentos?cpfCnpj={{contaSelecionada@doc}}","responseStatusVariable":"statusEC","responseBodyVariable":"bodyEC"},"conditions":[]},{"$id":"b9ed4fe7-ce29-4729-887d-06be26d85470","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ecList\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tconst ecs = JSON.parse(data).data;\n\t\tconst ecList = ecs.filter((ec) => ec.indSitEC === 'A')\n\t\treturn {\n\t\t\tecList,\n\t\t\tecQuantity: ecList.length\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyEC"],"outputVariable":"ecList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dde995d3-a23f-4103-9da6-45fd22ade501","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} quantidade ec\"","$invalid":false,"settings":{"extras":{},"action":"{{ecList@ecQuantity}}","category":"SPD Main {{state.name}} quantidade ec"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ecList@ecQuantity"}]},{"$id":"fcc19fae-2b77-4513-b177-9904e8917360","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selectedEc\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ecList) {\n\ttry {\n\t\tif(JSON.parse(ecList).ecQuantity != 1) {\n\t\t\treturn ''\n\t\t}\n\t\tconst ec = JSON.parse(ecList).ecList[0]\n\t\treturn ec\n\t} catch (err) {\n\t\treturn ''\n\t}\n}","inputVariables":["ecList"],"outputVariable":"selectedEc","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f0e851b-7a56-468d-bd87-ba103ff23ccd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDadosConta","statusUsuarios","statusEC"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"57e8fccf-5364-494e-8562-d12b8192646f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusCarterizacao}} | {{bodyCarterizacao}}"},"conditions":[]},{"$id":"7755e648-2c4a-47d9-842a-ef9e24d718a6","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusDadosConta}} | {{bodyDadosConta}}"},"conditions":[]},{"$id":"8abc6e92-2865-41ef-a6a5-d48d09e6f445","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios | GET | {{statusUsuarios}} | {{bodyUsuarios}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d82cc8cc-3a78-4839-bc94-57ff631f6514","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"7057224c-9e8c-4d86-8160-810ca6c47bc9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarEc\"","$invalid":false,"settings":{"function":"run","source":"// function list(ecs, maisContas) {\n// \ttry {\n// \t\tconst buttons = ecs.map((ec, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: ec.codigoEc,\n// \t\t\t\ttitle: ec.codigoEc,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outros ecs'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro.\\n\\nPor gentileza, digite a opção desejada.👇\";\n// \t\tconst buttonTitle = \"Selecionar EC\";\n// \t\tconst headerText = \"Escolha um ec\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn err.message;\n// \t}\n// }\n\nfunction run(data, idSessao, stateName) {\n\ttry {\n\t\tconst { ecList } = JSON.parse(data)\n\t\tconst message = ''\n\t\tecList.forEach((ec, index) => message += `*${index + 1}* - EC: ${ec.codigoEc}\\n`)\n\t\treturn message\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["ecList","idSessao","state.name"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarEc"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"ecList@ecQuantity"}]},{"$id":"6364306a-32c9-4b27-8efb-74824dae1de6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main script error","action":"{{exibeSelecionarEc@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarEc@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarEc@tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f44b74ac-34b6-4895-b96c-b0570913e35f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f46fe4e6-0fb0-4344-9ba5-a39cdc51c32d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f39bfcd-9242-4c57-84ec-998b008312a1","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-ca1e3c74-f299-43d5-ae42-5d26ffe57abc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","root":false,"$title":"[M.4.0.0][MSG][HTTP] Obtem EC","$position":{"top":"927px","left":"1161px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f13e7fbd-372e-45ce-a30f-de575a5cb830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-5190dacc-7aa3-4633-8b11-8eab2f5fdf5a","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f13e7fbd-372e-45ce-a30f-de575a5cb830","root":false,"$title":"[Redirect] To cascata","$position":{"top":"129px","left":"1366px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a":{"$contentActions":[{"action":{"$id":"573516a7-6247-4ab4-8054-793ae9a89e1d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5aa9ffd-855e-4039-9345-c68c1ad4cb2e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro.","metadata":{}},"$cardContent":{"document":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"27b2d5e1-e8be-4ca9-8e08-d1f77f8160e0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"67578171-d4fe-4d96-9fba-de8050f9a557","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"67578171-d4fe-4d96-9fba-de8050f9a557","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"57b83adb-262e-4779-8587-4d77cdff5627","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2717464f-4fd3-455c-98f7-08d08bc2a04b","type":"text/plain","content":"Por gentileza, digite a opção desejada.👇","metadata":{}},"$cardContent":{"document":{"id":"2717464f-4fd3-455c-98f7-08d08bc2a04b","type":"text/plain","content":"Por gentileza, digite a opção desejada.👇"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fd5493d7-9512-482c-8677-c3c856e153e5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4b16ab37-c01a-4ce1-8342-c2bd167b872c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4b16ab37-c01a-4ce1-8342-c2bd167b872c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2859d8fe-a5a5-4092-badf-985c1a987152","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b139f598-e763-492b-8b8d-b5b5cb908af0","type":"text/plain","content":"{{exibeSelecionarEc}}","metadata":{}},"$cardContent":{"document":{"id":"b139f598-e763-492b-8b8d-b5b5cb908af0","type":"text/plain","content":"{{exibeSelecionarEc}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed65c28f-2f50-414c-b58a-802440f38900","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e567a78-dbb9-4216-baa4-9d476bc2b887","typeOfStateId":"state","$connId":"con_58","$id":"ea6ea425-ef88-4bf1-89c2-387725bcce85","conditions":[{"values":[],"source":"input","comparison":"exists","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd4b372a-bdbd-4379-90a0-b180541ac632","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-69b921a8-b0d7-49eb-bcd2-ed8f5cf5a6ce","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-89db4b6e-7c76-4f61-9e18-f750c132a725","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","root":false,"$title":"[M.4.1.0][MSG] Selecionar EC","$position":{"top":"927px","left":"1414px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"30e39880-1d2a-439a-a0ed-1e7210966286":{"$contentActions":[{"action":{"$id":"e456922a-5fe5-404b-b33f-c7b85c103959","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ed3815ac-c7cf-4c6c-ad39-6bd05be10b5e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ed3815ac-c7cf-4c6c-ad39-6bd05be10b5e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3fe99f5b-8d15-485b-b146-09689a0b563c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"5856f6e3-4041-4263-8f0a-1c8673613f19","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, por aqui podemos te ajudar com os seguintes assuntos👇","metadata":{}},"$cardContent":{"document":{"id":"5856f6e3-4041-4263-8f0a-1c8673613f19","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, por aqui podemos te ajudar com os seguintes assuntos👇"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d8e25b49-af9d-42cb-9189-a7d020ab0974","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6eab91e1-a8d9-4f36-877e-bd3049512919","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"595bbc26-6daf-4319-a175-17192cf276fc","typeOfStateId":"state","$connId":"con_63","$id":"f6b5a2f4-95b2-4b95-a158-703dc53dc4eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3aa9d290-4cc4-4607-a662-a0366eb1b3d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"855ae543-ccea-4f1d-9023-9fa36553c558","$typeOfContent":"","type":"SetVariable","$title":"set \"naoCliente\" TO \"false\"","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"83de69ad-cc6d-4f42-8b73-e78b4a5e5528","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, selectedEc) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Perda ou Roubo\",\n\t\t\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Máquinas Safrapay\",\n\t\t\t\t\"description\": \"Condições e taxas, Suporte e configurações, Consultar OS, Vendas\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Conta Corrente\",\n\t\t\t\t\"description\": \"Extratos, Fazer pix, Pagar Contas, Antecipar saldo, Falar sobre conta\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Soluções\",\n\t\t\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Apoio à Navegação\",\n\t\t\t\t\"description\": \"Acesso, Alterações cadastrais, Alterar domicílio\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"6\",\n\t\t\t\t\"title\": \"Transação não autorizada\",\n\t\t\t\t\"description\": \"Transação não autorizada ou não reconhecida\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"7\",\n\t\t\t\t\"title\": \"Seguros\",\n\t\t\t\t\"description\": \"Informações sobre seguros.\"\n\t\t\t}\n\t\t]\n\t\tif (!cpfAppKey) {\n\t\t\tdefaultMenuOptions = [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Perda ou Roubo\",\n\t\t\t\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Máquinas Safrapay\",\n\t\t\t\t\t\"description\": \"Condições e taxas, Suporte e configurações, Consultar OS, Vendas\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Conta Corrente\",\n\t\t\t\t\t\"description\": \"Pix, Falar sobre conta\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"4\",\n\t\t\t\t\t\"title\": \"Soluções\",\n\t\t\t\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"5\",\n\t\t\t\t\t\"title\": \"Apoio à Navegação\",\n\t\t\t\t\t\"description\": \"Acesso, Alterações cadastrais, Alterar domicílio\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"6\",\n\t\t\t\t\t\"title\": \"Transação não autorizada\",\n\t\t\t\t\t\"description\": \"Transação não autorizada ou não reconhecida\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"7\",\n\t\t\t\t\t\"title\": \"Seguros\",\n\t\t\t\t\t\"description\": \"Informações sobre seguros.\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\tif (!selectedEc) {\n\t\t\tdefaultMenuOptions = [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Perda ou Roubo\",\n\t\t\t\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Condições e taxas\",\n\t\t\t\t\t\"description\": \"Veja nossas condições e Taxas\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Suporte e Configurações\",\n\t\t\t\t\t\"description\": \"Dúvidas sobre sua máquina\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"4\",\n\t\t\t\t\t\"title\": \"Soluções\",\n\t\t\t\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"5\",\n\t\t\t\t\t\"title\": \"Conta Corrente\",\n\t\t\t\t\t\"description\": \"Pix, Falar sobre conta\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"6\",\n\t\t\t\t\t\"title\": \"Apoio à Navegação\",\n\t\t\t\t\t\"description\": \"Acesso, Alterações cadastrais, Alterar Domicílio\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"7\",\n\t\t\t\t\t\"title\": \"Transação não autorizada\",\n\t\t\t\t\t\"description\": \"Transação não autorizada ou não reconhecida\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"8\",\n\t\t\t\t\t\"title\": \"Seguros\",\n\t\t\t\t\t\"description\": \"Informações sobre seguros.\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Ah! Você também pode digitar *Voltar* para voltar uma etapa, e *Sair* para finalizar o atendimento a qualquer momento.`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bf02a80c-2eb6-4ec2-add5-e968340753ab","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1aca1ac0-0b9d-40a5-8eab-a6cf06305050","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-135c258b-bb97-4cb9-8b29-687c3ed1cc41","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3cc30e41-9c53-45cf-89af-805a6ad6fa65","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3dccddcb-1cb5-47d9-99c5-82a80f8c3f3c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"30e39880-1d2a-439a-a0ed-1e7210966286","root":false,"$title":"[M.5.0.0][MSG] Menu Principal","$position":{"top":"1291px","left":"1161px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5ddf643-13c0-4a81-a174-e1aa9dd86873":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5b733936-1903-4654-b904-fc7b72d289cc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Bot Taxas e Condições ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'a5ddf643-13c0-4a81-a174-e1aa9dd86873',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d02ef8e1-41a6-4df8-ae88-9f54609b5548","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-500e78b2-ca5b-4dcc-a9c4-f4ac3077798e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-deb19a26-863d-427c-b9b3-15a33fa9756c","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$title":"[Redirect] To Taxas e condições","$position":{"top":"1743px","left":"24px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"491c0860-a3da-491c-bfc6-3b7f99e29c29":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"18838d12-aaf3-43c0-b6ae-1c14204ca89a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"525c6b7f-cc74-42fb-a747-f7948ebc0984","typeOfStateId":"state","$connId":"con_68","$id":"833fd40f-f365-49d2-a884-7dd4bbf5345e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"be5d1b5c-8ea6-4363-b2b8-3bf398126ac5","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpf\" to \"{contact.extras.cpf}\"","$invalid":false,"settings":{"variable":"cpf","value":"{{contact.extras.cpf}}"},"conditions":[]},{"$id":"b9150719-3abd-4de0-91a9-0e0a46b2e951","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoCliente\" to \"{contaSelecionada@codigoCliente}\"","$invalid":false,"settings":{"variable":"codigoCliente","value":"{{contaSelecionada@codigoCliente}}"},"conditions":[]},{"$id":"4d44859f-0717-41e5-ba98-576f390ab95a","$typeOfContent":"","type":"SetVariable","$title":"Set \"conta\" to \"{contaSelecionada@conta}\"","$invalid":false,"settings":{"variable":"conta","value":"{{contaSelecionada@conta}}"},"conditions":[]},{"$id":"85eb4b94-9458-4cf2-8406-5b4562fea7c7","$typeOfContent":"","type":"SetVariable","$title":"Set \"agencia\" to \"{contaSelecionada@agencia}\"","$invalid":false,"settings":{"variable":"agencia","value":"{{contaSelecionada@agencia}}"},"conditions":[]},{"$id":"af88479f-0eb6-4d73-8bf0-02d336989e40","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoSegmento\" to \"{contaSelecionada@codigoSegmento}\"","$invalid":false,"settings":{"variable":"codigoSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"8b5f060f-1017-40ea-9648-500fe736f645","$typeOfContent":"","type":"SetVariable","$title":"Set \"agenciaConta\" to \"{contaSelecionada}\"","$invalid":false,"settings":{"variable":"agenciaConta","value":"{{contaSelecionada}}"},"conditions":[]},{"$id":"1f7211bd-def1-4d54-920b-5e89a70cc76c","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoPessoa\" to \"{contaSelecionada@tipoPessoa}\"","$invalid":false,"settings":{"variable":"tipoPessoa","value":"{{contaSelecionada@tipoPessoa}}"},"conditions":[]},{"$id":"7909d9f8-3adc-4e98-8ac6-0157dd3cae94","$typeOfContent":"","type":"SetVariable","$title":"Set \"doc\" to \"{contaSelecionada@doc}\"","$invalid":false,"settings":{"variable":"doc","value":"{{contaSelecionada@doc}}"},"conditions":[]},{"$id":"148cc8da-b70b-4e08-b2b0-fbd643dc2932","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortname\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"shortname","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"e73aeada-145c-4b79-8ebd-c951c98a76ce","$typeOfContent":"","type":"SetVariable","$title":"Set \"ec\" to \"selectedEc@codigoEc\"","$invalid":false,"settings":{"variable":"ec","value":"{{selectedEc@codigoEc}}"},"conditions":[]},{"$id":"204f5d88-cf49-44a6-a048-aa84cbfb0d42","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"64588b09-10f5-41e0-b2ce-5c17fc3c210e","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{codigoSegmento}\"","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"02b7bc32-f8f9-4c46-bcfc-910d4c30f381","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortnameFull\" to \"{contaSelecionada@shortname}\"","$invalid":false,"settings":{"variable":"shortnameFull","value":"{{contaSelecionada@shortname}}"},"conditions":[]},{"$id":"558f5241-b041-4355-a445-98049bb6ee82","$typeOfContent":"","type":"SetVariable","$title":"Set \"usuario\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"usuario","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"909c2e2e-bf98-48eb-aaa6-fede43fd5d63","$typeOfContent":"","type":"SetVariable","$title":"Set \"nome\" to \"{contact.name}\"","$invalid":false,"settings":{"variable":"nome","value":"{{contact.name}}"},"conditions":[]},{"$id":"d3b43eaf-fb6e-4407-9dd1-aa13f7690077","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\" to \"false\"","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"5f2161cd-02b6-4e82-89b7-0054c54a0c0b","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoCliente\" to \"bdsp\"","$invalid":false,"settings":{"variable":"tipoCliente","value":"Bdsp"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}]},{"$id":"86666ff3-fd19-414d-8746-2a9e287541cd","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"402216b1-da34-4435-b20a-e857ea018e84","$typeOfContent":"","type":"ExecuteScript","$title":"phone","$invalid":false,"settings":{"function":"run","source":"function run(phone) {\n    let extracted_phone = phone\n        .split('@')[0]\n    if (extracted_phone.length == 10)\n        extracted_phone = extracted_phone\n            .substr(0, 2)\n            .concat('9', extracted_phone.substr(2));\n    return extracted_phone;\n}","inputVariables":["contact.identity"],"outputVariable":"phone","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"04fec05f-0acb-4d18-8550-9cdbfbd40958","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"{state@assunto}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{state@assunto}}"},"conditions":[]},{"$id":"27243618-496f-48c3-9b3e-a338e038e479","$typeOfContent":"","type":"SetVariable","$title":"Set \"nomeCompleto\" to \"{nome}\"","$invalid":false,"settings":{"variable":"nomeCompleto","value":"{{nome}}"},"conditions":[]},{"$id":"ad35f69b-4be8-485d-8a73-df753ffd3e48","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"const transferMessage = {\n\t'antecipar saldo': 'Antecipar saldo',\n\t'fazer pix': 'Fazer Pix',\n\t'pagar conta': 'Pagar contas',\n\t'extrato conta corrente': 'Extrato Conta',\n\t'extrato vendas': 'Extrato Vendas',\n\t'extrato recebimentos': 'Extrato Recebimentos',\n\t'perda ou roubo': 'Perda ou Roubo',\n\t'suporte técnico': 'Suporte Tecnico',\n\t'não recebi minha venda': 'Venda não recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'apoio à navegação': 'Aplicativo',\n\t'suporte e configurações': 'Suporte e Configurações',\n\t'transação não autorizada': 'Transação não Autorizada',\n\t'seguros': 'Seguros',\n\t'condições e taxas': 'Condições e taxas'\n}\n\nconst assunto = {\n\t'antecipar saldo': 'antecipação',\n\t'fazer pix': 'pix',\n\t'pagar conta': 'pagar contas',\n\t'extrato conta corrente': 'extrato conta',\n\t'extrato vendas': 'extrato vendas',\n\t'extrato recebimentos': 'extrato recebimentos',\n\t'perda ou roubo': 'perda ou roubo',\n\t'suporte técnico': 'Suporte Técnico',\n\t'aplicativo': \"Aplicativo\",\n\t'consultar protocolo': 'Consulta de Protocolo',\n\t'simulador de vendas': 'Simulador de vendas',\n\t'não recebi minha venda': 'Venda não recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'apoio à navegação': 'Apoio Aplicativo',\n\t'suporte e configurações': 'Suporte e Configurações',\n\t'transação não autorizada': 'Transação não Autorizada',\n\t'seguros': 'Seguros',\n\t'condições e taxas': 'Condições e taxas'\n}\n\nconst botDestination = {\n\t'antecipar saldo': 'WhatsApp PJ',\n\t'fazer pix': 'WhatsApp PJ',\n\t'pagar conta': 'WhatsApp PJ',\n\t'extrato conta corrente': 'WhatsApp PJ',\n\t'extrato vendas': 'WhatsApp PJ',\n\t'extrato recebimentos': 'WhatsApp PJ',\n\t'perda ou roubo': 'WhatsApp PJ',\n\t'suporte técnico': 'WhatsApp PJ',\n\t'consulta os': 'Bot OS',\n\t'aplicativo': 'App',\n\t\"não recebi minha venda\": \"Bot Máquina Safrapay\",\n\t'consultar protocolo': 'Bot Máquina Safrapay',\n\t'simulador de vendas': 'Bot Máquina Safrapay',\n\t'descredenciamento': 'WhatsApp PJ',\n\t'apoio à navegação': 'App',\n\t'suporte e configurações': 'Bot Máquina Safrapay',\n\t'transação não autorizada': 'Bot Máquina Safrapay',\n\t'seguros': 'seguros',\n\t'condições e taxas': 'Bot Taxas e Condições'\n}\n\nconst stateDestination = {\n\t'consulta os': 'fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db',\n\t'não recebi minha venda': '4b038e89-c130-4869-a541-4954e12ebf81',\n\t'consultar protocolo': '168598f7-bb5b-4eb0-a37e-45f8c48ccdde',\n\t'simulador de vendas': 'c391e959-860e-4eaf-86b9-71fcd8888c86',\n\t'descredenciamento': 'inicio',\n\t'apoio à navegação': 'Welcome',\n\t'suporte e configurações': '4f6e7e6d-21b4-4b11-9913-6aa5149a7469',\n\t'transação não autorizada': 'f0a8601f-5de1-4885-9b44-4f4a6e062c01',\n\t'seguros': 'Welcome',\n\t'condições e taxas': 'Welcome'\n}\n\nfunction run(userInput, env, previousBlockid, cpfAppKey, serviceName, previousStateName) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tif (!cpfAppKey && userInput.toLowerCase() === 'fazer pix') {\n\t\t\tuserInput = 'pix'\n\t\t}\n\n\t\tlet destination = botDestination[userInput.toLowerCase()] || `excecoes ${env || \"\"}`.trim()\n\t\tif (env === 'Dev' && destination !== 'WhatsApp PJ') {\n\t\t\tdestination = `${destination} ${env}`\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: destination,\n\t\t\tstateDestination: stateDestination[userInput.toLowerCase()] || 'welcome',\n\t\t\tuserInput: transferMessage[userInput.toLowerCase()] || userInput,\n\t\t\tassunto: assunto[userInput.toLowerCase()] || userInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: userInput,\n\t\t\tuserInput,\n\t\t\terror: err.message\n\t\t}\n\t}\n}\n\n","inputVariables":["userInput","config.env","state.previous.id","cpfAppKey","config.serviceName","state.previous.name"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-992f861a-4099-4790-84fc-5770c165f16e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9acdc57b-3bd8-417e-96d2-18237d041491","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"491c0860-a3da-491c-bfc6-3b7f99e29c29","root":false,"$title":"[Temporario][OLD] Redireciona ao serviço","$position":{"top":"1674.57px","left":"1161px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e0d2ce64-3265-46bd-b396-f53ad65b26e6":{"$contentActions":[{"action":{"$id":"45773e89-c639-48b0-a84f-5f29fdb265ef","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4debe525-4c4e-4205-8593-f4cc500ba0b2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4debe525-4c4e-4205-8593-f4cc500ba0b2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2b68cfc6-71ac-43dd-ba99-972954c677b2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"62ddc83e-559e-4fce-83d5-8d7020dde684","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"26faef34-7912-4e02-b8a6-069c18b0a656","typeOfStateId":"state","$connId":"con_73","$id":"6fcdc215-f3c2-4ac1-9f5d-929f74d63d9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"77a9996e-b081-4071-9ad4-416c7805cd87","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Condições e taxas\",\n\t\t\t\t\"description\": \"Veja nossas condições e Taxas\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Consulta OS\",\n\t\t\t\t\"description\": \"Consulte sua ordem de serviço\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Vendas\",\n\t\t\t\t\"description\": \"Simulador de vendas, Não recebi minha venda, Vendas Online\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"54\",\n\t\t\t\t\"title\": \"Suporte e Configurações\",\n\t\t\t\t\"description\": \"Dúvidas sobre sua máquina\"\n\t\t\t}\n\t\t]\n\t\t//Se não houver EC oculta a descrição do vendas.\n\t\tif (!ec) {\n\t\t\tdefaultMenuOptions = [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Condições e taxas\",\n\t\t\t\t\t\"description\": \"Veja nossas condições e Taxas\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Consulta OS\",\n\t\t\t\t\t\"description\": \"Consulte sua ordem de serviço\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Vendas\",\n\t\t\t\t\t\"description\": \"Não recebi minha venda\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"4\",\n\t\t\t\t\t\"title\": \"Suporte e Configurações\",\n\t\t\t\t\t\"description\": \"Dúvidas sobre sua máquina\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo! Sobre *Máquina Safrapay*, do que você precisa? Escolha na lista a seguir.👇`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"83551b1f-5996-47df-b780-cc7da6540faf","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ea304418-09fc-4c44-8eba-6688ec80765c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c7795a04-ac96-4779-b699-e8853e5fc15a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-af0a87f8-fe4a-4cb7-982d-b1c3d167ed33","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e0d2ce64-3265-46bd-b396-f53ad65b26e6","root":false,"$title":"[M.5.1.0][MSG] Menu - Máquinas Safrapay","$position":{"top":"1466.57px","left":"769.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"16cc5d45-c8d8-4b01-b000-e76eff268c33":{"$contentActions":[{"action":{"$id":"998bf25a-9982-432c-b62a-1c125857e622","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"95c802c6-6729-4c74-92b0-b1de93863467","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"95c802c6-6729-4c74-92b0-b1de93863467","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b527eddf-73c5-4cfb-9aa3-cd04c107fef9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b1f60af7-aebd-467b-a946-6b29986b4841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7206fc6a-f6b6-485e-b812-3470c5983596","typeOfStateId":"state","$connId":"con_78","$id":"e669d4be-d6e6-4a30-b620-e4990713d4c8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d543e27-b1fb-4836-b8de-df0eb2b8deb1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"990f94c3-a8fd-4e88-aed2-14630fea3f3c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n    try {\n        let defaultMenuOptions = [\n\n            {\n                \"id\": \"5\",\n                \"title\": \"Falar sobre conta\",\n                \"description\": \"\"\n            }\n        ]\n\n        if (!cpfAppKey) {\n\n            const cpfAppKeyOnlyOptions = [\n                {\n                    \"id\": \"2\",\n                    \"title\": \"Pix\",\n                    \"description\": \"\"\n                }\n            ]\n            defaultMenuOptions = [...defaultMenuOptions, ...cpfAppKeyOnlyOptions].sort((a, b) => a.id - b.id)\n        }\n\n\n\n        if (cpfAppKey) {\n            //  defaultMenuOptions = defaultMenuOptions.filter(({ id }) => id !== \"2\")\n\n            const cpfAppKeyOnlyOptions = [\n                {\n                    \"id\": \"1\",\n                    \"title\": \"Extratos\",\n                    \"description\": \"Consulte os extratos de sua conta\"\n                },\n                {\n                    \"id\": \"2\",\n                    \"title\": \"Fazer Pix\",\n                    \"description\": \"Realize um pix\"\n                },\n                {\n                    \"id\": \"3\",\n                    \"title\": \"Pagar Contas\",\n                    \"description\": \"Pagar boleto com código de barras\"\n                },\n                {\n                    \"id\": \"4\",\n                    \"title\": \"Antecipar saldo\",\n                    \"description\": \"Antecipação de recebíveis\"\n                }\n            ]\n            defaultMenuOptions = [...defaultMenuOptions, ...cpfAppKeyOnlyOptions].sort((a, b) => a.id - b.id)\n        }\n\n\n\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Certo! Sobre *Conta Corrente*, do que você precisa? Escolha na lista a seguir.👇`\n                },\n                \"action\": {\n                    \"button\": \"Escolha uma opção\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": defaultMenuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return err.message;\n    }\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7d37626c-1409-4b55-b9ce-af6e52322f71","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1fee396c-aa7a-49df-85af-4ec05fadc3bc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a5841200-2db9-44ad-b0bc-52398fa7ee99","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"16cc5d45-c8d8-4b01-b000-e76eff268c33","root":false,"$title":"[M.5.3.0][MSG]Menu Conta Corrente","$position":{"top":"1446px","left":"1758px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b18c91b6-6d84-4148-a01a-025c0acab39b":{"$contentActions":[{"action":{"$id":"14269fd1-7655-4b19-a045-fa3067d3015f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a3364784-a601-4871-a9fa-618b11893f02","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a3364784-a601-4871-a9fa-618b11893f02","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"556e595b-a097-49cf-adbe-46b9baee6d51","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8493b22-3f92-4fea-bc07-bfc816531526","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"15447ee8-85fd-4ca1-a198-57994d6f3fe7","typeOfStateId":"state","$connId":"con_83","$id":"dcb210ed-585c-41cd-a29f-4d24c2514f00","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"73a7b0f9-e131-42f8-bb6d-2a9919438905","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Extrato vendas\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Extrato recebimentos\"\n\t\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Extrato conta\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Selecione o tipo de extrato desejado. 👇\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"394dbdae-8215-421e-8740-b5f2751fb96d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f65df50e-2779-47fe-b05c-3b412b69ff81","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-40488ebd-0a9f-49d3-a301-610f0208f0d4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6de724a1-22f8-4c8a-bff3-84212766f01a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b18c91b6-6d84-4148-a01a-025c0acab39b","root":false,"$title":"[M.5.3.1][MSG] Menu Extratos","$position":{"top":"1749.89px","left":"2476.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"525c6b7f-cc74-42fb-a747-f7948ebc0984":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"af4b8e88-5277-4acd-9664-bd434b53ff39","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3996e980-1a2e-48dc-8e6b-238fd5523544","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b0ecb093-dad6-4329-9984-fa8631c56216","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"525c6b7f-cc74-42fb-a747-f7948ebc0984","root":false,"$title":"[Redirect] ao serviço","$position":{"top":"1899px","left":"1161.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"61aefdbf-bd7a-4f4f-8666-cb9b7631020c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"47339388-eaae-4f19-a068-1c9568252cc2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"491c0860-a3da-491c-bfc6-3b7f99e29c29","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"61aefdbf-bd7a-4f4f-8666-cb9b7631020c","root":false,"$title":"T -> Temporario OLD","$position":{"top":"2005.11px","left":"333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c9f89982-d088-4373-b5d4-0fab3a42fdec":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17d511cc-f90b-46e9-a37e-a2b95d447fea","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"491c0860-a3da-491c-bfc6-3b7f99e29c29","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c9f89982-d088-4373-b5d4-0fab3a42fdec","root":false,"$title":"T -> Temporario OLD","$position":{"top":"2122.89px","left":"2476.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06ecab99-d5ad-491b-b680-03a429bc6091","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"75b55cb8-4764-479d-b17d-48776ccc45c9","typeOfStateId":"state","$connId":"con_88","$id":"e6b2d820-969b-4e4a-becb-b8c0b2598b73","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ffe4a4c7-1ce7-4d67-a423-5c3d2c01b375","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf, exception) {\n    const invalidCpfMessage = 'input inesperado';\n    try {\n        if (!cpf) {\n            return 'inatividade'\n        }\n        if (exception === 'quickReply' || exception === 'skip') {\n            if (cpf.match(/tentar (novamente|novamnete|novament|novametne)/i)) {\n                return 'tentar novamente'\n            }\n            if (cpf.match(/encerrar(a|ar|ra|r)/i)) {\n                return 'encerrar'\n            }\n            return invalidCpfMessage\n        }\n        \n        cpf = cpf.replace(/\\D/g, '');\n        if (cpf.length !== 11 || /^(.)\\1*$/.test(cpf)) {\n            return invalidCpfMessage;\n        }\n        let sum = 0;\n        let remainder;\n        for (let i = 1; i <= 9; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(9, 10))) {\n            return invalidCpfMessage;\n        }\n        sum = 0;\n        for (let i = 1; i <= 10; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(10, 11))) {\n            return invalidCpfMessage;\n        }\n        return cpf;\n    } catch (err) {\n        return invalidCpfMessage;\n    }\n}","inputVariables":["input.content","exception"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8ceee10-b751-4f03-9fea-cf15009ee655","$typeOfContent":"","type":"MergeContact","$title":"Set \"cpf\" to \"{userInput}\"","$invalid":false,"settings":{"extras":{"cpf":"{{userInput}}"}},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"768bd9d1-acb2-4a9e-9a2b-e9d31c5c6d06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0f3dc18b-2a49-43ac-8e0f-fc9c50bb46cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"4d5083d0-0c1a-431c-94b0-6961c2f6cb94","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.2.0.1","variable":"exceptionType"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-87ab3a5e-1942-4f8c-aa7d-c72533f12562","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0463d233-0080-4508-972e-61ef264a9eb4","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-5bca3b15-4281-4a6c-842b-82e089d7e904","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c33557f3-ce04-4ad6-ba56-c2e158229d27","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-522a334e-df93-4e40-bb32-04c7f29b6a54","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","root":false,"$title":"[M.2.0.1][INPUT] Valida CPF","$position":{"top":"697px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"fbd38da5-c763-4500-aaf8-955e2461e1a8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","typeOfStateId":"state","$connId":"con_93","$id":"23207c0a-4052-4886-8c62-fa4af789e8fd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f549ed1f-5144-4910-b3eb-1d4931affe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(message, contas) {\n\ttry {\n\t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tif (isNaN(message)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tconst index = Number(message) - 1\n\t\tconst parsedContas = JSON.parse(contas)\n\t\tconst contaSelecionada = parsedContas.contas[index]\n\t\tif (!contaSelecionada) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\treturn contaSelecionada\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","contas"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c40f5e3d-554a-4b05-9ff3-b668ef7cecdc","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"contaSelecionada","value":"{{userInput}}"},"conditions":[{"values":["input inesperado","inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"d3c4d368-dab9-428c-8a29-11cb27cd80bb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f1e9fe18-56a9-4b25-b28b-807e3fbd01ea","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-eb504073-3547-4d6e-b23d-d7319ef52250","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-51df8f8e-5907-4deb-b92e-87981bc27410","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5182827c-2935-4daa-b604-af775e82500c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-edef11e7-c96c-402e-861d-50bf32959ce8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","root":false,"$title":"[M.3.1.1][INPUT] Valida Seleção de conta","$position":{"top":"1118px","left":"913px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e567a78-dbb9-4216-baa4-9d476bc2b887":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"633713cd-19ca-4db4-89db-7d7f4e743c98","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"30e39880-1d2a-439a-a0ed-1e7210966286","typeOfStateId":"state","$connId":"con_98","$id":"88d96d36-20fb-4051-aea1-130b6fadaef6","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"992bb5b8-1303-48c7-931a-f01ab2eaf914","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(message, ec) {\n\ttry {\n\t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n\n\t\tif (isNaN(message)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tconst index = Number(message) - 1\n\t\tconst parsedEc = JSON.parse(ec)\n\t\tconst ecSelecionado = parsedEc.ecList[index]\n\t\tif (!ecSelecionado) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\treturn ecSelecionado\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","ecList"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"493ad05b-2c7d-4996-9039-3779f2364a01","$typeOfContent":"","type":"SetVariable","$title":"Set \"selectedEc\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"selectedEc","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"710fb3be-ade5-4044-970a-b609fe9d3947","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"023a3323-c889-4d8b-9b1e-0a3e90055e1f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"51e3ecb2-3cd4-4e9e-85ad-bd5a2e11fb00","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.4.1.1","variable":"exceptionType"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-21fee477-b443-42d4-b351-594572c3de0e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1107eae9-e17a-4cb8-b660-a9a7b6577dda","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-709c86d1-126a-445f-be1f-ff84cccc3240","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4e343e3c-6abb-4303-ad1f-237783d6ec41","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0e567a78-dbb9-4216-baa4-9d476bc2b887","root":false,"$title":"[M.4.1.1][INPUT] Valida Seleção de ec","$position":{"top":"1279.75px","left":"1414px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"595bbc26-6daf-4319-a175-17192cf276fc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0d2ce64-3265-46bd-b396-f53ad65b26e6","typeOfStateId":"state","$connId":"con_103","$id":"a99636d2-f26d-493c-bc1a-ce50e9e39b6a","conditions":[{"source":"context","comparison":"equals","values":["Máquinas Safrapay"],"variable":"userInput"}],"$invalid":false},{"stateId":"c5482705-133e-4f31-b01e-7930e16e12a3","typeOfStateId":"state","$connId":"con_108","$id":"3a5498b9-e6af-4239-ae43-67f3bf7dfb1f","conditions":[{"source":"context","comparison":"equals","values":["Soluções"],"variable":"userInput"}],"$invalid":false},{"stateId":"16cc5d45-c8d8-4b01-b000-e76eff268c33","typeOfStateId":"state","$connId":"con_113","$id":"a50f025c-4721-4cdc-bf81-06efe1aeb30b","conditions":[{"source":"context","comparison":"equals","values":["Conta corrente"],"variable":"userInput"}],"$invalid":false},{"stateId":"491c0860-a3da-491c-bfc6-3b7f99e29c29","typeOfStateId":"state","$connId":"con_118","$id":"e618a090-8648-4609-b70b-ec545b004438","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"172bdd8d-2409-4bc2-8335-09884e2ecb33","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f082125-b0fd-4f51-9297-74bfc4b4c961","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"38306ba1-03a0-4eaf-a340-f50c2d48264d","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ab889191-fb1d-4935-9e7a-3fc688cbeede","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"precisaKBA\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(userInput) {\n\ttry {\n\t\tconst listaKBA = [\n\t\t\t\"Descredenciamento\",\n\t\t\t'Questionar uma cobrança',\n\t\t\t'pacotes',\n\t\t\t'Simulador de vendas',\n\t\t\t'Taxa Pix na Safrapay',\n\t\t\t'Taxas de antecipação',\n\t\t\t'Taxas de venda',\n\t\t\t'Consultar máquinas',\n\t\t\t'Domicílio bancário']\n\t\t\tconst precisaKBA = listaKBA.some(intencao => userInput === intencao)\n\n\t\t\tif (precisaKBA){\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t} catch(erro){\n\t\treturn false\n\t}\n}","inputVariables":["userInput"],"outputVariable":"precisaKBA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a39d9f66-ffe2-40a0-9d91-8307c0d8cdb0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"2c33d508-83ac-45cd-b327-99711864563b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7b0a1925-29fb-4f06-b16c-4a187d4643ba","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5d0cd947-496d-421c-9b18-b232ec1953c8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-acc996ae-ce28-49ff-bd75-0a25904c040c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9668c3fb-6341-4987-8bbf-fd5551b0b8f7","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"595bbc26-6daf-4319-a175-17192cf276fc","root":false,"$title":"[M.5.0.0][INPUT] Menu Principal","$position":{"top":"1478px","left":"1161px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7206fc6a-f6b6-485e-b812-3470c5983596":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b1f60af7-aebd-467b-a946-6b29986b4841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"5356fd1b-fa49-4426-b6c1-226aedc84bd3","typeOfStateId":"state","$connId":"con_123","$id":"aaddf475-a72d-4a09-ac4a-c58860ec6d8f","conditions":[{"source":"context","comparison":"equals","values":["Pix"],"variable":"userInput"}],"$invalid":false},{"stateId":"b18c91b6-6d84-4148-a01a-025c0acab39b","typeOfStateId":"state","$connId":"con_128","$id":"59f0c937-a811-444f-adb7-155f3241b5f9","conditions":[{"source":"context","comparison":"equals","values":["Extratos"],"variable":"userInput"}],"$invalid":false},{"stateId":"ccf8e895-d5ee-47ab-90e4-11d19e4d5a10","typeOfStateId":"state","$connId":"con_133","$id":"34ecf04d-48ce-40be-b357-166c354c15b9","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["Falar sobre conta"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a1c7d772-7946-4ba2-8ba2-e8120693b090","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c0b70a3-1ed1-4504-9ce4-1ee108036509","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"9caee4bd-4029-4442-b993-b0555e5ba454","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"102f100e-d00a-4542-9c14-217ff0690c2e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ffd90b76-a85c-4401-8cdd-53897f39019a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8aad778f-ff02-4633-b9db-7e596d43a4da","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-04c7104e-8ea7-4251-9748-8e9a8a8d42ac","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-15e5ebd8-902a-4f78-925a-ea649ec583b6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-75b1e724-55f0-4d0f-ae2c-18646a702475","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7206fc6a-f6b6-485e-b812-3470c5983596","root":false,"$title":"[M.5.3.0][INPUT]Valida seleção menu conta corrente","$position":{"top":"1462.89px","left":"2119.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"15447ee8-85fd-4ca1-a198-57994d6f3fe7":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c8493b22-3f92-4fea-bc07-bfc816531526","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9f89982-d088-4373-b5d4-0fab3a42fdec","typeOfStateId":"state","$connId":"con_138","$id":"b1644e2b-12ce-4e12-9d04-6a660bd691ca","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4ab1250d-0dbf-4502-8bc0-7faf7015593d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0340deaf-2276-4944-bfd7-717887492ab0","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"adeac3a1-b03b-47fc-9fe1-56c5c61a4e86","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"e1d21ac2-5478-48cb-8b5e-f0bcae880a16","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3692fd5a-ca4a-4c6d-98a0-c5426f3aad39","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1590482a-8837-436f-80aa-b6e63adc74a9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b598b3ca-a738-462c-99f6-e689c1582834","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-65aab2b0-97cd-4529-ba42-a0542cda67bb","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"15447ee8-85fd-4ca1-a198-57994d6f3fe7","root":false,"$title":"[M.5.3.1][INPUT] Valida seleção menu extratos","$position":{"top":"1921.89px","left":"2476.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"26faef34-7912-4e02-b8a6-069c18b0a656":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"62ddc83e-559e-4fce-83d5-8d7020dde684","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","typeOfStateId":"state","$connId":"con_143","$id":"7a42f34d-890f-4245-bf02-2faf05746dbf","conditions":[{"source":"context","comparison":"equals","values":["Condições e taxas"],"variable":"userInput"}],"$invalid":false},{"stateId":"c5ef80ee-bfa5-4929-8017-4c78d9f86bbe","typeOfStateId":"state","$connId":"con_148","$id":"1c39db59-adf4-4f52-91dd-0a3e0c895e69","conditions":[{"source":"context","comparison":"equals","values":["Vendas"],"variable":"userInput"}],"$invalid":false},{"stateId":"61aefdbf-bd7a-4f4f-8666-cb9b7631020c","typeOfStateId":"state","$connId":"con_153","$id":"6cbf379c-94d4-4e76-989b-ae26b16862c8","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"b8f910d1-f140-4584-b031-aa6bdab8c585","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2c853ac7-fde1-4b0d-92c7-f60b245a9072","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"00fb1c58-ac94-4872-ae2e-4329d1889e8d","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"95b3ca8c-7d57-4516-b57d-f7d5579948df","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"d67b36fe-d7aa-4b9c-9a59-b49a481f9b5d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c732ee49-f120-4c01-8400-c4e4a5f17b80","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-114b4973-5b03-41e1-886b-ca3675ced30d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c29e57ae-1319-48af-80e0-8e4ca3445487","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f145b614-3958-4371-99ea-cb4ab9109e8f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"26faef34-7912-4e02-b8a6-069c18b0a656","root":false,"$title":"[M.5.1.0][INPUT] Menu - Máquinas Safrapay","$position":{"top":"1492px","left":"332.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c5ef80ee-bfa5-4929-8017-4c78d9f86bbe":{"$contentActions":[{"action":{"$id":"45773e89-c639-48b0-a84f-5f29fdb265ef","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4debe525-4c4e-4205-8593-f4cc500ba0b2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4debe525-4c4e-4205-8593-f4cc500ba0b2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2b68cfc6-71ac-43dd-ba99-972954c677b2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"62ddc83e-559e-4fce-83d5-8d7020dde684","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"35a93cc9-44a0-4b9a-9214-c401f2bd5d9d","typeOfStateId":"state","$connId":"con_158","$id":"6fcdc215-f3c2-4ac1-9f5d-929f74d63d9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"77a9996e-b081-4071-9ad4-416c7805cd87","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Não recebi minha venda\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Vendas Online\",\n\t\t\t\t\"description\": \"\"\n\t\t\t}\n\t\t]\n\t\tif (ec) {\n\t\t\tdefaultMenuOptions = [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Simulador de vendas\",\n\t\t\t\t\t\"description\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não recebi minha venda\",\n\t\t\t\t\t\"description\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Vendas Online\",\n\t\t\t\t\t\"description\": \"Link de Pagamento, Portal Link, API Safrapay, TEF\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo! Sobre *Vendas*, do que você precisa? Escolha na lista a seguir.👇`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f2b92728-adef-4dd3-ab47-b3c40cc6ac1e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6dc211a0-c672-4e4f-8bf3-63a8555dfbe7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2b1637b6-3a77-4556-9d9c-1af32b284776","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4980ac09-817d-4dc3-944c-88578e3eff54","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c5ef80ee-bfa5-4929-8017-4c78d9f86bbe","root":false,"$title":"[M.5.1.2][MSG] Menu - Vendas","$position":{"top":"1723px","left":"645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"35a93cc9-44a0-4b9a-9214-c401f2bd5d9d":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"62ddc83e-559e-4fce-83d5-8d7020dde684","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"4ad60f8f-8c23-44a7-8528-9dbd3c0c6536","typeOfStateId":"state","$connId":"con_163","$id":"ff07b176-98fd-4b3c-8d37-8fe147441bb3","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Vendas Online"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"61aefdbf-bd7a-4f4f-8666-cb9b7631020c","typeOfStateId":"state","$connId":"con_168","$id":"6cbf379c-94d4-4e76-989b-ae26b16862c8","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f4dc1b2c-6916-4396-aecb-3d245a9e7e5e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2c853ac7-fde1-4b0d-92c7-f60b245a9072","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"00fb1c58-ac94-4872-ae2e-4329d1889e8d","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"95b3ca8c-7d57-4516-b57d-f7d5579948df","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"d67b36fe-d7aa-4b9c-9a59-b49a481f9b5d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f4b8aa6f-96a1-4586-bef3-feb091434ce0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f75b0639-3bba-47ea-9890-99e688715215","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bbea799d-923e-4ee3-ae6c-7d077648be06","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e12ed965-46f2-4bc7-905d-f41eb50b75a2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"35a93cc9-44a0-4b9a-9214-c401f2bd5d9d","root":false,"$title":"[M.5.1.2][INPUT] Menu - Vendas","$position":{"top":"1994px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4ad60f8f-8c23-44a7-8528-9dbd3c0c6536":{"$contentActions":[{"action":{"$id":"b90564c6-ab1b-46ff-b1fc-76389c0697b9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"79389fea-5a22-4077-8848-84ecd36b4516","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"79389fea-5a22-4077-8848-84ecd36b4516","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"25b9a46f-db18-4f56-b1f1-e9ded665d894","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"34eb1c20-4a5f-446c-a191-30ba4fa348a3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7ca8f3e0-f81a-48a1-9a81-f5abf8969423","typeOfStateId":"state","$connId":"con_173","$id":"50649ead-7c41-45f4-9f73-389eeceaba17","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3a278e7a-a753-4c10-99be-17488089ee7a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run() {\n\treturn {\n\t\t\"recipient_type\": \"individual\",\n\t\t\"type\": \"interactive\",\n\t\t\"interactive\": {\n\t\t\t\"type\": \"list\",\n\t\t\t\"header\": {\n\t\t\t\t\"type\": \"text\",\n\t\t\t\t\"text\": \"\"\n\t\t\t},\n\t\t\t\"body\": {\n\t\t\t\t\"text\": \"Veja como podemos ajudar.\\n\\nSelecione uma das opções a seguir.👇\"\n\t\t\t},\n\t\t\t\"action\": {\n\t\t\t\t\"button\": \"Assuntos\",\n\t\t\t\t\"sections\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"title\": \"Vendas Online\",\n\t\t\t\t\t\t\"rows\": [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\"id\": \"ID 1.1\",\n\t\t\t\t\t\t\t\t\"title\": \"Link de Pagamento\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\"id\": \"ID 1.2\",\n\t\t\t\t\t\t\t\t\"title\": \"Portal Link\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\"id\": \"ID 1.3\",\n\t\t\t\t\t\t\t\t\"title\": \"API Safrapay\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\"id\": \"ID 1.4\",\n\t\t\t\t\t\t\t\t\"title\": \"TEF\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7f62fac6-7150-4366-831d-a52a89217132","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e566f7a7-702b-4098-a175-d42a199fd20b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-de01b1b1-a09d-4900-90d0-d1bfa0525860","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-80260066-f69a-4ebb-a5b0-a45e6a3896a5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4ad60f8f-8c23-44a7-8528-9dbd3c0c6536","root":false,"$title":"[M.5.2.0][MSG] Venda Online","$position":{"top":"1994.11px","left":"890px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ca8f3e0-f81a-48a1-9a81-f5abf8969423":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c9016473-d211-44eb-97c7-e7bc60f461c1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3bd1f502-d1bd-45b4-9021-a9a7c7f6d192","typeOfStateId":"state","$connId":"con_178","$id":"2ba0ca5f-88e9-42bb-be58-4dc618a0628e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["TEF"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"16c97c97-32b5-4249-a279-ba2c2ee817c9","typeOfStateId":"state","$connId":"con_183","$id":"705d3d41-9047-46a2-ac98-ae5722801cc1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"1d9d8b89-4338-4fa7-9526-db7d677e1f11","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2eef2c40-51db-49e3-aea0-53a79ca131a5","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ee723013-22a9-4e7f-b5aa-d05a1aa24fa3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5981201b-819a-4f59-88b6-aa4f36d561b4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7cd88e1f-b337-4083-8b1d-3d0ae7aa89c5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-221f63ab-bcb8-4c2d-b744-354177c747bd","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7ca8f3e0-f81a-48a1-9a81-f5abf8969423","root":false,"$title":"[M.5.2.0][INPUT] Venda Online","$position":{"top":"2211px","left":"890px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"16c97c97-32b5-4249-a279-ba2c2ee817c9":{"$contentActions":[{"action":{"$id":"4fdb0a5d-f536-4390-9bf1-bfcf87e81114","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4058f9ed-04ff-4401-b6e6-54bf1ce5bcb1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4058f9ed-04ff-4401-b6e6-54bf1ce5bcb1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"28af84c1-1d5d-493c-8f82-979f92e86f4c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a8fcedce-c08e-468a-9aea-c7cb5c0f6659","type":"text/plain","content":"{{msgVendaOnline}}","metadata":{}},"$cardContent":{"document":{"id":"a8fcedce-c08e-468a-9aea-c7cb5c0f6659","type":"text/plain","content":"{{msgVendaOnline}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1456b57a-3dfc-4a28-81eb-519d6321e51f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d2ac225-26f9-4cdf-b13c-1b86bef1d5c0","typeOfStateId":"state","$connId":"con_188","$id":"b4430d47-650b-43ca-b7ae-95c03d9dbf3b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"605603b4-ec2c-43e6-bcda-3bab5bb04f00","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgVendaOnline\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    const msg = input;\n \n    if (msg == \"Link de Pagamento\") {\n        return \"O *Link de pagamento* Safrapay é uma solução rápida e fácil que permite a você compartilhar um link pela internet para que seus clientes realizem pagamento à distância.\\n\\nAceite os principais meios de pagamento do mercado com maior segurança através do *Antifraude Safrapay.*\"\n    }\n \n    if (msg == \"Portal Link\") {\n        return \"Com *Portal Link* Safrapay, você tem acesso a uma ferramenta completa para aumentar sua gestão e acompanhamento. \\n\\nIsso possibilita criar usuários para acesso individualizado, detalhar as transações, exportar relatórios e gerar link de forma rápida. \\n\\nAlém disso, oferece um dashboard completo para acompanhamento da sua taxa de aprovação.\"\n    }    \n \n    if (msg == \"API Safrapay\") {\n        return \"Através da *API Safrapay*, tenha acesso a diversas funcionalidades para aumentar a conversão nas suas vendas online.\\n\\nAceite os principais meios de pagamento com maior segurança, ou, se preferir, faça sua integração conosco através dos gateways e plataformas parceiras.\"\n    }   \n}","inputVariables":["userInput"],"outputVariable":"msgVendaOnline","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6968d948-3b20-4624-a73a-45490d19fa09","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-09872543-134d-4f41-8ec1-71346357c7b8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-21b2a6bb-609b-459c-a2f4-f548ca5ed040","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b96725cd-f919-432b-a152-96cf6d7e5460","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"16c97c97-32b5-4249-a279-ba2c2ee817c9","root":false,"$title":"[M.5.2.1][MSG] FAQ Venda Online","$position":{"top":"2416px","left":"890px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9d2ac225-26f9-4cdf-b13c-1b86bef1d5c0":{"$contentActions":[{"action":{"$id":"67e70cc9-6393-4d37-ba36-ab42735b0eed","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2098d415-a968-45b8-b588-9b9cc6dcf4ef","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2098d415-a968-45b8-b588-9b9cc6dcf4ef","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"39c28537-59ae-4084-b6af-709065d95861","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"230ef0f6-57ed-4fd0-9e7d-5b3ca97fa12d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1062b696-f6b1-451a-b62a-58750c8bb9b4","typeOfStateId":"state","$connId":"con_193","$id":"9bd7e953-35f1-4655-ab3d-8151dbbc4797","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"03a443b4-a97a-48bb-9f3d-66c22dc4f02b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run() {\n\treturn {\n\n\t\t\"recipient_type\": \"individual\",\n\n\t\t\"type\": \"interactive\",\n\n\t\t\"interactive\": {\n\n\t\t\t\"type\": \"button\",\n\t\t\t\"body\": {\n\n\t\t\t\t\"text\": \"Conseguimos ajudar você na sua solicitação? \"\n\n\t\t\t},\n\n\t\t\t\"action\": {\n\n\t\t\t\t\"buttons\": [\n\n\t\t\t\t\t{\n\n\t\t\t\t\t\t\"type\": \"reply\",\n\n\t\t\t\t\t\t\"reply\": {\n\n\t\t\t\t\t\t\t\"id\": \"unique-postback-id\",\n\n\t\t\t\t\t\t\t\"title\": \"Sim\"\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\n\t\t\t\t\t{\n\n\t\t\t\t\t\t\"type\": \"reply\",\n\n\t\t\t\t\t\t\"reply\": {\n\n\t\t\t\t\t\t\t\"id\": \"unique-id\",\n\n\t\t\t\t\t\t\t\"title\": \"Não\"\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t]\n\n\t\t\t}\n\n\t\t}\n\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e22386f9-dd5f-4f2d-8f57-a33d6822d920","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4ab64372-8539-4db0-a130-63820af558dd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-326dfb7a-5c29-4442-b583-084cd89f7bdf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ca6e132f-ffdf-476f-baa0-09e615275438","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9d2ac225-26f9-4cdf-b13c-1b86bef1d5c0","root":false,"$title":"[M.5.2.2][MSG] Resposta foi util","$position":{"top":"2669px","left":"890px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1062b696-f6b1-451a-b62a-58750c8bb9b4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"45bbe750-410e-4ed2-ae6b-af6797032ca6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"48a9fd94-ef8f-4a10-8543-b9ed910e5aa5","typeOfStateId":"state","$connId":"con_198","$id":"d68b370b-ee59-4445-88c0-64deb8ea831a","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Sim"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"3bd1f502-d1bd-45b4-9021-a9a7c7f6d192","typeOfStateId":"state","$connId":"con_203","$id":"4424960d-a89b-4570-adf8-8e658840c2f2","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Não"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"eda19762-f494-4434-8c94-b87edcd1f861","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"28a67ecc-7d99-43d3-a7d9-dd4856f341d7","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"b29a2d6b-f100-4c40-8979-81e6a45a518b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"861c93fb-7fe9-4f4f-b689-f0d96126b41b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1a868fc8-ec3e-4803-ab01-e8f79c7e075f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d5b2233f-b14d-41bc-81f6-a5c43c4f8954","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-95a49fda-392d-4606-9400-fe84000755e1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b8e7f6dc-902c-4be7-9579-373cf4be48d5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1062b696-f6b1-451a-b62a-58750c8bb9b4","root":false,"$title":"[M.5.2.2][INPUT] Resposta foi util","$position":{"top":"2897.4px","left":"889.889px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"48a9fd94-ef8f-4a10-8543-b9ed910e5aa5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d20ce6c3-e518-4c96-92c8-8188dde478a9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-37b4314b-fca3-41ad-b94c-228719d372fe","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"48a9fd94-ef8f-4a10-8543-b9ed910e5aa5","root":false,"$title":"[Redirect] serviço de Finalizacao (Welcome)","$position":{"top":"3090.71px","left":"660.714px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3bd1f502-d1bd-45b4-9021-a9a7c7f6d192":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tpreviousStateName: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: 'WhatsApp PJ',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'Vendas Online',\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-11ac8028-d0c9-41da-a827-cefad2fde696","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7d26448d-b942-449a-b2bb-0bdfaa848776","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"3bd1f502-d1bd-45b4-9021-a9a7c7f6d192","root":false,"$title":"[Redirect] serviço WhatsApp PJ (Vendas Online)","$position":{"top":"2559px","left":"661px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7d220bd-2237-49f4-88ec-14c555bf202c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',//Refatorar\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-aa18b54d-75ef-4e1f-ba2a-c151dd564ce4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4eac995b-763f-4f7c-816b-8c99e86c2e82","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c7d220bd-2237-49f4-88ec-14c555bf202c","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"896px","left":"141px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5356fd1b-fa49-4426-b6c1-226aedc84bd3":{"$contentActions":[{"action":{"$id":"cf269952-69f1-4e3a-a719-2dacea8ce1db","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3534d883-1029-4986-86fe-fc6b3664b5df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3534d883-1029-4986-86fe-fc6b3664b5df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c99aa7d0-b931-496d-adc5-8859c884c4cd","$typeOfContent":"text","type":"SendMessage","settings":{"id":"01b05f2e-e56d-4f9b-9405-444a40ce7947","type":"text/plain","content":"Estamos trabalhando para desenvolver novos serviços PIX aqui no WhatsApp.","metadata":{}},"$cardContent":{"document":{"id":"01b05f2e-e56d-4f9b-9405-444a40ce7947","type":"text/plain","content":"Estamos trabalhando para desenvolver novos serviços PIX aqui no WhatsApp."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac7d748f-20ff-43fe-966d-a1026ac98b51","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c0745c4c-b3a8-40f2-8d01-c95c368a3251","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c0745c4c-b3a8-40f2-8d01-c95c368a3251","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ba0598fa-98ff-4690-9f2b-bbf4d700f152","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7baa52e7-932d-4998-8d69-860fdd2d4021","type":"text/plain","content":"Para realizar um PIX ou consultar informações sobre PIX, acesse o seu aplicativo Safra Empresas.","metadata":{}},"$cardContent":{"document":{"id":"7baa52e7-932d-4998-8d69-860fdd2d4021","type":"text/plain","content":"Para realizar um PIX ou consultar informações sobre PIX, acesse o seu aplicativo Safra Empresas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"81325db7-f765-4b53-bcdd-14cc8c26b916","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d3e7c0ff-9892-4643-ba90-a8c141c939f7","typeOfStateId":"state","$connId":"con_208","$id":"1001ae96-cdf6-43f1-a945-ddbd2e7c7a64","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"671ffa19-a2b9-4441-a59d-ff28a9bb7b9d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"48a9fd94-ef8f-4a10-8543-b9ed910e5aa5","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b2772afb-5197-43cc-9de5-811143e508a6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7feca1a3-1457-450b-b4e4-65cd59de74ab","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5356fd1b-fa49-4426-b6c1-226aedc84bd3","root":false,"$title":"[M.5.3.2][MSG] Pix","$position":{"top":"1770.89px","left":"1755.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ccf8e895-d5ee-47ab-90e4-11d19e4d5a10":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'c7d220bd-2237-49f4-88ec-14c555bf202c',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"71e66d5e-ddc0-48d4-930d-8630f59d2205","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-907bdc32-622f-4519-be3e-b00b979d2b04","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-77f40c8c-8054-420c-b368-2fe0fc8a5823","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"ccf8e895-d5ee-47ab-90e4-11d19e4d5a10","root":false,"$title":"[Redirect] to Autenticacao (Falar sobre conta)","$position":{"top":"1770px","left":"2119px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c5482705-133e-4f31-b01e-7930e16e12a3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Soluções ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d4298a8d-1afd-4a91-84a2-fc09dcf31ed6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d019b9d3-aac4-423f-959d-e792348ce88d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f104e4b5-5f8e-413f-baa2-adb40321f512","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c5482705-133e-4f31-b01e-7930e16e12a3","root":false,"$title":"[Redirect] To Soluções","$position":{"top":"1684px","left":"1413px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d3e7c0ff-9892-4643-ba90-a8c141c939f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"770d7f11-c607-4c8d-9307-96397d447740","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"48a9fd94-ef8f-4a10-8543-b9ed910e5aa5","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d3e7c0ff-9892-4643-ba90-a8c141c939f7","root":false,"$title":"[GO TO] [Redirect] serviço de Finalizacao (Welcome)","$position":{"top":"1944.22px","left":"1755.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/spdmain","builder:stateExpiration":"0.00:15:00","serviceName":"Bot Main"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e936e5ea-adcf-4669-973c-073035ebeca3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    const state = JSON.parse(voltarState)\n    try {\n        if (!voltarState) {\n            const state = {}\n            state[botOrigin] = [blockId]\n            return state\n        }\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}