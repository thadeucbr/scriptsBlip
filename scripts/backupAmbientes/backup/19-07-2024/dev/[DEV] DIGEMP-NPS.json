{"flow":{"onboarding":{"$contentActions":[{"$invalid":false,"input":{"bypass":false,"$cardContent":{"document":{"id":"26036f36-1917-4afe-b535-0d6005454242","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right"},"$invalid":false},"$$hashKey":"object:567"}],"$conditionOutputs":[{"stateId":"25bb03c2-6a8e-4d03-850e-a01cebaea20a","typeOfStateId":"state","$connId":"con_3","$id":"5c86cfd1-8e83-40fb-a956-003c5b95b629","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:580"}],"$invalid":false,"$$hashKey":"object:570"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Executar script - GetTime Chatbase","$invalid":false,"settings":{"variable":null,"value":null,"function":"run","source":"\nfunction run() {\n    return (new Date()).getTime()\n}","inputVariables":[],"outputVariable":"currentTime","expiration":0,"LocalTimeZoneEnabled":false}},{"type":"ProcessHttp","$title":"Requisição HTTP - ChatBase Integration User","$invalid":false,"settings":{"variable":null,"value":null,"headers":{},"method":"POST","uri":"{{config.chatbaseURL}}","body":"{\n    \"api_key\": \"{{dynamicChatbaseKey}}\",\n    \"type\": \"user\",\n    \"user_id\": \"{{contact.identity}}\",\n    \"time_stamp\": \"{{currentTime}}\",\n    \"platform\": \"{{config.platform}}\",\n    \"message\": \"{{lastUserMessage}}\",\n    \"intent\": \"início\",\n    \"version\": \"{{config.version}}\",\n    \"session_id\": \"{{sessionId}}\"\n}\n","expiration":0}}],"$leavingCustomActions":[{"$id":"a5b50c86-73e7-40f0-a2c8-a414c3fbc765","$typeOfContent":"","type":"SetVariable","$title":"Inicio","$invalid":false,"settings":{"variable":"Inicio","value":"Inicio"},"conditions":[]}],"$defaultOutput":{"stateId":"25bb03c2-6a8e-4d03-850e-a01cebaea20a","$invalid":false,"typeOfStateId":"state"},"id":"onboarding","root":true,"$position":{"top":"510.5px","left":"649px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[]},"fallback":{"$contentActions":[{"$invalid":false,"input":{"bypass":true,"$cardContent":{"document":{"id":"d1fc97c3-8eaf-4fe9-901a-acefc0e87111","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false}}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"fallback","root":false,"$position":{"top":"511px","left":"866.5px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[]},"25bb03c2-6a8e-4d03-850e-a01cebaea20a":{"$contentActions":[{"action":{"$id":"8b774ec6-661a-4af9-a73f-6561d73f43af","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"deec0e22-1d11-4083-a2f0-b0eed592e4c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"deec0e22-1d11-4083-a2f0-b0eed592e4c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0378d0ff-5ed7-499e-b48e-eb839f74e124","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b48f1bf4-8934-47cb-87ed-4604563874d3","type":"text/plain","content":"Olá!\n\nPara podermos direcionar o seu atendimento da melhor maneira, por gentileza, informe o número do seu CPF.","metadata":{}},"$cardContent":{"document":{"id":"b48f1bf4-8934-47cb-87ed-4604563874d3","type":"text/plain","content":"Olá!\n\nPara podermos direcionar o seu atendimento da melhor maneira, por gentileza, informe o número do seu CPF."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f64784f0-07f1-4543-aee4-dda0709eb450","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2108dc0d-7efc-4120-a380-d1624ed0e0b4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os números, como neste exemplo:\nCPF: 43913590806","metadata":{}},"$cardContent":{"document":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os números, como neste exemplo:\nCPF: 43913590806"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32fafead-1ba1-4524-94bb-6913efeee86c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7c981f00-8192-4699-9429-0b0dcafdc329","typeOfStateId":"state","$connId":"con_8","$id":"417421c1-8ac6-48ad-bb1f-b9d634898dc4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2adb915b-9570-4bb6-940a-9908820ad6f7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"Exibição","action":"{{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-74766c3e-93bb-4cbd-94a0-9c3842995857","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-daf773ab-8e9d-4a19-b06b-ab9e94cf5dde","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"25bb03c2-6a8e-4d03-850e-a01cebaea20a","root":false,"$title":"[M.2.0.0][MSG] Solicita CPF","$position":{"top":"650px","left":"649px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7c981f00-8192-4699-9429-0b0dcafdc329":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06ecab99-d5ad-491b-b680-03a429bc6091","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"ee831952-8db2-4cc9-99c3-df155c6d3b8e","typeOfStateId":"state","$connId":"con_13","$id":"e6b2d820-969b-4e4a-becb-b8c0b2598b73","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}],"$invalid":false},{"stateId":"600cc78b-8b5a-43d3-a3c8-bfa3e2f79086","typeOfStateId":"state","$connId":"con_18","$id":"ae0f955c-6ecf-4dfa-9f68-1348e546d12d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ffe4a4c7-1ce7-4d67-a423-5c3d2c01b375","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf, exception) {\n    const invalidCpfMessage = 'input inesperado';\n    try {\n        if (!cpf) {\n            return 'inatividade'\n        }\n        if (exception === 'quickReply' || exception === 'skip') {\n            if (cpf.match(/tentar (novamente|novamnete|novament|novametne)/i)) {\n                return 'tentar novamente'\n            }\n            if (cpf.match(/encerrar(a|ar|ra|r)/i)) {\n                return 'encerrar'\n            }\n            return invalidCpfMessage\n        }\n        \n        cpf = cpf.replace(/\\D/g, '');\n        if (cpf.length !== 11 || /^(.)\\1*$/.test(cpf)) {\n            return invalidCpfMessage;\n        }\n        let sum = 0;\n        let remainder;\n        for (let i = 1; i <= 9; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(9, 10))) {\n            return invalidCpfMessage;\n        }\n        sum = 0;\n        for (let i = 1; i <= 10; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(10, 11))) {\n            return invalidCpfMessage;\n        }\n        return cpf;\n    } catch (err) {\n        return invalidCpfMessage;\n    }\n}","inputVariables":["input.content","exception"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8ceee10-b751-4f03-9fea-cf15009ee655","$typeOfContent":"","type":"MergeContact","$title":"Set \"cpf\" to \"{userInput}\"","$invalid":false,"settings":{"extras":{"cpf":"{{userInput}}"}},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"768bd9d1-acb2-4a9e-9a2b-e9d31c5c6d06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0f3dc18b-2a49-43ac-8e0f-fc9c50bb46cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ac46b404-c0a1-4fd3-bd61-6063dca3131e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-561c5167-31b7-4792-bd3a-a7e632f0b7bf","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-3547a4c4-fb8a-4da0-ad0a-054265460129","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cf0c0858-d2b4-4b92-9593-027475835ee8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-87e7e9be-6016-4387-aa81-94d5749712c3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7c981f00-8192-4699-9429-0b0dcafdc329","root":false,"$title":"[M.2.0.1][INPUT] Valida CPF","$position":{"top":"841px","left":"649px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ee831952-8db2-4cc9-99c3-df155c6d3b8e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"05944f68-1d49-4a49-9782-622dee31cc95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:914"}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_23","$id":"c8051bdc-1fcd-46fe-8b0d-6232681d6d3c","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas","$$hashKey":"object:934"},{"values":["1"],"source":"context","comparison":"greaterThanOrEquals","variable":"contas@quantidadeContas","$$hashKey":"object:935"}],"$invalid":false,"stateId":"af3e031d-f1ca-4701-af83-9c1871c37b32","$$hashKey":"object:916"},{"stateId":"62c349a4-22e0-4cf8-9bc4-7b6db79699f6","typeOfStateId":"state","$connId":"con_28","$id":"16dbdb90-983a-4e1a-a415-12e0474ebff9","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:959"}],"$invalid":false,"$$hashKey":"object:917"}],"$enteringCustomActions":[{"$id":"0ac6d227-c0f1-4ede-a65e-566557cbe2b3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n    try {\n        const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n        return URL;\n    }catch(e){\n        return e.message;\n    }\n  \n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bc463daa-81a7-4052-a839-aa5679151c6d","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"fc784833-8d2f-4e3c-a9f6-a29e08d7b490","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyContas\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}}","responseStatusVariable":"statusContas","responseBodyVariable":"bodyContas"},"conditions":[]},{"$id":"cb7e2bdc-f341-44e7-9c67-eb82c80317a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyContas) {\n\ttry {\n\t\tconst contas = JSON.parse(bodyContas).data;\n\t\tlet arrContas = []\n\t\tlet totalLoops = 0;\n\n\t\tfor (let index = 0; index < contas.length; index++) {\n\t\t\tif (totalLoops > 100) break;\n\t\t\tfor (let indexB = 0; indexB < contas[index].contas.length; indexB++) {\n\t\t\t\tif (totalLoops > 100) break;\n\t\t\t\tconst novaConta = contas[index].contas[indexB];\n\t\t\t\tnovaConta.canal = contas[index].canal\n\t\t\t\tnovaConta.shortname = contas[index].shortname;\n\t\t\t\tnovaConta.usuario = contas[index].usuario\n\t\t\t\tnovaConta.codigoSegmento = contas[index].segmento\n\t\t\t\tarrContas.push(novaConta)\n\t\t\t\ttotalLoops++;\n\t\t\t}\n\t\t\ttotalLoops++;\n\t\t}\n\t\treturn {\n\t\t\tquantidadeContas: arrContas.length,\n\t\t\tcontas: arrContas\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tquantidadeContas: 0,\n\t\t\tcontas: []\n\t\t}\n\t}\n}","inputVariables":["bodyContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cab7169-21a8-41aa-aa30-5a74ceb7ddc4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"SPD Main {state.name} quantidade de contas\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} quantidade de contas","action":"{{contas@quantidadeContas}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contas@quantidadeContas"}]},{"$id":"fe38dc09-941f-4136-bcf0-a84d2114fcd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(data) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\treturn contas[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contas"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"}]},{"$id":"15fcf271-3186-45b1-89b2-c4f954b7e5e3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusContas"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"de1c5968-7160-4dfd-9b03-cf94d6d31aae","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarContas\"","$invalid":false,"settings":{"function":"run","source":"const replaceAt = (string, index, replacement) => {\n\treturn string.substr(0, index) + replacement + string.substr(index + replacement.length);\n};\n\n// function list(contas, maisContas) {\n// \ttry {\n// \t\tconst buttons = contas.map((conta, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: `${conta.agencia}-${conta.conta}`,\n// \t\t\t\ttitle: `AG${replaceAt(conta.agencia, 1, \"XXX\")} CC${replaceAt(conta.conta, 2, \"XXXX\")}`,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outras contas'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.\";\n// \t\tconst buttonTitle = \"Mostrar contas\";\n// \t\tconst headerText = \"Escolha uma conta\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn false;\n// \t}\n// }\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\tlet textoContas = ''\n\t\tcontas.slice(0, 100)\n\t\t\t.forEach((conta, index) => textoContas += `*${index + 1}* - AG ${replaceAt(conta.agencia, 1, \"XXX\")}\\nCC ${replaceAt(conta.conta, 2, \"XXXX\")}\\n`)\n\t\treturn textoContas\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["contas","state.name","idSessao"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarContas"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"}]},{"$id":"fd849d5e-7996-4de5-8ac4-92f1f18d707d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarContas@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarContas@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarContas@tracking"}]},{"$id":"ac7d3117-f8b5-4b22-b4fb-94bdccb70f82","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"1d578318-ae43-44ca-9716-3d5722d4af8f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}} | GET | {{statusContas}} | {{bodyContas}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-070c685b-4ac2-4981-86d7-ac50326ac4bb","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-55c13024-ca98-400a-be18-e199244807db","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fefa2c39-e49c-4627-afae-7cc55de5fe54","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"ee831952-8db2-4cc9-99c3-df155c6d3b8e","root":false,"$title":"[M.3.0.0][MSG][HTTP] Verifica contas","$position":{"top":"1045px","left":"649px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"600cc78b-8b5a-43d3-a3c8-bfa3e2f79086":{"$contentActions":[{"action":{"$id":"e8a8b5c9-e8d1-4391-b60e-ddb4e1544149","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"496dc1c0-c4af-4eb4-aaed-3afc0aaff8ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"496dc1c0-c4af-4eb4-aaed-3afc0aaff8ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8f17470d-f3ff-4343-82f8-f22a518e0be0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"40bbc134-922c-4a14-b0bd-10cdb44b5b4b","type":"text/plain","content":"O número do CPF informado não corresponde ao exemplo apresentado. 🤔","metadata":{}},"$cardContent":{"document":{"id":"40bbc134-922c-4a14-b0bd-10cdb44b5b4b","type":"text/plain","content":"O número do CPF informado não corresponde ao exemplo apresentado. 🤔"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b896b071-45aa-4989-ab5f-f30346e76435","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f161fcb3-d5af-4680-ae97-5f1c6df0b38d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f161fcb3-d5af-4680-ae97-5f1c6df0b38d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f371c9e5-91d1-4299-8b8e-eebe0bab06a9","$typeOfContent":"text","type":"SendMessage","settings":{"id":"970520d3-64a0-4865-9529-b0d4c86b6a88","type":"text/plain","content":"Vamos tentar novamente! \nDigite o CPF do titular da conta. \n\nNão esqueça de inserir o número 0 (zero), se houver.","metadata":{}},"$cardContent":{"document":{"id":"970520d3-64a0-4865-9529-b0d4c86b6a88","type":"text/plain","content":"Vamos tentar novamente! \nDigite o CPF do titular da conta. \n\nNão esqueça de inserir o número 0 (zero), se houver."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9eb8aa79-35b1-4f21-9c9f-0707932d2912","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a9596376-ee37-4de6-bffd-923ab387c5d7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a9596376-ee37-4de6-bffd-923ab387c5d7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b060f928-b25f-4414-bb67-e21a263e2c70","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b8ca4979-a84a-4475-b353-a2d854d23131","type":"text/plain","content":"Informe o CPF, como neste exemplo.\n👉 CPF: 43913590806.","metadata":{}},"$cardContent":{"document":{"id":"b8ca4979-a84a-4475-b353-a2d854d23131","type":"text/plain","content":"Informe o CPF, como neste exemplo.\n👉 CPF: 43913590806."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7ea1273b-3d14-46d5-b53f-2a236b9031dc","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7c981f00-8192-4699-9429-0b0dcafdc329","typeOfStateId":"state","$connId":"con_33","$id":"077fa9d2-6b87-4bc6-bf5b-14a13d3f5de4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"600cc78b-8b5a-43d3-a3c8-bfa3e2f79086","root":false,"$title":"Tentar Dnv","$position":{"top":"865px","left":"337px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"af3e031d-f1ca-4701-af83-9c1871c37b32":{"$contentActions":[{"action":{"$id":"4f6dd6a2-144b-4e02-8be0-eefd7056a676","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3f21ea78-1521-4db0-a023-f87177b6781b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3f21ea78-1521-4db0-a023-f87177b6781b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"eebf2e6d-38bc-4e1e-af17-1ce6f263cbbd","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a697973d-39fa-4e35-b2a3-9e5497b7a675","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3cd9711f-8cd2-4960-87fd-bd4598f9707e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"ce1d1f8c-07c7-489a-854f-c2090f87aef7","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": `Olá!   \n\nInformamos que este número será desativado em breve!\n\nA partir de agora, para falar com um dos nossos atendentes, você que já é um correntista do banco Safra, utilize o seguinte número: (11) 3175-8248.\n\nToque no botão abaixo para continuar.`\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Safra Empresas\",\n        \"url\": \"https://bit.ly/4bwdVGv\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"af3e031d-f1ca-4701-af83-9c1871c37b32","root":false,"$title":"[M.5.0.0] Cliente","$position":{"top":"1260px","left":"863px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62c349a4-22e0-4cf8-9bc4-7b6db79699f6":{"$contentActions":[{"action":{"$id":"a71e0bce-a782-46b5-bf01-04c73b606c6f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"709715e4-9064-427f-88d0-49e875601b97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"709715e4-9064-427f-88d0-49e875601b97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c998f964-8494-4c94-bc53-3393584d5e54","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"73db3d78-b7a6-40d2-aed0-09ed45b00c7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"031fe75e-e9fd-4ecc-b348-26a58cbdbc35","typeOfStateId":"state","$connId":"con_38","$id":"75da6f72-78f1-4e05-bcdd-a068b68742d7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e89a9dc1-f632-4dda-8ae2-a187c0eda3fe","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a3c64b9c-7dbb-4838-bf79-71c6dbd8f1dc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\t\t\n\t\tconst headerText = \"Certo, você tem interesse em adquirir ou conhecer mais sobre a Máquina Safrapay?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-be9ee84f-f11c-40db-84f5-53c2fdb3ff1d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-82f15dbb-34fe-431b-8491-fb367dcd1a5d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"background":"#EE82EE","label":"SendMessage","id":"blip-tag-d39c239e-5794-4e5d-82bf-d96d2a6d81be","canChangeBackground":false}],"id":"62c349a4-22e0-4cf8-9bc4-7b6db79699f6","root":false,"$title":"[TC.4.0.0][MSG] Não cliente","$position":{"top":"1108px","left":"378px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"031fe75e-e9fd-4ecc-b348-26a58cbdbc35":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"73db3d78-b7a6-40d2-aed0-09ed45b00c7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"adfb68b7-bff8-44f4-8341-86ef45c8a59a","typeOfStateId":"state","$connId":"con_43","$id":"9f7d87fe-79f3-4360-a478-690ad42d6183","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}],"$invalid":false},{"stateId":"9dcbcc2e-864a-46ee-9ef5-29787725e4b3","typeOfStateId":"state","$connId":"con_48","$id":"c8df77c9-a728-4c6f-bfdd-4e0270c0e481","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"61002fc4-da61-4953-b74d-595b0722758e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e6ee17fa-5ae8-4472-8cf4-c9762b55bb8d","$typeOfContent":"","type":"TrackEvent","$title":"Track validação","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{input.content}}"},"conditions":[{"values":["Fazer outra consulta","Encerrar"],"source":"input","comparison":"equals"}]},{"$id":"842a8708-270f-49e4-82fa-244e9679dd87","$typeOfContent":"","type":"TrackEvent","$title":"Track input inesperado","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["Fazer outra consulta","Encerrar"],"source":"input","comparison":"notEquals"},{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":["Fazer outra consulta","Encerrar"],"$defaultOutput":{"stateId":"57a42d8f-b6c9-47ec-ac04-b519f44583c3","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-458c1b71-8222-4e28-9378-82aa1c492df0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b9319a84-8b99-4f74-9477-d42ed71f76fa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c68eb084-92d3-4225-b6ee-c7a000d5ddce","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6f8ae7b4-ac32-47f9-bbda-27bd9cbb8012","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"031fe75e-e9fd-4ecc-b348-26a58cbdbc35","root":false,"$title":"[M.4.0.0][INPUT] Não cliente","$position":{"top":"1342px","left":"379px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"57a42d8f-b6c9-47ec-ac04-b519f44583c3":{"$contentActions":[{"action":{"$id":"2ace398c-6f95-43f1-9841-bb6dfeccca0e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5c1b207b-2f71-4017-82ae-437167b16841","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5c1b207b-2f71-4017-82ae-437167b16841","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dc182c2d-58ee-43c8-b3c2-7e4dcfdb0d5e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d1776207-0dca-41e7-a8bd-5d675f3d2663","type":"text/plain","content":"Vamos tentar novamente! \n\nEscolha uma das opções do menu abaixo para continuar.👇","metadata":{}},"$cardContent":{"document":{"id":"d1776207-0dca-41e7-a8bd-5d675f3d2663","type":"text/plain","content":"Vamos tentar novamente! \n\nEscolha uma das opções do menu abaixo para continuar.👇"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7110ac96-5cc3-424a-a880-a767113616fc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d14ccc12-e6f8-40d8-92de-a7f1483eae4d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d14ccc12-e6f8-40d8-92de-a7f1483eae4d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f4dae892-5104-4092-9cc4-ccbb64c3e38f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1b2be6a-7f22-42ee-8c9c-438ffee48287","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"031fe75e-e9fd-4ecc-b348-26a58cbdbc35","typeOfStateId":"state","$connId":"con_53","$id":"fcf71e44-0cd7-4f3b-a979-50a62e48c9c1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"57a42d8f-b6c9-47ec-ac04-b519f44583c3","root":false,"$title":"Inesperado","$position":{"top":"1365px","left":"128px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9dcbcc2e-864a-46ee-9ef5-29787725e4b3":{"$contentActions":[{"action":{"$id":"4e1effd2-4c65-4614-ad86-8959007a2a80","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c0e205c2-eb58-4e3c-9275-7a499a11e2af","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c0e205c2-eb58-4e3c-9275-7a499a11e2af","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e7493040-11f0-423e-9e47-65aeac9973e1","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ad8c73a0-9d4e-4f2f-bff5-482a6cb3caa7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"4693432b-37fb-4e56-b73c-4344fbc8bb30","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": `Legal!\n\nAntes, gostaríamos de informar que este número será desativado em breve. \n\nA partir de agora, se você precisar falar com um de nossos atendentes, utilize o seguinte número: (11) 2650-9987.\n\nToque no botão abaixo para continuar.`\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Especialista\",\n        \"url\": \"https://bit.ly/45MZoUU\"\n      }\n    }\n  }\n}\nfunction run() {\n  try {\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8336b312-276a-4e44-b238-f8a0dcff2576","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9dcbcc2e-864a-46ee-9ef5-29787725e4b3","root":false,"$title":"Sim","$position":{"top":"1632px","left":"379px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"adfb68b7-bff8-44f4-8341-86ef45c8a59a":{"$contentActions":[{"action":{"$id":"1eadaec0-c191-467d-a566-cab032fc6d26","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8da81e0e-a7a9-47f3-937e-42b0897b625e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8da81e0e-a7a9-47f3-937e-42b0897b625e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"88f74eae-1ba2-4dad-aeb0-6631aed96499","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cd2cfeba-205a-49d3-893f-fa732bdac897","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c20d3529-bfee-48f5-a676-2c0ed32c7e1f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"04013e89-996b-4c12-82ad-988daf375f9a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": `Gostaríamos de informar que este número será desativado em breve. \n\nO Banco Safra agradece o seu contato.\n\nPara conhecer nossos produtos, toque no botão abaixo.\n\nAté logo!`\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Conhecer Produtos\",\n        \"url\": \"https://www.safra.com.br/pessoa-juridica.htm\"\n      }\n    }\n  }\n}\nfunction run() {\n  try {\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"adfb68b7-bff8-44f4-8341-86ef45c8a59a","root":false,"$title":"Não","$position":{"top":"1508px","left":"698px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/safradevdigempnps4","builder:useTunnelOwnerContext":"true","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"15e3e11b-ba26-4717-96b7-4544d3530ab1","$typeOfContent":"","type":"SetVariable","$title":"Global","$invalid":false,"settings":{"variable":"Global","value":"Global"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}