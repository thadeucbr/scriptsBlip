{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"InputInicial"},"editable":false,"deletable":false,"position":"right"},"$invalid":false,"variable":"InputInicial"},"$invalid":false}],"$conditionOutputs":[{"stateId":"1320bb7d-906b-4bb3-9718-40149a20cb65","$connId":"con_3","conditions":[{"source":"context","comparison":"equals","values":["application/vnd.iris.safra.timeup"],"variable":"input.type"}],"$invalid":false,"$id":"f7cbe014-ed09-49e8-8870-cbffb0e4da20"},{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_8","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_2_texto_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","mktdisplay_generico1","voce_ganhou_safrapay","recusa_step1","abandono_pos_step23_step1_com_imagem","erros_discador","bandono_antes_step23_step1","nao_cpc"],"variable":"contact.extras.broadcastOrigem"},{"source":"input","comparison":"equals","values":["nao","não","ñ","naum","n"]}],"$invalid":false,"$id":"87590440-378a-4afa-b732-da023b632d98"},{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","typeOfStateId":"state","$connId":"con_13","$id":"e94e5c13-2e83-409d-b514-de797a7eb809","conditions":[{"source":"context","comparison":"equals","values":["recusa_step1","abandono_pos_step23_step1_com_imagem","erros_discador","bandono_antes_step23_step1","nao_cpc"],"variable":"contact.extras.broadcastOrigem"},{"source":"input","comparison":"equals","values":["s","sim","ss"]}],"$invalid":false},{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","typeOfStateId":"state","$connId":"con_18","$id":"5dffec3a-81b3-448d-9605-db2bc0d80e37","conditions":[{"source":"context","comparison":"equals","values":["boleto_step2"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"welcome","typeOfStateId":"state","$connId":"con_23","$id":"4a410637-bc8f-48e2-a1d5-78974751cbbb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4360e925-6606-4b68-a22d-505be5a87ab7","$typeOfContent":"","type":"SetVariable","$title":"Definir nome","$invalid":false,"settings":{"variable":"nome","value":"{{contact.name}}"},"conditions":[]},{"type":"TrackEvent","$title":"Registro de eventos - Input inicial usuario","$invalid":false,"settings":{"extras":{},"category":"Comando Campanhas","action":"{{InputInicial}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"InputInicial","values":["Iniciar"]},{"comparison":"exists","source":"context","values":[],"variable":"InputInicial"}]},{"type":"ExecuteScript","$title":"Get phoneNumber","$invalid":false,"settings":{"function":"run","source":"function run(user_id) {\n    let extracted_phone = user_id\n        .split('@')[0]\n        .substr(2);\n    if (extracted_phone.length == 10)\n        extracted_phone = extracted_phone\n            .substr(0, 2)\n            .concat('9', extracted_phone.substr(2));\n    return extracted_phone;\n}","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"contains","variable":"contact.identity","values":["@wa.gw.msging.net"]}]},{"type":"MergeContact","$title":"Set phoneNumber","$invalid":false,"settings":{"extras":{},"phoneNumber":"{{phoneNumber}}","name":"{{contact.name}}"},"conditions":[{"source":"context","comparison":"contains","variable":"contact.identity","values":["@wa.gw.msging.net"]},{"source":"context","comparison":"equals","variable":"retornoInputWhats","values":["true"]}]},{"type":"SetVariable","$title":"Definir variável phoneNumber","$invalid":false,"settings":{"variable":"phoneNumber","value":"{{phoneNumber}}"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada","$invalid":false,"settings":{"extras":{},"category":"Jornada","action":"Conversa Iniciada"},"conditions":[]},{"$id":"6b2b9618-c66a-4197-844e-5bc222c2e117","type":"SetVariable","$title":"phoneNumber teste","$invalid":false,"settings":{"variable":"phoneNumber","value":"11991279986"},"conditions":[{"source":"input","comparison":"equals","values":["#teste"]}]},{"$id":"03b237a4-9fff-46bc-9101-5d11599fdcbc","$typeOfContent":"","type":"SetVariable","$title":"CANAL BROADCAST","$invalid":false,"settings":{"variable":"Agente","value":"Broadcast"},"conditions":[{"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem","values":["spprodmarketingwhatsapp_remkt_2_texto_cash_back","spprodmarketingwhatsapp_remkt_1_texto_cash_back","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","recusa_step1","erros_discador","abandono_pos_step23_step1_com_imagem","nao_cpc","bandono_antes_step23_step1","mkt_safra_generica2","mktdisplay_generico1"]}]},{"$id":"6f4fd137-6f5b-4b6e-9c9a-07f525372feb","$typeOfContent":"","type":"ExecuteScript","$title":"campanha","$invalid":false,"settings":{"function":"run","source":"\n            function run(canal) {\n\n                let campanha = canal == \"Broadcast\" ? canal : \"Whatsapp Display\"\n\n                return campanha\n            }","inputVariables":["canal"],"outputVariable":"campanha","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"087071a7-9ac2-435d-a878-4db94ea9a757","$typeOfContent":"","type":"MergeContact","$title":"Set contact","$invalid":false,"settings":{"extras":{"phoneNumber":"11947500838"}},"conditions":[{"source":"input","comparison":"equals","values":["#teste"]}]},{"$id":"d524f0b5-f947-479a-ad67-c4c625e22cba","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"origemCampanhaPadrao\"","$invalid":false,"settings":{"function":"run","source":"function run(calendarDatetime, inputMessage, inputContent, broadcast, identity) {\n    const date = new Date(calendarDatetime);\n    \n    const dataFormatada = dataAtualFormatada(date);\n    let metadataCampanha = metadata(inputMessage);\n    const origem = origemCampanha(inputContent, metadataCampanha, broadcast);\n    const canal = origemCanal(identity);\n    metadataCampanha = metadataCampanha != \"\" ? metadataCampanha : \"nao possui campanha\";\n\n    const trackOrigemCampanha = `${dataFormatada} | ${identity} | ${metadataCampanha} | ${canal} | ${origem} | ${inputContent}`\n    \n    return { \n        trackOrigemCampanha,\n        canal\n    };\n}\n\nfunction dataAtualFormatada(data) {\n    const dia = data.getDate().toString();\n    const diaF = (dia.length == 1) ? '0' + dia : dia;\n    const mes = (data.getMonth() + 1).toString(); //+1 pois no getMonth Janeiro começa com zero.\n    const mesF = (mes.length == 1) ? '0' + mes : mes;\n    const anoF = data.getFullYear();\n    const hora = data.getHours().toString();\n    const horaF = (hora.length == 1) ? '0' + hora : hora;\n    const min = data.getMinutes().toString();\n    const minF = (min.length == 1) ? '0' + min : min;\n    const seg = data.getSeconds().toString();\n    const segF = (seg.length == 1) ? '0' + seg : seg;\n\n    return `${diaF}/${mesF}/${anoF} ${horaF}:${minF}:${segF}`;\n}\n\nfunction metadata(inputMessage) {\n    try {\n        let inputMessageFormatted = JSON.parse(inputMessage);\n        // let inputMessageFormatted = inputMessage;\n        let metadata = inputMessageFormatted.metadata;\n\n        if (metadata && metadata['#wa.referral.headline']) {\n            const metadataCampanha = `${metadata['#wa.referral.source_id']} | ${metadata['#wa.referral.source_url']} | ${metadata['#wa.referral.headline']} | ${metadata['#wa.referral.body']} | ${metadata['#wa.referral.source_type']} | ${metadata['#wa.referral.image.id']}`\n            return metadataCampanha;\n        } else {\n            const metadataCampanha = \"\"\n            return metadataCampanha;\n        }\n    } catch (err) {\n        const metadataCampanha = \"\";\n        return metadataCampanha;\n    }\n}\n\nfunction origemCampanha(inputContent, metadata, broadcast) {\n    try {\n        const sourceUrl = metadata;\n        if (sourceUrl != \"\") {\n            return \"Campanha\"\n        } else if(broadcast){\n            return `broadcast | ${broadcast}`\n        }\n        return \"organico\"\n    } catch (err) {\n        return \"organico\"\n    }\n}\n\nfunction origemCanal(identity) {\n    try {\n        const source = identity.split('@')[1].split('.')[0];\n        switch (source) {\n            case 'wa':\n                return \"whatsapp\";\n                break;\n            case 'businesschat':\n                return \"businesschat\";\n                break;\n            case '0mn':\n                return \"blipchat\";\n                break;\n            case 'messenger':\n                return \"messenger\";\n                break;\n            case 'telegram':\n                return \"telegram\";\n                break;\n            case 'instagram':\n                return \"instagram\";\n                break;\n            case 'mailgun':\n                return \"email\";\n                break;\n            case 'workplace':\n                return \"workchat\";\n                break;\n            case 'tunnel':\n                return \"whatsapp\";\n                break;\n            case 'abs':\n                return \"teams\";\n                break;\n            default:\n                return \"new\"\n                break;\n        }\n\n    } catch (error) {\n        return false;\n    }\n}","inputVariables":["calendar.datetime","input.message","input.content","contact.extras.broadcastOrigem","contact.identity"],"outputVariable":"origemCampanhaPadrao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a105ad60-7a51-4bb3-83ec-4671a95b5d8d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Origem campanha [[canal]]\"","$invalid":false,"settings":{"extras":{},"category":"Origem campanha {{origemCampanhaPadrao@canal}}","action":"{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"origemCampanhaPadrao"},{"comparison":"exists","source":"context","values":[],"variable":"origemCampanhaPadrao@trackOrigemCampanha"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false},"id":"onboarding","root":true,"$position":{"top":"20px","left":"487px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-9dfe7e53-8f12-4c8f-9d72-b41574c97f4e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e14796f6-2e51-4b94-868d-01aaba1ecc35","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0be40c87-c589-4da6-991a-fa7ec208230a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-43684557-b969-4c20-9dd6-69cffdf98d00","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-500e80aa-2b4e-49e2-bc3b-8d9abe3c4931","label":"UserInput","background":"#000000","canChangeBackground":false}]},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"fallback","$position":{"top":"22.3333px","left":"688.778px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[]},"welcome":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f309369e-6f18-418a-8cf3-af470c1da8f7","type":"text/plain","content":"Olá!\n\nPara podermos direcionar o seu atendimento da melhor maneira, por gentileza, informe o número do seu CPF.","metadata":{}},"$cardContent":{"document":{"id":"f309369e-6f18-418a-8cf3-af470c1da8f7","type":"text/plain","content":"Olá!\n\nPara podermos direcionar o seu atendimento da melhor maneira, por gentileza, informe o número do seu CPF."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:10130"},{"action":{"$id":"4bd4c042-0313-4ab0-b0c5-8ac0d604f13b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"79ed9f29-5745-4c8d-bef3-820c8c5582df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"79ed9f29-5745-4c8d-bef3-820c8c5582df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:10131"},{"action":{"$id":"b229817c-c622-4b1c-b50f-a9ca0d8656a0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cb08d498-3794-4de6-bb3a-fc734589d027","type":"text/plain","content":"Use apenas os números, como neste exemplo:👇\nCPF: 43913590806","metadata":{}},"$cardContent":{"document":{"id":"cb08d498-3794-4de6-bb3a-fc734589d027","type":"text/plain","content":"Use apenas os números, como neste exemplo:👇\nCPF: 43913590806"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:10132"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bd644721-913d-4334-8d26-9a38e611c025","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:10133"}],"$conditionOutputs":[{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_28","$id":"880ee2ad-5b27-456e-ba64-03dbd918c9c2","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_2_imagem_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_texto_cash_back","recusa_step1","abandono_pos_step23_step1_com_imagem","erros_discador","nao_cpc","bandono_antes_step23_step1","mktdisplay_generico1"],"variable":"contact.extras.broadcastOrigem","$$hashKey":"object:10160"},{"source":"input","comparison":"equals","values":["nao","Não"],"$$hashKey":"object:10161"}],"$invalid":false,"$$hashKey":"object:10142"},{"stateId":"7c981f00-8192-4699-9429-0b0dcafdc329","$connId":"con_33","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:10185"}],"$invalid":false,"$id":"ca6089de-8e14-40d3-8844-e719c54692a0","$$hashKey":"object:10143"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Jornada","$invalid":false,"settings":{"extras":{},"category":"Jornada","action":"Step 2 - Nome"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Detalhada","$invalid":false,"settings":{"extras":{},"category":"Jornada Detalhada","action":"{{phoneNumber}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]},{"$id":"449604a7-adfb-4619-9637-0d92087a6edd","$typeOfContent":"","type":"SetVariable","$title":"Definir canalSelecionado","$invalid":false,"settings":{"variable":"canalSelecionado","value":"Especialistas"},"conditions":[]},{"$id":"36b93382-c120-40dd-81a8-b39a9e23e1c1","$typeOfContent":"","type":"TrackEvent","$title":"Broadcast + Input","$invalid":false,"settings":{"extras":{},"category":"Broadcast_Detalhado","action":"{{calendar.date}}|{{phoneNumber}}|{{contact.extras.broadcastOrigem}}|{{input.content}}"},"conditions":[{"source":"context","comparison":"equals","variable":"canal","values":["Broadcast"]}]},{"$id":"5950d83d-45e3-44a4-b7d4-7efac53ab2ad","$typeOfContent":"","type":"TrackEvent","$title":"Broadcast_volume","$invalid":false,"settings":{"extras":{},"category":"Broadcast_volume","action":"{{input.content}}"},"conditions":[{"source":"context","comparison":"equals","variable":"canal","values":["Broadcast"]},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"2458f55d-6c58-4b5c-9743-5b50207521e5","$typeOfContent":"","type":"ExecuteScript","$title":"nomeExtras","$invalid":false,"settings":{"function":"run","source":"function run(name, extras) {\n    const nomeExtras = extras == \"NULL\" ? name : extras\n    return capitalizeFirstLetter(nomeExtras.toLowerCase())\n}\n\nfunction capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n} contact.name","inputVariables":["nome","contact.extras.NomeDoCliente"],"outputVariable":"nome","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.NomeDoCliente"},{"source":"context","comparison":"equals","variable":"canal","values":["Broadcast"]}],"continueOnError":true}],"$leavingCustomActions":[{"type":"SetVariable","$title":"Telefone","$invalid":false,"settings":{"variable":"telefone","value":"{{phoneNumber}}"},"conditions":[]},{"type":"MergeContact","$title":"Definir campanha/canal","$invalid":false,"settings":{"extras":{"campanha":"{{campanha}}","canal":"{{canal}}"},"name":"{{nome}}","phoneNumber":"{{phoneNumber}}"},"conditions":[]},{"type":"TrackEvent","$title":"Canal de Origem","$invalid":false,"settings":{"extras":{},"category":"Canal de Origem","action":"{{contact.source}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.source"}]},{"type":"SetVariable","$title":"Inicio","$invalid":false,"settings":{"variable":"inicio","value":"inicio"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"welcome","$position":{"top":"162.25px","left":"486.75px"},"$title":"[M.1.0.0] Saudação Inicial","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-d3cf5215-3c53-4b70-a40e-73087c5f2d11","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-53eb3b6f-8ed0-4233-b530-667359afcfdf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7d3bd91e-da83-46ab-9299-6a750dade3d8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-525794f3-448e-40ad-bda2-ea20a904c162","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-2423a720-8186-4235-a091-f03150888218","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}]},"95118c04-1f32-40df-b1b0-54fb24fa2fc7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"425aa5d2-fcf9-4094-a52c-73917f47875c","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"143e0124-ec4e-462d-8369-efc61791afe6","$connId":"con_38","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"hasAttendant"}],"$invalid":false,"$id":"ce5dfc14-01fe-49ce-a2a7-c69ea6e25575"},{"stateId":"189300b3-630b-4bc0-a46c-a7fb49d2698c","$connId":"con_43","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"hasAttendant"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Especialistas"]}],"$invalid":false,"$id":"8946ee5b-d743-4969-97dc-9e760b710ee5"},{"stateId":"0fcd6c26-fbfc-47a3-a533-78688b2fd4bd","$connId":"con_48","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"hasAttendant"}],"$invalid":false,"$id":"753c529b-9ad3-4ff6-8fa3-96e51d04c1a8"}],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"CheckAgentsAvailability","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key {{config.token}}"},"method":"POST","body":"{\n  \"id\": \"{{random.guid}}\",\n  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/attendants?$take=300\"\n}","uri":"{{config.commands}}","responseStatusVariable":"status","responseBodyVariable":"result"},"conditions":[]},{"type":"ExecuteScript","$title":"HandleCheckRequest","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(result) {\n    result = JSON.parse(result);\n    \n    let hasAttendant = false;\n\n    if(result.resource && result.resource.total >= 1){\n        hasAttendant  = result.resource.items.some(function(attendant){\n            return attendant.status === 'Online';\n        });\n    }\n    return hasAttendant;\n}","inputVariables":["result"],"outputVariable":"hasAttendant","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Check Agents Time","$invalid":false,"settings":{"function":"run","source":"function run(canal) {\n    return  canal == \"ForaHorario\" ? \"Fora do horario\" : \"Dentro do horario\";\n}","inputVariables":["attendanceTeam"],"outputVariable":"checkAgentsTime","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Disponibilidade atendente validacao","$invalid":false,"settings":{"extras":{"IdMessage":"{{input.message@id}}","IdUser":"{{contact.identity}}","UserName":"{{contact.name}}","LastTrack":"{{lastTrack}}","Score":"{{score}}","TicketTag":"{{ticketTags}}","TicketNumber":"{{ticketNumber}}","TicketAttendant":"{{ticketAgentIdentity}}","TicketOpenDate":"{{ticketOpenDate}}","idMessage":"{{input.message@id}}","idUser":"{{contact.identity}}"},"category":"Disponibilidade atendente validacao","action":"{{checkAgentsTime}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"checkAgentsTime"}]},{"type":"SetVariable","$title":"Set LastTrack","$invalid":false,"settings":{"value":"Disponibilidade atendente validacao","variable":"lastTrack"},"conditions":[]},{"type":"ProcessCommand","$title":"GET ATTENDANTS","$invalid":false,"settings":{"method":"get","to":"postmaster@desk.msging.net","uri":"/attendants?$take=99999","variable":"attendants"},"conditions":[]},{"type":"ExecuteScript","$title":"CHECK ATTENDANT STATUS","$invalid":false,"settings":{"function":"run","source":"function run(attendants, agentEmail) {\n    if (!agentEmail || agentEmail == 'undefined') {\n        return false;\n    } else {\n        attendants = JSON.parse(attendants).resource.items;\n        const attendant = attendants.filter(function (a) {\n            return a.identity == encodeURIComponent(agentEmail) + '@blip.ai';\n        });\n        return attendant.length > 0 ? attendant[0].status == 'Online' : false;\n    }\n}","inputVariables":["attendants","contact.extras.agentEmail"],"outputVariable":"attendantOnline","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"SUBSCRIBE NO TICKETMONITOR","$invalid":false,"settings":{"headers":{},"method":"POST","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}\n            ","uri":"{{config.ApiUrl}}/v1/UserSubscriber/Subscribe?botIdentity={{config.botIdentity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"95118c04-1f32-40df-b1b0-54fb24fa2fc7","root":false,"$title":"4.0 - Verifica Disponibilidade Atendentes","$position":{"top":"673px","left":"526px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-7f99215c-77b8-4f63-b63a-d1acfd69f218","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-54db2e42-8765-4f83-8ee5-ad8dfc46697d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-45372ded-7389-4f46-8b9f-a189452abdf1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-902fc6e9-c79a-4723-aab5-0415fb2ad24f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1bc0695b-2c21-4b8c-8f6c-f52065d642b5","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false}]},"143e0124-ec4e-462d-8369-efc61791afe6":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"ad4f59c7-8f0c-4464-adb6-257e0fa1f333","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ad4f59c7-8f0c-4464-adb6-257e0fa1f333","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"2d2d011a-e3d5-4807-a347-d6cd9b3f43c8","type":"text/plain","content":"Desculpe, não temos atendentes disponíveis no momento. Por favor, tente novamente mais tarde."},"$cardContent":{"document":{"id":"2d2d011a-e3d5-4807-a347-d6cd9b3f43c8","type":"text/plain","content":"Desculpe, não temos atendentes disponíveis no momento. Por favor, tente novamente mais tarde."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3bab69a-ca68-457c-8b7f-23a3b8f82ea2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"stateId":"220af9c4-91d8-4c75-ab90-4c5144f20f9b"},"id":"143e0124-ec4e-462d-8369-efc61791afe6","root":false,"$title":"4.3 - Nenhum atendente disponível","$position":{"top":"835px","left":"711px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#232d11","label":"User Input","id":"blip-tag-ba80e21e-7e32-11e9-8f9e-2a86e4085a59","canChangeBackground":false},{"id":"blip-tag-792c5348-7857-4baf-9700-b9e1ab338f8a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}]},"996e8e4f-7c35-4ecc-a61f-6b4c18aa9c33":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9b024c10-84aa-40b6-ac22-2108e9128aba","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cbf87e40-08d0-4ffe-a9f7-8efa220f6aa5","typeOfStateId":"state","$connId":"con_53","$id":"e858dcb9-9e44-4cc4-8781-e7af5d1a5784","conditions":[{"source":"context","comparison":"equals","values":["VPO - Não concordou com o limite do link","VPO - Dúvida - Cliente Auto Jornada ( Site)","VPO - Não concordou com as taxas","VPO - Clientes acima de 20 mil","VPO - Cliente CPF aluguel","VPO - Recredenciamento Insucesso","VPO - Política de Crédito","VPO - Outros Produtos","VPO - Não tem Cartão","VPO - Credenciamento com Sucesso"],"variable":"returnTags"}],"$invalid":false},{"stateId":"8f4a89e9-078f-4b57-aa98-28ab9174f7b5","typeOfStateId":"state","$connId":"con_58","$id":"994b5a57-f42d-4a30-8cd0-2d7969ae54e0","conditions":[{"source":"context","comparison":"equals","values":["VPO - Agendamento","VPO - Cliente avaliando proposta"],"variable":"returnTags"}],"$invalid":false},{"stateId":"a1863f01-733e-494a-9199-f3251302e041","typeOfStateId":"state","$connId":"con_63","$id":"47b3aa69-3a04-4f13-a81f-711812376081","conditions":[{"source":"context","comparison":"equals","values":["VPO - Já cliente Safrapay com EC"],"variable":"returnTags"}],"$invalid":false},{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","$connId":"con_68","$id":"4f921a20-0a1f-496f-a98d-2e1d1966a294","conditions":[{"source":"context","comparison":"equals","values":["fechamentoEmergencial"],"variable":"returnTags"}],"$invalid":false},{"stateId":"496b8547-e582-4429-bbcf-d5f08c0469f5","$connId":"con_73","$id":"f3d9aa7d-c30f-44bc-ac90-f1b0573910c8","conditions":[{"source":"context","comparison":"equals","values":["Inatividade Cliente"],"variable":"returnTags"}],"$invalid":false},{"stateId":"6d70355c-9d60-4bbe-ab6b-2331191ea2af","typeOfStateId":"state","$connId":"con_78","$id":"5d76c216-48ae-4be4-a7cd-e4323f945882","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"67a0636f-d73d-407a-bfc7-199b291d2e8d","$typeOfContent":"","type":"ExecuteScript","$title":"GET ANUNCIOIDPOST FROM EXTRAS","$invalid":false,"settings":{"function":"run","source":"function run(contato) {\n    contato = JSON.parse(contato);\n\n    if(contato.extras[\"Anúncio Id post\"]){\n        return contato.extras[\"Anúncio Id post\"];\n    }\n    \n    return \"\";\n}","inputVariables":["contact.serialized"],"outputVariable":"anuncioIdPost","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"61d920f6-b8bf-4e52-83d5-91b9c4162010","$typeOfContent":"","type":"ExecuteScript","$title":"GET CAMPANHASMARKETING FROM EXTRAS","$invalid":false,"settings":{"function":"run","source":"function run(contato) {\n    contato = JSON.parse(contato);\n\n    if(contato.extras[\"Campanhas (Marketing)\"]){\n        return contato.extras[\"Campanhas (Marketing)\"];\n    }\n    \n    return \"\";\n}","inputVariables":["contact.serialized"],"outputVariable":"campanhasMarketing","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"55e7a6c2-88ab-48e1-b8b8-0f25632d4ed4","$typeOfContent":"","type":"ExecuteScript","$title":"GET CONJUNTODEANUNCIOS FROM EXTRAS","$invalid":false,"settings":{"function":"run","source":"function run(contato) {\n    contato = JSON.parse(contato);\n\n    if(contato.extras[\"Conjunto de Anúncios\"]){\n        return contato.extras[\"Conjunto de Anúncios\"];\n    }\n    \n    return \"\";\n}","inputVariables":["contact.serialized"],"outputVariable":"conjuntoDeAnuncios","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"25674b68-c4b1-41f9-842f-1791124f5610","$typeOfContent":"","type":"ExecuteScript","$title":"GET TAGULTIMOATENDIMENTO FROM EXTRAS","$invalid":false,"settings":{"function":"run","source":"function run(contato) {\n    contato = JSON.parse(contato);\n\n    if(contato.extras[\"Tag Último Atendimento\"]){\n        return contato.extras[\"Tag Último Atendimento\"];\n    }\n    \n    return \"\";\n}","inputVariables":["contact.serialized"],"outputVariable":"tagUltimoAtendimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ef46e2a9-9c09-411a-8435-e416d92c2245","$typeOfContent":"","type":"ExecuteScript","$title":"GET CPFCNPJ FROM EXTRAS","$invalid":false,"settings":{"function":"run","source":"function run(contato) {\n    contato = JSON.parse(contato);\n\n    if(contato.extras[\"CPF/CNPJ\"]){\n        return contato.extras[\"CPF/CNPJ\"];\n    }\n    \n    return \"\";\n}","inputVariables":["contact.serialized"],"outputVariable":"cpfCnpj","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3d981636-ecf0-48fd-afbf-090d24d40789","$typeOfContent":"","type":"ExecuteScript","$title":"GET ANUNCIO FROM EXTRAS","$invalid":false,"settings":{"function":"run","source":"function run(contato) {\n    contato = JSON.parse(contato);\n\n    if(contato.extras[\"Anúncio\"]){\n        return contato.extras[\"Anúncio\"];\n    }\n    \n    return \"\";\n}","inputVariables":["contact.serialized"],"outputVariable":"anuncio","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"ENCODED CONTACT","$invalid":false,"settings":{"function":"run","source":"function run(contact) {\n    return encodeURIComponent(contact);\n}","inputVariables":["contact.identity"],"outputVariable":"contactEncoded","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessCommand","$title":"GET TICKET","$invalid":false,"settings":{"method":"get","to":"postmaster@desk.msging.net","uri":"/tickets?$filter=customeridentity%20eq%20'{{contactEncoded}}'&$take=1","variable":"ticket"},"conditions":[]},{"$id":"b3ab6a47-32f2-47fe-bb96-9a2333900a63","$typeOfContent":"","type":"ExecuteScript","$title":"TICKET NUMBER","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    let sequentialId = \"\"; \n\n    if(_ticket.resource.items.length > 0 && \n        _ticket.resource.items[0].sequentialId){\n\n        sequentialId = _ticket.resource.items[0].sequentialId;\n       \n        return sequentialId;\n    }\n}","inputVariables":["ticket"],"outputVariable":"ticketNumber","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"GET TAGS","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    let tags = \"\"; \n\n    if(_ticket.resource.items.length > 0 && \n        _ticket.resource.items[0].tags &&\n        _ticket.resource.items[0].tags.length > 0){\n\n        tags = _ticket.resource.items[0].tags.join(\",\");\n    }\n\n    return tags;\n}","inputVariables":["ticket"],"outputVariable":"returnTags","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"TAG CONVERSÃO","$invalid":false,"settings":{"function":"run","source":"function run(returnTags) {\n    if (returnTags) {\n        return returnTags.indexOf(\"Credenciado com sucesso\") > -1 ? \"Credenciado com sucesso\" : false;\n    }\n}","inputVariables":["returnTags"],"outputVariable":"tagConversao","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"GET AGENTEMAIL","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    ticket = JSON.parse(ticket);\n        let agentIdentity = \"NaoIdentificado\";\n\n    if (ticket.resource.items[0].agentIdentity)\n        agentIdentity = decodeURIComponent(ticket.resource.items[0].agentIdentity.split('@')[0]);\n\n    return agentIdentity;\n}","inputVariables":["ticket"],"outputVariable":"agentEmail","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"INIBIR","$invalid":false,"settings":{"variable":"inibir","value":"false"},"conditions":[]},{"type":"ExecuteScript","$title":"ENCODE EMAIL ATENDENTE","$invalid":false,"settings":{"function":"run","source":"\nfunction run(emailAtendente) {\n    return encodeURIComponent(encodeURIComponent(emailAtendente));\n}","inputVariables":["agentEmail"],"outputVariable":"encodedAgentEmail","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"44a722f7-92b7-43c4-a112-2135bd4fff61","$typeOfContent":"","type":"ProcessCommand","$title":"Comentario do Ticket","$invalid":false,"settings":{"to":"postmaster@msging.net","method":"get","uri":"/contacts/{{contact.identity}}/comments","variable":"comments"},"conditions":[]},{"$id":"223b2088-f2ba-4650-bed2-397de7bbb067","$typeOfContent":"","type":"ExecuteScript","$title":"Comentario do Ticket","$invalid":false,"settings":{"function":"run","source":"function run(comments) {\n    let _comments = JSON.parse(comments);\n    let contents = \"\";\n    if (_comments.resource && _comments.resource.items && _comments.resource.items.length > 0) {\n        for (let x = 0; x < _comments.resource.items.length; x++) {\n            contents += _comments.resource.items[x].content + \";\"\n        }\n    }\n    else\n        return \"-\";\n    return contents;\n}","inputVariables":["comments"],"outputVariable":"comentario","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"comments"}]},{"$id":"85799270-0cd4-4e05-968f-cd6bb8ca8123","$typeOfContent":"","type":"TrackEvent","$title":"Atendimento finalizado comentarios","$invalid":false,"settings":{"extras":{"ticketId":"{{ticketNumber}}","equipe":"{{contact.extras.equipe}}","documento":"{{contact.extras.documento}}","campanha":"{{contact.extras.Campanha}}","canal":"{{contact.extras.Canal}}","telefone":"{{contact.extras.Telefone}}","anuncioIdPost":"{{anuncioIdPost}}","plataformas":"{{contact.extras.Plataformas}}","campanhasMarketing":"{{campanhasMarketing}}","conjuntoDeAnuncios":"{{conjuntoDeAnuncios}}","anuncio":"{{anuncio}}","CPF/CNPJ":"{{cpfCnpj}}","id_prosp":"{{contact.extras.id_prosp}}","nomeDoCliente":"{{contact.extras.NomeDoCliente}}","agente":"{{contact.extras.Agente}}","jornada":"{{contact.extras.Jornada}}","retorno":"{{contact.extras.retorno}}","tagUltimoAtendimento":"{{tagUltimoAtendimento}}","broadcastOrigem":"{{contact.extras.broadcastOrigem}}"},"category":"Atendimento finalizado comentarios","action":"{{comentario}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"comentario"}]},{"type":"TrackEvent","$title":"Base de ligacao","$invalid":false,"settings":{"extras":{},"category":"Base de ligação","action":"{{contact.name}}|{{phoneNumber}}|{{returnTags}}"},"conditions":[]},{"type":"TrackEvent","$title":"Tags","$invalid":false,"settings":{"extras":{},"category":"Tags","action":"{{returnTags}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"returnTags"}]},{"type":"TrackEvent","$title":"Usuário Tags","$invalid":false,"settings":{"extras":{},"category":"Usuário Tags","action":"{{phoneNumber}}|{{returnTags}}"},"conditions":[]},{"type":"TrackEvent","$title":"Agentes Tags","$invalid":false,"settings":{"extras":{},"category":"Agentes Tags","action":"{{agentEmail}}|{{returnTags}}|{{phoneNumber}}"},"conditions":[]},{"type":"TrackEvent","$title":"Agentes Tag Conversão","$invalid":false,"settings":{"extras":{},"category":"Agentes Tag Conversão","action":"{{agentEmail}}|{{tagConversao}}|{{phoneNumber}}"},"conditions":[{"source":"context","comparison":"equals","variable":"tagConversao","values":["true"]}]},{"type":"ProcessHttp","$title":"OBTER NOME ATENDENTE","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiKey}}","Content-Type":"application/json"},"method":"POST","body":"{\n  \"id\": \"{{random.guid}}\",\n  \"to\": \"postmaster@blip.ai\",\n  \"method\": \"get\",\n  \"uri\": \"lime://{{config.blip}}/accounts/{{encodedAgentEmail}}\"\n}","uri":"{{config.commands}}","responseStatusVariable":"statusNomeAtendente","responseBodyVariable":"retornoNomeAtendente"},"conditions":[{"source":"context","variable":"inibir","comparison":"equals","values":["false"]}]},{"type":"ExecuteScript","$title":"GET NOME ATENDENTE","$invalid":false,"settings":{"function":"run","source":"\nfunction run(atendente, status) {\n    if (status != 200) return \"NotFound\";\n    atendente = JSON.parse(atendente);\n    if (atendente.resource)\n        return atendente.resource.fullName;\n\n    return \"NotFound\";\n}","inputVariables":["retornoNomeAtendente","statusNomeAtendente"],"outputVariable":"agentName","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"inibir","values":["false"]}]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"agentEmail":"{{agentEmail}}"},"name":"{{contact.name}}"},"conditions":[]},{"$id":"5acd7c0d-a5fd-4f2f-91eb-0b10ac219ab1","type":"ProcessHttp","$title":"UNSUBSCRIBE - INATIVIDADE","$invalid":false,"settings":{"headers":{"X-Blip-User":"{{contact.identity}}"},"uri":"{{config.ApiUrl}}/v1/UserSubscriber/Unsubscribe?botIdentity={{config.botIdentity}}","method":"POST","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}","responseStatusVariable":"statusEncerramentoTicketAutomatico","responseBodyVariable":"returnEncerramentoTicketAutomatico"},"conditions":[]}],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-2c244765-f190-46fb-a3e8-7dfa94f46135","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-20629f20-130c-4cd9-acf7-96b0e7729a51","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-cb514df1-69e2-403d-ba3e-a348505763b3","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9a7fea9d-0b9a-44aa-88d1-2bc569123f5b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1340166a-88da-4318-8ea2-264774b15fa1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-22b2c33f-f5ca-43ae-a959-db4d3097a656","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"$defaultOutput":{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","$invalid":false},"id":"996e8e4f-7c35-4ecc-a61f-6b4c18aa9c33","root":false,"$title":"6.0 - Atendimento Finalizado","$position":{"top":"1015px","left":"531px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"df6ee81c-6531-47f3-b366-0cbd31e43a01":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"4d8a4e6b-1597-4eb2-8f0e-e9181e92e2dc","type":"text/plain","content":"{Que bom que você voltou ao atendimento Safrapay.|É bom te ver de volta aqui no atendimento Safrapay.}","metadata":{"#message.spinText":"true"}},"$cardContent":{"document":{"id":"4d8a4e6b-1597-4eb2-8f0e-e9181e92e2dc","type":"text/plain","content":"{Que bom que você voltou ao atendimento Safrapay.|É bom te ver de volta aqui no atendimento Safrapay.}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7f3e6316-14e5-4df8-b59d-df240506fb45","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7f3e6316-14e5-4df8-b59d-df240506fb45","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"e485753e-1aab-4032-9c71-dbfaa9d48adb","type":"text/plain","content":"Como posso te ajudar?"},"$cardContent":{"document":{"id":"e485753e-1aab-4032-9c71-dbfaa9d48adb","type":"text/plain","content":"Como posso te ajudar?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"d4911258-325e-4638-835f-8bf2a64600d6","type":"text/plain","content":"duvidaRetorno"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"duvidaRetorno"},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","$connId":"con_83","conditions":[{"source":"context","comparison":"equals","values":["11991279986"],"variable":"phoneNumber"}],"$invalid":false,"$id":"2805093e-dcc6-4b97-9be1-5917058a2373"},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_88","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"bf988bfa-4ee3-4707-ae51-917b3391bf3b"}],"$enteringCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"campanha":"{{config.idCampaign}}","retorno":"organico"},"name":"{{contact.name}}"},"conditions":[]},{"type":"TrackEvent","$title":"Registro de eventos Retorno","$invalid":false,"settings":{"extras":{},"category":"Retorno","action":"orgânico"},"conditions":[]},{"type":"SetVariable","$title":"Retorno","$invalid":false,"settings":{"variable":"retorno","value":"Retorno"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Retorno","$invalid":false,"settings":{"extras":{},"category":"Jornada Retorno","action":"{{phoneNumber}}|{{agentEmail}}|{{returnTags}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"retorno"},{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]}],"$leavingCustomActions":[{"type":"SetVariable","$title":"BroadcasOrigem","$invalid":false,"settings":{"variable":"broadcastOrigem","value":"{{contact.extras.broadcastOrigem}}"},"conditions":[]},{"type":"TrackEvent","$title":"bROADCAST","$invalid":false,"settings":{"extras":{},"category":"Origem Broadcast","action":"{{broadcastOrigem}}|{{phoneNumber}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"broadcastOrigem"}]},{"type":"TrackEvent","$title":"dúvida Retorno","$invalid":false,"settings":{"extras":{},"category":"Dúvida Retorno","action":"{{duvidaRetorno}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"duvidaRetorno"}]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"{{agentName}}"},"name":"{{contact.name}}"},"conditions":[]}],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-5a5819cd-5309-4584-b54b-86f463a9eacd","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-13e04197-2fb9-47b3-86b4-2d5c80af561d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c8f03a43-96c3-4710-b406-ef04237727a2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-402dcb5a-b3c9-41cc-8f14-fefbb461a083","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-d99f4f37-1941-4d67-b401-4680199ab182","label":"UserInput","background":"#000000","canChangeBackground":false}],"$defaultOutput":{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$invalid":false},"id":"df6ee81c-6531-47f3-b366-0cbd31e43a01","root":false,"$title":"7.0 - Retorno","$position":{"top":"1874px","left":"1136px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"3b80e642-876d-4a15-a794-a27cfb6c7689","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3b80e642-876d-4a15-a794-a27cfb6c7689","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"051045b7-2ac7-4a80-ac97-f7f21d89c7fe","type":"text/plain","content":"Agradecemos o seu contato. Quando precisar, é só digitar *1* para começar uma nova conversa."},"$cardContent":{"document":{"id":"051045b7-2ac7-4a80-ac97-f7f21d89c7fe","type":"text/plain","content":"Agradecemos o seu contato. Quando precisar, é só digitar *1* para começar uma nova conversa."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1479be51-d5b6-41f3-97b6-c6867f60a417","type":"text/plain","content":"InputIniciarRetorno"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"InputIniciarRetorno"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_93","$id":"04cfd766-7142-4a46-9784-72e9e22b515f","conditions":[{"source":"input","comparison":"equals","values":["não","nao"]},{"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem","values":["spprodmarketingwhatsapp_remkt_2_texto_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","spprodmarketingwhatsapp_remkt_1_texto_cash_back"]}],"$invalid":false},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_98","$id":"98d938f1-672f-4bc2-9ba1-9548ef04a5ea","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_2_texto_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","mktdisplay_engajamento_1","mktdisplay_generico1","mkt_safra_generica2"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"ee1cf003-8ada-4012-b9d3-7b584e40fef0","$connId":"con_103","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"451e479f-42bb-4542-88f0-eb0d46108a79"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Finalizacao do feedback do atendimento organico","$invalid":false,"settings":{"extras":{"IdMessage":"{{input.message@id}}","IdUser":"{{contact.identity}}","UserName":"{{contact.name}}","LastTrack":"{{lastTrack}}","Score":"{{score}}","TicketTag":"{{ticketTags}}","TicketNumber":"{{ticketNumber}}","TicketAttendant":"{{ticketAgentIdentity}}","TicketOpenDate":"{{ticketOpenDate}}","idMessage":"{{input.message@id}}","idUser":"{{contact.identity}}"},"category":"Finalizacao do feedback do atendimento organico","action":"Exibicao"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada","$invalid":false,"settings":{"extras":{},"category":"Jornada","action":"Step 5 - Conversa Finalizada"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Detalhada","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{contact.name}}|{{canalSelecionado}}|{{agentEmail}}|{{returnTags}}","category":"Jornada Detalhada"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]},{"type":"TrackEvent","$title":"Jornada Retorno","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{agentEmail}}|{{returnTags}}|{{duvidaRetorno}}|{{returnTags}}}}","category":"Jornada Retorno"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]},{"type":"TrackEvent","$title":"Digitou NPS inválido","$invalid":false,"settings":{"extras":{},"category":"Digitou NPS inválido","action":"Quantidade"},"conditions":[{"source":"context","comparison":"equals","variable":"npsinvalido","values":["3"]}]},{"$id":"1987bb9a-4111-405e-9b4e-9360f018982c","type":"SetVariable","$title":"retorno","$invalid":false,"settings":{"variable":"retorno","value":"true"},"conditions":[]},{"$id":"114d6062-85e5-41cc-a409-bfe65088999f","$typeOfContent":"","type":"ProcessHttp","$title":"token","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlSafraToken}}/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"163e64a2-9d38-46ba-9d3c-7dbaa32ce339","$typeOfContent":"","type":"ExecuteScript","$title":"update ticket","$invalid":false,"settings":{"function":"run","source":"\n            function run() {\n                return {\n                        \"id_prosp\": \"{{contact.extras.id_prosp}}\",\n                        \"bot\": \"{{config.botIdentity}}\",\n                        \"sequencialId\": \"{{ticketNumber}}\",\n                        \"customerIdentity\": \"{{contact.identity}}\",\n                        \"agentIdentity\": \"{{agentEmail}}\",\n                        \"status\": \"{{statusTicket}}\",\n                        \"dataAbertura\": \"{{calendar.datetime}}\",\n                        \"dataExpiracao\": \"{{closeDate}}\",\n                        \"dataFinalizacao\": \"{{closeDate}}\",\n                        \"time\": \"{{contact.extras.Agente}}\",\n                        \"finalizado\": \"0\",\n                        \"tags\": [],\n                        \"tempoFila\": \"\",\n                        \"tempoPrimeiraResposta\": \"\",\n                        \"mediaTempoRespostaAtendente\": \"\",\n                        \"nome\": \"{{contact.name}}\",\n                        \"email\": \"\",\n                        \"sexo\": \"\",\n                        \"cidade\": \"\",\n                        \"telefone\": 0,\n                        \"nomeAtendente\": \"{{agentName}}\",\n                        \"emailAtendente\": \"{{agentEmail}}\",\n                        \"equipe\": \"{{contact.extras.Agente}}\",\n                        \"documento\": \"{{cpfCnpj}}\",\n                        \"campanha\": \"{{contact.extras.campanha}}\",\n                        \"canal\": \"{{contact.extras.canal}}\",\n                        \"comentarios\": \"{{comentario}}\",\n                        \"anuncioIdPost\": \"\",\n                        \"plataformas\": \"\",\n                        \"campanhasMarketing\": \"{{campanhasMarketing}}\",\n                        \"conjuntoDeAnuncios\": \"{{conjuntoDeAnuncios}}\",\n                        \"anuncio\": \"{{anuncio}}\",\n                        \"cpfCnpj\": \"{{cpfCnpj}}\",\n                        \"nomedoCliente\": \"{{contact.name}}\",\n                        \"nps\": \"{{nps}}\",\n                        \"dataAvaliacao\": \"\",\n                        \"agente\": \"{{agentName}}\",\n                        \"jornada\": \"\",\n                        \"retorno\": \"\",\n                        \"tagUltimoAtendimento\": \"{{tagUltimoAtendimento}}\",\n                        \"broadcastOrigem\": \"{{contact.extras.broadcastOrigem}}\"\n                    }\n            }","inputVariables":[],"outputVariable":"payloadUpdateTicket","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"91b7ab2d-6c12-4225-aade-292a61990ae9","$typeOfContent":"","type":"ProcessHttp","$title":"atualiza ticket","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"POST","body":"{{payloadUpdateTicket}}","uri":"{{config.urlCHT}}/atendimentos-hibridos/v1/mesa-bilhetes/{{ticketId}}","responseStatusVariable":"statusUpdateTicket","responseBodyVariable":"bodyTicket"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"]}]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"campanha":"Retorno {{campanha}}","broadcastOrigem":"-"},"name":"{{contact.name}}","phoneNumber":"{{phoneNumber}}"},"conditions":[]}],"$inputSuggestions":[],"$tags":[{"background":"#232d11","label":"User Input","id":"blip-tag-ba80e21e-7e32-11e9-8f9e-2a86e4085a59","canChangeBackground":false},{"id":"blip-tag-407a079b-8df3-4558-a276-da02f8edcfea","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ad50fda6-e589-46f4-ab10-cca99fdd086d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c3efe039-3fd4-4296-b70f-a2631cd49a3d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-bed2f3b8-46ce-4a41-8e8b-b0d9e7ecd3ec","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-db1e1299-914f-4164-883c-f5a0f73353bb","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-fce57bab-7782-42db-82f0-ae7e50bcf48f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-2e6618bd-3fa9-473f-972f-14c68a302899","label":"UserInput","background":"#000000","canChangeBackground":false}],"$defaultOutput":{"stateId":"df6ee81c-6531-47f3-b366-0cbd31e43a01","$invalid":false},"id":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","root":false,"$title":"6.1 - Obrigado pela participação","$position":{"top":"1005px","left":"962px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Success"]}],"$cardContent":{"document":{"id":"2cef2c73-0f71-4503-811c-623a0b228bae","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"996e8e4f-7c35-4ecc-a61f-6b4c18aa9c33","$connId":"con_108","$id":"ba9f8f14-e6eb-4a36-8356-c063d35d5920"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"996e8e4f-7c35-4ecc-a61f-6b4c18aa9c33","$connId":"con_113","$id":"4ac7ce7b-5644-433e-8b77-6cfce7febefc"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"496b8547-e582-4429-bbcf-d5f08c0469f5","$connId":"con_118","$id":"f7020bc0-a3c6-4b54-a111-36f54dc64c0d"},{"$isDeskOutput":true,"$isDeskDefaultOutput":true,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Error"]}],"stateId":"fallback","$invalid":false}],"$enteringCustomActions":[{"$id":"f4239717-1492-47bd-b9aa-3736071a48a3","$typeOfContent":"","type":"ForwardToDesk","conditions":[],"settings":{},"$invalid":false}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a","deskStateVersion":"3.0.0","root":false,"$title":"5.0 - Atendimento humano","$afterStateChangedActions":[{"$id":"a709edbc-d319-44e5-bc9f-b317bbeddc7d","$typeOfContent":"","type":"LeavingFromDesk","conditions":[],"settings":{}}],"$position":{"top":"1014px","left":"336px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0fcd6c26-fbfc-47a3-a533-78688b2fd4bd":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"321a54d2-b2e9-441a-bb5d-ca71a6b2219d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"321a54d2-b2e9-441a-bb5d-ca71a6b2219d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7a6c2ccd-a74c-4fd4-b54b-13d303e64d3f","type":"text/plain","content":"Em breve um representante entrará em contato para te falar tudo sobre nossas máquinas."},"$cardContent":{"document":{"id":"7a6c2ccd-a74c-4fd4-b54b-13d303e64d3f","type":"text/plain","content":"Em breve um representante entrará em contato para te falar tudo sobre nossas máquinas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2cd953c0-d5f0-494c-84b0-f29188cd8cd6","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a","$connId":"con_123","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"agentEmail"}],"$invalid":false,"$id":"5aabf0ea-4f20-4ef0-b99e-58e5a56b1228"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Jornada","$invalid":false,"settings":{"extras":{},"category":"Jornada","action":"Step 4 - Transbordo"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Detalhada","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{contact.name}}|{{canalSelecionado}}","category":"Jornada Detalhada"},"conditions":[{"values":[],"source":"context","variable":"phoneNumber","comparison":"exists"}]},{"type":"ProcessCommand","$title":"GET ATTENDANTS","$invalid":false,"settings":{"to":"postmaster@desk.msging.net","method":"get","uri":"/attendants?$take=99999","variable":"attendants"},"conditions":[]},{"type":"ExecuteScript","$title":"CHECK ATTENDANT STATUS","$invalid":false,"settings":{"function":"run","source":"function run(attendants, agentEmail) {\n    if (!agentEmail || agentEmail == 'undefined') {\n        return false;\n    } else {\n        attendants = JSON.parse(attendants).resource.items;\n        const attendant = attendants.filter(function (a) {\n           if (a.identity == encodeURIComponent(agentEmail) + '@blip.ai'){\n\n               return a;\n           }\n        });\n        return attendant.length > 0 ? attendant[0].status == 'Online' : false;\n    }\n}","inputVariables":["attendants","contact.extras.agentEmail"],"outputVariable":"attendantOnline","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"MergeContact","$title":"RESET AGENTEMAIL","$invalid":false,"settings":{"extras":{"Agente":"{{attendantOnline}}"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ProcessHttp","$title":"SUBSCRIBE NO TICKETMONITOR","$invalid":false,"settings":{"headers":{"X-Blip-User":"{{contact.identity}}","X-Blip-Bot":"{{config.botIdentity}}","X-Desk-Team":"default"},"method":"POST","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}\n            ","uri":"{{config.ApiUrl}}/v1/Subscription/Subscribe","responseStatusVariable":"statusTicketMonitor","responseBodyVariable":"bodyTicketMonitor"},"conditions":[]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"telefone":"{{phoneNumber}}","campanha":"{{config.idCampaign}}","Tag Último Atendimento":"{{ReturnTags}}","Dúvida":"{{duvidaRetorno}}"},"name":"{{contact.name}}"},"conditions":[]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"{{agentName}}"},"name":"{{contact.name}}"},"conditions":[{"source":"context","comparison":"equals","variable":"attendantOnline","values":["true"]}]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"Call"},"name":"{{contact.name}}"},"conditions":[{"source":"context","comparison":"equals","variable":"attendantOnline","values":["false"]}]}],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-7e411416-7a3b-4a51-bd98-e28c7aa631cf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dd036f4a-a0ce-466e-89fd-4f16dae1ddfc","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-7a95cc3a-b338-4b0c-84f6-39370b8e8655","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e53b9e0d-52dc-430c-b3e7-f1889b0cc1cd","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-f7bded96-e168-459f-b9f3-0936b21744b9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ff40e76c-c479-4070-a3b8-f344d85a8940","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"$defaultOutput":{"stateId":"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a","$invalid":false},"id":"0fcd6c26-fbfc-47a3-a533-78688b2fd4bd","root":false,"$title":"4.1 - Mensagem pré transbordo Call","$position":{"top":"830px","left":"336px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"accc7f17-d9be-44a2-b6ee-76633a988136":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f2c48288-126e-45c1-9f6b-50c3dd118eaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f2c48288-126e-45c1-9f6b-50c3dd118eaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d799c0f5-161c-44fa-b38c-9815bf05cdcd","type":"text/plain","content":"Este atendimento está disponível de Segunda à Sexta-Feira das 08:00 às 19:00"},"$cardContent":{"document":{"id":"d799c0f5-161c-44fa-b38c-9815bf05cdcd","type":"text/plain","content":"Este atendimento está disponível de Segunda à Sexta-Feira das 08:00 às 19:00"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"766140c7-59ea-40c0-99a4-b97029b8d48d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ad4031d9-bed4-4937-bf0e-be699b03bce4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ad4031d9-bed4-4937-bf0e-be699b03bce4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"efd0328c-d9d7-49b8-a099-55daec124c53","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3a5a9b4e-6c9e-471b-9f67-e8ec439327ec","type":"text/plain","content":"{{texto}}","metadata":{}},"$cardContent":{"document":{"id":"3a5a9b4e-6c9e-471b-9f67-e8ec439327ec","type":"text/plain","content":"{{texto}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"f1c8779f-018f-49ca-a090-96b865053482","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f1c8779f-018f-49ca-a090-96b865053482","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"0fbea12b-3ba8-4b9a-a08b-e188451f1ff4","type":"text/plain","content":"Por favor, aguarde que retornaremos o contato."},"$cardContent":{"document":{"id":"0fbea12b-3ba8-4b9a-a08b-e188451f1ff4","type":"text/plain","content":"Por favor, aguarde que retornaremos o contato."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"55e8c085-9289-4117-8ec1-54476a79983b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c0f3b1ab-7c78-433e-9569-572e1285585f","$connId":"con_128","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"7a2eed35-bc92-46b9-8494-5f862b9a2e80"}],"$enteringCustomActions":[{"type":"MergeContact","$title":"Definir Canal","$invalid":false,"settings":{"extras":{"Canal":"ForaHorario"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ExecuteScript","$title":"retorna fora horario canal","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(attendanceTeam) {\n                if(attendanceTeam == \"Produto\"){\n                    return \"08:00 às 20:00\";\n                } else {\n                    return \"08:00 às 19:00\";\n                }\n            }","inputVariables":["attendanceTeam"],"outputVariable":"canalFora","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"scheduleId","$invalid":false,"settings":{"variable":"scheduleId","value":"nametimeup-{{contact.identity}}"},"conditions":[]},{"type":"ExecuteScript","$title":"DEFINIR TEMPO SCHEDULE","$invalid":false,"settings":{"function":"run","source":"function run(startDate) {\n    let hora = startDate.split(\":\")[0];\n    let minutes = startDate.split(\":\")[1]\n    let dia = new Date().getDay();\n    let diaMes = new Date().getDate();\n    let fds = 0;\n    if (dia == 5) fds = 3;\n    if (dia == 6) fds = 2;\n    if (dia == 0) fds = 1;\n    \n    var data = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate() + fds, hora, minutes, 00, 00);\n\n    return data.toISOString();\n}\n","inputVariables":["config.startDate"],"outputVariable":"scheduleTimeup","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"isWorkTime","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(inputVariable1, inputVariable2) {\n                return \"Hello BLiP\"; //Return value will be saved as \"Return value variable\" field name\n            }//Default BLiP TimeZoneOffset = São Paulo (GMT-3)\nvar DEFAULT_OFFSET = 3;\n\nfunction run(canalSelecionado, holiday, startDate) {\n\n    try {\n\n        // if (holiday == \"true\") {\n        //     return isHoliday();\n        // }\n\n        let data = new Date();\n        let dayMonth = data.getDate();\n        let dayWeek = data.getDay();\n        let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n        let hours = convertHours < 10 ? '0' + convertHours : convertHours;\n        let minutes = data.getMinutes() < 10 ? '0' + data.getMinutes() : data.getMinutes();\n        let hoursAndMinutes = hours + \":\" + minutes;\n        let selectedChannel = canalSelecionado;\n        let channel = selectedChannel == \"Default\" ? 0 : \n                      selectedChannel == \"Especialistas\" ? 1 :\n                      selectedChannel == \"Call\" ? 2 :\n                      0;\n\n        let weekCall = { \"start\": \"08:00\", \"end\": \"19:00\" };\n        let weekEspecialistas = { \"start\": \"14:59\", \"end\": \"22:00\" };    \n\n        let objRules = {\n            \"rules\": [\n                { \"Default\": [null, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, null] },\n                { \"Especialistas\": [null, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, null] },\n                { \"Call\": [null, weekCall, weekCall, weekCall, weekCall, weekCall, null] }\n        ]\n        }       \n\n        if (objRules.rules[channel][selectedChannel][dayWeek] == null) {\n            return false\n        } else {\n            let resultDay = objRules.rules[channel][selectedChannel][dayWeek]\n            return hoursAndMinutes >= resultDay.start && hoursAndMinutes <= resultDay.end\n        }\n    }\n    catch (e) {\n        return e;\n    }\n}\n\n// function isHoliday() {\n//     var DEFAULT_OFFSET = 3;\n//     let data = new Date();\n//     let dayMonth = data.getDate();\n//     let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n//     let hours = convertHours < 10 ? '0' + convertHours : convertHours;\n//     let minutes = data.getMinutes() < 10 ? '0' + data.getMinutes() : data.getMinutes();\n//     let hoursAndMinutes = hours + \":\" + minutes;\n\n//     if (dayMonth > 23 && dayMonth < 27) {\n//         if ((dayMonth == 24 && hoursAndMinutes > \"12:00\") || (dayMonth == 25)) {\n//             return false;\n//         }\n//         else if (dayMonth == 26 && hoursAndMinutes > \"08:00\") {\n//             return true;\n//         }\n//     }\n//     else if (dayMonth == 30) {\n\n//         if (hoursAndMinutes < \"17:00\") {\n//             return true;\n//         }\n//         else {\n//             return false;\n//         }\n//     }\n//     else if (dayMonth == 31 || dayMonth == 1) {\n//         return false;\n//     }\n//     else if (dayMonth == 2 && hoursAndMinutes > \"05:20\") {\n//         return true;\n//     }\n\n// }","inputVariables":["canalSelecionado","config.isHoliday","config.startDate"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessCommand","$title":"ENVIAR MENSAGEM - SCHEDULE","$invalid":false,"settings":{"method":"set","to":"postmaster@scheduler.msging.net","uri":"/schedules","resource":{"message":{"id":"{{scheduleId}}","to":"{{input.message@to}}","type":"application/vnd.iris.safra.timeup","content":"{ \"contact\":\"{{contact.identity}}\" }"},"when":"{{scheduleTimeup}}","name":"{{scheduleId}}"},"type":"application/vnd.iris.schedule+json","variable":"euEstavaVazia"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"x"}]},{"type":"SetVariable","$title":"Seta Feriado","$invalid":false,"settings":{"variable":"isWorkTime","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2020-05-01","2021-12-31"]},{"source":"context","comparison":"greaterThanOrEquals","variable":"calendar.hour","values":["0"]}]},{"$id":"9b502102-66c4-4526-882a-4eee9881d5d9","$typeOfContent":"","type":"SetVariable","$title":"Definir texto fim de ano","$invalid":false,"settings":{"variable":"texto","value":"Hoje, dia 31/12, não haverá expediente, aguardamos seu retorno no dia 03/01. Obrigado."},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2021-12-24","2021-12-31"]}]}],"$leavingCustomActions":[{"$id":"0341ca7e-e37f-4dc9-b9cc-600751b2da58","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"texto"},"conditions":[]}],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-a6046c6f-3de5-45db-99d6-82b2651df7ac","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-2cf14aa8-c257-468b-b9e7-3a45de1d9f05","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-03f4a175-32b3-4b14-a2e2-d368058ff4e2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7a862948-4514-4f8a-963d-f032c73933ec","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-084fd622-c15d-4140-95f2-eb62b3de01c7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0e54e2fd-f478-4a86-9f1a-7588a2eeec7e","label":"UserInput","background":"#000000","canChangeBackground":false}],"$defaultOutput":{"stateId":"c0f3b1ab-7c78-433e-9569-572e1285585f","$invalid":false},"id":"accc7f17-d9be-44a2-b6ee-76633a988136","root":false,"$title":"3.1 - Fora do Horário de Atendimento","$position":{"top":"515px","left":"1165px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"220af9c4-91d8-4c75-ab90-4c5144f20f9b":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"a5058359-5853-433f-91fd-40b30f3d589c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a5058359-5853-433f-91fd-40b30f3d589c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"4af525c4-783a-4702-a4a0-0f8ee5792e1c","type":"text/plain","content":"Por favor, escolha o melhor horário para que possamos lhe retornar."},"$cardContent":{"document":{"id":"4af525c4-783a-4702-a4a0-0f8ee5792e1c","type":"text/plain","content":"Por favor, escolha o melhor horário para que possamos lhe retornar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3f0a0da1-a931-42b3-9e3c-2483a5eb1415","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3f0a0da1-a931-42b3-9e3c-2483a5eb1415","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"33cc6730-8632-48ee-8709-482528ce2832","type":"application/vnd.lime.select+json","content":{"text":"Qual seria um bom horário?","options":[{"text":"8h às 12h","previewText":"8h às 12h","value":null,"index":0,"type":null},{"text":"12h às 16h","previewText":"12h às 16h","value":null,"index":1,"type":null},{"text":"16h às 19h","previewText":"16h às 19h","value":null,"index":2,"type":null}]}},"$cardContent":{"document":{"id":"33cc6730-8632-48ee-8709-482528ce2832","type":"application/vnd.lime.select+json","content":{"text":"Qual seria um bom horário?","options":[{"text":"8h às 12h","previewText":"8h às 12h","value":null,"index":0,"type":null},{"text":"12h às 16h","previewText":"12h às 16h","value":null,"index":1,"type":null},{"text":"16h às 19h","previewText":"16h às 19h","value":null,"index":2,"type":null}]}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"52bccbb2-f8f0-4122-b674-acc759ff526f","type":"text/plain","content":"selectedHour"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"selectedHour"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bf51150e-d078-445a-ae42-eedcc41524af","$connId":"con_133","conditions":[{"source":"input","comparison":"equals","values":["8h às 12h","12h às 16h","16h às 19h"]}],"$invalid":false,"$id":"2d31e338-82a7-45f8-b57b-a185661941ec"},{"stateId":"onboarding","$connId":"con_138","conditions":[{"source":"context","comparison":"equals","values":["11974820218"],"variable":"phoneNumber"}],"$invalid":false,"$id":"bf1f326c-6eaf-4528-9e21-43656ecaf2df"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Agendamento","$invalid":false,"settings":{"extras":{},"category":"Agendamento","action":"{{phoneNumber}}|{{contact.name}}|{{input.content}}"},"conditions":[]}],"$inputSuggestions":["8h às 12h","12h às 16h","16h às 19h"],"$defaultOutput":{"stateId":"bf51150e-d078-445a-ae42-eedcc41524af","$invalid":false},"$tags":[{"id":"blip-tag-83e4cc91-fb4b-4d3f-b590-c4cfafab275c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-94e19f00-e4d4-4d43-a3a9-b91815c7e1e3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6527bc8c-a0c9-4515-91d0-9b1335643089","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"220af9c4-91d8-4c75-ab90-4c5144f20f9b","root":false,"$title":"Agenda Contato","$position":{"top":"287px","left":"2476px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bf51150e-d078-445a-ae42-eedcc41524af":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f3c209a7-2570-4338-8972-7f656b44909a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f3c209a7-2570-4338-8972-7f656b44909a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"6748c8e8-46e4-45d7-a4c2-b8a08d616207","type":"text/plain","content":"Ok, obrigado pela resposta."},"$cardContent":{"document":{"id":"6748c8e8-46e4-45d7-a4c2-b8a08d616207","type":"text/plain","content":"Ok, obrigado pela resposta."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c3ba01e5-0b83-47af-9bf6-356321c3b74e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c3ba01e5-0b83-47af-9bf6-356321c3b74e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"81a825a9-14a8-4bad-92f5-d44e2893fe8c","type":"application/vnd.lime.select+json","content":{"text":"O seu contato foi agendado. Até mais!","scope":"immediate","options":[{"text":"Retornar","previewText":"Retornar","value":null,"index":0,"type":null}]}},"$cardContent":{"document":{"id":"81a825a9-14a8-4bad-92f5-d44e2893fe8c","type":"application/vnd.lime.select+json","content":{"text":"O seu contato foi agendado. Até mais!","scope":"immediate","options":[{"text":"Retornar","previewText":"Retornar","value":null,"index":0,"type":null}]}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"91632a11-5a96-44f5-90d3-e6cd9c450d31","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"df6ee81c-6531-47f3-b366-0cbd31e43a01","$connId":"con_143","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"b8f1d066-48f3-49f5-ac4b-a84d45245c63"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":["Retornar"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e8bd7ffb-c73f-453b-a851-b7054d93aaf5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-62350078-c5c3-4e24-87e4-479cdd35c6ff","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bf51150e-d078-445a-ae42-eedcc41524af","root":false,"$title":"Agenda Contato Agradecimento","$position":{"top":"397px","left":"2475px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e355c3b1-d519-4b6a-b6e5-a61e520a3552":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8300e64d-5854-4ed7-af9b-d716a21dbacb","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"189300b3-630b-4bc0-a46c-a7fb49d2698c","$connId":"con_148","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Especialistas"]}],"$invalid":false,"$id":"8f033f59-b948-4698-81d3-cb5cb61a346a"},{"stateId":"0fcd6c26-fbfc-47a3-a533-78688b2fd4bd","$connId":"con_153","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Call"]}],"$invalid":false,"$id":"51bb9df7-712c-4b87-959e-5dc745ffdcf7"},{"stateId":"a98f1bcb-a55d-4081-8cbb-cbe72c114776","$connId":"con_158","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"isWorkTime"},{"source":"context","values":["Especialistas"],"variable":"canalSelecionado","comparison":"equals"}],"$invalid":false,"$id":"f76dff90-3a2a-488a-bb46-cda8150c893f"},{"stateId":"c4bc96c0-96e9-4126-91d9-036af4f8daf7","$connId":"con_163","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Call"]}],"$invalid":false,"$id":"188dc91f-14b5-40f5-997e-44f1570e38c8"},{"stateId":"189300b3-630b-4bc0-a46c-a7fb49d2698c","typeOfStateId":"state","$connId":"con_168","$id":"05da3781-f6ca-4f50-82d4-e08b844e46c3","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Fraude","$invalid":false,"settings":{"function":"run","source":"\n            function run(phoneNumber,bloqueioPorFraude) {\n               var array = bloqueioPorFraude.split('|');\n                var retorno = array.filter(function (e){\n                   return e == phoneNumber;\n               });\n              if(retorno.length > 0){\n                  return true;\n              }\n              return false;\n            }","inputVariables":["phoneNumber","config.BloqueioPorFraude"],"outputVariable":"fraude","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"verifica horario","$invalid":false,"settings":{"function":"run","source":"//Default BLiP TimeZoneOffset = São Paulo (GMT-3)\nvar DEFAULT_OFFSET = 3;\n\nfunction run(canalSelecionado, holiday, startDate) {\n\n    try {\n\n        // if (holiday == \"true\") {\n        //     return isHoliday();\n        // }\n\n        let data = new Date();\n        let dayMonth = data.getDate();\n        let dayWeek = data.getDay();\n        let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n        let hours = convertHours < 10 ? '0' + convertHours : convertHours;\n        let minutes = data.getMinutes() < 10 ? '0' + data.getMinutes() : data.getMinutes();\n        let hoursAndMinutes = hours + \":\" + minutes;\n        let selectedChannel = canalSelecionado;\n        let channel = selectedChannel == \"Default\" ? 0 : \n                      selectedChannel == \"Especialistas\" ? 1 :\n                      selectedChannel == \"Call\" ? 2 :\n                      0;\n\n        let weekCall = { \"start\": \"08:00\", \"end\": \"19:00\" };\n        let weekEspecialistas = { \"start\": \"08:00\", \"end\": \"19:00\" };    \n\n        let objRules = {\n            \"rules\": [\n                { \"Default\": [null, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, null] },\n                { \"Especialistas\": [null, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, weekEspecialistas, null] },\n                { \"Call\": [null, weekCall, weekCall, weekCall, weekCall, weekCall, null] }\n        ]\n        }       \n\n        if (objRules.rules[channel][selectedChannel][dayWeek] == null) {\n            return false\n        } else {\n            let resultDay = objRules.rules[channel][selectedChannel][dayWeek]\n            return hoursAndMinutes >= resultDay.start && hoursAndMinutes <= resultDay.end\n        }\n    }\n    catch (e) {\n        return e;\n    }\n}\n\n// function isHoliday() {\n//     var DEFAULT_OFFSET = 3;\n//     let data = new Date();\n//     let dayMonth = data.getDate();\n//     let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n//     let hours = convertHours < 10 ? '0' + convertHours : convertHours;\n//     let minutes = data.getMinutes() < 10 ? '0' + data.getMinutes() : data.getMinutes();\n//     let hoursAndMinutes = hours + \":\" + minutes;\n\n//     if (dayMonth > 23 && dayMonth < 27) {\n//         if ((dayMonth == 24 && hoursAndMinutes > \"12:00\") || (dayMonth == 25)) {\n//             return false;\n//         }\n//         else if (dayMonth == 26 && hoursAndMinutes > \"08:00\") {\n//             return true;\n//         }\n//     }\n//     else if (dayMonth == 30) {\n\n//         if (hoursAndMinutes < \"17:00\") {\n//             return true;\n//         }\n//         else {\n//             return false;\n//         }\n//     }\n//     else if (dayMonth == 31 || dayMonth == 1) {\n//         return false;\n//     }\n//     else if (dayMonth == 2 && hoursAndMinutes > \"05:20\") {\n//         return true;\n//     }\n\n// }","inputVariables":["canalSelecionado","config.isHoliday","config.startDate"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{},"name":"{{contact.name}}","phoneNumber":"{{phoneNumber}}"},"conditions":[]},{"type":"SetVariable","$title":"Seta Feriado","$invalid":false,"settings":{"variable":"isWorkTime","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2020-05-01"]}]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"{{agentName}}"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ExecuteScript","$title":"CalendarDataTimeBrasil","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  const DEFAULT_OFFSET = 3;\n  let data = new Date();\n  let month = data.getMonth() + 1\n  let newMonth = month  < 10 ? '0'+ month  : month\n  let day = data.getDate();\n  let year = data.getFullYear();\n  let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n  let hours = convertHours <10 ? '0'+convertHours:convertHours;\n  let minutes = data.getMinutes() <10 ? '0'+data.getMinutes():data.getMinutes();\n  let dateBrazil = data.toLocaleString(\"pt-BR\")\n  return `${day}/${newMonth}/${year} - ${hours}:${minutes}`;\n\n }","inputVariables":[],"outputVariable":"CalendarDataTimeBrasil","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2","$invalid":false},"$tags":[{"id":"blip-tag-340139ae-3432-48d3-bc5b-d162f98ab023","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3290a859-ef02-4f7a-bb4f-2c0d5456a147","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-70aa7ef0-2ec2-438a-bf9c-9ffba2625dc2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","root":false,"$title":"3.0 - Verifica horário de atendimento","$position":{"top":"589px","left":"75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"189300b3-630b-4bc0-a46c-a7fb49d2698c":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"321a54d2-b2e9-441a-bb5d-ca71a6b2219d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"321a54d2-b2e9-441a-bb5d-ca71a6b2219d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7a6c2ccd-a74c-4fd4-b54b-13d303e64d3f","type":"text/plain","content":"Aguarde, em breve um especialista te atenderá para falar tudo sobre as nossas máquinas."},"$cardContent":{"document":{"id":"7a6c2ccd-a74c-4fd4-b54b-13d303e64d3f","type":"text/plain","content":"Aguarde, em breve um especialista te atenderá para falar tudo sobre as nossas máquinas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2cd953c0-d5f0-494c-84b0-f29188cd8cd6","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a","$connId":"con_173","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"agentEmail"}],"$invalid":false,"$id":"fcd46ea2-fc99-4e55-ac0d-b585db0abbe3"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Jornada","$invalid":false,"settings":{"extras":{},"category":"Jornada","action":"Step 4 - Transbordo"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Detalhada","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{contact.name}}|{{canalSelecionado}}","category":"Jornada Detalhada"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]},{"type":"ProcessCommand","$title":"GET ATTENDANTS","$invalid":false,"settings":{"method":"get","to":"postmaster@desk.msging.net","uri":"/attendants?$take=99999","variable":"attendants"},"conditions":[]},{"type":"ExecuteScript","$title":"CHECK ATTENDANT STATUS","$invalid":false,"settings":{"function":"run","source":"function run(attendants, agentEmail) {\n    if (!agentEmail || agentEmail == 'undefined') {\n        return false;\n    } else {\n        attendants = JSON.parse(attendants).resource.items;\n        const attendant = attendants.filter(function (a) {\n           if (a.identity == encodeURIComponent(agentEmail) + '@blip.ai'){\n\n               return a;\n           }\n        });\n        return attendant.length > 0 ? attendant[0].status == 'Online' : false;\n    }\n}","inputVariables":["attendants","contact.extras.agentEmail"],"outputVariable":"attendantOnline","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"MergeContact","$title":"RESET AGENTEMAIL","$invalid":false,"settings":{"extras":{"Agente":"{{attendantOnline}}"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ProcessHttp","$title":"SUBSCRIBE NO TICKETMONITOR","$invalid":false,"settings":{"headers":{"X-Blip-User":"{{contact.identity}}","X-Blip-Bot":"{{config.botIdentity}}","X-Desk-Team":"default"},"method":"POST","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}\n            ","uri":"{{config.ApiUrl}}/v1/Subscription/Subscribe","responseStatusVariable":"statusTicketMonitor","responseBodyVariable":"bodyTicketMonitor"},"conditions":[]},{"type":"ExecuteScript","$title":"Corrige Hora Transbordo Especialistas","$invalid":false,"settings":{"function":"run","source":"function run(calendarDateTime) {\n    \n    let date = new Date(calendarDateTime);\n    let day = date.getUTCDate() < 10 ? \"0\" + date.getUTCDate() : date.getUTCDate();\n    let month = (date.getUTCMonth()+1) < 10 ? \"0\" + (date.getUTCMonth()+1) : (date.getUTCMonth()+1);\n    let hour = (date.getUTCHours()-3) < 10 ? \"0\" + (date.getUTCHours()-3) : (date.getUTCHours()-3);\n    let newDate = day + \"/\" + month + \"/\" + date.getUTCFullYear() + \" \" + hour;\n    return newDate;\n}","inputVariables":["calendar.datetime"],"outputVariable":"transbordoEspecialistas","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Transbordo Especialistas","$invalid":false,"settings":{"extras":{},"category":"Transbordo Especialistas","action":"{{transbordoEspecialistas}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"transbordoEspecialistas"}]},{"type":"ExecuteScript","$title":"Corrige Hora Transbordo Especialistas2","$invalid":false,"settings":{"function":"run","source":"function run(calendarDateTime) {\n    \n    let date = new Date(calendarDateTime);\n    let day = date.getUTCDate() < 10 ? \"0\" + date.getUTCDate() : date.getUTCDate();\n    let month = (date.getUTCMonth()+1) < 10 ? \"0\" + (date.getUTCMonth()+1) : (date.getUTCMonth()+1);\n    let hour = (date.getUTCHours()-3) < 10 ? \"0\" + (date.getUTCHours()-3) : (date.getUTCHours()-3);\n    //let newDate = day + \"/\" + month + \"/\" + date.getUTCFullYear() + \" \" + hour;\n    return hour;\n}","inputVariables":["calendar.datetime"],"outputVariable":"transbordoEspecialistasHora","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"transbordoEspecialistasHora","$invalid":false,"settings":{"extras":{},"category":"transbordoEspecialistasHora","action":"{{transbordoEspecialistasHora}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"transbordoEspecialistasHora"}]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"telefone":"{{phoneNumber}}","campanha":"{{campanha}}","Tag Último Atendimento":"{{returnTags}}","Dúvida":"{{duvidaRetorno}}"},"name":"{{nome}}"},"conditions":[]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"Especialistas"},"name":"{{nome}}"},"conditions":[]},{"$id":"56206409-470a-48e1-8b8c-ad7876dbcd55","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"Broadcast","campanha":"Broadcast"}},"conditions":[{"source":"context","comparison":"notEquals","variable":"contact.extras.broadcastOrigem","values":["-"]}]},{"type":"TrackEvent","$title":"Transbordo Equipe Especialistas","$invalid":false,"settings":{"extras":{},"category":"Transbordo Equipe Especialistas","action":"{{calendar.datetime}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"calendar.datetime"}]},{"$id":"4777a9fa-f2f5-4ec1-9693-0522fa476534","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"campanha":"Retorno {{campanha}}"}},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.agentEmail"}]}],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-34a98060-4c11-40f3-812c-9ee2746b87e4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2200859a-2663-41e5-8a9e-97e847778001","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-c80a221b-49d5-4935-a387-aca4a00b9a9a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7467568d-df83-4745-8f6e-92bd78d8cc0d","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-da7b6e85-7c8e-4133-8c0b-442a24506be8","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b2e6c87b-57d2-4265-b76e-5534bf5b6e3c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"$defaultOutput":{"stateId":"desk:4c6a8457-aa66-4361-9b75-e4be7a62f56a","$invalid":false},"id":"189300b3-630b-4bc0-a46c-a7fb49d2698c","root":false,"$title":"4.2 - Mensagem pré transbordo Especialistas","$position":{"top":"836px","left":"525px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c0f3b1ab-7c78-433e-9569-572e1285585f":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"af08d1c8-99d8-4afc-8da5-7efd34ef4397","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"66c548ae-6c6d-4817-ba15-8de50513f391","$connId":"con_178","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"36f68dd8-de33-4b4d-b4bb-2714102e52b3"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Base Fora Horário","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{returnTags}}","category":"Base Fora Horário"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$invalid":false},"$tags":[{"id":"blip-tag-41a05468-bbcc-4d60-8e04-7fb938ee3d0a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c9f71287-da9c-4362-b71b-ba349259d2b8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c0f3b1ab-7c78-433e-9569-572e1285585f","root":false,"$title":"3.2 - Input Durante Scheduled","$position":{"top":"793px","left":"2726px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"66c548ae-6c6d-4817-ba15-8de50513f391":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"0ad7a5a1-945a-40f4-80c9-6c94449250a4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0ad7a5a1-945a-40f4-80c9-6c94449250a4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"07984dd5-c000-4f80-b098-6f7fc26f86f9","type":"text/plain","content":"Por favor, aguarde que retornaremos o contato."},"$cardContent":{"document":{"id":"07984dd5-c000-4f80-b098-6f7fc26f86f9","type":"text/plain","content":"Por favor, aguarde que retornaremos o contato."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"fae67524-41d2-4fe0-b646-369e100c04a8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$invalid":false},"$tags":[{"id":"blip-tag-290e9d84-8688-49b5-a964-153750bde51c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6363d0c9-afc1-4902-9d7e-3c6c51b21df0","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"66c548ae-6c6d-4817-ba15-8de50513f391","root":false,"$title":"3.3 - Aguarda Scheduled","$position":{"top":"674px","left":"2724px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1320bb7d-906b-4bb3-9718-40149a20cb65":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d515aa37-38f3-435c-805a-d07a5bec0b9f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"ProcessHttp","$title":"REQUISIÇÃO HTTP","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{config.apiKey}}"},"method":"POST","body":"{\n    \"to\": \"{{input.content@contact}}\",\n    \"type\": \"text/plain\",\n    \"content\": \"{{config.UserNotResponsive}}\"\n}","uri":"{{config.messages}}"},"conditions":[]},{"type":"ProcessCommand","$title":"SET USER STATE","$invalid":false,"settings":{"method":"set","to":"postmaster@msging.net","resource":"4c6a8457-aa66-4361-9b75-e4be7a62f56a","type":"text/plain","uri":"/contexts/{{input.content@contact}}/stateid%40{{config.identityFlow}}","variable":"euEstavaVazia"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"x"}]},{"type":"ProcessCommand","$title":"OPEN TICKET","$invalid":false,"settings":{"method":"set","to":"postmaster@desk.msging.net","resource":{"firstName":"John","lastName":"Doe"},"type":"text/plain","uri":"/tickets/{{input.content@contact}}","variable":"euEstavaVazia"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"x"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-62c98ca7-9622-4f7d-a169-402ca183d03d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0442954a-2fff-4043-a7c9-fafc99d76187","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false}],"id":"1320bb7d-906b-4bb3-9718-40149a20cb65","root":false,"$title":"3.4 - Handle Scheduled Message","$position":{"top":"527px","left":"2709px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3cea425d-9498-4a92-a07d-8bf44e871ef5":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e66d490c-2c05-44ea-917a-60e0befe2f93","type":"text/plain","textContent":"Entrada do usuário","content":"InputIniciarRetorno"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"InputIniciarRetorno"},"$invalid":false}],"$conditionOutputs":[{"stateId":"ee1cf003-8ada-4012-b9d3-7b584e40fef0","$connId":"con_183","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"InputIniciarRetorno"}],"$invalid":false,"$id":"8040b926-22b9-4e8a-9675-0c9a24c1444d"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"SCRIPT ENCODE INPUT","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n    return encodeURIComponent(inputContent);\n}","inputVariables":["input.content"],"outputVariable":"encodedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"GET SMALLTALKS","$invalid":false,"settings":{"headers":{"Accept":"application/json;v=2"},"method":"GET","uri":"https://smalltalks-prd.azurewebsites.net/Analysis?text={{encodedInput}}&checkDate=true&infoLevel=1","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[]},{"type":"ExecuteScript","$title":"ISTHANKSORGOODBYE","$invalid":false,"settings":{"function":"run","source":"var THANKS = 'Thanks';\nvar GOODBYE = 'GoodBye';\nvar CONFIRMATION = 'Confirmation';\n\nfunction run(bodySmallTalks) {\n\t\n    var body = JSON.parse(bodySmallTalks);\n\n\tif( body.analysis.matchesCount <= 0 ) return false;\n    \n    var filterThanksGoodbye = body.analysis.matches.filter(function (match) { return match.smallTalk == THANKS || match.smallTalk == GOODBYE || match.smallTalk == CONFIRMATION;  } );\n\n    return (filterThanksGoodbye.length > 0 || body.analysis.cursed);\n}","inputVariables":["bodySmallTalks"],"outputVariable":"isThanksOrGoodbye","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"IsGreeting","$invalid":false,"settings":{"function":"run","source":"var GREETING = 'Greeting';\n\nfunction run(bodySmallTalks) {\n\t\n    var body = JSON.parse(bodySmallTalks);\n\n\tif( body.analysis.matchesCount <= 0 ) return false;\n    \n    var filterGreeting = body.analysis.matches.filter(function (match) { return match.smallTalk == GREETING;  } );\n\n    return (filterGreeting.length > 0 || body.analysis.cursed);\n}","inputVariables":["bodySmallTalks"],"outputVariable":"isGreeting","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"ISGOODMORNIGORGOODAFTERNOONORGOODNIGHT","$invalid":false,"settings":{"function":"run","source":"var GOODMORNING = 'GoodMorning';\nvar GOODAFTERNOON = 'GoodAfternoon';\nvar GOODNIGHT = 'GoodNight';\n\nfunction run(bodySmallTalks) {\n\t\n    var body = JSON.parse(bodySmallTalks);\n\n\tif( body.analysis.matchesCount <= 0 ) return false;\n    \n    var filterGreetingDay = body.analysis.matches.filter(function (match) { return match.smallTalk == GOODMORNING || match.smallTalk == GOODAFTERNOON || match.smallTalk == GOODNIGHT;  } );\n\n    return (filterGreetingDay.length > 0 || body.analysis.cursed);\n}","inputVariables":["bodySmallTalks"],"outputVariable":"greetingDay","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"DEFINE GREETING","$invalid":false,"settings":{"function":"run","source":"function run() {\n        var date = new Date();\n        var hour = date.getHours();\n\n        return hour < 12 ?  \"Bom dia\":\n                hour > 12 ? \"Boa tarde\" :\n                hour < 18 ? \" Boa tarde\" : \"Boa noite\";//Return value will be saved as \"Return value variable\" field name\n}","inputVariables":["dateTimeOffset"],"outputVariable":"greeting","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"26132bbf-4720-4194-9801-e335675e45b8","$invalid":false},"$tags":[{"id":"blip-tag-1630615a-8533-422f-a019-5cb4b8115c1b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-46787b3f-de5a-41e0-a726-dafb64298e34","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-e3b9501e-c382-411a-84be-3d4c934c4254","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3cea425d-9498-4a92-a07d-8bf44e871ef5","root":false,"$title":"6.2 - Aguarda Input Esperado Agradecimento","$position":{"top":"996px","left":"1239px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7107fd4e-ef42-4e9d-bc56-b951ec822e5a":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"78471581-b00f-4395-a444-3d58c37683d5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"78471581-b00f-4395-a444-3d58c37683d5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"23fce9f8-8580-4a4a-a1e0-da8e380cf9c4","type":"text/plain","content":"Usado no bloco Verifica horário de Atendimento e Fora do Horário de Atendimento"},"$cardContent":{"document":{"id":"23fce9f8-8580-4a4a-a1e0-da8e380cf9c4","type":"text/plain","content":"Usado no bloco Verifica horário de Atendimento e Fora do Horário de Atendimento"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0663fe88-e65b-43a7-af85-3ed82f76c79d","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_188","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"67e9681a-00ab-46b0-90c8-99440ff0ba18"},{"stateId":"accc7f17-d9be-44a2-b6ee-76633a988136","$connId":"con_193","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"55efedc2-9619-4e86-b299-ff56257d7e32"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8825656d-2c0b-4907-854f-ebe8d44ed643","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7107fd4e-ef42-4e9d-bc56-b951ec822e5a","root":false,"$title":"Script isWorkTime","$position":{"top":"653px","left":"949px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c4bc96c0-96e9-4126-91d9-036af4f8daf7":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f2c48288-126e-45c1-9f6b-50c3dd118eaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f2c48288-126e-45c1-9f6b-50c3dd118eaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d799c0f5-161c-44fa-b38c-9815bf05cdcd","type":"text/plain","content":"Neste momento, não podemos lhe atender, pois o nosso horário de funcionamento é de segunda a sexta, das 08h às 19h (exceto em feriados). Mas não se preocupe: no próximo dia útil, entraremos em contato para lhe oferecer as melhores ofertas do mercado."},"$cardContent":{"document":{"id":"d799c0f5-161c-44fa-b38c-9815bf05cdcd","type":"text/plain","content":"Neste momento, não podemos lhe atender, pois o nosso horário de funcionamento é de segunda a sexta, das 08h às 19h (exceto em feriados). Mas não se preocupe: no próximo dia útil, entraremos em contato para lhe oferecer as melhores ofertas do mercado."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"55e8c085-9289-4117-8ec1-54476a79983b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2","$connId":"con_198","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"67897bf7-5b08-4527-88fb-cba003b2c329"}],"$enteringCustomActions":[{"type":"MergeContact","$title":"Definir Canal","$invalid":false,"settings":{"extras":{"Canal":"ForaHorario"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ExecuteScript","$title":"retorna fora horario canal","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(attendanceTeam) {\n                if(attendanceTeam == \"Produto\"){\n                    return \"08:00 às 20:00\";\n                } else {\n                    return \"08:00 às 19:00\";\n                }\n            }","inputVariables":["attendanceTeam"],"outputVariable":"canalFora","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Base Fora de horario Call","$invalid":false,"settings":{"extras":{},"category":"Base Fora de Horário Call","action":"{{CalendarDataTimeBrasil}}|{{contact.name}}|{{phoneNumber}}|VPO Facebook Instagram WA"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-a490a79d-f46b-4df9-9003-83ff728bb74c","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-83157ced-fb43-46e2-9f40-d42446f1e37b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-64127685-54dc-4a3a-a9c1-733c93a069fd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fca55751-45f6-41e6-aaef-862fb51a6a5e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"$defaultOutput":{"stateId":"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2","$invalid":false},"id":"c4bc96c0-96e9-4126-91d9-036af4f8daf7","root":false,"$title":"3.1 - Fora do Horário de Atendimento Call","$position":{"top":"511px","left":"948px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a98f1bcb-a55d-4081-8cbb-cbe72c114776":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"f2c48288-126e-45c1-9f6b-50c3dd118eaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f2c48288-126e-45c1-9f6b-50c3dd118eaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d799c0f5-161c-44fa-b38c-9815bf05cdcd","type":"text/plain","content":"Neste momento não podemos lhe atender, pois o nosso horário de funcionamento é de segunda a sexta, das 08h às 19h (exceto em feriados). "},"$cardContent":{"document":{"id":"d799c0f5-161c-44fa-b38c-9815bf05cdcd","type":"text/plain","content":"Neste momento não podemos lhe atender, pois o nosso horário de funcionamento é de segunda a sexta, das 08h às 19h (exceto em feriados). "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"1defdb93-37fc-44f7-8897-ab58c91721bf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1defdb93-37fc-44f7-8897-ab58c91721bf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"771cc288-f728-4c86-9089-5e693d31d2ee","type":"text/plain","content":"Entre em contato novamente neste período para que nossa equipe de atendimento possa lhe oferecer as menores taxas e as melhores condições."},"$cardContent":{"document":{"id":"771cc288-f728-4c86-9089-5e693d31d2ee","type":"text/plain","content":"Entre em contato novamente neste período para que nossa equipe de atendimento possa lhe oferecer as menores taxas e as melhores condições."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"55e8c085-9289-4117-8ec1-54476a79983b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2","$connId":"con_203","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"b5e80466-d358-4772-9235-df78cdcf43ea"}],"$enteringCustomActions":[{"type":"MergeContact","$title":"Definir Canal","$invalid":false,"settings":{"extras":{"Canal":"ForaHorario"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ExecuteScript","$title":"retorna fora horario canal","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run(attendanceTeam) {\n                if(attendanceTeam == \"Produto\"){\n                    return \"08:00 às 20:00\";\n                } else {\n                    return \"08:00 às 19:00\";\n                }\n            }","inputVariables":["attendanceTeam"],"outputVariable":"canalFora","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Base Fora de horario Especialistas","$invalid":false,"settings":{"extras":{},"category":"Base Fora de Horário Especialistas","action":"{{CalendarDataTimeBrasil}}|{{contact.name}}|{{phoneNumber}}|VPO Facebook Instagram WA"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-c136c697-6cbf-43dc-a0ad-9e9873090daa","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-41221edf-60a6-49d4-a69d-aba8fc7db2f8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-873d3379-1b81-4340-b636-52cb55f67d8b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-932ca60c-b8d1-4526-af5b-e13a8e065530","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"$defaultOutput":{"stateId":"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2","$invalid":false},"id":"a98f1bcb-a55d-4081-8cbb-cbe72c114776","root":false,"$title":"3.1 - Fora do Horário de Atendimento Especialistas","$position":{"top":"367px","left":"948px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e7d3d75d-8e43-4ee5-96d4-8328ac527a7a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_208","$id":"690bbe90-2914-4165-9824-3b30bc33e09a","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_1","spprodmarketingwhatsapp_remkt_2_imagem","spprodmarketingwhatsapp_remkt_1_imagem","spprodmarketingwhatsapp_remkt_2"],"variable":"contact.extras.broadcastOrigem"},{"source":"input","comparison":"equals","values":["nao","Não"]}],"$invalid":false},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_213","conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Especialistas"]}],"$invalid":false,"$id":"3ee22063-4918-4469-bf12-23944bb4ae57"},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_218","conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Call"]}],"$invalid":false,"$id":"9481e1d4-1b8c-485e-bc3b-f57a01ccf0b4"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$invalid":false},"$tags":[{"id":"blip-tag-94d9dd9e-80f9-47a4-a39f-2ffcae3517d2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1e7d20ed-b8e2-47d9-9546-ce1f0b6ab5d2","root":false,"$title":"Aguarda input Fora horário","$position":{"top":"673px","left":"721.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ee1cf003-8ada-4012-b9d3-7b584e40fef0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9a968f00-951c-419c-983e-2d701f65d92a","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3c0aca65-863f-4f6e-b0d5-a29359c425ac","$connId":"con_223","conditions":[{"source":"context","comparison":"equals","values":["Central de Atendimento"],"variable":"returnTags"}],"$invalid":false,"$id":"2afe1fa3-327e-4baf-8b96-2ee7cede9971"},{"stateId":"welcome","$connId":"con_228","conditions":[{"source":"context","comparison":"equals","values":["1","oi"],"variable":"InputIniciarRetorno"}],"$invalid":false,"$id":"368528fa-fa92-49f6-a197-090d31537282"},{"stateId":"3cea425d-9498-4a92-a07d-8bf44e871ef5","$connId":"con_233","conditions":[{"source":"input","comparison":"equals","values":["ok","obrigado","brigado","grato","obrigada","brigada","grata","tks","tudo bem","td bem","beleza","blza","thanks","Agradecido","agradecida","Certo","obg","valeu","firmeza","tranquilo"]}],"$invalid":false,"$id":"384e6aed-e0d2-49e4-9623-4963274095ca"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"26132bbf-4720-4194-9801-e335675e45b8","$invalid":false},"$tags":[],"id":"ee1cf003-8ada-4012-b9d3-7b584e40fef0","root":false,"$title":"9.0 - Valida Input Retorno","$position":{"top":"1877px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"26132bbf-4720-4194-9801-e335675e45b8":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"87d8b64e-2957-440c-b889-15a82f4dbe59","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"87d8b64e-2957-440c-b889-15a82f4dbe59","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"308433ee-2964-44d0-9aba-d15861395088","type":"text/plain","content":"{Caso queria conversar conosco, por favor, digite *1*.|Para Falar novamente conosco, por favor, digite *1*.}","metadata":{"#message.spinText":"true"}},"$cardContent":{"document":{"id":"308433ee-2964-44d0-9aba-d15861395088","type":"text/plain","content":"{Caso queria conversar conosco, por favor, digite *1*.|Para Falar novamente conosco, por favor, digite *1*.}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"10cc19dd-8c3c-419b-a262-47f9474a4e2c","type":"text/plain","content":"InputIniciarRetorno"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"InputIniciarRetorno"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_238","$id":"ba49f537-b125-4708-b31d-8aeff282b2cc","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_1","spprodmarketingwhatsapp_remkt_2_imagem","spprodmarketingwhatsapp_remkt_1_imagem","spprodmarketingwhatsapp_remkt_2","spprodmarketingwhatsapp_remkt_2_imagem_copia"],"variable":"contact.extras.broadcastOrigem"},{"source":"input","comparison":"equals","values":["nao","não"]}],"$invalid":false},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_243","$id":"a04a7963-9f51-45e5-8b6c-186f7fda0d6e","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_1","spprodmarketingwhatsapp_remkt_1_imagem","×spprodmarketingwhatsapp_remkt_2 ×","spprodmarketingwhatsapp_remkt_2_imagem","spprodmarketingwhatsapp_remkt_2_imagem_copia"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"ee1cf003-8ada-4012-b9d3-7b584e40fef0","$connId":"con_248","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"InputIniciarRetorno"}],"$invalid":false,"$id":"4303bff4-03b3-4d9e-8640-ec50ecdd2191"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Input Diferente de Retorno Usuário Único","$invalid":false,"settings":{"extras":{},"category":"Input Diferente de Retorno Usuário Único","action":"{{phoneNumber}}|{{inputDiferenteRetorno}}"},"conditions":[]},{"type":"TrackEvent","$title":"Input Diferente de Retorno","$invalid":false,"settings":{"extras":{},"category":"Input Diferente de Retorno","action":"Quantidade de Exibição"},"conditions":[]}],"$leavingCustomActions":[{"type":"SetVariable","$title":"input Diferente de #iniciar","$invalid":false,"settings":{"variable":"inputDiferenteRetorno","value":"{{inputIniciarRetorno}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f1c03057-bdd8-48b4-abf2-7b46279b8af0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-95c81ce0-8a13-4c49-92aa-2e54b3450751","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bc69d572-c07e-4e4c-84a1-cc52d9414fc1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b83e0216-c767-4de2-baf2-e3f1956733a8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"26132bbf-4720-4194-9801-e335675e45b8","root":false,"$title":"9.1 - Instrução para Retornar","$position":{"top":"1730px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"99875753-46e7-41f6-88ef-816e3f8eca2c":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"6a32dcbe-38e5-46c3-9bbc-5c2961d8aadf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6a32dcbe-38e5-46c3-9bbc-5c2961d8aadf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"a60fa9f5-d3c8-4d75-8ad5-9e40a9c261bd","type":"text/plain","content":"Para melhorarmos o nosso atendimento, precisamos da sua opinião."},"$cardContent":{"document":{"id":"a60fa9f5-d3c8-4d75-8ad5-9e40a9c261bd","type":"text/plain","content":"Para melhorarmos o nosso atendimento, precisamos da sua opinião."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d1ba9aa8-75f9-493f-9198-91b4583e816d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d1ba9aa8-75f9-493f-9198-91b4583e816d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"1e7eb9b1-0df3-4b07-b604-bc48dca5e6e8","type":"text/plain","content":"Por favor, se quiser dar uma nota para o atendimento envie *1* ou *2* para finalizar o atendimento."},"$cardContent":{"document":{"id":"1e7eb9b1-0df3-4b07-b604-bc48dca5e6e8","type":"text/plain","content":"Por favor, se quiser dar uma nota para o atendimento envie *1* ou *2* para finalizar o atendimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"5c5d59a4-e3f8-4e71-a659-fb2dfc5d6baa","type":"text/plain","textContent":"Entrada do usuário","content":"feedbackYesOurNo"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"feedbackYesOurNo","validation":{"rule":"regex","regex":"^([1-2])$","error":"Para prosseguir, por favor, digite *1* ou *2*."}},"$invalid":false}],"$conditionOutputs":[{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","$connId":"con_253","conditions":[{"source":"context","comparison":"notEquals","values":["1"],"variable":"feedbackYesOurNo"}],"$invalid":false,"$id":"b232c9f6-aa8d-4041-943f-30f1b5f6605b"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Jornada NPS","$invalid":false,"settings":{"extras":{},"category":"Jornada NPS","action":"Step 1 - Quer Participar?"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-db3843ea-e27b-4c99-ba2a-18345cafa75f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-335d09c1-4223-4402-a916-ea041e5adc54","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7020add2-1570-415d-b131-772b24ff1d07","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"99875753-46e7-41f6-88ef-816e3f8eca2c","root":false,"$title":"8.0 - Quer dar Feedback?","$position":{"top":"1216px","left":"954px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3c0aca65-863f-4f6e-b0d5-a29359c425ac":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"abd9a899-0336-4e7f-bc49-14806d23a2f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"abd9a899-0336-4e7f-bc49-14806d23a2f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"545e2198-ebdb-4f5a-8c2d-10b2fdd130b3","type":"text/plain","content":"Esse canal de atendimento é exclusivo para novos credenciamentos. "},"$cardContent":{"document":{"id":"545e2198-ebdb-4f5a-8c2d-10b2fdd130b3","type":"text/plain","content":"Esse canal de atendimento é exclusivo para novos credenciamentos. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c4583529-e8ac-4bb4-ac3b-f15a632da7e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4583529-e8ac-4bb4-ac3b-f15a632da7e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"dad2934e-1371-45a0-92cb-07c2d40b99a2","type":"text/plain","content":"Por gentileza entrar em contato com a nossa Central de Atendimento pelos números: \n\n(11) 3175-8248 para Grande SP e 0300 015 7575 para outras localidades."},"$cardContent":{"document":{"id":"dad2934e-1371-45a0-92cb-07c2d40b99a2","type":"text/plain","content":"Por gentileza entrar em contato com a nossa Central de Atendimento pelos números: \n\n(11) 3175-8248 para Grande SP e 0300 015 7575 para outras localidades."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"2fc04559-64a9-4d37-a975-f019595272c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2fc04559-64a9-4d37-a975-f019595272c1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"7b095459-9f66-47a0-8855-58e1a826f0ae","type":"text/plain","content":"Será um prazer te atender, bons negócios."},"$cardContent":{"document":{"id":"7b095459-9f66-47a0-8855-58e1a826f0ae","type":"text/plain","content":"Será um prazer te atender, bons negócios."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"6f8ed1ed-2932-4d80-b63b-092a0f15e856","type":"text/plain","content":"inputTagCentralAtendimento"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"inputTagCentralAtendimento"},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","$connId":"con_258","conditions":[{"source":"context","comparison":"equals","values":["11991279986","11975711760"],"variable":"phoneNumber"}],"$invalid":false,"$id":"f196e89f-31de-4a2a-bbef-4c78f0c8fdd0"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Tag Central de Atendimento","$invalid":false,"settings":{"extras":{},"category":"Tag Central de Atendimento","action":"{{phoneNumber}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ed15d83c-23ff-4d4a-84a9-04c44414c284","$invalid":false},"$tags":[{"id":"blip-tag-e7d4766d-3edf-4752-b924-6533d534c4a9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ebb51f4f-ec2e-40fd-a2f5-035166b86903","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ac8ab1b0-f324-4fae-aa77-745f5c27e71c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3c0aca65-863f-4f6e-b0d5-a29359c425ac","root":false,"$title":"10.0 - Tag Central de Atendimento","$position":{"top":"1250px","left":"312px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ed15d83c-23ff-4d4a-84a9-04c44414c284":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"cc080e8f-bffb-4cc6-9f37-8e9cae882c11","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","$connId":"con_263","conditions":[{"source":"context","comparison":"equals","values":["11975711760","11991279986"],"variable":"phoneNumber"}],"$invalid":false,"$id":"0f679014-3914-4361-8f4b-ac1496c4546a"},{"stateId":"ed15d83c-23ff-4d4a-84a9-04c44414c284","$connId":"con_268","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"443e8add-ecc1-4ed1-a527-350cd6d16e57"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Input Central de Atendimento 1","$invalid":false,"settings":{"extras":{},"category":"Input Central de Atendimento 1","action":"{{inputTagCentralAtendimento}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"inputTagCentralAtendimento"}]}],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Input Central de Atendimento 2","$invalid":false,"settings":{"extras":{},"action":"{{inputTagCentralAtendimento}}","category":"Input Central de Atendimento 2"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"inputTagCentralAtendimento"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3c0aca65-863f-4f6e-b0d5-a29359c425ac","$invalid":false},"$tags":[{"id":"blip-tag-12f59f69-9cec-4674-a0ce-63cd05579bbb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6733ac97-d3ee-4a1e-914f-5ccc39facf22","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"ed15d83c-23ff-4d4a-84a9-04c44414c284","root":false,"$title":"10.1 - Central de Atendimento - input","$position":{"top":"1367px","left":"313px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"49a5ca76-81f2-4a8b-946a-ad7d563b94e5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8300e64d-5854-4ed7-af9b-d716a21dbacb","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"accc7f17-d9be-44a2-b6ee-76633a988136","$connId":"con_273","$id":"4b99eb51-cc42-443b-95ae-026e9ed768ea","conditions":[{"source":"context","comparison":"equals","values":["2021-12-24"],"variable":"calendar.date"},{"source":"context","comparison":"greaterThanOrEquals","variable":"calendar.hour","values":["15"]}],"$invalid":false},{"stateId":"a98f1bcb-a55d-4081-8cbb-cbe72c114776","$connId":"con_278","$id":"6d59abe9-915d-4991-a2d5-a83403ccaa8d","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"sabado","values":["true"]}],"$invalid":false},{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$connId":"con_283","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusToken"}],"$invalid":false,"$id":"2589bd5f-aabc-4bee-be12-d8c7271b0182"},{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$connId":"con_288","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusAPIHorario"}],"$invalid":false,"$id":"55ddfc9c-e68d-40c0-b855-d906f7da10ad"},{"stateId":"189300b3-630b-4bc0-a46c-a7fb49d2698c","$connId":"con_293","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Especialistas"]}],"$invalid":false,"$id":"448dd558-d4c4-490a-889e-dced15b69950"},{"stateId":"0fcd6c26-fbfc-47a3-a533-78688b2fd4bd","$connId":"con_298","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Call"]}],"$invalid":false,"$id":"8f392521-89b7-40ee-a3eb-6b0a67c6ede0"},{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","$connId":"con_303","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"isWorkTime"},{"source":"context","values":["Especialistas"],"variable":"canalSelecionado","comparison":"equals"}],"$invalid":false,"$id":"11b25613-2bf8-4442-a507-018666a50f07"},{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","$connId":"con_308","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"isWorkTime"},{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Call"]}],"$invalid":false,"$id":"a15fb539-1902-410f-90e9-77b4d3e9089c"},{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$connId":"con_313","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"c0dd6f83-4474-4330-a3d5-5c008fbdfa63"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Fraude","$invalid":false,"settings":{"function":"run","source":"\n            function run(phoneNumber,bloqueioPorFraude) {\n               var array = bloqueioPorFraude.split('|');\n                var retorno = array.filter(function (e){\n                   return e == phoneNumber;\n               });\n              if(retorno.length > 0){\n                  return true;\n              }\n              return false;\n            }","inputVariables":["phoneNumber","config.BloqueioPorFraude"],"outputVariable":"fraude","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"Definir selectTeam","$invalid":false,"settings":{"variable":"selectTeam","value":"{{canalSelecionado}}"},"conditions":[]},{"$id":"36253d8e-d225-4afa-9a99-e9bdea190090","$typeOfContent":"","type":"SetVariable","$title":"selectTeam","$invalid":false,"settings":{"variable":"selectTeam","value":"Default"},"conditions":[{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Especialistas"]}]},{"$id":"bcf16d0b-a96f-4815-826a-affd7b36226a","$typeOfContent":"","type":"ExecuteScript","$title":"encodingUrl","$invalid":false,"settings":{"function":"run","source":"\nfunction run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"Token API Horário","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlSafraToken}}/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"type":"ProcessHttp","$title":"API Horário","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/horarios-atendimentos/v1/horarios-atendimentos?idFila={{config.botIdentity}}&team={{selectTeam}}","responseStatusVariable":"statusAPIHorario","responseBodyVariable":"bodyAPIHorario"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"]}]},{"$id":"07c68602-d6c3-4d84-8181-d8122ef47741","$typeOfContent":"","type":"ExecuteScript","$title":"TRATA RETORNO API HORÁRIO","$invalid":false,"settings":{"function":"run","source":"function run (retornoAPI) {\n    const obj = JSON.parse(retornoAPI);\n\n    return obj.data.isWorkTime;\n}","inputVariables":["bodyAPIHorario"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusAPIHorario","values":["200"]}]},{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{},"name":"{{contact.name}}","phoneNumber":"{{phoneNumber}}"},"conditions":[]},{"$id":"9a5e35d2-436a-4843-8ed8-7045ce60619b","$typeOfContent":"","type":"SetVariable","$title":"isWorkTime feriado","$invalid":false,"settings":{"variable":"isWorkTime","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2021-10-12","2021-11-02","2021-11-15","2021-12-25","2021-12-31"]},{"source":"context","comparison":"greaterThanOrEquals","variable":"calendar.hour","values":["0"]}]},{"type":"TrackEvent","$title":"Status API Horário Token","$invalid":false,"settings":{"extras":{},"category":"Status API Horário Token","action":"{{statusToken}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"statusToken"}]},{"type":"TrackEvent","$title":"Status API Horário","$invalid":false,"settings":{"extras":{},"category":"Status API Horário","action":"{{statusAPIHorario}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"statusAPIHorario"}]},{"$id":"0223b935-6605-4e98-a10c-6ccdee16d396","$typeOfContent":"","type":"ExecuteScript","$title":"sabado","$invalid":false,"settings":{"function":"run","source":"function run(hoje, amanha) {\n    let sabado = hoje == \"Saturday\" || amanha == \"Saturday\" ? \"true\" : \"false\";\n    return sabado;\n}","inputVariables":["calendar.dayOfWeek","calendar.tomorrow.dayOfWeek"],"outputVariable":"sabado","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"31dcbe51-bfc2-47e1-bab3-eff7f56067ce","$typeOfContent":"","type":"ExecuteScript","$title":"payload","$invalid":false,"settings":{"function":"run","source":"\n            function run() {\n                var telefone = 0;\n                if(\"{{contact.phoneNumber}}\" != \"\"){\n                    telefone = parseInt(\"{{contact.phoneNumber}}\");\n                }\n                return {\n                        \"id_prosp\": \"{{contact.extras.id_prosp}}\",\n                        \"bot\": \"{{config.botIdentity}}\",\n                        \"sequencialId\": \"0\",\n                        \"customerIdentity\": \"{{contact.identity}}\",\n                        \"agentIdentity\": \"\",\n                        \"status\": \"Open\",\n                        \"dataAbertura\": \"{{calendar.datetime}}\",\n                        \"dataExpiracao\": \"{{calendar.datetime}}\",\n                        \"dataFinalizacao\": \"{{calendar.datetime}}\",\n                        \"time\": \"{{contact.extras.Agente}}\",\n                        \"finalizado\": \"0\",\n                        \"tags\": [],\n                        \"tempoFila\": \"\",\n                        \"tempoPrimeiraResposta\": \"\",\n                        \"mediaTempoRespostaAtendente\": \"\",\n                        \"nome\": \"{{contact.name}}\",\n                        \"email\": \"\",\n                        \"sexo\": \"\",\n                        \"cidade\": \"\",\n                        \"telefone\": telefone,\n                        \"nomeAtendente\": \"\",\n                        \"emailAtendente\": \"\",\n                        \"equipe\": \"{{contact.extras.Agente}}\",\n                        \"documento\": \"\",\n                        \"campanha\": \"{{contact.extras.campanha}}\",\n                        \"canal\": \"{{contact.extras.canal}}\",\n                        \"comentarios\": \"\",\n                        \"anuncioIdPost\": \"\",\n                        \"plataformas\": \"\",\n                        \"campanhasMarketing\": \"\",\n                        \"conjuntoDeAnuncios\": \"\",\n                        \"anuncio\": \"\",\n                        \"cpfCnpj\": \"\",\n                        \"nomedoCliente\": \"{{contact.name}}\",\n                        \"nps\": \"\",\n                        \"dataAvaliacao\": \"\",\n                        \"agente\": \"\",\n                        \"jornada\": \"\",\n                        \"retorno\": \"\",\n                        \"tagUltimoAtendimento\": \"\",\n                        \"broadcastOrigem\": \"{{contact.extras.broadcastOrigem}}\"\n                        }\n            }","inputVariables":[],"outputVariable":"payload","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85e0b249-6cda-4c36-93f1-7390e71b8527","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP CRIA TICKET","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"POST","body":"{{payload}}","uri":"{{config.urlCHT}}/atendimentos-hibridos/v1/mesa-bilhetes","responseStatusVariable":"statusTicket","responseBodyVariable":"bodyTicket"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}]},{"$id":"fe65cb48-93a8-42e3-ab18-64ba104377b3","$typeOfContent":"","type":"ExecuteScript","$title":"ticketId","$invalid":false,"settings":{"function":"run","source":"\n        function run(bodyTicket) {\n\n            bodyTicket = JSON.parse(bodyTicket);\n            return bodyTicket.data.id; \n        }","inputVariables":["bodyTicket"],"outputVariable":"ticketId","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusTicket","values":["200"]}]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Agente":"Especialistas"},"name":"{{contact.name}}"},"conditions":[]},{"type":"ExecuteScript","$title":"CalendarDataTimeBrasil","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n  const DEFAULT_OFFSET = 3;\n  let data = new Date();\n  let month = data.getMonth() + 1\n  let newMonth = month  < 10 ? '0'+ month  : month\n  let day = data.getDate();\n  let year = data.getFullYear();\n  let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n  let hours = convertHours <10 ? '0'+convertHours:convertHours;\n  let minutes = data.getMinutes() <10 ? '0'+data.getMinutes():data.getMinutes();\n  let dateBrazil = data.toLocaleString(\"pt-BR\")\n  return `${day}/${newMonth}/${year} - ${hours}:${minutes}`;\n\n }","inputVariables":[],"outputVariable":"CalendarDataTimeBrasil","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e7d7a73d-41df-4ec9-89bf-209b32414f9f","type":"TrackEvent","$title":"Base Fora Horário Especialista","$invalid":false,"settings":{"extras":{},"action":"{{CalendarDataTimeBrasil}}|{{contact.name}}|{{phoneNumber}}","category":"Base Fora Horário Especialista"},"conditions":[{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Especialistas"]}]},{"$id":"1fbd290a-274d-4602-a59d-5cdfe122d3dd","type":"TrackEvent","$title":"Base Fora de Horário Call","$invalid":false,"settings":{"extras":{},"action":"{{CalendarDataTimeBrasil}}|{{contact.name}}|{{phoneNumber}}","category":"Base Fora de Horário Call"},"conditions":[{"source":"context","comparison":"equals","variable":"canalSelecionado","values":["Call"]}]},{"$id":"d5f5a081-9da8-45a7-90ce-3cb3bb9ec71d","$typeOfContent":"","type":"MergeContact","$title":"Definir Agente Broadcast","$invalid":false,"settings":{"extras":{"Agente":"Broadcast"}},"conditions":[{"source":"context","comparison":"equals","variable":"canal","values":["Broadcast"]}]},{"$id":"d3a80ee6-40a5-4c0f-bf0b-41e7b5fab6e4","$typeOfContent":"","type":"SetVariable","$title":"Definir isWorkTime false fim do ano","$invalid":false,"settings":{"variable":"isWorkTime","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2021-12-24","2021-12-31"]},{"source":"context","comparison":"greaterThanOrEquals","variable":"calendar.hour","values":["0"]}]},{"$id":"37865617-018a-4980-a17b-73ef3b665ae5","$typeOfContent":"","type":"MergeContact","$title":"url","$invalid":false,"settings":{"extras":{"url":"{{config.urlHibrido}}{{contact.phoneNumber}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"statusTicket","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e355c3b1-d519-4b6a-b6e5-a61e520a3552","$invalid":false},"$tags":[{"id":"blip-tag-58948d23-877f-49f1-a9d7-2194915e8be8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dce07232-a70a-4d92-8233-d7b8622fa2e9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c4581e5b-1c25-486e-abfc-3a0ba64dd4dc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c5660527-a1de-4c27-a064-ec421867c540","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-6ab8da95-bafd-4870-bf62-a5dd5bcf27d5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","root":false,"$title":"3.0 - API Horário Atendimento","$position":{"top":"373px","left":"90px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"70dd0cfb-e88c-4d35-b7b9-642a02a67aa1":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"2e54a99b-960d-4d86-94d5-897705357167","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2e54a99b-960d-4d86-94d5-897705357167","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"71dbf636-500d-45dc-9670-7d9a9fbe92ed","type":"text/plain","content":"No momento nossos atendentes não estão disponíveis, mas não se preocupe. Caso queira pedir agora, você mesmo pode fazer seu pedido ou agendar uma ligação para o próximo dia útil. Digite o número da opção desejada:\n\n*1* - Quero pedir agora\n*2* - Agendar uma ligação","metadata":{}},"$cardContent":{"document":{"id":"71dbf636-500d-45dc-9670-7d9a9fbe92ed","type":"text/plain","content":"No momento nossos atendentes não estão disponíveis, mas não se preocupe. Caso queira pedir agora, você mesmo pode fazer seu pedido ou agendar uma ligação para o próximo dia útil. Digite o número da opção desejada:\n\n*1* - Quero pedir agora\n*2* - Agendar uma ligação"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"eff385db-c982-487f-9e15-5d4aeab2f6ac","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d40a0a4a-12e1-4733-a3b4-1fead471cecb","$connId":"con_318","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"e2eb4645-3f96-4612-abe5-9d4f5eb2d667"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-40ee24c7-745c-4611-9729-9ace14b3e2c8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-e87111e3-7b1e-48d4-84c5-9dd6dd00175d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"70dd0cfb-e88c-4d35-b7b9-642a02a67aa1","root":false,"$title":"3.1 - Fora de Horário - direciona jornada","$position":{"top":"237px","left":"950px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d40a0a4a-12e1-4733-a3b4-1fead471cecb":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"fe8f78f2-0ebd-492e-8911-424c2879ae19","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fe8f78f2-0ebd-492e-8911-424c2879ae19","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"15fe70b2-6551-40ae-9e89-e6f981e32da4","type":"text/plain","content":"Por favor, escolha o *melhor horário* para que possamos lhe retornar.","metadata":{}},"$cardContent":{"document":{"id":"15fe70b2-6551-40ae-9e89-e6f981e32da4","type":"text/plain","content":"Por favor, escolha o *melhor horário* para que possamos lhe retornar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"77f9ec3b-972b-43f6-ae29-1c93590a218d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"77f9ec3b-972b-43f6-ae29-1c93590a218d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"c793b70d-596a-45fa-a082-75360755407f","type":"text/plain","content":"Qual seria um bom horário?\n\n1- Manhã 8h às 12h\n2- Tarde 12h às 17h\n3- Noite 17h às 19h","metadata":{}},"$cardContent":{"document":{"id":"c793b70d-596a-45fa-a082-75360755407f","type":"text/plain","content":"Qual seria um bom horário?\n\n1- Manhã 8h às 12h\n2- Tarde 12h às 17h\n3- Noite 17h às 19h"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"556ea548-99f2-43b7-b9d5-02d8217702af","type":"text/plain","textContent":"Entrada do usuário","content":"selectedHour"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"selectedHour"},"$invalid":false}],"$conditionOutputs":[{"stateId":"40c615f8-de4d-4fa2-9c14-79c7494af54a","$connId":"con_323","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"6112680c-741e-47cf-8f8f-5ef161b9279a"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"selected Hour","$invalid":false,"settings":{"function":"run","source":"function run(content) {\n\n\tif( (new RegExp(\"1|(manh[aã])\")).test(content) ) return \"manha\";\n\tif( (new RegExp(\"2|(tarde)\")).test(content) ) return \"tarde\";\n\tif( (new RegExp(\"3|(noite)\")).test(content) ) return \"noite\";\n\t\n    return \"nao identificado\";\n}","inputVariables":["selectedHour"],"outputVariable":"selectedHour","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Agenda","$invalid":false,"settings":{"extras":{},"category":"Jornada Agenda","action":"{{contact.name}} - {{phoneNumber}} - {{selectedHour}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-92ae303d-0b2e-41b9-8ab3-350ec69562aa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4e61ce6a-13e8-44b5-9069-19571bcc6282","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-98a9e4ae-27c6-4928-861f-b2f75c778188","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a1ea6e24-ac37-4135-9bae-f9a7b02fec0b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d40a0a4a-12e1-4733-a3b4-1fead471cecb","root":false,"$title":"3.1 Agenda retorno","$position":{"top":"401px","left":"2708px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d58ae7bc-a106-43b4-99e4-cc69210a245c":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"75f14611-1112-4cfc-8583-779d2fd8c404","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"75f14611-1112-4cfc-8583-779d2fd8c404","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"966fe5ad-c19f-42ff-b42f-6c201aeaf12a","type":"text/plain","content":"Ei, estamos aqui! Peça agora a sua Safrapay.","metadata":{}},"$cardContent":{"document":{"id":"966fe5ad-c19f-42ff-b42f-6c201aeaf12a","type":"text/plain","content":"Ei, estamos aqui! Peça agora a sua Safrapay."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"63669785-8b5b-4e23-ba7b-899e71106771","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"22:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"63fa2093-4a96-408b-a35c-dfdb514c349e","$connId":"con_328","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false,"$id":"6b548230-0a85-4131-8f89-c10b29a87b49"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Push 1h","$invalid":false,"settings":{"extras":{},"category":"Push1h","action":"{{calendar.date}} - {{contact.name}} - {{phoneNumber}}"},"conditions":[]},{"$id":"a90a29b0-e08b-40b4-8141-817e490b14da","type":"TrackEvent","$title":"mensagens_de_engajamento","$invalid":false,"settings":{"extras":{},"category":"mensagens_de_engajamento","action":"{{calendar.date}}|{{contact.name}}|{{phoneNumber}}|Push 1"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-ca70a507-f723-492b-92f1-59c1128e0a34","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7b72b67b-f8c5-48d4-a3dc-c3128d7c9db3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-346dcdf6-73f0-498f-b382-cad12f39e677","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d58ae7bc-a106-43b4-99e4-cc69210a245c","root":false,"$title":"Abandono - 1h","$position":{"top":"126px","left":"1425px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"63fa2093-4a96-408b-a35c-dfdb514c349e":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"e386e69b-9055-440e-b10f-66c108f5ad68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e386e69b-9055-440e-b10f-66c108f5ad68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"b8febdef-3b41-41c2-b523-0144dc4b6a57","type":"text/plain","content":"Peça sua Safrapay e aproveite nossas condições imbatíveis! Se tiver interesse, é só falar e fechamos seu pedido por aqui mesmo.","metadata":{}},"$cardContent":{"document":{"id":"b8febdef-3b41-41c2-b523-0144dc4b6a57","type":"text/plain","content":"Peça sua Safrapay e aproveite nossas condições imbatíveis! Se tiver interesse, é só falar e fechamos seu pedido por aqui mesmo."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"65d6df89-9d00-4ff4-bd4e-c1fcd23b90d2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"8db01dc4-f49f-4101-9039-9aec747d5123","$connId":"con_333","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false,"$id":"4674ba56-3b88-4491-8eb3-17029bf0563a"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Push 22h","$invalid":false,"settings":{"extras":{},"category":"Push22h","action":"{{calendar.date}} - {{contact.name}} - {{phoneNumber}}"},"conditions":[]},{"$id":"8aca75d8-8070-451f-a6e4-b6911f8c81fb","type":"TrackEvent","$title":"mensagens_de_engajamento","$invalid":false,"settings":{"extras":{},"category":"mensagens_de_engajamento","action":"{{calendar.date}}|{{contact.name}}|{{phoneNumber}}|Push 2"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-1b574434-f9e7-4bd4-a5b8-dddaef33995b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fb8b3433-a971-4c65-b16f-ba0edd2699e3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-f8191341-90cf-40bf-8152-457316420e38","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"63fa2093-4a96-408b-a35c-dfdb514c349e","root":false,"$title":"Abandono - 22h","$position":{"top":"125px","left":"1625px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8db01dc4-f49f-4101-9039-9aec747d5123":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"423c3381-3035-4f4e-817d-84384696e4b0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Abandono","$invalid":false,"settings":{"extras":{},"category":"Abandono","action":"{{calendar.date}} - {{contact.name}} - {{phoneNumber}} - VPO Facebook Instagram WA"},"conditions":[]},{"$id":"7259bf6f-85d4-4287-8d3b-30c6b13b28cc","type":"TrackEvent","$title":"mensagens_de_engajamento","$invalid":false,"settings":{"extras":{},"action":"{{calendar.date}}|{{contact.name}}|{{phoneNumber}}|Abandono","category":"mensagens_de_engajamento"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$invalid":false},"$tags":[{"id":"blip-tag-2a958e64-6f32-4658-af80-03b16e57fb3e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0e8976f7-ee1e-44cf-9f44-64c36d88593b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"8db01dc4-f49f-4101-9039-9aec747d5123","root":false,"$title":"Lead - Abandono","$position":{"top":"123px","left":"1825px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"40c615f8-de4d-4fa2-9c14-79c7494af54a":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"371f772e-0f8f-49a4-aa09-e8ecbd179edb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"371f772e-0f8f-49a4-aa09-e8ecbd179edb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"3f57a765-b744-4860-a79d-81f5e33954f6","type":"text/plain","content":"O seu contato foi agendado. Até mais!","metadata":{}},"$cardContent":{"document":{"id":"3f57a765-b744-4860-a79d-81f5e33954f6","type":"text/plain","content":"O seu contato foi agendado. Até mais!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a3292a6a-9716-4e52-b656-5eb58de6fdf2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","$connId":"con_338","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"ac93ef78-dc10-4258-98b1-25c1061d6eba"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-332e18af-fe3f-4207-bfe9-34742fcc87e5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ae9e1d62-b5df-4d41-9d3d-61680d4ff21d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"40c615f8-de4d-4fa2-9c14-79c7494af54a","root":false,"$title":"Agendado","$position":{"top":"284px","left":"2711px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6d70355c-9d60-4bbe-ab6b-2331191ea2af":{"$contentActions":[{"action":{"$id":"b59e823f-8dc4-4cf8-8f81-bf5c510ea42a","type":"SendMessage","settings":{"id":"786fe196-d5a2-49c9-b68b-75a24b536f38","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"786fe196-d5a2-49c9-b68b-75a24b536f38","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b0738213-95a5-4195-b67a-1b25211fe076","type":"SendMessage","settings":{"id":"2fdf1912-abe4-4a05-80a8-2ab9a399c4f9","type":"text/plain","content":"{{texto}}","metadata":{}},"$cardContent":{"document":{"id":"2fdf1912-abe4-4a05-80a8-2ab9a399c4f9","type":"text/plain","content":"{{texto}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5072d6d2-5f10-46e1-bc1e-4429ea79d796","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cbf87e40-08d0-4ffe-a9f7-8efa220f6aa5","$connId":"con_343","$id":"08bbcad9-10ea-41f3-9b7b-06a1fbdc72dd","conditions":[{"source":"context","comparison":"equals","values":["VPO - Credenciamento com Sucesso"],"variable":"returnTags"}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"27420c0b-9381-4ceb-85d9-b473676bf541","type":"ExecuteScript","$title":"JS - Define texto","$invalid":false,"settings":{"function":"run","source":"\n            function run(tag) {\n\n\n                if (tag == \"VPO - Já cliente Safrapay com EC\")\n                return\n                `Nosso atendimento, por esse número é exclusivo para clientes que desejam adquirir a máquina Safrapay e identificamos que o Sr(a) já é um cliente Safrapay! \n\n                Por isso, pedimos a gentileza entrar em contato no nosso Atendimento Whatsapp Safrapay https://bit.ly/2R3ZENg, selecionando a opção que melhor atenda a sua necessidade (de 03 a 05) e identificando-se com o seu CPF. Será um prazer atendê-lo!`\n                \n                if (tag == \"VPO - Autônomo ou indicação CSI\")\n                return \n                `Nosso atendimento, por esse número é exclusivo para clientes que desejam adquirir a máquina Safrapay  e identificamos que o Sr(a) já é um cliente Safrapay indicado por um Autônomo Safrapay! \n\n                Por isso, pedimos a gentileza entrar em contato no nosso Atendimento Whatsapp Safrapay https://bit.ly/2R3ZENg, selecionando a opção 02. Será um prazer atendê-lo!`\n               \n                if (tag == \"VPO - Credenciamento com Sucesso\")\n                return\n                `Bem vindo ao SafraPay, é um enorme prazer tê-lo como cliente. Em até 1 hora, você receberá a confirmação do cadastro, baixe o aplicativo SafraPay Digital, lá você encontrará todas os serviços para realizar a gestão de suas vendas. `\n               \n                if (tag == \"VPO - Consignado\")\n                return\n               `Nosso atendimento, por esse número é exclusivo para clientes que desejam adquirir a máquina Safrapay para atender sua solicitação, veja nossos canais de contato:\n               \n               ☑ Consultar um contrato entre em contato com a Safra Financeira no telefone: 0300 151 1234 ou no WhatsApp https://bit.ly/3eWfQJV, de Seg a Sex das 8h às 19h. \n               \n               ☑ Realizar uma nova contratação pelo WhatsApp https://bit.ly/2QtaCf3`\n               \n                if (tag == \"VPO - Fraude de Crédito\")\n                return\n                `Identificamos com o seu CPF/CNPJ fornecido, que o Sr(a) ainda não é cliente do Banco Safra. \n               \n                Nossas ofertas de Crédito são sempre para já clientes, portanto identificamos que a mensagem recebida pelo Sr(a) é uma fraude. \n                Caso tenha realizado algum pagamento (Decore ou Boleto), pedimos que nos encaminhe o comprovante do depósito para que possamos investigar mais a fundo. \n                \n                Agradecemos o seu contato e o envio da mensagem recebida em nome do Banco Safra, pois com essa evidência, iremos tomar as devidas ações junto aos Órgãos e Empresas responsáveis, para que mais nenhum cliente seja vítima de fraudes como essa. \n                Continuamos à sua disposição, caso tenha interesse em se tornar um cliente Safra ou Safrapay!`\n\n            return \"\";\n\n                }","inputVariables":["returnTags"],"outputVariable":"texto","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","$invalid":false},"$tags":[{"id":"blip-tag-289aeac0-0f38-456f-964d-06e069439962","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d38cf7ab-6f8d-44b4-aac6-1a4e72a4a601","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6d70355c-9d60-4bbe-ab6b-2331191ea2af","root":false,"$title":"mensagem_por_tag","$position":{"top":"1193px","left":"531px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3f535931-ae2c-4b70-b5d5-d5cd84816c71":{"$contentActions":[{"action":{"$id":"e74d8d76-7c42-421b-afd2-6916c69751a8","type":"SendMessage","settings":{"id":"f3b756c8-cf77-4d03-aa63-5335c0cbdff3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f3b756c8-cf77-4d03-aa63-5335c0cbdff3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b41d79bc-33e8-49f5-a554-a6c01d17f28f","type":"SendMessage","settings":{"id":"a75c9ed0-d356-4c61-a66b-368b54f0fad9","type":"text/plain","content":"Oi, percebi que *não foi possível continuar nossa conversa* nesse momento 😊 dessa maneira, *finalizo esse atendimento* e aguardo o seu retorno.\n\n*Até breve!* 😉","metadata":{}},"$cardContent":{"document":{"id":"a75c9ed0-d356-4c61-a66b-368b54f0fad9","type":"text/plain","content":"Oi, percebi que *não foi possível continuar nossa conversa* nesse momento 😊 dessa maneira, *finalizo esse atendimento* e aguardo o seu retorno.\n\n*Até breve!* 😉"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"07cbf8a0-24c1-47ba-a8ac-90951b4d1f3b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"565c561f-7ec3-4009-b24d-5ced68c305d9","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"\n            function run(estadoAnterior) {\n\n\n                frase = estadoAnterior == \"aguarda_input_3_horas_tag_em_atendimento\"  ? `Oi, percebi que *não foi possível continuar nossa conversa* nesse momento 😊 dessa maneira, *finalizo esse atendimento* e aguardo o seu retorno.\n\n*Até breve!* 😉` : \"\"\n                return frase\n            }","inputVariables":["state.previous.name"],"outputVariable":"texto","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8db01dc4-f49f-4101-9039-9aec747d5123","$invalid":false},"$tags":[{"id":"blip-tag-317127fd-4313-471f-b88f-024ff0cff90b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c2cc557-2e17-4547-ab6c-eb84805159e9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3f535931-ae2c-4b70-b5d5-d5cd84816c71","root":false,"$title":"aguarda_input_sem_inatividade","$position":{"top":"1039.25px","left":"1511px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e7f458b9-6c56-4955-b422-f4e8ef3bbb83":{"$contentActions":[{"action":{"$id":"8b760f01-a609-436f-b532-5f7804956879","type":"SendMessage","settings":{"id":"38bf9fdd-70c0-42f3-8af8-b98b60b6d594","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"38bf9fdd-70c0-42f3-8af8-b98b60b6d594","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d64b28a9-fd80-423c-b628-cf9b2ab2eaa1","type":"SendMessage","settings":{"id":"cb98d72d-dc75-4271-9479-565e9e6a903e","type":"text/plain","content":"Ainda estou por aqui, venha aproveitar as nossas ofertas!😃","metadata":{}},"$cardContent":{"document":{"id":"cb98d72d-dc75-4271-9479-565e9e6a903e","type":"text/plain","content":"Ainda estou por aqui, venha aproveitar as nossas ofertas!😃"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"07cbf8a0-24c1-47ba-a8ac-90951b4d1f3b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"3:0"},"$invalid":false}],"$conditionOutputs":[{"$id":"5af6bf7b-c457-4b36-9be6-9fda99a3a239","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false,"stateId":"dcedaeae-45dd-4603-bb7f-3a1515e1b761","$connId":"con_348"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$invalid":false},"$tags":[{"id":"blip-tag-6f405dc2-c167-4132-a58f-79cccc416e12","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-991e302b-532e-480a-9b63-438e1ec20f67","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e7f458b9-6c56-4955-b422-f4e8ef3bbb83","root":false,"$title":"aguarda_input_3_horas_tag_em_atendimento","$position":{"top":"879px","left":"1510.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dcedaeae-45dd-4603-bb7f-3a1515e1b761":{"$contentActions":[{"action":{"$id":"8b760f01-a609-436f-b532-5f7804956879","type":"SendMessage","settings":{"id":"38bf9fdd-70c0-42f3-8af8-b98b60b6d594","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"38bf9fdd-70c0-42f3-8af8-b98b60b6d594","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d64b28a9-fd80-423c-b628-cf9b2ab2eaa1","type":"SendMessage","settings":{"id":"cb98d72d-dc75-4271-9479-565e9e6a903e","type":"text/plain","content":"O melhor está aqui! Vamos finalizar seu pedido?","metadata":{}},"$cardContent":{"document":{"id":"cb98d72d-dc75-4271-9479-565e9e6a903e","type":"text/plain","content":"O melhor está aqui! Vamos finalizar seu pedido?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"07cbf8a0-24c1-47ba-a8ac-90951b4d1f3b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"2:0"},"$invalid":false}],"$conditionOutputs":[{"$id":"fe91f97d-823c-43af-bd72-090cd68d5f64","conditions":[{"source":"input","comparison":"notExists","values":[]},{"source":"context","comparison":"equals","variable":"state.previous.name","values":["aguarda_input_3_horas_tag_em_atendimento"]}],"$invalid":false,"stateId":"3f535931-ae2c-4b70-b5d5-d5cd84816c71","$connId":"con_353"},{"$id":"5af6bf7b-c457-4b36-9be6-9fda99a3a239","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false,"stateId":"e7f458b9-6c56-4955-b422-f4e8ef3bbb83","$connId":"con_358"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$invalid":false},"$tags":[{"id":"blip-tag-e4e64c23-379e-4287-be56-2b25df746cca","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-f1d81326-afa1-4489-ad4b-41afc23929e9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"dcedaeae-45dd-4603-bb7f-3a1515e1b761","root":false,"$title":"aguarda_input_2_horas_tag_em_atendimento","$position":{"top":"721.75px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"af9f335c-a0a7-4710-9e08-03a2e2ee51ee":{"$contentActions":[{"action":{"$id":"8b760f01-a609-436f-b532-5f7804956879","type":"SendMessage","settings":{"id":"38bf9fdd-70c0-42f3-8af8-b98b60b6d594","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"},"metadata":{}},"$cardContent":{"document":{"id":"38bf9fdd-70c0-42f3-8af8-b98b60b6d594","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d64b28a9-fd80-423c-b628-cf9b2ab2eaa1","type":"SendMessage","settings":{"id":"cb98d72d-dc75-4271-9479-565e9e6a903e","type":"text/plain","content":"Olá, tudo bem? Gostaria de te contar algumas novidades! Temos a taxa e a máquina ideal para o seu negócio! Vamos continuar o nosso bate-papo? É só me mandar um Oi!","metadata":{}},"$cardContent":{"document":{"id":"cb98d72d-dc75-4271-9479-565e9e6a903e","type":"text/plain","content":"Olá, tudo bem? Gostaria de te contar algumas novidades! Temos a taxa e a máquina ideal para o seu negócio! Vamos continuar o nosso bate-papo? É só me mandar um Oi!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"07cbf8a0-24c1-47ba-a8ac-90951b4d1f3b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"$id":"5af6bf7b-c457-4b36-9be6-9fda99a3a239","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false,"stateId":"dcedaeae-45dd-4603-bb7f-3a1515e1b761","$connId":"con_363"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$invalid":false},"$tags":[{"id":"blip-tag-d95c9891-ad44-4cca-a78d-cd1a3906752c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0d300ba7-ee6b-4642-a869-f67469aa7d02","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"af9f335c-a0a7-4710-9e08-03a2e2ee51ee","root":false,"$title":"aguarda_input_30_minutos_tag_em_atendimento","$position":{"top":"568.75px","left":"1510.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bda2cc66-062d-4805-9af6-505bddd0ee86":{"$contentActions":[{"action":{"$id":"f9ffdb33-972e-4559-8e9e-dc6d24d232ae","type":"SendMessage","settings":{"id":"01527578-78df-49cf-b047-17f4cbbfd27a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"01527578-78df-49cf-b047-17f4cbbfd27a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d054916f-5337-404f-b65f-400a51990185","type":"SendMessage","settings":{"id":"505c0e7f-c5a7-4e4f-a08a-b16c773c473e","type":"text/plain","content":"{{texto}}","metadata":{}},"$cardContent":{"document":{"id":"505c0e7f-c5a7-4e4f-a08a-b16c773c473e","type":"text/plain","content":"{{texto}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"694fb8d3-f2e1-4b6d-bfe5-7a0f1b66328b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"23:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","$connId":"con_368","$id":"3853abd2-60bd-4e24-ba46-74bb0500b10f","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"sabado"}],"$invalid":false},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_373","$id":"a253ebc4-066f-4ffb-ae89-c7d1ac0b6423","conditions":[{"source":"context","comparison":"equals","values":["bandono_antes_step23_step1","recusa_step1","abandono_pos_step23_step1_com_imagem","erros_discador","nao_cpc","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_texto_cash_back","mktdisplay_generico1"],"variable":"contact.extras.broadcastOrigem"},{"source":"input","comparison":"equals","values":["sim"]}],"$invalid":false},{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_378","$id":"6e7ea9b7-cbf0-4127-b04c-5ffe065ed865","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_1_imagem","spprodmarketingwhatsapp_remkt_2_imagem","spprodmarketingwhatsapp_remkt_2","spprodmarketingwhatsapp_remkt_1"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"af9f335c-a0a7-4710-9e08-03a2e2ee51ee","$connId":"con_383","$id":"ceebd191-ea68-4f4c-81ed-06de8bb3a7da","conditions":[{"source":"input","comparison":"notExists","values":[],"variable":"sabado"},{"source":"context","comparison":"equals","variable":"returnTags","values":["VPO - Agendamento","VPO - Cliente avaliando proposta"]},{"source":"context","comparison":"equals","variable":"statusAtendimento","values":["true"]},{"source":"context","comparison":"equals","variable":"isDayEquals","values":["true"]}],"$invalid":false},{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","$connId":"con_388","$id":"877a4ead-ac35-4ff5-84d0-2e9469906dcf","conditions":[{"source":"context","comparison":"equals","variable":"statusAtendimento","values":["true"]},{"source":"context","comparison":"equals","variable":"returnTags","values":["VPO - Agendamento","VPO - Cliente avaliando proposta"]}],"$invalid":false},{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","typeOfStateId":"state","$connId":"con_393","$id":"3935fe7f-aa9c-49cf-9033-d83732d66a20","conditions":[{"source":"input","comparison":"notExists","values":[]},{"source":"context","comparison":"equals","variable":"statusAtendimento","values":["true"]},{"source":"context","comparison":"equals","variable":"returnTags","values":["VPO - Agendamento","VPO - Cliente avaliando proposta"]},{"source":"context","comparison":"equals","variable":"isDayEquals","values":["false"]}],"$invalid":false},{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","$connId":"con_398","$id":"e4a7cac8-b1e2-48c6-a042-9319381dc98f","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"statusAtendimento"}],"$invalid":false},{"stateId":"af9f335c-a0a7-4710-9e08-03a2e2ee51ee","$connId":"con_403","$id":"4e4a1c57-b1c0-4dce-9d74-b21ea2253a38","conditions":[{"source":"input","comparison":"notExists","values":[]},{"source":"context","comparison":"equals","variable":"statusAtendimento","values":["true"]}],"$invalid":false},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_408","$id":"0c828345-cd31-4e1f-a36d-4ea800ca7b81","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"statusAtendimento"},{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bf5ef438-0690-444d-8c33-f3a47c6cf236","type":"ExecuteScript","$title":"JS - DEFINE ATENDIMENTO ABERTO","$invalid":false,"settings":{"function":"run","source":"var DEFAULT_OFFSET = 3;\nfunction run() {\n   \n\n    try {\n\n            let data = new Date();\n        let dayMonth = data.getDate();\n        let dayWeek = data.getDay();\n        let convertHours = (data.getUTCHours() - DEFAULT_OFFSET) < 0 ? (data.getUTCHours() - DEFAULT_OFFSET) + 24 : (data.getUTCHours() - DEFAULT_OFFSET);\n        let hours = convertHours < 10 ? '0' + convertHours : convertHours;\n        let minutes = data.getMinutes() < 10 ? '0' + data.getMinutes() : data.getMinutes();\n        let hoursAndMinutes = hours + \":\" + minutes;\n        let canalSelecionado = 'default';\n        let channel = 0\n        let week = { \"start\": \"08:00\", \"end\": \"19:00\" };\n\n        let objRules = {\n            \"rules\": [{ \"default\": [null, week, week, week, week, week, null] }]\n        }      \n    \n        if (objRules.rules[channel][canalSelecionado][dayWeek] == null) {\n            return false\n        } else {\n            let resultDay = objRules.rules[channel][canalSelecionado][dayWeek]\n            return hoursAndMinutes >= resultDay.start && hoursAndMinutes <= resultDay.end\n        }\n    }\n    catch (e) {\n        return e;\n    }\n}","inputVariables":[],"outputVariable":"statusAtendimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"259e6081-a9bf-4083-be7c-cd99dac31239","type":"TrackEvent","$title":"aguarda_abertura_do_canal","$invalid":false,"settings":{"extras":{},"category":"aguarda_abertura_do_canal","action":"{{calendar.date}}|{{contact.phoneNumber}}"},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"diaSaida"}]},{"$id":"75a36bd2-d81d-4668-a87a-8e3a2a34a432","type":"ExecuteScript","$title":"JS - DEFINE FORADOHORARIOMESMODIA","$invalid":false,"settings":{"function":"run","source":"\nfunction run(hora) {\n\nlet horaBrasil = hora - 3\n\n    if (horaBrasil > \"0\" || horaBrasil < \"8\")\n        return \"true\";\n\n        return hora\n}\n","inputVariables":["calendar.hour"],"outputVariable":"foraDoHorarioMesmoDia","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6245d413-6ddc-4373-b897-73b73c818d4b","$typeOfContent":"","type":"SetVariable","$title":"Definir statusAtendimento feriado","$invalid":false,"settings":{"variable":"statusAtendimento","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2021-11-02","2021-11-15","2021-12-25"]}]},{"$id":"a69ef622-5ff4-459a-bb19-792efb2cd5e7","type":"SetVariable","$title":"diaEntrada","$invalid":false,"settings":{"variable":"diaEntrada","value":"{{calendar.day}}"},"conditions":[{"source":"context","comparison":"equals","variable":"foraDoHorarioMesmoDia","values":["true"]}]},{"$id":"8ee8d912-a1aa-45e1-b033-f0f5a95c1174","type":"SetVariable","$title":"clienteEngamentoForaHorario","$invalid":false,"settings":{"variable":"clienteEngamentoForaHorario","value":"true"},"conditions":[]},{"$id":"f7a8be27-85be-47b0-86c4-f6123aa69667","type":"TrackEvent","$title":"transbordo_por_engajamento_v2","$invalid":false,"settings":{"extras":{},"category":"transbordo_por_engajamento_v2","action":"{{dataAtual}}|{{phoneNumber}}"},"conditions":[{"source":"context","comparison":"equals","variable":"state.previous.name","values":["3.0 - API Horário Atendimento"]}]},{"$id":"447f8333-63f8-466b-934b-0224234e8d3b","$typeOfContent":"","type":"ExecuteScript","$title":"Define texto","$invalid":false,"settings":{"function":"run","source":"\nfunction run(hoje, amanha) {\n\n    let fimDeSemana = hoje == \"Saturday\" || amanha == \"Saturday\" ? \"true\" : \"false\"\n\n    let textoExibido = fimDeSemana == \"true\" ? \"Por favor, retorne dentro desse horário.\" : \"Mas, não se preocupe retornaremos o contato assim que nosso atendimento estiver online. 😉\"\n\n    let texto =\n`Nosso horário de atendimento é de segunda a sexta das 08:00 às 19:00 hrs (exceto feriados *nacionais*).\n\n${textoExibido}\n\nObrigado!`\n\n    return texto\n}","inputVariables":["calendar.dayOfWeek","calendar.tomorrow.dayOfWeek","respostaNaoExiste"],"outputVariable":"texto","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"state.previous.name","values":["3.0 - API Horário Atendimento","6.0 - Atendimento Finalizado"]}]},{"$id":"71dd78d0-a7f3-4f61-88eb-db2d5458989f","$typeOfContent":"","type":"ExecuteScript","$title":"Define texto retorno","$invalid":false,"settings":{"function":"run","source":"\nfunction run(hoje, amanha) {\n\n    let texto =\n`Nosso horário de atendimento é de segunda a sexta das 08:00 às 19:00 hrs (exceto feriados *nacionais*).\n\nMas, não se preocupe retornaremos o contato assim que nosso atendimento estiver online. 😉\n\nObrigado!`\n\n    return texto\n}","inputVariables":["calendar.dayOfWeek","calendar.tomorrow.dayOfWeek"],"outputVariable":"texto","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"estadoSaida","values":["aguarda_abertura_canal"]},{"source":"input","comparison":"exists","values":[]}]},{"$id":"2aacc538-cd7c-479b-a9fb-761907901ab7","$typeOfContent":"","type":"ExecuteScript","$title":"Define Sábado","$invalid":false,"settings":{"function":"run","source":"function run(hoje, amanha) {\n\n    const sabado = (hoje == \"Saturday\" || amanha == \"Saturday\" || hoje == \"Sunday\" || amanha == \"Sunday\") ? \"true\" : \"false\"\n        return sabado\n}\n","inputVariables":["calendar.dayOfWeek","calendar.tomorrow.dayOfWeek"],"outputVariable":"sabado","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"f3d2c772-58e8-4249-9e33-5fbbbe33e1a6","type":"SetVariable","$title":"diaSaida","$invalid":false,"settings":{"variable":"diaSaida","value":"{{calendar.day}}"},"conditions":[]},{"$id":"735f820e-da7c-4466-9cac-17d1740e0d90","type":"ExecuteScript","$title":"JS - DEFINE ISDAYEQUALS","$invalid":false,"settings":{"function":"run","source":"\nfunction run(data1, data2) {\n    return data1 === data2;\n\n}","inputVariables":["diaEntrada","diaSaida"],"outputVariable":"isDayEquals","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2d55befe-9a1a-42e4-9de4-c8dac243b7d3","type":"SetVariable","$title":"ISDAYEQUALS FALSE","$invalid":false,"settings":{"variable":"isDayEquals","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"foraDoHorarioMesmoDia","values":["true"]}]},{"$id":"3e192d3a-41ae-4026-94a9-322ff55ba2a8","$typeOfContent":"","type":"SetVariable","$title":"Definir estadoSaida","$invalid":false,"settings":{"variable":"estadoSaida","value":"aguarda_abertura_canal"},"conditions":[]},{"$id":"9b67eb31-748c-4875-920f-4ba08c170dad","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"bloco":"{{state.name}}"}},"conditions":[]},{"$id":"db6d7494-c189-4041-82f8-4ca74d6529ec","$typeOfContent":"","type":"SetVariable","$title":"Definir texto expira","$invalid":false,"settings":{"variable":"texto","expiration":1},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"bda2cc66-062d-4805-9af6-505bddd0ee86","$invalid":false},"$tags":[{"id":"blip-tag-9730ca8e-f68e-4cbd-9e1c-a54e14c55ed4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f4987a8c-478b-4ad0-91cd-915022d0b783","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e5f53245-a5c0-4cd4-abe4-148af7774da6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-301f4fae-7954-4c5f-960e-0a4103b17cc5","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-8772a6ca-554f-437d-bc14-46d24943e234","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-41749292-81dc-4716-83b9-0e9ba5fb8084","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bda2cc66-062d-4805-9af6-505bddd0ee86","root":false,"$title":"aguarda_abertura_canal","$position":{"top":"435px","left":"1508.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bbdb851e-59e3-4201-a029-36a7ddca1a54":{"$contentActions":[{"action":{"$id":"b4a56750-8a09-45da-9eb8-3fa6de072fa1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"417aabc1-a60a-4f4d-85ab-a1b675fc128e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"417aabc1-a60a-4f4d-85ab-a1b675fc128e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d391f2a1-e883-4e8f-92ee-b36333340f21","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f1799494-c234-46f1-a524-33b0c1592316","type":"text/plain","content":"Tudo bem, estamos à disposição! Lembramos que, com a SafraPay, *você tem a solução completa para vender e receber em 1 dia com taxas a partir de 1,68%, com Conta Digital e Cartão SafraPay para saques e pagamentos*. Aproveite essa oportunidade. Estamos prontos para atender você de segunda a sexta, das 8h às 19h (exceto feriados).","metadata":{}},"$cardContent":{"document":{"id":"f1799494-c234-46f1-a524-33b0c1592316","type":"text/plain","content":"Tudo bem, estamos à disposição! Lembramos que, com a SafraPay, *você tem a solução completa para vender e receber em 1 dia com taxas a partir de 1,68%, com Conta Digital e Cartão SafraPay para saques e pagamentos*. Aproveite essa oportunidade. Estamos prontos para atender você de segunda a sexta, das 8h às 19h (exceto feriados)."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"fd4347f3-113a-4053-be9b-9289cb473267","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false},"$tags":[{"id":"blip-tag-abfaed82-164f-4c7b-bc37-15bf196d22e5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-76a3340d-3142-4ff5-934f-6b588065e226","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bbdb851e-59e3-4201-a029-36a7ddca1a54","root":false,"$title":"negativa_no_broadcast","$position":{"top":"1501px","left":"310px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"496b8547-e582-4429-bbcf-d5f08c0469f5":{"$contentActions":[{"action":{"$id":"11bc7dae-11f7-437b-8301-c96a16e5a64a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a01dc265-2558-4645-88be-c521697a29ee","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a01dc265-2558-4645-88be-c521697a29ee","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d1a18701-5b9e-4b24-9454-a7d670971a9d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9527e223-cd79-4163-8bae-97baa41c90c0","type":"text/plain","content":"Oi tudo bem? Senti sua falta em interagir comigo, por esse motivo o contato será encerrado, mas ficarei feliz em retomar o pedido da sua máquina, é só dar um \"Oi\" 😀!","metadata":{}},"$cardContent":{"document":{"id":"9527e223-cd79-4163-8bae-97baa41c90c0","type":"text/plain","content":"Oi tudo bem? Senti sua falta em interagir comigo, por esse motivo o contato será encerrado, mas ficarei feliz em retomar o pedido da sua máquina, é só dar um \"Oi\" 😀!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"32c242e2-fd3e-4dc9-a6a1-f48a3f181c2f","type":"text/plain","textContent":"User input","content":"InputIniciarRetorno"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"InputIniciarRetorno"},"$invalid":false}],"$conditionOutputs":[{"stateId":"8f4a89e9-078f-4b57-aa98-28ab9174f7b5","$connId":"con_413","$id":"5554661e-6238-45f2-879e-edb94d74bbc0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"8f1c7272-06a7-46d0-88eb-ae7299b55b11","$typeOfContent":"","type":"SetVariable","$title":"retorno","$invalid":false,"settings":{"variable":"retorno","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-58e2628a-0dde-4c88-af5e-b7fbd0b38c6f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-445b6251-07c1-4565-91f2-535ee4b6db0e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-1f3ae727-8ba5-4140-8e75-f690c761c288","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"496b8547-e582-4429-bbcf-d5f08c0469f5","root":false,"$title":"Mensagem inatividade cliente","$position":{"top":"1197px","left":"751px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8f4a89e9-078f-4b57-aa98-28ab9174f7b5":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"3b80e642-876d-4a15-a794-a27cfb6c7689","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3b80e642-876d-4a15-a794-a27cfb6c7689","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"051045b7-2ac7-4a80-ac97-f7f21d89c7fe","type":"text/plain","content":"Agradecemos o seu contato. Quando precisar, é só digitar *1* para começar uma nova conversa."},"$cardContent":{"document":{"id":"051045b7-2ac7-4a80-ac97-f7f21d89c7fe","type":"text/plain","content":"Agradecemos o seu contato. Quando precisar, é só digitar *1* para começar uma nova conversa."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1479be51-d5b6-41f3-97b6-c6867f60a417","type":"text/plain","content":"InputIniciarRetorno"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"InputIniciarRetorno","expiration":"22:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbdb851e-59e3-4201-a029-36a7ddca1a54","$connId":"con_418","$id":"04cfd766-7142-4a46-9784-72e9e22b515f","conditions":[{"source":"input","comparison":"equals","values":["não","nao"]},{"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem","values":["spprodmarketingwhatsapp_remkt_2_texto_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","spprodmarketingwhatsapp_remkt_1_texto_cash_back"]}],"$invalid":false},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","$connId":"con_423","$id":"98d938f1-672f-4bc2-9ba1-9548ef04a5ea","conditions":[{"source":"context","comparison":"equals","values":["spprodmarketingwhatsapp_remkt_2_texto_cash_back","spprodmarketingwhatsapp_remkt_1_imagem_cash_back","spprodmarketingwhatsapp_remkt_2_imagem_cash_back","mktdisplay_engajamento_1","mktdisplay_generico1","mkt_safra_generica2"],"variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"af9f335c-a0a7-4710-9e08-03a2e2ee51ee","typeOfStateId":"state","$connId":"con_428","$id":"b4d09c4e-17b4-404e-bde9-0ad51cfa4740","conditions":[{"source":"input","comparison":"notExists","values":[]},{"source":"context","variable":"sabado","comparison":"equals","values":["false"]}],"$invalid":false},{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_433","$id":"15edf052-84d0-4209-b4ca-427f4760171a","conditions":[{"source":"input","comparison":"notExists","values":[]},{"source":"context","comparison":"equals","variable":"sabado","values":["true"]}],"$invalid":false},{"stateId":"ee1cf003-8ada-4012-b9d3-7b584e40fef0","$connId":"con_438","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"451e479f-42bb-4542-88f0-eb0d46108a79"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Finalizacao do feedback do atendimento organico","$invalid":false,"settings":{"extras":{"IdMessage":"{{input.message@id}}","IdUser":"{{contact.identity}}","UserName":"{{contact.name}}","LastTrack":"{{lastTrack}}","Score":"{{score}}","TicketTag":"{{ticketTags}}","TicketNumber":"{{ticketNumber}}","TicketAttendant":"{{ticketAgentIdentity}}","TicketOpenDate":"{{ticketOpenDate}}","idMessage":"{{input.message@id}}","idUser":"{{contact.identity}}"},"category":"Finalizacao do feedback do atendimento organico","action":"Exibicao"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada","$invalid":false,"settings":{"extras":{},"category":"Jornada","action":"Step 5 - Conversa Finalizada"},"conditions":[]},{"type":"TrackEvent","$title":"Jornada Detalhada","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{contact.name}}|{{canalSelecionado}}|{{agentEmail}}|{{returnTags}}","category":"Jornada Detalhada"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]},{"type":"TrackEvent","$title":"Jornada Retorno","$invalid":false,"settings":{"extras":{},"action":"{{phoneNumber}}|{{agentEmail}}|{{returnTags}}|{{duvidaRetorno}}|{{returnTags}}}}","category":"Jornada Retorno"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"phoneNumber"}]},{"type":"TrackEvent","$title":"Digitou NPS inválido","$invalid":false,"settings":{"extras":{},"category":"Digitou NPS inválido","action":"Quantidade"},"conditions":[{"source":"context","comparison":"equals","variable":"npsinvalido","values":["3"]}]},{"$id":"1987bb9a-4111-405e-9b4e-9360f018982c","type":"SetVariable","$title":"retorno","$invalid":false,"settings":{"variable":"retorno","value":"true"},"conditions":[]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"campanha":"Retorno {{campanha}}","broadcastOrigem":"-"},"name":"{{contact.name}}","phoneNumber":"{{phoneNumber}}"},"conditions":[]},{"$id":"f4158db9-1661-4478-aa0b-8ef81fda5f4e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sabado\"","$invalid":false,"settings":{"function":"run","source":"function run(hoje, amanha) {\n\n    const sabado = (hoje == \"Saturday\" || amanha == \"Saturday\") ? \"true\" : \"false\"\n        return sabado\n}\n","inputVariables":["calendar.dayOfWeek","calendar.tomorrow.dayOfWeek"],"outputVariable":"sabado","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$tags":[{"background":"#232d11","label":"User Input","id":"blip-tag-ba80e21e-7e32-11e9-8f9e-2a86e4085a59","canChangeBackground":false},{"id":"blip-tag-ceab5f41-98cd-4fff-af7d-056a63e65b6c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c681b6dd-f8a3-48b1-964e-36b95163d438","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-30ef87c2-9b88-49c9-8890-96b7e41b2bec","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-8f244a80-333d-4849-aab5-03021083fd7f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-47f69ed8-bc93-4c5f-90bc-b56edefd2074","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-660c821d-f3b4-40a0-a3ae-c7ece2078b54","label":"UserInput","background":"#000000","canChangeBackground":false}],"$defaultOutput":{"stateId":"df6ee81c-6531-47f3-b366-0cbd31e43a01","$invalid":false},"id":"8f4a89e9-078f-4b57-aa98-28ab9174f7b5","root":false,"$title":"6.2 - Agendamento","$position":{"top":"851px","left":"977px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1863f01-733e-494a-9199-f3251302e041":{"$contentActions":[{"action":{"$id":"5628530b-1b6a-479f-b932-c3dbdf8b6122","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"74b91728-71b1-4204-b1f8-61f6390d64a8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"74b91728-71b1-4204-b1f8-61f6390d64a8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1a2a2973-4d4f-48cb-bce7-e2f320971163","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9b9c6a1a-7752-4a7e-b218-ca90ff11c511","type":"text/plain","content":"Nosso atendimento, por esse número é exclusivo para clientes que desejam adquirir a máquina Safrapay e identificamos que o Sr(a) já é um cliente Safrapay!\n\n\nPor isso, pedimos a gentileza entrar em contato no nosso Atendimento Whatsapp Safrapay https://bit.ly/2R3ZENg, selecionando a opção que melhor atenda a sua necessidade (de 03 a 05) e identificando-se com o seu CPF. Será um prazer atendê-lo!","metadata":{}},"$cardContent":{"document":{"id":"9b9c6a1a-7752-4a7e-b218-ca90ff11c511","type":"text/plain","content":"Nosso atendimento, por esse número é exclusivo para clientes que desejam adquirir a máquina Safrapay e identificamos que o Sr(a) já é um cliente Safrapay!\n\n\nPor isso, pedimos a gentileza entrar em contato no nosso Atendimento Whatsapp Safrapay https://bit.ly/2R3ZENg, selecionando a opção que melhor atenda a sua necessidade (de 03 a 05) e identificando-se com o seu CPF. Será um prazer atendê-lo!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9a1292e5-62db-40f0-966e-a1036dfcd574","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1863f01-733e-494a-9199-f3251302e041","typeOfStateId":"state","$connId":"con_443","$id":"b116a501-e471-4faf-bcf9-99b8882e3228","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7e043550-2fe5-4861-8721-58fabea9b59c","$typeOfContent":"","type":"TrackEvent","$title":"contato_com_ec","$invalid":false,"settings":{"extras":{},"category":"contato_com_ec","action":"{{contact.phoneNumber}}"},"conditions":[{"source":"input","comparison":"notEquals","values":["#teste"]},{"comparison":"exists","source":"context","values":[],"variable":"contact.phoneNumber"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a1863f01-733e-494a-9199-f3251302e041","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-c71f063f-559b-425d-945c-ad1a3a5b913c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9bcac01c-95d5-4484-a4c1-8063453ccca4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-fb60d727-e706-4c79-b031-6063cb250738","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a1863f01-733e-494a-9199-f3251302e041","root":false,"$title":"10.2 - Mensagem para TAG com EC","$position":{"top":"1662px","left":"312px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cbf87e40-08d0-4ffe-a9f7-8efa220f6aa5":{"$contentActions":[{"action":{"$id":"a5f42844-0406-4e5a-96b9-6ca63a6e8476","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f400289-c5f7-4e7e-8107-34ac120618a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f400289-c5f7-4e7e-8107-34ac120618a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6538f7ba-ed52-4d5e-9dcb-fa1881eddfef","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ddcb83e9-5b21-4e33-94b3-aa592d168f09","type":"text/plain","content":"{{inputInesperado}}","metadata":{}},"$cardContent":{"document":{"id":"ddcb83e9-5b21-4e33-94b3-aa592d168f09","type":"text/plain","content":"{{inputInesperado}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff1c3bc0-1c92-4e7f-954f-e5142ec247f0","type":"SendMessage","settings":{"id":"d6220ae8-cb41-4b4c-9838-5f7d708bcbaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{}},"$cardContent":{"document":{"id":"d6220ae8-cb41-4b4c-9838-5f7d708bcbaf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3f76b86d-51c0-4017-823b-0a52ea89993c","type":"SendMessage","settings":{"id":"af27d5d8-e3d7-45b5-a4ae-e548753bafe3","type":"text/plain","content":"Com base na experiência deste\natendimento, em uma escala de\n0 a 10, o quanto você\nrecomendaria a SafraPay\npara um amigo ou familiar?","metadata":{}},"$cardContent":{"document":{"id":"af27d5d8-e3d7-45b5-a4ae-e548753bafe3","type":"text/plain","content":"Com base na experiência deste\natendimento, em uma escala de\n0 a 10, o quanto você\nrecomendaria a SafraPay\npara um amigo ou familiar?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"902050eb-3f4b-41b4-8837-288d8065cceb","type":"text/plain","textContent":"Entrada do usuário","content":"score"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"3:0","variable":"score"},"$invalid":false}],"$conditionOutputs":[{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_448","$id":"1f146e38-4b28-453b-95fc-72b37d7be8b8","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["2"],"variable":"contadorNPS"}],"$invalid":false},{"stateId":"600d807f-d938-462a-9036-8610519f1317","$connId":"con_453","$id":"8baa7cd9-83f0-47af-8c02-f752c0c3518b","conditions":[{"source":"input","comparison":"matches","values":["^(?:[0-9]|0[1-9]|10)$"]}],"$invalid":false},{"stateId":"cbf87e40-08d0-4ffe-a9f7-8efa220f6aa5","typeOfStateId":"state","$connId":"con_458","$id":"b98957f3-ffed-4859-8e12-3e7fc2d7bd9d","conditions":[{"source":"context","comparison":"equals","values":["input inesperado"],"variable":"score"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"40a3c0e1-94c6-4599-901e-eb65dcf5ef41","$typeOfContent":"","type":"SetVariable","$title":"InputInesperadoNota","$invalid":false,"settings":{"variable":"inputInesperado","value":"Ops, não consegui entender sua resposta."},"conditions":[{"source":"context","comparison":"equals","variable":"score","values":["input inesperado"]}]}],"$leavingCustomActions":[{"$id":"defb63fd-e5ab-4fe2-8384-39c646794262","$typeOfContent":"","type":"ExecuteScript","$title":"Normaliza Score","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(score) {\n  if (isNumeric(score)) {\n    score = parseInt(score);\n    if (score >= 0 && score <= 10)\n      return score;\n  }\n  return \"input inesperado\"\n}\n//check if a string has a number\nfunction isNumeric(num) {\n  return !isNaN(num)\n}","inputVariables":["score"],"outputVariable":"score","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"987c6637-c7b5-4e80-bf8c-f73ed4933c53","$typeOfContent":"","type":"ExecuteScript","$title":"Contador NPS","$invalid":false,"settings":{"function":"run","source":"function run(count){ if (!count) {return 1; } return parseInt(count) +1 ; }","inputVariables":["contadorNPS"],"outputVariable":"contadorNPS","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"score","values":["input inesperado"]}]},{"$id":"a078f1ff-1340-4ef9-8f46-1b07ccb4a9e9","$typeOfContent":"","type":"SetVariable","$title":"Zera Input Inesperado","$invalid":false,"settings":{"variable":"inputInesperado","expiration":1},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-69b40551-2213-4c6e-9ec6-234e4f8d7f1b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d46ff8d5-4d30-4c28-8c93-253a589cc099","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0db63df5-bb3c-4aa8-97dd-35b97853fbfc","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-24ffe0ce-ed41-43ac-b315-bb0519bb1b7a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"cbf87e40-08d0-4ffe-a9f7-8efa220f6aa5","root":false,"$title":"NPS","$position":{"top":"1807px","left":"540px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9c48f8ea-e180-45ba-b004-898d53e9d1fc":{"$contentActions":[{"action":{"$id":"c69bfb46-c0a4-4344-9df0-08e0333cab34","type":"SendMessage","settings":{"id":"580508a6-5631-4015-befb-bd7529ec08d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"580508a6-5631-4015-befb-bd7529ec08d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3c6dcf5e-446f-42e4-ae9e-aaf4b93eada7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bf762394-a4af-48f6-9cd9-160124b8e5ad","type":"text/plain","content":"{{inputInesperado}}","metadata":{}},"$cardContent":{"document":{"id":"bf762394-a4af-48f6-9cd9-160124b8e5ad","type":"text/plain","content":"{{inputInesperado}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8b40ae60-db3e-4d7d-8d8a-52b607f82c53","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"724d3aaa-457d-405f-a875-68c225dc9b81","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"724d3aaa-457d-405f-a875-68c225dc9b81","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2b87439d-e159-44bf-97e5-6c2c9fcecc2c","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"list\",\n    \"header\": {\n      \"type\": \"text\",\n      \"text\": \"\"\n    },\n    \"body\": {\n      \"text\": \"Qual o principal motivo da sua nota?\"\n    },\n    \"action\": {\n      \"button\": \"Opções\",\n      \"sections\": [\n        {\n          \"title\": \"Motivo Nota\",\n          \"rows\": [\n            {\n              \"id\": \"ID 1.1\",\n              \"title\": \"Melhores Condições\",\n              \"description\": \"\"\n\t\t\t},\n\t\t\t{\n              \"id\": \"ID 1.2\",\n              \"title\": \"Atendimento prestado\",\n              \"description\": \"\"\n\t\t\t},\n\t\t\t{\n              \"id\": \"ID 1.3\",\n              \"title\": \"Tempo de espera\",\n              \"description\": \"\"\n\t\t\t},\n\t\t\t{\n              \"id\": \"ID 1.4\",\n              \"title\": \"Outros\",\n              \"description\": \"Outros motivos\"\n            }\n          ]\n        }\n      ]\n    }\n  }\n}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a47803a6-b59f-4d23-86bd-9b8b3519f934","type":"text/plain","textContent":"Entrada do usuário","content":"sugestao"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"sugestao","expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_463","$id":"4e76057a-aea0-4785-8cf6-abfffd92ec94","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["2"],"variable":"contador"}],"$invalid":false},{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_468","$id":"98373572-56b5-4454-99f6-0d556b2b0d27","conditions":[{"source":"input","comparison":"contains","values":["Atendimento prestado","Tempo de espera","Melhores Condições"]}],"$invalid":false},{"stateId":"1118a4bb-a98b-49da-bd94-65e28f296950","typeOfStateId":"state","$connId":"con_473","$id":"a86fa1bb-017f-416e-84be-9f915eb76df0","conditions":[{"source":"input","comparison":"equals","values":["Outros"],"variable":"sugestaoCliente"}],"$invalid":false},{"stateId":"9c48f8ea-e180-45ba-b004-898d53e9d1fc","typeOfStateId":"state","$connId":"con_478","$id":"b479a9b6-77ff-4cc1-bd20-c946bf96b10e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false},{"stateId":"9c48f8ea-e180-45ba-b004-898d53e9d1fc","typeOfStateId":"state","$connId":"con_483","$id":"ddb905ae-f91d-4845-a4ea-5d3816f7fd7a","conditions":[{"source":"input","comparison":"equals","values":["input inesperado"],"variable":"sugestaoCliente"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"623dbb28-da59-4dff-9f1a-454268834c87","type":"ExecuteScript","$title":"js - sugestão","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    try{\n    const INVALID_TOKENS = RegExp(\"(^0+|.0+|^\\\\s+|\\\\s+$)\", \"gi\");\n    input = input.replace(INVALID_TOKENS, \"\");\n    const WHITE_SPACES = RegExp(\"(\\\\s+)\", \"gi\");\n    input = input.replace(WHITE_SPACES, \" \");\n\n    const optionsRegex = {\n        \"(^(0)?1$|^um$|^primeir[ao]$|melhores condi[cç][oõ]es).*\": \"Melhores Condições\",\n        \"(^(0)?2$|^dois$|^segund[ao]$|atendimento prestado).*\": \"Atendimento Prestado\",\n        \"(^(0)?3$|^tr[eê]s$|^terceir[ao]$|Tempo de espera).*\": \"Tempo de espera\",\n        \"(^(0)?4$|^quatro$|^quart[ao]$|outros).*\": \"Outros\"\n    };\n\n    let data = null;\n\n    for (let key in optionsRegex) {\n        const matching = new RegExp(key, \"i\");\n\n        if (matching.test(input)) {\n            data = optionsRegex[key];\n            return data;\n        }\n    }\n\n    if (data == null) {\n        return 'input inesperado';\n    }\n    return data;\n    }catch(err){\n        return 'input inesperado';\n    }\n}","inputVariables":["sugestao"],"outputVariable":"sugestaoCliente","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"81095c11-242a-4d5a-b71e-77122461446d","$typeOfContent":"","type":"SetVariable","$title":"zera inputInesperado","$invalid":false,"settings":{"variable":"inputInesperado","expiration":1},"conditions":[]},{"$id":"b4d77f06-b997-475a-a65f-b0c31b8ebeaf","$typeOfContent":"","type":"ExecuteScript","$title":"CONTADOR Motivo","$invalid":false,"settings":{"function":"run","source":"function run(count){ if (!count) {return 1; } return parseInt(count) +1 ; }","inputVariables":["contador"],"outputVariable":"contador","LocalTimeZoneEnabled":false},"conditions":[{"source":"input","comparison":"notEquals","values":["Outros"]},{"source":"input","comparison":"notEquals","values":["Atendimento prestado"]},{"source":"input","comparison":"notEquals","values":["Fila de espera"]},{"source":"input","comparison":"notEquals","values":["Empréstimo"]},{"source":"input","comparison":"notEquals","values":["Condições"]}]},{"$id":"0decbe10-eeb0-42f0-ba89-3713d60e07a2","$typeOfContent":"","type":"TrackEvent","$title":"ST survey answer detratores","$invalid":false,"settings":{"extras":{},"category":"ST survey answer detratores","action":"{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}|{{sugestaoCliente}}"},"conditions":[]},{"$id":"97b12b42-3f57-4e6f-bf0a-fe780b55b62a","$typeOfContent":"","type":"TrackEvent","$title":"ST survey answer detratores blip","$invalid":false,"settings":{"extras":{},"category":"ST survey answer detratores blip","action":"{{calendar.date}}|{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}|{{sugestaoCliente}}"},"conditions":[]},{"$id":"2e56e63d-9bd5-418a-b8a8-35b95b8ab42a","$typeOfContent":"","type":"SetVariable","$title":"InputInesperadoMotivo","$invalid":false,"settings":{"variable":"inputInesperado","value":"Desculpe, não entendi! Preciso que você escolha uma das opções abaixo:","expiration":180},"conditions":[{"source":"context","comparison":"equals","variable":"sugestaoCliente","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-40645e46-56a6-429e-bf12-75909ce05216","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0464ebc0-f3ef-4c33-91fd-8e6c287930ce","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-470d6ae0-652a-4bae-91f2-0c5d4313704c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b13d5001-295a-473e-b989-041858a300ad","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-05b2846b-6684-4232-aece-d1c26ca69d54","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"9c48f8ea-e180-45ba-b004-898d53e9d1fc","root":false,"$title":"Detratores","$position":{"top":"1892px","left":"334px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"600d807f-d938-462a-9036-8610519f1317":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e77c57a8-4f05-47d7-85d9-b9dfaa34bbd8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9c48f8ea-e180-45ba-b004-898d53e9d1fc","$connId":"con_488","$id":"a174fa1a-23ab-4833-9035-d1c76c40eb76","conditions":[{"source":"context","comparison":"equals","values":["detratores"],"variable":"valorClassificacao"}],"$invalid":false},{"stateId":"0b0f76a5-0b3d-485f-b771-ce0308557434","typeOfStateId":"state","$connId":"con_493","$id":"33d5f6f3-9acb-4aef-a8ba-75d39d9b1419","conditions":[{"source":"context","comparison":"equals","values":["promotores","neutros"],"variable":"valorClassificacao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d64e73a4-6e8b-45b0-8d63-6d2ff0b0c97b","type":"ExecuteScript","$title":"returnScore","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\nlet input = parseInt(input);\n\n return input.toString();\n \n}\n","inputVariables":["score"],"outputVariable":"returnScore","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"1741eb61-de70-430d-bbc3-9d97a25951e1","type":"ExecuteScript","$title":"js - classificação","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n\nlet input = parseInt(input);\n\n    if (input >= 0 && input <= 6) {\n        return \"detratores\";\n    } else if (input == 7 || input == 8) {\n        return \"neutros\";\n    } else if (input >= 9 && input <= 10) {\n        return \"promotores\";\n    } else {\n        return \"input inesperado\";\n    }\n}","inputVariables":["score"],"outputVariable":"valorClassificacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80adf8ba-af16-4598-bc29-24634fb91258","type":"ExecuteScript","$title":"js - pegando telefone do cliente","$invalid":false,"settings":{"function":"run","source":"function run(identity) { \n    let extracted_phone = identity\n        .split('@')[0]\n        .substr(2);\n    if (extracted_phone.length == 10)\n        extracted_phone = extracted_phone\n            .substr(0, 2)\n            .concat('9', extracted_phone.substr(2));\n    return extracted_phone;\n}","inputVariables":["contact.identity"],"outputVariable":"telefoneDoCliente","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"contains","variable":"contact.identity","values":["@wa.gw.msging.net"]}]},{"$id":"d5df7cd8-eb23-431b-b202-4bb1f1721b1b","type":"ExecuteScript","$title":"js - trata inputsocore","$invalid":false,"settings":{"function":"run","source":"\nfunction run(input) {\n\n    let input = parseInt(input);\n\n    return input.toString();\n\n}","inputVariables":["score"],"outputVariable":"inputScore","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aef860f8-42d6-48be-948c-a13a663627bb","$typeOfContent":"","type":"TrackEvent","$title":"ST survey answer","$invalid":false,"settings":{"extras":{},"category":"ST survey answer","action":"{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}"},"conditions":[]},{"$id":"3aaf9022-18d9-49d5-ba72-1d2ed9e47c8c","$typeOfContent":"","type":"TrackEvent","$title":"ST survey answer blip","$invalid":false,"settings":{"extras":{},"category":"ST survey answer blip","action":"{{calendar.date}}|{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-5ab402a3-8ec6-4a44-aabd-36ae371a2d96","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-045e51d4-e991-4684-892e-58fe3da683a6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"600d807f-d938-462a-9036-8610519f1317","root":false,"$title":"Nota NPS","$position":{"top":"2000px","left":"542px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0b0f76a5-0b3d-485f-b771-ce0308557434":{"$contentActions":[{"action":{"$id":"c69bfb46-c0a4-4344-9df0-08e0333cab34","type":"SendMessage","settings":{"id":"580508a6-5631-4015-befb-bd7529ec08d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"580508a6-5631-4015-befb-bd7529ec08d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4cc77706-d4a7-4824-9690-5af0a0653886","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c99aa55b-23f0-4764-959b-25917375acb8","type":"text/plain","content":"{{inputInesperado}}","metadata":{}},"$cardContent":{"document":{"id":"c99aa55b-23f0-4764-959b-25917375acb8","type":"text/plain","content":"{{inputInesperado}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"072e02d6-5de9-4d80-a4a0-3a75c49e70af","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ec4e3c14-cd52-4605-8baa-2b2b8eb0432a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ec4e3c14-cd52-4605-8baa-2b2b8eb0432a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6c2babbd-39d1-4c42-8cc8-b99af71939ce","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"list\",\n    \"header\": {\n      \"type\": \"text\",\n      \"text\": \"\"\n    },\n    \"body\": {\n      \"text\": \"Qual o principal motivo da sua nota?\"\n    },\n    \"action\": {\n      \"button\": \"Opções\",\n      \"sections\": [\n        {\n          \"title\": \"Motivo Nota\",\n          \"rows\": [\n            {\n              \"id\": \"ID 1.1\",\n              \"title\": \"Ofertas e Condições \",\n              \"description\": \"\"\n\t\t\t},\n\t\t\t{\n              \"id\": \"ID 1.2\",\n              \"title\": \"Tempo de espera\",\n              \"description\": \"\"\n\t\t\t},\n\t\t\t{\n              \"id\": \"ID 1.4\",\n              \"title\": \"Outros\",\n              \"description\": \"Outros motivos\"\n            }\n          ]\n        }\n      ]\n    }\n  }\n}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a47803a6-b59f-4d23-86bd-9b8b3519f934","type":"text/plain","textContent":"Entrada do usuário","content":"sugestao"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"sugestao","expiration":"1:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_498","$id":"9fea14f4-c818-41c5-8903-79fd5bc21f6f","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["2"],"variable":"contador"}],"$invalid":false},{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_503","$id":"16714920-888a-4005-a792-47b52f8cd3c7","conditions":[{"source":"input","comparison":"contains","values":["Ofertas e Condições","Tempo de espera"],"variable":"sugestaoCliente"}],"$invalid":false},{"stateId":"c1364f73-bad3-4d13-8981-74670dbf8dd5","typeOfStateId":"state","$connId":"con_508","$id":"69d8a01a-6349-4a89-bcb3-223d617002e6","conditions":[{"source":"input","comparison":"equals","values":["Outros"],"variable":"sugestaoCliente"}],"$invalid":false},{"stateId":"0b0f76a5-0b3d-485f-b771-ce0308557434","typeOfStateId":"state","$connId":"con_513","$id":"050a4d8f-ec3c-413b-8508-aa033266ad0a","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"sugestaoCliente"}],"$invalid":false},{"stateId":"0b0f76a5-0b3d-485f-b771-ce0308557434","typeOfStateId":"state","$connId":"con_518","$id":"acd0ecd9-fa35-4bd2-a5b9-760ea4c5e8a7","conditions":[{"source":"input","comparison":"equals","values":["input inesperado"],"variable":"sugestaoCliente"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"623dbb28-da59-4dff-9f1a-454268834c87","type":"ExecuteScript","$title":"js - sugestão","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    try{\n    const INVALID_TOKENS = RegExp(\"(^0+|.0+|^\\\\s+|\\\\s+$)\", \"gi\");\n    input = input.replace(INVALID_TOKENS, \"\");\n    const WHITE_SPACES = RegExp(\"(\\\\s+)\", \"gi\");\n    input = input.replace(WHITE_SPACES, \" \");\n\n    const optionsRegex = {\n        \"(^(0)?1$|^um$|^primeir[ao]$|Ofertas e Condi[çc][oõ]es).*\": \"Ofertas e Condições\",\n        \"(^(0)?2$|^dois$|^segund[ao]$|Tempo de espera).*\": \"Tempo de espera\",\n        \"(^(0)?3$|^tres$|^terceiro$|outros).*\": \"Outros\"\n    };\n\n    let data = null;\n\n    for (let key in optionsRegex) {\n        const matching = new RegExp(key, \"i\");\n\n        if (matching.test(input)) {\n            data = optionsRegex[key];\n            return data;\n        }\n    }\n\n    if (data == null) {\n        return 'input inesperado';\n    }\n    return data;\n    }catch(err){\n        return 'input inesperado';\n    }\n}","inputVariables":["sugestao"],"outputVariable":"sugestaoCliente","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f0997fa7-f510-4873-811d-8efc419e1904","$typeOfContent":"","type":"SetVariable","$title":"Limpa inputInesperado","$invalid":false,"settings":{"variable":"inputInesperado","expiration":1},"conditions":[]},{"$id":"620ff882-5d8d-4c8e-92f3-d60a68583d4a","$typeOfContent":"","type":"ExecuteScript","$title":"ContadorMotivo","$invalid":false,"settings":{"function":"run","source":"function run(count){ if (!count) {return 1; } return parseInt(count) +1 ; }","inputVariables":["contador"],"outputVariable":"contador","LocalTimeZoneEnabled":false},"conditions":[{"source":"input","comparison":"notEquals","values":["Outros"]},{"source":"input","comparison":"notEquals","values":["Atendimento prestado"]},{"source":"input","comparison":"notEquals","values":["Melhores Condições"]}]},{"$id":"a1eb282f-7038-4a36-8d0f-6d3d4f22ef38","$typeOfContent":"","type":"TrackEvent","$title":"ST survey answer promotores neutros","$invalid":false,"settings":{"extras":{},"category":"ST survey answer promotores neutros","action":"{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}|{{sugestaoCliente}}"},"conditions":[]},{"$id":"6ebfff76-a89c-4f19-9e1e-0461b499b8dc","$typeOfContent":"","type":"TrackEvent","$title":"ST survey promotores neutros blip","$invalid":false,"settings":{"extras":{},"category":"ST survey promotores neutros blip","action":"{{calendar.date}}|{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}|{{sugestaoCliente}}"},"conditions":[]},{"$id":"134c5512-64c4-4644-817b-468fdedbf649","$typeOfContent":"","type":"SetVariable","$title":"INPUTINESPERADOMOTIVO","$invalid":false,"settings":{"variable":"inputInesperado","value":"Desculpe, não entendi! Preciso que você escolha uma das opções abaixo:","expiration":180},"conditions":[{"source":"context","comparison":"equals","variable":"sugestaoCliente","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-1737ebb0-55e8-416f-ac9e-bf9901ed3853","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-278f06fe-d0ab-4790-b122-4aa6bd3e795e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-26d08da1-0857-40c0-aec9-c8a8ebfbbbc1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f92d48e0-2018-4cda-a13c-51d7b5f8c42c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a3b857ce-a8d4-4ab0-93f2-f5bb64876e4f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0b0f76a5-0b3d-485f-b771-ce0308557434","root":false,"$title":"Promotores e Neutros","$position":{"top":"1885px","left":"748px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1118a4bb-a98b-49da-bd94-65e28f296950":{"$contentActions":[{"action":{"$id":"7e808374-0268-42f3-8a9c-e4e93a01cb87","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2b46590f-7767-4495-b436-4224ef4c5bcf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2b46590f-7767-4495-b436-4224ef4c5bcf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"218a9c1e-4059-479d-a9f6-1d5674f79ba1","$typeOfContent":"text","type":"SendMessage","settings":{"id":"864750e5-fb80-460a-bcd9-06cb847e53d8","type":"text/plain","content":"Qual razão que o nosso atendimento deixou a desejar? ","metadata":{}},"$cardContent":{"document":{"id":"864750e5-fb80-460a-bcd9-06cb847e53d8","type":"text/plain","content":"Qual razão que o nosso atendimento deixou a desejar? "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a10a57c1-8343-44e8-850b-299ffdcafb3e","type":"text/plain","textContent":"Entrada do usuário","content":"motivo"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"motivo","expiration":"3:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_523","$id":"92edb42e-c43c-4098-9577-b95e4a82179a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d8c4d617-fe82-4955-b06c-74a62b02bf7a","$typeOfContent":"","type":"TrackEvent","$title":"Motivos outros detratores input","$invalid":false,"settings":{"extras":{},"category":"Motivos outros detratores input","action":"{{ticketNumber}}|{{inputScore}}|{{motivo}}"},"conditions":[]},{"$id":"f4e137ac-f016-4665-9e63-b4f991506a9d","$typeOfContent":"","type":"TrackEvent","$title":"Motivos outros detratores blip","$invalid":false,"settings":{"extras":{},"category":"Motivos outros detratores blip","action":"{{calendar.date}}|{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}|{{sugestaoCliente}}|{{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-3c2caf18-c3f3-45b7-ab6b-cc332cd8e038","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d4a5e940-e79d-4016-9d1f-cc8c78f62f6d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-839a6dd8-b622-40a9-93ca-78f5b4517789","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1118a4bb-a98b-49da-bd94-65e28f296950","root":false,"$title":"Outros Detratores","$position":{"top":"2057.79px","left":"345.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c1364f73-bad3-4d13-8981-74670dbf8dd5":{"$contentActions":[{"action":{"$id":"7e808374-0268-42f3-8a9c-e4e93a01cb87","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2b46590f-7767-4495-b436-4224ef4c5bcf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2b46590f-7767-4495-b436-4224ef4c5bcf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"218a9c1e-4059-479d-a9f6-1d5674f79ba1","$typeOfContent":"text","type":"SendMessage","settings":{"id":"864750e5-fb80-460a-bcd9-06cb847e53d8","type":"text/plain","content":"Qual razão que você vinculou essa nota ao atendimento? ","metadata":{}},"$cardContent":{"document":{"id":"864750e5-fb80-460a-bcd9-06cb847e53d8","type":"text/plain","content":"Qual razão que você vinculou essa nota ao atendimento? "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a10a57c1-8343-44e8-850b-299ffdcafb3e","type":"text/plain","textContent":"Entrada do usuário","content":"motivo"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"motivo","expiration":"3:0"},"$invalid":false}],"$conditionOutputs":[{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","typeOfStateId":"state","$connId":"con_528","$id":"92edb42e-c43c-4098-9577-b95e4a82179a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"6e1f9238-8363-48c7-ad78-c51bf0241a6c","$typeOfContent":"","type":"TrackEvent","$title":"Motivos outros promotores neutros input","$invalid":false,"settings":{"extras":{},"category":"Motivos outros promotores neutros input","action":"{{ticketNumber}}|{{inputScore}}|{{motivo}}"},"conditions":[]},{"$id":"0dc9a371-ecce-4667-a25f-7f3367f07b0b","$typeOfContent":"","type":"TrackEvent","$title":"Motivos outros promotores neutros blip","$invalid":false,"settings":{"extras":{},"category":"Motivos outros promotores neutros blip","action":"{{calendar.date}}|{{ticketNumber}}|{{inputScore}}|{{valorClassificacao}}|{{sugestaoCliente}}|{{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2d4b1743-a392-41e6-aff2-e18f1dc6bd9f","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-96774dc3-2e75-4705-a8b9-be30fab1d2ec","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5b3baca9-afaa-4b00-86b0-646b705198e5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a6e131a5-9066-497f-8788-cf177c59e4df","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c1364f73-bad3-4d13-8981-74670dbf8dd5","root":false,"$title":"Outros Promotores e Neutros","$position":{"top":"2049px","left":"744px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7c981f00-8192-4699-9429-0b0dcafdc329":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06ecab99-d5ad-491b-b680-03a429bc6091","type":"text/plain","textContent":"Entrada do usuário","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"1:0"},"$invalid":false,"$$hashKey":"object:9987"}],"$conditionOutputs":[{"stateId":"ee831952-8db2-4cc9-99c3-df155c6d3b8e","typeOfStateId":"state","$connId":"con_538","$id":"e6b2d820-969b-4e4a-becb-b8c0b2598b73","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput","$$hashKey":"object:10030"},{"values":[],"source":"input","comparison":"exists","$$hashKey":"object:10031"}],"$invalid":false,"$$hashKey":"object:9994"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ffe4a4c7-1ce7-4d67-a423-5c3d2c01b375","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf) {\n    const invalidCpfMessage = 'input inesperado';\n    try {\n        if (!cpf) {\n            return 'inatividade'\n        }\n        cpf = cpf.replace(/\\D/g, '');\n        if (cpf.length !== 11 || /^(.)\\1*$/.test(cpf)) {\n            return invalidCpfMessage;\n        }\n        let sum = 0;\n        let remainder;\n        for (let i = 1; i <= 9; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(9, 10))) {\n            return invalidCpfMessage;\n        }\n        sum = 0;\n        for (let i = 1; i <= 10; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(10, 11))) {\n            return invalidCpfMessage;\n        }\n        return cpf;\n    } catch (err) {\n        return invalidCpfMessage;\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8ceee10-b751-4f03-9fea-cf15009ee655","$typeOfContent":"","type":"MergeContact","$title":"Set \"cpf\" to \"{userInput}\"","$invalid":false,"settings":{"extras":{"cpf":"{{userInput}}"}},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"768bd9d1-acb2-4a9e-9a2b-e9d31c5c6d06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0f3dc18b-2a49-43ac-8e0f-fc9c50bb46cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"c50c046e-4147-45fc-9c4c-7c5ea70103bf","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"oi"},"address":"main"},"conditions":[{"values":["Sair"],"source":"input","comparison":"equals"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"600cc78b-8b5a-43d3-a3c8-bfa3e2f79086","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7ec34c36-0769-48aa-ad5d-8de6f4e0eac2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-838355d2-f474-4c04-abe9-9ca35516b764","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-d33d1b8f-e529-4e65-8696-89deba3e93b7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-239c0bd4-e187-4bfb-9b03-c2d11dde8270","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7c981f00-8192-4699-9429-0b0dcafdc329","root":false,"$title":"[M.2.0.1][INPUT] Valida CPF","$position":{"top":"307px","left":"484px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ee831952-8db2-4cc9-99c3-df155c6d3b8e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"05944f68-1d49-4a49-9782-622dee31cc95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:8572"}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_548","$id":"6dd06b3f-39e7-44d9-ac8d-574696ee3d78","conditions":[{"values":["1"],"source":"context","comparison":"greaterThanOrEquals","variable":"contas@quantidadeContas","$$hashKey":"object:8592"},{"values":[],"source":"context","comparison":"exists","variable":"contas","$$hashKey":"object:8593"}],"$invalid":false,"stateId":"e159b03d-b5f3-465d-9346-c33065c11763","$$hashKey":"object:8574"},{"stateId":"49a5ca76-81f2-4a8b-946a-ad7d563b94e5","typeOfStateId":"state","$connId":"con_553","$id":"31b9d14f-d908-4eb1-b3e5-a4376a2d8d31","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:8617"},{"$$hashKey":"object:11940","values":[],"source":"context","comparison":"exists","variable":"contas"}],"$invalid":false,"$$hashKey":"object:8575"}],"$enteringCustomActions":[{"$id":"0ac6d227-c0f1-4ede-a65e-566557cbe2b3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bc463daa-81a7-4052-a839-aa5679151c6d","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"fc784833-8d2f-4e3c-a9f6-a29e08d7b490","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyContas\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHTshort}}chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}}","responseStatusVariable":"statusContas","responseBodyVariable":"bodyContas"},"conditions":[]},{"$id":"cb7e2bdc-f341-44e7-9c67-eb82c80317a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyContas) {\n\ttry {\n\t\tconst contas = JSON.parse(bodyContas).data;\n\t\tlet arrContas = []\n\t\tlet totalLoops = 0;\n\n\t\tfor (let index = 0; index < contas.length; index++) {\n\t\t\tif (totalLoops > 100) break;\n\t\t\tfor (let indexB = 0; indexB < contas[index].contas.length; indexB++) {\n\t\t\t\tif (totalLoops > 100) break;\n\t\t\t\tconst novaConta = contas[index].contas[indexB];\n\t\t\t\tnovaConta.canal = contas[index].canal\n\t\t\t\tnovaConta.shortname = contas[index].shortname;\n\t\t\t\tnovaConta.usuario = contas[index].usuario\n\t\t\t\tnovaConta.codigoSegmento = contas[index].segmento\n\t\t\t\tarrContas.push(novaConta)\n\t\t\t\ttotalLoops++;\n\t\t\t}\n\t\t\ttotalLoops++;\n\t\t}\n\t\treturn {\n\t\t\tquantidadeContas: arrContas.length,\n\t\t\tcontas: arrContas\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tquantidadeContas: 0,\n\t\t\tcontas: []\n\t\t}\n\t}\n}","inputVariables":["bodyContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cab7169-21a8-41aa-aa30-5a74ceb7ddc4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"SPD Main {state.name} quantidade de contas\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} quantidade de contas","action":"{{contas@quantidadeContas}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contas@quantidadeContas"}]},{"$id":"fe38dc09-941f-4136-bcf0-a84d2114fcd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(data) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\treturn contas[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contas"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"}]},{"$id":"15fcf271-3186-45b1-89b2-c4f954b7e5e3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusContas"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"de1c5968-7160-4dfd-9b03-cf94d6d31aae","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarContas\"","$invalid":false,"settings":{"function":"run","source":"const replaceAt = (string, index, replacement) => {\n\treturn string.substr(0, index) + replacement + string.substr(index + replacement.length);\n};\n\n// function list(contas, maisContas) {\n// \ttry {\n// \t\tconst buttons = contas.map((conta, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: `${conta.agencia}-${conta.conta}`,\n// \t\t\t\ttitle: `AG${replaceAt(conta.agencia, 1, \"XXX\")} CC${replaceAt(conta.conta, 2, \"XXXX\")}`,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outras contas'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.\";\n// \t\tconst buttonTitle = \"Mostrar contas\";\n// \t\tconst headerText = \"Escolha uma conta\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn false;\n// \t}\n// }\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\tlet textoContas = ''\n\t\tcontas.slice(0, 100)\n\t\t\t.forEach((conta, index) => textoContas += `*${index + 1}* - AG ${replaceAt(conta.agencia, 1, \"XXX\")}\\nCC ${replaceAt(conta.conta, 2, \"XXXX\")}\\n`)\n\t\treturn textoContas\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["contas","state.name","idSessao"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarContas"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"}]},{"$id":"fd849d5e-7996-4de5-8ac4-92f1f18d707d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarContas@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarContas@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarContas@tracking"}]},{"$id":"ac7d3117-f8b5-4b22-b4fb-94bdccb70f82","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"1d578318-ae43-44ca-9716-3d5722d4af8f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}} | GET | {{statusContas}} | {{bodyContas}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-50f22271-3b06-4653-8e0b-2deeee87a844","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fff321c8-6e1d-4c7d-997c-809beb535e94","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-231bb863-5a78-4a66-9ea6-d12cb5f54cdf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"ee831952-8db2-4cc9-99c3-df155c6d3b8e","root":false,"$title":"[M.3.0.0][MSG][HTTP] Verifica contas","$position":{"top":"467px","left":"485.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"600cc78b-8b5a-43d3-a3c8-bfa3e2f79086":{"$contentActions":[{"action":{"$id":"e8a8b5c9-e8d1-4391-b60e-ddb4e1544149","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"496dc1c0-c4af-4eb4-aaed-3afc0aaff8ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"496dc1c0-c4af-4eb4-aaed-3afc0aaff8ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8f17470d-f3ff-4343-82f8-f22a518e0be0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"40bbc134-922c-4a14-b0bd-10cdb44b5b4b","type":"text/plain","content":"O número do CPF informado não corresponde ao exemplo apresentado. 🤔","metadata":{}},"$cardContent":{"document":{"id":"40bbc134-922c-4a14-b0bd-10cdb44b5b4b","type":"text/plain","content":"O número do CPF informado não corresponde ao exemplo apresentado. 🤔"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b896b071-45aa-4989-ab5f-f30346e76435","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f161fcb3-d5af-4680-ae97-5f1c6df0b38d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f161fcb3-d5af-4680-ae97-5f1c6df0b38d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f371c9e5-91d1-4299-8b8e-eebe0bab06a9","$typeOfContent":"text","type":"SendMessage","settings":{"id":"970520d3-64a0-4865-9529-b0d4c86b6a88","type":"text/plain","content":"Vamos tentar novamente! \nDigite o CPF do titular da conta. \n\nNão esqueça de inserir o número 0 (zero), se houver.","metadata":{}},"$cardContent":{"document":{"id":"970520d3-64a0-4865-9529-b0d4c86b6a88","type":"text/plain","content":"Vamos tentar novamente! \nDigite o CPF do titular da conta. \n\nNão esqueça de inserir o número 0 (zero), se houver."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9eb8aa79-35b1-4f21-9c9f-0707932d2912","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a9596376-ee37-4de6-bffd-923ab387c5d7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a9596376-ee37-4de6-bffd-923ab387c5d7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b060f928-b25f-4414-bb67-e21a263e2c70","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b8ca4979-a84a-4475-b353-a2d854d23131","type":"text/plain","content":"Informe o CPF, como neste exemplo.\n👉 CPF: 43913590806.","metadata":{}},"$cardContent":{"document":{"id":"b8ca4979-a84a-4475-b353-a2d854d23131","type":"text/plain","content":"Informe o CPF, como neste exemplo.\n👉 CPF: 43913590806."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7ea1273b-3d14-46d5-b53f-2a236b9031dc","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_558","$id":"077fa9d2-6b87-4bc6-bf5b-14a13d3f5de4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"stateId":"7c981f00-8192-4699-9429-0b0dcafdc329"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7c981f00-8192-4699-9429-0b0dcafdc329","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f0968255-a7b7-4485-a162-eea932205d5e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"600cc78b-8b5a-43d3-a3c8-bfa3e2f79086","root":false,"$title":"[M.2.0.2][MSG] CPF Invalido","$position":{"top":"306.667px","left":"710.111px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"e159b03d-b5f3-465d-9346-c33065c11763":{"$contentActions":[{"action":{"$id":"98d5a390-58af-4ee8-ab7d-1ea5ece15aff","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"71628b04-8e27-495a-ae71-2114b4a98b9f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"71628b04-8e27-495a-ae71-2114b4a98b9f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:7527"},{"action":{"$id":"d9a5942e-6007-46bc-8090-f38a8701357b","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:7528"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ea565734-260f-46d8-9c6c-cc5665601a46","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:7529"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"d66288bb-e443-446b-b818-c75316f33ce3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": `Olá!   \n\nInformamos que este número será desativado em breve!\n\nA partir de agora, para falar com um dos nossos atendentes, você que já é um correntista do banco Safra, pode utilizar o seguinte número: (11) 3175-8248\n\nToque no botão abaixo para continuar.`\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Safra Empresas\",\n        \"url\": \"https://bit.ly/4bwdVGv\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#EE82EE","label":"SendMessage","id":"blip-tag-2423a720-8186-4235-a091-f03150888218","canChangeBackground":false}],"id":"e159b03d-b5f3-465d-9346-c33065c11763","root":false,"$title":"[M.4.0.0] Cliente Já é Correntista","$position":{"top":"515px","left":"709px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:useTunnelOwnerContext":"true","dateTimeOffset":"-3","token":"c3Bwcm9kbWFya2V0aW5nd2hhdHNhcHA6VWV6cFZBdDVSQnBVSTN2d3RGV0U=","apiKey":"Key c3Bwcm9kbWFya2V0aW5nd2hhdHNhcHA6VWV6cFZBdDVSQnBVSTN2d3RGV0U=","workDays":"1,2,3,4,5","scheduleMessage":"Bom dia! Estamos retornando seu contato.  Por favor, para conversar com nossa equipe envie uma mensagem.","whatsDisplay":"Iniciar o atendimento","deskHours":"08:00|22:00|1,2,3,4,5|Default;08:00|22:00|1,2,3,4,5|Especialistas;08:00|19:00|1,2,3,4,5|Call","idCampaign":"Whatsapp Display","isHoliday":"false","startDate":"08:00","endDate":"19:00","IdentityFlow":"e527a1fa-a441-407d-87f7-e8d5787efe84","UserNotResponsive":"Aguarde um instante que já iremos te atender.","botIdentity":"spprodmarketingwhatsapp","BloqueioPorFraude":"11964584058|11985391309|11949401954|11982320261|11950477525|11999057898|11941086558|19989138040|19981499273|3135524052|31975232327|31991401263|31988120176|31998100546|75992740660|51981464903|77981420672|31982873866|21965343443|21979499098|11955718755|11941612474|35999612029|86988173053|99988249841|79998401113|11933593101|32984936640|19992028472|62992445867|85998382181|11974001693|21983391698|11958826147|11982510317|11962581208|11963656719|11987661189|11982355717|11983824922|11981595635|11967975561|84994876391|66996440616|11981513382|11981128810|62993799437|11948234296|11961498538|11961491940|11987104140|11977360057|11949834842|1164584058|1185391309|1149401954|1182320261|1150477525|1199057898|1141086558|1989138040|1981499273|3135524052|3175232327|3191401263|3188120176|3198100546|7592740660|5181464903|7781420672|3182873866|2165343443|2179499098|1155718755|1141612474|3599612029|8688173053|9988249841|7998401113|1133593101|3284936640|1992028472|6292445867|8598382181|1174001693|2183391698|1158826147|1182510317|1162581208|1163656719|1187661189|1182355717|1183824922|1181595635|1167975561|8494876391|6696440616|1181513382|1181128810|1148234296|1161498538|1161491940|1187104140|1177360057|1149834842|1144861811|11944861511|21993230255|11954942366|11987852648|11984114526|11948724684|11949063614|1148341441|11948341441|1148724684|1149063614|13997191934|13996549310|11990234245|11982867064|11971448018|13992083625|73998681811|71996116533|62999891361|11970711182|11999225187|11992251873|11993616705|31995859643|31998267587|34998934679|11968259548|11985308382|61985458420|61981865657|31983856510|31983186463|31985025037|11951411881|11952832618|11991541500|61991026487|62996123416|2122539070|2124953656|31994379862|31973342760","builder:stateExpiration":"1.00:00:00","commands":"https://safra.http.msging.net/commands","messages":"https://safra.http.msging.net/messages","blip":"blip.ai","jornada":"https://www.safrapay.com.br/?utm_source=bot&utm_medium=display&utm_campaign=bot-display","apiHorario":"https://heavybots-api.herokuapp.com","builder:actionExecutionTimeout":"86400","builder:#localTimeZone":"E. South America Standard Time","ApiUrl":"https://ticketmonitor.cs.blip.ai","clientId":"BLIP","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","urlSafra":"https://api.safra.com.br","grantType":"client_credentials","processHttpAddUserToRequestHeader":"false","urlSafraToken":"https://sts-api-hml.safra.com.br/api/oauth","urlHibrido":"https://portalspa-sp2-hml.safracredenciadora.com.br/vpo-backoffice-b/core/receptive-chat/tabulador?","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/betadisplaywhatsapp","urlToken":"https://sts-api-hml.safra.com.br","urlCHTshort":"https://api-hml.safra.com.br/","urlCHT":"https://api-hml.safra.com.br/chat-assistente"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}