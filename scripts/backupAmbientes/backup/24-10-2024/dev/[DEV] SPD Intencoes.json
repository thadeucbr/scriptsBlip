{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"df28333f-d509-4c3f-acd7-6d4801130bae","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8c695219-8026-443c-a4f1-68132d1b4803","typeOfStateId":"state","$connId":"con_3","$id":"253b6bdd-9c0e-40e8-adf1-0da8e620ce31","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e2d62597-ab55-4f55-8fc5-c1a5671d0bd8","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CANAL WA","$invalid":false,"settings":{"extras":{"Canal":"WhatsApp"}},"conditions":[{"values":["@wa"],"source":"context","comparison":"contains","variable":"contact.identity"}]},{"$id":"7e5a543b-577f-4b62-b9c4-c286f47c13cb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(redirect, intent) {\n\tredirect  = JSON.parse(redirect)\n\ttry {\n\t\treturn {\n\t\t\tinput: redirect.input.content,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["redirectContent","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f982c13c-c774-46ec-9305-81eccfe1b930","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"ac453170-b6fc-4785-9cda-5224fd07805f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f804a3b-8957-4712-b319-7b8e89ecf05e","$typeOfContent":"","type":"SetVariable","$title":"intencao","$invalid":false,"settings":{"variable":"intencao","value":"{{input.intent.name}}"},"conditions":[]},{"$id":"72d069df-c08d-4258-8ca7-27b9a3c44d86","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = ( contact, intent) => {\n\tconst intencao = JSON.parse(intent)\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27a3e501-d334-4e7a-977c-446c3b8626c8","$typeOfContent":"","type":"TrackEvent","$title":"intencao inicio","$invalid":false,"settings":{"extras":{},"category":"intencao inicio","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7dd56b66-d009-43f2-9d9b-69d29cc53753","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-354e1bef-3900-4486-9196-04f7a363d93f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-509295e1-cfa9-409c-94f9-73ce96daa04e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d837c485-e019-47e3-a018-24b6460804c0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-89ade4d5-21d3-4af7-8514-890f664c0c81","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e8623716-a0ec-421d-a7a5-6e3e8b211bf3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"0px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsComments":{"6d0f89c4-1a0f-40dc-ad21-629081da0e65":{"id":"6d0f89c4-1a0f-40dc-ad21-629081da0e65","text":"Teste","blocksIdList":["0abed19b-40e3-454c-bed3-c97f190fd32a"]}}},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72829bcb-49a0-4a88-b0e3-898db393e89b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0fb18c4b-3d1a-4905-b922-197db4f5d1c8","typeOfStateId":"state","$connId":"con_8","$id":"084cd0d7-a8c3-492a-8711-a167b4d4299b","conditions":[{"source":"context","comparison":"equals","values":["a35fa267-f2b7-4298-83d9-b0924114e971"],"variable":"state.previous.id"},{"values":["extratoMaisAntigoQueDoisAnos"],"source":"context","variable":"exceptionType","comparison":"equals"}],"$invalid":false},{"stateId":"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8","typeOfStateId":"state","$connId":"con_13","$id":"48a208af-981b-43f9-ba5b-8fc364063d16","conditions":[{"source":"intent","comparison":"equals","values":["alterar conta"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"c6b1d835-f571-4c7a-975d-6e088158bc68","typeOfStateId":"state","$connId":"con_18","$id":"f1bf2dfa-0521-47c4-895c-a65177602f3f","conditions":[{"source":"context","comparison":"equals","values":["a5803973-dd8d-471a-bab6-a57c7add1a09","d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00"],"variable":"state.previous.id"},{"values":["erroApi"],"source":"context","comparison":"equals","variable":"exceptionType"}],"$invalid":false},{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","typeOfStateId":"state","$connId":"con_23","$id":"2f26d807-7949-4db0-a32a-042e9b3d231c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"2598689f-011e-4846-8841-e65691f3b175","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (intent) => {\n\n\tif(intent === 'alterar conta') return false\n\treturn true\n}","inputVariables":["input.intent.name"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e738c17b-df21-49dc-b3e3-e4b932411456","$typeOfContent":"","type":"SetVariable","$title":"conta","$invalid":false,"settings":{"variable":"conta"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"45ad26b9-53fe-4be7-a8b6-e69800aac87a","$typeOfContent":"","type":"SetVariable","$title":"agencia","$invalid":false,"settings":{"variable":"agencia"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"d01bcd4f-24b2-4ffe-a26f-c5245dcf5ce9","$typeOfContent":"","type":"MergeContact","$title":"conta/agencia","$invalid":false,"settings":{"extras":{"conta":"{{conta}}","agencia":"{{agencia}}"}},"conditions":[{"values":["false"],"source":"context","variable":"isAccountInCache","comparison":"equals"}]},{"$id":"dc14323c-4861-4288-9c39-213fb3f50873","$typeOfContent":"","type":"SetVariable","$title":"intencao","$invalid":false,"settings":{"variable":"intencao","value":"{{input.intent.name}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-53c2dd07-92c8-4cc7-8494-d2ce1f6c01ef","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-107b1080-5756-4fee-afda-675762e0cfda","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-486b5192-5aeb-4fee-9e10-45d5d152baef","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"176px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3add2fc9-71b1-4b63-a43e-a45f30df11ec":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4b190c25-7a56-4038-8e46-917c4a2ff876","typeOfStateId":"state","$connId":"con_28","$id":"de2cb42b-eca9-484f-9ea3-9d888467274c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4dfd3130-e5d2-4b15-af26-d9ea6066f2bb","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["config.clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{url}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"8ad0157c-c65a-4fc6-be53-c06ea4a46b06","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4b190c25-7a56-4038-8e46-917c4a2ff876","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-715f3da2-cbc6-488d-a94e-7cdf0e9b2eea","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-007023e8-06dc-488a-8148-f3b84a2ea030","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c238d36-0f0a-4a22-a82c-b342c2f0a031","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-bde4ed46-ef5c-4add-bac3-d2a4f2074b69","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","root":false,"$title":"[API] TOKEN","$position":{"top":"569px","left":"645.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"4b190c25-7a56-4038-8e46-917c4a2ff876":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1a0c612-23cf-4cdd-90d0-488577ad654c","typeOfStateId":"state","$connId":"con_33","$id":"01d64960-24a8-4e44-af78-9b2092666742","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d18a9411-9fbd-4bac-b998-6790ee64a610","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@phoneIndentificationURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(phoneNumber) {\n  phoneNumber = JSON.parse(phoneNumber);\n\n  return JSON.stringify({\n    tipoPessoa: \"F\",\n    ddd: phoneNumber.DDD,\n    numeroCelular: phoneNumber.phone\n  //  ddd: '{{config.ddd}}',\n  //  numeroCelular: '{{config.telefone}}'\n  });\n}\n","inputVariables":["phoneNumber"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"IDENTIFICAÇÃO DE TELEFONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Safra-Bot-ID":"{{safraBotId}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusTelIdent","responseBodyVariable":"responseTelIdent"},"conditions":[]},{"$id":"6e9d8fa1-60c4-4275-9122-eeaf2fb1108c","$typeOfContent":"","type":"ExecuteScript","$title":"customerName","$invalid":false,"settings":{"function":"run","source":"function run(responseTelIdent) {\n  responseTelIdent = JSON.parse(responseTelIdent);\n  return capitalizeText(responseTelIdent.data.nome);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["responseTelIdent"],"outputVariable":"customerName","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"ae5ef5a3-53ae-4765-96c9-c53295c7daac","$typeOfContent":"","type":"ExecuteScript","$title":"documentBase","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n  response = JSON.parse(response);\n  return response.data.baseDocumento;\n}\n","inputVariables":["responseTelIdent"],"outputVariable":"documentBase","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"ef942c4a-646b-4e75-8652-9c06e141d730","$typeOfContent":"","type":"ExecuteScript","$title":"document","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n  response = JSON.parse(response);\n  const data = response.data;\n  return `${data.baseDocumento}${data.digitosVerificadoresDocumento}`;\n}","inputVariables":["responseTelIdent"],"outputVariable":"document","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"07da6220-267f-43b4-b2e2-063b38e58769","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusTelIdent}} | {{responseTelIdent}} | {{contact.identity}}"},"conditions":[]},{"$id":"d0e53900-81ca-4508-a50c-112b1cf39555","$typeOfContent":"","type":"ExecuteScript","$title":"nome","$invalid":false,"settings":{"function":"run","source":"const run = (response) => {\n\tconst nome = JSON.parse(response).data.nome.split(' ')[0]\n\treturn nome\n}","inputVariables":["responseTelIdent"],"outputVariable":"nome","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"ccf4e020-233d-46b6-ab04-f0093c3dd858","$typeOfContent":"","type":"ExecuteScript","$title":"email","$invalid":false,"settings":{"function":"run","source":"const run = (response) => {\n\ttry {\n\t\tconst email = JSON.parse(response).data.email;\n\t\treturn email;\n\t}\n\tcatch (e) {\n\t\treturn \"-\"\n\t}\n}","inputVariables":["responseTelIdent"],"outputVariable":"email","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true}],"$leavingCustomActions":[{"$id":"7b0fd582-5841-4cab-b0bb-5edcc8a65b4c","$typeOfContent":"","type":"MergeContact","$title":"Set customerName and Mail","$invalid":false,"settings":{"extras":{},"name":"{{customerName}}","email":"{{email}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a1a0c612-23cf-4cdd-90d0-488577ad654c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b4a1911d-dce0-470b-b966-670654abd9b1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f05612aa-e0a4-4c00-a5ea-b69ba2ec421e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7d45cbf8-cb87-4d54-a6b9-1364a6ed5b87","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d9b03aa5-861b-40ac-b83c-267c2e23cf05","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-340f1f7e-f4af-42b6-bbc0-b81a1f940fce","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"4b190c25-7a56-4038-8e46-917c4a2ff876","root":false,"$title":"[API] IDENTIFICAÇÃO DE TELEFONE","$position":{"top":"701px","left":"647px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"d9359361-57c8-4d39-a392-69b769f419d6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","typeOfStateId":"state","$connId":"con_38","$id":"a22b28c5-ac7a-4378-833e-b17c7d46a61a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"19a2c97f-ea54-419f-996b-e0bf649b7fc4","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@customerDataIndentificationURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(agency, account) {\n\treturn JSON.stringify({\n    agencia: agency,\n    conta: account\n  })\n}","inputVariables":["agency","account"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"IDENTIFICACAO DADOS CLIENTE","$invalid":false,"settings":{"headers":{"Safra-Bot-ID":"{{safraBotId}}","User-Agent":"Fiddler","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusClientData","responseBodyVariable":"responseClientData"},"conditions":[]},{"$id":"0721a989-53d8-4191-94ef-840d2aa17dc8","$typeOfContent":"","type":"ExecuteScript","$title":"segmentCode","$invalid":false,"settings":{"function":"run","source":"function run(responseClientData) {\n  responseClientData = JSON.parse(responseClientData);\n  const segmentCode = responseClientData.data.codigoSegmento;\n  return String(segmentCode).padStart(4, \"0\");\n}","inputVariables":["responseClientData"],"outputVariable":"segmentCode","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusClientData"}]},{"$id":"ca373739-5116-4242-a632-095e4a7b91b0","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusClientData}} | {{responseClientData}} | {{contact.identity}}"},"conditions":[]},{"$id":"127be61e-bc3e-4aed-8df4-94aa32267b88","$typeOfContent":"","type":"ExecuteScript","$title":"dados cliente","$invalid":false,"settings":{"function":"run","source":"const run = (response, listaContas) => {\n\tconst {agencia, conta, documento} = JSON.parse(response).data\n\tconst {codigoCliente} = JSON.parse(listaContas).data[0]\n\treturn {\n\t\tagencia: String(agencia),\n\t\tconta: String(conta),\n\t\tdocumento,\n\t\tcodCliente: codigoCliente\n\t}\n}","inputVariables":["responseClientData","responseAccountLists"],"outputVariable":"dadosCliente","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusClientData"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2c1aa35c-1829-482d-ad61-a52bc0556d15","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-738b3af2-9efa-40c1-9fb7-fde3ebbe9eb9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-384259b7-a013-4ffb-a010-da013e35532e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-e0fd7057-f1ae-4305-98fc-4ffc8bb8d49a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"d9359361-57c8-4d39-a392-69b769f419d6","root":false,"$title":"[API] IDENTIFICACAO DADOS CLIENTE","$position":{"top":"2695.43px","left":"676.429px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","textColor":"#ffffff"}},"b34040c5-af17-45f9-b86b-80c66c404a50":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d9d0be3e-336c-4ce7-a1a5-ebaa2a5d4a73","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","typeOfStateId":"state","$connId":"con_43","$id":"50bab68f-c748-4c64-a027-abe878317bfa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a97ceb66-d503-4a4d-ac59-797dab99f865","$typeOfContent":"","type":"SetVariable","$title":"env","$invalid":false,"settings":{"variable":"env","value":"{{config.env}}"},"conditions":[]},{"$id":"f6129fee-2112-4b3b-b3a1-cc903713a865","$typeOfContent":"","type":"ExecuteScript","$title":"envSettings","$invalid":false,"settings":{"function":"run","source":"function run(env) {\n  const envSettings = {\n    \"PRD\": {\n      tokenURL: \"https://sts-api.safra.com.br/api/oauth/token\",\n      phoneIndentificationURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais\",\n      accountListsURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas\",\n      customerDataIndentificationURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/dados-cadastrais\",\n      managerCharterizationURL:\n        \"https://api.safra.com.br/chat-assistente/contas-pessoa-fisica/v1/gerentes\",\n    },\n    \"HML\": {\n      tokenURL: \"https://sts-api-hml.safra.com.br/api/oauth/token\",\n      phoneIndentificationURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais\",\n      accountListsURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas\",\n      customerDataIndentificationURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/dados-cadastrais\",\n      managerCharterizationURL:\n        \"https://api-hml.safra.com.br/chat-assistente/contas-pessoa-fisica/v1/gerentes\",\n    },\n  };\n\n  return envSettings[env];\n}","inputVariables":["env"],"outputVariable":"envSettings","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c43b25be-a10a-4b17-8108-7f9a284fdcfe","$typeOfContent":"","type":"SetVariable","$title":"safraBotId","$invalid":false,"settings":{"variable":"safraBotId","value":"safraprodgerdigpf"},"conditions":[]},{"$id":"6967121f-40d4-44de-bc64-f7f22fb7f800","$typeOfContent":"","type":"SetVariable","$title":"clientSecret","$invalid":false,"settings":{"variable":"clientSecret","value":"ee1f5004-2400-4ab1-9af7-d9168d517204"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6239a068-368a-43fd-b642-3a8b170474c1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-682a8964-fb26-42ec-9f0b-4d774ac1776c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"b34040c5-af17-45f9-b86b-80c66c404a50","root":false,"$title":"[ENVIRONMENT SETTINGS]","$position":{"top":"416px","left":"645.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1a0c612-23cf-4cdd-90d0-488577ad654c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b394ca77-7b57-463c-8c25-e9bb2a03ef24","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"738f3f08-3ecb-42a6-9e34-b0c98d43a841","typeOfStateId":"state","$connId":"con_48","$id":"b4b10ac1-b973-423d-b3a6-b77039c0cfe2","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"customerFound"}],"$invalid":false},{"stateId":"facfc3e9-b838-42a8-b4f6-db9d1c11556b","typeOfStateId":"state","$connId":"con_53","$id":"4968e28b-4e1e-45ca-b965-a921eaa2089c","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"customerFound"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3e4944cf-9e69-4408-ab72-0f2d583e4126","$typeOfContent":"","type":"ExecuteScript","$title":"customerFound","$invalid":false,"settings":{"function":"run","source":"function run(statusTelIdent) {\n  const apiStatusRegExp = new RegExp(\"^2[0-9]{2}$\");\n  return apiStatusRegExp.test(statusTelIdent);\n}","inputVariables":["statusTelIdent"],"outputVariable":"customerFound","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusTelIdent"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9c32adb-68d5-498d-92ea-ab0e3dfa7461","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"a1a0c612-23cf-4cdd-90d0-488577ad654c","root":false,"$title":"[LO] Cliente encontrado?","$position":{"top":"882px","left":"646.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"738f3f08-3ecb-42a6-9e34-b0c98d43a841":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8317d8de-fce1-491c-b3c1-1f760e630ce1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8325d14c-c78f-4a7a-9c20-9ac10444761d","typeOfStateId":"state","$connId":"con_58","$id":"234f497e-b747-48ee-af7d-4431f62ef022","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"738f3f08-3ecb-42a6-9e34-b0c98d43a841","root":false,"$title":"[LO] Cliente Identificado (Sim)","$position":{"top":"997px","left":"428.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"facfc3e9-b838-42a8-b4f6-db9d1c11556b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9a4806c2-7579-4fa3-b2af-d0a768164525","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"872e291f-f7e3-47e4-bf53-a2fdc8d416b2","typeOfStateId":"state","$connId":"con_63","$id":"b4a56403-94c9-4136-a471-2ee30354da6a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"facfc3e9-b838-42a8-b4f6-db9d1c11556b","root":false,"$title":"[LO] Cliente Identificado (Não)","$position":{"top":"1016px","left":"848.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c695219-8026-443c-a4f1-68132d1b4803":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c6611948-44ea-4e09-ab41-06901d7eeceb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b86a601-9a6a-4460-9dee-a4fbe9026a3f","typeOfStateId":"state","$connId":"con_68","$id":"b3ad993d-6609-48be-8f5a-ab161f1dd560","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0f13b448-9c11-4d2b-b070-13a7d1bfb2d5","$typeOfContent":"","type":"ExecuteScript","$title":"userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  const DEFAULT_CHANNEL = \"other\";\n  const GOOGLE_CHANNEL = \"gbm\";\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n\n  const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n  const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n  const GOOGLE_IDENTIFIER = \"businessmessages.gw.msging.net\";\n  const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n  const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n\n  const CHANNEL_INDEX = 1;\n  const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL_INDEX];\n\n  switch (contactChannelIdentifier) {\n    case WHATSAPP_IDENTIFIER:\n      return WHATSAPP_CHANNEL;\n\n    case BLIPCHAT_IDENTIFIER:\n      return BLIPCHAT_CHANNEL;\n\n    case FACEBOOK_IDENTIFIER:\n      return FACEBOOK_CHANNEL;\n\n    case INSTAGRAM_IDENTIFIER:\n      return INSTAGRAM_CHANNEL;\n\n    case GOOGLE_IDENTIFIER:\n      return GOOGLE_CHANNEL;\n\n    default:\n      return DEFAULT_CHANNEL;\n  }\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0b3d078-ffcd-47ab-90bd-1e3be8a69ddb","$typeOfContent":"","type":"ExecuteScript","$title":"bold","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const GOOGLE_CHANNEL = \"gbm\";\n\n  switch (userChannel) {\n    case WHATSAPP_CHANNEL:\n      return {\n        open: \"*\",\n        close: \"*\",\n      };\n    case BLIPCHAT_CHANNEL:\n    case GOOGLE_CHANNEL:\n      return {\n        open: \"<b>\",\n        close: \"</b>\",\n      };\n    case FACEBOOK_CHANNEL:\n    case INSTAGRAM_CHANNEL:\n      return {\n        open: \"\",\n        close: \"\",\n      };\n  }\n\n  return {\n    open: \"<b>\",\n    close: \"</b>\",\n  };\n}","inputVariables":["userChannel"],"outputVariable":"bold","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"01def259-21f1-4de1-861e-0ef38b05e835","$typeOfContent":"","type":"ExecuteScript","$title":"italic","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const GOOGLE_CHANNEL = \"gbm\";\n\n  switch (userChannel) {\n    case WHATSAPP_CHANNEL:\n      return {\n        open: \"_\",\n        close: \"_\",\n      };\n    case BLIPCHAT_CHANNEL:\n    case GOOGLE_CHANNEL:\n      return {\n        open: \"<i>\",\n        close: \"</i>\",\n      };\n    case FACEBOOK_CHANNEL:\n    case INSTAGRAM_CHANNEL:\n      return {\n        open: \"\",\n        close: \"\",\n      };\n  }\n\n  return {\n    open: \"\",\n    close: \"\",\n  };\n}","inputVariables":["userChannel"],"outputVariable":"italic","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b5a3b0c-9a60-4e21-acb4-c9e3162cffbe","$typeOfContent":"","type":"ExecuteScript","$title":"platform","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  // const contactDomain = contactIdentity.split(\"@\")[1];\n\n  // switch (contactDomain) {\n  //   case \"wa.gw.msging.net\":\n  //   case \"tunnel.msging.net\":\n  //     return \"Whatsapp\";\n  //   case \"telegram.gw.msging.net\":\n  //     return \"Telegram\";\n  //   case \"messenger.gw.msging.net\":\n  //     return \"Messenger\";\n  //   case \"instagram.gw.msging.net\":\n  //     return \"Instagram\";\n  //   case \"0mn.io\":\n  //     return \"Blipchat\";\n  //   case \"mailgun.gw.msging.net\":\n  //     return \"email\";\n  //   case \"businessmessages.gw.msging.net\":\n  //     return \"gbm\";\n  // }\n\n  return \"Whatsapp\";\n}","inputVariables":["contact.identity"],"outputVariable":"platform","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3de4c1e-9544-4918-a0fe-97688e173d7c","$typeOfContent":"","type":"ExecuteScript","$title":"phoneNumber","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  const phoneNumber = contactIdentity.split(\"@\")[0];\n  const onlyNumbers = phoneNumber.replace(/\\D/g, \"\");\n  if (onlyNumbers.length < 12) return \"cannot get\";\n\n  const DDI = onlyNumbers.substring(0, 2);\n  const DDD = onlyNumbers.substring(2, 4);\n  const phone = onlyNumbers.substring(4);\n\n  return JSON.stringify({\n    DDI,\n    DDD,\n    phone,\n  });\n}","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e20a44e4-8639-4bb9-9ecd-cb49ddef1150","$typeOfContent":"","type":"MergeContact","$title":"Set PhoneNumber","$invalid":false,"settings":{"extras":{},"phoneNumber":"{{phoneNumber@DDI}}{{phoneNumber@DDD}}{{phoneNumber@phone}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"phoneNumber"}]},{"$id":"9335d785-07f6-44aa-8ff6-9a66f014e9cd","$typeOfContent":"","type":"ExecuteScript","$title":"Metadata","$invalid":false,"settings":{"function":"run","source":"function run(inputMessage) {\n  const inputMessageFormatted = JSON.parse(inputMessage);\n  const metadata = inputMessageFormatted.metadata;\n\n  if (metadata && metadata[\"#wa.referral.headline\"]) {\n    return JSON.stringify({\n      headline: metadata[\"#wa.referral.headline\"],\n      body: metadata[\"#wa.referral.body\"],\n      source_type: metadata[\"#wa.referral.source_type\"],\n      source_id: metadata[\"#wa.referral.source_id\"],\n      source_url: metadata[\"#wa.referral.source_url\"],\n      media_id: metadata[\"#wa.referral.image.id\"],\n    });\n  }\n\n  return JSON.stringify(inputMessageFormatted);\n}","inputVariables":["input.message"],"outputVariable":"metadata","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"input.message"}]},{"$id":"3df757f2-32c4-4c3c-a370-2bfb60b1a241","$typeOfContent":"","type":"ExecuteScript","$title":"MOCK phoneNumber FOR DEVELOPERS NUMBERS","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  return JSON.stringify({\n    \"DDI\": \"55\",\n    \"DDD\": \"11\",\n    \"phone\": \"973806326\"\n  });\n}\n //SCRIPT SÓ RODA QUANDO O CONTACT.IDENTITY CONTEM O NUMERO DE UM DOS DESENVOLVEDORES","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[{"values":["5531975705747","5511971704940"],"source":"context","comparison":"contains","variable":"contact.identity"}]},{"$id":"f11014e4-8f03-4991-90b2-e339ff1aa09d","$typeOfContent":"","type":"SetVariable","$title":"empty userInput","$invalid":false,"settings":{"variable":"userInput"},"conditions":[]}],"$leavingCustomActions":[{"$id":"ac978481-72d5-44b6-acc5-5fb9ef9e488d","$typeOfContent":"","type":"SetVariable","$title":"bo","$invalid":false,"settings":{"variable":"bo","value":"{{bold@open}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bold"}]},{"$id":"89b05175-e6cd-43b6-8c13-6c8d3d309e4b","$typeOfContent":"","type":"SetVariable","$title":"bc","$invalid":false,"settings":{"variable":"bc","value":"{{bold@close}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bold"}]},{"$id":"1d40e2b8-77e6-4880-91d0-93ca640f84cd","$typeOfContent":"","type":"SetVariable","$title":"io","$invalid":false,"settings":{"variable":"io","value":"{{italic@open}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"italic"}]},{"$id":"1efde720-8139-463f-9a67-a7feb93860aa","$typeOfContent":"","type":"SetVariable","$title":"ic","$invalid":false,"settings":{"variable":"ic","value":"{{italic@close}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"italic"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e8e04b20-9fb9-430c-bf09-78659361ba08","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-41decbb9-8823-4124-8b87-9855bd4ecf21","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-11631edb-2001-4d8c-9c71-020d7b48f377","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"8c695219-8026-443c-a4f1-68132d1b4803","root":false,"$title":"[REQUIREMENTS]","$position":{"top":"130px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0cf9f29a-0472-46df-ae36-20e3f79508e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"10c26107-6c39-44b5-a9b5-af21214d8d4d","typeOfStateId":"state","$connId":"con_73","$id":"087a9992-01a5-4a3f-92f3-f1579763dfcd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"815bfea0-f1dd-46f3-b45b-a731de22dde7","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@accountListsURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(documentBase, cpf) {\n  let base = documentBase;\n  if (!documentBase) base = cpf.slice(0, -2);\n\n  return JSON.stringify({\n    baseDocumento: base,\n    tipoPessoa: \"PF\",\n  });\n}","inputVariables":["documentBase","cpf"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"LISTA QUANTIDADE DE CONTAS","$invalid":false,"settings":{"headers":{"Safra-Bot-ID":"{{safraBotId}}","User-Agent":"Fiddler","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusAccountLists","responseBodyVariable":"responseAccountLists"},"conditions":[]},{"$id":"0d4c790d-315d-4b56-adcc-c8ba5c70f750","$typeOfContent":"","type":"ExecuteScript","$title":"customerAccounts","$invalid":false,"settings":{"function":"run","source":"function run(responseAccountLists) {\n  responseAccountLists = JSON.parse(responseAccountLists);\n  return JSON.stringify({\n    accounts: responseAccountLists.data,\n  });\n}","inputVariables":["responseAccountLists"],"outputVariable":"customerAccounts","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusAccountLists"}]},{"$id":"33f1197e-1a77-40d5-831b-b56281517358","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusAccountLists}} | {{responseAccountLists}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"10c26107-6c39-44b5-a9b5-af21214d8d4d","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ea84d4cb-4b1b-487b-8ab1-6e9c08c6a043","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5b987606-e282-46a9-8288-284e2f5ad118","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6571b1a1-88d4-4223-9c49-d115341521ad","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ca66ee71-2301-4eb0-8a7a-78738fa1183d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0cf9f29a-0472-46df-ae36-20e3f79508e9","root":false,"$title":"[API] LISTA QUANTIDADE DE CONTAS","$position":{"top":"1821.11px","left":"472.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"10c26107-6c39-44b5-a9b5-af21214d8d4d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72c4be29-d90a-430d-afc8-207359c9cb81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e91577bf-4ecd-48fa-8812-4c4e61629844","typeOfStateId":"state","$connId":"con_78","$id":"09497a59-7458-44e0-8340-131003b789fa","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveAnyAccount"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c88e3926-4b1f-4ee6-84b6-297d5668ff4d","$typeOfContent":"","type":"ExecuteScript","$title":"haveAnyAccount","$invalid":false,"settings":{"function":"run","source":"function run(statusAccountLists, customerAccounts) {\n  const httpStatusOkRegExp = /^2[0-9]{2}$/;\n  if (!httpStatusOkRegExp.test(statusAccountLists)) return false;\n\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.data;\n\n  return accounts.length ? true : false;\n}","inputVariables":["statusAccountLists","responseAccountLists"],"outputVariable":"haveAnyAccount","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ba5e05cc-5283-4327-85bc-c94c1c31ac16","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"10c26107-6c39-44b5-a9b5-af21214d8d4d","root":false,"$title":"[LO] Possui conta?","$position":{"top":"1982.33px","left":"471.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7f67c95-a085-461a-8ce6-4165162dd1f3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","typeOfStateId":"state","$connId":"con_83","$id":"1adf25db-e068-4174-ba57-c671704395e4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8d8ee891-ba5a-464b-b091-8dc80b2fd474","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{envSettings@tokenURL}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"bbc6c427-f3b9-4e05-af44-26702beb6928","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-19270fbb-70fe-4758-9fa2-addabab3159d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-93aef70b-5fe6-4d5a-81af-c4c7361c1979","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fac42fc4-bb1c-403d-ba36-9fc433db6a92","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-02d83877-2674-4343-8fca-518f597e1446","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"f7f67c95-a085-461a-8ce6-4165162dd1f3","root":false,"$title":"[API] TOKEN","$position":{"top":"1703px","left":"471.778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","commentsIdList":[]}},"e91577bf-4ecd-48fa-8812-4c4e61629844":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c300c442-1478-4053-a9d7-187127182ed0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","typeOfStateId":"state","$connId":"con_88","$id":"8dc06ce1-8e2e-49a7-99e4-df60ac69c379","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e91577bf-4ecd-48fa-8812-4c4e61629844","root":false,"$title":"[LO] Sim","$position":{"top":"2105px","left":"471px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0a31548-ebcb-457e-b9c2-1e31eedffb91","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","typeOfStateId":"state","$connId":"con_93","$id":"de585554-613d-4b35-9fc1-5a00107c5353","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea","root":false,"$title":"[LO] Não","$position":{"top":"2304.29px","left":"675.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0db8c9b1-f826-4ee2-a7cd-877dc177d168":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72c4be29-d90a-430d-afc8-207359c9cb81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"003aacd8-b430-48a3-bdb5-086e06563962","typeOfStateId":"state","$connId":"con_98","$id":"81769a02-af8e-42c3-a9e3-cad5c2865780","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveManyAccounts"},{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}],"$invalid":false},{"stateId":"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea","typeOfStateId":"state","$connId":"con_103","$id":"ded8fb00-ecc6-4caf-a79f-aff0fc2cdd4d","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"haveManyAccounts"}],"$invalid":false},{"stateId":"c7fc7784-b1cd-42e6-8ffd-21c98867bb74","typeOfStateId":"state","$connId":"con_108","$id":"b1a329c7-afcf-4a50-9ec0-2f785f32b1b4","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveManyAccounts"},{"values":["true"],"source":"context","comparison":"equals","variable":"isAccountInCache"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c88e3926-4b1f-4ee6-84b6-297d5668ff4d","$typeOfContent":"","type":"ExecuteScript","$title":"haveManyAccounts","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n\n  return accounts.length > 1 ? true : false;\n}","inputVariables":["customerAccounts"],"outputVariable":"haveManyAccounts","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8662626-26ec-45fd-86a1-0dacc170f661","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (agencia = false, conta = false) => {\n\ttry {\n\t\tif (conta && agencia) {\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contact.extras.conta","contact.extras.agencia"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"haveManyAccounts"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4798b971-fa73-492d-9f95-7204348eea53","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","root":false,"$title":"[LO] Possui mais de uma conta?","$position":{"top":"2197px","left":"470px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"003aacd8-b430-48a3-bdb5-086e06563962":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c300c442-1478-4053-a9d7-187127182ed0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"37df718d-571b-48d2-9714-a47329aa9326","typeOfStateId":"state","$connId":"con_113","$id":"bb0cfdd2-d138-47dd-9949-a3927b6861fb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"37df718d-571b-48d2-9714-a47329aa9326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"003aacd8-b430-48a3-bdb5-086e06563962","root":false,"$title":"[LO] Sim","$position":{"top":"2287px","left":"285px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"37df718d-571b-48d2-9714-a47329aa9326":{"$contentActions":[{"action":{"$id":"0fa91206-ef77-451f-ae7b-c56698f2e7dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"85afe670-761a-477a-bb50-eb5f11a1ff18","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"85afe670-761a-477a-bb50-eb5f11a1ff18","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e6637913-93db-4c07-a987-c826ff2c9c3e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9defc467-85f2-44a3-8568-e6b86ae67815","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae","typeOfStateId":"state","$connId":"con_118","$id":"6344b6d6-c7ea-4652-bc6b-af68d35875db","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"processedInput@input"}],"$invalid":false},{"stateId":"1d2549f7-5406-4598-b022-9bf845a798db","typeOfStateId":"state","$connId":"con_123","$id":"6da8b9eb-64f3-48a5-a699-72c973375f78","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"processedInput@isValid"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c53b1b07-4d91-4560-a8ea-98e09ac8fdff","$typeOfContent":"","type":"TrackEvent","$title":"Exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta exibicao conta exibicaoia","action":"Exibicao"},"conditions":[]},{"$id":"2efc1bb6-60d6-4f0f-abf5-014323c6f466","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, customerAccounts) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n\n    customerAccounts = JSON.parse(customerAccounts);\n\n    const accounts = customerAccounts.accounts;\n    const text = `Escolha qual a conta você quer\nseguir com o atendimento.`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    accounts.forEach((account, index) => {\n        options.push(`Conta: ${account.numeroConta}`);\n    });\n   accounts.forEach((account, index) => {\n        description.push(`AG: ${account.numeroAgencia}`);\n    });\n\n    options.push(\"Encerrar atendimento\");\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher conta',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","customerAccounts"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"acff923d-9176-4d25-b9bd-dd0e113f68e6","$typeOfContent":"","type":"SetVariable","$title":"typeError","$invalid":false,"settings":{"variable":"typeError","value":"menuDinamico"},"conditions":[]}],"$leavingCustomActions":[{"$id":"79af0c70-9064-4eaa-a266-8f272349299f","$typeOfContent":"","type":"ExecuteScript","$title":"processedInput","$invalid":false,"settings":{"function":"run","source":"function run(input, inputType, customerAccounts) {\n  const error = JSON.stringify({\n    status: \"input inválido\",\n    input: input ? input : \"usuário inativo\",\n    isValid: false,\n    type: \"menuDinamico\",\n  });\n\n  if (inputType !== \"text/plain\") return error;\n\n  customerAccounts = JSON.parse(customerAccounts);\n  input = input.trim();\n\n  // A opção e o número da opção são incluidos automaticamente na regexp\n  const menuOptions = {\n    \"Encerrar atendimento\": [\"encerrar\", \"sair\"],\n  };\n  const options = [\"Encerrar atendimento\"];\n  const accounts = customerAccounts.accounts;\n  const charLimit = 24;\n\n  accounts.forEach((account) => {\n    const textOption = `Conta: ${account.numeroConta}`;\n\n    if (textOption.length < charLimit) {\n      menuOptions[account.numeroConta] = [textOption];\n    } else {\n      menuOptions[account.numeroConta] = [];\n    }\n\n    options.push(account.numeroConta);\n  });\n\n  const matches = options.find((option, index) => {\n    let regexp = `^${option}$|`;\n    menuOptions[option].forEach((validationString) => {\n      validationString = validationString.replace(/^\\^|\\$$/g, \"\");\n      regexp += `^${validationString}$|`;\n    });\n    regexp += `^${index}$`;\n\n    return input.match(new RegExp(regexp, \"gim\"));\n  });\n\n  return matches\n    ? JSON.stringify({\n        status: \"input válido\",\n        input: matches,\n        isValid: true,\n        type: \"menuDinamico\",\n      })\n    : error;\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["input.content","input.type","customerAccounts"],"outputVariable":"processedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"11511b15-bdce-4aa5-a99b-523b1f98a4d6","$typeOfContent":"","type":"ExecuteScript","$title":"agency","$invalid":false,"settings":{"function":"run","source":"function run(processedInput, customerAccounts) {\n  processedInput = JSON.parse(processedInput);\n  customerAccounts = JSON.parse(customerAccounts);\n\n  const accounts = customerAccounts.accounts;\n  const selectedAccound = processedInput.input;\n  const accountFound = accounts.find(\n    (account) => account.numeroConta === selectedAccound\n  );\n\n  return accountFound ? accountFound.numeroAgencia : \"not found\";\n}","inputVariables":["processedInput","customerAccounts"],"outputVariable":"agency","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"},{"values":["Encerrar atendimento"],"source":"context","comparison":"notEquals","variable":"processedInput@input"}]},{"$id":"857b547e-87b1-4a39-a012-96dd49fc26d3","$typeOfContent":"","type":"SetVariable","$title":"account","$invalid":false,"settings":{"variable":"account","value":"{{processedInput@input}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"},{"values":["Encerrar atendimento"],"source":"context","comparison":"notEquals","variable":"processedInput@input"}]},{"$id":"0644ed59-b204-4e28-a1c1-91133c3c33d1","$typeOfContent":"","type":"TrackEvent","$title":"Selecao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta selecao","action":"{{processedInput@input}} | {{processedInput@status}}"},"conditions":[{"values":[],"source":"input","variable":"processedInput","comparison":"exists"},{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"}]},{"$id":"4f354dac-e0d9-4a62-9752-915bade6ef24","$typeOfContent":"","type":"TrackEvent","$title":"Inesperado","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["false"],"source":"context","comparison":"equals","variable":"processedInput@isValid"}]},{"$id":"1f9c424a-92c9-4be8-8d38-edb8dd299b65","$typeOfContent":"","type":"SetVariable","$title":"maisDeUmaConta","$invalid":false,"settings":{"variable":"maisDeUmaConta","value":"true"},"conditions":[]},{"$id":"2b24506d-1dba-4d6d-8737-7a3d65f893d0","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"agencia":"{{agency}}","conta":"{{account}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-bd42a61a-4a5f-4684-95e6-d2d6a727436c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1066ac44-f3ae-4c78-9ce4-d28b18182c01","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-11b3dff4-5906-47ce-a3d6-dca64c90233a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b25687eb-8ec4-4603-bdf0-da311b45910d","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-6ce7a9df-0b52-43e2-9795-096b611db7a4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-9693f0b6-70d8-4d7b-ab8e-0aabd300bc2f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"37df718d-571b-48d2-9714-a47329aa9326","root":false,"$title":"[S.0.0.4][MENU]","$position":{"top":"2437.5px","left":"156.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d9359361-57c8-4d39-a392-69b769f419d6","typeOfStateId":"state","$connId":"con_128","$id":"c40ec843-2bc1-4f3f-84b4-dc5f01399803","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47fb19ae-97b8-45a5-a9a9-55f1a3b05733","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{envSettings@tokenURL}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"566db329-3250-4b47-95c8-8ab581164fe8","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-095c8677-1d6c-46ef-91f3-9afdbb7f8075","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f68e5ba6-beb1-4f85-9064-e4734c77798a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b9b10f9f-4945-4253-9091-80bb99b94349","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-6d713075-2e56-4e15-b6e3-3232a0d86f93","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","root":false,"$title":"[API] TOKEN","$position":{"top":"2564.57px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","commentsIdList":[]}},"1d2549f7-5406-4598-b022-9bf845a798db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cf8d0062-29c3-482a-92e3-955fef4240e9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1d2549f7-5406-4598-b022-9bf845a798db","root":false,"$title":"[GO TO] Identificação dados cliente","$position":{"top":"2589.5px","left":"320.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5f7ad7cf-be36-4a51-8011-147230ec120a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","typeOfStateId":"state","$connId":"con_133","$id":"204b8e6c-10f7-437c-a97e-0cf4a716a503","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8cbc2047-3951-48c5-a1ee-ea9832f3d3c1","$typeOfContent":"","type":"ExecuteScript","$title":"agency","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].numeroAgencia;\n}","inputVariables":["customerAccounts"],"outputVariable":"agency","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8cd07d53-d3cb-4d50-aa0c-9732952df248","$typeOfContent":"","type":"ExecuteScript","$title":"account","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].numeroConta;\n}\n","inputVariables":["customerAccounts"],"outputVariable":"account","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"faf56847-8a41-466e-a185-650f2dfc6f07","$typeOfContent":"","type":"ExecuteScript","$title":"codCliente","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].codigoCliente;\n}\n","inputVariables":["customerAccounts"],"outputVariable":"codCliente","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-77f4845a-c08a-4d43-ac3c-e2e75a510e56","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","root":false,"$title":"[LO] Agencia/Conta","$position":{"top":"2414px","left":"675.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b86a601-9a6a-4460-9dee-a4fbe9026a3f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7731b29d-79e9-408d-868f-e704945aac88","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","typeOfStateId":"state","$connId":"con_138","$id":"8f5902c7-74fb-49c9-aae9-1bb487d7b61d","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"shouldIgnoreManager"}],"$invalid":false},{"stateId":"b34040c5-af17-45f9-b86b-80c66c404a50","typeOfStateId":"state","$connId":"con_143","$id":"c9227554-6f6b-433a-9868-25e15aaacdbc","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"shouldIgnoreManager"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"41e52afb-7158-41a2-8167-e96252b8b449","$typeOfContent":"","type":"ExecuteScript","$title":"ignoredManagersList","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return JSON.stringify([\n    {\n      name: \"Larrissa Marques\",\n      phoneNumber: \"11913529137\",\n    },\n    {\n      nome: \"Ana Paula A Gregório\",\n      phoneNumber: \"11970818618\",\n    },\n    {\n      nome: \"Erica Fernanda Ribeiro Silva\",\n      phoneNumber: \"11976900666\",\n    },\n    {\n      nome: \"Maria Gabriela F P de Oliveira\",\n      phoneNumber: \"11965982891\",\n    },\n    {\n      nome: \"Ana Paula Vicente S de Souza\",\n      phoneNumber: \"21973875675\",\n    },\n  ]);\n}\n","inputVariables":[],"outputVariable":"ignoredManagersList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f6c27603-d33b-4ada-8a89-7bd7c66a3598","$typeOfContent":"","type":"ExecuteScript","$title":"shouldIgnoreManager","$invalid":false,"settings":{"function":"run","source":"function run(ignoredManagersList, packsConfig) {\n  ignoredManagersList = JSON.parse(ignoredManagersList);\n  packsConfig = JSON.parse(packsConfig);\n\n  const routerPhone = packsConfig[\"PhoneNumber\"];\n  const managerFound = ignoredManagersList.find(\n    (manager) => manager.phoneNumber === routerPhone\n  );\n\n  return Boolean(managerFound);\n}","inputVariables":["ignoredManagersList","resource.packs.configuration"],"outputVariable":"shouldIgnoreManager","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ignoredManagersList"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3b2da7c1-acb6-49c2-a6c1-33f29d350f58","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7b86a601-9a6a-4460-9dee-a4fbe9026a3f","root":false,"$title":"[LO] Ignorar gerente?","$position":{"top":"256px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94ba7949-9cc9-457e-a542-2f3a8d76ee33":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e06cb4b8-6e15-429c-9968-2e276c9a053a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"343px","left":"872px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eec29ed0-812d-42fa-afd3-58e0dc4a5326":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"27a61707-69c2-4bf5-8e0d-23c5113b3d5e","$typeOfContent":"","type":"ExecuteScript","$title":"skpRedirectContent","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, inputType, serviceName, parentServiceName) {\n  return {\n        \"origin\": \"PreEnd\",\n        \"flow\": \"finalizacao\",\n        \"input\": {\n            \"content\": inputContent,\n            \"type\": inputType\n        } \n    };\n};","inputVariables":["input.content","input.type","config.serviceName","config.parentServiceName"],"outputVariable":"skpRedirectContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9e2830e3-5e5c-46a2-8307-27c5bfa29347","$typeOfContent":"","type":"Redirect","$title":"Redirect \"skpParentServiceName\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{skpRedirectContent}}"},"address":"{{config.parentServiceName}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3a74e35e-317f-47b2-954b-9c93b1c7fe2a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-10c3c467-c829-499a-9507-c7b0d766bdb1","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","root":false,"$title":"[Redirect] Employee Finalização","$position":{"top":"297px","left":"1510px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e65ae042-2867-4005-9f6f-c24781ded992":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"27a61707-69c2-4bf5-8e0d-23c5113b3d5e","$typeOfContent":"","type":"ExecuteScript","$title":"skpRedirectContent","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, inputType, serviceName, parentServiceName) {\n  return {\n        \"origin\": serviceName,\n        \"flow\": parentServiceName,\n        \"input\": {\n            \"content\": inputContent,\n            \"type\": inputType\n        } \n    };\n};","inputVariables":["input.content","input.type","config.serviceName","config.parentServiceName"],"outputVariable":"skpRedirectContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9e2830e3-5e5c-46a2-8307-27c5bfa29347","$typeOfContent":"","type":"Redirect","$title":"Redirect \"skpParentServiceName\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{skpRedirectContent}}"},"address":"{{config.parentServiceName}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7dd5f616-7d75-4a6e-987e-0e8bfc53805d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4ae5d82d-4978-4a76-b43b-4d8644459fe7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e65ae042-2867-4005-9f6f-c24781ded992","root":false,"$title":"[Redirect] Employee Transbordo","$position":{"top":"136px","left":"1258px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae","root":false,"$title":"[GO TO] Employee Finalização","$position":{"top":"2588.5px","left":"0px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4f2f8bca-5b12-450f-ab5a-cdfa022d2359":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"74f92265-ef2b-4c15-ab2e-f764d8b5320a","typeOfStateId":"state","$connId":"con_148","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"},{"values":["senha do cartao","senha transacional"],"source":"context","comparison":"contains","variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","typeOfStateId":"state","$connId":"con_153","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"},{"values":["senha do cartao","senha transacional"],"source":"context","comparison":"contains","variable":"intencaoIdentificada@intent"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run () {\n    return 'client_id=BLIP&grant_type=client_credentials&client_secret=5312b6d5-acb8-4165-9458-ef445876473e';\n}","inputVariables":[],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"https://api.safra.com.br/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{dadosCliente@documento}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\tconst cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoesAtivo\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn 0\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ce73b8b7-397a-4a13-b437-0e2bba5911ff","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-43be1bd1-1ea9-4cf0-8951-d9238d9e4b73","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-935ad15f-5013-4fbb-83c2-9da113a48dc1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","root":false,"$title":"[S.1.0.0] possui cartao?","$position":{"top":"1007px","left":"2272px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a7b4b5e0-118a-4a24-abe7-921da96f44bf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a81c2652-6c5c-4be0-899c-06b296aa5703","typeOfStateId":"state","$connId":"con_158","$id":"093a2a6a-e179-4910-b8b9-9bd05b76f497","conditions":[{"source":"context","comparison":"equals","values":["422"],"variable":"statusSenha"}],"$invalid":false},{"stateId":"22a29581-50cc-4866-b9c7-25f8b0d7e6b4","typeOfStateId":"state","$connId":"con_163","$id":"aea53c73-dca2-48d0-b913-5c6c249af32d","conditions":[{"source":"context","comparison":"equals","values":["Senha Transacional"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"ca9d3934-31b7-4812-b8d8-213d1cd6fecd","typeOfStateId":"state","$connId":"con_168","$id":"27d20aa2-d394-41fa-884c-cc329b14c857","conditions":[{"source":"context","comparison":"equals","values":["senha do cartao"],"variable":"intencaoIdentificada@intent"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"79abb350-68d3-43d9-b4b0-59bbc5517197","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP","$invalid":false,"settings":{"headers":{"amc-aplicacao":"IBJ","Content-Type":"application/json","Authorization":"Bearer {{token}}"},"method":"POST","body":"{\n  \"documento\": \"{{dadosCliente@documento}}\",\n  \"numeroCartao\": \"{{finalCartao}}\"\n}","uri":"https://api.safra.com.br/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/senhas/reemitir","responseStatusVariable":"statusSenha","responseBodyVariable":"responseSenha"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a5842ae7-d2cd-4683-8dc4-c486ddb51dc3","$typeOfContent":"","type":"MergeContact","$title":"set erro api","$invalid":false,"settings":{"extras":{"erro":"{{bodySenha}}"}},"conditions":[{"values":["204"],"source":"context","comparison":"notEquals","variable":"statusSenha"}]},{"$id":"e9351d9a-c19b-47df-9443-1547aeabc29f","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document, bodySenha) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha}  | ${bodySenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document","bodySenha"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0b79c298-5844-4aae-b9e5-cc0a612278dc","$typeOfContent":"","type":"TrackEvent","$title":"API senha","$invalid":false,"settings":{"extras":{},"category":"API senha","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ca3c0df0-b80e-4193-a8ad-c85feb5ec076","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0652dd24-e021-44b4-9612-a672c9bec002","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-90235c2e-702a-4565-888a-559aee199b62","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d9f9b3ec-10bf-459f-92d1-d2a1843a7006","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96","root":false,"$title":"[S.2.0.0] senha","$position":{"top":"1376px","left":"2274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"74f92265-ef2b-4c15-ab2e-f764d8b5320a":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","typeOfStateId":"state","$connId":"con_173","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Vi que você tem mais de um cartão do Safra.\nEscolhe o cartão que precisa da senha ou me manda os 4 últimos números do cartão que eu consulto aqui.`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-95721cae-9735-40b3-a555-836ef7f1336e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2932f2af-4d6c-4d3c-8820-85d1dff12c67","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-c9cf3ec1-aa35-4308-b0c3-b11524a3f645","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"74f92265-ef2b-4c15-ab2e-f764d8b5320a","root":false,"$title":"[S.1.0.1]+ 1 cartao","$position":{"top":"1117px","left":"2493px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96","typeOfStateId":"state","$connId":"con_178","$id":"5561f97b-bfe5-4b0f-b9ac-f4b159fc4eb3","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\t\t\t\n\t\t}\n\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-abdc3d38-2bdc-4201-afc4-2b3126cb30ec","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","root":false,"$title":"[S.1.0.2]dados cartao","$position":{"top":"1222px","left":"2274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ca9d3934-31b7-4812-b8d8-213d1cd6fecd":{"$contentActions":[{"action":{"$id":"b8d0d200-3e8d-4711-ba17-4cc6de4292dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"09e2d8d0-db23-4f84-995f-58ea428a1e88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"09e2d8d0-db23-4f84-995f-58ea428a1e88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7c5205c9-8ed6-41af-8a8c-12e39e0d87ce","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ddf27379-63a2-4bc7-a152-55d4a3f6f77b","type":"text/plain","content":"{{mensagem}}","metadata":{}},"$cardContent":{"document":{"id":"ddf27379-63a2-4bc7-a152-55d4a3f6f77b","type":"text/plain","content":"{{mensagem}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"43b855ee-f3b3-402f-884c-7ce60445fe21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a00cbee5-4a86-4f8d-b43c-66d9a5dde93e","$typeOfContent":"","type":"ExecuteScript","$title":"mensagem","$invalid":false,"settings":{"function":"run","source":"const run = (finalCartao, qtdCartoes) => {\n\n\tif(qtdCartoes === 'um')\treturn `Claro, enviei no seu e-mail o PDF com a senha do seu cartão final ${finalCartao}`\n\treturn 'Ótimo, enviei no seu e-mail o PDF com a senha do seu cartão.'\n}","inputVariables":["finalCartao","qtdCartoes"],"outputVariable":"mensagem","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d89a51ae-df92-4b23-8b9c-b09ea8f297ee","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f9b1d6ad-aa77-465a-afca-85c01ebd3846","$typeOfContent":"","type":"TrackEvent","$title":"senha cartao exibicao","$invalid":false,"settings":{"extras":{},"category":"senha cartao exibicao","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f15db4fc-36db-427f-bf7c-520c2a4118fe","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6cd9489f-b919-46dc-8a7b-11380f7581f8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-916ba253-2cc6-47de-a9f2-fbcbebf8cedb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ca9d3934-31b7-4812-b8d8-213d1cd6fecd","root":false,"$title":"[S.2.0.2] mensagem senha cartao","$position":{"top":"1447px","left":"2048px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"22a29581-50cc-4866-b9c7-25f8b0d7e6b4":{"$contentActions":[{"action":{"$id":"b083eaf8-e6a2-4b7f-ab59-d4ecde3805a7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"50751650-15b1-43e9-9823-5878673510e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"50751650-15b1-43e9-9823-5878673510e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ee42534-2af6-4263-ab9f-6ee39887a558","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3f69fa75-2105-479f-bdea-58de2a427d01","type":"text/plain","content":"Claro, enviei um PDF no seu e-mail com sua senha transacional.","metadata":{}},"$cardContent":{"document":{"id":"3f69fa75-2105-479f-bdea-58de2a427d01","type":"text/plain","content":"Claro, enviei um PDF no seu e-mail com sua senha transacional."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b7f03bea-65b7-4a1f-bbac-dd6de383f925","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c4798faf-f2c7-4e99-b78a-f29819f07560","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"daa65377-5402-4a4b-82ef-5a665e31c999","$typeOfContent":"","type":"TrackEvent","$title":"senha transacional exibicao","$invalid":false,"settings":{"extras":{},"category":"senha transacional exibicao","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ccef44ff-ba38-446f-b9ea-fc59b1fe1738","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3567395f-7a82-4c9f-9368-b2af5b1d234e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9dfb709c-36e3-4e90-85c1-098a524daaf5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"22a29581-50cc-4866-b9c7-25f8b0d7e6b4","root":false,"$title":"[S.2.0.1] mensagem senha transacional","$position":{"top":"1426px","left":"2494px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"257f1171-0297-4b48-8a1c-89a7959b201f":{"$contentActions":[{"action":{"$id":"5c4cc545-a9dc-42d8-8f97-5053697ab697","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed1b3173-87d9-412b-a602-0f703bee9fb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"{{mensagemOla}}","metadata":{}},"$cardContent":{"document":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"{{mensagemOla}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f38dcdda-ffa8-484d-984b-ed99704f4332","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","typeOfStateId":"state","$connId":"con_183","$id":"88ac7567-d95c-4fdf-8c70-16dc6fb5a061","conditions":[{"source":"context","comparison":"equals","values":["senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"ce73b8b7-397a-4a13-b437-0e2bba5911ff","typeOfStateId":"state","$connId":"con_188","$id":"068bbd4d-cc4e-4fee-b423-1a65b95aaeab","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f5d1137b-79a1-4a8f-ac78-edd355372dbf","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemOla","$invalid":false,"settings":{"function":"run","source":"const run = (nome, maisDeUmaConta = false) => {\n\t\tconst nomePequeno = nome.toLowerCase()\n\t\tnome = nomePequeno.replace(/^./, nomePequeno[0].toUpperCase()) //primeira letra maiuscula\n\t\tconst frases = ['Como posso te ajudar', 'Em que posso te ajudar', 'No que posso te ajudar', 'Como posso ajudar']\n\n\t\tconst index = Math.floor(Math.random()* 10 % 2)\n\t\tconst hora = new Date().getHours()\n\n\t\tlet greeting;\n\t\tif(hora >= 5 && hora< 12) {\n\t\t\tgreeting = 'bom dia'\n\t\t}else if(hora >= 12 && hora < 18) {\n\t\t\tgreeting = \"boa tarde\"\n\t\t} else if(hora>=18 || hora < 5) {\n\t\t\tgreeting = 'boa noite'\n\t\t}\n\n\t\treturn `Olá ${nome}, ${greeting}.\n\t\t\n${frases[index]}?`\n\n\n}","inputVariables":["nome","maisDeUmaConta"],"outputVariable":"mensagemOla","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4e1c5171-6212-4fc3-998e-6fe98f62cfee","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1d8e9e38-d8bd-4ba2-8336-2686e8aa8295","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = ( contact, intent) => {\n\tconst intencao = JSON.parse(intent)\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e798d6e1-07cb-4d06-b9fb-fb9c6a74c236","$typeOfContent":"","type":"TrackEvent","$title":"intencao Em que Posso ajudar","$invalid":false,"settings":{"extras":{},"category":"intencao Em que posso ajudar","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8aeefbd4-289d-4731-9428-60342d1d0aff","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0e0b1ced-488b-413c-94ba-a8b982084c25","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7ca1cfdf-21bc-494a-8491-a4933bf22f2f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0e7babcf-e0d9-45dc-9993-d76450d641a2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"257f1171-0297-4b48-8a1c-89a7959b201f","root":false,"$title":"Em que posso ajudar?","$position":{"top":"1260px","left":"198.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ce73b8b7-397a-4a13-b437-0e2bba5911ff":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e06cb4b8-6e15-429c-9968-2e276c9a053a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ce73b8b7-397a-4a13-b437-0e2bba5911ff","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"1409px","left":"22.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7fc7784-b1cd-42e6-8ffd-21c98867bb74":{"$contentActions":[{"action":{"$id":"0e16bcbd-29d5-419f-a0dd-3c9f78351cca","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"50ba1b1b-41fb-4ba4-874e-c895c0d0827d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"50ba1b1b-41fb-4ba4-874e-c895c0d0827d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"76d70635-744e-4e57-b69d-32982dbad6f5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"42e08227-0189-47be-ac76-7b38f10d9f1d","type":"text/plain","content":"Neste momento você está sendo atendido através da conta\n \nAgência: {{contact.extras.agencia}}\nConta: {{contact.extras.conta}}\n \nSe precisar trocar, é só me falar que altero pra você.","metadata":{}},"$cardContent":{"document":{"id":"42e08227-0189-47be-ac76-7b38f10d9f1d","type":"text/plain","content":"Neste momento você está sendo atendido através da conta\n \nAgência: {{contact.extras.agencia}}\nConta: {{contact.extras.conta}}\n \nSe precisar trocar, é só me falar que altero pra você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"57d8d937-48f6-4da8-8af0-d8500d92de51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bef6a3e2-6355-4e98-88cd-4887e0a27752","$typeOfContent":"","type":"SetVariable","$title":"agency","$invalid":false,"settings":{"variable":"agency","value":"{{contact.extras.agencia}}"},"conditions":[]},{"$id":"8a9eb21b-68b6-493b-ba49-ba68fd304f4c","$typeOfContent":"","type":"SetVariable","$title":"agency","$invalid":false,"settings":{"variable":"account","value":"{{contact.extras.conta}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d9359361-57c8-4d39-a392-69b769f419d6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-615ebad3-66ae-4d02-9c7e-4374839ce606","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3cde8916-ef3a-4d63-b136-c7c899b9b7e2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c7fc7784-b1cd-42e6-8ffd-21c98867bb74","root":false,"$title":"isAccountInCache","$position":{"top":"2170.86px","left":"680.286px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","typeOfStateId":"state","$connId":"con_193","$id":"5f7c2538-32ae-46ac-a15a-ee1797bf7ce9","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"OSADesligado"}],"$invalid":false},{"stateId":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","typeOfStateId":"state","$connId":"con_198","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_SENHA_TRANSACIONAL\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3c9670ac-daa9-4faa-a3af-32f16a581e83","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4d15f81f-8b8e-41c6-af97-218732744d3d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a70f0ddc-9071-41a6-83bb-3134fff5f6cc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"822px","left":"2272.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"19eb9819-6e40-4264-afa8-46d3ae5e3782":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"61ec3822-3b20-4fa7-b27d-520fc240a63f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f7f67c95-a085-461a-8ce6-4165162dd1f3","typeOfStateId":"state","$connId":"con_203","$id":"4867cbd2-e8d4-44c9-9348-f8162515acaf","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"19eb9819-6e40-4264-afa8-46d3ae5e3782","root":false,"$title":"Conta","$position":{"top":"1603px","left":"472.444px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8325d14c-c78f-4a7a-9c20-9ac10444761d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"403b443c-70ab-4f60-a8b2-2cf0086b9215","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9","typeOfStateId":"state","$connId":"con_208","$id":"183d046b-378c-4c0e-88c5-66840154c224","conditions":[{"source":"context","comparison":"contains","values":["senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"257f1171-0297-4b48-8a1c-89a7959b201f","typeOfStateId":"state","$connId":"con_213","$id":"002749c3-9935-40dc-b600-a7a4a5bf7a2d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"8325d14c-c78f-4a7a-9c20-9ac10444761d","root":false,"$title":"[LO] Define Redirect","$position":{"top":"1141px","left":"429.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9":{"$contentActions":[{"action":{"$id":"7416321b-1d5f-4354-9229-6d1ee5fa578c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0bb4c5e2-36db-42bf-94d3-fb760e983b3c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0bb4c5e2-36db-42bf-94d3-fb760e983b3c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b2399964-e106-46ed-8b89-457844098298","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a4d3db4c-b293-4419-8026-cb01da55f9ee","type":"text/plain","content":"{{mensagemOla}}","metadata":{}},"$cardContent":{"document":{"id":"a4d3db4c-b293-4419-8026-cb01da55f9ee","type":"text/plain","content":"{{mensagemOla}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e8971cf5-3890-4f91-9c01-b8df71c79f0c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","typeOfStateId":"state","$connId":"con_218","$id":"65694a40-7410-4ca8-8307-aebebd049444","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4819a63b-d618-45fc-88b9-ad2b2b44126c","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemOla","$invalid":false,"settings":{"function":"run","source":"const run = (nome, maisDeUmaConta = false, hour) => {\n\ttry {\n\t\tnome.toLowerCase()\n\t\tnome = nome.replace(/^./, nome[0].toUpperCase()) //primeira letra maiuscula\n\t\tlet greeting;\n\t\tif (hora >= 5 && hora < 12) {\n\t\t\tgreeting = 'Bom dia'\n\t\t} else if (hora >= 12 && hora < 18) {\n\t\t\tgreeting = \"Boa tarde\"\n\t\t} else if (hora >= 18 || hora < 5) {\n\t\t\tgreeting = 'Boa noite'\n\t\t}\n\n\t\treturn `Olá ${nome}, ${greeting}.`\n\t} catch (err) {\n\t\treturn hour\n\t}\n}","inputVariables":["nome","maisDeUmaConta","calendar.hour"],"outputVariable":"mensagemOla","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7f5c0f1d-f60b-4412-8aab-995add921e5f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9878c9fc-2357-40d9-846a-6b46506e636e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9","root":false,"$title":"[LO] Intencao Especifica","$position":{"top":"1254.5px","left":"652.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94f0d218-33bc-4943-965f-bfb4f0205121":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1f0e49ad-194d-43f3-a53c-1059fd49c0d6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"94f0d218-33bc-4943-965f-bfb4f0205121","root":false,"$title":"[GO TO] Conta","$position":{"top":"1439.25px","left":"434.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6409c653-f585-4dc3-8039-4c7453131a4f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3f370aae-e3cb-483c-978b-5f988b90e0d1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c789b4b6-f614-4658-98bd-3dc0a2ba0f48","typeOfStateId":"state","$connId":"con_223","$id":"68771426-1c14-4bc3-b4d3-e082091ee9a7","conditions":[{"source":"context","comparison":"contains","values":["senha do cartao","senha transacional"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"55270663-c4fc-4407-8ac5-e859e7d9d5f0","typeOfStateId":"state","$connId":"con_228","$id":"1d0f5912-779c-41a7-baed-913f4d034e11","conditions":[{"source":"context","comparison":"equals","values":["fatura do cartao"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"127757c2-0404-4ee1-887c-6b60d71a3a77","typeOfStateId":"state","$connId":"con_233","$id":"acbc2748-5086-4db3-9dbc-4d76da94722a","conditions":[{"source":"context","comparison":"equals","values":["posicao investimentos"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"1376549f-3a8a-4f11-869e-1960f295a5ef","typeOfStateId":"state","$connId":"con_238","$id":"bf740b6f-5c27-4084-81b8-3e1d2157309d","conditions":[{"source":"context","comparison":"equals","values":["extrato"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"cdd34564-0396-44f2-a37d-978173c3889d","typeOfStateId":"state","$connId":"con_243","$id":"b6aaddcb-0742-4ff2-864d-3ddb169e4cc4","conditions":[{"source":"context","comparison":"equals","values":["alterar conta"],"variable":"intencaoIdentificada@intent"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6409c653-f585-4dc3-8039-4c7453131a4f","root":false,"$title":"[LO] Redirect to Intent","$position":{"top":"2892px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c789b4b6-f614-4658-98bd-3dc0a2ba0f48":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"29db6934-db3e-4ec2-aa38-63e03e5e28f8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7f659926-dc88-4644-8b7a-f565172719dd","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c789b4b6-f614-4658-98bd-3dc0a2ba0f48","root":false,"$title":"[GO TO] Senha","$position":{"top":"3033px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7f659926-dc88-4644-8b7a-f565172719dd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4db89b2f-6610-4fef-a60d-397cfa0acb20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3","typeOfStateId":"state","$connId":"con_248","$id":"89d71240-6f55-4031-97de-0d19c5402a93","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"7f659926-dc88-4644-8b7a-f565172719dd","root":false,"$title":"[Inicio] Senha","$position":{"top":"673.667px","left":"2272px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"872e291f-f7e3-47e4-bf53-a2fdc8d416b2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cb24993-c716-4d70-bc9a-b0b5059007d3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"872e291f-f7e3-47e4-bf53-a2fdc8d416b2","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"1016px","left":"1068.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0901ef90-046a-400a-af6a-448451b6d2cd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8","root":false,"$title":"[GO TO] Conta","$position":{"top":"364.429px","left":"1251.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a81c2652-6c5c-4be0-899c-06b296aa5703":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b0581502-33d7-44e9-a2b8-ec69dc729fe0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"a81c2652-6c5c-4be0-899c-06b296aa5703","root":false,"$title":"[GO TO] employee transbordo","$position":{"top":"1527px","left":"2273px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a4d00d38-2ac4-4881-8808-879f3ce6b708":{"$contentActions":[{"action":{"$id":"5c4cc545-a9dc-42d8-8f97-5053697ab697","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed1b3173-87d9-412b-a602-0f703bee9fb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"Posso te ajudar em algo mais?","metadata":{}},"$cardContent":{"document":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"Posso te ajudar em algo mais?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f38dcdda-ffa8-484d-984b-ed99704f4332","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"82b39c20-032f-4780-b029-808ba2c0d66b","typeOfStateId":"state","$connId":"con_253","$id":"88ac7567-d95c-4fdf-8c70-16dc6fb5a061","conditions":[{"source":"context","comparison":"equals","values":["senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos","alterar conta"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"3f739f15-0056-45e3-89b4-29d2ae4d3efa","typeOfStateId":"state","$connId":"con_258","$id":"d3cec968-0120-4586-8aad-7f0289dd777c","conditions":[{"source":"context","comparison":"contains","values":["Negation"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"0a5d086c-c13b-4968-9cb7-c02643c07bd1","typeOfStateId":"state","$connId":"con_263","$id":"068bbd4d-cc4e-4fee-b423-1a65b95aaeab","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4e1c5171-6212-4fc3-998e-6fe98f62cfee","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5e790807-8af2-4707-8bcf-189cddaaa279","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = ( contact, intent) => {\n\tconst intencao = JSON.parse(intent)\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4602aedf-7f28-42c4-ac41-dfde63fada53","$typeOfContent":"","type":"TrackEvent","$title":"intencao te ajudo em algo mais","$invalid":false,"settings":{"extras":{},"category":"intencao Te ajudo em algo mais","action":"{{tracking}}"},"conditions":[]},{"$id":"0f119d00-08fc-4fb6-8de9-6794cc8861cd","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"ac347e98-44d3-42fd-ab3e-5ca00b54e487","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-539cddc1-2217-4dcf-93b7-a3819b89abf5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9a80fd75-160b-436a-b182-bfdccb72ef59","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ad8feec4-4e7f-48a5-a040-603c1841cbec","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-70a8e8b8-bb01-4104-8a7b-7384d101ea09","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-99bc1789-2a20-4308-8941-06a64e082f69","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a4d00d38-2ac4-4881-8808-879f3ce6b708","root":false,"$title":"Te ajudo em algo mais","$position":{"top":"83px","left":"2773px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0a5d086c-c13b-4968-9cb7-c02643c07bd1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e06cb4b8-6e15-429c-9968-2e276c9a053a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"0a5d086c-c13b-4968-9cb7-c02643c07bd1","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"177.5px","left":"2986px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"82b39c20-032f-4780-b029-808ba2c0d66b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8d2163b-31be-4d33-aa98-1389077a0ac0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c8d5f1bd-0750-43c6-aa70-dd9111348ea4","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn false;\n}","inputVariables":[],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9a703522-4fdd-4d5c-b105-1afd0db4cb0f","$typeOfContent":"","type":"SetVariable","$title":"agencia","$invalid":false,"settings":{"variable":"agencia"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"aa91c109-8689-4406-bfb0-777477215fe9","$typeOfContent":"","type":"SetVariable","$title":"conta","$invalid":false,"settings":{"variable":"conta"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"87e764c7-eebc-4baa-a56b-f333e46b8cda","$typeOfContent":"","type":"MergeContact","$title":"conta/agencia","$invalid":false,"settings":{"extras":{"conta":"{{conta}}","agencia":"{{agencia}}"}},"conditions":[{"values":["false"],"source":"context","variable":"isAccountInCache","comparison":"equals"}]},{"$id":"4c1ccb19-42a4-4d40-af7e-dee456251556","$typeOfContent":"","type":"SetVariable","$title":"intencao","$invalid":false,"settings":{"variable":"intencao","value":"{{input.intent.name}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-01b204fa-1d67-4c6f-bdd0-72fdaea9facc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-eecd4c0f-c6a2-491f-88d8-e4a5318b3b62","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-244e7aca-95f6-4ecf-bdb8-da987becb3de","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"82b39c20-032f-4780-b029-808ba2c0d66b","root":false,"$title":"[GO TO] Conta","$position":{"top":"25px","left":"2985px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a35fa267-f2b7-4298-83d9-b0924114e971":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"85a9c4c8-745d-4f90-84fb-0d7054fe9048","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"871d7bbd-2b33-4a84-b028-b6e692ed9510","typeOfStateId":"state","$connId":"con_268","$id":"0799e07e-6c68-4d66-93db-731882a29c75","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["extratoDataInvalida"],"source":"context","comparison":"equals","variable":"dataExtractor@error"},{"values":["871d7bbd-2b33-4a84-b028-b6e692ed9510"],"source":"context","comparison":"notEquals","variable":"state.previous.id"}],"$invalid":false},{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","typeOfStateId":"state","$connId":"con_273","$id":"684758e1-01af-41cd-a10c-8e71515ff988","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1e6bd2c1-66d3-490f-9fd8-414b7ab0c81b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"8e5c42e8-afdc-47ed-a38d-9f0ce3f6b929","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, statePreviousId, smalltalks) {\n  try {\n    if (smalltalks && smalltalks.includes(\"Confirmation\") && statePreviousId === '871d7bbd-2b33-4a84-b028-b6e692ed9510') {\n      const currentDate = new Date();\n      const endDate = currentDate;\n      const startDate = new Date(currentDate.getTime() - 30 * 24 * 60 * 60 * 1000);\n      return `${formatDate(startDate)}|${formatDate(endDate)}`;\n    }\n\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n        return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n\n      return `${formatDate(startDate)}|${formatDate(endDate)}`; // Retorna as datas \n    } else {\n      return { error: 'extratoDataInvalida' };\n    }\n\n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","state.previous.id","bodySmallTalks"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b49e58c-0e49-46dd-8ada-a72a82f2fb15","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dataExtractor@error\"","$invalid":false,"settings":{"variable":"exceptionType","value":"{{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]}],"$leavingCustomActions":[{"$id":"a324f2ac-e7dd-462b-8481-9c7e796c3d12","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input inesperado\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input inesperado","action":"{{state.previous.name}} | {{dataExtractor@error}} | {{input.content}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"03afa7a9-af25-4854-909f-4ef6560f9698","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato error\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato error","action":"{{state.previous.name}} | {{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"08e90e47-63cf-48ed-98e7-c6907d863acb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input","action":"{{state.previous.name}} | {{input.content}} | {{dataExtractor}}"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4b373548-9cd8-4357-b5b6-9a105c1b9e65","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7c09a0f2-85a0-4f49-bcf6-3c61b064100b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-92bb0709-7d6b-402d-bdf6-79d921e917bc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"a35fa267-f2b7-4298-83d9-b0924114e971","root":false,"$title":"[E.1.0.0][SET] Valida input do usuario","$position":{"top":"790.75px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"871d7bbd-2b33-4a84-b028-b6e692ed9510":{"$contentActions":[{"action":{"$id":"c2e2aa97-b7f7-4109-aa5e-b5f8ff075ebb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31a774e3-1d14-4de6-bf94-f2e868f9f018","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 30 dias mesmo?","metadata":{}},"$cardContent":{"document":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 30 dias mesmo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c3010671-a4a8-40a4-bba4-45ecfb8bf0dc","type":"text/plain","textContent":"Entrada do usuário","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_278","$id":"7d932bee-eec1-4f19-af13-fb5eab80f880","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c42adbc3-7434-4ba0-bdce-f7172bacdf40","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"69e4094c-6b73-4d36-9f82-de14b9701e33","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"24eb1e8d-1c43-4ecb-ba40-cf5e09bf3d1e","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"cb116792-f53d-4b60-9840-c6b840b70078","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-45b885e8-0372-462b-8461-4e46418ec242","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ecba9404-a713-43d1-93ef-c9209763f834","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a2e7652f-a7b8-411a-9c33-eb3902b191ae","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bb7abae5-bbf7-4c03-bfaa-2bb2e8ce391f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-46a3c2fb-0eca-438e-b09b-c1bc9b447237","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"871d7bbd-2b33-4a84-b028-b6e692ed9510","root":false,"$title":"[E.2.0.0][MSG][INPUT] Pergunta periodo","$position":{"top":"791px","left":"3579px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"84742bd8-cf3a-42eb-9872-710107fa5f1c":{"$contentActions":[{"action":{"$id":"7e814284-3609-4a10-ae82-7a8fe2fd8cfd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6612a786-a055-4b8f-aeb3-7a44de14d182","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6612a786-a055-4b8f-aeb3-7a44de14d182","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2d1823fb-ba74-43ea-ac44-2e995d8cf979","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d89cb8ee-04d5-42d5-9da7-c02f2009226d","type":"text/plain","content":"<b>[Homologação]</b>\n<i>Estamos enviando o extrato do seguinte período identificado:</i>\n{{dataExtractor}}","metadata":{}},"$cardContent":{"document":{"id":"d89cb8ee-04d5-42d5-9da7-c02f2009226d","type":"text/plain","content":"<b>[Homologação]</b>\n<i>Estamos enviando o extrato do seguinte período identificado:</i>\n{{dataExtractor}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"704f8e0c-512c-44bd-8610-570d27ba2318","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"116ba504-bb26-46fe-a74c-b5c69bf357b1","typeOfStateId":"state","$connId":"con_283","$id":"680ab48e-6724-42a4-b347-c8f6bb2b2a94","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e4399cb-56e8-4301-bb19-311701963b5f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"320e7bbc-121f-4624-96c5-11e42d9203c0","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" to \"\"","$invalid":false,"settings":{"variable":"SmallTalksIdentified"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c9b69054-c9a2-4ecc-b138-0e432cae50b3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-00ed9b22-3b79-4a67-b0e5-53e7a133f1f1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6a95816a-cf4d-4b96-8885-8e42e6156636","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"84742bd8-cf3a-42eb-9872-710107fa5f1c","root":false,"$title":"[E.3.0.0][SET] Periodo identificado","$position":{"top":"972px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"116ba504-bb26-46fe-a74c-b5c69bf357b1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4f2d3b75-84c0-45a8-b360-7f2c6d54c651","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"76e66b96-c6e8-466c-86f4-f626d201cf17","typeOfStateId":"state","$connId":"con_288","$id":"d037e357-9421-4aa6-a28d-0f713698a796","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"dentroDosTrintaDias"},{"values":["200","202"],"source":"context","comparison":"equals","variable":"statusEnvioExtrato"}],"$invalid":false},{"stateId":"d71495a0-6203-423b-aace-67e3f4df6e8d","typeOfStateId":"state","$connId":"con_293","$id":"ab69c031-b50f-4452-afb5-55f5ee35a4a2","conditions":[{"source":"context","comparison":"equals","values":["200","202"],"variable":"statusEnvioExtrato"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b123ae2f-d64e-4d7e-9f0a-deaf7bfcbbf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"15145df0-8255-4969-be2e-3815b8cbe69b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyExtrato\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, dataExtractor) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tlet data = dataExtractor.split('|');\n\t\treturn {\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"dataInicial\": data[0],\n\t\t\t\"dataFinal\": data[1],\n\t\t\t\"limite\": \"100\",\n\t\t\t\"pagina\": \"1\"\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","dataExtractor"],"outputVariable":"bodyExtrato","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b99e86a4-7aa9-45a0-ace8-0a0313f88277","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioExtrato","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/extratos/notificar","responseStatusVariable":"statusEnvioExtrato","responseBodyVariable":"responseEnvioExtrato","body":"{{bodyExtrato}}"},"conditions":[]},{"$id":"9faa9ff1-b545-4baf-a1ae-d75b5278dbd9","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusEnvioExtrato"}]}],"$leavingCustomActions":[{"$id":"15f80a3c-18f8-4740-bfc5-bda768be8b26","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dentroDosTrintaDias\"","$invalid":false,"settings":{"function":"run","source":"function run(dateRange) {\n  const dates = dateRange.split('|');\n  const startDate = new Date(dates[0]);\n  const endDate = new Date(dates[1]);\n\n  const today = new Date();\n  const thirtyDaysAgo = new Date(today);\n  thirtyDaysAgo.setDate(today.getDate() - 30);\n\n  return startDate >= thirtyDaysAgo && endDate <= today;\n}","inputVariables":["dataExtractor"],"outputVariable":"dentroDosTrintaDias","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-583289fc-72a4-4ded-8b6c-206751a589f9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f5746399-9e27-44e3-9808-a432c3a02b0c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e9a39e50-0477-4be3-89b3-3f64a9a8d9ec","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d36e09af-e08f-43a7-997d-0d4a35135379","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"116ba504-bb26-46fe-a74c-b5c69bf357b1","root":false,"$title":"[E.4.0.0][HTTP] Chamada API extrato","$position":{"top":"1228px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d71495a0-6203-423b-aace-67e3f4df6e8d":{"$contentActions":[{"action":{"$id":"29bed67c-944d-44ae-879f-ddc9e2b59535","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1be677b9-0ba2-4253-8195-0c2df8f53386","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1be677b9-0ba2-4253-8195-0c2df8f53386","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"46cc202b-1b1f-4d35-ba89-0a4374bd464b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e6d6973b-27a7-47ad-ab69-49cd141b72b3","type":"text/plain","content":"Vou te mandar o extrato no seu email.","metadata":{}},"$cardContent":{"document":{"id":"e6d6973b-27a7-47ad-ab69-49cd141b72b3","type":"text/plain","content":"Vou te mandar o extrato no seu email."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac9e2a78-d133-4eb0-9e06-3edb448dab26","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"feacc199-138a-4b53-97c5-4df7b2f4c4a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"6000"},"metadata":{}},"$cardContent":{"document":{"id":"feacc199-138a-4b53-97c5-4df7b2f4c4a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"6000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"17b054b5-dee7-4578-b44d-10efb424d5af","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2cab5dac-8e04-4681-b3dd-eb0d9190f2a2","type":"text/plain","content":"Pronto, já enviei pra você.","metadata":{}},"$cardContent":{"document":{"id":"2cab5dac-8e04-4681-b3dd-eb0d9190f2a2","type":"text/plain","content":"Pronto, já enviei pra você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39e7ffb0-588b-41df-a249-cdc91ff8dcb5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","typeOfStateId":"state","$connId":"con_298","$id":"35de290e-abe4-40d8-a726-7132d31e8e42","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3278d444-f319-4c66-bec9-756745c09af5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bc73d71b-6565-49d2-8bb1-612b5a8a9656","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8c187a76-569b-42db-88b7-ad2a0d81cf24","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d71495a0-6203-423b-aace-67e3f4df6e8d","root":false,"$title":"[E.5.1.0][MSG] Extrato periodo superior a 30 dias","$position":{"top":"1413px","left":"3521px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"76e66b96-c6e8-466c-86f4-f626d201cf17":{"$contentActions":[{"action":{"$id":"afb67201-0ee5-440d-9044-1db7ce8a730d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ab33e144-dd1a-494c-8d29-e2286c26cec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ab33e144-dd1a-494c-8d29-e2286c26cec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8211c06a-a0d3-4b14-91d6-0fe471315a05","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c0b76e85-85bf-48ec-949c-e3369a685a77","type":"text/plain","content":"Pronto, mandei no seu e-mail o extrato de conta corrente.","metadata":{}},"$cardContent":{"document":{"id":"c0b76e85-85bf-48ec-949c-e3369a685a77","type":"text/plain","content":"Pronto, mandei no seu e-mail o extrato de conta corrente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"68ac32a9-f842-40b9-a31d-ecdd4319d48b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","typeOfStateId":"state","$connId":"con_303","$id":"13504498-eb7a-48b7-9020-3a0397e0be89","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"177d52fa-e9af-4381-a06a-a327c6c4720c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d326d16d-e9d2-4403-ad75-9ea7fa00c64a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0d825c72-e794-4bc7-98b8-f05f31c6f658","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"76e66b96-c6e8-466c-86f4-f626d201cf17","root":false,"$title":"[E.5.0.0][MSG] Extrato dos ultimos 30 dias","$position":{"top":"1425px","left":"3082px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55a7184f-25ce-4f2d-a9e5-99adb4b54b43":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5822295d-51e6-42a6-ae0e-28bb39a46558","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d5a63910-77b8-414a-97ea-21e82114edd9","typeOfStateId":"state","$connId":"con_308","$id":"fdbe7338-e666-4cb1-9301-1cdb5e300ffa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"feca63b9-ee12-4878-824a-3d9bd6d5bc7c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-228bf4e7-e072-433f-9500-1caac07f665e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","root":false,"$title":"[E.6.0.0] Finalização jornada extrato","$position":{"top":"1689px","left":"3305px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c606331c-9875-44ec-bdb4-da4571c9dd01","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5aba1012-65f4-4562-9aa9-419d0b772741","typeOfStateId":"state","$connId":"con_313","$id":"a78c027b-40db-464b-8ffc-659e1ed74f06","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a","root":false,"$title":"[Inicio] Extrato","$position":{"top":"496px","left":"3294.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0fb18c4b-3d1a-4905-b922-197db4f5d1c8":{"$contentActions":[{"action":{"$id":"232e975d-726f-4a57-bda5-a2bced451599","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d6e3eae9-acca-4410-9841-862c3e5d5819","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d6e3eae9-acca-4410-9841-862c3e5d5819","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d6594ec-3e50-446a-91f3-0e1dee0e70c5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"be7a0115-d4a9-4a28-ad1a-fccb560179d6","type":"text/plain","content":"Eu só consigo te mandar o extrato de até dois anos.","metadata":{}},"$cardContent":{"document":{"id":"be7a0115-d4a9-4a28-ad1a-fccb560179d6","type":"text/plain","content":"Eu só consigo te mandar o extrato de até dois anos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"13edf47f-db94-4720-9248-40abcb638142","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6e74e30b-8e31-43d5-bf54-7d89eed6c0d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6e74e30b-8e31-43d5-bf54-7d89eed6c0d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"020184c4-1b78-4cf8-a7d5-da43e481d5f6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"27347564-ac1d-4483-988a-2c1a2c169e53","type":"text/plain","content":"Eu posso te enviar de algum outro período dentro de 2 anos.\nPode ser?","metadata":{}},"$cardContent":{"document":{"id":"27347564-ac1d-4483-988a-2c1a2c169e53","type":"text/plain","content":"Eu posso te enviar de algum outro período dentro de 2 anos.\nPode ser?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"cede0f5a-5453-45c2-a4fd-e95e478bdd14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d656533c-7bf1-4c99-9309-c499e37ac1b4","typeOfStateId":"state","$connId":"con_318","$id":"39c07ed9-150c-4b78-af02-e1122d9f5c35","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"},{"values":["Confirmation"],"source":"context","comparison":"contains","variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"36276848-e740-4865-8e94-708187eaf9f4","typeOfStateId":"state","$connId":"con_323","$id":"2dcbac91-64d2-4ccb-9f32-e2004343929e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5635f770-a2b5-4769-98bf-0688c27a73b1","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]}],"$leavingCustomActions":[{"$id":"beb72ee9-e004-40ba-acb1-7cc8deaefe3e","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"09f3494b-a751-4e29-99a2-7e61d5fc7608","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e22ff38c-8ab9-4617-820e-3462c58fbe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, smalltalks, statePreviousId) {\n  try {\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n          return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n          return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n      \n      // Removendo a validação de 90 dias\n      return `${formatDate(startDate)} - ${formatDate(endDate)}`; // Retorna as datas sem validação\n  } else {\n    return { error: 'extratoDataInvalida' };\n  }\n  \n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","SmallTalksIdentified","state.previous.id"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3fe1fa9d-e114-455c-a428-49e039096674","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ac5ed65f-c3af-45d8-be7e-29715bf6fd56","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f7d4c960-2760-45c7-a5f7-42c93ed2292d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-3443c1aa-cec7-477a-a2b5-20fea872a8df","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fc95f548-a05c-4b64-bf46-332ae7463e2d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9e6ca21f-b654-4c43-b031-c8199df4330f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b624c630-6cd0-4068-8ba1-525db1e9318d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0fb18c4b-3d1a-4905-b922-197db4f5d1c8","root":false,"$title":"[Exceção][Extrato] Periodo superior a 2 anos","$position":{"top":"153px","left":"1780px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36276848-e740-4865-8e94-708187eaf9f4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a4d4d95-25b1-454f-9cdc-ef3b0b29b04f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"36276848-e740-4865-8e94-708187eaf9f4","root":false,"$title":"[GO TO] [E.3.0.0][SET] Periodo identificado","$position":{"top":"210.333px","left":"2029px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d656533c-7bf1-4c99-9309-c499e37ac1b4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"15c780e0-24f8-44e7-9144-6c6dba1df205","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"871d7bbd-2b33-4a84-b028-b6e692ed9510","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d656533c-7bf1-4c99-9309-c499e37ac1b4","root":false,"$title":"[GO TO][E.2.0.0] Pergunta periodo","$position":{"top":"361px","left":"2023px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d5a63910-77b8-414a-97ea-21e82114edd9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5b5edd6a-0a08-4d8f-b469-30a5f7be519c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d5a63910-77b8-414a-97ea-21e82114edd9","root":false,"$title":"[GO TO] Te ajudo em algo mais","$position":{"top":"1891px","left":"3305px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e92decba-2f27-4b5b-a0ec-c761214c6811":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5064a085-443c-419b-b25e-b6ffa7059ce0","typeOfStateId":"state","$connId":"con_328","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"e92decba-2f27-4b5b-a0ec-c761214c6811","root":false,"$title":"[Inicio] Posicao Investimento","$position":{"top":"272px","left":"4310px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"15a79232-ef1a-4238-9477-382cae383baf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76052a9b-f55c-4fd6-8ac8-da0510909330","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00","typeOfStateId":"state","$connId":"con_333","$id":"cb9cb40d-af26-4aeb-86d0-2dd147eb7fd5","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"email"}],"$invalid":false},{"stateId":"5215041d-b5f5-49eb-895c-0648cc1546a1","typeOfStateId":"state","$connId":"con_338","$id":"d6317b53-b402-4aa0-af65-27b8293d6b92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"036556d2-9bbe-4d55-9702-aacf808a6c86","$typeOfContent":"","type":"SetVariable","$title":"Set \"PossuiEmails\"","$invalid":false,"settings":{"variable":"PossuiEmails","value":"{{contact.email}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-74e25261-3e1a-418b-be4f-77380c72585b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"15a79232-ef1a-4238-9477-382cae383baf","root":false,"$title":"[PI.2.0.0][SET] Tem Email?","$position":{"top":"939px","left":"4307.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3c80ea3-9508-44e7-9d24-73fcd3780435","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba","typeOfStateId":"state","$connId":"con_343","$id":"a12de166-4304-4415-baa9-e63cee99fca5","conditions":[{"source":"context","comparison":"equals","values":["200","202","204"],"variable":"statusEnvioPosicaoInvestimento"}],"$invalid":false},{"stateId":"36730683-8874-4b01-af50-a78da194c2d1","typeOfStateId":"state","$connId":"con_348","$id":"58fdd2cd-584c-4153-98f9-9daa8fdaf332","conditions":[{"source":"context","comparison":"equals","values":["404"],"variable":"statusEnvioPosicaoInvestimento"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9b407411-0fbf-4259-9828-5dad272400f9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"79be6e3e-488c-4887-abc0-340af9124931","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusEnvioEmailInvestimento"}]},{"$id":"dce5fa17-2588-4453-af45-f3754ce37c50","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyPosicaoInvestimento\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, segmentCode, customerName) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\treturn {\n\t\t\t\"nome\": customerName,\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"segmento\": segmentCode\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","segmentCode","customerName"],"outputVariable":"bodyPosicaoInvestimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4d7fed09-e1f7-4511-b113-b441d4062ab7","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioPosicaoInvestimento","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/gerenciamento-investimentos/posicao-investimentos/assistente-virtual/v1/posicoes-investimentos/relatorios/enviar","responseStatusVariable":"statusEnvioPosicaoInvestimento","responseBodyVariable":"responseEnvioPosicaoInvestimento","body":"{{bodyPosicaoInvestimento}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f1a22b01-53b8-43bb-9dce-69f8e26bc3ee","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-590e99d4-6754-4cbd-8ec7-818cbed5110c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0d97d90b-6995-4146-921c-e202449df55f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-602914cd-4d53-4b54-b66f-8416bd36e165","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00","root":false,"$title":"[PI.3.0.0][HTTP] Cockpit Envio Email","$position":{"top":"1097px","left":"4308px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba":{"$contentActions":[{"action":{"$id":"3ffa3499-b5f6-4813-ac8f-229e2a32e38a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"540fd19b-d231-4461-894a-9f85e590148e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"540fd19b-d231-4461-894a-9f85e590148e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dab25d29-83a8-4221-92fd-2f4ca5b23c37","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ee27f1c8-b8f9-4886-af69-c45e6bb7d862","type":"text/plain","content":"Enviei o PDF com essas informações no seu e-mail. Dá uma olhada lá, que te mandei agora.","metadata":{}},"$cardContent":{"document":{"id":"ee27f1c8-b8f9-4886-af69-c45e6bb7d862","type":"text/plain","content":"Enviei o PDF com essas informações no seu e-mail. Dá uma olhada lá, que te mandei agora."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"541d072d-0f81-462f-9dbf-461e52f1869d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","typeOfStateId":"state","$connId":"con_353","$id":"26541ff9-3045-4160-94e1-2e42afefb080","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"acd10bdc-5e59-477b-a444-9874bb17576a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5cd51785-ecda-45d8-a908-9712077a8a17","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-81a8d353-8085-4004-892f-a89330acce12","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba","root":false,"$title":"[PI.3.0.1][MSG] Email Enviado","$position":{"top":"1317px","left":"4118px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62aec317-124c-4a6f-8eb5-347b96526b10":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"62aec317-124c-4a6f-8eb5-347b96526b10","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"826px","left":"4548px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"721152e9-4da1-4e8f-889c-f7edd710a8d5","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708"},"isAiGenerated":false,"$tags":[],"id":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","root":false,"$title":"[GO TO] Finalizacao","$position":{"top":"1478.5px","left":"4302.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"c6b1d835-f571-4c7a-975d-6e088158bc68":{"$contentActions":[{"action":{"$id":"953d30c2-836a-4e4f-8caa-f643dcef106f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"321c788b-6b3b-4b10-a4d9-03c491e0a9cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"321c788b-6b3b-4b10-a4d9-03c491e0a9cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0487808c-5f3b-4b84-b18c-5bf249875e03","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6f73761f-5d9e-4471-b3de-a683244cdd2e","type":"text/plain","content":"No momento, estamos enfrentando instabilidade em nosso sistema.","metadata":{}},"$cardContent":{"document":{"id":"6f73761f-5d9e-4471-b3de-a683244cdd2e","type":"text/plain","content":"No momento, estamos enfrentando instabilidade em nosso sistema."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"42212050-83b1-4709-b2c0-f3f04d64a522","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"526ec006-18a4-4ce8-94aa-4f740d45526b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"526ec006-18a4-4ce8-94aa-4f740d45526b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d8eaaa6-12ce-433f-bae8-475e764f1ae6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1f141b-f598-4b23-8fcf-f7c5863150ed","type":"text/plain","content":"Você pode tentar novamente mais tarde, vou te transferir em contato com seu gerente.","metadata":{}},"$cardContent":{"document":{"id":"ea1f141b-f598-4b23-8fcf-f7c5863150ed","type":"text/plain","content":"Você pode tentar novamente mais tarde, vou te transferir em contato com seu gerente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"480d7b51-2ec1-4aa9-bbec-0f3d5e9d269f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"e65ae042-2867-4005-9f6f-c24781ded992"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cdff1da5-726f-4707-ac9d-a82f95a8a96c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c6b1d835-f571-4c7a-975d-6e088158bc68","root":false,"$title":"[Exceção][API] Erro de API (generico)","$position":{"top":"327px","left":"1781px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"469e36b0-7e94-4c65-8b9e-4cab91f23487":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"451ffe67-c4d9-46d1-a6fe-516a8358f445","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e566e5e8-7dab-4252-8c8c-fd6e994b3d92","typeOfStateId":"state","$connId":"con_358","$id":"53fef6b0-defd-43a9-86ce-13620426a4b7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"469e36b0-7e94-4c65-8b9e-4cab91f23487","root":false,"$title":"[Inicio] Fatura do cartão","$position":{"top":"476px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55270663-c4fc-4407-8ac5-e859e7d9d5f0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"801a3e0f-86fa-456d-81ef-605719df9032","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"469e36b0-7e94-4c65-8b9e-4cab91f23487","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"55270663-c4fc-4407-8ac5-e859e7d9d5f0","root":false,"$title":"[GO TO] Fatura do cartao","$position":{"top":"3020px","left":"459px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b056c54-8b78-47f7-a632-a5c1e959642f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d1bca5c2-5488-439f-82e8-608821b7f9ff","typeOfStateId":"state","$connId":"con_363","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3688cb85-f2ae-4c26-baf0-1822644c1820","typeOfStateId":"state","$connId":"con_368","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\t// const cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoes.filter(cartao => cartao.funcao !== 'D' && Number(cartao.valorLimite) > 0 && cartao.titular == true)\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn 0\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ce73b8b7-397a-4a13-b437-0e2bba5911ff","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b348edbc-0a34-417a-8397-3a2a2b18656a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-737ab60e-b1a4-4584-9081-d43b00293c0b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d4b23170-3282-42b3-a3ac-e3850af45a11","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4b056c54-8b78-47f7-a632-a5c1e959642f","root":false,"$title":"[FC.1.0.0] possui cartao?","$position":{"top":"790.765px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d1bca5c2-5488-439f-82e8-608821b7f9ff":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3688cb85-f2ae-4c26-baf0-1822644c1820","typeOfStateId":"state","$connId":"con_373","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Notei que você tem mais de um cartão.\nDe qual você precisa da fatura?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9d20b1a7-1e5a-46ef-8a95-3897a6fd9ecd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-60c70244-8081-4808-821a-ed774d95ed50","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-12ae502c-6a0f-4c93-945a-f5e3c2aaefe6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d1bca5c2-5488-439f-82e8-608821b7f9ff","root":false,"$title":"[FC.1.0.1] + 1 cartao","$position":{"top":"886px","left":"6015px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e566e5e8-7dab-4252-8c8c-fd6e994b3d92":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4b056c54-8b78-47f7-a632-a5c1e959642f","typeOfStateId":"state","$connId":"con_378","$id":"1363c31e-c9dd-4e99-9070-50ed442caec6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"OSADesligado"}],"$invalid":false},{"stateId":"4b056c54-8b78-47f7-a632-a5c1e959642f","typeOfStateId":"state","$connId":"con_383","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"17352244-c34b-44ff-a559-ffda621952ba","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"0a9d3079-e348-4c6c-9bc7-428f6e0b3333","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e71dd334-4838-41df-affc-bf88fca6f53b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"1b108629-49d4-40f9-9aa7-fbb79b3474fa","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_FATURA_CARTAO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"088bf1e0-a005-4875-9ca8-4f36d0a3c8a3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d68f7309-e90b-4af7-8159-2d72cce79675","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cd0e0056-7600-4c63-8126-da10ce1add9c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2ca16753-c14d-480e-9997-089f178fb021","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"e566e5e8-7dab-4252-8c8c-fd6e994b3d92","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"614px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3688cb85-f2ae-4c26-baf0-1822644c1820":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"144e0deb-79c9-41b2-bff3-47c22a4af2de","typeOfStateId":"state","$connId":"con_388","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cbff8a07-afda-4f12-b4b8-5a710877faf6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"3688cb85-f2ae-4c26-baf0-1822644c1820","root":false,"$title":"[FC.1.0.3] dados cartao","$position":{"top":"975px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"144e0deb-79c9-41b2-bff3-47c22a4af2de":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0fb360e7-1896-439a-b583-1c0e36cce25a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","typeOfStateId":"state","$connId":"con_393","$id":"225bb4e1-4530-4aa0-b0ad-bedaa597fee0","conditions":[{"source":"context","comparison":"equals","values":["erro"],"variable":"faturasFechada"}],"$invalid":false},{"stateId":"45680e8a-4388-4d90-a3f1-f4d6c08701cd","typeOfStateId":"state","$connId":"con_398","$id":"30b3da72-e4c4-4f0b-8a48-f21f4fa1c2e9","conditions":[{"source":"context","comparison":"equals","values":["nao existe faturas fechada"],"variable":"faturasFechada"}],"$invalid":false},{"stateId":"80599c19-a325-43df-83d3-ea28215148be","typeOfStateId":"state","$connId":"con_403","$id":"f665beb3-a11e-4b58-bba0-f768e6b7dd7f","conditions":[{"source":"context","comparison":"notEquals","values":["nao existe faturas fechada"],"variable":"faturasFechada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9b85f98f-ec30-434c-87cf-1bf3d6a9a0e5","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6f17324f-3f33-4eb9-b2ab-a72f3e602e5a","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b6fdb7e-4c3e-4e01-97ce-c614b16d9b8a","$typeOfContent":"","type":"ProcessHttp","$title":"GET Fatura \"responseFatura\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"CHT","Authorization":"Bearer {{token}}","Safra-Bot-ID":"skillautenticacao"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes/{{finalCartao}}/faturas?view=RESUMOS","responseStatusVariable":"statusFatura","responseBodyVariable":"responseFatura"},"conditions":[]},{"$id":"bf56aaa1-fb47-4ae7-992e-43cb5ec17046","$typeOfContent":"","type":"ExecuteScript","$title":"faturasFechada","$invalid":false,"settings":{"function":"run","source":"const run = (faturas) => {\n\ttry {\n\t\tfaturas = JSON.parse(faturas).data.faturas\n\t\tconst faturasFechada = faturas.filter(fatura => fatura.status === \"Fechado\")\n\t\tif (faturasFechada.length == 0) return 'nao existe faturas fechada'\n\n\t\treturn faturasFechada.map(fatura => {\n\t\t\tfatura.valor = formatValue(fatura.valor)\n\t\t\treturn fatura\n\t\t})\n\t} catch (err) {\n\t\treturn \"erro\"\n\t}\n}\n\nfunction formatValue(valor) {\n        return `${\n                parseFloat(valor)\n                        .toFixed(2)\n                        .replace(\".\", \",\")\n                        .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")}`;\n}","inputVariables":["responseFatura"],"outputVariable":"faturasFechada","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-034c281b-b200-430b-82b7-84ef019f877e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-8bcb489c-b285-4883-b90f-c178bf4a5264","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"144e0deb-79c9-41b2-bff3-47c22a4af2de","root":false,"$title":"[FC.2.0.0] possui fatura?","$position":{"top":"1160px","left":"5773px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"45680e8a-4388-4d90-a3f1-f4d6c08701cd":{"$contentActions":[{"action":{"$id":"5e147fde-6a29-4758-82e1-93ec825b157c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2c8ce3f9-c264-4de6-a3ac-a57ee7118188","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2c8ce3f9-c264-4de6-a3ac-a57ee7118188","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"277d0e7c-c947-466b-af33-5a9ee04092ba","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d68780e3-5431-40cd-b656-57b28fc585f1","type":"text/plain","content":"O seu cartão com final *{{finalCartao}}* não tem faturas fechadas. Assim que a sua fatura fechar, você vai conseguir ver as informações aqui.","metadata":{}},"$cardContent":{"document":{"id":"d68780e3-5431-40cd-b656-57b28fc585f1","type":"text/plain","content":"O seu cartão com final *{{finalCartao}}* não tem faturas fechadas. Assim que a sua fatura fechar, você vai conseguir ver as informações aqui."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"135e3ef2-d7db-4b3c-ac40-5c2dd381d677","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2217518e-2b6e-41f2-b4d6-e32d34f691e0","typeOfStateId":"state","$connId":"con_408","$id":"46a1a658-395b-458e-8833-0de30ffbb914","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cdf12e6a-4ed5-4a51-b1c7-debfbe700161","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"45680e8a-4388-4d90-a3f1-f4d6c08701cd","root":false,"$title":"[FC.2.0.1] não possui fatura fechada","$position":{"top":"1147px","left":"6001px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"80599c19-a325-43df-83d3-ea28215148be":{"$contentActions":[{"action":{"$id":"11b1f560-1596-4c04-8c44-b59517b3ecf5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee612725-185c-4810-824b-37e99ff764ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee612725-185c-4810-824b-37e99ff764ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c90a002a-60b7-4da5-8ba6-e035539be126","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}\n"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c1deb80f-d9db-400e-9040-a19a687c2002","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3ebdf2d9-61e7-4334-b280-06466b167329","typeOfStateId":"state","$connId":"con_413","$id":"b6fdd9d4-4419-4e03-a78c-da2501297363","conditions":[{"source":"context","comparison":"notEquals","values":["erro"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48d58e13-cf0b-4933-a032-c57dcbb714da","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, faturas) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n        platform = 'blipchat';\n    \n    faturas = JSON.parse(faturas)\n\n    const meses = {\n        \"01\": \"Janeiro\",\n        \"02\": \"Fevereiro\",\n        \"03\": \"Março\",\n        \"04\": \"Abril\",\n        \"05\": \"Maio\",\n        \"06\": \"Junho\",\n        \"07\": \"Julho\",\n        \"08\": \"Agosto\",\n        \"09\": \"Setembro\",\n        \"10\": \"Outubro\",\n        \"11\": \"Novembro\",\n        \"12\": \"Dezembro\"\n    }\n\n    const text = `Por aqui, consigo te mostrar as 3 últimas faturas fechadas. De qual mês você quer ver?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    faturas.forEach((fatura, index) => {\n        const mes = fatura.dataVencimento.split(\"-\")[1]\n        const mesExtenso = meses[mes]\n        options.push(`${mesExtenso} - R$ ${fatura.valor}`);\n    });\n    faturas.forEach((fatura, index) => {\n        const data = fatura.dataVencimento.split(\"-\")\n        const dia = data[2]\n        const mes = data[1]\n        const ano = data[0]\n        description.push(`Vencimento - ${dia}/${mes}/${ano}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n    let words = text.split(\" \");\n\n    words = words.map(\n        (word) =>\n            word.length &&\n            `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n    );\n\n    return words.join(\" \");\n}","inputVariables":["bold","platform","faturasFechada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"08b2f556-9a69-4019-b10b-16e5587c9d02","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (faturas, input) => {\n\ttry {\n\t\tfaturas = JSON.parse(faturas)\n\t\tinput = JSON.parse(input)\n\t\tconst indexFatura = input.metadata[\"#wa.interactive.list.id\"] - 1;\n\t\tconst faturaEscolhida = faturas[indexFatura]\n\t\tif (faturaEscolhida) {\n\t\t\treturn faturaEscolhida\n\t\t}\n\t\treturn \"erro\"\n\t} catch (err) {\n\t\treturn \"erro\"\n\t}\n}","inputVariables":["faturasFechada","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1a4f5526-dd09-4327-9135-86f941aae5a9","$typeOfContent":"","type":"ExecuteScript","$title":"dataVencimento","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n\ttry {\n\t\tuserInput = JSON.parse(userInput)\n\n\t\treturn userInput.dataVencimento\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["userInput"],"outputVariable":"dataVencimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f5019cb-ac7c-48ce-88a7-d52057f681dd","$typeOfContent":"","type":"ExecuteScript","$title":"mesFatura","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n\treturn input.split('-')[0]\n}","inputVariables":["input.content"],"outputVariable":"mesFatura","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4803c229-5681-4039-a84c-adcfffed58c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a8ac8240-c5c2-46ab-b101-cc7d4d2085da","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b4bc24f2-2630-49b8-92ac-da99c8a4331b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"80599c19-a325-43df-83d3-ea28215148be","root":false,"$title":"[FC.2.0.2] menu selecao de fatura","$position":{"top":"1299px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2e88b5e4-f472-4ace-a610-20adec4364f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","root":false,"$title":"[GO TO] transbordo employee","$position":{"top":"1192px","left":"5508px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3ebdf2d9-61e7-4334-b280-06466b167329":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"47048efa-3fc8-477e-bb3b-25d37c711e1e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e70e2e4-54e8-4272-bf41-56419b681b7e","typeOfStateId":"state","$connId":"con_418","$id":"cdaa5fc2-a0ed-4cf0-8826-e869a8be14ed","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0b5e9fbc-6151-4992-b24e-551155e1a2ff","$typeOfContent":"","type":"ProcessHttp","$title":"POST send PDF \"responsePDF\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"5d6a5c8a-e5a5-486d-835a-6dd13ac241bd","Safra-Aplicacao":"CHT","Safra-Bot-ID":"skillautenticacao","Content-Type":"application/json","Authorization":"Bearer {{token}}"},"method":"POST","body":"{\n  \"tipoPessoa\": \"F\",\n  \"documento\": \"{{document}}\",\n  \"numeroCartao\": \"{{finalCartao}}\",\n  \"dataVencimento\": \"{{dataVencimento}}\",\n  \"agencia\": \"{{agency}}\",\n  \"conta\": \"{{account}}\"\n}","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/faturas/enviar","responseStatusVariable":"statusPDF","responseBodyVariable":"responsePDF"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b4420b5d-e272-4e24-a39b-f530053f8565","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"3ebdf2d9-61e7-4334-b280-06466b167329","root":false,"$title":"[FC.2.0.3][HTTP] envia pdf","$position":{"top":"1443px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e70e2e4-54e8-4272-bf41-56419b681b7e":{"$contentActions":[{"action":{"$id":"674a9397-12c2-413b-98f7-ef616a568cfe","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7d7a9e15-fa7e-4501-8448-bb382e07aa95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7d7a9e15-fa7e-4501-8448-bb382e07aa95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"26c903a9-190b-4a52-b6a5-64981ed2d92d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f86a0d95-f15a-43a6-bf66-9fd00a2e194f","type":"text/plain","content":"Acabei de enviar no seu e-mail o PDF da fatura fechada de {{mesFatura}}","metadata":{}},"$cardContent":{"document":{"id":"f86a0d95-f15a-43a6-bf66-9fd00a2e194f","type":"text/plain","content":"Acabei de enviar no seu e-mail o PDF da fatura fechada de {{mesFatura}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5881d756-8534-4084-9875-e1f6c63de59f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9ab8a87-8c98-4058-88df-2f6fa26200b3","typeOfStateId":"state","$connId":"con_423","$id":"5bb0d7b6-8f35-4aad-9812-a94817b0f748","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-116f2520-265c-4418-b992-3ed0a00c9530","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e70e2e4-54e8-4272-bf41-56419b681b7e","root":false,"$title":"[FC.2.0.4][MSG] envio email","$position":{"top":"1577px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c9ab8a87-8c98-4058-88df-2f6fa26200b3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"799558ff-6be8-422c-a251-c0045bf39e1f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c9ab8a87-8c98-4058-88df-2f6fa26200b3","root":false,"$title":"[GO TO] Algo Mais","$position":{"top":"1718px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0abed19b-40e3-454c-bed3-c97f190fd32a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7d4600a3-efdf-4eda-932e-b183cef0a4cf","type":"text/plain","textContent":"Entrada do usuário","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:5041"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5cd53ec9-66e0-4e7f-923b-f0072f05053c","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn {\n    \"data\": [\n        {\n            \"nomePortador\": \"LUCAS LOPES\",\n            \"descricao\": \"CARTAO SAFRA VISA\",\n            \"funcao\": \"C\",\n            \"numero\": \"8015\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": true,\n            \"codigoSegmento\": \"0\",\n            \"dataEmbossamento\": \"2022-09-12\",\n            \"status\": \" \",\n            \"codigoTipo\": \"0270\",\n            \"codigoCorTipo\": \"00\",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \"M\",\n            \"diaCiclo\": \"26\",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 17400,\n            \"numeroConta\": \"4732700050728007\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 17400,\n            \"idProcessadora\": \"00000000\",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \" \"\n        },\n        {\n            \"nomePortador\": \"LUCAS LOPES\",\n            \"descricao\": \"CARTAO BANCARIO SAFRA VISA ELECTRON\",\n            \"funcao\": \"D\",\n            \"numero\": \"6119\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": true,\n            \"codigoSegmento\": \"0\",\n            \"dataEmbossamento\": \"2023-10-24\",\n            \"status\": \" \",\n            \"codigoTipo\": \"0018\",\n            \"codigoCorTipo\": \"18\",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \"M\",\n            \"diaCiclo\": \"00\",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 0,\n            \"numeroConta\": \"4790180490326002\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 0,\n            \"idProcessadora\": \"00000000\",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \" \"\n        },\n        {\n            \"nomePortador\": \"CAMILA PORTO LOPES\",\n            \"descricao\": \"CARTAO SAFRA VISA\",\n            \"funcao\": \"C\",\n            \"numero\": \"8049\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": false,\n            \"codigoSegmento\": \" \",\n            \"dataEmbossamento\": \" \",\n            \"status\": \" \",\n            \"codigoTipo\": \"0270\",\n            \"codigoCorTipo\": \" \",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \" \",\n            \"diaCiclo\": \" \",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 17400,\n            \"numeroConta\": \"4732700050728007\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 0,\n            \"idProcessadora\": \" \",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \"43699400875\"\n        }\n    ]\n}\n}","inputVariables":[],"outputVariable":"bodycartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8c5031e3-be72-4445-9552-dda221b2dedd","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn [\n    {\n        \"nomePortador\": \"LUCAS LOPES\",\n        \"descricao\": \"CARTAO SAFRA VISA\",\n        \"funcao\": \"C\",\n        \"numero\": \"8015\",\n        \"situacao\": \"A\",\n        \"bandeira\": \"V\",\n        \"titular\": true,\n        \"codigoSegmento\": \"0\",\n        \"dataEmbossamento\": \"2022-09-12\",\n        \"status\": \" \",\n        \"codigoTipo\": \"0270\",\n        \"codigoCorTipo\": \"00\",\n        \"motivoCancelamento\": \" \",\n        \"sexoPortador\": \"M\",\n        \"diaCiclo\": \"26\",\n        \"debitoAutomatico\": false,\n        \"valorLimite\": 17400,\n        \"numeroConta\": \"4732700050728007\",\n        \"codigoExibicao\": \"1\",\n        \"valorLimitePreAprovado\": 17400,\n        \"idProcessadora\": \"00000000\",\n        \"ofertaCartao\": false,\n        \"ordemExibicao\": 0,\n        \"cpfAdicional\": \" \"\n    }\n]\n}","inputVariables":[],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"0abed19b-40e3-454c-bed3-c97f190fd32a","root":false,"$title":"23.10-17:00","$position":{"top":"0px","left":"274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"commentsIdList":["6d0f89c4-1a0f-40dc-ad21-629081da0e65"]}},"127757c2-0404-4ee1-887c-6b60d71a3a77":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0d31d7ba-ad81-4fbf-b835-8342e8f8f93e","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e92decba-2f27-4b5b-a0ec-c761214c6811","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"127757c2-0404-4ee1-887c-6b60d71a3a77","root":false,"$title":"[GO TO] Pos Invest","$position":{"top":"3035.5px","left":"939.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1376549f-3a8a-4f11-869e-1960f295a5ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6968e527-191a-4e18-a2d4-29bb29a4d1b8","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1376549f-3a8a-4f11-869e-1960f295a5ef","root":false,"$title":"[GO TO] Extrato","$position":{"top":"2970.33px","left":"1149.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5064a085-443c-419b-b25e-b6ffa7059ce0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","typeOfStateId":"state","$connId":"con_428","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","typeOfStateId":"state","$connId":"con_433","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_POSICAO_INVESTIMENTOS\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9c8f6222-1e55-4916-9a14-971505de5734","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4217ad43-9334-4424-b0fa-48d9668ca8a3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dbab1cf3-f2b4-47c3-9455-9761a5fa62e2","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5064a085-443c-419b-b25e-b6ffa7059ce0","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"419px","left":"4308.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b6390f47-bc7b-4c7a-9d19-4218a060ca2e","typeOfStateId":"state","$connId":"con_438","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8d5fc5aa-f311-420d-a14e-34898e37f162","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-36debbe0-25ec-4b38-8e70-9e137beeba8e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a76448bb-cb83-49cb-b4dc-5fac9e992731","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-13b290eb-3bbb-42f6-b3ce-22fd1ce180dd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","root":false,"$title":"[PI.1.0.0][MSG] Inicio Posicao Investimento","$position":{"top":"579px","left":"4308.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5aba1012-65f4-4562-9aa9-419d0b772741":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_443","$id":"ac43fe69-3261-440c-b31c-b0487bbf3412","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_448","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_EXTRATO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f758eb70-6cde-4569-bb2c-a2aae7b91436","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-385bd771-1ae1-48e4-8076-6f73e6c3f1c4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-75f0bbc7-5dca-4796-9115-9e61073ef98a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5aba1012-65f4-4562-9aa9-419d0b772741","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"615px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36730683-8874-4b01-af50-a78da194c2d1":{"$contentActions":[{"action":{"$id":"e10d710c-6594-4765-934f-318f3b430de7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1e96f9d6-a837-4f98-a24c-1f8ce4b090ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1e96f9d6-a837-4f98-a24c-1f8ce4b090ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"791c5e88-1c1c-46bd-b39a-32c6db5612c0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a20261cc-8e37-41aa-bcf9-45e4702d018d","type":"text/plain","content":"Não consegui encontrar nenhum histórico de posição de investimento.","metadata":{}},"$cardContent":{"document":{"id":"a20261cc-8e37-41aa-bcf9-45e4702d018d","type":"text/plain","content":"Não consegui encontrar nenhum histórico de posição de investimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"99a60ed7-9825-4e76-8c67-4495e4c58979","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","typeOfStateId":"state","$connId":"con_453","$id":"fe88d63f-39a3-4b38-8086-c26256ee2bff","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fa916ccc-3cb7-453e-a856-9438ed25754e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d11ceefa-7ed8-483b-b743-2e90be7a5e02","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-071816fe-3309-42b2-b5ca-16a0dbec3628","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"36730683-8874-4b01-af50-a78da194c2d1","root":false,"$title":"[PI.3.1.3][MSG] Não Encontrou","$position":{"top":"1322px","left":"4490.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3f739f15-0056-45e3-89b4-29d2ae4d3efa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2f815a99-f5ce-4b32-88b8-ffbb00e96f20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3f739f15-0056-45e3-89b4-29d2ae4d3efa","root":false,"$title":"[GO TO]Employee Finalizacao","$position":{"top":"94px","left":"2476px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b6390f47-bc7b-4c7a-9d19-4218a060ca2e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"15a79232-ef1a-4238-9477-382cae383baf","typeOfStateId":"state","$connId":"con_458","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"62aec317-124c-4a6f-8eb5-347b96526b10","typeOfStateId":"state","$connId":"con_463","$id":"21d715be-894a-4854-85b9-95921a90912d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b6ca16d6-f0e6-4ae6-904d-1ba236e2dd91","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a12923ae-b478-4b9e-9d95-0415b712178d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e5fa710a-5de6-43c6-b531-052ad111555f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-e9729e21-dbdf-4918-9e5a-2909dab21116","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-741dcf64-5bf1-457d-bb18-b1e3eed204c9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b6390f47-bc7b-4c7a-9d19-4218a060ca2e","root":false,"$title":"[PI.1.0.0][INPUT] Inicio Posicao Investimento","$position":{"top":"761.5px","left":"4308.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5215041d-b5f5-49eb-895c-0648cc1546a1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76052a9b-f55c-4fd6-8ac8-da0510909330","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62aec317-124c-4a6f-8eb5-347b96526b10","typeOfStateId":"state","$connId":"con_468","$id":"d6317b53-b402-4aa0-af65-27b8293d6b92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9491f50b-ca70-4363-8536-39a65005c827","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-633718b4-667a-42ce-9b51-470ce6bb7f6f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5215041d-b5f5-49eb-895c-0648cc1546a1","root":false,"$title":"[PI.2.0.1]Não Possui Email","$position":{"top":"1001px","left":"4548px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2217518e-2b6e-41f2-b4d6-e32d34f691e0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"428fa2de-56e5-430c-a2ce-ae1bf665af89","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2217518e-2b6e-41f2-b4d6-e32d34f691e0","root":false,"$title":"[GO TO] Te ajudo em algo mais ","$position":{"top":"1326px","left":"5999px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cdd34564-0396-44f2-a37d-978173c3889d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5bdb5b0d-6df3-4f4a-a41b-fd66aaa0f6d2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"257f1171-0297-4b48-8a1c-89a7959b201f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"cdd34564-0396-44f2-a37d-978173c3889d","root":false,"$title":"[GO TO] Em que posso ajudar? ","$position":{"top":"2992.33px","left":"152px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"329bc5fc-e554-4d1f-865b-1a858c603a5b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a9602b1-d07e-43c2-9161-3649457eab05","typeOfStateId":"state","$connId":"con_473","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"329bc5fc-e554-4d1f-865b-1a858c603a5b","root":false,"$title":"[Inicio] Tracking cartão","$position":{"top":"481.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8a9602b1-d07e-43c2-9161-3649457eab05":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","typeOfStateId":"state","$connId":"con_478","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","typeOfStateId":"state","$connId":"con_483","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_POSICAO_INVESTIMENTOS\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-86ddfdb1-7236-4f75-8e83-18e58822109f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e5e95870-16d6-4017-a27a-8fd5c9c022f1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-37bc1c9f-9f9b-4045-be96-d03670e0a802","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"8a9602b1-d07e-43c2-9161-3649457eab05","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"669.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a69b80a8-332b-4300-b3f4-728077b1e9e8","typeOfStateId":"state","$connId":"con_488","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","typeOfStateId":"state","$connId":"con_493","$id":"5596a3bd-f403-4093-8fdc-9f64ac7364d6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3ea2a7b3-ee9f-439e-9c21-a4525bd8162c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-066c8691-b716-4670-9600-0b991b3c6bf4","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-949a83c7-d8fe-47ce-ba0e-cdbc06aac6a8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-44242ead-7ac8-4ce0-add6-6cbb6d56c97d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","root":false,"$title":"[TC.1.0.0][MSG] Inicio Tracking Cartão","$position":{"top":"870.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a69b80a8-332b-4300-b3f4-728077b1e9e8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2a9eb715-b6b9-44e9-97b3-e07e68158a77","typeOfStateId":"state","$connId":"con_498","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","typeOfStateId":"state","$connId":"con_503","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\t// const cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoes.filter(cartao => cartao.funcao !== 'D' && Number(cartao.valorLimite) > 0 && cartao.titular == true)\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn 0\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ce73b8b7-397a-4a13-b437-0e2bba5911ff","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9e77b695-7395-435f-abef-b619c2c8e237","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cddf9794-b2f1-4b39-b75c-a6f7dc330ef5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-e7945c10-9872-4350-912f-7cfdc7e294bd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"a69b80a8-332b-4300-b3f4-728077b1e9e8","root":false,"$title":"[TC.2.0.0] possui cartao?","$position":{"top":"1114.67px","left":"6782.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2a9eb715-b6b9-44e9-97b3-e07e68158a77":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","typeOfStateId":"state","$connId":"con_508","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Notei que você tem mais de um cartão.\nDe qual você precisa da fatura?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-db83ecbd-e072-42ea-94cd-722bb22085cd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5e0ad08e-8137-414c-a0dd-ec23938b8a86","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-62040a79-2888-4cc7-9214-38b143121abd","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2a9eb715-b6b9-44e9-97b3-e07e68158a77","root":false,"$title":"[TC.2.0.1] + 1 cartao","$position":{"top":"1230.67px","left":"6984.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1f4c4ef1-3207-4427-b309-8b8737f683db","typeOfStateId":"state","$connId":"con_513","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5447edff-5512-4446-8eb5-b1acfaf332ed","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","root":false,"$title":"[TC.2.0.3] dados cartao","$position":{"top":"1336.67px","left":"6782.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f4c4ef1-3207-4427-b309-8b8737f683db":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a6a31ac9-d06c-4b92-a222-6828bdee783f","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-44b9b1e3-05df-48d4-b4f6-d4ec0ca3735f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1f4c4ef1-3207-4427-b309-8b8737f683db","root":false,"$title":"Valida Status do Cartao","$position":{"top":"1520.67px","left":"6783.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"934.5px","left":"7009.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true}},"configuration":{"builder:minimumIntentScore":"0.65","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/devspdintencoes","builder:useTunnelOwnerContext":"true","builder:stateExpiration":"0.00:15:00","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","env":"Dev"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"85c11e93-ebd2-4fe9-b93e-15e720118b6d","$typeOfContent":"","type":"ExecuteScript","$title":"moment","$invalid":false,"settings":{"function":"run","source":"function run() {\n  const date = new Date();\n\n  const day = String(date.getDate()).padStart(2, \"0\");\n  const month = String(date.getMonth() + 1).padStart(2, \"0\");\n  const year = String(date.getFullYear());\n\n  const hours = String(date.getHours()).padStart(2, \"0\");\n  const minutes = String(date.getMinutes()).padStart(2, \"0\");\n\n  return {\n    date: `${day}/${month}/${year}`,\n    time: `${hours}:${minutes}`,\n  };\n}","inputVariables":[],"outputVariable":"moment"},"conditions":[]},{"$id":"764d6e62-a61a-40fe-a792-44761727b3f6","$typeOfContent":"","type":"ExecuteScript","$title":"returnBlock","$invalid":false,"settings":{"function":"run","source":"function run(previousId, stateId) {\n    return {\n        \"default\": stateId,\n        \"previousBlock\": previousId\n    }\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"state.previous.name","values":["REDIRECTS"],"$$hashKey":"object:34249"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}