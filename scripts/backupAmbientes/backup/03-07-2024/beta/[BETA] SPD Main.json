{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"765dc076-b87b-40d4-a571-f64fa62e7341","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ad92948a-47ac-4d3b-bb01-b5f7ab6b7457","typeOfStateId":"state","$connId":"con_3","$id":"2fae6380-5b98-4016-9287-ffacc3cec1e6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["teste1"],"source":"input","comparison":"equals"}],"$invalid":false},{"stateId":"9866367c-499c-4834-a0c9-931ef891ef0b","typeOfStateId":"state","$connId":"con_8","$id":"6c967c4a-84c3-4c35-8949-f1139515c386","conditions":[{"source":"input","comparison":"equals","values":["teste2"]}],"$invalid":false},{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"0e4a3f84-4473-4985-a879-6efe1da438a4","conditions":[{"values":["false"],"source":"context","variable":"blockDestinationId","comparison":"notEquals"}],"$invalid":false},{"stateId":"3e06cd93-6019-4a34-8468-b364f7ec47e9","typeOfStateId":"state","$connId":"con_13","$id":"a4b61067-650f-40f5-b8fb-a4084131f605","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.broadcastOrigem"},{"values":["-"],"source":"context","comparison":"notEquals","variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"a8d2f811-ac89-4e91-9b16-c93b4b661447","typeOfStateId":"state","$connId":"con_18","$id":"d7da0159-8b49-4eda-858f-06339a90237e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8c8cd4d0-da09-4045-8009-266626552731","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f13d7473-79a6-48ac-a970-e65229fecfab","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ac586908-3aeb-473a-8c26-828bda648c7b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8cdc1093-4554-4387-8528-894707319b29","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"In√≠cio","$position":{"top":"10px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bd18d48b-197a-4546-900b-5bd5cf12f99b","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","typeOfStateId":"state","$connId":"con_23","$id":"41b772e3-09eb-4036-a1bf-83b66dc726fc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"18c6e28f-a1ec-41b6-89c8-4fbf15c2b8fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3596008-01fa-4e08-88d5-bf813e8b57d4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-84ca0f0c-9a35-47c3-8475-f1e04082325f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exce√ß√µes","$position":{"top":"12px","left":"885px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"4bd87cdf-8b20-4797-a08c-9eaa81374421","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Ol√°! Boas-vindas ao atendimento virtual do Banco Safra para sua empresa. üòä","metadata":{}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Ol√°! Boas-vindas ao atendimento virtual do Banco Safra para sua empresa. üòä"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"7041049f-fd4e-459b-bb19-e47d71e9580e","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"314dd865-7fe1-4276-af20-5567014eb6a7","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7e068d62-af04-4916-a1ff-eb223d8dcb99","typeOfStateId":"state","$connId":"con_28","$id":"f403b145-fa9f-499a-9342-b138d5c11025","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f373a4d-0201-4c29-8e9a-5f151816d10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibi√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibi√ß√£o","action":"Exibi√ß√£o"},"conditions":[]},{"$id":"fe319907-8b8e-446d-9bed-4223996dd5cf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fcbf5dea-5071-4b71-883f-ceb7cc0ddec2","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"9050bf5d-13ad-4128-b393-23a5def318ca","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1154d2fc-4cb3-4982-83c8-399486742aef","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main input inicial\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main boas vindas input inicial","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"82c18de3-a766-4dac-ad75-28f3c2c10b4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlToken}}/api/oauth/token | {{encodingUrl}} | {{statusToken}} | {{bodyToken}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-01739406-0632-42ed-89bb-5a0ce22adb82","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d484f7d1-3d6f-4908-8609-6108f350b651","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-16b311af-9755-4523-b5df-84a3ffd27e0b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-939d39c0-a975-4d2e-a68a-72d4aa5b9327","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"welcome","$title":"[M.1.0.0][MSG][HTTP] Boas vindas","$position":{"top":"326px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7e068d62-af04-4916-a1ff-eb223d8dcb99":{"$contentActions":[{"action":{"$id":"de77b127-178b-4dad-bdc1-7f7468a7591f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Por gentileza, para seguirmos com o atendimento, precisamos que voc√™ informe o CPF do titular da conta.","metadata":{}},"$cardContent":{"document":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Por gentileza, para seguirmos com o atendimento, precisamos que voc√™ informe o CPF do titular da conta."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f64784f0-07f1-4543-aee4-dda0709eb450","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2108dc0d-7efc-4120-a380-d1624ed0e0b4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os n√∫meros, como neste exemplo:üëá\nCPF: 43913590806","metadata":{}},"$cardContent":{"document":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os n√∫meros, como neste exemplo:üëá\nCPF: 43913590806"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32fafead-1ba1-4524-94bb-6913efeee86c","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","typeOfStateId":"state","$connId":"con_33","$id":"417421c1-8ac6-48ad-bb1f-b9d634898dc4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2adb915b-9570-4bb6-940a-9908820ad6f7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibi√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibi√ß√£o","action":"Exibi√ß√£o"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-74766c3e-93bb-4cbd-94a0-9c3842995857","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-daf773ab-8e9d-4a19-b06b-ab9e94cf5dde","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7e068d62-af04-4916-a1ff-eb223d8dcb99","root":false,"$title":"[M.2.0.0][MSG] Solicita CPF","$position":{"top":"505px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75b55cb8-4764-479d-b17d-48776ccc45c9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"05944f68-1d49-4a49-9782-622dee31cc95","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"775e2746-a52f-48d0-9442-e17cd0c2fd82","typeOfStateId":"state","$connId":"con_38","$id":"6dd06b3f-39e7-44d9-ac8d-574696ee3d78","conditions":[{"values":["0"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":["unauthorized"],"source":"context","comparison":"notEquals","variable":"apiStatus"}],"$invalid":false},{"stateId":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","typeOfStateId":"state","$connId":"con_43","$id":"c8051bdc-1fcd-46fe-8b0d-6232681d6d3c","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}],"$invalid":false},{"stateId":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","typeOfStateId":"state","$connId":"con_48","$id":"b064be9b-d3c5-4a7c-b43c-ce5864fa1f62","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarContas@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fc784833-8d2f-4e3c-a9f6-a29e08d7b490","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyContas\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}}","responseStatusVariable":"statusContas","responseBodyVariable":"bodyContas"},"conditions":[]},{"$id":"cb7e2bdc-f341-44e7-9c67-eb82c80317a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyContas) {\n\ttry {\n\t\tconst contas = JSON.parse(bodyContas).data;\n\t\tlet arrContas = []\n\t\tlet totalLoops = 0;\n\n\t\tfor (let index = 0; index < contas.length; index++) {\n\t\t\tif (totalLoops > 100) break;\n\t\t\tfor (let indexB = 0; indexB < contas[index].contas.length; indexB++) {\n\t\t\t\tif (totalLoops > 100) break;\n\t\t\t\tconst novaConta = contas[index].contas[indexB];\n\t\t\t\tnovaConta.canal = contas[index].canal\n\t\t\t\tnovaConta.shortname = contas[index].shortname;\n\t\t\t\tnovaConta.usuario = contas[index].usuario\n\t\t\t\tnovaConta.codigoSegmento = contas[index].segmento\n\t\t\t\tarrContas.push(novaConta)\n\t\t\t\ttotalLoops++;\n\t\t\t}\n\t\t\ttotalLoops++;\n\t\t}\n\t\treturn {\n\t\t\tquantidadeContas: arrContas.length,\n\t\t\tcontas: arrContas\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tquantidadeContas: 0,\n\t\t\tcontas: []\n\t\t}\n\t}\n}","inputVariables":["bodyContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cab7169-21a8-41aa-aa30-5a74ceb7ddc4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"SPD Main {state.name} quantidade de contas\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} quantidade de contas","action":"{{contas@quantidadeContas}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contas@quantidadeContas"}]},{"$id":"fe38dc09-941f-4136-bcf0-a84d2114fcd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(data) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\treturn contas[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contas"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"}]},{"$id":"15fcf271-3186-45b1-89b2-c4f954b7e5e3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusContas"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"de1c5968-7160-4dfd-9b03-cf94d6d31aae","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarContas\"","$invalid":false,"settings":{"function":"run","source":"const replaceAt = (string, index, replacement) => {\n\treturn string.substr(0, index) + replacement + string.substr(index + replacement.length);\n};\n\n// function list(contas, maisContas) {\n// \ttry {\n// \t\tconst buttons = contas.map((conta, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: `${conta.agencia}-${conta.conta}`,\n// \t\t\t\ttitle: `AG${replaceAt(conta.agencia, 1, \"XXX\")} CC${replaceAt(conta.conta, 2, \"XXXX\")}`,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outras contas'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Voc√™ possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.\";\n// \t\tconst buttonTitle = \"Mostrar contas\";\n// \t\tconst headerText = \"Escolha uma conta\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn false;\n// \t}\n// }\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\tlet textoContas = ''\n\t\tcontas.slice(0, 100)\n\t\t\t.forEach((conta, index) => textoContas += `*${index + 1}* - AG ${replaceAt(conta.agencia, 1, \"XXX\")}\\nCC ${replaceAt(conta.conta, 2, \"XXXX\")}\\n`)\n\t\treturn textoContas\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["contas","state.name","idSessao"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarContas"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"}]},{"$id":"fd849d5e-7996-4de5-8ac4-92f1f18d707d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarContas@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarContas@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarContas@tracking"}]},{"$id":"ac7d3117-f8b5-4b22-b4fb-94bdccb70f82","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"1d578318-ae43-44ca-9716-3d5722d4af8f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}} | GET | {{statusContas}} | {{bodyContas}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-070c685b-4ac2-4981-86d7-ac50326ac4bb","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-55c13024-ca98-400a-be18-e199244807db","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fefa2c39-e49c-4627-afae-7cc55de5fe54","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"75b55cb8-4764-479d-b17d-48776ccc45c9","root":false,"$title":"[M.3.0.0][MSG][HTTP] Verifica contas","$position":{"top":"895px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ccd3d0b-0b52-4fef-9461-3b688137f8dd":{"$contentActions":[{"action":{"$id":"a0c6e498-307e-4a39-88a4-ee3ae564f480","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4ccbe2dd-f7c3-41c2-a5a5-9057f5e074e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4ccbe2dd-f7c3-41c2-a5a5-9057f5e074e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0b08869f-3c71-4e06-9631-117ca59b598a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87b70612-954e-4af0-bedc-5087f21df870","type":"text/plain","content":"Voc√™ possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.","metadata":{}},"$cardContent":{"document":{"id":"87b70612-954e-4af0-bedc-5087f21df870","type":"text/plain","content":"Voc√™ possui mais de uma conta. Escolha abaixo sobre qual deseja tratar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0aedb2ed-ce43-4be2-8c14-e3b930c10e33","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"afde8c23-50eb-48b6-8058-2b2d12f31d63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"afde8c23-50eb-48b6-8058-2b2d12f31d63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c3855dce-6b69-4b77-b2f3-e326807e1e11","$typeOfContent":"text","type":"SendMessage","settings":{"id":"42345d41-fdd9-46ab-b01a-50df57e2f6df","type":"text/plain","content":"Digite o n√∫mero da op√ß√£o escolhida. \nExemplo: *1*","metadata":{}},"$cardContent":{"document":{"id":"42345d41-fdd9-46ab-b01a-50df57e2f6df","type":"text/plain","content":"Digite o n√∫mero da op√ß√£o escolhida. \nExemplo: *1*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9a86d7f8-7fde-4106-ab85-790593c485be","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3f72e5a9-e1dc-4e82-bddb-7ccb329d38c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3f72e5a9-e1dc-4e82-bddb-7ccb329d38c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed7f19d1-e2d5-4928-b4dd-137383f4dfa2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"777b5cfc-09a5-4c63-8f94-d76bb4e2313b","type":"text/plain","content":"{{exibeSelecionarContas}}","metadata":{}},"$cardContent":{"document":{"id":"777b5cfc-09a5-4c63-8f94-d76bb4e2313b","type":"text/plain","content":"{{exibeSelecionarContas}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"83ae0e89-15eb-4001-8dd9-6073bb965b59","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","typeOfStateId":"state","$connId":"con_53","$id":"60fa561d-5338-454d-a2cd-641f936ca51e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48c846c9-dbf9-4efc-91ed-56921dc4595e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibi√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibi√ß√£o","action":"Exibi√ß√£o"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bc0cace7-2938-4772-8d55-36990b35a9d7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a0194058-aa10-40cd-9535-ad8816946d91","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","root":false,"$title":"[M.3.1.0][MSG]Seleciona conta","$position":{"top":"1118px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"775e2746-a52f-48d0-9442-e17cd0c2fd82":{"$contentActions":[{"action":{"$id":"54831eb1-0ba8-4a8b-a6fe-37725d2e0c25","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d506add8-6da2-44d4-90d7-ceb4e7bdf17e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Parece que ainda n√£o √© nosso cliente. ü§î\n \nS√≥ um instante, seu atendimento ser√° transferido para um atendente.","metadata":{}},"$cardContent":{"document":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Parece que ainda n√£o √© nosso cliente. ü§î\n \nS√≥ um instante, seu atendimento ser√° transferido para um atendente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6a40c5ea-eb78-4056-8d3f-f4890e27497c","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c","typeOfStateId":"state","$connId":"con_58","$id":"0c22bedb-8fff-4b14-8e4c-d722fb022b44","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a2e0fc43-30c6-4423-958d-6a9c1f2035d5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibi√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibi√ß√£o","action":"Exibi√ß√£o"},"conditions":[]},{"$id":"6762adcf-fc02-40d1-822c-37f0b1c1da82","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\"","$invalid":false,"settings":{"variable":"naoCliente","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c0f1c676-9ca7-42b4-97e7-1ac73269853b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-50026bf4-5089-4d09-b657-df5b3654420b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d91d0f29-2984-4182-85df-02ae3759294d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"775e2746-a52f-48d0-9442-e17cd0c2fd82","root":false,"$title":"[M.3.0.1][MSG] Transbordo cliente n√£o identificado","$position":{"top":"895px","left":"361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"7b5bce4a-368f-48ac-8c8a-171e31e5b096":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fde8a193-6fdc-4490-bbf2-a99a74582176","typeOfStateId":"state","$connId":"con_63","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"fde8a193-6fdc-4490-bbf2-a99a74582176","typeOfStateId":"state","$connId":"con_68","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4afea420-704b-4f88-bc62-056d81224ff3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyDadosConta\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusDadosConta","responseBodyVariable":"bodyDadosConta"},"conditions":[]},{"$id":"0b6ff513-c46d-4619-b433-dc17203974a9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyUsuarios\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios","responseStatusVariable":"statusUsuarios","responseBodyVariable":"bodyUsuarios"},"conditions":[]},{"$id":"cb9f0cf9-050b-49e7-a0ca-4cad3e0181fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada, bodyDadosConta, bodyUsuarios, cpf) {\n\ttry {\n\n\t\tconst { tipoPessoa, baseDocumento, filialCnpj, digitoCpf, nome } = JSON.parse(bodyDadosConta).data\n\t\tconst conta = JSON.parse(contaSelecionada)\n\t\tconst parsedBodyUsuarios = JSON.parse(bodyUsuarios).data\n\n\t\tconta['nomeEmpresa'] = nome\n\t\tconta['tipoPessoa'] = tipoPessoa\n\t\tconta['doc'] = cpf\n\t\tif (conta.usuario) {\n\t\t\tconta['usuario'] = conta.usuario.trim()\n\t\t}\n\t\tif (tipoPessoa === 'PJ') {\n\t\t\tlet doc = baseDocumento + \"000\" + filialCnpj\n\t\t\tlet digito = digitoCpf\n\t\t\tif (digitoCpf < 10) {\n\t\t\t\tdigito = \"0\" + digitoCpf\n\t\t\t}\n\t\t\tconta['doc'] = baseDocumento + \"000\" + filialCnpj + digito\n\t\t\twhile (conta['doc'].length < 14) {\n\t\t\t\tconta['doc'] = `0${conta['doc']}`\n\t\t\t}\n\t\t}\n\t\tif (parsedBodyUsuarios.length > 0) {\n\t\t\tlet primeiroNome = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome.split(' ')[0].toLowerCase()\n\t\t\tprimeiroNome = primeiroNome[0].toUpperCase() + primeiroNome.slice(1)\n\t\t\tconta['nomeCompleto'] = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome\n\t\t\tconta['primeiroNome'] = primeiroNome\n\t\t} else {\n\t\t\tconta['nomeCompleto'] = ''\n\t\t\tconta['primeiroNome'] = ''\n\t\t}\n\t\treturn conta\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["contaSelecionada","bodyDadosConta","bodyUsuarios","contact.extras.cpf"],"LocalTimeZoneEnabled":false,"outputVariable":"contaSelecionada"},"conditions":[]},{"$id":"068dbd3d-971c-4d11-b2f7-f05cb07c2169","$typeOfContent":"","type":"MergeContact","$title":"Set \"contactName\"","$invalid":false,"settings":{"extras":{},"name":"{{contaSelecionada@nomeCompleto}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@nomeCompleto"}]},{"$id":"ad6ae249-8b81-4b5e-93fa-74c1ab9dd3a4","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyEC\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/estabelecimentos?cpfCnpj={{contaSelecionada@doc}}","responseStatusVariable":"statusEC","responseBodyVariable":"bodyEC"},"conditions":[]},{"$id":"b9ed4fe7-ce29-4729-887d-06be26d85470","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ecList\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tconst ecs = JSON.parse(data).data;\n\t\tconst ecList = ecs.filter((ec) => ec.indSitEC === 'A')\n\t\treturn {\n\t\t\tecList,\n\t\t\tecQuantity: ecList.length\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyEC"],"outputVariable":"ecList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dde995d3-a23f-4103-9da6-45fd22ade501","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} quantidade ec\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{ecList@ecQuantity}}","category":"SPD Main {{state.name}} quantidade ec"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ecList@ecQuantity"}]},{"$id":"fcc19fae-2b77-4513-b177-9904e8917360","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selectedEc\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ecList) {\n\ttry {\n\t\tif(JSON.parse(ecList).ecQuantity != 1) {\n\t\t\treturn ''\n\t\t}\n\t\tconst ec = JSON.parse(ecList).ecList[0]\n\t\treturn ec\n\t} catch (err) {\n\t\treturn ''\n\t}\n}","inputVariables":["ecList"],"outputVariable":"selectedEc","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f0e851b-7a56-468d-bd87-ba103ff23ccd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDadosConta","statusUsuarios","statusEC"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7755e648-2c4a-47d9-842a-ef9e24d718a6","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusDadosConta}} | {{bodyDadosConta}}"},"conditions":[]},{"$id":"8abc6e92-2865-41ef-a6a5-d48d09e6f445","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios | GET | {{statusUsuarios}} | {{bodyUsuarios}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d82cc8cc-3a78-4839-bc94-57ff631f6514","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"7057224c-9e8c-4d86-8160-810ca6c47bc9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarEc\"","$invalid":false,"settings":{"function":"run","source":"// function list(ecs, maisContas) {\n// \ttry {\n// \t\tconst buttons = ecs.map((ec, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: ec.codigoEc,\n// \t\t\t\ttitle: ec.codigoEc,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outros ecs'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro.\\n\\nPor gentileza, digite a op√ß√£o desejada.üëá\";\n// \t\tconst buttonTitle = \"Selecionar EC\";\n// \t\tconst headerText = \"Escolha um ec\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn err.message;\n// \t}\n// }\n\nfunction run(data, idSessao, stateName) {\n\ttry {\n\t\tconst { ecList } = JSON.parse(data)\n\t\tconst message = ''\n\t\tecList.forEach((ec, index) => message += `*${index + 1}* - EC: ${ec.codigoEc}\\n`)\n\t\treturn message\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["ecList","idSessao","state.name"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarEc"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"ecList@ecQuantity"}]},{"$id":"6364306a-32c9-4b27-8efb-74824dae1de6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarEc@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarEc@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarEc@tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2294b4a3-d749-4b09-8a44-5b0b8c0ed933","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-4976f91b-a133-407a-8edb-c7a593205d21","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d7fc353d-b0e7-4065-9713-166c685b69c8","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-d5c44093-6e23-4d2d-9ef8-9fa2fb74f72d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","root":false,"$title":"[M.4.0.0][MSG][HTTP] Obtem EC","$position":{"top":"1128px","left":"1135px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f13e7fbd-372e-45ce-a30f-de575a5cb830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-726fdec5-bb5c-48e6-96d0-d8f5c191db44","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f13e7fbd-372e-45ce-a30f-de575a5cb830","root":false,"$title":"[Redirect] To cascata","$position":{"top":"0px","left":"1168px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a":{"$contentActions":[{"action":{"$id":"573516a7-6247-4ab4-8054-793ae9a89e1d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5aa9ffd-855e-4039-9345-c68c1ad4cb2e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro.","metadata":{}},"$cardContent":{"document":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"27b2d5e1-e8be-4ca9-8e08-d1f77f8160e0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"67578171-d4fe-4d96-9fba-de8050f9a557","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"67578171-d4fe-4d96-9fba-de8050f9a557","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"57b83adb-262e-4779-8587-4d77cdff5627","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2717464f-4fd3-455c-98f7-08d08bc2a04b","type":"text/plain","content":"Por gentileza, digite a op√ß√£o desejada.üëá","metadata":{}},"$cardContent":{"document":{"id":"2717464f-4fd3-455c-98f7-08d08bc2a04b","type":"text/plain","content":"Por gentileza, digite a op√ß√£o desejada.üëá"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fd5493d7-9512-482c-8677-c3c856e153e5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4b16ab37-c01a-4ce1-8342-c2bd167b872c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4b16ab37-c01a-4ce1-8342-c2bd167b872c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2859d8fe-a5a5-4092-badf-985c1a987152","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b139f598-e763-492b-8b8d-b5b5cb908af0","type":"text/plain","content":"{{exibeSelecionarEc}}","metadata":{}},"$cardContent":{"document":{"id":"b139f598-e763-492b-8b8d-b5b5cb908af0","type":"text/plain","content":"{{exibeSelecionarEc}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed65c28f-2f50-414c-b58a-802440f38900","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e567a78-dbb9-4216-baa4-9d476bc2b887","typeOfStateId":"state","$connId":"con_73","$id":"ea6ea425-ef88-4bf1-89c2-387725bcce85","conditions":[{"values":[],"source":"input","comparison":"exists","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd4b372a-bdbd-4379-90a0-b180541ac632","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibi√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibi√ß√£o","action":"Exibi√ß√£o"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e9836cf7-d2f7-4fa8-b237-32fb2a02ef42","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d4403191-c360-4754-8e03-f2697dc03b53","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","root":false,"$title":"[M.4.1.0][MSG] Selecionar EC","$position":{"top":"1128px","left":"1723.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"30e39880-1d2a-439a-a0ed-1e7210966286":{"$contentActions":[{"action":{"$id":"e456922a-5fe5-404b-b33f-c7b85c103959","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ed3815ac-c7cf-4c6c-ad39-6bd05be10b5e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ed3815ac-c7cf-4c6c-ad39-6bd05be10b5e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3fe99f5b-8d15-485b-b146-09689a0b563c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"5856f6e3-4041-4263-8f0a-1c8673613f19","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, por aqui podemos te ajudar com os seguintes assuntosüëá","metadata":{}},"$cardContent":{"document":{"id":"5856f6e3-4041-4263-8f0a-1c8673613f19","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, por aqui podemos te ajudar com os seguintes assuntosüëá"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d8e25b49-af9d-42cb-9189-a7d020ab0974","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6eab91e1-a8d9-4f36-877e-bd3049512919","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"595bbc26-6daf-4319-a175-17192cf276fc","typeOfStateId":"state","$connId":"con_78","$id":"f6b5a2f4-95b2-4b95-a158-703dc53dc4eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3aa9d290-4cc4-4607-a662-a0366eb1b3d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibi√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibi√ß√£o","action":"Exibi√ß√£o"},"conditions":[]},{"$id":"855ae543-ccea-4f1d-9023-9fa36553c558","$typeOfContent":"","type":"SetVariable","$title":"set \"naoCliente\" TO \"false\"","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"83de69ad-cc6d-4f42-8b73-e78b4a5e5528","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, selectedEc, contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Perda ou Roubo\",\n\t\t\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"M√°quinas Safrapay\",\n\t\t\t\t\"description\": \"Condi√ß√µes taxas,Suporte e configura√ß√µes,Consultar OS,Vendas,Antecipa√ß√£o\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Conta Corrente\",\n\t\t\t\t\"description\": \"Pix, Falar sobre conta, Consultar Pacotes\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Solu√ß√µes\",\n\t\t\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Apoio √† Navega√ß√£o\",\n\t\t\t\t\"description\": \"Acesso, Altera√ß√µes cadastrais, Alterar domic√≠lio\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"6\",\n\t\t\t\t\"title\": \"Transa√ß√£o n√£o autorizada\",\n\t\t\t\t\"description\": \"Meu pagamento n√£o foi autorizado\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"7\",\n\t\t\t\t\"title\": \"Produtos\",\n\t\t\t\t\"description\": \"Seguros, Investimento, Desempenho e Cart√£o\"\n\t\t\t}\n\t\t]\n\t\tif (cpfAppKey && cpfAppKey != 'false') {\n\t\t\tdefaultMenuOptions = [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Perda ou Roubo\",\n\t\t\t\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"M√°quinas Safrapay\",\n\t\t\t\t\t\"description\": \"Condi√ß√µes taxas,Suporte e configura√ß√µes,Consultar OS,Vendas,Antecipa√ß√£o\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Conta Corrente\",\n\t\t\t\t\t\"description\": \"Extratos,Fazer pix,Pagar Contas,Antecipar saldo,Falar sobre conta,Pacote\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"4\",\n\t\t\t\t\t\"title\": \"Solu√ß√µes\",\n\t\t\t\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"5\",\n\t\t\t\t\t\"title\": \"Apoio √† Navega√ß√£o\",\n\t\t\t\t\t\"description\": \"Acesso, Altera√ß√µes cadastrais, Alterar domic√≠lio\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"6\",\n\t\t\t\t\t\"title\": \"Transa√ß√£o n√£o autorizada\",\n\t\t\t\t\t\"description\": \"Meu pagamento n√£o foi autorizado\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"7\",\n\t\t\t\t\t\"title\": \"Produtos\",\n\t\t\t\t\t\"description\": \"Seguros, Investimento, Desempenho e Cart√£o\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\tif (!selectedEc) {\n\t\t\tdefaultMenuOptions = [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Perda ou Roubo\",\n\t\t\t\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"M√°quinas Safrapay\",\n\t\t\t\t\t\"description\": \"Condi√ß√µes taxas,Suporte e configura√ß√µes,Consultar OS,Vendas,Antecipa√ß√£o\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"4\",\n\t\t\t\t\t\"title\": \"Solu√ß√µes\",\n\t\t\t\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"5\",\n\t\t\t\t\t\"title\": \"Conta Corrente\",\n\t\t\t\t\t\"description\": \"Pix, Falar sobre conta, Consultar Pacotes\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"6\",\n\t\t\t\t\t\"title\": \"Apoio √† Navega√ß√£o\",\n\t\t\t\t\t\"description\": \"Acesso, Altera√ß√µes cadastrais, Alterar Domic√≠lio\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"7\",\n\t\t\t\t\t\"title\": \"Transa√ß√£o n√£o autorizada\",\n\t\t\t\t\t\"description\": \"Meu pagamento n√£o foi autorizado\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"8\",\n\t\t\t\t\t\"title\": \"Produtos\",\n\t\t\t\t\t\"description\": \"Seguros, Investimento, Desempenho e Cart√£o\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\tif (parsedContaSelecionada.segmentoGerente) {\n\t\t\tdefaultMenuOptions.find(option => option.title === \"Produtos\").description = \"Seguros, Investimento, Renegocia√ß√£o, Gravame, Desempenho e Cart√£o\"\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Ah! Voc√™ tamb√©m pode digitar *Voltar* para voltar uma etapa, e *Sair* para finalizar o atendimento a qualquer momento.`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma op√ß√£o\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc","contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bf02a80c-2eb6-4ec2-add5-e968340753ab","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cc100ffd-cb0d-499f-9e46-5d6e9f14b9e1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a489fc85-ed9f-4fb4-b072-0b286c73fa39","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-94c64aa9-0bad-4326-a358-7a0665043ee3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4a3ecc16-b4c8-4970-90fe-2a95b5ae4f4f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"30e39880-1d2a-439a-a0ed-1e7210966286","root":false,"$title":"[M.5.0.0][MSG] Menu Principal","$position":{"top":"1612px","left":"1719.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5ddf643-13c0-4a81-a174-e1aa9dd86873":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5b733936-1903-4654-b904-fc7b72d289cc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Bot M√°quina Safrapay ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'e0d2ce64-3265-46bd-b396-f53ad65b26e6',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d02ef8e1-41a6-4df8-ae88-9f54609b5548","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um servi√ßo sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-9c161e36-113c-4d42-9e2e-b13c5f09e9c1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9754a19a-7835-4187-a193-defbccb0ede2","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$title":"[Redirect] To Maquina Safrapay","$position":{"top":"1665px","left":"1288px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"491c0860-a3da-491c-bfc6-3b7f99e29c29":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"18838d12-aaf3-43c0-b6ae-1c14204ca89a","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:853"}],"$conditionOutputs":[{"stateId":"525c6b7f-cc74-42fb-a747-f7948ebc0984","typeOfStateId":"state","$connId":"con_83","$id":"833fd40f-f365-49d2-a884-7dd4bbf5345e","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:869"}],"$invalid":false,"$$hashKey":"object:855"}],"$enteringCustomActions":[{"$id":"be5d1b5c-8ea6-4363-b2b8-3bf398126ac5","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpf\" to \"{contact.extras.cpf}\"","$invalid":false,"settings":{"variable":"cpf","value":"{{contact.extras.cpf}}"},"conditions":[]},{"$id":"b9150719-3abd-4de0-91a9-0e0a46b2e951","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoCliente\" to \"{contaSelecionada@codigoCliente}\"","$invalid":false,"settings":{"variable":"codigoCliente","value":"{{contaSelecionada@codigoCliente}}"},"conditions":[]},{"$id":"4d44859f-0717-41e5-ba98-576f390ab95a","$typeOfContent":"","type":"SetVariable","$title":"Set \"conta\" to \"{contaSelecionada@conta}\"","$invalid":false,"settings":{"variable":"conta","value":"{{contaSelecionada@conta}}"},"conditions":[]},{"$id":"85eb4b94-9458-4cf2-8406-5b4562fea7c7","$typeOfContent":"","type":"SetVariable","$title":"Set \"agencia\" to \"{contaSelecionada@agencia}\"","$invalid":false,"settings":{"variable":"agencia","value":"{{contaSelecionada@agencia}}"},"conditions":[]},{"$id":"af88479f-0eb6-4d73-8bf0-02d336989e40","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoSegmento\" to \"{contaSelecionada@codigoSegmento}\"","$invalid":false,"settings":{"variable":"codigoSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"8b5f060f-1017-40ea-9648-500fe736f645","$typeOfContent":"","type":"SetVariable","$title":"Set \"agenciaConta\" to \"{contaSelecionada}\"","$invalid":false,"settings":{"variable":"agenciaConta","value":"{{contaSelecionada}}"},"conditions":[]},{"$id":"1f7211bd-def1-4d54-920b-5e89a70cc76c","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoPessoa\" to \"{contaSelecionada@tipoPessoa}\"","$invalid":false,"settings":{"variable":"tipoPessoa","value":"{{contaSelecionada@tipoPessoa}}"},"conditions":[]},{"$id":"7909d9f8-3adc-4e98-8ac6-0157dd3cae94","$typeOfContent":"","type":"SetVariable","$title":"Set \"doc\" to \"{contaSelecionada@doc}\"","$invalid":false,"settings":{"variable":"doc","value":"{{contaSelecionada@doc}}"},"conditions":[]},{"$id":"148cc8da-b70b-4e08-b2b0-fbd643dc2932","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortname\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"shortname","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"e73aeada-145c-4b79-8ebd-c951c98a76ce","$typeOfContent":"","type":"SetVariable","$title":"Set \"ec\" to \"selectedEc@codigoEc\"","$invalid":false,"settings":{"variable":"ec","value":"{{selectedEc@codigoEc}}"},"conditions":[]},{"$id":"204f5d88-cf49-44a6-a048-aa84cbfb0d42","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"64588b09-10f5-41e0-b2ce-5c17fc3c210e","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{codigoSegmento}\"","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"02b7bc32-f8f9-4c46-bcfc-910d4c30f381","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortnameFull\" to \"{contaSelecionada@shortname}\"","$invalid":false,"settings":{"variable":"shortnameFull","value":"{{contaSelecionada@shortname}}"},"conditions":[]},{"$id":"558f5241-b041-4355-a445-98049bb6ee82","$typeOfContent":"","type":"SetVariable","$title":"Set \"usuario\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"usuario","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"909c2e2e-bf98-48eb-aaa6-fede43fd5d63","$typeOfContent":"","type":"SetVariable","$title":"Set \"nome\" to \"{contact.name}\"","$invalid":false,"settings":{"variable":"nome","value":"{{contact.name}}"},"conditions":[]},{"$id":"d3b43eaf-fb6e-4407-9dd1-aa13f7690077","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\" to \"false\"","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"5f2161cd-02b6-4e82-89b7-0054c54a0c0b","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoCliente\" to \"bdsp\"","$invalid":false,"settings":{"variable":"tipoCliente","value":"Bdsp"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}]},{"$id":"86666ff3-fd19-414d-8746-2a9e287541cd","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"402216b1-da34-4435-b20a-e857ea018e84","$typeOfContent":"","type":"ExecuteScript","$title":"phone","$invalid":false,"settings":{"function":"run","source":"function run(phone) {\n    let extracted_phone = phone\n        .split('@')[0]\n    if (extracted_phone.length == 10)\n        extracted_phone = extracted_phone\n            .substr(0, 2)\n            .concat('9', extracted_phone.substr(2));\n    return extracted_phone;\n}","inputVariables":["contact.identity"],"outputVariable":"phone","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"04fec05f-0acb-4d18-8550-9cdbfbd40958","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"{state@assunto}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{state@assunto}}"},"conditions":[]},{"$id":"27243618-496f-48c3-9b3e-a338e038e479","$typeOfContent":"","type":"SetVariable","$title":"Set \"nomeCompleto\" to \"{nome}\"","$invalid":false,"settings":{"variable":"nomeCompleto","value":"{{nome}}"},"conditions":[]},{"$id":"ad35f69b-4be8-485d-8a73-df753ffd3e48","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"const transferMessage = {\n\t'antecipar saldo': 'Antecipar saldo',\n\t'fazer pix': 'Fazer Pix',\n\t'pagar conta': 'Pagar contas',\n\t'extrato conta corrente': 'Extrato Conta',\n\t'extrato vendas': 'Extrato Vendas',\n\t'extrato recebimentos': 'Extrato Recebimentos',\n\t'perda ou roubo': 'Perda ou Roubo',\n\t'suporte t√©cnico': 'Suporte Tecnico',\n\t'n√£o recebi minha venda': 'Venda n√£o recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'apoio √† navega√ß√£o': 'Aplicativo',\n\t'suporte e configura√ß√µes': 'Suporte e Configura√ß√µes',\n\t'transa√ß√£o n√£o autorizada': 'Transa√ß√£o n√£o Autorizada',\n\t'seguros': 'Seguros'\n}\n\nconst assunto = {\n\t'antecipar saldo': 'antecipa√ß√£o',\n\t'fazer pix': 'pix',\n\t'pagar conta': 'pagar contas',\n\t'extrato conta corrente': 'extrato conta',\n\t'extrato vendas': 'extrato vendas',\n\t'extrato recebimentos': 'extrato recebimentos',\n\t'perda ou roubo': 'perda ou roubo',\n\t'suporte t√©cnico': 'Suporte T√©cnico',\n\t'aplicativo': \"Aplicativo\",\n\t'consultar protocolo': 'Consulta de Protocolo',\n\t'simulador de vendas': 'Simulador de vendas',\n\t'n√£o recebi minha venda': 'Venda n√£o recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'apoio √† navega√ß√£o': 'Apoio Aplicativo',\n\t'suporte e configura√ß√µes': 'Suporte e Configura√ß√µes',\n\t'transa√ß√£o n√£o autorizada': 'Transa√ß√£o n√£o Autorizada',\n\t'seguros': 'Seguros'\n}\n\nconst botDestination = {\n\t'antecipar saldo': 'atendimentohumano',\n\t'fazer pix': 'atendimentohumano',\n\t'pagar conta': 'atendimentohumano',\n\t'extrato conta corrente': 'atendimentohumano',\n\t'extrato vendas': 'atendimentohumano',\n\t'extrato recebimentos': 'atendimentohumano',\n\t'perda ou roubo': 'atendimentohumano',\n\t'suporte t√©cnico': 'atendimentohumano',\n\t'consulta os': 'Bot OS',\n\t'aplicativo': 'App',\n\t\"n√£o recebi minha venda\": \"Bot M√°quina Safrapay\",\n\t'consultar protocolo': 'Bot M√°quina Safrapay',\n\t'simulador de vendas': 'Bot M√°quina Safrapay',\n\t'descredenciamento': 'atendimentohumano',\n\t'apoio √† navega√ß√£o': 'App',\n\t'suporte e configura√ß√µes': 'Bot M√°quina Safrapay',\n\t'transa√ß√£o n√£o autorizada': 'Bot M√°quina Safrapay',\n\t'seguros': 'seguros'\n}\n\nconst stateDestination = {\n\t'consulta os': 'fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db',\n\t'n√£o recebi minha venda': '4051c1ad-de53-4ef3-bfa0-add7a989e960',\n\t'consultar protocolo': '168598f7-bb5b-4eb0-a37e-45f8c48ccdde',\n\t'simulador de vendas': 'c391e959-860e-4eaf-86b9-71fcd8888c86',\n\t'descredenciamento': 'inicio',\n\t'apoio √† navega√ß√£o': 'Welcome',\n\t'suporte e configura√ß√µes': '4f6e7e6d-21b4-4b11-9913-6aa5149a7469',\n\t'transa√ß√£o n√£o autorizada': 'f0a8601f-5de1-4885-9b44-4f4a6e062c01',\n\t'seguros': 'Welcome',\n\t'antecipar saldo': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'fazer pix': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'pagar conta': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'extrato conta corrente': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'extrato vendas': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'extrato recebimentos': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'perda ou roubo': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'suporte t√©cnico': '1bf05d26-3661-4d02-a79a-a83bc40e7346',\n\t'descredenciamento': '1bf05d26-3661-4d02-a79a-a83bc40e7346'\n}\n\nfunction run(userInput, env, previousBlockid, cpfAppKey, serviceName, previousStateName) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tif (!cpfAppKey && userInput.toLowerCase() === 'fazer pix') {\n\t\t\tuserInput = 'pix'\n\t\t}\n\n\t\tlet destination = botDestination[userInput.toLowerCase()] || `excecoes ${env || \"\"}`.trim()\n\t\tif (env === 'Dev' && destination !== 'WhatsApp PJ') {\n\t\t\tdestination = `${destination} ${env}`\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: destination,\n\t\t\tstateDestination: stateDestination[userInput.toLowerCase()] || 'welcome',\n\t\t\tuserInput: transferMessage[userInput.toLowerCase()] || userInput,\n\t\t\tassunto: assunto[userInput.toLowerCase()] || userInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: userInput,\n\t\t\tuserInput,\n\t\t\terror: err.message\n\t\t}\n\t}\n}\n\n","inputVariables":["userInput","config.env","state.previous.id","cpfAppKey","config.serviceName","state.previous.name"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7f8280ca-d437-4ee7-99a9-d39b57871a9a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{calendar.datetime}} | {{state}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d25bd382-6119-4538-ae54-658db133bbbb","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-cc32ed4e-c8f7-4703-860c-49a69f9f51cb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-81a14f2b-5c0d-4c4e-a82d-d2717d19811e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"491c0860-a3da-491c-bfc6-3b7f99e29c29","root":false,"$title":"[Temporario][OLD] Redireciona ao servi√ßo","$position":{"top":"1976px","left":"1285px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"525c6b7f-cc74-42fb-a747-f7948ebc0984":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"af4b8e88-5277-4acd-9664-bd434b53ff39","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3996e980-1a2e-48dc-8e6b-238fd5523544","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a04939d2-45e8-43da-9045-04d8c06c1997","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"525c6b7f-cc74-42fb-a747-f7948ebc0984","root":false,"$title":"[Redirect] ao servi√ßo","$position":{"top":"1988px","left":"1000px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06ecab99-d5ad-491b-b680-03a429bc6091","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"75b55cb8-4764-479d-b17d-48776ccc45c9","typeOfStateId":"state","$connId":"con_88","$id":"e6b2d820-969b-4e4a-becb-b8c0b2598b73","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ffe4a4c7-1ce7-4d67-a423-5c3d2c01b375","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf, exception) {\n    const invalidCpfMessage = 'input inesperado';\n    try {\n        if (!cpf) {\n            return 'inatividade'\n        }\n        if (exception === 'quickReply' || exception === 'skip') {\n            if (cpf.match(/tentar (novamente|novamnete|novament|novametne)/i)) {\n                return 'tentar novamente'\n            }\n            if (cpf.match(/encerrar(a|ar|ra|r)/i)) {\n                return 'encerrar'\n            }\n            return invalidCpfMessage\n        }\n        \n        cpf = cpf.replace(/\\D/g, '');\n        if (cpf.length !== 11 || /^(.)\\1*$/.test(cpf)) {\n            return invalidCpfMessage;\n        }\n        let sum = 0;\n        let remainder;\n        for (let i = 1; i <= 9; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(9, 10))) {\n            return invalidCpfMessage;\n        }\n        sum = 0;\n        for (let i = 1; i <= 10; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(10, 11))) {\n            return invalidCpfMessage;\n        }\n        return cpf;\n    } catch (err) {\n        return invalidCpfMessage;\n    }\n}","inputVariables":["input.content","exception"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8ceee10-b751-4f03-9fea-cf15009ee655","$typeOfContent":"","type":"MergeContact","$title":"Set \"cpf\" to \"{userInput}\"","$invalid":false,"settings":{"extras":{"cpf":"{{userInput}}"}},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"768bd9d1-acb2-4a9e-9a2b-e9d31c5c6d06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} valida√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} valida√ß√£o","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0f3dc18b-2a49-43ac-8e0f-fc9c50bb46cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"4d5083d0-0c1a-431c-94b0-6961c2f6cb94","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.2.0.1","variable":"exceptionType"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ac46b404-c0a1-4fd3-bd61-6063dca3131e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-561c5167-31b7-4792-bd3a-a7e632f0b7bf","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-3547a4c4-fb8a-4da0-ad0a-054265460129","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cf0c0858-d2b4-4b92-9593-027475835ee8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-87e7e9be-6016-4387-aa81-94d5749712c3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","root":false,"$title":"[M.2.0.1][INPUT] Valida CPF","$position":{"top":"697px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"fbd38da5-c763-4500-aaf8-955e2461e1a8","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","typeOfStateId":"state","$connId":"con_93","$id":"23207c0a-4052-4886-8c62-fa4af789e8fd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f549ed1f-5144-4910-b3eb-1d4931affe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(message, contas) {\n\ttry {\n\t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tif (isNaN(message)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tconst index = Number(message) - 1\n\t\tconst parsedContas = JSON.parse(contas)\n\t\tconst contaSelecionada = parsedContas.contas[index]\n\t\tif (!contaSelecionada) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\treturn contaSelecionada\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","contas"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c40f5e3d-554a-4b05-9ff3-b668ef7cecdc","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"contaSelecionada","value":"{{userInput}}"},"conditions":[{"values":["input inesperado","inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"d3c4d368-dab9-428c-8a29-11cb27cd80bb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} valida√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} valida√ß√£o","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f1e9fe18-56a9-4b25-b28b-807e3fbd01ea","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"7b51d409-9bdc-42d5-b838-86cbdd2eede0","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.3.1.1","variable":"exceptionType"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-da2f31a5-1e5a-450c-b6a5-322b7d7c2915","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7cddde39-a858-4d58-8797-c5d1bae1fefe","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-65974f85-e627-4177-bedb-1d4b6eedd2c2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-33c31a6c-5c28-43f0-9e87-9714de627b0a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","root":false,"$title":"[M.3.1.1][INPUT] Valida Sele√ß√£o de conta","$position":{"top":"1334px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e567a78-dbb9-4216-baa4-9d476bc2b887":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"633713cd-19ca-4db4-89db-7d7f4e743c98","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"c2169ab5-6936-4b69-aadb-73b7330b39bc","typeOfStateId":"state","$connId":"con_98","$id":"88d96d36-20fb-4051-aea1-130b6fadaef6","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"992bb5b8-1303-48c7-931a-f01ab2eaf914","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(message, ec) {\n\ttry {\n\t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n\n\t\tif (isNaN(message)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tconst index = Number(message) - 1\n\t\tconst parsedEc = JSON.parse(ec)\n\t\tconst ecSelecionado = parsedEc.ecList[index]\n\t\tif (!ecSelecionado) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\treturn ecSelecionado\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","ecList"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"493ad05b-2c7d-4996-9039-3779f2364a01","$typeOfContent":"","type":"SetVariable","$title":"Set \"selectedEc\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"selectedEc","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"710fb3be-ade5-4044-970a-b609fe9d3947","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} valida√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} valida√ß√£o","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"023a3323-c889-4d8b-9b1e-0a3e90055e1f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"51e3ecb2-3cd4-4e9e-85ad-bd5a2e11fb00","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.4.1.1","variable":"exceptionType"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-22fecba1-d080-47fe-b4d4-96210cecb825","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4803faec-c69e-4a67-b2df-109ab6c6ecbf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f78f3db8-4992-4196-8af3-260e9bb66300","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ff1cddbe-63cb-459d-b7ad-063dc24169ad","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0e567a78-dbb9-4216-baa4-9d476bc2b887","root":false,"$title":"[M.4.1.1][INPUT] Valida Sele√ß√£o de ec","$position":{"top":"1117px","left":"2052.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"595bbc26-6daf-4319-a175-17192cf276fc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false,"$$hashKey":"object:566"}],"$conditionOutputs":[{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","typeOfStateId":"state","$connId":"con_103","$id":"a99636d2-f26d-493c-bc1a-ce50e9e39b6a","conditions":[{"source":"context","comparison":"equals","values":["M√°quinas Safrapay"],"variable":"userInput","$$hashKey":"object:593"}],"$invalid":false,"$$hashKey":"object:569"},{"stateId":"c5482705-133e-4f31-b01e-7930e16e12a3","typeOfStateId":"state","$connId":"con_108","$id":"3a5498b9-e6af-4239-ae43-67f3bf7dfb1f","conditions":[{"source":"context","comparison":"equals","values":["Solu√ß√µes"],"variable":"userInput","$$hashKey":"object:611"}],"$invalid":false,"$$hashKey":"object:570"},{"stateId":"20bd236e-277f-4ecf-94f0-f63bdcd5efb6","typeOfStateId":"state","$connId":"con_113","$id":"a50f025c-4721-4cdc-bf81-06efe1aeb30b","conditions":[{"source":"context","comparison":"equals","values":["Conta corrente"],"variable":"userInput","$$hashKey":"object:629"}],"$invalid":false,"$$hashKey":"object:571"},{"stateId":"621b7935-89f3-450d-87b1-6caf539d5ec7","typeOfStateId":"state","$connId":"con_118","$id":"40c7bc98-7ffd-4bf8-b539-ad3cc80cb673","conditions":[{"source":"context","comparison":"equals","values":["Produtos"],"variable":"userInput","$$hashKey":"object:647"}],"$invalid":false,"$$hashKey":"object:572"},{"stateId":"491c0860-a3da-491c-bfc6-3b7f99e29c29","typeOfStateId":"state","$connId":"con_123","$id":"e618a090-8648-4609-b70b-ec545b004438","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput","$$hashKey":"object:663"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput","$$hashKey":"object:664"}],"$invalid":false,"$$hashKey":"object:573"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"172bdd8d-2409-4bc2-8335-09884e2ecb33","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n\nfunction run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[e√™]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[e√©]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[e√©][cs]im[ou]|d[√©e][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f082125-b0fd-4f51-9297-74bfc4b4c961","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"38306ba1-03a0-4eaf-a340-f50c2d48264d","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ab889191-fb1d-4935-9e7a-3fc688cbeede","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"precisaKBA\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(userInput) {\n\ttry {\n\t\tconst listaKBA = [\n\t\t\t\"Descredenciamento\",\n\t\t\t'Questionar uma cobran√ßa',\n\t\t\t'pacotes',\n\t\t\t'Simulador de vendas',\n\t\t\t'Taxa Pix na Safrapay',\n\t\t\t'Taxas de antecipa√ß√£o',\n\t\t\t'Taxas de venda',\n\t\t\t'Consultar m√°quinas',\n\t\t\t'Domic√≠lio banc√°rio']\n\t\t\tconst precisaKBA = listaKBA.some(intencao => userInput === intencao)\n\n\t\t\tif (precisaKBA){\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t} catch(erro){\n\t\treturn false\n\t}\n}","inputVariables":["userInput"],"outputVariable":"precisaKBA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a39d9f66-ffe2-40a0-9d91-8307c0d8cdb0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} valida√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} valida√ß√£o","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"2c33d508-83ac-45cd-b327-99711864563b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-18fc03ec-9dab-4fb3-9922-a9ff3552380c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f286c8c-d26d-4eae-9cf2-d7ae43d38491","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c26913e0-2f29-43fc-add0-67cd8acaac57","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-34008aae-d65c-464b-a533-f5eca2fc904e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"595bbc26-6daf-4319-a175-17192cf276fc","root":false,"$title":"[M.5.0.0][INPUT] Menu Principal","$position":{"top":"1816px","left":"1720px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7d220bd-2237-49f4-88ec-14c555bf202c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',//Refatorar\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um servi√ßo sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bf66317f-a924-4067-9005-b81fb3033452","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-48464133-543d-4f7f-8f89-7ebd1b7243a2","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c7d220bd-2237-49f4-88ec-14c555bf202c","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"895px","left":"126px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c5482705-133e-4f31-b01e-7930e16e12a3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Solu√ß√µes ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d4298a8d-1afd-4a91-84a2-fc09dcf31ed6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um servi√ßo sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3077a3c2-cd0a-4faa-8366-44b56b1e7bc2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4c9f6f8d-8a1b-4dc2-9a2a-e7ce363fd047","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c5482705-133e-4f31-b01e-7930e16e12a3","root":false,"$title":"[Redirect] To Solu√ß√µes","$position":{"top":"1815px","left":"1289px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"621b7935-89f3-450d-87b1-6caf539d5ec7":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b97c4ff7-f36a-4b19-8940-73380870d248","typeOfStateId":"state","$connId":"con_128","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec, contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Seguros\",\n\t\t\t\t\"description\": \"Informa√ß√µes sobre seguros.\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Investimentos\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Renegocia√ß√£o\",\n\t\t\t\t\"description\": \"Renegocia√ß√£o de d√≠vidas\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Gravame\",\n\t\t\t\t\"description\": \"Linha de cr√©dito\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Meu Desempenho Safrapay\",\n\t\t\t\t\"description\": \"Contratar, cancelamento e d√∫vidas\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"6\",\n\t\t\t\t\"title\": \"Cart√£o\",\n\t\t\t\t\"description\": \"Solicitar e desbloquear cart√£o, esqueci minha senha e perda/roubo\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tdefaultMenuOptions = defaultMenuOptions.filter((option) => option.title !== 'Gravame' && option.title !== 'Renegocia√ß√£o')\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Agora, por gentileza, selecione no menu abaixo a op√ß√£o desejada.üëá` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do bot√£o\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc","contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibi√ß√£o"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e312e653-5c6c-4f66-8c0c-0dc591015bea","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-797efa68-de94-45fa-8cae-a3667f3ec9d8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-07e961e6-5cc6-4061-a11c-e7b62409ce7b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"621b7935-89f3-450d-87b1-6caf539d5ec7","root":false,"$title":"[M.5.4.0][MSG] Produtos","$position":{"top":"2058px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b97c4ff7-f36a-4b19-8940-73380870d248":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b2d0943f-28c6-40ee-87a3-c98641dda5eb","typeOfStateId":"state","$connId":"con_133","$id":"94856239-8f60-4ab0-a169-b974a0e70313","conditions":[{"source":"context","comparison":"equals","values":["Meu Desempenho Safrapay"],"variable":"userInput"}],"$invalid":false},{"stateId":"384b6397-2b2e-4808-af80-3c5540244ccf","typeOfStateId":"state","$connId":"con_138","$id":"5fab60e0-7cd2-4bff-a18a-6c2ef1e01717","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[e√™]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[e√™]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[e√©]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[e√©][cs]im[ou]|d[√©e][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} valida√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} valida√ß√£o","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ceebf365-5230-4420-8af5-96833422e50b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ae8b997e-c76c-4594-8265-bf5deb4433e6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f55478c8-1b93-43be-aa8c-718532aaf962","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0816a20e-7563-458d-9ae4-147049e2f465","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b97c4ff7-f36a-4b19-8940-73380870d248","root":false,"$title":"[M.5.4.0][INPUT] Produtos","$position":{"top":"2257px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"384b6397-2b2e-4808-af80-3c5540244ccf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10c195ed-131d-4823-a09f-de96fb954625","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5e03585d-c827-4161-8532-e49447d72933","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"const destination = {\n\t'Seguros': {\n\t\tbotDestination: 'seguros',\n\t\tstateDestination: 'welcome'\n\t},\n\t'Investimentos': {\n\t\tbotDestination: 'contacorrente',\n\t\tstateDestination: 'f88bbdeb-3963-49e0-a355-edc20350bbfd'\n\t},\n\t'Renegocia√ß√£o': {\n\t\tbotDestination: 'contacorrente',\n\t\tstateDestination: '5ea0cac6-c5fd-49f9-9423-54d0e660adae'\n\t},\n\t'Gravame': {\n\t\tbotDestination: 'contacorrente',\n\t\tstateDestination: '1e3206de-707e-4dac-9749-9f24d53110c0'\n\t},\n\t// 'Meu desempenho Safrapay': {\n\t// \tbotDestination: '',\n\t// \tstateDestination: ''\n\t// },\n\t'Cart√£o': {\n\t\tbotDestination: 'contacorrente',\n\t\tstateDestination: '37f23f86-2009-43f1-b7a5-f50093c784f0'\n\t}\n}\nfunction run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst destinationBot = destination[intent]\n\t\tif (!destinationBot) {\n\t\t\tthrow new Error('invalid destination')\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\t...destinationBot,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"820ba5c8-e91c-44fe-8276-cbdc5aeb6c67","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-33828eb6-5860-4c7a-a4f3-4e02f48b11c5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b984d6aa-0ebf-431a-a7dd-46d3ac4481b7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"384b6397-2b2e-4808-af80-3c5540244ccf","root":false,"$title":"[Redirect] Menu produtos","$position":{"top":"2441px","left":"1551px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20bd236e-277f-4ecf-94f0-f63bdcd5efb6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10c195ed-131d-4823-a09f-de96fb954625","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5e03585d-c827-4161-8532-e49447d72933","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"820ba5c8-e91c-44fe-8276-cbdc5aeb6c67","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8035231a-d060-4b5c-bd2c-24947a9278be","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4b868628-727a-4638-b8e1-0b877be8d844","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"20bd236e-277f-4ecf-94f0-f63bdcd5efb6","root":false,"$title":"[Redirect] Menu Conta Corrente","$position":{"top":"1950px","left":"1996px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b2d0943f-28c6-40ee-87a3-c98641dda5eb":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fd7b8c78-dba9-45c2-a0db-aca46722d054","typeOfStateId":"state","$connId":"con_143","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Contratar\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Cancelamento\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"D√∫vidas\",\n\t\t\t\t\"description\": \"\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, sobre *Meu Desempenho Safrapay* como podemos te ajudar?` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do bot√£o\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibi√ß√£o"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4daac268-86e1-4da5-a476-572fd1412b0c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-56f727ac-3edd-436d-a864-eab0493493ec","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cf01d626-c84c-4858-8f45-65de2908cfbd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b2d0943f-28c6-40ee-87a3-c98641dda5eb","root":false,"$title":"[M.5.4.1][MSG] Meu Desempenho","$position":{"top":"2454px","left":"1960px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fd7b8c78-dba9-45c2-a0db-aca46722d054":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","typeOfStateId":"state","$connId":"con_148","$id":"9df32c47-7799-4014-bb2a-33ed9f012542","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[e√™]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[e√©]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[e√©][cs]im[ou]|d[√©e][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} valida√ß√£o\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} valida√ß√£o","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d3712d49-f818-48f5-b73d-0125259e157b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0212f8af-70f7-485b-a232-709876c39c84","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4a249c6e-c7cf-48c5-a06f-e2e3b8c69d2f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-40761b18-0f8d-411d-88d9-a95a0ad3c294","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"fd7b8c78-dba9-45c2-a0db-aca46722d054","root":false,"$title":"[M.5.4.1][INPUT] Meu Desempenho","$position":{"top":"2677px","left":"1960px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f2c4d052-2f9b-4aa8-9925-48aa824fc35c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um servi√ßo","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-89478314-5270-4548-88c8-f1128d151452","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-55b0196e-1d39-4364-8cd8-e9b7441b37ce","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","root":false,"$title":"[Redirect] to Atendimento Humano","$position":{"top":"2893px","left":"1960px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8d2f811-ac89-4e91-9b16-c93b4b661447":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5d50808-89ef-4829-a22e-9ff8a722b3ed","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","typeOfStateId":"state","$connId":"con_153","$id":"362ef9b3-c7dc-472a-bf56-7e87ff699ceb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2d666d07-e7b6-4ebf-b17a-36a613c3163f","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"39e7c0e1-eba2-4cc4-a850-89ed3ea6ff5f","$typeOfContent":"","type":"SetVariable","$title":"Set \"idSessao\" to \"{random.guid}\"","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[]},{"$id":"006f7ef8-db09-4c02-91c3-236244038996","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]},{"$id":"082408ed-5e16-420c-bbaf-431414b2beff","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionTypeMedia\" to \"false\"","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"false"},"conditions":[]},{"$id":"5e8be885-1804-47b0-b82e-3f9d6bf65a13","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"\"","$invalid":false,"settings":{"variable":"contaSelecionada"},"conditions":[]},{"$id":"a09b5d09-2b3d-4d30-aac1-dc4539f56ea1","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"errorCounter\"","$invalid":false,"settings":{"variable":"errorCounter","expiration":1},"conditions":[]},{"$id":"182cbadf-5180-4961-a503-6595224b8caf","$typeOfContent":"","type":"SetVariable","$title":"Set \"returnStateAuth\" to \"false\"","$invalid":false,"settings":{"variable":"returnStateAuth","value":"false"},"conditions":[]},{"$id":"c21ffa88-e7c7-4c64-bbf4-ca1858acb9db","$typeOfContent":"","type":"SetVariable","$title":"Set \"autenticado\" to \"false\"","$invalid":false,"settings":{"variable":"autenticado","value":"false"},"conditions":[]},{"$id":"35857fee-39ca-4a12-ac7b-a6330b3986be","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpfAppKey\" to \"\"","$invalid":false,"settings":{"variable":"cpfAppKey"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1eb77059-3a98-4e59-ba2b-1c6f974cfc6e","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"inicio\"","$invalid":false,"settings":{"variable":"assunto","value":"inicio"},"conditions":[]},{"$id":"0c352339-18f4-4aac-ad53-ee731d41e2e5","$typeOfContent":"","type":"SetVariable","$title":"Set \"autoservico\" to \"\"","$invalid":false,"settings":{"variable":"autoservico"},"conditions":[]},{"$id":"445f9420-03a2-40e6-b147-f4dc22d999eb","$typeOfContent":"","type":"SetVariable","$title":"Set \"autenticadoKba\" to \"false\"","$invalid":false,"settings":{"variable":"autenticadoKba","value":"false"},"conditions":[]},{"$id":"9a603e47-85a1-48bc-8f5e-f05b77789460","$typeOfContent":"","type":"SetVariable","$title":"Set \"voltarState\" to \"\"","$invalid":false,"settings":{"variable":"voltarState"},"conditions":[]},{"$id":"488b16b0-d9e5-445a-9fd4-98aaf6fbbe95","$typeOfContent":"","type":"MergeContact","$title":"Reset \"extras\"","$invalid":false,"settings":{"extras":{"cpf":"-","broadcastOrigem":"-","team":"-"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e79a2529-c52d-480c-a01e-ae94aa68f6fc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-12fd5c97-7612-4d21-a83f-7dd0f372c1be","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bfde77cf-cb27-43df-ad95-16bdd950fe28","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"a8d2f811-ac89-4e91-9b16-c93b4b661447","root":false,"$title":"[M.0.0.0] Limpa Variaveis","$position":{"top":"155px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fde8a193-6fdc-4490-bbf2-a99a74582176":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","typeOfStateId":"state","$connId":"con_158","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"c2169ab5-6936-4b69-aadb-73b7330b39bc","typeOfStateId":"state","$connId":"con_163","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"506cda97-d7be-4c56-95ee-1513a6449bed","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager","value":"504"},"conditions":[]},{"$id":"3595f2db-845a-46a9-b8e4-971d340e6e61","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager2\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager2","value":"504"},"conditions":[]},{"$id":"2a9a6927-9903-4663-8428-728f53b306e1","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager3\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager3","value":"504"},"conditions":[]},{"$id":"c0c0c6b8-1afd-4ce4-b885-925a92a8cd73","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager4\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager4","value":"504"},"conditions":[]}],"$leavingCustomActions":[{"$id":"30d3d657-a220-4319-960b-99da5d05028d","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" AG/CONTA","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{idSessao}}","Safra-Bot-ID":"{{config.serviceName}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"681fd1ec-ab7f-46cf-acb8-a00fcdeaedda","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Agencia/Conta","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusAccountManager}} | {{bodyAccountManager}}"},"conditions":[]},{"$id":"6ba9e482-f73a-4643-8d14-45bb28306258","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" Segmento 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}]},{"$id":"45fe4d58-7c28-438c-950f-952042acd9ec","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Segmento 20","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0020 | GET | {{statusAccountManager2}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}]},{"$id":"feac2a4a-087d-414a-93eb-345ca1f991f5","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" Segmento 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"}]},{"$id":"fbbe8643-7f87-4484-8e52-216ad1b09264","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Segmento 17","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0017 | GET | {{statusAccountManager3}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"}]},{"$id":"27d6671d-9b1c-47c7-9d6c-cdcd9929aea3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" PHONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager4","responseBodyVariable":"bodyAccountManager"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"variaveldesativada"}]},{"$id":"81e4f97d-b045-488d-82ab-e91b2d278d4c","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J | GET | {{statusAccountManager4}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager3"},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager3"}]},{"$id":"57d42e37-72f1-43e5-8a0b-49cc9217f78e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyAccountManager, contaSelecionada) {\n\ttry {\n\t\tconst selecionada = JSON.parse(contaSelecionada)\n\t\tconst { id, sigla, codigoSegmento } = JSON.parse(bodyAccountManager).data\n\t\tselecionada['filaGerente'] = sigla || id\n\t\tif (Number(codigoSegmento) === 17) {\n\t\t\tselecionada['segmentoGerente'] = 'emp2'\n\t\t}\n\t\tif (Number(codigoSegmento) === 20) {\n\t\t\tselecionada['segmentoGerente'] = 'emp1'\n\t\t}\n\t\treturn selecionada\n\t} catch (err) {\n\t\treturn contaSelecionada\n\t}\n}","inputVariables":["bodyAccountManager","contaSelecionada"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85a01d06-18f8-424a-9835-0cadc7a1f8f8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 200)) {\n\t\t\treturn 'ok'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\treturn 'erro api'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusAccountManager","statusAccountManager2","statusAccountManager3","statusAccountManager4"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"51538566-a3e0-4f14-9c21-42ddcaf26d1c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b26534f2-630a-4407-b56b-82842966876e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-66c517c9-0df7-409d-9c2c-c35c875c516a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-8bd8bf57-24a0-40b1-a76d-49dab6de81b5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-db58881b-6844-41e0-aac5-27eeffc4296a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fde8a193-6fdc-4490-bbf2-a99a74582176","root":false,"$title":"[M.4.0.1][HTTP] Obtem Carteriza√ß√£o","$position":{"top":"1116px","left":"1391px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e06cd93-6019-4a34-8468-b364f7ec47e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17e64ee0-3424-4597-bb39-91427781d927","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1401706f-cf89-4342-a34c-48af501b1be6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `broadcast ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"6e98faa6-4465-42b7-8aad-85e25ef1a72e","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5b378fa1-133c-48c8-aa30-6fc69ecd3d53","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1a68272c-ef7f-4119-b646-7005d28bfe86","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"3e06cd93-6019-4a34-8468-b364f7ec47e9","root":false,"$title":"[Redirect] To broadcast","$position":{"top":"155px","left":"375px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c2169ab5-6936-4b69-aadb-73b7330b39bc":{"$contentActions":[{"action":{"$id":"736281f9-0eff-4a05-9dff-f34beca69225","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"29c4f6d5-641c-4867-be97-d4f34d2e1f68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"29c4f6d5-641c-4867-be97-d4f34d2e1f68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cef2034b-c428-42cd-898d-a3259185c171","$typeOfContent":"text","type":"SendMessage","settings":{"id":"85d225b1-b127-4177-aa29-0b5d516fd714","type":"text/plain","content":"{{msgCpfAppkey}}","metadata":{}},"$cardContent":{"document":{"id":"85d225b1-b127-4177-aa29-0b5d516fd714","type":"text/plain","content":"{{msgCpfAppkey}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cd2af6b-1fb5-4d7a-9f57-ec1f93729c4a","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"30e39880-1d2a-439a-a0ed-1e7210966286","typeOfStateId":"state","$connId":"con_168","$id":"3359c0af-c107-4cc8-96a4-bbbac99c8979","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4e4c26c2-c277-41fc-a70c-1a08afff6f0f","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAppKey\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"SPD"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/autorizacoes-acessos-clientes/assistente-virtual/v1/chaves?documento={{contact.extras.cpf}}","responseStatusVariable":"statusAppKey","responseBodyVariable":"bodyAppKey"},"conditions":[{"source":"context","comparison":"notEquals","variable":"resource.bdsp","values":["false"]}]},{"$id":"26be31b2-7973-4187-adcf-c1e125eb2e82","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"cpfAppKey\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyAppKey) {\n\ttry {\n\t\tconst { chave } = JSON.parse(bodyAppKey).data\n\t\tif (chave) {\n\t\t\treturn chave.replace('-onboarding', \"\")\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyAppKey"],"outputVariable":"cpfAppKey","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"e28ae169-5d15-49ed-b7ff-b9da221b80c6","$typeOfContent":"","type":"SetVariable","$title":"Set \"appKey\" to \"{cpfAppKey}\"","$invalid":false,"settings":{"variable":"appKey","value":"{{cpfAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"d078a281-edce-43ef-a79d-121a8c0d6a6e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgCpfAppkey\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(cpfAppKey, msgBdsp) {\n\ttry {\n\t\tif (msgBdsp == 'false') {\n\t\t\treturn \"\"\n\t\t}\n\t\tif (cpfAppKey && cpfAppKey != 'false') {\n\t\t\treturn `Temos novidades incr√≠veis para voc√™! Agora √© poss√≠vel *fazer PIX*, *consultar extratos*, *antecipar saldo* e *pagar contas* diretamente por este canal.\n\n √â muito f√°cil:\n1. Acesse o *menu principal*.\n2. Selecione a op√ß√£o *Conta Corrente*.\n3. Escolha a funcionalidade que voc√™ precisa.\n\nExperimente e aproveite todas as facilidades que preparamos para voc√™!`\n\t\t}\n\t\treturn \"\"\n\t} catch (err) {\n\t\treturn \"\"\n\t}\n}","inputVariables":["cpfAppKey","resource.msgBdsp"],"outputVariable":"msgCpfAppkey","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"6ce6494e-31d8-4a6c-b635-d312dc602401","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatusCpfAppKey\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 200)) {\n\t\t\treturn 'ok'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 404)) {\n\t\t\treturn 'ok-notfound'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 500)) {\n\t\t\treturn 'ok-error'\n\t\t}\n\t\treturn 'erro api'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusAppKey"],"outputVariable":"apiStatusCpfAppKey","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"171f1ea6-19c3-4527-9392-3ba371856c5e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo v2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/autorizacoes-acessos-clientes/assistente-virtual/v1/chaves?documento={{contact.extras.cpf}} | GET | {{statusAppKey}} | {{bodyAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"78469bd6-6ff8-4db1-8b30-230c12f1c295","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{apiStatusCpfAppKey}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatusCpfAppKey"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"3b17b9ff-79fd-4b0d-b271-f4660d219e44","$typeOfContent":"","type":"TrackEvent","$title":"Track \"dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{calendar.datetime}} | {{contaSelecionada@doc}} | {{apiStatusCpfAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7693dd1e-7841-4b06-b557-ef23f1643488","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c3fe1787-4c1a-49ab-b2f0-f469dc033b9c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-358f42af-2bf1-48b4-9242-4d67bf31793b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1c2ed61b-7ed3-4abf-9234-0fa53e7e50c2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-66f52728-8143-4802-92f2-09aea1ee9249","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c2169ab5-6936-4b69-aadb-73b7330b39bc","root":false,"$title":"[M.4.0.2][HTTP] Obtem CpfAppKey","$position":{"top":"1434px","left":"1720px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ad92948a-47ac-4d3b-bb01-b5f7ab6b7457":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"27f60a12-edac-48fb-b52a-5acb775354c3","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d8ddf32a-eac3-49fa-8fd2-8db17dad11ac","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um servi√ßo","$invalid":false,"settings":{"context":{"type":"text/plain","value":"Oi"},"address":"teste1"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ad92948a-47ac-4d3b-bb01-b5f7ab6b7457","root":false,"$title":"teste1","$position":{"top":"186px","left":"897px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9866367c-499c-4834-a0c9-931ef891ef0b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5e601b5e-ce22-488b-a067-fcc7b7f5370e","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a98e54b0-d673-471b-9cf1-e01422edd74d","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um servi√ßo","$invalid":false,"settings":{"context":{"type":"text/plain","value":"Oi"},"address":"display"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9866367c-499c-4834-a0c9-931ef891ef0b","root":false,"$title":"display","$position":{"top":"279px","left":"895px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9c7877cf-2ecc-4185-9866-b5eacb5a3a16":{"$contentActions":[{"action":{"$id":"fb8210b1-849a-4ec0-a8e5-01b9665fe177","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e777a16f-5f1c-4a5c-bd32-988cc778bebd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e777a16f-5f1c-4a5c-bd32-988cc778bebd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"63b988a2-679b-48c5-bf8c-797b37a11987","$typeOfContent":"text","type":"SendMessage","settings":{"id":"119c9058-028e-4c0a-883c-93245f4668cc","type":"text/plain","content":"beta Key c2FmcmFiZXRhd2hhdHNhcHBwajpZZnhkNFF5NEkzUFc5R25rdGw1ZQ==\n\nprod Key c2FmcmFwcm9kd2hhdHNhcHBwajpHcjFDRllyQkIzT0VleWMyNVJLTw==","metadata":{}},"$cardContent":{"document":{"id":"119c9058-028e-4c0a-883c-93245f4668cc","type":"text/plain","content":"beta Key c2FmcmFiZXRhd2hhdHNhcHBwajpZZnhkNFF5NEkzUFc5R25rdGw1ZQ==\n\nprod Key c2FmcmFwcm9kd2hhdHNhcHBwajpHcjFDRllyQkIzT0VleWMyNVJLTw=="},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2f71c5b0-b5b9-44b8-92f5-9241b617fcc2","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"9c7877cf-2ecc-4185-9866-b5eacb5a3a16","root":false,"$title":"Novo bloco","$position":{"top":"211px","left":"126px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/spdmain","builder:stateExpiration":"0.00:15:00","serviceName":"Bot Main","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e936e5ea-adcf-4669-973c-073035ebeca3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    const state = JSON.parse(voltarState)\n    try {\n        if (!voltarState) {\n            const state = {}\n            state[botOrigin] = [blockId]\n            return state\n        }\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}