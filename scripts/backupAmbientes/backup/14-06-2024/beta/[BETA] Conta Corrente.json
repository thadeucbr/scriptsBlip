{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d2712b4e-c844-4435-ba60-8364a32b3206","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"85d915aa-f1ca-4e54-9c06-04e60015756d","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"daa2d803-2548-400e-8782-47ecaec9aca1","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"b5bef41d-16bb-4ea1-b8dc-ec17b6adc914","$connId":"con_3","$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"78bdc058-ee64-454a-a1bc-caeb50bba482","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1d0c3707-44ea-4a69-94dc-29afddc697ed","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e4aa80a0-bc0e-4266-bf14-0a6475175977","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"568.333px","left":"879px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b687933a-994c-4382-8051-601710a0e8ea","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"928e1999-3310-4c4f-a25a-c051922b9862","typeOfStateId":"state","$connId":"con_8","$id":"d40c89b5-2225-49b2-b2f8-02689607aa97","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"74c0977e-fc70-432d-8f10-ae862389b161","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]},{"$id":"bda24a54-7cdc-41e9-a4da-bab2abdc8f8d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-68eee43e-c743-48c5-a5f5-5e9a625cb1e0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"131px","left":"395px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"928e1999-3310-4c4f-a25a-c051922b9862":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-74c1d823-e137-409a-b6ff-7b6fe74d0c7e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"928e1999-3310-4c4f-a25a-c051922b9862","root":false,"$title":"[Redirect] To cascata","$position":{"top":"277px","left":"395px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"151450df-a066-47b5-a025-b141b63f5e59":{"$contentActions":[{"action":{"$id":"b3dc6fe0-5862-421a-8597-ca68ba1caf3e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a10fb9f6-38d4-42e2-8ae5-6c5e51c25640","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a10fb9f6-38d4-42e2-8ae5-6c5e51c25640","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"33e7fe3d-1d62-4fa8-bd31-bc308fb7548c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"302c1b7e-40ce-4d38-97ee-9b74259d6dad","type":"text/plain","content":"<b> Variaveis de configuração</b>\n\n1. <b>env</b> (criar apenas para o bot de <b>Dev</b> com valor <b>Dev</b>)\n\n2. serviceName (nome do serviço cadastrado no roteador para esse bot)\n\n<b>Para bots com chamada de api</b>\n\n3. <b>urlCHT</b>: https://api-hml.safra.com.br","metadata":{}},"$cardContent":{"document":{"id":"302c1b7e-40ce-4d38-97ee-9b74259d6dad","type":"text/plain","content":"<b> Variaveis de configuração</b>\n\n1. <b>env</b> (criar apenas para o bot de <b>Dev</b> com valor <b>Dev</b>)\n\n2. serviceName (nome do serviço cadastrado no roteador para esse bot)\n\n<b>Para bots com chamada de api</b>\n\n3. <b>urlCHT</b>: https://api-hml.safra.com.br"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff677ca8-6f21-4a8e-916e-915b33fd8716","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ff14a9b1-5222-4d07-a89f-419bb44321f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ff14a9b1-5222-4d07-a89f-419bb44321f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c75ab037-cff6-45ae-bd79-4b0888eeb252","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8a01262b-98d3-4aab-b473-d5a1de0f3917","type":"text/plain","content":"<b>Conferir</b>\n1. Bot cadastrado no roteador?\n2. Contexto ativo?\n3. Trackings globais ativas?\n4. Process \"voltarState\" está nas ações globais?","metadata":{}},"$cardContent":{"document":{"id":"8a01262b-98d3-4aab-b473-d5a1de0f3917","type":"text/plain","content":"<b>Conferir</b>\n1. Bot cadastrado no roteador?\n2. Contexto ativo?\n3. Trackings globais ativas?\n4. Process \"voltarState\" está nas ações globais?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b636ee01-9127-4380-b396-05f8bb431534","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5bc1576c-cf97-4e6d-bd57-d7c345aa670d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"151450df-a066-47b5-a025-b141b63f5e59","root":false,"$title":"CHECKLIST NOVO BOT","$position":{"top":"277.889px","left":"188.889px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"37f23f86-2009-43f1-b7a5-f50093c784f0":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a07fefdc-a4a7-46b4-a70c-997da7fc4a50","typeOfStateId":"state","$connId":"con_13","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Solicitar Cartão\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Desbloquear cartão\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Esqueci minha senha\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Perda / Roubo do cartão\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Agora, por gentileza, selecione no menu abaixo a opção desejada.👇` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"9939be58-b396-4717-91e2-e015c3962bea","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"cartao\"","$invalid":false,"settings":{"variable":"assunto","value":"cartao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6d8827c5-cd75-44dd-b27b-257527589ae9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e4fb0cdf-f516-462f-acd4-9ac2a019a32f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-df9490c8-d305-4174-b049-5ad7764963ff","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c431f359-af96-4201-805c-35e038d6ea35","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"37f23f86-2009-43f1-b7a5-f50093c784f0","root":false,"$title":"[CC.2.0.0][MSG] Menu Cartão","$position":{"top":"976.727px","left":"4037.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a07fefdc-a4a7-46b4-a70c-997da7fc4a50":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6b8f6f86-4687-4aae-8f02-213d2f828855","typeOfStateId":"state","$connId":"con_18","$id":"e8be7cc6-973b-48ff-8c76-0895d9f02f60","conditions":[{"values":["Solicitar Cartão"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"43b6539b-743b-4c0d-9757-e06efdc0c93c","typeOfStateId":"state","$connId":"con_23","$id":"3a698ba9-dbc0-4af4-92d9-da97658b278a","conditions":[{"values":["Desbloquear cartão"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"2696021a-72b5-48d5-9cdc-2a0adf4f3694","typeOfStateId":"state","$connId":"con_28","$id":"a38796a2-7c28-4a48-8b05-a2a85dd2d426","conditions":[{"source":"context","comparison":"equals","values":["Esqueci minha senha"],"variable":"userInput"}],"$invalid":false},{"stateId":"ff996689-492a-4ef6-be45-04f589b26826","typeOfStateId":"state","$connId":"con_33","$id":"7a8950b2-1000-436c-a9bd-a66470e77e96","conditions":[{"source":"context","comparison":"equals","values":["Perda / Roubo do cartão"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f4b16c95-dc68-4476-8468-bcf6cbe2abb9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6f4028ac-6c96-46df-bd47-f754d28992bc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8c0f2345-751f-4b07-ba80-e6a6fcbb4f14","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5683c0c0-a59a-4f24-bf13-b9c6bcb37696","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a07fefdc-a4a7-46b4-a70c-997da7fc4a50","root":false,"$title":"[CC.2.0.0][INPUT] Menu Cartão","$position":{"top":"1227.73px","left":"4037.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e3206de-707e-4dac-9749-9f24d53110c0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e5c624a6-f303-463a-95fb-919bd3fcd8a6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","typeOfStateId":"state","$connId":"con_38","$id":"57d5cbb0-d9f8-4f7a-8df5-47377a4499ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"96259fcd-3464-4280-b312-2918dcb9eab0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dca1a923-1bcd-4275-ad46-5812e9ef17ab","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"1e3206de-707e-4dac-9749-9f24d53110c0","root":false,"$title":"[CC.5.0.0] Gravame","$position":{"top":"402px","left":"1645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5ea0cac6-c5fd-49f9-9423-54d0e660adae":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aef70d64-6ae4-40b1-a0ac-dec9257d6088","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","typeOfStateId":"state","$connId":"con_43","$id":"b57a7b3c-d562-42fb-9c97-012fce49bd62","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a43ad079-d700-4bd5-a427-1853d43b65a2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-04e27e5f-63dd-4c55-a60e-f2c82b1ff277","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5ea0cac6-c5fd-49f9-9423-54d0e660adae","root":false,"$title":"[CC.6.0.0] Renegociação","$position":{"top":"399px","left":"1870px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"25991251-b486-423e-8a43-49f1c17ecef6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9c3f4364-a0d8-424f-a8e6-915919ed0b39","typeOfStateId":"state","$connId":"con_48","$id":"53fa7443-3506-4fc7-9037-9b8b918c538a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"68876e1c-788d-4d7a-aab5-97aa61b99e40","typeOfStateId":"state","$connId":"con_53","$id":"d27ba48e-206a-413a-929a-6dd9e3d07d5e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","root":false,"$title":"[CC.0.1.0][LOGIC] Cliente carterizado?","$position":{"top":"1381px","left":"2770px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68876e1c-788d-4d7a-aab5-97aa61b99e40":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3bb2455c-ce43-434c-8634-702d5f52e7f9","typeOfStateId":"state","$connId":"con_58","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Menu Principal\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Menu Anterior\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Encerrar\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"4\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Como deseja prosseguir? ` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Opções\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f34f6f85-b66f-4867-adac-dccc1ec099ba","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9e9a7497-559d-4d39-b59e-f56cdf65b0bd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0232934c-3138-47f9-adee-9a8b84661c56","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"68876e1c-788d-4d7a-aab5-97aa61b99e40","root":false,"$title":"[CC.0.1.1][MSG] Não carterizado","$position":{"top":"1613.73px","left":"2469.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3bb2455c-ce43-434c-8634-702d5f52e7f9":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"54748e92-f46d-4008-98ec-cc44c13f3dfa","typeOfStateId":"state","$connId":"con_63","$id":"5b6a68fb-a757-4d50-82b3-e3e706af4472","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Menu Principal"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"7000cb42-9ab4-4a40-907f-6223dec9d8e9","typeOfStateId":"state","$connId":"con_68","$id":"6b7cebb9-b04a-47ef-b4c8-3b2df72b4d91","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Encerrar"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","typeOfStateId":"state","$connId":"con_73","$id":"3f1fdf9e-7e65-4504-b674-86fda189442a","conditions":[{"source":"context","comparison":"equals","values":["Menu Anterior"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-21cdaa2e-8842-4eda-b55b-e96061adf28e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-105fb90a-6010-4691-94a1-cea6bd63e603","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3bb8b626-a656-4c5b-891f-23210b778e46","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8979b6ef-c7a0-498c-8fb2-4a425d330f6b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3bb2455c-ce43-434c-8634-702d5f52e7f9","root":false,"$title":"[CC.0.1.2][INPUT] Não carterizado","$position":{"top":"1998.73px","left":"2469.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f88bbdeb-3963-49e0-a355-edc20350bbfd":{"$contentActions":[{"action":{"$id":"12db0ffc-93c9-476c-8478-b5a23056ae2a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a83d4ce-9b8b-4b7f-a176-98da9bd87f3a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Investimentos\".\n2. Selecione a opção \"Aplicar\".\n3. Escolha o produto em que deseja investir.\n4. Insira o valor que deseja aplicar.","metadata":{}},"$cardContent":{"document":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Investimentos\".\n2. Selecione a opção \"Aplicar\".\n3. Escolha o produto em que deseja investir.\n4. Insira o valor que deseja aplicar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39351547-5e06-4476-9bba-e388055e7490","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","typeOfStateId":"state","$connId":"con_78","$id":"a867f8ac-5bfb-4464-8bc1-33da2edfe211","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b56b0242-c8bd-4a60-b82b-35b4606209d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"6bbae6ea-d663-4567-944f-af69d6891287","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"investimentos\"","$invalid":false,"settings":{"variable":"assunto","value":"investimentos"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2891e82d-d9e9-4a48-b3f1-94133982850b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-281fa29a-dfca-45cf-9409-f93821601829","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d335a54b-ba68-46c9-bd84-564cb345e1f9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f88bbdeb-3963-49e0-a355-edc20350bbfd","root":false,"$title":"[CC.3.0.0] Investimentos","$position":{"top":"1002.33px","left":"2978.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e36dcaa0-0665-4b22-ae98-3e8605d7e557":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '30e39880-1d2a-439a-a0ed-1e7210966286',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-281449e8-306a-4560-9ace-7fdb8ada220c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cd41d2c8-09a0-4614-aa8d-e8db3a160827","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","root":false,"$title":"[Redirect] To Main (Menu inicial)","$position":{"top":"116px","left":"1164px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"facc5123-47f0-4255-a30f-a6b87e18176e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-39f9bbec-6480-4371-ba6d-0f772d1ab1c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-74e0d3c0-d2a7-4f65-bb5c-86e6cffd18d3","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"facc5123-47f0-4255-a30f-a6b87e18176e","root":false,"$title":"[Redirect] To  Finalizacao (Finalizar)","$position":{"top":"104.462px","left":"1363.18px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"54748e92-f46d-4008-98ec-cc44c13f3dfa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9897798e-a2d5-4ad1-ad60-913074bbb68f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"54748e92-f46d-4008-98ec-cc44c13f3dfa","root":false,"$title":"[GO TO] Menu inicial","$position":{"top":"2691.73px","left":"2440.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7000cb42-9ab4-4a40-907f-6223dec9d8e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c23e11a-719d-4fb6-bb66-a8a49c12e47b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"facc5123-47f0-4255-a30f-a6b87e18176e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7000cb42-9ab4-4a40-907f-6223dec9d8e9","root":false,"$title":"[GO TO] Encerrar","$position":{"top":"2021.73px","left":"2219.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9c3f4364-a0d8-424f-a8e6-915919ed0b39":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4381c1f3-6264-42ac-bbca-f606701b2539","typeOfStateId":"state","$connId":"con_83","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"type\": \"reply\",\n\t\t\t// \t\"reply\": {\n\t\t\t// \t\t\"id\": \"3\",\n\t\t\t// \t\t\"title\": \"\"\n\t\t\t// \t}\n\t\t\t// }\n\t\t];\n\t\tconst bodyText = \"Conseguimos te ajudar?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f483f726-bfa6-428a-ad98-1a6b2497dcc4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e43529ad-d23f-475d-8b2a-08f668e4ccff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a63195c7-c597-40ec-a44e-8f58d56bab9b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9c3f4364-a0d8-424f-a8e6-915919ed0b39","root":false,"$title":"[CC.0.1.3][MSG] Carterizado","$position":{"top":"1608.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4381c1f3-6264-42ac-bbca-f606701b2539":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5a3d7e47-334e-48c0-a6a7-869f9678a954","typeOfStateId":"state","$connId":"con_88","$id":"c2532493-9855-4a8c-900d-2331b6ebe72f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Sim"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"656962f1-1814-43ee-9f4d-872a42f2f951","typeOfStateId":"state","$connId":"con_93","$id":"09f888d4-aa81-4aee-b0a0-e7cf316129ee","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Não"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1c995c9e-cf7e-48f4-8e3b-75e87912393b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f3f87776-f074-4bfc-a200-1e44d3cc762c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e841945e-812d-4877-be7d-062625e39848","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-025f6edd-2771-4038-a5b1-9ccea27d4b40","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4381c1f3-6264-42ac-bbca-f606701b2539","root":false,"$title":"[CC.0.1.4][INPUT] Carterizado","$position":{"top":"1831.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"820d335f-0c95-466f-9009-35cac24c6ea4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-87abdd81-5da0-43d0-8807-371d1574c953","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-97f6bcd7-1b60-4604-b981-d1e7a797fda6","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"820d335f-0c95-466f-9009-35cac24c6ea4","root":false,"$title":"[Redirect] To  Finalizacao (Welcome)","$position":{"top":"104.436px","left":"1558.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5a3d7e47-334e-48c0-a6a7-869f9678a954":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c81febe-8e1d-4241-b039-d258c2effee4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"5a3d7e47-334e-48c0-a6a7-869f9678a954","root":false,"$title":"[GO TO] Finalização","$position":{"top":"1842.73px","left":"3379.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cf24777b-0dc4-44b9-969f-a9c1c4e552fc":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de","typeOfStateId":"state","$connId":"con_98","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Menu Principal\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Menu Anterior\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Falar com gerente\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"4\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, como podemos te ajudar?` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-65a14b29-133b-4f98-8f08-0be4e4d0da31","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-26cf7906-16a6-43ea-b2af-5e6dc744bb5d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-feccd8ee-4bef-48d5-b8bd-2a05966ec718","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cf24777b-0dc4-44b9-969f-a9c1c4e552fc","root":false,"$title":"[CC.0.1.6][MSG] Como podemos ajudar? (emp1)","$position":{"top":"2359.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"54748e92-f46d-4008-98ec-cc44c13f3dfa","typeOfStateId":"state","$connId":"con_103","$id":"9ce4999f-6b8b-4435-8cb9-fdf34c26823c","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Menu Principal"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"26f12b75-a1eb-4779-9d15-f525f0e30960","typeOfStateId":"state","$connId":"con_108","$id":"4d9465dd-2dad-401f-8b69-540bf76f98f1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Falar com gerente"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","typeOfStateId":"state","$connId":"con_113","$id":"723501c5-b56d-4ee0-acda-31abc58be6af","conditions":[{"source":"context","comparison":"equals","values":["Menu Anterior"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f433244a-641d-4cf9-a683-ad90efe47ccf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b2907082-fef0-4c45-bc86-f694d445a3ca","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6cac72dd-b92f-4838-a19e-448955bfa08c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-882febd8-19ea-4fab-b49d-f5eea24971ee","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de","root":false,"$title":"[CC.0.1.7][INPUT] Como podemos ajudar? (emp1)","$position":{"top":"2644.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"656962f1-1814-43ee-9f4d-872a42f2f951":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"307f84bd-662a-49b4-9bf1-3772df28581b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cf24777b-0dc4-44b9-969f-a9c1c4e552fc","typeOfStateId":"state","$connId":"con_118","$id":"7fc1000d-17c9-4b3b-ad57-d6cb906bbbf7","conditions":[{"source":"context","comparison":"equals","values":["emp1"],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"26f12b75-a1eb-4779-9d15-f525f0e30960","typeOfStateId":"state","$connId":"con_123","$id":"563aed27-41a6-4834-aaab-88bb3328f8b4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"656962f1-1814-43ee-9f4d-872a42f2f951","root":false,"$title":"[CC.0.1.5][LOGIC] Seguimento emp1?","$position":{"top":"2094.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2361b9db-e18e-45de-afea-a50626686dd8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-01ad2120-11ef-4677-bb5c-7ec9ebe98d01","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-836b6872-333e-4685-a510-31e842cac798","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2361b9db-e18e-45de-afea-a50626686dd8","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"103.333px","left":"1763.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"26f12b75-a1eb-4779-9d15-f525f0e30960":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7c0e9eab-35ee-46fd-971e-279328455fd3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"26f12b75-a1eb-4779-9d15-f525f0e30960","root":false,"$title":"[GO TO] Atendimento Humano","$position":{"top":"2369.73px","left":"3407.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c1af60de-05a9-4466-8c99-b2ddb36a220a":{"$contentActions":[{"action":{"$id":"12db0ffc-93c9-476c-8478-b5a23056ae2a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a83d4ce-9b8b-4b7f-a176-98da9bd87f3a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Contas\".\n2. Em \"Outros serviços\", clique em \"Talões de Cheque\".\n3. Clique em \"Solicitar novo talão\" e selecione a quantidade desejada.\n4. Para concluir a solicitação, informe sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Contas\".\n2. Em \"Outros serviços\", clique em \"Talões de Cheque\".\n3. Clique em \"Solicitar novo talão\" e selecione a quantidade desejada.\n4. Para concluir a solicitação, informe sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39351547-5e06-4476-9bba-e388055e7490","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","typeOfStateId":"state","$connId":"con_128","$id":"a98427bd-b99a-4f7f-9d9c-7270f826dea3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b56b0242-c8bd-4a60-b82b-35b4606209d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"20c9ca88-e691-4b02-8343-0f9b5d3febf0","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"cheque empresas\"","$invalid":false,"settings":{"variable":"assunto","value":"cheque empresas"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-24f30973-179f-4c17-8dd8-853c60086754","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e5f861ce-9dff-4f79-a023-957012583da6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-766c0b81-82ec-4c78-853d-339bd696f849","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c1af60de-05a9-4466-8c99-b2ddb36a220a","root":false,"$title":"[CC.1.0.0] Cheque Empresas","$position":{"top":"1002.67px","left":"2564px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6b8f6f86-4687-4aae-8f02-213d2f828855":{"$contentActions":[{"action":{"$id":"51821bf3-acc6-4765-91dd-e2a65ad9ccb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"96eeca3d-c830-4bb2-a9ae-c105803c9a7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"96eeca3d-c830-4bb2-a9ae-c105803c9a7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"42783a71-9979-4f5a-9d36-6b5556f21d60","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b0364a9a-9a7a-4a0d-ad0d-cc77d61e9242","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Solicitar cartão\".\n2. Preencha os dados da sua empresa conforme solicitado e clique em \"Próximo\".\n3. Confirme os dados para emissão do cartão.\n4. Para concluir a solicitação, informe senha e token.","metadata":{}},"$cardContent":{"document":{"id":"b0364a9a-9a7a-4a0d-ad0d-cc77d61e9242","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Solicitar cartão\".\n2. Preencha os dados da sua empresa conforme solicitado e clique em \"Próximo\".\n3. Confirme os dados para emissão do cartão.\n4. Para concluir a solicitação, informe senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_133","$id":"b2fbd9fa-0ab3-4ae4-9e12-59be5dfc5e1a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-93dbf6b3-5e0f-4028-9ec3-61a4eae1f8fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f9c3b13e-59f0-43b1-82c8-3b57bf3ceeb2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6b8f6f86-4687-4aae-8f02-213d2f828855","root":false,"$title":"[CC.2.1.0] Solicitar Cartão","$position":{"top":"1557.73px","left":"3628.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"43b6539b-743b-4c0d-9757-e06efdc0c93c":{"$contentActions":[{"action":{"$id":"e858e3c3-538c-486e-ab69-155c88c269ec","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa221bab-108a-4c42-956b-7f10c3d14105","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa221bab-108a-4c42-956b-7f10c3d14105","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"59d38d95-4f9f-417f-93f7-9065c5deec40","$typeOfContent":"text","type":"SendMessage","settings":{"id":"44ca71e0-7968-48e0-a111-39b70b92fdf6","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Desbloquear\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"44ca71e0-7968-48e0-a111-39b70b92fdf6","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Desbloquear\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_138","$id":"0b5529ad-8da0-40c7-bfdf-e3dab5141a2c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b22262b2-22cf-4eae-ac12-e60dac40ac71","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-07fda306-5bae-4146-a923-c528ecccb03e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"43b6539b-743b-4c0d-9757-e06efdc0c93c","root":false,"$title":"[CC.2.2.0] Desbloquear Cartão","$position":{"top":"1533.73px","left":"3946.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2696021a-72b5-48d5-9cdc-2a0adf4f3694":{"$contentActions":[{"action":{"$id":"ae49ed10-5b7e-460c-a94c-ca305dafe899","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cf2cb7a3-1ef9-4e94-b377-5dcf3a294436","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cf2cb7a3-1ef9-4e94-b377-5dcf3a294436","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e0e7d666-e684-404b-b2db-cb577e18d248","$typeOfContent":"text","type":"SendMessage","settings":{"id":"41fc34e4-fd5f-4071-92f2-5556c8237987","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões - Meus Cartões\", clique em \"Reenviar senha\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"41fc34e4-fd5f-4071-92f2-5556c8237987","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões - Meus Cartões\", clique em \"Reenviar senha\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_143","$id":"84aec40c-6656-429b-8860-98b6b8a3b04d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c4981b2e-a994-48db-a820-4b6caf2657f0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-72cb78c0-0c93-4113-a757-5c5458386198","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"2696021a-72b5-48d5-9cdc-2a0adf4f3694","root":false,"$title":"[CC.2.3.0] Esqueci minha senha","$position":{"top":"1551.73px","left":"4145.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ff996689-492a-4ef6-be45-04f589b26826":{"$contentActions":[{"action":{"$id":"55189105-a1a2-46e2-aa4e-7ad69b69c3ff","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f6b63e11-c6c6-4a92-9190-b03b5e0d0895","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f6b63e11-c6c6-4a92-9190-b03b5e0d0895","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31863de9-8e0d-4554-8700-7281b1f891e3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ae0bb8a9-01f8-4f70-a0fc-31c19742e414","type":"text/plain","content":"1. No Internet Banking, na aba Cartões clique em Bloquear por perda ou roubo.\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"ae0bb8a9-01f8-4f70-a0fc-31c19742e414","type":"text/plain","content":"1. No Internet Banking, na aba Cartões clique em Bloquear por perda ou roubo.\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_148","$id":"db6298e6-ffd2-4a54-856a-a7cea9f0a125","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7a0c3d88-eccf-4efd-a3f8-a0969a3fa6bb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a0f6ca0f-bbf4-4bfc-a02e-fe718647867f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ff996689-492a-4ef6-be45-04f589b26826","root":false,"$title":"[CC.2.4.0] Perda / Roubo","$position":{"top":"1551.73px","left":"4464.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d60ffb9f-33a0-4701-a858-f54405c2ee81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","root":false,"$title":"[GO TO][LOGIC] Cliente carterizado?","$position":{"top":"2182.73px","left":"4045.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b420cdc-30d4-4876-bf68-61b4346c4c71":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"69c9b513-1751-4b8d-af46-0aa6cdea618f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b8d09f05-088c-4b3e-8348-9c4e88a92b1d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, assunto) {\n\tconst destination = {\n\t\t'cheque empresas': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'investimentos': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'cartao': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'pacotes contratados': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '16cc5d45-c8d8-4b01-b000-e76eff268c33'\n\t\t}\n\t}\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst destinationBot = destination[assunto]\n\t\tif (!destinationBot) {\n\t\t\tthrow new Error('invalid destination')\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\t...destinationBot,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: 'contacorrente',\n\t\t\tstateOrigin: '[Redirect] Menu anterior',\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","assunto"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"960947c0-f767-41ea-b824-266e2ef32438","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8e994a53-7049-4c78-8f0f-ec1da458d5eb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-42192edb-43f6-49ed-a40a-cec5d6845296","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"4b420cdc-30d4-4876-bf68-61b4346c4c71","root":false,"$title":"[Redirect] Menu anterior","$position":{"top":"107.429px","left":"1979.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e98bc47-4a22-4b16-af0d-88bc0278ba99":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a10577b-e395-449a-a34d-65c909230084","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4b420cdc-30d4-4876-bf68-61b4346c4c71","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","root":false,"$title":"[GO TO] Redirect menu anterior","$position":{"top":"2390.73px","left":"2693.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b9ad166b-910b-43a2-b6e1-7e3ae4171339":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f15eb474-f67b-44ba-b09f-8901a2490810","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"dd50398e-90ff-4bcb-b1ce-68f2571a065f","typeOfStateId":"state","$connId":"con_153","$id":"d5b7d14a-6b65-48fb-aefa-f31136985ce8","conditions":[{"source":"context","comparison":"equals","values":["{\"data\":[]}","\"data\":[]"],"variable":"bodyPacote"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88","typeOfStateId":"state","$connId":"con_158","$id":"e1ac8cc3-52c1-4d1a-be67-6fd3b9f38c9e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f9afd3ff-340e-4fab-bf6d-294cd1815005","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyPacote\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/pacotes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusPacote","responseBodyVariable":"bodyPacote"},"conditions":[]},{"$id":"410a931a-c855-4e00-953d-e3b6a9cdaf55","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"93a48c9b-03ba-4b84-9ded-9e2a040d9a8d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"2ac3da8d-b09e-4ca9-bee7-0cce075fdc5c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"eb950751-5d3d-408e-b7a1-e1c53508bc4f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusPacote"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5866436c-1def-4be7-955a-81f9e7616f2a","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/pacotes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET| {{statusPacote}} | {{bodyPacote}}"},"conditions":[]},{"$id":"adbd25d9-5e5e-4daf-b3c4-7750f162fdf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"statusPacote"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusPacote"}]},{"$id":"3212044a-1038-43f9-b23c-42a93c60dd16","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9ad19ace-0eca-4aa9-987b-d6f79a8cd3d7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-8cc10fed-26bb-4029-8af6-315877f15025","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1e2d726d-9a96-492b-b324-74fa196653e8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-727876aa-d209-4aa3-8afb-176d0bc1b489","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"b9ad166b-910b-43a2-b6e1-7e3ae4171339","root":false,"$title":"[TC.8.0.0][HTTP] API Pacotes","$position":{"top":"1348.67px","left":"5547px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dd50398e-90ff-4bcb-b1ce-68f2571a065f":{"$contentActions":[{"action":{"$id":"830dc22e-05b5-4846-ad0a-b0942056e6da","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b23bbad8-f440-4e04-afee-76696df30d2e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b23bbad8-f440-4e04-afee-76696df30d2e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2a4a5ec3-f094-4baf-b0c5-eff6930c982d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d55fc062-6b49-49a7-9d2c-f80fbe4cca96","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você não possui pacotes de serviço cadastrados. ","metadata":{}},"$cardContent":{"document":{"id":"d55fc062-6b49-49a7-9d2c-f80fbe4cca96","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você não possui pacotes de serviço cadastrados. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"aa7f4cb0-ab7d-41d9-a97b-933d665cdfa3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ab0adeac-f86e-442b-a933-60fa68af47ee","typeOfStateId":"state","$connId":"con_163","$id":"d12b034e-b2bb-4e95-a547-1e2a64e1e5bc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"462ef3b3-6e21-4ccb-9511-71e7027054f4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f3ad38ee-7dd0-4b24-ad77-fab522df3f37","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-008fe267-31b7-4b86-9524-c12bf81542cb","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dd50398e-90ff-4bcb-b1ce-68f2571a065f","root":false,"$title":"[TC.8.1.0][MSG] Não possui pacotes","$position":{"top":"1542.67px","left":"5896px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88":{"$contentActions":[{"action":{"$id":"be51e4c1-0a2d-4317-a70c-3a4e2dabc78c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c93093a-6c58-407c-ac45-77c600bce2f5","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, este é o seu pacote de serviços contratado:👇","metadata":{}},"$cardContent":{"document":{"id":"6c93093a-6c58-407c-ac45-77c600bce2f5","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, este é o seu pacote de serviços contratado:👇"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a9199be-d406-473c-9467-2cd7b13f31eb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b233c255-aff1-46e8-be1a-57c6cce55760","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b233c255-aff1-46e8-be1a-57c6cce55760","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43fce40b-0ef3-4893-ae77-565f1b3aa02b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c1519c0c-33f5-46e0-b0e3-198a9a7a6c4a","type":"text/plain","content":"{{pacote}}","metadata":{}},"$cardContent":{"document":{"id":"c1519c0c-33f5-46e0-b0e3-198a9a7a6c4a","type":"text/plain","content":"{{pacote}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fac17be3-0201-4328-b945-debc0327d360","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9b168af3-065a-4ea3-b277-61fb23ef1d7f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b168af3-065a-4ea3-b277-61fb23ef1d7f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0d7ad388-3ac7-4cdc-948b-1ae362d68905","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ab0adeac-f86e-442b-a933-60fa68af47ee","typeOfStateId":"state","$connId":"con_168","$id":"1618012f-9044-4cef-a73d-c91603287b9d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e1050974-d7c4-460a-9e94-b1973ab21086","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pacote\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyPacote) {\n  try {\n    let jsonData = JSON.parse(bodyPacote)\n    // Extrair valores\n    let primeiroItem = jsonData.data[0];\n    let nome = primeiroItem.nome;\n    let valor = primeiroItem.valor;\n\n    // Convertendo o número para uma string\n    let valorString = valor.toString();\n\n    // Substituindo ponto por vírgula\n    let valorFormatado = valorString.replace('.', ',');\n\n    // Formatando como moeda\n    valorFormatado = valorFormatado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });\n\n    // Verificando se há ponto e vírgula na formatação\n    if (valorFormatado.indexOf('.') !== -1 && valorFormatado.indexOf(',') !== -1) {\n      let splitVirgula = valorFormatado.split(',');\n      let decimais = splitVirgula[1] + '00';\n      valor = splitVirgula[0] + ',' + decimais.substring(0, 2);\n    } else if (valorFormatado.indexOf('.') !== -1) {\n      valor = valorFormatado + ',00';\n    } else if (valorFormatado.indexOf(',') !== -1) {\n      let splitVirgula = valorFormatado.split(',');\n      let decimais = splitVirgula[1] + '00';\n      let milhar = splitVirgula[0].replace(/\\D/g, '');\n      milhar = milhar.replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\n      valor = milhar + ',' + decimais.substring(0, 2);\n    } else {\n      let milhar = valorFormatado.replace(/\\D/g, '');\n      milhar = milhar.replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\n      valor = milhar + ',00';\n    }\n    return (`Nome do serviço: ${nome}\\nValor: R$${valor}`);\n\n  }\n  catch (e) {\n    return e.message;\n  }\n}","inputVariables":["bodyPacote"],"LocalTimeZoneEnabled":false,"outputVariable":"pacote"},"conditions":[]},{"$id":"51f9e661-fd2c-4120-9f56-2d984ef79796","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-423cdff0-59d2-4419-8902-f4afbc5b1c24","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-44639e1a-13e3-4d83-8f6c-d0655f0e03ea","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-15805b81-722a-4743-9735-7c4e2e85239e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88","root":false,"$title":"[TC.8.2.0][MSG] Possui pacotes","$position":{"top":"1547.67px","left":"5271px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ab0adeac-f86e-442b-a933-60fa68af47ee":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7d3b7196-f824-4926-88ec-84fdd31f45d0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2"},"isAiGenerated":false,"$tags":[],"id":"ab0adeac-f86e-442b-a933-60fa68af47ee","root":false,"$title":"[GO TO] CC.0.1.0 Conseguimos te Ajudar?","$position":{"top":"1746.67px","left":"5567px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"708a01ab-973e-404f-8e0f-fe4a312b5100":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'b9ad166b-910b-43a2-b6e1-7e3ae4171339',//Pacotes\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3e5be069-b709-40e0-9da9-bc448482322a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-270009d3-5f43-44b3-8276-38536f7b6112","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"708a01ab-973e-404f-8e0f-fe4a312b5100","root":false,"$title":"[Redirect] To \"Autenticacao\"","$position":{"top":"1189.67px","left":"5544px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"191a2f33-c58e-4a64-9e66-af23348bcbad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"82e40acc-3cb3-40d0-b3a7-774e66b700ae","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"708a01ab-973e-404f-8e0f-fe4a312b5100","typeOfStateId":"state","$connId":"con_173","$id":"d633e8bd-66b3-454e-8f1e-c7926a8dc9ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"808f528e-491c-4eab-858c-de25eb8f5968","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"a76fdd71-3815-49e1-9488-9b78c0421c0d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"8005fea5-86ab-4074-a264-a0b889c2443a","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"pacotes contratados\"","$invalid":false,"settings":{"variable":"assunto","value":"pacotes contratados"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fb118a87-621d-4874-a0cf-41720347f9c0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9094411e-dcea-4bf7-b8da-8e45ae3c4df4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"191a2f33-c58e-4a64-9e66-af23348bcbad","root":false,"$title":"[CC.3.0.0][SET] Consultar Pacotes Contratados","$position":{"top":"842.727px","left":"5463.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"90e85c65-51a7-434b-ab81-66179515bfb0":{"$contentActions":[{"action":{"$id":"cf269952-69f1-4e3a-a719-2dacea8ce1db","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3534d883-1029-4986-86fe-fc6b3664b5df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3534d883-1029-4986-86fe-fc6b3664b5df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c99aa7d0-b931-496d-adc5-8859c884c4cd","$typeOfContent":"text","type":"SendMessage","settings":{"id":"01b05f2e-e56d-4f9b-9405-444a40ce7947","type":"text/plain","content":"Estamos trabalhando para desenvolver novos serviços PIX aqui no WhatsApp.","metadata":{}},"$cardContent":{"document":{"id":"01b05f2e-e56d-4f9b-9405-444a40ce7947","type":"text/plain","content":"Estamos trabalhando para desenvolver novos serviços PIX aqui no WhatsApp."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac7d748f-20ff-43fe-966d-a1026ac98b51","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c0745c4c-b3a8-40f2-8d01-c95c368a3251","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c0745c4c-b3a8-40f2-8d01-c95c368a3251","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ba0598fa-98ff-4690-9f2b-bbf4d700f152","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7baa52e7-932d-4998-8d69-860fdd2d4021","type":"text/plain","content":"Para realizar um PIX ou consultar informações sobre PIX, acesse o seu aplicativo Safra Empresas.","metadata":{}},"$cardContent":{"document":{"id":"7baa52e7-932d-4998-8d69-860fdd2d4021","type":"text/plain","content":"Para realizar um PIX ou consultar informações sobre PIX, acesse o seu aplicativo Safra Empresas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"81325db7-f765-4b53-bcdd-14cc8c26b916","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2b32875e-2d0f-40cc-abed-fbf1a5ec3ed1","typeOfStateId":"state","$connId":"con_178","$id":"5ed9727a-60bc-4b66-8e34-7d55155a8473","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"671ffa19-a2b9-4441-a59d-ff28a9bb7b9d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1d15c539-9e64-4e2f-8dfa-1b1405dd5c50","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4c3c6e1a-bd05-41fd-8c52-488c5e9317b5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"90e85c65-51a7-434b-ab81-66179515bfb0","root":false,"$title":"[M.5.3.2][MSG] Pix","$position":{"top":"1522.57px","left":"306.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"daa2d803-2548-400e-8782-47ecaec9aca1":{"$contentActions":[{"action":{"$id":"998bf25a-9982-432c-b62a-1c125857e622","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"95c802c6-6729-4c74-92b0-b1de93863467","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"95c802c6-6729-4c74-92b0-b1de93863467","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2748"},{"action":{"$id":"b527eddf-73c5-4cfb-9aa3-cd04c107fef9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:2749"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b1f60af7-aebd-467b-a946-6b29986b4841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2750"}],"$conditionOutputs":[{"stateId":"60c69fbc-f2d3-4175-8164-766775c3249b","typeOfStateId":"state","$connId":"con_183","$id":"e669d4be-d6e6-4a30-b620-e4990713d4c8","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2771"}],"$invalid":false,"$$hashKey":"object:2757"}],"$enteringCustomActions":[{"$id":"4d543e27-b1fb-4836-b8de-df0eb2b8deb1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"990f94c3-a8fd-4e88-aed2-14630fea3f3c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n    try {\n        cpfAppKey = JSON.parse(cpfAppKey)\n        let defaultMenuOptions = [\n            {\n                \"id\": \"5\",\n                \"title\": \"Cheque empresas\",\n                \"description\": \"Como solicitar novo talão de cheques\"\n            },\n            {\n                \"id\": \"6\",\n                \"title\": \"Falar sobre conta\",\n                \"description\": \"\"\n            },\n            {\n                \"id\": \"10\",\n                \"title\": \"Pacotes contratados\",\n                \"description\": \"\"\n            },\n        ]\n\n        if (!cpfAppKey) {\n\n            const cpfAppKeyOnlyOptions = [\n                {\n                    \"id\": \"2\",\n                    \"title\": \"Pix\",\n                    \"description\": \"\"\n                }\n            ]\n            defaultMenuOptions = [...defaultMenuOptions, ...cpfAppKeyOnlyOptions].sort((a, b) => a.id - b.id)\n        }\n\n\n\n        if (cpfAppKey) {\n            //  defaultMenuOptions = defaultMenuOptions.filter(({ id }) => id !== \"2\")\n\n            const cpfAppKeyOnlyOptions = [\n                {\n                    \"id\": \"1\",\n                    \"title\": \"Extratos\",\n                    \"description\": \"Consulte os extratos de sua conta\"\n                },\n                {\n                    \"id\": \"2\",\n                    \"title\": \"Fazer Pix\",\n                    \"description\": \"Realize um pix\"\n                },\n                {\n                    \"id\": \"3\",\n                    \"title\": \"Pagar Contas\",\n                    \"description\": \"Pagar boleto com código de barras\"\n                },\n                {\n                    \"id\": \"4\",\n                    \"title\": \"Antecipar saldo\",\n                    \"description\": \"Antecipação eventual, Antecipação automatica\"\n                }\n            ]\n            defaultMenuOptions = [...defaultMenuOptions, ...cpfAppKeyOnlyOptions].sort((a, b) => a.id - b.id)\n        }\n\n\n\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Certo! Sobre *Conta Corrente*, do que você precisa? Escolha na lista a seguir:`\n                },\n                \"action\": {\n                    \"button\": \"Escolha uma opção\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": defaultMenuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return err.message;\n    }\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3a0ed888-ced6-4ba6-91a8-a4b174cee332","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-61b10708-c0e9-4fd4-9722-912d9fbfda16","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f7f5bd5d-f197-4a2c-b46c-c144402ba321","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"daa2d803-2548-400e-8782-47ecaec9aca1","root":false,"$title":"[M.5.3.0][MSG]Menu Conta Corrente","$position":{"top":"757.778px","left":"879.222px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a508df2f-7177-4554-959b-2b62037f453b":{"$contentActions":[{"action":{"$id":"14269fd1-7655-4b19-a045-fa3067d3015f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a3364784-a601-4871-a9fa-618b11893f02","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a3364784-a601-4871-a9fa-618b11893f02","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2993"},{"action":{"$id":"556e595b-a097-49cf-adbe-46b9baee6d51","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:2994"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8493b22-3f92-4fea-bc07-bfc816531526","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2995"}],"$conditionOutputs":[{"stateId":"c4ce4b44-ad19-4b1c-882d-e6dcba0d96cc","typeOfStateId":"state","$connId":"con_188","$id":"dcb210ed-585c-41cd-a29f-4d24c2514f00","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:3016"}],"$invalid":false,"$$hashKey":"object:3002"}],"$enteringCustomActions":[{"$id":"73a7b0f9-e131-42f8-bb6d-2a9919438905","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Extrato vendas\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Extrato recebimentos\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Extrato conta\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Selecione o tipo de extrato desejado:\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"394dbdae-8215-421e-8740-b5f2751fb96d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e5adf898-f296-4ebc-9840-46c7a382ddb1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-48006d6e-335f-43e5-9ca5-6734166e6b4f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ef8db277-88b1-491d-80f4-73c83743899b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a508df2f-7177-4554-959b-2b62037f453b","root":false,"$title":"[M.5.3.1][MSG] Menu Extratos","$position":{"top":"1778px","left":"1765px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c4ce4b44-ad19-4b1c-882d-e6dcba0d96cc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c8493b22-3f92-4fea-bc07-bfc816531526","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9666009-688a-4b7f-913b-e16f3ec2ca36","typeOfStateId":"state","$connId":"con_193","$id":"f0dc54ab-626f-4f25-9fcc-c1af5ea6abbc","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extrato vendas"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"48bd2fab-30a5-46c8-8a6b-cf482187a66e","typeOfStateId":"state","$connId":"con_198","$id":"8bb8a775-d818-43a5-b6d4-040eeec42d02","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extrato recebimentos"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"03573ae8-ef6e-49cc-9b6d-34a535eabaaa","typeOfStateId":"state","$connId":"con_203","$id":"3ba2e9e8-f188-4b76-b7ec-33fbbfd7ee6b","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"Extrato conta"},{"values":["Extrato conta"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4ab1250d-0dbf-4502-8bc0-7faf7015593d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0340deaf-2276-4944-bfd7-717887492ab0","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"adeac3a1-b03b-47fc-9fe1-56c5c61a4e86","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"e1d21ac2-5478-48cb-8b5e-f0bcae880a16","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-139b2658-163d-468a-8778-44179b2300f8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e1adf7c8-b7f8-4875-8387-17333b15c8c8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-50857b16-7e42-4a34-b8b2-9f7e8ed2d480","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8e15e87e-307d-468a-a146-5bb0083b7cc4","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c4ce4b44-ad19-4b1c-882d-e6dcba0d96cc","root":false,"$title":"[M.5.3.1][INPUT] Valida seleção menu extratos","$position":{"top":"2079px","left":"1765.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59a335c5-fd79-4508-9842-66f735f3b382":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'c7d220bd-2237-49f4-88ec-14c555bf202c',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"71e66d5e-ddc0-48d4-930d-8630f59d2205","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fc8988e5-0b41-4cb6-bcdd-5bfeaafdc894","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5a6e2fcb-21b6-48c3-a3ab-d4e859a4a4ff","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"59a335c5-fd79-4508-9842-66f735f3b382","root":false,"$title":"[Redirect] to Autenticacao (Falar sobre conta)","$position":{"top":"97.1795px","left":"2422.26px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"60c69fbc-f2d3-4175-8164-766775c3249b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b1f60af7-aebd-467b-a946-6b29986b4841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"89f944c0-c104-45ea-aaff-5f8a671bfe15","typeOfStateId":"state","$connId":"con_208","$id":"d3ca4497-39bb-4df8-8986-9144c650e43d","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Cheque empresas"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"db349365-2175-49fc-a826-958a03cb328d","typeOfStateId":"state","$connId":"con_213","$id":"9bc73c11-40c1-4967-ab07-0f5a9858d11f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Pacotes contratados"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"7dc70d68-f7a3-47de-8aa3-0f9f7a44908e","typeOfStateId":"state","$connId":"con_218","$id":"8eb0d09a-04f2-4c6c-9cb3-250c151fb3ba","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Falar sobre conta"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"91017043-1b92-4e8b-b4ae-2251ba97d6fd","typeOfStateId":"state","$connId":"con_223","$id":"d4800ec3-88fb-4edd-9d7f-82dedc1e5a5d","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a1c7d772-7946-4ba2-8ba2-e8120693b090","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c0b70a3-1ed1-4504-9ce4-1ee108036509","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"9caee4bd-4029-4442-b993-b0555e5ba454","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"102f100e-d00a-4542-9c14-217ff0690c2e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ffd90b76-a85c-4401-8cdd-53897f39019a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bc078523-3d08-457d-bcce-d0daf4f83071","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7bb0d3f5-8741-4dce-b259-b712552b2977","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1f23797f-59a8-484d-a0f9-ed3d950c5284","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-756b9b34-42b4-4526-8ad6-43e9b8be8b16","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"60c69fbc-f2d3-4175-8164-766775c3249b","root":false,"$title":"[M.5.3.0][INPUT]Valida seleção menu conta corrente","$position":{"top":"974.333px","left":"878.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"91017043-1b92-4e8b-b4ae-2251ba97d6fd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"eab113f2-57fe-43f0-b9ad-40b61f6656de","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7275c15b-cc6d-42f6-bcb7-91c3ca435575","typeOfStateId":"state","$connId":"con_228","$id":"f1c93554-b4c6-4b45-ab6a-e90d33ca0b0e","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"cpfAppKey"}],"$invalid":false},{"stateId":"a8d74877-19ab-4da1-ae50-32f1279e40e7","typeOfStateId":"state","$connId":"con_233","$id":"5ab394cc-ad10-4b13-8cf9-c5165da490fb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4acc409b-2219-418e-8e72-fd1c5c108e13","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b8c84882-ac72-4c9e-8fda-ad1c581f60ef","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{{state.name}} dados validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados validacao","action":"{{cpfAppKey}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-578c271e-05c2-4471-a791-5a218f68d79a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"91017043-1b92-4e8b-b4ae-2251ba97d6fd","root":false,"$title":"[CC.0.0.0] Verifica cpfAppKey","$position":{"top":"1511px","left":"878px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7275c15b-cc6d-42f6-bcb7-91c3ca435575":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b214e61f-2c8e-443b-9b8d-615eed52b120","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a508df2f-7177-4554-959b-2b62037f453b","typeOfStateId":"state","$connId":"con_238","$id":"69f79666-7c19-4b53-bf4e-375b6b9e04cb","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extratos"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"7b5b24dc-973f-464b-a87b-dea8bd3c5c2e","typeOfStateId":"state","$connId":"con_243","$id":"855b6bee-e37b-424c-b95e-69ff8a70953e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Fazer Pix"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"f2e39bfe-b733-427b-b970-8b754d8cb015","typeOfStateId":"state","$connId":"con_248","$id":"04696d6f-6ba3-46fe-947e-7c594b9888c1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Pagar Contas"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"18f4fc50-145f-41f6-af5e-3636d923f160","typeOfStateId":"state","$connId":"con_253","$id":"014b9ac5-60ce-47dc-b8b7-f8180524b2fe","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Antecipar saldo"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"63403e40-c821-4688-a201-255360fcebb1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"de972ec9-71cb-476d-8ea5-bcc7304c97e0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{{state.name}} dados validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados validacao","action":"{{userInput}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"},{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-28883e9e-1aff-484d-a3a8-a6041c20e1bd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7275c15b-cc6d-42f6-bcb7-91c3ca435575","root":false,"$title":"[CC.0.0.1] Rotas com cpfAppKey (gera appKey)","$position":{"top":"1791px","left":"878.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8d74877-19ab-4da1-ae50-32f1279e40e7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0142587f-cabe-4f27-b821-cf94d9306f4e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90e85c65-51a7-434b-ab81-66179515bfb0","typeOfStateId":"state","$connId":"con_258","$id":"57429a29-f653-42f6-bd57-0b6b7652738a","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Pix"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e24a0468-e455-4781-bdbe-b997d8c45b08","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"52f24b94-2173-4095-9cc3-f57c9b4ee10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{{state.name}} dados validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados validacao","action":"{{userInput}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"},{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"daa2d803-2548-400e-8782-47ecaec9aca1","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fe6e0228-88f4-4ea6-81a3-b46045349490","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"a8d74877-19ab-4da1-ae50-32f1279e40e7","root":false,"$title":"[CC.0.0.2] Rotas sem cpfAppKey","$position":{"top":"1510.57px","left":"589.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"89f944c0-c104-45ea-aaff-5f8a671bfe15":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0dd074a9-57a0-4055-8aab-54b852c77a9f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"c1af60de-05a9-4466-8c99-b2ddb36a220a","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"89f944c0-c104-45ea-aaff-5f8a671bfe15","root":false,"$title":"[GO TO][CC.1.0.0] Cheque Empresas","$position":{"top":"1144.67px","left":"498px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"db349365-2175-49fc-a826-958a03cb328d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"24f2e6a7-274a-4f6f-98da-d087324d8a16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"191a2f33-c58e-4a64-9e66-af23348bcbad","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"db349365-2175-49fc-a826-958a03cb328d","root":false,"$title":"[GO TO][CC.3.0.0] Pacotes Contratados","$position":{"top":"997.333px","left":"498.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5731d56-35b1-4087-80f0-08109fb6f5a6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',//Refatorar\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c7b45be2-65f1-4907-a7a0-0c7966a5669c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a506352b-3c76-4c46-ab74-29571223c30b","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a5731d56-35b1-4087-80f0-08109fb6f5a6","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"96.5385px","left":"2194.64px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7dc70d68-f7a3-47de-8aa3-0f9f7a44908e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'a5731d56-35b1-4087-80f0-08109fb6f5a6',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"71e66d5e-ddc0-48d4-930d-8630f59d2205","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ff8d94b3-de64-4d73-8e7c-e101ef669208","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f9010c61-5efb-47f7-9ddb-72cc72db7c14","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"7dc70d68-f7a3-47de-8aa3-0f9f7a44908e","root":false,"$title":"[Redirect] to Autenticacao (Falar sobre conta)","$position":{"top":"809.333px","left":"495.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2b32875e-2d0f-40cc-abed-fbf1a5ec3ed1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"027aa854-8dd8-400c-94bb-a6951c58bd52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2b32875e-2d0f-40cc-abed-fbf1a5ec3ed1","root":false,"$title":"[GO TO] Finalização (Welcome)","$position":{"top":"1705.71px","left":"308.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"48bd2fab-30a5-46c8-8a6b-cf482187a66e":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:2035"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2036"},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:2037"}],"$conditionOutputs":[{"stateId":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","typeOfStateId":"state","$connId":"con_263","$id":"bc15e77d-d70f-4984-ac9a-975fc1df296e","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2058"}],"$invalid":false,"$$hashKey":"object:2044"}],"$enteringCustomActions":[{"$id":"9166dc8d-1b3c-4b22-a2e8-eb27c196f0cf","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"26e44d85-531d-464c-9c40-96f270867cfc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o *SafraPay online* e veja seu *extrato de recebimentos SafraPay*.\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Extrato recebimentos\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/extrato-recebimento/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/extrato-recebimento/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-cda9196d-732f-4a64-ae15-7a66da6e8cd3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fb190b58-c42f-493f-a660-447d65c5728f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"48bd2fab-30a5-46c8-8a6b-cf482187a66e","root":false,"$title":"[M.5.3.3][MSG]Extrato Safrapay","$position":{"top":"2362.29px","left":"1766px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c9666009-688a-4b7f-913b-e16f3ec2ca36":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:697"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:698"},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:699"}],"$conditionOutputs":[{"stateId":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","typeOfStateId":"state","$connId":"con_268","$id":"59f3d197-5acc-4b16-9104-3ef83fbe9d37","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:720"}],"$invalid":false,"$$hashKey":"object:706"}],"$enteringCustomActions":[{"$id":"07e19e66-78a0-4d5d-864a-a9908347690d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"0c4cfa96-b257-49e3-8ebc-ae3433b1ee32","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o *SafraPay online* e veja seu *extrato de vendas SafraPay*.\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Extrato vendas\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/extrato-vendas/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/extrato-vendas/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-dd1f746c-b7ea-4b88-919d-e99da18fab1a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d8ab974c-ead1-4d12-b5d8-f6291bdf8102","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"c9666009-688a-4b7f-913b-e16f3ec2ca36","root":false,"$title":"[M.5.3.4][MSG]Extrato Safrapay vendas","$position":{"top":"2369.33px","left":"2139.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"03573ae8-ef6e-49cc-9b6d-34a535eabaaa":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","typeOfStateId":"state","$connId":"con_273","$id":"313aa96d-cf9e-4204-bb23-c8d99c5d0ce8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"99787a1a-1e8d-4885-af87-d29ecd338b04","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"7cf44291-1035-4e0c-9c6a-8f63646c67ed","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o *SafraPay online* e veja seu *extrato da conta*.\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Extrato conta\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/extrato-cc/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/extrato-cc/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-08870bc9-1dc0-48a5-a2f9-559ac3b3dfd6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c102130d-757d-4747-8dfe-2b6f1ce12bb8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"03573ae8-ef6e-49cc-9b6d-34a535eabaaa","root":false,"$title":"[M.5.3.2][MSG]Extrato Conta Corrente","$position":{"top":"2376.43px","left":"1403.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"45cffe4e-e04f-49f3-b27e-ce0eadc35436":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"027aa854-8dd8-400c-94bb-a6951c58bd52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","root":false,"$title":"[GO TO] Finalização (Welcome)","$position":{"top":"2630px","left":"1765.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b5b24dc-973f-464b-a87b-dea8bd3c5c2e":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:1415"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1416"},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1417"}],"$conditionOutputs":[{"stateId":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","typeOfStateId":"state","$connId":"con_278","$id":"9b9f4325-e39d-4664-b220-368162caa5fe","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1440"}],"$invalid":false,"$$hashKey":"object:1430"}],"$enteringCustomActions":[{"$id":"de853304-eb70-4b2e-84d6-5082eef89860","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"ea3cff73-4daa-4e02-9c19-803865e4056d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o *SafraPay online* e faça o *PIX* utilizando seu saldo disponível\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Fazer PIX\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/pix/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/pix/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"$tags":[{"id":"blip-tag-728a3f02-effc-4a10-809e-f29f2407c43e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-888695ec-d30e-4fdb-b37b-8949c27cd63e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7b5b24dc-973f-464b-a87b-dea8bd3c5c2e","root":false,"$title":"[CC.7.0.0] PIX","$position":{"top":"2101.29px","left":"492.857px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"18f4fc50-145f-41f6-af5e-3636d923f160":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"62d9d1e3-c20d-4892-a49d-420de31d72bb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9e35073d-8b55-4f1e-83e9-f4f42b8b1d00","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"9e35073d-8b55-4f1e-83e9-f4f42b8b1d00","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","typeOfStateId":"state","$connId":"con_283","$id":"fb9dd6b2-d3e6-4566-9370-a1fff249bc52","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ba3a0fd4-b9ed-43ed-9260-5460905c45ae","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"f372e95e-d115-44c6-bb6d-119a71ddfe7f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Para *fazer a antecipação do saldo*, é só acessar o botão a seguir e finalizar a solicitação no *SafraPay online*\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Antecipar saldo\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/antecipacao/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/antecipacao/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"$tags":[{"id":"blip-tag-403e56b5-24f7-470c-8c4d-88dc1db0d26e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6fad3a48-cb8c-49a1-bf53-013efe6cf7b6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"18f4fc50-145f-41f6-af5e-3636d923f160","root":false,"$title":"[CC.8.0.0] Antecipação","$position":{"top":"2081.86px","left":"1268.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f2e39bfe-b733-427b-b970-8b754d8cb015":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:1551"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1552"},{"action":{"$id":"bdaa8f7f-c102-438b-a854-f30d066576c4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ced6b99a-0272-44f6-b820-a7ac5ee5f75a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"ced6b99a-0272-44f6-b820-a7ac5ee5f75a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1553"}],"$conditionOutputs":[{"stateId":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","typeOfStateId":"state","$connId":"con_288","$id":"de86e889-849c-4d8f-8d34-777d74c65d87","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1574"}],"$invalid":false,"$$hashKey":"object:1560"}],"$enteringCustomActions":[{"$id":"62cff1b1-b53c-4079-ba80-049b7d515d58","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"1e280cf4-b96a-48c8-b5a0-bda8e2c7622d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o *SafraPay online* e pague seus *boletos* utilizando seu saldo disponível\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Fazer pagamento\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/pagamentos/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/pagamentos/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"$tags":[{"id":"blip-tag-a02c8a03-c667-42c3-b1cb-bbce5990fbe6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4c454171-3920-4825-8791-8aa871142817","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f2e39bfe-b733-427b-b970-8b754d8cb015","root":false,"$title":"[CC.9.0.0] Pagar Contas","$position":{"top":"2090px","left":"878.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"62119161-7c61-4e4a-a21b-78049c914a07","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","root":false,"$title":"[GO TO] Finalização (Welcome)","$position":{"top":"2463px","left":"879.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"contacorrente","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/betaspdcontacorrente","clientId":"BLIP","grantType":"client_credentials","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}