{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d2712b4e-c844-4435-ba60-8364a32b3206","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"85d915aa-f1ca-4e54-9c06-04e60015756d","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"b5bef41d-16bb-4ea1-b8dc-ec17b6adc914","$connId":"con_3","$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"78bdc058-ee64-454a-a1bc-caeb50bba482","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-19a815ef-8aa0-46b1-a9da-0cf27ecfd48e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-60a9e87e-ccd6-46a2-bda2-a87814d5f841","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"128px","left":"876px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b687933a-994c-4382-8051-601710a0e8ea","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"928e1999-3310-4c4f-a25a-c051922b9862","typeOfStateId":"state","$connId":"con_8","$id":"d40c89b5-2225-49b2-b2f8-02689607aa97","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"74c0977e-fc70-432d-8f10-ae862389b161","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]},{"$id":"bda24a54-7cdc-41e9-a4da-bab2abdc8f8d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c01f5e75-2d4a-4dc1-abd2-a7263f50f010","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"131px","left":"395px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"928e1999-3310-4c4f-a25a-c051922b9862":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-4ee80d05-a2d9-4bf8-8df9-4010cc85f987","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"928e1999-3310-4c4f-a25a-c051922b9862","root":false,"$title":"[Redirect] To cascata","$position":{"top":"277px","left":"395px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"151450df-a066-47b5-a025-b141b63f5e59":{"$contentActions":[{"action":{"$id":"b3dc6fe0-5862-421a-8597-ca68ba1caf3e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a10fb9f6-38d4-42e2-8ae5-6c5e51c25640","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a10fb9f6-38d4-42e2-8ae5-6c5e51c25640","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"33e7fe3d-1d62-4fa8-bd31-bc308fb7548c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"302c1b7e-40ce-4d38-97ee-9b74259d6dad","type":"text/plain","content":"<b> Variaveis de configuração</b>\n\n1. <b>env</b> (criar apenas para o bot de <b>Dev</b> com valor <b>Dev</b>)\n\n2. serviceName (nome do serviço cadastrado no roteador para esse bot)\n\n<b>Para bots com chamada de api</b>\n\n3. <b>urlCHT</b>: https://api-hml.safra.com.br","metadata":{}},"$cardContent":{"document":{"id":"302c1b7e-40ce-4d38-97ee-9b74259d6dad","type":"text/plain","content":"<b> Variaveis de configuração</b>\n\n1. <b>env</b> (criar apenas para o bot de <b>Dev</b> com valor <b>Dev</b>)\n\n2. serviceName (nome do serviço cadastrado no roteador para esse bot)\n\n<b>Para bots com chamada de api</b>\n\n3. <b>urlCHT</b>: https://api-hml.safra.com.br"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff677ca8-6f21-4a8e-916e-915b33fd8716","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ff14a9b1-5222-4d07-a89f-419bb44321f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ff14a9b1-5222-4d07-a89f-419bb44321f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c75ab037-cff6-45ae-bd79-4b0888eeb252","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8a01262b-98d3-4aab-b473-d5a1de0f3917","type":"text/plain","content":"<b>Conferir</b>\n1. Bot cadastrado no roteador?\n2. Contexto ativo?\n3. Trackings globais ativas?\n4. Process \"voltarState\" está nas ações globais?","metadata":{}},"$cardContent":{"document":{"id":"8a01262b-98d3-4aab-b473-d5a1de0f3917","type":"text/plain","content":"<b>Conferir</b>\n1. Bot cadastrado no roteador?\n2. Contexto ativo?\n3. Trackings globais ativas?\n4. Process \"voltarState\" está nas ações globais?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b636ee01-9127-4380-b396-05f8bb431534","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f2672b56-d437-4ff3-82b8-4531ef315763","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"151450df-a066-47b5-a025-b141b63f5e59","root":false,"$title":"CHECKLIST NOVO BOT","$position":{"top":"260.667px","left":"875.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"37f23f86-2009-43f1-b7a5-f50093c784f0":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a07fefdc-a4a7-46b4-a70c-997da7fc4a50","typeOfStateId":"state","$connId":"con_13","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Solicitar Cartão\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Desbloquear cartão\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Esqueci minha senha\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Perda / Roubo do cartão\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Agora, por gentileza, selecione no menu abaixo a opção desejada.👇` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"9939be58-b396-4717-91e2-e015c3962bea","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"cartao\"","$invalid":false,"settings":{"variable":"assunto","value":"cartao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-02bbd028-85df-4cde-9ea1-a7fee7a8e918","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0a39b3da-e925-4818-a159-404098c974d2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6d15423e-a71b-404d-8c9f-07c4feeaf850","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-81092ed9-4aae-4293-b7ed-63a557178f68","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"37f23f86-2009-43f1-b7a5-f50093c784f0","root":false,"$title":"[CC.2.0.0][MSG] Menu Cartão","$position":{"top":"904px","left":"2362px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a07fefdc-a4a7-46b4-a70c-997da7fc4a50":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6b8f6f86-4687-4aae-8f02-213d2f828855","typeOfStateId":"state","$connId":"con_18","$id":"e8be7cc6-973b-48ff-8c76-0895d9f02f60","conditions":[{"values":["Solicitar Cartão"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"43b6539b-743b-4c0d-9757-e06efdc0c93c","typeOfStateId":"state","$connId":"con_23","$id":"3a698ba9-dbc0-4af4-92d9-da97658b278a","conditions":[{"values":["Desbloquear cartão"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"2696021a-72b5-48d5-9cdc-2a0adf4f3694","typeOfStateId":"state","$connId":"con_28","$id":"a38796a2-7c28-4a48-8b05-a2a85dd2d426","conditions":[{"source":"context","comparison":"equals","values":["Esqueci minha senha"],"variable":"userInput"}],"$invalid":false},{"stateId":"ff996689-492a-4ef6-be45-04f589b26826","typeOfStateId":"state","$connId":"con_33","$id":"7a8950b2-1000-436c-a9bd-a66470e77e96","conditions":[{"source":"context","comparison":"equals","values":["Perda / Roubo do cartão"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5880b4c9-2c80-4a6e-8b28-67fb6c2e0c92","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-517b66ff-a9f8-441e-aa83-9f9e003ae684","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f5e79b2f-d005-4e68-9eec-a787679a0558","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-04f1ff6d-7ef1-4201-9ba6-dfb2ae08d972","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a07fefdc-a4a7-46b4-a70c-997da7fc4a50","root":false,"$title":"[CC.2.0.0][INPUT] Menu Cartão","$position":{"top":"1155px","left":"2362px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e3206de-707e-4dac-9749-9f24d53110c0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e5c624a6-f303-463a-95fb-919bd3fcd8a6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","typeOfStateId":"state","$connId":"con_38","$id":"57d5cbb0-d9f8-4f7a-8df5-47377a4499ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"96259fcd-3464-4280-b312-2918dcb9eab0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8dbb91b2-d882-44f5-95df-aa9a35c077e5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"1e3206de-707e-4dac-9749-9f24d53110c0","root":false,"$title":"[CC.5.0.0] Gravame","$position":{"top":"583.282px","left":"1644.97px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5ea0cac6-c5fd-49f9-9423-54d0e660adae":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aef70d64-6ae4-40b1-a0ac-dec9257d6088","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","typeOfStateId":"state","$connId":"con_43","$id":"b57a7b3c-d562-42fb-9c97-012fce49bd62","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a43ad079-d700-4bd5-a427-1853d43b65a2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1d8c514f-1b32-4cb9-9837-947d2aa12930","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5ea0cac6-c5fd-49f9-9423-54d0e660adae","root":false,"$title":"[CC.6.0.0] Renegociação","$position":{"top":"581.795px","left":"1894.03px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"25991251-b486-423e-8a43-49f1c17ecef6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9c3f4364-a0d8-424f-a8e6-915919ed0b39","typeOfStateId":"state","$connId":"con_48","$id":"53fa7443-3506-4fc7-9037-9b8b918c538a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"68876e1c-788d-4d7a-aab5-97aa61b99e40","typeOfStateId":"state","$connId":"con_53","$id":"d27ba48e-206a-413a-929a-6dd9e3d07d5e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","root":false,"$title":"[CC.0.1.0][LOGIC] Cliente carterizado?","$position":{"top":"1308px","left":"1094px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68876e1c-788d-4d7a-aab5-97aa61b99e40":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3bb2455c-ce43-434c-8634-702d5f52e7f9","typeOfStateId":"state","$connId":"con_58","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Menu Principal\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Menu Anterior\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Encerrar\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"4\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Como deseja prosseguir? ` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Opções\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-002f9d58-d603-4f8d-b17a-f1b6ad65158e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d30ad8f0-3ecd-4f80-b5ff-aae549b16578","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9303ec9b-167e-41eb-81a4-89ff02ea4c4e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"68876e1c-788d-4d7a-aab5-97aa61b99e40","root":false,"$title":"[CC.0.1.1][MSG] Não carterizado","$position":{"top":"1541px","left":"794px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3bb2455c-ce43-434c-8634-702d5f52e7f9":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"54748e92-f46d-4008-98ec-cc44c13f3dfa","typeOfStateId":"state","$connId":"con_63","$id":"5b6a68fb-a757-4d50-82b3-e3e706af4472","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Menu Principal"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"7000cb42-9ab4-4a40-907f-6223dec9d8e9","typeOfStateId":"state","$connId":"con_68","$id":"6b7cebb9-b04a-47ef-b4c8-3b2df72b4d91","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Encerrar"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","typeOfStateId":"state","$connId":"con_73","$id":"3f1fdf9e-7e65-4504-b674-86fda189442a","conditions":[{"source":"context","comparison":"equals","values":["Menu Anterior"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-806bc401-e98c-4c1c-937d-2adc11bb0793","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b1e5db0b-3a62-4dc1-b4e4-94f1ba7590fc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3d98b41e-2149-4ca2-a369-7db75ffcb875","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bbf23f95-4fad-40b8-923b-0b0a2d349a3a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3bb2455c-ce43-434c-8634-702d5f52e7f9","root":false,"$title":"[CC.0.1.2][INPUT] Não carterizado","$position":{"top":"1926px","left":"794px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f88bbdeb-3963-49e0-a355-edc20350bbfd":{"$contentActions":[{"action":{"$id":"12db0ffc-93c9-476c-8478-b5a23056ae2a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a83d4ce-9b8b-4b7f-a176-98da9bd87f3a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Investimentos\".\n2. Selecione a opção \"Aplicar\".\n3. Escolha o produto em que deseja investir.\n4. Insira o valor que deseja aplicar.","metadata":{}},"$cardContent":{"document":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Investimentos\".\n2. Selecione a opção \"Aplicar\".\n3. Escolha o produto em que deseja investir.\n4. Insira o valor que deseja aplicar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39351547-5e06-4476-9bba-e388055e7490","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","typeOfStateId":"state","$connId":"con_78","$id":"a867f8ac-5bfb-4464-8bc1-33da2edfe211","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b56b0242-c8bd-4a60-b82b-35b4606209d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"6bbae6ea-d663-4567-944f-af69d6891287","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"investimentos\"","$invalid":false,"settings":{"variable":"assunto","value":"investimentos"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7c9bef57-acc5-4efe-8c15-783475b4988e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e40918d3-9abc-41f4-872a-d6ad38d5f523","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-27208271-7680-410d-8152-f0a7661c0d2d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f88bbdeb-3963-49e0-a355-edc20350bbfd","root":false,"$title":"[CC.3.0.0] Investimentos","$position":{"top":"953.308px","left":"1252.72px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e36dcaa0-0665-4b22-ae98-3e8605d7e557":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '30e39880-1d2a-439a-a0ed-1e7210966286',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a1c587ab-0a46-4489-9d95-05f58bba3ccb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b049cba8-6a8a-4c20-bddd-bd58410d3e7f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","root":false,"$title":"[Redirect] To Main (Menu inicial)","$position":{"top":"116px","left":"1164px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"facc5123-47f0-4255-a30f-a6b87e18176e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f76302fd-b2b6-4297-8e57-f2c70fb02bb2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2d97a4e7-103c-4f78-9d4d-eb3d275aaec9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"facc5123-47f0-4255-a30f-a6b87e18176e","root":false,"$title":"[Redirect] To  Finalizacao (Finalizar)","$position":{"top":"104.462px","left":"1363.18px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"54748e92-f46d-4008-98ec-cc44c13f3dfa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9897798e-a2d5-4ad1-ad60-913074bbb68f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"54748e92-f46d-4008-98ec-cc44c13f3dfa","root":false,"$title":"[GO TO] Menu inicial","$position":{"top":"2619px","left":"765px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7000cb42-9ab4-4a40-907f-6223dec9d8e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c23e11a-719d-4fb6-bb66-a8a49c12e47b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"facc5123-47f0-4255-a30f-a6b87e18176e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7000cb42-9ab4-4a40-907f-6223dec9d8e9","root":false,"$title":"[GO TO] Encerrar","$position":{"top":"1949px","left":"544px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9c3f4364-a0d8-424f-a8e6-915919ed0b39":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4381c1f3-6264-42ac-bbca-f606701b2539","typeOfStateId":"state","$connId":"con_83","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"type\": \"reply\",\n\t\t\t// \t\"reply\": {\n\t\t\t// \t\t\"id\": \"3\",\n\t\t\t// \t\t\"title\": \"\"\n\t\t\t// \t}\n\t\t\t// }\n\t\t];\n\t\tconst bodyText = \"Conseguimos te ajudar?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9df88c2f-df76-4d49-97d6-659e5755f479","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-caa9cf5d-0c81-4769-97b1-981c0c224b99","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7c850b9a-f7cd-4b99-97e2-5e7b631a00ea","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9c3f4364-a0d8-424f-a8e6-915919ed0b39","root":false,"$title":"[CC.0.1.3][MSG] Carterizado","$position":{"top":"1536px","left":"1383px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4381c1f3-6264-42ac-bbca-f606701b2539":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5a3d7e47-334e-48c0-a6a7-869f9678a954","typeOfStateId":"state","$connId":"con_88","$id":"c2532493-9855-4a8c-900d-2331b6ebe72f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Sim"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"656962f1-1814-43ee-9f4d-872a42f2f951","typeOfStateId":"state","$connId":"con_93","$id":"09f888d4-aa81-4aee-b0a0-e7cf316129ee","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Não"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a4fd5bd3-b6df-471a-ac65-ecac242a0f8a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2e3e91c9-1d58-4931-8f22-f337e44e28ae","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a3958582-d210-4970-ac42-de3db9d542e4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c0cb6611-f130-45a1-a798-f5cac34af16b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4381c1f3-6264-42ac-bbca-f606701b2539","root":false,"$title":"[CC.0.1.4][INPUT] Carterizado","$position":{"top":"1759px","left":"1383px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"820d335f-0c95-466f-9009-35cac24c6ea4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-29801c7b-9235-401e-a5ad-1e0528e234d6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-20089bb1-f395-4303-857d-20be199d5c0e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"820d335f-0c95-466f-9009-35cac24c6ea4","root":false,"$title":"[Redirect] To  Finalizacao (Welcome)","$position":{"top":"104.436px","left":"1558.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5a3d7e47-334e-48c0-a6a7-869f9678a954":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c81febe-8e1d-4241-b039-d258c2effee4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"5a3d7e47-334e-48c0-a6a7-869f9678a954","root":false,"$title":"[GO TO] Finalização","$position":{"top":"1770px","left":"1704px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cf24777b-0dc4-44b9-969f-a9c1c4e552fc":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de","typeOfStateId":"state","$connId":"con_98","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Menu Principal\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Menu Anterior\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Falar com gerente\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"4\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, como podemos te ajudar?` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-43e450f3-469a-4e44-a500-73a3513df52f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f438db6d-631f-4384-9f42-dc74ca8d910d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-198cd04d-642e-4734-91bd-82790f414a30","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cf24777b-0dc4-44b9-969f-a9c1c4e552fc","root":false,"$title":"[CC.0.1.6][MSG] Como podemos ajudar? (emp1)","$position":{"top":"2287px","left":"1383px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"54748e92-f46d-4008-98ec-cc44c13f3dfa","typeOfStateId":"state","$connId":"con_103","$id":"9ce4999f-6b8b-4435-8cb9-fdf34c26823c","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Menu Principal"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"26f12b75-a1eb-4779-9d15-f525f0e30960","typeOfStateId":"state","$connId":"con_108","$id":"4d9465dd-2dad-401f-8b69-540bf76f98f1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Falar com gerente"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","typeOfStateId":"state","$connId":"con_113","$id":"723501c5-b56d-4ee0-acda-31abc58be6af","conditions":[{"source":"context","comparison":"equals","values":["Menu Anterior"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e3a9dedb-95fe-44f2-a4f2-c2baa956afa2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f20ccf98-f245-4f1b-b59b-edb7ceca3f31","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0c38280c-77a1-4e72-ade0-590385b5e9e7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c082e40f-87dc-49bf-bfd7-d20fd7fc64cc","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de","root":false,"$title":"[CC.0.1.7][INPUT] Como podemos ajudar? (emp1)","$position":{"top":"2572px","left":"1383px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"656962f1-1814-43ee-9f4d-872a42f2f951":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"307f84bd-662a-49b4-9bf1-3772df28581b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cf24777b-0dc4-44b9-969f-a9c1c4e552fc","typeOfStateId":"state","$connId":"con_118","$id":"7fc1000d-17c9-4b3b-ad57-d6cb906bbbf7","conditions":[{"source":"context","comparison":"equals","values":["emp1"],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"26f12b75-a1eb-4779-9d15-f525f0e30960","typeOfStateId":"state","$connId":"con_123","$id":"563aed27-41a6-4834-aaab-88bb3328f8b4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"656962f1-1814-43ee-9f4d-872a42f2f951","root":false,"$title":"[CC.0.1.5][LOGIC] Seguimento emp1?","$position":{"top":"2022px","left":"1383px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2361b9db-e18e-45de-afea-a50626686dd8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8cc713c3-ac1d-4aaf-b6f2-05812fbe6dd5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ad24c912-4af7-45cd-bfd2-675cfc27eb9f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2361b9db-e18e-45de-afea-a50626686dd8","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"103.333px","left":"1763.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"26f12b75-a1eb-4779-9d15-f525f0e30960":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7c0e9eab-35ee-46fd-971e-279328455fd3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"26f12b75-a1eb-4779-9d15-f525f0e30960","root":false,"$title":"[GO TO] Atendimento Humano","$position":{"top":"2297px","left":"1732px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c1af60de-05a9-4466-8c99-b2ddb36a220a":{"$contentActions":[{"action":{"$id":"12db0ffc-93c9-476c-8478-b5a23056ae2a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a83d4ce-9b8b-4b7f-a176-98da9bd87f3a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Contas\".\n2. Em \"Outros serviços\", clique em \"Talões de Cheque\".\n3. Clique em \"Solicitar novo talão\" e selecione a quantidade desejada.\n4. Para concluir a solicitação, informe sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"1. No Internet Banking, clique na aba \"Contas\".\n2. Em \"Outros serviços\", clique em \"Talões de Cheque\".\n3. Clique em \"Solicitar novo talão\" e selecione a quantidade desejada.\n4. Para concluir a solicitação, informe sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39351547-5e06-4476-9bba-e388055e7490","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","typeOfStateId":"state","$connId":"con_128","$id":"a98427bd-b99a-4f7f-9d9c-7270f826dea3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b56b0242-c8bd-4a60-b82b-35b4606209d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"20c9ca88-e691-4b02-8343-0f9b5d3febf0","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"cheque empresas\"","$invalid":false,"settings":{"variable":"assunto","value":"cheque empresas"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-45381c2e-bcb2-4e50-8fe5-a8df10d265f8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-96e56d05-4299-4dea-b1f5-40f843f2ff88","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-be01850c-a547-4d92-8a1f-2f4a32414985","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c1af60de-05a9-4466-8c99-b2ddb36a220a","root":false,"$title":"[CC.1.0.0] Cheque Empresas","$position":{"top":"954px","left":"933px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6b8f6f86-4687-4aae-8f02-213d2f828855":{"$contentActions":[{"action":{"$id":"51821bf3-acc6-4765-91dd-e2a65ad9ccb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"96eeca3d-c830-4bb2-a9ae-c105803c9a7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"96eeca3d-c830-4bb2-a9ae-c105803c9a7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"42783a71-9979-4f5a-9d36-6b5556f21d60","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b0364a9a-9a7a-4a0d-ad0d-cc77d61e9242","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Solicitar cartão\".\n2. Preencha os dados da sua empresa conforme solicitado e clique em \"Próximo\".\n3. Confirme os dados para emissão do cartão.\n4. Para concluir a solicitação, informe senha e token.","metadata":{}},"$cardContent":{"document":{"id":"b0364a9a-9a7a-4a0d-ad0d-cc77d61e9242","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Solicitar cartão\".\n2. Preencha os dados da sua empresa conforme solicitado e clique em \"Próximo\".\n3. Confirme os dados para emissão do cartão.\n4. Para concluir a solicitação, informe senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_133","$id":"b2fbd9fa-0ab3-4ae4-9e12-59be5dfc5e1a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0f3330f8-6f5e-41f1-a857-0b007cdd81de","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-63e44c7f-12f8-43f8-a53f-eb5b7d24a60d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6b8f6f86-4687-4aae-8f02-213d2f828855","root":false,"$title":"[CC.2.1.0] Solicitar Cartão","$position":{"top":"1485px","left":"1953px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"43b6539b-743b-4c0d-9757-e06efdc0c93c":{"$contentActions":[{"action":{"$id":"e858e3c3-538c-486e-ab69-155c88c269ec","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa221bab-108a-4c42-956b-7f10c3d14105","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa221bab-108a-4c42-956b-7f10c3d14105","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"59d38d95-4f9f-417f-93f7-9065c5deec40","$typeOfContent":"text","type":"SendMessage","settings":{"id":"44ca71e0-7968-48e0-a111-39b70b92fdf6","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Desbloquear\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"44ca71e0-7968-48e0-a111-39b70b92fdf6","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões\", clique em \"Desbloquear\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_138","$id":"0b5529ad-8da0-40c7-bfdf-e3dab5141a2c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a2b26e94-84dc-41d4-9c02-b225e2a43094","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-23025d04-175a-4659-87a4-310f2c75391f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"43b6539b-743b-4c0d-9757-e06efdc0c93c","root":false,"$title":"[CC.2.2.0] Desbloquear Cartão","$position":{"top":"1460.57px","left":"2271px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2696021a-72b5-48d5-9cdc-2a0adf4f3694":{"$contentActions":[{"action":{"$id":"ae49ed10-5b7e-460c-a94c-ca305dafe899","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cf2cb7a3-1ef9-4e94-b377-5dcf3a294436","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cf2cb7a3-1ef9-4e94-b377-5dcf3a294436","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e0e7d666-e684-404b-b2db-cb577e18d248","$typeOfContent":"text","type":"SendMessage","settings":{"id":"41fc34e4-fd5f-4071-92f2-5556c8237987","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões - Meus Cartões\", clique em \"Reenviar senha\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"41fc34e4-fd5f-4071-92f2-5556c8237987","type":"text/plain","content":"1. No Internet Banking, na aba \"Cartões - Meus Cartões\", clique em \"Reenviar senha\".\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_143","$id":"84aec40c-6656-429b-8860-98b6b8a3b04d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-56e7571f-950c-49e4-a8f2-559cf5eea57c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b24fb72b-0320-4cb5-8310-79a4b00f6733","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"2696021a-72b5-48d5-9cdc-2a0adf4f3694","root":false,"$title":"[CC.2.3.0] Esqueci minha senha","$position":{"top":"1478.71px","left":"2469.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ff996689-492a-4ef6-be45-04f589b26826":{"$contentActions":[{"action":{"$id":"55189105-a1a2-46e2-aa4e-7ad69b69c3ff","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f6b63e11-c6c6-4a92-9190-b03b5e0d0895","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f6b63e11-c6c6-4a92-9190-b03b5e0d0895","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31863de9-8e0d-4554-8700-7281b1f891e3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ae0bb8a9-01f8-4f70-a0fc-31c19742e414","type":"text/plain","content":"1. No Internet Banking, na aba Cartões clique em Bloquear por perda ou roubo.\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"ae0bb8a9-01f8-4f70-a0fc-31c19742e414","type":"text/plain","content":"1. No Internet Banking, na aba Cartões clique em Bloquear por perda ou roubo.\n2. Preencha os dados da sua empresa conforme solicitado.\n3. Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_148","$id":"db6298e6-ffd2-4a54-856a-a7cea9f0a125","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d2e0cb6e-de12-4e9c-b3d7-0255efd34778","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b1b2deba-cfa3-4738-8709-d2524c2ed584","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ff996689-492a-4ef6-be45-04f589b26826","root":false,"$title":"[CC.2.4.0] Perda / Roubo","$position":{"top":"1479.14px","left":"2789px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d60ffb9f-33a0-4701-a858-f54405c2ee81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","root":false,"$title":"[GO TO][LOGIC] Cliente carterizado?","$position":{"top":"2110px","left":"2370px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b420cdc-30d4-4876-bf68-61b4346c4c71":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"69c9b513-1751-4b8d-af46-0aa6cdea618f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2002"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b8d09f05-088c-4b3e-8348-9c4e88a92b1d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, assunto) {\n\tconst destination = {\n\t\t'cheque empresas': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'investimentos': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'cartao': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'pacotes contratados': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '16cc5d45-c8d8-4b01-b000-e76eff268c33'\n\t\t}\n\t}\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst destinationBot = destination[assunto]\n\t\tif (!destinationBot) {\n\t\t\tthrow new Error('invalid destination')\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\t...destinationBot,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: 'contacorrente',\n\t\t\tstateOrigin: '[Redirect] Menu anterior',\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","assunto"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"960947c0-f767-41ea-b824-266e2ef32438","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2454179a-849c-4225-9ad1-aaab2905f980","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ac4e4002-ff7a-42ef-bf12-efeb5e915593","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"4b420cdc-30d4-4876-bf68-61b4346c4c71","root":false,"$title":"[Redirect] Menu anterior","$position":{"top":"107.429px","left":"1979.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e98bc47-4a22-4b16-af0d-88bc0278ba99":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a10577b-e395-449a-a34d-65c909230084","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4b420cdc-30d4-4876-bf68-61b4346c4c71","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","root":false,"$title":"[GO TO] Redirect menu anterior","$position":{"top":"2318px","left":"1018px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b9ad166b-910b-43a2-b6e1-7e3ae4171339":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f15eb474-f67b-44ba-b09f-8901a2490810","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"dd50398e-90ff-4bcb-b1ce-68f2571a065f","typeOfStateId":"state","$connId":"con_153","$id":"d5b7d14a-6b65-48fb-aefa-f31136985ce8","conditions":[{"source":"context","comparison":"equals","values":["{\"data\":[]}","\"data\":[]"],"variable":"bodyPacote"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88","typeOfStateId":"state","$connId":"con_158","$id":"e1ac8cc3-52c1-4d1a-be67-6fd3b9f38c9e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f9afd3ff-340e-4fab-bf6d-294cd1815005","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyPacote\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/pacotes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusPacote","responseBodyVariable":"bodyPacote"},"conditions":[]},{"$id":"410a931a-c855-4e00-953d-e3b6a9cdaf55","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"93a48c9b-03ba-4b84-9ded-9e2a040d9a8d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"2ac3da8d-b09e-4ca9-bee7-0cce075fdc5c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"eb950751-5d3d-408e-b7a1-e1c53508bc4f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusPacote"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5866436c-1def-4be7-955a-81f9e7616f2a","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/pacotes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET| {{statusPacote}} | {{bodyPacote}}"},"conditions":[]},{"$id":"adbd25d9-5e5e-4daf-b3c4-7750f162fdf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"statusPacote"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusPacote"}]},{"$id":"3212044a-1038-43f9-b23c-42a93c60dd16","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f810826e-c003-4f07-a6e4-700fcc6865b1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b5a51a83-47fd-43e2-8d9f-e5d0d11c4cc2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6083e5c5-b8fc-49ee-a65f-4e8d27d71bdf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2bbd61f4-ab1e-410e-a47f-937d90f6e752","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"b9ad166b-910b-43a2-b6e1-7e3ae4171339","root":false,"$title":"[TC.8.0.0][HTTP] API Pacotes","$position":{"top":"1119px","left":"3790.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dd50398e-90ff-4bcb-b1ce-68f2571a065f":{"$contentActions":[{"action":{"$id":"830dc22e-05b5-4846-ad0a-b0942056e6da","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b23bbad8-f440-4e04-afee-76696df30d2e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b23bbad8-f440-4e04-afee-76696df30d2e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2a4a5ec3-f094-4baf-b0c5-eff6930c982d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d55fc062-6b49-49a7-9d2c-f80fbe4cca96","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você não possui pacotes de serviço cadastrados. ","metadata":{}},"$cardContent":{"document":{"id":"d55fc062-6b49-49a7-9d2c-f80fbe4cca96","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você não possui pacotes de serviço cadastrados. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"aa7f4cb0-ab7d-41d9-a97b-933d665cdfa3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ab0adeac-f86e-442b-a933-60fa68af47ee","typeOfStateId":"state","$connId":"con_163","$id":"d12b034e-b2bb-4e95-a547-1e2a64e1e5bc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"462ef3b3-6e21-4ccb-9511-71e7027054f4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5fe07984-2965-4d50-90a7-382ce09855a9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7a4728c0-ce26-4f9e-8b5b-8b4b02eb2f90","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dd50398e-90ff-4bcb-b1ce-68f2571a065f","root":false,"$title":"[TC.8.1.0][MSG] Não possui pacotes","$position":{"top":"1313px","left":"4140px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88":{"$contentActions":[{"action":{"$id":"be51e4c1-0a2d-4317-a70c-3a4e2dabc78c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c93093a-6c58-407c-ac45-77c600bce2f5","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, este é o seu pacote de serviços contratado:👇","metadata":{}},"$cardContent":{"document":{"id":"6c93093a-6c58-407c-ac45-77c600bce2f5","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, este é o seu pacote de serviços contratado:👇"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a9199be-d406-473c-9467-2cd7b13f31eb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b233c255-aff1-46e8-be1a-57c6cce55760","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b233c255-aff1-46e8-be1a-57c6cce55760","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43fce40b-0ef3-4893-ae77-565f1b3aa02b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c1519c0c-33f5-46e0-b0e3-198a9a7a6c4a","type":"text/plain","content":"{{pacote}}","metadata":{}},"$cardContent":{"document":{"id":"c1519c0c-33f5-46e0-b0e3-198a9a7a6c4a","type":"text/plain","content":"{{pacote}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fac17be3-0201-4328-b945-debc0327d360","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9b168af3-065a-4ea3-b277-61fb23ef1d7f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b168af3-065a-4ea3-b277-61fb23ef1d7f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0d7ad388-3ac7-4cdc-948b-1ae362d68905","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ab0adeac-f86e-442b-a933-60fa68af47ee","typeOfStateId":"state","$connId":"con_168","$id":"1618012f-9044-4cef-a73d-c91603287b9d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e1050974-d7c4-460a-9e94-b1973ab21086","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pacote\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyPacote) {\n  try {\n    let jsonData = JSON.parse(bodyPacote)\n    // Extrair valores\n    let primeiroItem = jsonData.data[0];\n    let nome = primeiroItem.nome;\n    let valor = primeiroItem.valor;\n\n    // Convertendo o número para uma string\n    let valorString = valor.toString();\n\n    // Substituindo ponto por vírgula\n    let valorFormatado = valorString.replace('.', ',');\n\n    // Formatando como moeda\n    valorFormatado = valorFormatado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });\n\n    // Verificando se há ponto e vírgula na formatação\n    if (valorFormatado.indexOf('.') !== -1 && valorFormatado.indexOf(',') !== -1) {\n      let splitVirgula = valorFormatado.split(',');\n      let decimais = splitVirgula[1] + '00';\n      valor = splitVirgula[0] + ',' + decimais.substring(0, 2);\n    } else if (valorFormatado.indexOf('.') !== -1) {\n      valor = valorFormatado + ',00';\n    } else if (valorFormatado.indexOf(',') !== -1) {\n      let splitVirgula = valorFormatado.split(',');\n      let decimais = splitVirgula[1] + '00';\n      let milhar = splitVirgula[0].replace(/\\D/g, '');\n      milhar = milhar.replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\n      valor = milhar + ',' + decimais.substring(0, 2);\n    } else {\n      let milhar = valorFormatado.replace(/\\D/g, '');\n      milhar = milhar.replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\n      valor = milhar + ',00';\n    }\n    return (`Nome do serviço: ${nome}\\nValor: R$${valor}`);\n\n  }\n  catch (e) {\n    return e.message;\n  }\n}","inputVariables":["bodyPacote"],"LocalTimeZoneEnabled":false,"outputVariable":"pacote"},"conditions":[]},{"$id":"51f9e661-fd2c-4120-9f56-2d984ef79796","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-681d2598-9875-43ee-b640-da0c42fa51b9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c6b221fc-d2a2-4cd9-ad94-e85f15a4a843","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d0f79f12-e690-4e01-bf1c-3121460c1cbc","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88","root":false,"$title":"[TC.8.2.0][MSG] Possui pacotes","$position":{"top":"1318px","left":"3514.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ab0adeac-f86e-442b-a933-60fa68af47ee":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7d3b7196-f824-4926-88ec-84fdd31f45d0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2"},"isAiGenerated":false,"$tags":[],"id":"ab0adeac-f86e-442b-a933-60fa68af47ee","root":false,"$title":"[GO TO] CC.0.1.0 Conseguimos te Ajudar?","$position":{"top":"1516.5px","left":"3811px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"708a01ab-973e-404f-8e0f-fe4a312b5100":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'b9ad166b-910b-43a2-b6e1-7e3ae4171339',//Pacotes\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f0033d4d-7330-4f04-8441-50aaf5665544","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cd1b95e9-7862-4850-bf1d-f2abb99fb5c9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"708a01ab-973e-404f-8e0f-fe4a312b5100","root":false,"$title":"[Redirect] To \"Autenticacao\"","$position":{"top":"959.5px","left":"3787.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"191a2f33-c58e-4a64-9e66-af23348bcbad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"82e40acc-3cb3-40d0-b3a7-774e66b700ae","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"708a01ab-973e-404f-8e0f-fe4a312b5100","typeOfStateId":"state","$connId":"con_173","$id":"d633e8bd-66b3-454e-8f1e-c7926a8dc9ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"808f528e-491c-4eab-858c-de25eb8f5968","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"a76fdd71-3815-49e1-9488-9b78c0421c0d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"8005fea5-86ab-4074-a264-a0b889c2443a","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"pacotes contratados\"","$invalid":false,"settings":{"variable":"assunto","value":"pacotes contratados"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8dc2567d-0d92-42d1-8f0c-57536999024b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b1d32aee-a074-482f-9969-ed877c3452ba","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"191a2f33-c58e-4a64-9e66-af23348bcbad","root":false,"$title":"[CC.3.0.0][SET] Consultar Pacotes Contratados","$position":{"top":"770px","left":"3788.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"contacorrente","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/betaspdcontacorrente","clientId":"BLIP","grantType":"client_credentials","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}