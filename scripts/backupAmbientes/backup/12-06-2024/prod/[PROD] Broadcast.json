{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"8c0bd4bf-6b0b-4085-a335-8af27420c779","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"a0a30b4b-4eef-4689-bfc7-f362b6c53975","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"fdba4a00-aa02-45c1-830e-7c1b79ef393e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"origemCampanhaPadrao\"","$invalid":false,"settings":{"function":"run","source":"function run(calendarDatetime, inputMessage, inputContent, broadcast, identity) {\n    const date = new Date(calendarDatetime);\n    \n    const dataFormatada = dataAtualFormatada(date);\n    let metadataCampanha = metadata(inputMessage);\n    const origem = origemCampanha(inputContent, metadataCampanha, broadcast);\n    const canal = origemCanal(identity);\n    metadataCampanha = metadataCampanha != \"\" ? metadataCampanha : \"nao possui campanha\";\n\n    const trackOrigemCampanha = `${dataFormatada} | ${identity} | ${metadataCampanha} | ${canal} | ${origem} | ${inputContent}`\n    \n    return { \n        trackOrigemCampanha,\n        canal\n    };\n}\n\nfunction dataAtualFormatada(data) {\n    const dia = data.getDate().toString();\n    const diaF = (dia.length == 1) ? '0' + dia : dia;\n    const mes = (data.getMonth() + 1).toString(); //+1 pois no getMonth Janeiro começa com zero.\n    const mesF = (mes.length == 1) ? '0' + mes : mes;\n    const anoF = data.getFullYear();\n    const hora = data.getHours().toString();\n    const horaF = (hora.length == 1) ? '0' + hora : hora;\n    const min = data.getMinutes().toString();\n    const minF = (min.length == 1) ? '0' + min : min;\n    const seg = data.getSeconds().toString();\n    const segF = (seg.length == 1) ? '0' + seg : seg;\n\n    return `${diaF}/${mesF}/${anoF} ${horaF}:${minF}:${segF}`;\n}\n\nfunction metadata(inputMessage) {\n    try {\n        let inputMessageFormatted = JSON.parse(inputMessage);\n        // let inputMessageFormatted = inputMessage;\n        let metadata = inputMessageFormatted.metadata;\n\n        if (metadata && metadata['#wa.referral.headline']) {\n            const metadataCampanha = `${metadata['#wa.referral.source_id']} | ${metadata['#wa.referral.source_url']} | ${metadata['#wa.referral.headline']} | ${metadata['#wa.referral.body']} | ${metadata['#wa.referral.source_type']} | ${metadata['#wa.referral.image.id']}`\n            return metadataCampanha;\n        } else {\n            const metadataCampanha = \"\"\n            return metadataCampanha;\n        }\n    } catch (err) {\n        const metadataCampanha = \"\";\n        return metadataCampanha;\n    }\n}\n\nfunction origemCampanha(inputContent, metadata, broadcast) {\n    try {\n        const sourceUrl = metadata;\n        if (sourceUrl != \"\") {\n            return \"Campanha\"\n        } else if(broadcast){\n            return `broadcast | ${broadcast}`\n        }\n        return \"organico\"\n    } catch (err) {\n        return \"organico\"\n    }\n}\n\nfunction origemCanal(identity) {\n    try {\n        const source = identity.split('@')[1].split('.')[0];\n        switch (source) {\n            case 'wa':\n                return \"whatsapp\";\n                break;\n            case 'businesschat':\n                return \"businesschat\";\n                break;\n            case '0mn':\n                return \"blipchat\";\n                break;\n            case 'messenger':\n                return \"messenger\";\n                break;\n            case 'telegram':\n                return \"telegram\";\n                break;\n            case 'instagram':\n                return \"instagram\";\n                break;\n            case 'mailgun':\n                return \"email\";\n                break;\n            case 'workplace':\n                return \"workchat\";\n                break;\n            case 'tunnel':\n                return \"whatsapp\";\n                break;\n            case 'abs':\n                return \"teams\";\n                break;\n            default:\n                return \"new\"\n                break;\n        }\n\n    } catch (error) {\n        return false;\n    }\n}","inputVariables":["calendar.datetime","input.message","input.content","contact.extras.broadcastOrigem","contact.identity"],"outputVariable":"origemCampanhaPadrao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dfe44f2b-7378-4221-8059-2c589d0ed9c0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Origem campanha [[canal]]\"","$invalid":false,"settings":{"extras":{},"category":"Origem campanha {{origemCampanhaPadrao@canal}}","action":"{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"origemCampanhaPadrao"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2a002be1-6b98-4c62-9fbf-65c6731e6bd2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f9dddf0a-c8cf-49a2-a1fc-b52f319a7cff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2e6275d6-1d3e-4d1b-89b0-2f79e37921f3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"112px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ce4d5530-5502-4f59-9db1-f234569359c8","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2936feee-9a8c-488a-b210-940e102e6a53","typeOfStateId":"state","$connId":"con_8","$id":"b8d13fe8-ce23-406c-a2f1-63b2d6455e44","conditions":[{"source":"context","comparison":"equals","values":["input inesperado","inatividade"],"variable":"userInput"}],"$invalid":false},{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"ce8e103f-daa4-486a-b7c6-252124d2315b","$connId":"con_13","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"fallback","$title":"Exceções","$position":{"top":"72px","left":"1316px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"78a63546-53b7-451d-951c-f0953819fb07","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe","typeOfStateId":"state","$connId":"con_18","$id":"61709095-24f8-4fdc-b05b-311147200742","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"irAtendimentoHumano"}],"$invalid":false},{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"895fa7f0-cec1-4487-ba06-ab4d5692b6c8","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/"],"source":"context","comparison":"matches","variable":"blockDestinationId"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e5b4ad73-983f-4eb9-82f0-b454f86679bb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"const broadcast = {\n\tnew_age_acesse_uso: ['safra empresas'],\n\tboas_vindas_mbj_ibj_v2: ['material boas vindas'],\n\tlink_rentabilizacao: ['gerar link pagamento'],\n\tlink_vestuario: ['gerar link pagamento'],\n\tlink_turismo: ['gerar link pagamento'],\n\tlink_prospeccao: ['gerar link pagamento'],\n\tlink_onboarding_d10: ['gerar link pagamento'],\n\tlink_onboarding_d5_: ['gerar link pagamento'],\n\tlink_onboarding_d2_copia: ['gerar link pagamento'],\n\treativacao_emp1: ['falar agora', 'falar com gerente'],\n\treativacao_emp1_v2: ['falar agora', 'falar com gerente'],\n\tboas_vindas_resumo: ['falar agora', 'falar com gerente'],\n\tantecipacao_black_november: ['não possuo interesse', 'não tenho interesse'],\n\tantecipacao_pos_black_november: ['não possuo interesse', 'não tenho interesse'],\n\tseguro_empresarial_emp1: ['não possuo interesse', 'não tenho interesse'],\n\tgiro_fimdeano_emp: ['não possuo interesse', 'não tenho interesse'],\n\tlink_pagamento_fimdeano: ['não possuo interesse', 'não tenho interesse'],\n\tantecipacao_fimdeano: ['não possuo interesse', 'não tenho interesse'],\n\tcartoes_credito_ativo_0505: ['não possuo interesse', 'não tenho interesse'],\n\tlink_queda60d_img: ['não possuo interesse', 'não tenho interesse'],\n\tarvbau_cliente_com_avulsa_ano_geren_atualizado: ['agora não posso'],\n\tarvbau_cliente_cancelou_automatica_geren_atualizado: ['agora não posso'],\n\tarvbau_cliente_possui_dquinze_dtrinta_geren_atualizados: ['agora não posso'],\n\tarvbau_cliente_nunca_antecipou_geren_atualizado: ['agora não posso'],\n\tarv_automatico_contratacao_abandono_1: ['agora não posso'],\n\tarv_automatico_contratacao_abandono_2: ['agora não posso'],\n\tarv_automatico_contratacao_abandono_3: ['agora não posso'],\n\tarv_eventual_contratacao_abandono_1: ['agora não posso'],\n\tarv_eventual_contratacao_abandono_2: ['agora não posso'],\n\ttaxa_esp_arv_emp1_at_1809: ['agora não posso'],\n\ttaxa_esp_arv_emp1_in_1809: ['agora não posso'],\n\tarv_aut_nvo_explic_valor_espec: ['agora não posso'],\n\tarv_ev_nvo_explic_valor_tx_espec: ['agora não posso'],\n\tarv_ev_gener_espec: ['agora não posso'],\n\tarv_aut_aband_espec: ['agora não posso'],\n\tarv_ev_aband_espec: ['agora não posso'],\n\tum_cred_nacessou15d_oferta_014: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\ttomador_credito_104: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcredito_novo_modelo_frase_curta_104: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcredito_n_acessou_novomodelo_oferta_104: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcredito_n_acessou_novomodelo_104: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tum_cred_nacessou15d_014: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tpdd_chemp_ad_30d_1904: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tpdd_chemp_ad_60d_1904_atualizado: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcred1_nacessou15d_oferta_1904: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcredito_n_acessou_nvomodelo_oferta_1904: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\treneg_abandono_3: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\treneg_abandono_2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\treneg_abandono_1: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgirocartoes_contratacao_abandono_3: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgirocartoes_contratacao_abandono_2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgirocartoes_contratacao_abandono_1: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgirocartoes_contratacao_abandono_4: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgirocartoes_contratacao_abandono_5: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgirocartoes_contratacao_abandono_6: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tpdd_giro_60d_1904_v1: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tpdd_giro_7d_3103_v1: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tpdd_giro_30d_1904_v4: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcredito_fgi_30_06: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tcredito_fgi_05_07: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\treativacao_emp1: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\toferta_arv_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tgenerico_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\treceptivo_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\toferta_giro_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\toferta_cartao_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\toferta_cobranca_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\toferta_renegociacao_v2: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_apresentacao_gerente: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tmutirao_vencidos_golden_month: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tboas_vindas_resumo: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_oferta_cobranca: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_oferta_arv: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_oferta_renegociacao: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_oferta_giro: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_apresentacao_gerentes: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tbusiness_generico: ['Falar depois', 'estou ciente', 'pagar no app', 'Agora não posso', 'Não'],\n\tpesquisa_pix_emp: ['Responder pesquisa']\n}\n\nfunction run(broadcastOrigem, userInput) {\n\ttry {\n\t\tconst validInputs = broadcast[broadcastOrigem]\n\t\tif (!validInputs) {\n\t\t\treturn 'main'\n\t\t}\n\t\tconst isValidInput = validInputs.some(option => option.toLowerCase() === userInput.toLowerCase())\n\t\tif (isValidInput) {\n\t\t\treturn broadcastOrigem\n\t\t}\n\t\treturn 'main'\n\t} catch (err) {\n\t\treturn 'main'\n\t}\n}","inputVariables":["contact.extras.broadcastOrigem","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"df8f581b-5996-4c6e-8a8c-0e05782153a9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"irAtendimentoHumano\"","$invalid":false,"settings":{"function":"run","source":"const broadcast = [\n  'um_cred_nacessou15d_oferta_014',\n  'tomador_credito_104',\n  'credito_novo_modelo_frase_curta_104',\n  'credito_n_acessou_novomodelo_oferta_104',\n  'credito_n_acessou_novomodelo_104',\n  'um_cred_nacessou15d_014',\n  'pdd_chemp_ad_7d_3103',\n  'pdd_giro_30d_3103',\n  'pdd_chemp_ad_30d_3103',\n  'pdd_giro_60d_3103',\n  'pdd_chemp_ad_60d_3103',\n  'pdd_chemp_ad_30d_1904',\n  'pdd_chemp_ad_60d_1904_atualizado',\n  'cred1_nacessou15d_oferta_1904',\n  'credito_n_acessou_nvomodelo_oferta_1904',\n  'girocartoes_contratacao_abandono_1',\n  'girocartoes_contratacao_abandono_2',\n  'girocartoes_contratacao_abandono_3',\n  'reneg_abandono_1',\n  'reneg_abandono_2',\n  'reneg_abandono_3',\n  'girocartoes_contratacao_abandono_4',\n  'girocartoes_contratacao_abandono_5',\n  'girocartoes_contratacao_abandono_6',\n  'pdd_giro_60d_1904_v1',\n  'pdd_giro_7d_3103_v1',\n  'pdd_giro_30d_1904_v4',\n  'credito_fgi_30_06',\n  'credito_fgi_05_07',\n  'arvbau_cliente_com_avulsa_ano_geren_atualizado',\n  'arvbau_cliente_cancelou_automatica_geren_atualizado',\n  'arvbau_cliente_possui_dquinze_dtrinta_geren_atualizados',\n  'arvbau_cliente_nunca_antecipou_geren_atualizado',\n  'arvbau_cliente_cancelou_automatica_autos',\n  'arvbau_cliente_possui_dquinze_dtrinta_autoser',\n  'arvbau_cliente_nunca_antecipou_autoser',\n  'arvbau_cliente_com_avulsa_ano_autoser',\n  'arv_automatico_contratacao_abandono_1',\n  'arv_automatico_contratacao_abandono_2',\n  'arv_automatico_contratacao_abandono_3',\n  'arv_eventual_contratacao_abandono_1',\n  'arv_eventual_contratacao_abandono_2',\n  'oferta_renegociacao_v2',\n  'oferta_arv_v2',\n  'oferta_cobranca_v2',\n  'oferta_cartao_v2',\n  'oferta_giro_v2',\n  'receptivo_v2',\n  'generico_v2',\n  'prospect_open_finance',\n  'taxa_esp_arv_emp1_in_1809',\n  'taxa_esp_arv_emp1_at_1809',\n  'business_apresentacao_gerente',\n  'mutirao_vencidos_golden_month',\n  'emp_cred_pre_aprovado_v2',\n  'link_queda60d_img',\n  'arv_ev_aband_espec',\n  'arv_aut_aband_espec',\n  'arv_aut_aband_autoss',\n  'arv_ev_gener_espec',\n  'arv_ev_nvo_explic_valor_tx_espec',\n  'arv_aut_nvo_explic_valor_espec',\n  'emp1_dia_das_maes_credito_pre_aprovado'\n]\n\nfunction run(broadcastOrigem) {\n  try {\n    const irBroadcast = broadcast.some(item => item === broadcastOrigem)\n    return irBroadcast\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["contact.extras.broadcastOrigem"],"outputVariable":"irAtendimentoHumano","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f0eab05c-188d-4f3e-94cf-6809e0895611","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"const destinations = {\n\tnew_age_acesse_uso: 'link new age',\n\tboas_vindas_mbj_ibj_v2: 'Link  boas vindas mbj ibj',\n\tlink_rentabilizacao: 'Link de Pagamento',\n\tlink_vestuario: 'Link de Pagamento',\n\tlink_turismo: 'Link de Pagamento',\n\tlink_prospeccao: 'Link de Pagamento',\n\tlink_onboarding_d10: 'Link de Pagamento',\n\tlink_onboarding_d5_: 'Link de Pagamento',\n\tlink_onboarding_d2_copia: 'Link de Pagamento',\n\treativacao_emp1: 'Api horario atendimento',\n\treativacao_emp1_v2: 'Api horario atendimento',\n\tboas_vindas_resumo: 'Api horario atendimento',\n\tantecipacao_black_november: 'main',\n\tantecipacao_pos_black_november: 'main',\n\tseguro_empresarial_emp1: 'main',\n\tgiro_fimdeano_emp: 'main',\n\tlink_pagamento_fimdeano: 'main',\n\tantecipacao_fimdeano: 'main',\n\tcartoes_credito_ativo_0505: 'main',\n\tlink_queda60d_img: 'main',\n\tarvbau_cliente_com_avulsa_ano_geren_atualizado: 'Finalização broadcast Arv',\n\tarvbau_cliente_cancelou_automatica_geren_atualizado: 'Finalização broadcast Arv',\n\tarvbau_cliente_possui_dquinze_dtrinta_geren_atualizados: 'Finalização broadcast Arv',\n\tarvbau_cliente_nunca_antecipou_geren_atualizado: 'Finalização broadcast Arv',\n\tarv_automatico_contratacao_abandono_1: 'Finalização broadcast Arv',\n\tarv_automatico_contratacao_abandono_2: 'Finalização broadcast Arv',\n\tarv_automatico_contratacao_abandono_3: 'Finalização broadcast Arv',\n\tarv_eventual_contratacao_abandono_1: 'Finalização broadcast Arv',\n\tarv_eventual_contratacao_abandono_2: 'Finalização broadcast Arv',\n\ttaxa_esp_arv_emp1_at_1809: 'Finalização broadcast Arv',\n\ttaxa_esp_arv_emp1_in_1809: 'Finalização broadcast Arv',\n\tarv_aut_nvo_explic_valor_espec: 'Finalização broadcast Arv',\n\tarv_ev_nvo_explic_valor_tx_espec: 'Finalização broadcast Arv',\n\tarv_ev_gener_espec: 'Finalização broadcast Arv',\n\tarv_aut_aband_espec: 'Finalização broadcast Arv',\n\tarv_ev_aband_espec: 'Finalização broadcast Arv',\n\tum_cred_nacessou15d_oferta_014: 'main',\n\ttomador_credito_104: 'main',\n\tcredito_novo_modelo_frase_curta_104: 'main',\n\tcredito_n_acessou_novomodelo_oferta_104: 'main',\n\tcredito_n_acessou_novomodelo_104: 'main',\n\tum_cred_nacessou15d_014: 'main',\n\tpdd_chemp_ad_30d_1904: 'main',\n\tpdd_chemp_ad_60d_1904_atualizado: 'main',\n\tcred1_nacessou15d_oferta_1904: 'main',\n\tcredito_n_acessou_nvomodelo_oferta_1904: 'main',\n\treneg_abandono_3: 'main',\n\treneg_abandono_2: 'main',\n\treneg_abandono_1: 'main',\n\tgirocartoes_contratacao_abandono_3: 'main',\n\tgirocartoes_contratacao_abandono_2: 'main',\n\tgirocartoes_contratacao_abandono_1: 'main',\n\tgirocartoes_contratacao_abandono_4: 'main',\n\tgirocartoes_contratacao_abandono_5: 'main',\n\tgirocartoes_contratacao_abandono_6: 'main',\n\tpdd_giro_60d_1904_v1: 'main',\n\tpdd_giro_7d_3103_v1: 'main',\n\tpdd_giro_30d_1904_v4: 'main',\n\tcredito_fgi_30_06: 'main',\n\tcredito_fgi_05_07: 'main',\n\treativacao_emp1: 'main',\n\toferta_arv_v2: 'main',\n\tgenerico_v2: 'main',\n\treceptivo_v2: 'main',\n\toferta_giro_v2: 'main',\n\toferta_cartao_v2: 'main',\n\toferta_cobranca_v2: 'main',\n\toferta_renegociacao_v2: 'main',\n\tbusiness_apresentacao_gerente: 'main',\n\tmutirao_vencidos_golden_month: 'main',\n\tboas_vindas_resumo: 'main',\n\tbusiness_oferta_cobranca: 'main',\n\tbusiness_oferta_arv: 'main',\n\tbusiness_oferta_renegociacao: 'main',\n\tbusiness_oferta_giro: 'main',\n\tbusiness_apresentacao_gerentes: 'main',\n\tbusiness_generico: 'main',\n\tpesquisa_pix_emp: 'Link Pesquisa Pix',\n\tmain: 'main'\n}\n\nconst blockId = {\n\t'link new age': 'ac8d762b-d392-45db-9e20-84724d9d3da7',\n\t'Link  boas vindas mbj ibj': 'd4beee17-fca9-4e41-a016-ea05948c5598',\n\t'Link de Pagamento': '0e11155a-b0de-46f6-a922-b8cbec51b62f',\n\t'Api horario atendimento': '5ffd35a8-bdac-49e1-a44f-a8709c5fcffe',\n\t'main': '3093d31e-963d-4bd8-a2f9-7135a8a8f8f6',\n\t'Finalização broadcast Arv': '698dee4c-6a3d-4aee-bed0-0f5210864d2b',\n\t'Link Pesquisa Pix': 'a0438f36-f75b-4b4a-ab65-a95eefb35fa3'\n}\n\nfunction run(userInput) {\n\ttry {\n\t\tconst destination = destinations[userInput]\n\t\tif (destination) {\n\t\t\tconst id = blockId[destination]\n\t\t\tif (id) {\n\t\t\t\treturn id\n\t\t\t}\n\t\t}\n\t\treturn '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef'\n\t} catch (err) {\n\t\treturn '5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef'\n\t}\n}","inputVariables":["userInput"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"irAtendimentoHumano"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bae52d25-aa99-4b6c-9b9b-59e98e637fcf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","$title":"[BC.0.0.0] Identifica broadcast","$position":{"top":"305px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ac8d762b-d392-45db-9e20-84724d9d3da7":{"$contentActions":[{"action":{"$id":"ba95aa24-50ed-4f36-af04-50070981808c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0cab8392-c202-4a26-86e6-df3f9db3f7a7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9035fe13-9fac-4df5-946f-62ea350bc2aa","$typeOfContent":"text","type":"SendMessage","settings":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"37f1242b-85b7-49c4-9409-d7b1de484320","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b21dda4-37cb-41cd-b52a-d020a742f2db","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"804c253e-be9f-42d4-bf03-18f3313fa15e","$typeOfContent":"","type":"TrackEvent","$title":"count_new_age_acesse_uso","$invalid":false,"settings":{"extras":{},"category":"count_new_age_acesse_uso","action":"1"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f75ea880-6b85-4724-89ef-af9d80df7c0a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c91a9047-8101-4551-9e73-25f94c234aca","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ac8d762b-d392-45db-9e20-84724d9d3da7","root":false,"$title":"[BC.1.0.0] Link New age","$position":{"top":"480.471px","left":"1418.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d4beee17-fca9-4e41-a016-ea05948c5598":{"$contentActions":[{"action":{"$id":"386b1f70-6cc5-461e-ae9a-7effc58f3836","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae70c426-2181-4530-b690-f252af7737f8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d9d8d36e-8d7a-46cf-ae50-5e21ee246f57","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf","metadata":{}},"$cardContent":{"document":{"id":"f2f1b1d3-bd59-4f2d-bf8a-bed21d09bb58","type":"text/plain","content":"https://www.safra.com.br/external-files/canais-pj/pdf/FuncionalidadesSafraEmpresas.pdf"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b54106c5-7c67-4690-95b9-857b0c52da99","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-c3a04c4f-ec2a-4429-9896-ec9dc344c75d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d4beee17-fca9-4e41-a016-ea05948c5598","root":false,"$title":"[BC.2.0.0] Link  boas vindas mbj ibj","$position":{"top":"467.429px","left":"1620.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"0e11155a-b0de-46f6-a922-b8cbec51b62f":{"$contentActions":[{"action":{"$id":"c52dae31-e901-44e6-80b6-b7b339c58157","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"033c4551-14be-4bbb-bfe1-012ee999e44e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d22a1258-a613-4835-a1ad-a085074bd3b7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w","metadata":{}},"$cardContent":{"document":{"id":"527886fa-9ad5-4064-8344-c2dbeedde64b","type":"text/plain","content":"http://onelink.to/j9cy8w"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ca329296-0b20-4782-8f21-6a717c7b38f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-550ff24b-a134-4adf-b315-0dc1574be77a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e11155a-b0de-46f6-a922-b8cbec51b62f","root":false,"$title":"[BC.3.0.0] Link de Pagamento","$position":{"top":"482.412px","left":"1842.53px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2326fdc6-1097-4ee3-8f29-4887cad6a036","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","typeOfStateId":"state","$connId":"con_23","$id":"f119e366-afab-407d-b15d-8ee3743b53fa","conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}],"$invalid":false},{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_28","$id":"285abc84-9314-4a9d-b08f-e74bde3e52e5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6837107-5f2d-41fe-a3d3-3e99a51331c9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3be2c783-fca5-440d-8f3c-f8eece073c35","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"023446de-0356-4af2-9e57-990b44f42e47","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"7417ed68-f1cc-4bd6-8a98-0728d05baf04","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ce083581-0288-455f-be73-7b4eebe2b0f3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-27af728f-7563-4f86-900c-7a94804dcd7b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5ffd35a8-bdac-49e1-a44f-a8709c5fcffe","root":false,"$title":"[BC.4.0.0] Atendimento humano","$position":{"top":"606.588px","left":"964.529px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e6db4fe9-f1a4-4c40-8925-f588c3122da0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3093d31e-963d-4bd8-a2f9-7135a8a8f8f6","root":false,"$title":"[BC.5.0.0] Redirect to Main","$position":{"top":"644.143px","left":"1414px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"698dee4c-6a3d-4aee-bed0-0f5210864d2b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"391edfeb-b8b2-4401-93f1-1e037f271fa4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"698dee4c-6a3d-4aee-bed0-0f5210864d2b","root":false,"$title":"[BC.6.0.0] Redirect to Finalização","$position":{"top":"633.714px","left":"1617.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a0438f36-f75b-4b4a-ab65-a95eefb35fa3":{"$contentActions":[{"action":{"$id":"ab4e8746-8a43-47df-8b0e-a5d5d5cd8b95","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4edfb32d-160e-47ec-82ee-b92613f7893f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"43ae4c63-ecf8-4c6b-89fd-f3294442b8c7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ","metadata":{}},"$cardContent":{"document":{"id":"0fc150dc-d7c2-42c2-9dd4-377a7b75f4cc","type":"text/plain","content":"https://app.mindminers.com/r/CZHRRHZ"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"333ee957-11c8-4bbd-a568-14ce2577d555","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-b2e83968-556a-4a57-b18f-6bed5739f102","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a0438f36-f75b-4b4a-ab65-a95eefb35fa3","root":false,"$title":"[BC.7.0.0] Link Pesquisa Pix","$position":{"top":"632px","left":"1832px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3a444e45-6a85-4590-943d-2d4adda80f88","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-81a0aa05-e5dd-4e49-9ce2-1a96093baa4b","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5c9e2bde-c50b-4a0f-9c3b-b1dfb42345ef","root":false,"$title":"[Redirect] to Main (welcome)","$position":{"top":"198px","left":"1316.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"449e71de-a279-4ed5-9d44-33d273412a70":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ac4f9e21-bac5-4acf-b14b-c842714f899e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e768d5a7-d8df-422c-9b1c-2601af676667","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"449e71de-a279-4ed5-9d44-33d273412a70","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"1268.12px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1":{"$contentActions":[{"action":{"$id":"1157f573-7664-44aa-9813-8ffcefc8e7a1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee4110ac-40ed-402c-86c5-7a34e451b69e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c0c436f9-1b47-4bb5-b460-c9b45c94b3ae","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento","metadata":{}},"$cardContent":{"document":{"id":"ea1165c4-61b7-4152-ba55-f6aea7837153","type":"text/plain","content":"Não encontramos este seu telefone no cadastro. Digite seu CNPJ com 14 dígitos para prosseguir o atendimento"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"809b569a-8f0e-4d3e-9823-aae35e2b21e0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"084d96a0-2b8c-481f-adfe-d1183cc13012","typeOfStateId":"state","$connId":"con_33","$id":"356ea3cf-f9b6-4306-9ff7-79057fba7002","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-868e16ae-6e85-4ffe-bebb-16aaea7c6cc6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"784e6abb-da1a-4d29-a1e9-a4bddb44e5b1","root":false,"$title":"[BC.4.1.0][MSG] Solicita CNPJ","$position":{"top":"619px","left":"693.176px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"084d96a0-2b8c-481f-adfe-d1183cc13012":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"6d518eb2-7541-4052-807c-590d1bf1daeb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","typeOfStateId":"state","$connId":"con_38","$id":"49eef362-cb6c-4e18-9be4-358351b14285","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"fadba59a-75b1-42e1-b0fa-f3f9eed4dd94","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(documento) {\n\tif (!documento) {\n\t\treturn 'inatividade'\n\t}\n\tdocumento = String(documento).replace(/\\D/g, '');\n\treturn verifyDoc(documento)\n}\nfunction verifyDoc(cnpj) {\n\tif (!cnpj || cnpj.length != 14\n\t\t|| cnpj == \"00000000000000\"\n\t\t|| cnpj == \"11111111111111\"\n\t\t|| cnpj == \"22222222222222\"\n\t\t|| cnpj == \"33333333333333\"\n\t\t|| cnpj == \"44444444444444\"\n\t\t|| cnpj == \"55555555555555\"\n\t\t|| cnpj == \"66666666666666\"\n\t\t|| cnpj == \"77777777777777\"\n\t\t|| cnpj == \"88888888888888\"\n\t\t|| cnpj == \"99999999999999\")\n\t\treturn 'input inesperado'\n\tvar tamanho = cnpj.length - 2\n\tvar numeros = cnpj.substring(0, tamanho)\n\tvar digitos = cnpj.substring(tamanho)\n\tvar soma = 0\n\tvar pos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tvar resultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(0)) return 'input inesperado';\n\ttamanho = tamanho + 1\n\tnumeros = cnpj.substring(0, tamanho)\n\tsoma = 0\n\tpos = tamanho - 7\n\tfor (var i = tamanho; i >= 1; i--) {\n\t\tsoma += numeros.charAt(tamanho - i) * pos--\n\t\tif (pos < 2) pos = 9\n\t}\n\tresultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n\tif (resultado != digitos.charAt(1)) return 'input inesperado'\n\treturn cnpj;\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5409cfb2-5097-429c-a723-a98905683b11","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"cnpj\"","$invalid":false,"settings":{"value":"cnpj","variable":"exceptionType"},"conditions":[{"values":[],"source":"input","comparison":"exists"},{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-be9e3b4d-5463-448a-93c1-58992f4f00e4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3814bfff-a172-48b3-84c5-ff03fe60ad11","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4aef394b-aef3-48de-8a66-857f3f1123e3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"084d96a0-2b8c-481f-adfe-d1183cc13012","root":false,"$title":"[BC.4.1.0][INPUT] Solicita CNPJ","$position":{"top":"836.529px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed7b8709-622d-4d93-8f2c-1a2d37438a8b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8bea427a-b6e1-42d3-8844-958d7292ad16","typeOfStateId":"state","$connId":"con_43","$id":"15b3d251-e293-4c08-b5b8-2925bda572ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7cacb353-36e0-4d85-b635-f21e527d6b29","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"fcd1cbac-87a0-416d-b975-33ed425eaa1b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" - 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{userInput}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8ecbd9ea-ff18-4bbf-8eae-41e381164aed","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"4900f512-c41e-4bf0-bd40-fb5bf4bfbb45","root":false,"$title":"[BC.4.2.0] Verifica carterização por CNPJ","$position":{"top":"1046.12px","left":"693px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8bea427a-b6e1-42d3-8844-958d7292ad16":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de40fb96-d81d-4d58-9486-f72ffb4ddfc0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"449e71de-a279-4ed5-9d44-33d273412a70","typeOfStateId":"state","$connId":"con_48","$id":"82ace0f2-c6f9-4628-a062-0a8cba05582f","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"contaSelecionada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1d423e8d-45d5-4a3d-b22d-348b756acc43","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyAccountManager) {\n\ttry {\n\t\tconst selecionada = {}\n\t\tconst { id, sigla, codigoSegmento } = JSON.parse(bodyAccountManager).data\n\t\tselecionada['filaGerente'] = sigla || id\n\t\tif (Number(codigoSegmento) === 17) {\n\t\t\tselecionada['segmentoGerente'] = 'emp2'\n\t\t}\n\t\tif (Number(codigoSegmento) === 20) {\n\t\t\tselecionada['segmentoGerente'] = 'emp1'\n\t\t}\n\t\tif (!selecionada.segmentoGerente) {\n\t\t\treturn false\n\t\t}\n\t\treturn selecionada\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyAccountManager"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-06991d0c-801d-475e-acbb-e7a0518cf1c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"8bea427a-b6e1-42d3-8844-958d7292ad16","root":false,"$title":"[BC.4.3.0] Monta variavel contaSelecionada","$position":{"top":"1046.18px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2936feee-9a8c-488a-b210-940e102e6a53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-24c6f034-1d6a-418f-a3fc-9d3880c02060","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2936feee-9a8c-488a-b210-940e102e6a53","root":false,"$title":"[Redirect] To cascata","$position":{"top":"48.8824px","left":"1574.18px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8c5a211-679d-47ae-8715-d7c308e2d5f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"05345c8a-016c-4c19-8b72-c95a34dace8c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'fb94c3f1-88bc-4b44-b4f4-43dd60bce494',//sem pesquisa\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"992c7809-0f1c-4c64-8dc1-20b019ada067","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fe91af06-0845-40e8-b9d3-a53c90577192","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-85a2e3b9-e25e-4983-9657-b0fb3684f454","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"430460cd-7e3d-4b0a-ba61-e2f6a2da38f7","root":false,"$title":"[Redirect] to Finalizacao (finalizado)","$position":{"top":"195.429px","left":"1572.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E. South America Standard Time"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false}}