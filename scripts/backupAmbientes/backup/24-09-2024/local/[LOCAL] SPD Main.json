{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"765dc076-b87b-40d4-a571-f64fa62e7341","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"0e4a3f84-4473-4985-a879-6efe1da438a4","conditions":[{"values":["false"],"source":"context","variable":"blockDestinationId","comparison":"notEquals"}],"$invalid":false},{"stateId":"3e06cd93-6019-4a34-8468-b364f7ec47e9","typeOfStateId":"state","$connId":"con_3","$id":"a4b61067-650f-40f5-b8fb-a4084131f605","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.broadcastOrigem"},{"values":["-"],"source":"context","comparison":"notEquals","variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"3e06cd93-6019-4a34-8468-b364f7ec47e9","typeOfStateId":"state","$connId":"con_8","$id":"652e169d-bccc-45ef-8336-f2610167826b","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"veioDeOutroNumero"},{"values":["finalizacao"],"source":"context","comparison":"equals","variable":"state@botOrigin"}],"$invalid":false},{"stateId":"3e06cd93-6019-4a34-8468-b364f7ec47e9","typeOfStateId":"state","$connId":"con_13","$id":"905c1d87-384e-4f1d-82c6-389046a059da","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"veioDeOutroNumero"},{"values":["WhatsApp PJ"],"source":"context","comparison":"equals","variable":"state@botOrigin"}],"$invalid":false},{"stateId":"a8d2f811-ac89-4e91-9b16-c93b4b661447","typeOfStateId":"state","$connId":"con_18","$id":"d7da0159-8b49-4eda-858f-06339a90237e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8c8cd4d0-da09-4045-8009-266626552731","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName, estabelecimentoPf) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\tif (estabelecimentoPf != 'false' && stateDestination == '30e39880-1d2a-439a-a0ed-1e7210966286') {\n\t\t\t\treturn 'a5ddf643-13c0-4a81-a174-e1aa9dd86873'\n\t\t\t}\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName","estabelecimentoPf"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f13d7473-79a6-48ac-a970-e65229fecfab","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4cd8ebc5-f611-4575-9219-76a2939e64e4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-65d86a40-56d6-48c0-ac3e-98b4e1a9d851","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"10px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bd18d48b-197a-4546-900b-5bd5cf12f99b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","typeOfStateId":"state","$connId":"con_23","$id":"41b772e3-09eb-4036-a1bf-83b66dc726fc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"18c6e28f-a1ec-41b6-89c8-4fbf15c2b8fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3596008-01fa-4e08-88d5-bf813e8b57d4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-02490636-219e-42ed-bd4b-348b89895901","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"17px","left":"407px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"4bd87cdf-8b20-4797-a08c-9eaa81374421","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá, tudo bem?\n\nPor aqui, posso te ajudar com consultas e serviços relacionados a sua empresa.\n\n<i>A qualquer momento, digite <b>voltar</b> para retornar uma etapa ou <b>sair</b> para finalizar.</i>","metadata":{}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá, tudo bem?\n\nPor aqui, posso te ajudar com consultas e serviços relacionados a sua empresa.\n\n<i>A qualquer momento, digite <b>voltar</b> para retornar uma etapa ou <b>sair</b> para finalizar.</i>"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false,"$$hashKey":"object:1440"},{"action":{"$id":"7041049f-fd4e-459b-bb19-e47d71e9580e","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false,"$$hashKey":"object:1441"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"314dd865-7fe1-4276-af20-5567014eb6a7","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1442"}],"$conditionOutputs":[{"stateId":"7e068d62-af04-4916-a1ff-eb223d8dcb99","typeOfStateId":"state","$connId":"con_28","$id":"f403b145-fa9f-499a-9342-b138d5c11025","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1464"}],"$invalid":false,"$$hashKey":"object:1454"}],"$enteringCustomActions":[{"$id":"7f373a4d-0201-4c29-8e9a-5f151816d10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"fe319907-8b8e-446d-9bed-4223996dd5cf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fcbf5dea-5071-4b71-883f-ceb7cc0ddec2","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"9050bf5d-13ad-4128-b393-23a5def318ca","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1154d2fc-4cb3-4982-83c8-399486742aef","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main input inicial\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main boas vindas input inicial","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"82c18de3-a766-4dac-ad75-28f3c2c10b4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlToken}}/api/oauth/token | {{encodingUrl}} | {{statusToken}} | {{bodyToken}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]},{"$id":"b6a984a0-1088-4a1a-b28a-83fca747ba6f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"consolidado api request\"","$invalid":false,"settings":{"extras":{"contaSelecionada":"{{contaSelecionada}}","idSessao":"{{idSessao}}","identity":"{{contact.identity}}"},"category":"consolidado api request","action":"{{config.urlToken}}/api/oauth/token | {{statusToken}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f54f2c01-dec2-4ff0-b617-a1409d5c7221","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-93848721-2f34-4aa9-83e5-03fee2b6b10c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-475a8892-91a6-4c95-9b9c-27bb90a0ad9b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-05cc3cbf-60b9-405e-9d54-88d56239a1c7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"welcome","$title":"[M.1.0.0][MSG][HTTP] Boas vindas","$position":{"top":"326px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7e068d62-af04-4916-a1ff-eb223d8dcb99":{"$contentActions":[{"action":{"$id":"de77b127-178b-4dad-bdc1-7f7468a7591f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Para seguir com seu atendimento, você pode informar seu CPF?\n\nLembre-se: digite apenas os 11 dígitos, sem traços e pontos, como no exemplo: 99999999999.","metadata":{}},"$cardContent":{"document":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Para seguir com seu atendimento, você pode informar seu CPF?\n\nLembre-se: digite apenas os 11 dígitos, sem traços e pontos, como no exemplo: 99999999999."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1093"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32fafead-1ba1-4524-94bb-6913efeee86c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1094"}],"$conditionOutputs":[{"stateId":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","typeOfStateId":"state","$connId":"con_33","$id":"417421c1-8ac6-48ad-bb1f-b9d634898dc4","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1112"}],"$invalid":false,"$$hashKey":"object:1098"}],"$enteringCustomActions":[{"$id":"2adb915b-9570-4bb6-940a-9908820ad6f7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd3a2872-5c03-4823-8c25-5facff22f3df","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e53f86df-22d0-4445-8c3e-2200da7faa08","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7e068d62-af04-4916-a1ff-eb223d8dcb99","root":false,"$title":"[M.2.0.0][MSG] Solicita CPF","$position":{"top":"505px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75b55cb8-4764-479d-b17d-48776ccc45c9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"05944f68-1d49-4a49-9782-622dee31cc95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2933b32-696b-4532-b156-6022f8920fa9","typeOfStateId":"state","$connId":"con_38","$id":"6dd06b3f-39e7-44d9-ac8d-574696ee3d78","conditions":[{"values":["0"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":["unauthorized"],"source":"context","comparison":"notEquals","variable":"apiStatus"}],"$invalid":false},{"stateId":"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c","typeOfStateId":"state","$connId":"con_43","$id":"c8051bdc-1fcd-46fe-8b0d-6232681d6d3c","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}],"$invalid":false},{"stateId":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","typeOfStateId":"state","$connId":"con_48","$id":"b064be9b-d3c5-4a7c-b43c-ce5864fa1f62","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarContas@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fc784833-8d2f-4e3c-a9f6-a29e08d7b490","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyContas\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"CHT"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/usuarios/{{contact.extras.cpf}}/shortnames?expand=contas","responseStatusVariable":"statusContas","responseBodyVariable":"bodyContas"},"conditions":[]},{"$id":"cb7e2bdc-f341-44e7-9c67-eb82c80317a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyContas) {\n\ttry {\n\t\tconst contas = JSON.parse(bodyContas).data;\n\t\tlet arrContas = []\n\t\tlet totalLoops = 0;\n\n\t\tfor (let index = 0; index < contas.length; index++) {\n\t\t\tif (totalLoops > 100) break;\n\t\t\tfor (let indexB = 0; indexB < contas[index].contas.length; indexB++) {\n\t\t\t\tif (totalLoops > 100) break;\n\t\t\t\tconst novaConta = contas[index].contas[indexB];\n\t\t\t\tnovaConta.canal = contas[index].canal\n\t\t\t\tnovaConta.shortname = contas[index].shortname;\n\t\t\t\tnovaConta.usuario = contas[index].id\n\t\t\t\tnovaConta.codigoSegmento = contas[index].codigoSegmento\n\t\t\t\tnovaConta.nivel = contas[index].nivel\n\t\t\t\tarrContas.push(novaConta)\n\t\t\t\ttotalLoops++;\n\t\t\t}\n\t\t\ttotalLoops++;\n\t\t}\n\t\treturn {\n\t\t\tquantidadeContas: arrContas.length,\n\t\t\tcontas: arrContas\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tquantidadeContas: 0,\n\t\t\tcontas: [],\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["bodyContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cab7169-21a8-41aa-aa30-5a74ceb7ddc4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"SPD Main {state.name} quantidade de contas\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} quantidade de contas","action":"{{contas@quantidadeContas}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contas@quantidadeContas"}]},{"$id":"fe38dc09-941f-4136-bcf0-a84d2114fcd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(data) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\treturn contas[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contas"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"}]},{"$id":"15fcf271-3186-45b1-89b2-c4f954b7e5e3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusContas"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"de1c5968-7160-4dfd-9b03-cf94d6d31aae","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarContas\"","$invalid":false,"settings":{"function":"run","source":"const replaceAt = (string, index, replacement) => {\n\treturn string.substr(0, index) + replacement + string.substr(index + replacement.length);\n};\n\nfunction list(contas) {\n\ttry {\n\t\tconst buttons = contas.map((conta, index) => {\n\t\t\treturn {\n\t\t\t\tid: `${conta.agencia}-${conta.conta}`,\n\t\t\t\ttitle: `CC ${replaceAt(conta.conta, 2, \"XXXX\")}`,\n\t\t\t\tdescription: `AG ${replaceAt(conta.agencia, 1, \"XXX\")}`\n\t\t\t}\n\t\t})\n\n\t\tconst mainText = `Qual delas você quer usar no atendimento?`;\n\t\tconst buttonTitle = \"Selecionar conta\";\n\t\tconst headerText = \"Selecionar conta\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": mainText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": buttonTitle,\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": headerText,\n\t\t\t\t\t\t\t\"rows\": buttons\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction message(contas) {\n\tlet textoContas = 'Qual delas você quer usar no atendimento?\\n\\nÉ só informar o número da opção, exemplo: *1*.\\n\\n'\n\tcontas.slice(0, 100)\n\t\t.forEach((conta, index) => textoContas += `${index + 1} - *CC ${replaceAt(conta.conta, 2, \"XXXX\")}*\\nAG ${replaceAt(conta.agencia, 1, \"XXX\")}\\n\\n`)\n\n\n\treturn {\n\t\t\"type\": \"text\",\n\t\t\"text\": {\n\t\t\t\"body\": textoContas\n\t\t}\n\t}\n}\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { contas, quantidadeContas } = JSON.parse(data)\n\t\tif (quantidadeContas <= 10) {\n\t\t\treturn list(contas)\n\t\t}\n\t\treturn message(contas)\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["contas","state.name","idSessao"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarContas"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"}]},{"$id":"fd849d5e-7996-4de5-8ac4-92f1f18d707d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarContas@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarContas@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarContas@tracking"}]},{"$id":"ac7d3117-f8b5-4b22-b4fb-94bdccb70f82","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"1d578318-ae43-44ca-9716-3d5722d4af8f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}} | GET | {{statusContas}} | {{bodyContas}}"},"conditions":[]},{"$id":"468f39e5-6676-4a8e-9b6d-40c5e3bb6f65","$typeOfContent":"","type":"TrackEvent","$title":"Track \"consolidado api request\"","$invalid":false,"settings":{"extras":{"contaSelecionada":"{{contaSelecionada}}","idSessao":"{{idSessao}}","identity":"{{contact.identity}}"},"category":"consolidado api request","action":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/usuarios/contact.extras.cpf/shortnames?expand=contas"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5448813e-3297-4ebe-bdfb-6102e98225c2","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-fe483f38-d04d-47ff-80de-5df612004782","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-34da2238-88a3-4b68-b8b1-dee48758e8ea","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"75b55cb8-4764-479d-b17d-48776ccc45c9","root":false,"$title":"[M.3.0.0][MSG][HTTP] Verifica contas","$position":{"top":"895px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ccd3d0b-0b52-4fef-9461-3b688137f8dd":{"$contentActions":[{"action":{"$id":"374038be-f767-4a89-8d8a-cb51e9cbf56f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b8574143-8a45-453a-b110-0ae1b90fc79b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b8574143-8a45-453a-b110-0ae1b90fc79b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a031c8a2-66f8-4092-94a6-4772e31f1d94","$typeOfContent":"text","type":"SendMessage","settings":{"id":"442323ab-7072-49e4-a927-ac635ff3cff5","type":"text/plain","content":"Vi que você tem mais de uma conta. ","metadata":{}},"$cardContent":{"document":{"id":"442323ab-7072-49e4-a927-ac635ff3cff5","type":"text/plain","content":"Vi que você tem mais de uma conta. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f9de5588-4c98-4faa-ada8-019c06e7fc32","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e7734109-4904-40d2-819c-23cc953fa1c4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e7734109-4904-40d2-819c-23cc953fa1c4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"acda8767-b3ee-4ffd-bb4f-fbfedf42bfaf","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{exibeSelecionarContas}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"83ae0e89-15eb-4001-8dd9-6073bb965b59","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","typeOfStateId":"state","$connId":"con_53","$id":"60fa561d-5338-454d-a2cd-641f936ca51e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48c846c9-dbf9-4efc-91ed-56921dc4595e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b49d8441-2e89-4eb7-83a9-f46680334a9c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c59a600d-075b-4bd7-97e3-df88fcde1ec3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","root":false,"$title":"[M.3.1.0][MSG]Seleciona conta","$position":{"top":"1118px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"775e2746-a52f-48d0-9442-e17cd0c2fd82":{"$contentActions":[{"action":{"$id":"54831eb1-0ba8-4a8b-a6fe-37725d2e0c25","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d506add8-6da2-44d4-90d7-ceb4e7bdf17e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Vi que você ainda não é nosso cliente.\n\nVou te direcionar para quem pode te ajudar.","metadata":{}},"$cardContent":{"document":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Vi que você ainda não é nosso cliente.\n\nVou te direcionar para quem pode te ajudar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6a40c5ea-eb78-4056-8d3f-f4890e27497c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c","typeOfStateId":"state","$connId":"con_58","$id":"0c22bedb-8fff-4b14-8e4c-d722fb022b44","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a2e0fc43-30c6-4423-958d-6a9c1f2035d5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"6762adcf-fc02-40d1-822c-37f0b1c1da82","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\"","$invalid":false,"settings":{"variable":"naoCliente","value":"true"},"conditions":[]},{"$id":"6778deb8-1dd7-4c71-a461-b4000734658e","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":""},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a74e730f-6670-4427-a71b-a26f530e3ccf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-822db344-16ad-469b-a654-3529967b3483","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ea05a02b-23ab-4a0a-ad28-e2bf24ba8bc4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"775e2746-a52f-48d0-9442-e17cd0c2fd82","root":false,"$title":"[M.3.0.1][MSG] Transbordo cliente não identificado","$position":{"top":"1234px","left":"280px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"7b5bce4a-368f-48ac-8c8a-171e31e5b096":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fde8a193-6fdc-4490-bbf2-a99a74582176","typeOfStateId":"state","$connId":"con_63","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"fde8a193-6fdc-4490-bbf2-a99a74582176","typeOfStateId":"state","$connId":"con_68","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"e8bdb0c9-7ac2-4d33-b754-0ce2d7b91015","typeOfStateId":"state","$connId":"con_73","$id":"1e648c35-d98e-42c6-8516-d47c47cc377a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4afea420-704b-4f88-bc62-056d81224ff3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyDadosConta\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusDadosConta","responseBodyVariable":"bodyDadosConta"},"conditions":[]},{"$id":"0b6ff513-c46d-4619-b433-dc17203974a9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyUsuarios\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios","responseStatusVariable":"statusUsuarios","responseBodyVariable":"bodyUsuarios"},"conditions":[]},{"$id":"cb9f0cf9-050b-49e7-a0ca-4cad3e0181fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada, bodyDadosConta, bodyUsuarios, cpf) {\n\ttry {\n\n\t\tconst { tipoPessoa, baseDocumento, filialCnpj, digitoCpf, nome } = JSON.parse(bodyDadosConta).data\n\t\tconst conta = JSON.parse(contaSelecionada)\n\t\tconst parsedBodyUsuarios = JSON.parse(bodyUsuarios).data\n\n\t\tconta['nomeEmpresa'] = nome\n\t\tconta['tipoPessoa'] = tipoPessoa\n\t\tconta['doc'] = cpf\n\t\tif (conta.usuario) {\n\t\t\tconta['usuario'] = conta.usuario.trim()\n\t\t}\n\t\tif (tipoPessoa === 'PJ') {\n\t\t\tconta['tipoPessoaCode'] = \"J\"\n\t\t\tlet doc = baseDocumento + \"000\" + filialCnpj\n\t\t\tlet digito = digitoCpf\n\t\t\tif (digitoCpf < 10) {\n\t\t\t\tdigito = \"0\" + digitoCpf\n\t\t\t}\n\t\t\tconta['doc'] = baseDocumento + \"000\" + filialCnpj + digito\n\t\t\twhile (conta['doc'].length < 14) {\n\t\t\t\tconta['doc'] = `0${conta['doc']}`\n\t\t\t}\n\t\t}\n\t\tif (tipoPessoa === 'PF') {\n\t\t\tconta['tipoPessoaCode'] = \"F\"\n\t\t}\n\t\tif (parsedBodyUsuarios.length > 0) {\n\t\t\tlet primeiroNome = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome.split(' ')[0].toLowerCase()\n\t\t\tprimeiroNome = primeiroNome[0].toUpperCase() + primeiroNome.slice(1)\n\t\t\tconta['nomeCompleto'] = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome\n\t\t\tconta['primeiroNome'] = primeiroNome\n\t\t} else {\n\t\t\tconta['nomeCompleto'] = ''\n\t\t\tconta['primeiroNome'] = ''\n\t\t}\n\t\treturn conta\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\tcontaSelecionada\n\t\t}\n\t}\n}","inputVariables":["contaSelecionada","bodyDadosConta","bodyUsuarios","contact.extras.cpf"],"LocalTimeZoneEnabled":false,"outputVariable":"contaSelecionada"},"conditions":[]},{"$id":"068dbd3d-971c-4d11-b2f7-f05cb07c2169","$typeOfContent":"","type":"MergeContact","$title":"Set \"contactName\"","$invalid":false,"settings":{"extras":{},"name":"{{contaSelecionada@nomeCompleto}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@nomeCompleto"}]},{"$id":"ad6ae249-8b81-4b5e-93fa-74c1ab9dd3a4","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyEC\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/estabelecimentos?cpfCnpj={{contaSelecionada@doc}}","responseStatusVariable":"statusEC","responseBodyVariable":"bodyEC"},"conditions":[]},{"$id":"b9ed4fe7-ce29-4729-887d-06be26d85470","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ecList\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tconst ecs = JSON.parse(data).data;\n\t\tconst ecList = ecs.filter((ec) => ec.indSitEC === 'A')\n\t\treturn {\n\t\t\tecList,\n\t\t\tecQuantity: ecList.length,\n\t\t\tallecQuantity:ecs.length\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyEC"],"outputVariable":"ecList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dde995d3-a23f-4103-9da6-45fd22ade501","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} quantidade ec\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{ecList@ecQuantity}}","category":"SPD Main {{state.name}} quantidade ec"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ecList@ecQuantity"}]},{"$id":"fcc19fae-2b77-4513-b177-9904e8917360","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selectedEc\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ecList) {\n\ttry {\n\t\tif(JSON.parse(ecList).ecQuantity != 1) {\n\t\t\treturn ''\n\t\t}\n\t\tconst ec = JSON.parse(ecList).ecList[0]\n\t\treturn ec\n\t} catch (err) {\n\t\treturn ''\n\t}\n}","inputVariables":["ecList"],"outputVariable":"selectedEc","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f0e851b-7a56-468d-bd87-ba103ff23ccd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDadosConta","statusUsuarios","statusEC"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7755e648-2c4a-47d9-842a-ef9e24d718a6","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusDadosConta}} | {{bodyDadosConta}}"},"conditions":[]},{"$id":"8abc6e92-2865-41ef-a6a5-d48d09e6f445","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios | GET | {{statusUsuarios}} | {{bodyUsuarios}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d82cc8cc-3a78-4839-bc94-57ff631f6514","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"7057224c-9e8c-4d86-8160-810ca6c47bc9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarEc\"","$invalid":false,"settings":{"function":"run","source":"function list(listaEc) {\n\ttry {\n\t\tconst buttons = listaEc.map((ec) => {\n\t\t\treturn {\n\t\t\t\tid: `${ec.codigoEc}`,\n\t\t\t\ttitle: `EC: ${ec.codigoEc}`,\n\t\t\t\tdescription: `${ec.nomeRazaoSocial.substring(0, 20)}`\n\t\t\t}\n\t\t})\n\n\t\tconst mainText = `Em qual podemos seguir no atendimento?`;\n\t\tconst buttonTitle = \"Selecionar EC\";\n\t\tconst headerText = \"Selecionar EC\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": mainText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": buttonTitle,\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": headerText,\n\t\t\t\t\t\t\t\"rows\": buttons\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction message(listaEc) {\n\tlet textoEc = `Em qual podemos seguir no atendimento? \n\nInforme o número da opção, exemplo *1*.\\n\\n`\n\tlistaEc.slice(0, 100)\n\t\t.forEach((ec, index) => textoEc += `${index + 1} - *EC: ${ec.codigoEc}*\\n${ec.nomeRazaoSocial}\\n\\n`)\n\treturn {\n\t\t\"type\": \"text\",\n\t\t\"text\": {\n\t\t\t\"body\": textoEc\n\t\t}\n\t}\n}\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { ecList, ecQuantity } = JSON.parse(data)\n\t\tif (ecQuantity <= 6) {\n\t\t\treturn list(ecList)\n\t\t}\n\t\treturn message(ecList)\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["ecList","idSessao","state.name"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarEc"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"ecList@ecQuantity"}]},{"$id":"6364306a-32c9-4b27-8efb-74824dae1de6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarEc@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarEc@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarEc@tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-eefdbc1f-d745-4fec-81b0-2327c76e4ce9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-86aae895-58d7-4c1b-9ec3-9505a9588364","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e5317042-788c-4b6a-a519-b358dbd031a7","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-e75099ad-0fdd-40eb-86e7-0419557bc032","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","root":false,"$title":"[M.4.0.0][MSG][HTTP] Obtem EC","$position":{"top":"1128px","left":"1229px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f13e7fbd-372e-45ce-a30f-de575a5cb830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-dc593caa-0eee-40a6-806f-be7bb46d2da1","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f13e7fbd-372e-45ce-a30f-de575a5cb830","root":false,"$title":"[Redirect] To cascata","$position":{"top":"5px","left":"137px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a":{"$contentActions":[{"action":{"$id":"573516a7-6247-4ab4-8054-793ae9a89e1d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5aa9ffd-855e-4039-9345-c68c1ad4cb2e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Identifiquei mais de um estabelecimento comercial (EC) no seu cadastro.","metadata":{}},"$cardContent":{"document":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Identifiquei mais de um estabelecimento comercial (EC) no seu cadastro."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f6cfd676-2a10-4573-b13c-ea3b49f72a75","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"21c8cf29-65e5-4942-a94f-e7cd29c46146","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"21c8cf29-65e5-4942-a94f-e7cd29c46146","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"421de24e-3942-4f50-8ea0-9d0b57bbd5eb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{exibeSelecionarEc}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed65c28f-2f50-414c-b58a-802440f38900","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e567a78-dbb9-4216-baa4-9d476bc2b887","typeOfStateId":"state","$connId":"con_78","$id":"ea6ea425-ef88-4bf1-89c2-387725bcce85","conditions":[{"values":[],"source":"input","comparison":"exists","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd4b372a-bdbd-4379-90a0-b180541ac632","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-db7e2e9f-16ee-49b9-85ae-1d805ba318b4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6ce83145-3538-4055-83a9-56c04d413c10","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","root":false,"$title":"[M.4.1.0][MSG] Selecionar EC","$position":{"top":"1103px","left":"1719px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"30e39880-1d2a-439a-a0ed-1e7210966286":{"$contentActions":[{"action":{"$id":"d8e25b49-af9d-42cb-9189-a7d020ab0974","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6eab91e1-a8d9-4f36-877e-bd3049512919","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"595bbc26-6daf-4319-a175-17192cf276fc","typeOfStateId":"state","$connId":"con_83","$id":"f6b5a2f4-95b2-4b95-a158-703dc53dc4eb","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3aa9d290-4cc4-4607-a662-a0366eb1b3d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"83de69ad-cc6d-4f42-8b73-e78b4a5e5528","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n\t{\n\t\t\"id\": \"1\",\n\t\t\"title\": \"Máquinas SafraPay\",\n\t\t\"description\": \"Taxas, suporte, retirada de máquina, vendas, antecipação e outros\"\n\t},\n\t{\n\t\t\"id\": \"2\",\n\t\t\"title\": \"Conta corrente\",\n\t\t\"description\": \"Extrato, pix, antecipar saldo, informações da conta e outros\"\n\t},\n\t{\n\t\t\"id\": \"3\",\n\t\t\"title\": \"Acesso e alterar dados\",\n\t\t\"description\": \"Acesso ao app, alterar cadastro e alterar domicílio\"\n\t},\n\t{\n\t\t\"id\": \"4\",\n\t\t\"title\": \"Produtos\",\n\t\t\"description\": \"Seguros, investimento, renegociação, empréstimo, cartão, cheque e outros\"\n\t},\n\t{\n\t\t\"id\": \"5\",\n\t\t\"title\": \"Perda e roubo\",\n\t\t\"description\": \"Bloqueio de acessos, dispositivo e cartões \"\n\t},\n\t{\n\t\t\"id\": \"6\",\n\t\t\"title\": \"Outros assuntos\",\n\t\t\"description\": \"Protocolo, títulos/boletos, descredenciamento e transação não autorizada\"\n\t},\n]\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n\tif (posicao > menuOptions.length) {\n\t\tposicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n\t}\n\tif (menuOptions.find(option => option.id == posicao)) {\n\t\tquantidadeItens = menuOptions.length\n\t\tfor (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n\t\t\tmenuOptions[i].id = (i + 2).toString()\n\t\t}\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72) || ''\n\t\t})\n\t} else {\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72)\n\t\t})\n\t}\n\tmenuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n\t// Parametro de busca é o title ou description da opção que deseja atualizar\n\tconst opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tmenuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n\tmenuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao);\n\n\tif (!opcao) {\n\t\treturn;\n\t}\n\n\tconst hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n\tif (hasPermission) {\n\t\treturn;\n\t}\n\n\tconst index = menuOptions.indexOf(opcao);\n\tif (index > -1) {\n\t\tmenuOptions.splice(index, 1);\n\t}\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\nfunction removeDescricaoDoBotao({ tituloDoBotao, parteASerRemovida, listaPermissoes, permissaoNecessaria }) {\n\tif (listaPermissoes.includes(permissaoNecessaria)) {\n\t\treturn\n\t}\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions[index].description = menuOptions[index].description.replace(parteASerRemovida, '')\n}\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada,ecList) {\n\ttry {\n\t\tconst { cpfAppKey, permissoes, ec, segmentoGerente } = JSON.parse(contaSelecionada);\n\t\tlet ecListParsed = JSON.parse(ecList);\n\t\tif (ecListParsed.allecQuantity && ecListParsed.allecQuantity < 1) {//Se a quantidade de EC for menos 1 remove a opcao retirada de maquina, independente de ser EC ativo ou cancelado.\n\t\t\tatualizaOpcaoMenu({\n\t\t\t\tparametroDeBusca: 'Máquinas SafraPay',\n\t\t\t\ttitle: 'Máquinas SafraPay',\n\t\t\t\tdescription: 'Condições e taxas, suporte, vendas, antecipação e outros'\n\t\t\t})\n\t\t}\n\t\tif (!ec) {\n\t\t\tatualizaOpcaoMenu({\n\t\t\t\tparametroDeBusca: 'Conta corrente',\n\t\t\t\ttitle: 'Conta corrente',\n\t\t\t\tdescription: 'Pix, informações da conta e consultar pacotes'\n\t\t\t})\n\t\t\tatualizaOpcaoMenu({\n\t\t\t\tparametroDeBusca: 'Produtos',\n\t\t\t\ttitle: 'Produtos',\n\t\t\t\tdescription: 'Renegociação, empréstimo, cartão, cheque e outros'\n\t\t\t})\n\t\t}\n\t\tif (cpfAppKey == 'false') {\n\t\t\tatualizaOpcaoMenu({\n\t\t\t\tparametroDeBusca: 'Conta corrente',\n\t\t\t\ttitle: 'Conta corrente',\n\t\t\t\tdescription: 'Pix, informações da conta e consultar pacotes'\n\t\t\t})\n\t\t}\n\n\t\tif (segmentoGerente == 'emp1') {\n\t\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Produtos', parteASerRemovida: ', cheque', permissaoNecessaria: 'emp1', listaPermissoes: permissoes })\n\t\t}\n\n\t\t// if (segmentoGerente) {\n\t\t// \tadicionaOpcaoNoMenu({ posicao: 6, title: 'Contato do gerente', description: 'Confira os dados de contato' })\n\t\t// }\n\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Outros assuntos', parteASerRemovida: ', descredenciamento', permissaoNecessaria: 'desinstalacao', listaPermissoes: permissoes })\n\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Conta corrente', parteASerRemovida: 'pix, ', permissaoNecessaria: 'transferenciaPix', listaPermissoes: permissoes })\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Conta corrente', parteASerRemovida: 'antecipar saldo, ', permissaoNecessaria: 'solicitarAntecipAuto', listaPermissoes: permissoes })\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Como posso te ajudar?`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Ver opções\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\texceptionType: 'reiniciarFluxo',\n\t\t\tdynamicContent: {\n\t\t\t\t\"type\": \"text\",\n\t\t\t\t\"text\": {\n\t\t\t\t\t\"body\": \"Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","inputVariables":["contaSelecionada","ecList"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12d17c26-02d6-4b25-b6ba-aefbc1b7a22d","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"d45b7520-a5d6-472f-bca9-4b71a0406b88","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"5170536a-29da-42f7-8e55-c189b5af2326","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2828ec53-b72a-4ff8-a371-f8bb7e617d13","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-117f7143-8f56-4fa4-bbf8-1ddaee0e7f07","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5845b6ad-2e28-42de-9876-ca040032e956","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b6273f2c-10d6-41d8-8d13-6fa54e5d4df9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"30e39880-1d2a-439a-a0ed-1e7210966286","root":false,"$title":"[M.5.0.0][MSG] Menu Principal","$position":{"top":"1611px","left":"1720px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5ddf643-13c0-4a81-a174-e1aa9dd86873":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5b733936-1903-4654-b904-fc7b72d289cc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Bot Máquina Safrapay ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'e0d2ce64-3265-46bd-b396-f53ad65b26e6',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d02ef8e1-41a6-4df8-ae88-9f54609b5548","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-338fd2d7-ece4-4e90-8335-dc2a3fe531a0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-51ecbb27-705b-41eb-8574-4572f9a90565","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$title":"[Redirect] To Maquina Safrapay","$position":{"top":"1665px","left":"1288px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"491c0860-a3da-491c-bfc6-3b7f99e29c29":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"18838d12-aaf3-43c0-b6ae-1c14204ca89a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"525c6b7f-cc74-42fb-a747-f7948ebc0984","typeOfStateId":"state","$connId":"con_88","$id":"833fd40f-f365-49d2-a884-7dd4bbf5345e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"be5d1b5c-8ea6-4363-b2b8-3bf398126ac5","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpf\" to \"{contact.extras.cpf}\"","$invalid":false,"settings":{"variable":"cpf","value":"{{contact.extras.cpf}}"},"conditions":[]},{"$id":"b9150719-3abd-4de0-91a9-0e0a46b2e951","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoCliente\" to \"{contaSelecionada@codigoCliente}\"","$invalid":false,"settings":{"variable":"codigoCliente","value":"{{contaSelecionada@codigoCliente}}"},"conditions":[]},{"$id":"4d44859f-0717-41e5-ba98-576f390ab95a","$typeOfContent":"","type":"SetVariable","$title":"Set \"conta\" to \"{contaSelecionada@conta}\"","$invalid":false,"settings":{"variable":"conta","value":"{{contaSelecionada@conta}}"},"conditions":[]},{"$id":"85eb4b94-9458-4cf2-8406-5b4562fea7c7","$typeOfContent":"","type":"SetVariable","$title":"Set \"agencia\" to \"{contaSelecionada@agencia}\"","$invalid":false,"settings":{"variable":"agencia","value":"{{contaSelecionada@agencia}}"},"conditions":[]},{"$id":"af88479f-0eb6-4d73-8bf0-02d336989e40","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoSegmento\" to \"{contaSelecionada@codigoSegmento}\"","$invalid":false,"settings":{"variable":"codigoSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"8b5f060f-1017-40ea-9648-500fe736f645","$typeOfContent":"","type":"SetVariable","$title":"Set \"agenciaConta\" to \"{contaSelecionada}\"","$invalid":false,"settings":{"variable":"agenciaConta","value":"{{contaSelecionada}}"},"conditions":[]},{"$id":"1f7211bd-def1-4d54-920b-5e89a70cc76c","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoPessoa\" to \"{contaSelecionada@tipoPessoa}\"","$invalid":false,"settings":{"variable":"tipoPessoa","value":"{{contaSelecionada@tipoPessoa}}"},"conditions":[]},{"$id":"7909d9f8-3adc-4e98-8ac6-0157dd3cae94","$typeOfContent":"","type":"SetVariable","$title":"Set \"doc\" to \"{contaSelecionada@doc}\"","$invalid":false,"settings":{"variable":"doc","value":"{{contaSelecionada@doc}}"},"conditions":[]},{"$id":"148cc8da-b70b-4e08-b2b0-fbd643dc2932","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortname\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"shortname","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"e73aeada-145c-4b79-8ebd-c951c98a76ce","$typeOfContent":"","type":"SetVariable","$title":"Set \"ec\" to \"selectedEc@codigoEc\"","$invalid":false,"settings":{"variable":"ec","value":"{{selectedEc@codigoEc}}"},"conditions":[]},{"$id":"204f5d88-cf49-44a6-a048-aa84cbfb0d42","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"64588b09-10f5-41e0-b2ce-5c17fc3c210e","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{codigoSegmento}\"","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"02b7bc32-f8f9-4c46-bcfc-910d4c30f381","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortnameFull\" to \"{contaSelecionada@shortname}\"","$invalid":false,"settings":{"variable":"shortnameFull","value":"{{contaSelecionada@shortname}}"},"conditions":[]},{"$id":"558f5241-b041-4355-a445-98049bb6ee82","$typeOfContent":"","type":"SetVariable","$title":"Set \"usuario\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"usuario","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"909c2e2e-bf98-48eb-aaa6-fede43fd5d63","$typeOfContent":"","type":"SetVariable","$title":"Set \"nome\" to \"{contact.name}\"","$invalid":false,"settings":{"variable":"nome","value":"{{contact.name}}"},"conditions":[]},{"$id":"d3b43eaf-fb6e-4407-9dd1-aa13f7690077","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\" to \"false\"","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"5f2161cd-02b6-4e82-89b7-0054c54a0c0b","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoCliente\" to \"bdsp\"","$invalid":false,"settings":{"variable":"tipoCliente","value":"Bdsp"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}]},{"$id":"86666ff3-fd19-414d-8746-2a9e287541cd","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"402216b1-da34-4435-b20a-e857ea018e84","$typeOfContent":"","type":"ExecuteScript","$title":"phone","$invalid":false,"settings":{"function":"run","source":"function run(phone) {\n    let extracted_phone = phone\n        .split('@')[0]\n    if (extracted_phone.length == 10)\n        extracted_phone = extracted_phone\n            .substr(0, 2)\n            .concat('9', extracted_phone.substr(2));\n    return extracted_phone;\n}","inputVariables":["contact.identity"],"outputVariable":"phone","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"04fec05f-0acb-4d18-8550-9cdbfbd40958","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"{state@assunto}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{state@assunto}}"},"conditions":[]},{"$id":"27243618-496f-48c3-9b3e-a338e038e479","$typeOfContent":"","type":"SetVariable","$title":"Set \"nomeCompleto\" to \"{nome}\"","$invalid":false,"settings":{"variable":"nomeCompleto","value":"{{nome}}"},"conditions":[]},{"$id":"ad35f69b-4be8-485d-8a73-df753ffd3e48","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"const transferMessage = {\n\t'antecipar saldo': 'Antecipar saldo',\n\t'fazer pix': 'Fazer Pix',\n\t'pagar conta': 'Pagar contas',\n\t'extrato conta corrente': 'Extrato Conta',\n\t'extrato vendas': 'Extrato Vendas',\n\t'extrato recebimentos': 'Extrato Recebimentos',\n\t'perda e roubo': 'Perda ou Roubo',\n\t'suporte técnico': 'Suporte Tecnico',\n\t'não recebi minha venda': 'Venda não recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'acesso e alterar dados': 'Aplicativo',\n\t'suporte e configurações': 'Suporte e Configurações',\n\t'transação não autorizada': 'Transação não Autorizada',\n\t'seguros': 'Seguros'\n}\n\nconst assunto = {\n\t'antecipar saldo': 'antecipação',\n\t'fazer pix': 'pix',\n\t'pagar conta': 'pagar contas',\n\t'extrato conta corrente': 'extrato conta',\n\t'extrato vendas': 'extrato vendas',\n\t'extrato recebimentos': 'extrato recebimentos',\n\t'perda e roubo': 'perda ou roubo',\n\t'suporte técnico': 'Suporte Técnico',\n\t'aplicativo': \"Aplicativo\",\n\t'consultar protocolo': 'Consulta de Protocolo',\n\t'simulador de vendas': 'Simulador de vendas',\n\t'não recebi minha venda': 'Venda não recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'acesso e alterar dados': 'Apoio Aplicativo',\n\t'suporte e configurações': 'Suporte e Configurações',\n\t'transação não autorizada': 'Transação não Autorizada',\n\t'seguros': 'Seguros'\n}\n\nconst botDestination = {\n\t'antecipar saldo': 'WhatsApp PJ',\n\t'fazer pix': 'WhatsApp PJ',\n\t'pagar conta': 'WhatsApp PJ',\n\t'extrato conta corrente': 'WhatsApp PJ',\n\t'extrato vendas': 'WhatsApp PJ',\n\t'extrato recebimentos': 'WhatsApp PJ',\n\t'perda e roubo': 'WhatsApp PJ',\n\t'suporte técnico': 'WhatsApp PJ',\n\t'consulta os': 'Bot OS',\n\t'aplicativo': 'App',\n\t\"não recebi minha venda\": \"Bot Máquina Safrapay\",\n\t'consultar protocolo': 'Bot Máquina Safrapay',\n\t'simulador de vendas': 'Bot Máquina Safrapay',\n\t'descredenciamento': 'WhatsApp PJ',\n\t'acesso e alterar dados': 'App',\n\t'suporte e configurações': 'Bot Máquina Safrapay',\n\t'transação não autorizada': 'Bot Máquina Safrapay',\n\t'seguros': 'seguros'\n}\n\nconst stateDestination = {\n\t'consulta os': 'fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db',\n\t'não recebi minha venda': '4051c1ad-de53-4ef3-bfa0-add7a989e960',\n\t'consultar protocolo': '168598f7-bb5b-4eb0-a37e-45f8c48ccdde',\n\t'simulador de vendas': 'c391e959-860e-4eaf-86b9-71fcd8888c86',\n\t'descredenciamento': 'inicio',\n\t'acesso e alterar dados': 'Welcome',\n\t'suporte e configurações': '4f6e7e6d-21b4-4b11-9913-6aa5149a7469',\n\t'transação não autorizada': 'f0a8601f-5de1-4885-9b44-4f4a6e062c01',\n\t'seguros': 'Welcome'\n}\n\nfunction run(userInput, env, previousBlockid, cpfAppKey, serviceName, previousStateName) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tif (!cpfAppKey && userInput.toLowerCase() === 'fazer pix') {\n\t\t\tuserInput = 'pix'\n\t\t}\n\n\t\tlet destination = botDestination[userInput.toLowerCase()] || `excecoes ${env || \"\"}`.trim()\n\t\tif (env === 'Dev' && destination !== 'WhatsApp PJ') {\n\t\t\tdestination = `${destination} ${env}`\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: destination,\n\t\t\tstateDestination: stateDestination[userInput.toLowerCase()] || 'welcome',\n\t\t\tuserInput: transferMessage[userInput.toLowerCase()] || userInput,\n\t\t\tassunto: assunto[userInput.toLowerCase()] || userInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: userInput,\n\t\t\tuserInput,\n\t\t\terror: err.message\n\t\t}\n\t}\n}\n\n","inputVariables":["userInput","config.env","state.previous.id","cpfAppKey","config.serviceName","state.previous.name"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7f8280ca-d437-4ee7-99a9-d39b57871a9a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{calendar.datetime}} | {{state}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-185db310-064f-4168-b1b2-c1ac0e8c6c0f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-cb8d4666-26e4-4447-90a7-9612d597290f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4c11ae6d-8240-4b69-a5a7-5b44e7137a5b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"491c0860-a3da-491c-bfc6-3b7f99e29c29","root":false,"$title":"[Temporario][OLD] Redireciona ao serviço","$position":{"top":"1976px","left":"1285px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"525c6b7f-cc74-42fb-a747-f7948ebc0984":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"af4b8e88-5277-4acd-9664-bd434b53ff39","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3996e980-1a2e-48dc-8e6b-238fd5523544","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6651bda0-66e6-48c0-a56f-fa26e9752c94","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"525c6b7f-cc74-42fb-a747-f7948ebc0984","root":false,"$title":"[Redirect] ao serviço","$position":{"top":"1988px","left":"1000px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06ecab99-d5ad-491b-b680-03a429bc6091","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"aabcda13-332c-4868-a539-94742b4f996a","typeOfStateId":"state","$connId":"con_93","$id":"e6b2d820-969b-4e4a-becb-b8c0b2598b73","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ffe4a4c7-1ce7-4d67-a423-5c3d2c01b375","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf, exception) {\n    const invalidCpfMessage = 'input inesperado';\n    try {\n        if (!cpf) {\n            return 'inatividade'\n        }\n        if (exception === 'quickReply' || exception === 'skip') {\n            if (cpf.match(/tentar (novamente|novamnete|novament|novametne)/i)) {\n                return 'tentar novamente'\n            }\n            if (cpf.match(/encerrar(a|ar|ra|r)/i)) {\n                return 'encerrar'\n            }\n            return invalidCpfMessage\n        }\n        \n        cpf = cpf.replace(/\\D/g, '');\n        if (cpf.length !== 11 || /^(.)\\1*$/.test(cpf)) {\n            return invalidCpfMessage;\n        }\n        let sum = 0;\n        let remainder;\n        for (let i = 1; i <= 9; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(9, 10))) {\n            return invalidCpfMessage;\n        }\n        sum = 0;\n        for (let i = 1; i <= 10; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(10, 11))) {\n            return invalidCpfMessage;\n        }\n        return cpf;\n    } catch (err) {\n        return invalidCpfMessage;\n    }\n}","inputVariables":["input.content","exception"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8ceee10-b751-4f03-9fea-cf15009ee655","$typeOfContent":"","type":"MergeContact","$title":"Set \"cpf\" to \"{userInput}\"","$invalid":false,"settings":{"extras":{"cpf":"{{userInput}}"}},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"768bd9d1-acb2-4a9e-9a2b-e9d31c5c6d06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0f3dc18b-2a49-43ac-8e0f-fc9c50bb46cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"4d5083d0-0c1a-431c-94b0-6961c2f6cb94","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.2.0.1","variable":"exceptionType"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-df5050a7-2474-46d5-ac9c-03b127bf6d77","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-57324c3d-5668-4b8d-b728-54cea6abf30a","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-14500a5a-331a-4802-b854-25a59be8e6e9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0f27ff68-6eb0-406e-a5c2-4554de5746f2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-49639153-fccb-4402-9953-233524bed728","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","root":false,"$title":"[M.2.0.1][INPUT] Valida CPF","$position":{"top":"697px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"fbd38da5-c763-4500-aaf8-955e2461e1a8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c","typeOfStateId":"state","$connId":"con_98","$id":"23207c0a-4052-4886-8c62-fa4af789e8fd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f549ed1f-5144-4910-b3eb-1d4931affe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function list(inputMessage, input, contas) {\n\ttry {\n\t\tconst id = JSON.parse(inputMessage).metadata['#wa.interactive.list.id']\n\t\tif (!id) {\n\t\t\tthrow 'Conta não selecionada'\n\t\t}\n\t\tconst [agencia, conta] = id.split('-')\n\t\tconst contaEncontrada = contas.find(c => c.agencia == agencia && c.conta == conta)\n\n\t\tif (contaEncontrada) {\n\t\t\treturn contaEncontrada\n\t\t}\n\t\treturn `input inesperado`\n\t} catch (err) {\n\t\treturn message(input, contas)\n\t}\n}\n\nfunction message(input, parsedContas) {\n\tif (isNaN(input)) {\n\t\treturn 'input inesperado'\n\t}\n\tconst index = Number(input) - 1\n\tconst contaSelecionada = parsedContas[index]\n\tif (!contaSelecionada) {\n\t\treturn 'input inesperado'\n\t}\n\treturn contaSelecionada\n}\n\nfunction run(input, conta, inputMessage) {\n\ttry {\n\t\tif (!input) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst { quantidadeContas, contas } = JSON.parse(conta)\n\t\tif (quantidadeContas > 10) {\n\t\t\treturn message(input, contas)\n\t\t}\n\t\treturn list(inputMessage, input, contas)\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["input.content","contas","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c40f5e3d-554a-4b05-9ff3-b668ef7cecdc","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"contaSelecionada","value":"{{userInput}}"},"conditions":[{"values":["input inesperado","inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"d3c4d368-dab9-428c-8a29-11cb27cd80bb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f1e9fe18-56a9-4b25-b28b-807e3fbd01ea","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"7b51d409-9bdc-42d5-b838-86cbdd2eede0","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.3.1.1","variable":"exceptionType"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2ab5aa2f-2b17-4cb6-98cb-a68b4af30a53","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6b3ea95c-3a47-4cfe-b115-c29cbfc27e32","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f4faf2e4-179e-410c-8600-756cb37ca6d8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3f430faf-40c2-4619-8dfc-5bf75235d5c5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","root":false,"$title":"[M.3.1.1][INPUT] Valida Seleção de conta","$position":{"top":"1334px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e567a78-dbb9-4216-baa4-9d476bc2b887":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"633713cd-19ca-4db4-89db-7d7f4e743c98","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"c2169ab5-6936-4b69-aadb-73b7330b39bc","typeOfStateId":"state","$connId":"con_103","$id":"88d96d36-20fb-4051-aea1-130b6fadaef6","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"992bb5b8-1303-48c7-931a-f01ab2eaf914","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function list(inputMessage, input, contas) {\n\ttry {\n\t\tconst id = JSON.parse(inputMessage).metadata['#wa.interactive.list.id']\n\t\tconst ecSelecionada = contas.find(ec => ec.codigoEc == id)\n\t\tif (!id) {\n\t\t\tthrow 'Conta não selecionada'\n\t\t}\n\t\treturn ecSelecionada\n\t} catch (err) {\n\t\treturn message(input, contas)\n\t}\n}\n\nfunction message(input, parsedContas) {\n\tif (isNaN(input)) {\n\t\treturn 'input inesperado'\n\t}\n\tconst index = Number(input) - 1\n\tconst contaSelecionada = parsedContas[index]\n\tif (!contaSelecionada) {\n\t\treturn 'input inesperado'\n\t}\n\treturn contaSelecionada\n}\n\nfunction run(input, conta, inputMessage) {\n\ttry {\n\t\tif (!input) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst { ecQuantity, ecList } = JSON.parse(conta)\n\t\tif (ecQuantity > 6) {\n\t\t\treturn message(input, ecList)\n\t\t}\n\t\treturn list(inputMessage, input, ecList)\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["input.content","ecList","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"493ad05b-2c7d-4996-9039-3779f2364a01","$typeOfContent":"","type":"SetVariable","$title":"Set \"selectedEc\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"selectedEc","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"710fb3be-ade5-4044-970a-b609fe9d3947","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"023a3323-c889-4d8b-9b1e-0a3e90055e1f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"51e3ecb2-3cd4-4e9e-85ad-bd5a2e11fb00","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.4.1.1\"","$invalid":false,"settings":{"value":"M.4.1.1","variable":"exceptionType"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d740e662-3607-408f-b6a5-8bc55ce80eb6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0deda22b-8eb5-4a36-94cc-4d8830256d8f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5ed8238a-cbeb-4c4b-b114-06a8cb1cd336","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-28f34925-659b-40b8-ab9d-1fc6d65dc7b1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0e567a78-dbb9-4216-baa4-9d476bc2b887","root":false,"$title":"[M.4.1.1][INPUT] Valida Seleção de ec","$position":{"top":"1168px","left":"2024px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"595bbc26-6daf-4319-a175-17192cf276fc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","typeOfStateId":"state","$connId":"con_108","$id":"a99636d2-f26d-493c-bc1a-ce50e9e39b6a","conditions":[{"source":"context","comparison":"equals","values":["Máquinas Safrapay"],"variable":"userInput"}],"$invalid":false},{"stateId":"c5482705-133e-4f31-b01e-7930e16e12a3","typeOfStateId":"state","$connId":"con_113","$id":"3a5498b9-e6af-4239-ae43-67f3bf7dfb1f","conditions":[{"source":"context","comparison":"equals","values":["Outros assuntos"],"variable":"userInput"}],"$invalid":false},{"stateId":"20bd236e-277f-4ecf-94f0-f63bdcd5efb6","typeOfStateId":"state","$connId":"con_118","$id":"a50f025c-4721-4cdc-bf81-06efe1aeb30b","conditions":[{"source":"context","comparison":"equals","values":["Conta corrente"],"variable":"userInput"}],"$invalid":false},{"stateId":"621b7935-89f3-450d-87b1-6caf539d5ec7","typeOfStateId":"state","$connId":"con_123","$id":"40c7bc98-7ffd-4bf8-b539-ad3cc80cb673","conditions":[{"source":"context","comparison":"equals","values":["Produtos"],"variable":"userInput"}],"$invalid":false},{"stateId":"01a08c4d-c367-434b-8b4c-1f00f39ad7a5","typeOfStateId":"state","$connId":"con_128","$id":"9dccf587-e507-4e6d-9051-09803a4c8096","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Contato do gerente"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"491c0860-a3da-491c-bfc6-3b7f99e29c29","typeOfStateId":"state","$connId":"con_133","$id":"e618a090-8648-4609-b70b-ec545b004438","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"172bdd8d-2409-4bc2-8335-09884e2ecb33","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n\nfunction run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f082125-b0fd-4f51-9297-74bfc4b4c961","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"38306ba1-03a0-4eaf-a340-f50c2d48264d","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ab889191-fb1d-4935-9e7a-3fc688cbeede","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"precisaKBA\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(userInput) {\n\ttry {\n\t\tconst listaKBA = [\n\t\t\t\"Descredenciamento\",\n\t\t\t'Questionar uma cobrança',\n\t\t\t'pacotes',\n\t\t\t'Simulador de vendas',\n\t\t\t'Taxa Pix na Safrapay',\n\t\t\t'Taxas de antecipação',\n\t\t\t'Taxas de venda',\n\t\t\t'Consultar máquinas',\n\t\t\t'Domicílio bancário']\n\t\t\tconst precisaKBA = listaKBA.some(intencao => userInput === intencao)\n\n\t\t\tif (precisaKBA){\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t} catch(erro){\n\t\treturn false\n\t}\n}","inputVariables":["userInput"],"outputVariable":"precisaKBA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a39d9f66-ffe2-40a0-9d91-8307c0d8cdb0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"2c33d508-83ac-45cd-b327-99711864563b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-64180d37-efc8-403e-86a0-5b9f9269602f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7b58d879-c3c2-4e87-a307-2b9871485723","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ca0fc088-f65b-4b78-880b-ae9675522a2e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-29fe76bc-47cb-485e-b7eb-4a884b559578","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"595bbc26-6daf-4319-a175-17192cf276fc","root":false,"$title":"[M.5.0.0][INPUT] Menu Principal","$position":{"top":"1816px","left":"1720px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7d220bd-2237-49f4-88ec-14c555bf202c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',//Refatorar\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-43c0e2dc-0076-4fc7-8dd8-49b6949175b2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-350e0e59-5bfb-43b3-a086-a7114f2a270c","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c7d220bd-2237-49f4-88ec-14c555bf202c","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"1437px","left":"280px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c5482705-133e-4f31-b01e-7930e16e12a3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Soluções ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d4298a8d-1afd-4a91-84a2-fc09dcf31ed6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5c01fd34-ad51-4e3e-bb96-699ba6e1b509","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9ca6c407-5e3d-4ac9-b91d-7508c85782f9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c5482705-133e-4f31-b01e-7930e16e12a3","root":false,"$title":"[Redirect] To Soluções","$position":{"top":"1816px","left":"1289px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"621b7935-89f3-450d-87b1-6caf539d5ec7":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b97c4ff7-f36a-4b19-8940-73380870d248","typeOfStateId":"state","$connId":"con_138","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n\t{\n\t\t\"id\": \"1\",\n\t\t\"title\": \"Seguros\",\n\t\t\"description\": \"Contratação, pagamento em atraso, renovação e outros\"\n\t},\n\t{\n\t\t\"id\": \"2\",\n\t\t\"title\": \"Investimentos\",\n\t\t\"description\": \"Escolha o produto e faça a aplicação\"\n\t},\n\t{\n\t\t\"id\": \"3\",\n\t\t\"title\": \"Renegociação\",\n\t\t\"description\": \"Renegocie dívidas\"\n\t},\n\t{\n\t\t\"id\": \"4\",\n\t\t\"title\": \"Empréstimo\",\n\t\t\"description\": \"Linha de crédito, capital de giro e gravame\"\n\t},\n\t{\n\t\t\"id\": \"5\",\n\t\t\"title\": \"Meu Desempenho SafraPay\",\n\t\t\"description\": \"Contratação, cancelamento e dúvidas\"\n\t},\n\t{\n\t\t\"id\": \"6\",\n\t\t\"title\": \"Cartão\",\n\t\t\"description\": \"Solicitação, desbloqueio, esqueci a senha e perda ou roubo\"\n\t},\n\t{\n\t\t\"id\": \"7\",\n\t\t\"title\": \"Talão de cheque\",\n\t\t\"description\": \"Faça a solicitação  \"\n\t}\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n\tif (posicao > menuOptions.length) {\n\t\tposicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n\t}\n\tif (menuOptions.find(option => option.id == posicao)) {\n\t\tquantidadeItens = menuOptions.length\n\t\tfor (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n\t\t\tmenuOptions[i].id = (i + 2).toString()\n\t\t}\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72) || ''\n\t\t})\n\t} else {\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72)\n\t\t})\n\t}\n\tmenuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n\t// Parametro de busca é o title ou description da opção que deseja atualizar\n\tconst opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tmenuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n\tmenuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (permissoes.includes(permissoesNecessarias)) {\n\t\treturn\n\t}\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n */\nfunction run(contaSelecionada) {\n\ttry {\n\t\tconst { segmentoGerente } = JSON.parse(contaSelecionada)\n\n\t\tif (!segmentoGerente) {\n\t\t\tremoveOpcaoDoMenu({ tituloDoBotao: 'Empréstimo' })\n\t\t\tremoveOpcaoDoMenu({ tituloDoBotao: 'Renegociação' })\n\t\t}\n\n\t\tif (segmentoGerente === 'emp1') {\n\t\t\tremoveOpcaoDoMenu({ tituloDoBotao: 'Talão de cheque' })\n\t\t\t//atualizaOpcaoMenu({ parametroDeBusca: 'Talão de cheque', title: 'Talão de cheque', description: ''})\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Ótimo, o que você precisa sobre produtos?`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Ver opções\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\texceptionType: 'reiniciarFluxo',\n\t\t\tdynamicContent: {\n\t\t\t\t\"type\": \"text/plain\",\n\t\t\t\t\"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c2c6bdf2-80db-4300-af7a-11c8f4f5476d","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"02e6f307-30a9-40d5-b508-b962c38ac9f9","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"a5a4ebf2-b21a-4bf6-94b6-c1674c4e33c6","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a21dbf8a-6510-4b18-8808-ffcaa4cb981a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8fea4f02-f5fc-45c8-abf5-9377704db1c5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-99933f25-d820-453a-85f2-58a26dc87526","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bf021894-91c9-4881-bb42-a78546e079c5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"621b7935-89f3-450d-87b1-6caf539d5ec7","root":false,"$title":"[M.5.4.0][MSG] Produtos","$position":{"top":"2058px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b97c4ff7-f36a-4b19-8940-73380870d248":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9417e98-f984-43b7-a88a-e61ba1687105","typeOfStateId":"state","$connId":"con_143","$id":"62ee965c-f47c-4d88-8018-b73f0a6e2b32","conditions":[{"source":"context","comparison":"equals","values":["Renegociação"],"variable":"userInput"}],"$invalid":false},{"stateId":"b2d0943f-28c6-40ee-87a3-c98641dda5eb","typeOfStateId":"state","$connId":"con_148","$id":"94856239-8f60-4ab0-a169-b974a0e70313","conditions":[{"source":"context","comparison":"equals","values":["Meu Desempenho Safrapay"],"variable":"userInput"}],"$invalid":false},{"stateId":"384b6397-2b2e-4808-af80-3c5540244ccf","typeOfStateId":"state","$connId":"con_153","$id":"5fab60e0-7cd2-4bff-a18a-6c2ef1e01717","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-da6e2559-c6d0-426f-b967-823eb4cfabe7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7bf1b566-aa9e-4632-8c70-3522fc15243a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-35955a37-e28a-4b39-ab25-77180d4daba3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5a5f56f7-8c3e-4cc3-86f0-61785a92988a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b97c4ff7-f36a-4b19-8940-73380870d248","root":false,"$title":"[M.5.4.0][INPUT] Produtos","$position":{"top":"2257px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"384b6397-2b2e-4808-af80-3c5540244ccf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10c195ed-131d-4823-a09f-de96fb954625","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5e03585d-c827-4161-8532-e49447d72933","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\tconst destination = {\n\t\t'Seguros': {\n\t\t\tbotDestination: 'seguros',\n\t\t\tstateDestination: 'welcome'\n\t\t},\n\t\t'Investimentos': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'f88bbdeb-3963-49e0-a355-edc20350bbfd'\n\t\t},\n\t\t'Renegociação': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: '5ea0cac6-c5fd-49f9-9423-54d0e660adae'\n\t\t},\n\t\t'Empréstimo': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: '1e3206de-707e-4dac-9749-9f24d53110c0'\n\t\t},\n\t\t'Talão de cheque': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'c1af60de-05a9-4466-8c99-b2ddb36a220a'\n\t\t},\n\t\t'Cartão': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: '37f23f86-2009-43f1-b7a5-f50093c784f0'\n\t\t}\n\t}\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst destinationBot = destination[intent]\n\t\tif (!destinationBot) {\n\t\t\tthrow new Error('invalid destination')\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\t...destinationBot,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: \"\",\n\t\t\tstateNameOrigin: \"\",\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"820ba5c8-e91c-44fe-8276-cbdc5aeb6c67","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e9767925-edd5-4bbb-b824-14abee0b2b2f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fcf02c79-e30f-4c73-90dc-1a046b95bac0","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"384b6397-2b2e-4808-af80-3c5540244ccf","root":false,"$title":"[Redirect] Menu produtos","$position":{"top":"2257px","left":"1478px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20bd236e-277f-4ecf-94f0-f63bdcd5efb6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10c195ed-131d-4823-a09f-de96fb954625","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5e03585d-c827-4161-8532-e49447d72933","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"820ba5c8-e91c-44fe-8276-cbdc5aeb6c67","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b7b06a8e-71a8-4a51-87ad-be8af25a2029","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-20b6768a-edef-44cb-8577-9f41d0a33e40","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"20bd236e-277f-4ecf-94f0-f63bdcd5efb6","root":false,"$title":"[Redirect] Menu Conta Corrente","$position":{"top":"1660px","left":"2051px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b2d0943f-28c6-40ee-87a3-c98641dda5eb":{"$contentActions":[{"action":{"$id":"db3a7303-23e5-41b2-809f-66eb6cd6c97a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2700aef8-3245-46ca-bab1-b88ba13c8fb7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2700aef8-3245-46ca-bab1-b88ba13c8fb7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c609605f-422a-48e5-abdc-c0042bb05d76","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6cb9dd8b-16ab-45c5-bcca-d3c1b35f32d6","type":"text/plain","content":"Entendi, vou te transferir para quem pode te ajudar com isso.","metadata":{}},"$cardContent":{"document":{"id":"6cb9dd8b-16ab-45c5-bcca-d3c1b35f32d6","type":"text/plain","content":"Entendi, vou te transferir para quem pode te ajudar com isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","typeOfStateId":"state","$connId":"con_158","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3cc72273-21f0-42bf-aa07-d0929bc94666","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b380f41e-0a45-4371-8c50-58864d64d827","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b2d0943f-28c6-40ee-87a3-c98641dda5eb","root":false,"$title":"[M.5.4.1][MSG] Meu Desempenho","$position":{"top":"2448px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f2c4d052-2f9b-4aa8-9925-48aa824fc35c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a395c526-6ff8-440d-9a93-17a3a56cb27e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b4528408-d694-4a32-b783-53692d1a502c","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","root":false,"$title":"[Redirect] to Atendimento Humano","$position":{"top":"2613px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8d2f811-ac89-4e91-9b16-c93b4b661447":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5d50808-89ef-4829-a22e-9ff8a722b3ed","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","typeOfStateId":"state","$connId":"con_163","$id":"362ef9b3-c7dc-472a-bf56-7e87ff699ceb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2d666d07-e7b6-4ebf-b17a-36a613c3163f","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"39e7c0e1-eba2-4cc4-a850-89ed3ea6ff5f","$typeOfContent":"","type":"SetVariable","$title":"Set \"idSessao\" to \"{random.guid}\"","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[]},{"$id":"006f7ef8-db09-4c02-91c3-236244038996","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]},{"$id":"082408ed-5e16-420c-bbaf-431414b2beff","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionTypeMedia\" to \"false\"","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"false"},"conditions":[]},{"$id":"5e8be885-1804-47b0-b82e-3f9d6bf65a13","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"\"","$invalid":false,"settings":{"variable":"contaSelecionada"},"conditions":[]},{"$id":"a09b5d09-2b3d-4d30-aac1-dc4539f56ea1","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"errorCounter\"","$invalid":false,"settings":{"variable":"errorCounter","expiration":1},"conditions":[]},{"$id":"182cbadf-5180-4961-a503-6595224b8caf","$typeOfContent":"","type":"SetVariable","$title":"Set \"returnStateAuth\" to \"false\"","$invalid":false,"settings":{"variable":"returnStateAuth","value":"false"},"conditions":[]},{"$id":"c21ffa88-e7c7-4c64-bbf4-ca1858acb9db","$typeOfContent":"","type":"SetVariable","$title":"Set \"autenticado\" to \"false\"","$invalid":false,"settings":{"variable":"autenticado","value":"false"},"conditions":[]},{"$id":"35857fee-39ca-4a12-ac7b-a6330b3986be","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpfAppKey\" to \"\"","$invalid":false,"settings":{"variable":"cpfAppKey"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1eb77059-3a98-4e59-ba2b-1c6f974cfc6e","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"inicio\"","$invalid":false,"settings":{"variable":"assunto","value":"inicio"},"conditions":[]},{"$id":"0c352339-18f4-4aac-ad53-ee731d41e2e5","$typeOfContent":"","type":"SetVariable","$title":"Set \"autoservico\" to \"\"","$invalid":false,"settings":{"variable":"autoservico"},"conditions":[]},{"$id":"445f9420-03a2-40e6-b147-f4dc22d999eb","$typeOfContent":"","type":"SetVariable","$title":"Set \"autenticadoKba\" to \"false\"","$invalid":false,"settings":{"variable":"autenticadoKba","value":"false"},"conditions":[]},{"$id":"9a603e47-85a1-48bc-8f5e-f05b77789460","$typeOfContent":"","type":"SetVariable","$title":"Set \"voltarState\" to \"\"","$invalid":false,"settings":{"variable":"voltarState"},"conditions":[]},{"$id":"488b16b0-d9e5-445a-9fd4-98aaf6fbbe95","$typeOfContent":"","type":"MergeContact","$title":"Reset \"extras\"","$invalid":false,"settings":{"extras":{"cpf":"-","broadcastOrigem":"-","team":"-"}},"conditions":[]},{"$id":"0653f0d8-05ec-4dbb-a7de-4a23318e2546","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]},{"$id":"791fa397-f13f-4844-b4be-a921e9091a21","$typeOfContent":"","type":"SetVariable","$title":"Set \"estabelecimentoPf\" to \"false\"","$invalid":false,"settings":{"variable":"estabelecimentoPf","value":"false"},"conditions":[]},{"$id":"89f7672c-5c13-45c3-8a3d-cd5a48828486","$typeOfContent":"","type":"SetVariable","$title":"Set \"natureza\" to \"\"","$invalid":false,"settings":{"variable":"natureza"},"conditions":[]},{"$id":"27379d30-aea5-4a35-a5e3-74b81ab976aa","$typeOfContent":"","type":"SetVariable","$title":"Set \"apiStatus\" to \"ok\"","$invalid":false,"settings":{"variable":"apiStatus","value":"ok"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9bc34cda-827b-4ebb-98fe-dfb4dcc41b0c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7e91f251-f92a-4ff6-a4a9-1e81fb954aa9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-871bec13-6b03-4b78-9f21-1f0252b95264","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"a8d2f811-ac89-4e91-9b16-c93b4b661447","root":false,"$title":"[M.0.0.0] Limpa Variaveis","$position":{"top":"155px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fde8a193-6fdc-4490-bbf2-a99a74582176":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","typeOfStateId":"state","$connId":"con_168","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"c2169ab5-6936-4b69-aadb-73b7330b39bc","typeOfStateId":"state","$connId":"con_173","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"506cda97-d7be-4c56-95ee-1513a6449bed","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager","value":"504"},"conditions":[]},{"$id":"3595f2db-845a-46a9-b8e4-971d340e6e61","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager2\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager2","value":"504"},"conditions":[]},{"$id":"2a9a6927-9903-4663-8428-728f53b306e1","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager3\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager3","value":"504"},"conditions":[]},{"$id":"c0c0c6b8-1afd-4ce4-b885-925a92a8cd73","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager4\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager4","value":"504"},"conditions":[]}],"$leavingCustomActions":[{"$id":"30d3d657-a220-4319-960b-99da5d05028d","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" AG/CONTA","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{idSessao}}","Safra-Bot-ID":"{{config.serviceName}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"681fd1ec-ab7f-46cf-acb8-a00fcdeaedda","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Agencia/Conta","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusAccountManager}} | {{bodyAccountManager}}"},"conditions":[]},{"$id":"6ba9e482-f73a-4643-8d14-45bb28306258","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" Segmento 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}]},{"$id":"45fe4d58-7c28-438c-950f-952042acd9ec","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Segmento 20","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0020 | GET | {{statusAccountManager2}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}]},{"$id":"feac2a4a-087d-414a-93eb-345ca1f991f5","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" Segmento 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"}]},{"$id":"fbbe8643-7f87-4484-8e52-216ad1b09264","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Segmento 17","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0017 | GET | {{statusAccountManager3}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"}]},{"$id":"27d6671d-9b1c-47c7-9d6c-cdcd9929aea3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" PHONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager4","responseBodyVariable":"bodyAccountManager"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"variaveldesativada"}]},{"$id":"81e4f97d-b045-488d-82ab-e91b2d278d4c","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J | GET | {{statusAccountManager4}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager3"},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager3"}]},{"$id":"57d42e37-72f1-43e5-8a0b-49cc9217f78e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyAccountManager, contaSelecionada) {\n\ttry {\n\t\tconst selecionada = JSON.parse(contaSelecionada)\n\t\tconst { id, sigla, codigoSegmento } = JSON.parse(bodyAccountManager).data\n\t\tselecionada['filaGerente'] = sigla || id\n\t\tif (Number(codigoSegmento) === 17) {\n\t\t\tselecionada['segmentoGerente'] = 'emp2'\n\t\t}\n\t\tif (Number(codigoSegmento) === 20) {\n\t\t\tselecionada['segmentoGerente'] = 'emp1'\n\t\t}\n\t\treturn selecionada\n\t} catch (err) {\n\t\treturn contaSelecionada\n\t}\n}","inputVariables":["bodyAccountManager","contaSelecionada"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85a01d06-18f8-424a-9835-0cadc7a1f8f8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 200)) {\n\t\t\treturn 'ok'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\treturn 'erro api'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusAccountManager","statusAccountManager2","statusAccountManager3","statusAccountManager4"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"51538566-a3e0-4f14-9c21-42ddcaf26d1c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0ea48f96-7c30-4ee7-8882-bca226fdbc3b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1b72a249-4bac-42ab-b078-63aa577b6aa4","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-837bd83e-23ae-4b0d-8a7b-f6f3f85e211f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2f41304e-5da5-46f1-98ec-1b749466aeff","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fde8a193-6fdc-4490-bbf2-a99a74582176","root":false,"$title":"[M.4.0.1][HTTP] Obtem Carterização","$position":{"top":"1116px","left":"1477px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e06cd93-6019-4a34-8468-b364f7ec47e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17e64ee0-3424-4597-bb39-91427781d927","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1401706f-cf89-4342-a34c-48af501b1be6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `broadcast ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"6e98faa6-4465-42b7-8aad-85e25ef1a72e","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e35af852-d49c-409b-b18a-6ef2897e89b8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3bf7cab1-affb-46bc-9723-0d73407f8496","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"3e06cd93-6019-4a34-8468-b364f7ec47e9","root":false,"$title":"[Redirect] To broadcast","$position":{"top":"0px","left":"970px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c2169ab5-6936-4b69-aadb-73b7330b39bc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cd2af6b-1fb5-4d7a-9f57-ec1f93729c4a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7643c242-b10a-455c-9881-9180b292de9e","typeOfStateId":"state","$connId":"con_178","$id":"3359c0af-c107-4cc8-96a4-bbbac99c8979","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4e4c26c2-c277-41fc-a70c-1a08afff6f0f","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAppKey\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"SPD"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/autorizacoes-acessos-clientes/assistente-virtual/v1/chaves?documento={{contact.extras.cpf}}","responseStatusVariable":"statusAppKey","responseBodyVariable":"bodyAppKey"},"conditions":[{"source":"context","comparison":"notEquals","variable":"resource.bdsp","values":["false"]}]},{"$id":"26be31b2-7973-4187-adcf-c1e125eb2e82","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"cpfAppKey\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyAppKey) {\n\ttry {\n\t\tconst { chave } = JSON.parse(bodyAppKey).data\n\t\tif (chave) {\n\t\t\treturn chave.replace('-onboarding', \"\")\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyAppKey"],"outputVariable":"cpfAppKey","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"e28ae169-5d15-49ed-b7ff-b9da221b80c6","$typeOfContent":"","type":"SetVariable","$title":"Set \"appKey\" to \"{cpfAppKey}\"","$invalid":false,"settings":{"variable":"appKey","value":"{{cpfAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"d078a281-edce-43ef-a79d-121a8c0d6a6e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgCpfAppkey\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(cpfAppKey, msgBdsp) {\n\ttry {\n\t\tif (msgBdsp == 'false') {\n\t\t\treturn \"\"\n\t\t}\n\t\tif (cpfAppKey && cpfAppKey != 'false') {\n\t\t\treturn `Temos novidades incríveis para você! Agora é possível *fazer PIX*, *consultar extratos*, *antecipar saldo* e *pagar contas* diretamente por este canal.\n\n É muito fácil:\n1. Acesse o *menu principal*.\n2. Selecione a opção *Conta Corrente*.\n3. Escolha a funcionalidade que você precisa.\n\nExperimente e aproveite todas as facilidades que preparamos para você!`\n\t\t}\n\t\treturn \"\"\n\t} catch (err) {\n\t\treturn \"\"\n\t}\n}","inputVariables":["cpfAppKey","resource.msgBdsp"],"outputVariable":"msgCpfAppkey","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"6ce6494e-31d8-4a6c-b635-d312dc602401","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatusCpfAppKey\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 200)) {\n\t\t\treturn 'ok'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 404)) {\n\t\t\treturn 'ok-notfound'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 500)) {\n\t\t\treturn 'ok-error'\n\t\t}\n\t\treturn 'erro api'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusAppKey"],"outputVariable":"apiStatusCpfAppKey","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"171f1ea6-19c3-4527-9392-3ba371856c5e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo v2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/autorizacoes-acessos-clientes/assistente-virtual/v1/chaves?documento={{contact.extras.cpf}} | GET | {{statusAppKey}} | {{bodyAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"78469bd6-6ff8-4db1-8b30-230c12f1c295","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{apiStatusCpfAppKey}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatusCpfAppKey"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"3b17b9ff-79fd-4b0d-b271-f4660d219e44","$typeOfContent":"","type":"TrackEvent","$title":"Track \"dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{calendar.datetime}} | {{contaSelecionada@doc}} | {{apiStatusCpfAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-94e58922-4b48-42fa-87cd-3d0be3fbe596","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-63a96488-eb7a-474c-b241-36abe922d6cf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-be47552f-869d-4fff-99c6-602309fa13d8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3abd7ad2-d106-4bef-a192-dc9bc5d54222","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"c2169ab5-6936-4b69-aadb-73b7330b39bc","root":false,"$title":"[M.4.0.2][HTTP] Obtem CpfAppKey","$position":{"top":"1284px","left":"1717px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17659cb5-b9cb-435f-8276-aff558a0ec09","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","typeOfStateId":"state","$connId":"con_183","$id":"84b1d1fd-1b15-47ee-b6a0-63ad1b7fbb27","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6e32ecd-0036-422a-9b52-a2c5248982af","$typeOfContent":"","type":"SetVariable","$title":"Set \"bodyPermissoes\" to \"\"","$invalid":false,"settings":{"variable":"bodyPermissoes"},"conditions":[]},{"$id":"f75ff11d-d50b-46c1-886f-5ff06163ecf8","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusPermissoes\" to \"\"","$invalid":false,"settings":{"variable":"statusPermissoes"},"conditions":[]},{"$id":"74468b7c-274c-4ee0-8495-575bab43bd11","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyPermissoes\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"IPJ"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/usuarios/{{contaSelecionada@usuario}}/shortnames/{{contaSelecionada@shortname}}/permissoes","responseStatusVariable":"statusPermissoes","responseBodyVariable":"bodyPermissoes"},"conditions":[{"values":["MASTER"],"source":"context","comparison":"notEquals","variable":"contaSelecionada@nivel"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"config.perfilamentoAtivo"}]},{"$id":"fbe08ff3-fccc-4721-9c4b-289850945adc","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/usuarios/{{contaSelecionada@usuario}}/shortnames/{{contaSelecionada@shortname}}/permissoes | GET | {{statusPermissoes}} | {{bodyPermissoes}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"config.perfilamentoAtivo"},{"values":["MASTER"],"source":"context","comparison":"notEquals","variable":"contaSelecionada@nivel"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d93762d2-c8c1-401f-b6c5-790fe618ee99","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4f3fad27-288b-42c7-bfaa-f44268a02916","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ba279ea0-b949-44e7-9683-19c12a2c764e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c","root":false,"$title":"[M.3.1.2][HTTP] Obtem Permissionamento","$position":{"top":"1116px","left":"996px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7643c242-b10a-455c-9881-9180b292de9e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6f53c324-2714-4b4f-a5e9-19080ec30458","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"30e39880-1d2a-439a-a0ed-1e7210966286","typeOfStateId":"state","$connId":"con_188","$id":"d33810d9-c5b9-472c-991b-487206cbfc2b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fdf09bd6-b760-4e75-920f-8372256e914c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"permissionList\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyPermissoes, contaSelecionada, listaPermissoes, perfilamentoAtivo) {\n    try {\n        let parsedListaPermissoes = JSON.parse(listaPermissoes);\n        let nivel = JSON.parse(contaSelecionada).nivel.toUpperCase();\n\n        let permissoes = [];\n        if (nivel.includes('MASTER') || perfilamentoAtivo == 'false') {\n            Object.values(parsedListaPermissoes).forEach(grupo =>\n                Object.values(grupo).forEach(perm =>\n                    permissoes.push(...perm)\n                )\n            );\n            return [...new Set(permissoes.sort((a, b) => a.localeCompare(b)))]\n        }\n        let parsedBodyPermissoes = JSON.parse(bodyPermissoes);\n        parsedBodyPermissoes.data.forEach(({ codigoGrupo, codigosServicos }) => {\n            if (parsedListaPermissoes[codigoGrupo]) {\n                codigosServicos.forEach(codigoServico => {\n                    let permissoesGrupo = parsedListaPermissoes[codigoGrupo][codigoServico];\n                    if (permissoesGrupo) {\n                        permissoes.push(...permissoesGrupo);\n                    }\n                });\n            }\n        });\n        return [...new Set(permissoes.sort((a, b) => a.localeCompare(b)))]\n    } catch (err) {\n        return { error: err.message }\n    }\n}","inputVariables":["bodyPermissoes","contaSelecionada","resource.listaPermissoes","config.perfilamentoAtivo"],"outputVariable":"permissionList","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false},{"$id":"86a53fb6-7c67-4363-9efa-0a71be14af8d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(permissionList, cpfAppKey, contaSelecionada, selectedEc) {\n\ttry {\n\t\tconst parsedPermissionList = JSON.parse(permissionList)\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\n\t\tparsedContaSelecionada.permissoes = parsedPermissionList\n\t\tparsedContaSelecionada.cpfAppKey = cpfAppKey || false\n\n\t\tif (selectedEc) {\n\t\t\tconst { codigoEc } = JSON.parse(selectedEc)\n\t\t\tparsedContaSelecionada.ec = codigoEc\n\t\t\tparsedContaSelecionada.codigoEc = codigoEc\n\t\t} else {\n\t\t\tparsedContaSelecionada.ec = false\n\t\t\tparsedContaSelecionada.codigoEc = false\n\t\t}\n\n\t\treturn parsedContaSelecionada\n\t} catch (err) {\n\t\treturn { error: err.message, contaSelecionada: JSON.parse(contaSelecionada) }\n\t}\n}","inputVariables":["permissionList","cpfAppKey","contaSelecionada","selectedEc"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e891e1c9-f680-43c2-bea3-28978a55dfba","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"1325c31f-89fd-4a95-af5d-c09e08f4264f","$typeOfContent":"","type":"SetVariable","$title":"set \"naoCliente\" TO \"false\" (Usa em WS PJ)","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"364970fd-f3b1-4789-81c0-84a4d6ad2606","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgDev\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(contaSelecionada, identifier, perfilamentoAtivo) {\n\ttry {\n\t\tif (!identifier.includes('spdmain')) {\n\t\t\tthrow new Error(identifier)\n\t\t}\n\t\tconst { nivel, permissoes, ec, cpfAppKey, segmentoGerente, doc } = JSON.parse(contaSelecionada)\n\t\tif (perfilamentoAtivo == 'false') {\n\t\t\treturn `*[Mensagem exibida apenas em ambiente de homologação]*\n\t\t\t\n*Nivel*: \nMaster (Permissionamento desativado)\n\n*Permissões*:\nMaster (Permissionamento desativado)\n\n*EC*:\n${ec}\n\n*Tem cpfAppKey*:\n${cpfAppKey}\n\n*Segmento*:\n${segmentoGerente}\n\n*CNPJ*\n${doc}\n\t\t\t`\n\t\t}\n\t\tconst permissoesFormatadas = permissoes.join('\\n')\n\t\treturn `*[Mensagem exibida apenas em ambiente de homologação]*\n\n*Nivel*: \n${nivel}\n\n*Permissões*:\n${permissoesFormatadas}\n\n*EC*:\n${ec}\n\n*Tem cpfAppKey*:\n${cpfAppKey}\n\n*Segmento*:\n${segmentoGerente}\n\n*CNPJ*\n${doc}\n`\n\t} catch (err) {\n\t\treturn ''\n\t}\n}","inputVariables":["contaSelecionada","application.identifier","config.perfilamentoAtivo"],"outputVariable":"msgDev","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"8c0eac48-6620-48c4-8e40-8d199f1590cd","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} permissionList erro\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} permissionList erro","action":"{{permissionList@error}} || {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"permissionList@error"}]},{"$id":"b7778a47-6ae5-44b4-bb3c-af7ac6b7da14","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} contaSelecionada erro\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} contaSelecionada erro","action":"{{contaSelecionada@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@error"}]},{"$id":"0708cc50-e9f0-424b-9201-dc0df249b565","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"{contaSelecionada@contaSelecionada}\"","$invalid":false,"settings":{"variable":"contaSelecionada","value":"{{contaSelecionada@contaSelecionada}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@error"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@contaSelecionada"}]},{"$id":"16d3938a-407e-4f5d-aaeb-9e6f166c45f9","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"nivel conta\"","$invalid":false,"settings":{"extras":{},"category":"nivel conta","action":"{{contaSelecionada@nivel}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@nivel"}]},{"$id":"6b419a4b-b36a-4b7b-9dfa-380cd314301c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"conta selecionada\"","$invalid":false,"settings":{"extras":{},"category":"conta selecionada","action":"{{contaSelecionada}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}]},{"$id":"bbb5d332-653c-47e4-953c-25b7b123d409","$typeOfContent":"","type":"TrackEvent","$title":"Track \"permissoes\"","$invalid":false,"settings":{"extras":{},"category":"permissoes","action":"{{permissionList}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"permissionList"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a08748b9-8ebe-4a28-9300-11708bcf1f48","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d37a35e8-d198-4b07-83f8-577f2514bff7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9b7ad377-f78f-4a2d-b022-615e243af8ff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7643c242-b10a-455c-9881-9180b292de9e","root":false,"$title":"[M.4.0.3][SET] Define permissionamento","$position":{"top":"1469px","left":"2046px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"aabcda13-332c-4868-a539-94742b4f996a":{"$contentActions":[{"action":{"$id":"3fa4fe50-28b7-4174-bcbe-911edc4822f2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c872125f-9ce7-4d7c-ad96-2b58a870d22b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c872125f-9ce7-4d7c-ad96-2b58a870d22b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"94d9340f-cd7b-4473-a0cb-45222bbd3575","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9b561d5a-1ab7-4501-84d9-10c3c309ba9d","type":"text/plain","content":"Só um instante, estou consultando suas informações. ","metadata":{}},"$cardContent":{"document":{"id":"9b561d5a-1ab7-4501-84d9-10c3c309ba9d","type":"text/plain","content":"Só um instante, estou consultando suas informações. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d88875a2-431c-49ef-9932-4ea013cac1dd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75b55cb8-4764-479d-b17d-48776ccc45c9","typeOfStateId":"state","$connId":"con_193","$id":"d53da09d-df70-4ea9-9af0-cc4ed7935cd7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ecbb2796-8351-4012-b5fd-8a923d0c4dbe","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-db545ebd-0c83-46f3-8ab0-37401126920c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-918ad547-d030-4e4f-a572-375c1b2ee5d6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"aabcda13-332c-4868-a539-94742b4f996a","root":false,"$title":"[M.2.0.2][MSG] Aguarde um instante","$position":{"top":"780px","left":"907px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f2933b32-696b-4532-b156-6022f8920fa9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"996e1d79-50b8-43bf-b568-9f25df9faced","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bde1411c-a9a9-49b9-a9d6-b55f37d80834","typeOfStateId":"state","$connId":"con_198","$id":"a2e6f353-e96a-4213-bbe8-0d9f9cad37cb","conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"estabelecimentoPf"}],"$invalid":false},{"stateId":"775e2746-a52f-48d0-9442-e17cd0c2fd82","typeOfStateId":"state","$connId":"con_203","$id":"2ff8fcd3-efd9-4f3b-859c-1378e591076f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["e8bdb0c9-7ac2-4d33-b754-0ce2d7b91015"],"source":"context","comparison":"notEquals","variable":"state.previous.id"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a882e80-ccbf-4c4b-abaf-f4697c6068b1","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"estabelecimentoPfResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"CHT"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/estabelecimentos?cpfCnpj={{contact.extras.cpf}}","responseStatusVariable":"estabelecimentoPfStatus","responseBodyVariable":"estabelecimentoPfResponse"},"conditions":[]},{"$id":"1a9843c8-66df-48ea-8a37-c42946a17b5c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"estabelecimentoPf\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(estabelecimentoPfResponse) {\n\ttry {\n\t\tconst { data } = JSON.parse(estabelecimentoPfResponse)\n\t\tif (data[0].tipoPessoas !== 'F') {\n\t\t\treturn false\n\t\t}\n\t\treturn data[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["estabelecimentoPfResponse"],"outputVariable":"estabelecimentoPf","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"34a962fd-c2f7-4c71-baac-e7f36bb4cd38","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ecList\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tconst ecs = JSON.parse(data).data;\n\t\tconst ecList = ecs.filter((ec) => ec.indSitEC === 'A')\n\t\treturn {\n\t\t\tecList,\n\t\t\tecQuantity: ecList.length,\n\t\t\tallecQuantity:ecs.length\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["estabelecimentoPfResponse"],"outputVariable":"ecList","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5b07a429-fc4f-410f-90f9-de3e666d4766","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-2ceecc8b-50fd-4d85-b85c-9d4120c76a25","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f2933b32-696b-4532-b156-6022f8920fa9","root":false,"$title":"[M.2.0.3][HTTP] Verifica PF","$position":{"top":"906px","left":"279px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bde1411c-a9a9-49b9-a9d6-b55f37d80834":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"827a1448-5d6d-4d45-ae5a-48b65ca9beb2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c004d153-a443-407d-b13e-459ce31bf054","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"permissionList\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyPermissoes, contaSelecionada, listaPermissoes, perfilamentoAtivo) {\n    try {\n        const parsedListaPermissoes = JSON.parse(listaPermissoes);\n        const { nivel } = JSON.parse(contaSelecionada);\n\n        if (nivel.toUpperCase() === 'MASTER' || perfilamentoAtivo == false) {\n            const permissoes = [];\n            Object.values(parsedListaPermissoes).forEach(grupo =>\n                Object.values(grupo).forEach(perm =>\n                    permissoes.push(...perm)\n                )\n            );\n            return [...new Set(permissoes.sort((a, b) => a.localeCompare(b)))]\n        }\n\n        const parsedBodyPermissoes = JSON.parse(bodyPermissoes);\n        let permissoes = [];\n\n        parsedBodyPermissoes.data.forEach(({ codigoGrupo, codigosServicos }) => {\n            if (parsedListaPermissoes[codigoGrupo]) {\n                codigosServicos.forEach(codigoServico => {\n                    const permissoesGrupo = parsedListaPermissoes[codigoGrupo][codigoServico];\n                    if (permissoesGrupo) {\n                        permissoes.push(...permissoesGrupo);\n                    }\n                });\n            }\n        });\n        return [...new Set(permissoes.sort((a, b) => a.localeCompare(b)))]\n    } catch (err) {\n        try {\n            if (perfilamentoAtivo) {\n                const parsedListaPermissoes = JSON.parse(listaPermissoes);\n                const permissoes = [];\n                Object.values(parsedListaPermissoes).forEach(grupo =>\n                    Object.values(grupo).forEach(perm =>\n                        permissoes.push(...perm)\n                    )\n                );\n                return [...new Set(permissoes.sort((a, b) => a.localeCompare(b)))]\n            }\n        } catch (err) {\n            return { error: err.message };\n        }\n        return { error: err.message };\n    }\n}","inputVariables":["bodyPermissoes","contaSelecionada","resource.listaPermissoes","config.perfilamentoAtivo"],"outputVariable":"permissionList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3ad6aa9e-4776-47d4-94df-ceb1c54ec8cb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf, permissionList, estabelecimentoPfResponse) {\n\ttry {\n\t\tconst { codigoEc, nomeRazaoSocial, cnpj } = JSON.parse(estabelecimentoPfResponse)\n\t\treturn {\n\t\t\tcodigoCliente: 'PF',\n\t\t\tbaseDocumento: 'PF',\n\t\t\tagencia: 'PF',\n\t\t\tagenciaCadastroBacen: 'PF',\n\t\t\tconta: 'PF',\n\t\t\tcontaCorrenteSPD: false,\n\t\t\tcanal: 'PF',\n\t\t\tshortname: nomeRazaoSocial,\n\t\t\tusuario: nomeRazaoSocial,\n\t\t\tcodigoSegmento: '00',\n\t\t\tnivel: 'MASTER',\n\t\t\tnomeEmpresa: nomeRazaoSocial,\n\t\t\ttipoPessoa: 'F',\n\t\t\tdoc: cpf,\n\t\t\tnomeCompleto: nomeRazaoSocial,\n\t\t\tprimeiroNome: nomeRazaoSocial.split(' ')[0] || 'PF',\n\t\t\tpermissoes: JSON.parse(permissionList),\n\t\t\tec: codigoEc,\n\t\t\tcodigoEc\n\t\t}\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["contact.extras.cpf","permissionList","estabelecimentoPf"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b5841de8-c458-462c-adb0-194de1ed51ec","$typeOfContent":"","type":"SetVariable","$title":"Set \"selectedEc\" to \"estabelecimentoPfResponse@data\"","$invalid":false,"settings":{"variable":"selectedEc","value":"{{estabelecimentoPf}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"estabelecimentoPfResponse@data"}]},{"$id":"4f7057d5-d1db-4993-b802-69bc31ec1282","$typeOfContent":"","type":"TrackEvent","$title":"Track \"conta selecionada pf\"","$invalid":false,"settings":{"extras":{},"category":"conta selecionada pf","action":"{{contaSelecionada}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}]},{"$id":"5821dfe2-e794-4518-b070-9fdb2cd2be43","$typeOfContent":"","type":"SetVariable","$title":"Set \"authenticated\" to \"{idSessao}\"","$invalid":false,"settings":{"variable":"authenticated","value":"{{idSessao}}"},"conditions":[]},{"$id":"622e199c-f03f-4a50-8cd3-d1047cb84268","$typeOfContent":"","type":"SetVariable","$title":"Set \"apiStatus\" to \"ok\"","$invalid":false,"settings":{"variable":"apiStatus","value":"ok"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7abf6659-3ea3-4712-b5eb-3a66dd370f46","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-15ed547f-08e4-46bd-9e2c-8d8ef2c742e8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c0125070-c3bd-4e10-a8da-87d68d93337e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"bde1411c-a9a9-49b9-a9d6-b55f37d80834","root":false,"$title":"[M.2.0.4][SET] contaSelecionada e ecSelecionado","$position":{"top":"694px","left":"280px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ed2a5fb2-da6f-4961-b14d-e302fa57b991":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2277261f-1fd3-4041-ad2a-494985ee2067","typeOfStateId":"state","$connId":"con_208","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Renegociação\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Carta Serasa\",\n\t\t\t\t\"description\": \"\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, sobre *renegociação*, do que você precisa?` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1fd42388-8fed-4d63-804a-cd7cdc79184c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8169e0b4-07f2-46bb-9f69-4c239ef5e933","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-243b8479-8bf1-4a62-8f27-1ff6272250e4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","root":false,"$title":"[M.5.5.1][MSG] Renegociação","$position":{"top":"2256px","left":"2304px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2277261f-1fd3-4041-ad2a-494985ee2067":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5712e2bb-cd2e-4766-ae4a-0a0f88f24c55","typeOfStateId":"state","$connId":"con_213","$id":"6762b970-8ffd-448e-b622-49e20c1d7953","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1992db4b-96ce-47f0-bd23-02eafa99af11","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f87baf4-6ccf-4816-bb97-e02b7aa88ebf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-aef596aa-2a02-434c-856d-0e78c3e896a5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c6cbde70-e7f5-4f52-ad09-1569db8e75ce","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2277261f-1fd3-4041-ad2a-494985ee2067","root":false,"$title":"[M.5.5.1][INPUT] Renegociação","$position":{"top":"2256px","left":"2543px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"755e4959-d2d9-4645-8fe7-00f896ba0475":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dcb587b3-248f-4f31-b13d-cadd59c0fb61","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"384b6397-2b2e-4808-af80-3c5540244ccf","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"755e4959-d2d9-4645-8fe7-00f896ba0475","root":false,"$title":"[GO TO][Redirect] Menu produtos","$position":{"top":"2024px","left":"2050px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c9417e98-f984-43b7-a88a-e61ba1687105":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17659cb5-b9cb-435f-8276-aff558a0ec09","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"755e4959-d2d9-4645-8fe7-00f896ba0475","typeOfStateId":"state","$connId":"con_218","$id":"41f21cf1-ea48-43a2-8680-823d79dadbc0","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"natureza"}],"$invalid":false},{"stateId":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","typeOfStateId":"state","$connId":"con_223","$id":"b80834e1-96a3-4c13-a330-347f1aeaa030","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"74468b7c-274c-4ee0-8495-575bab43bd11","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"cartaSerasaResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"IPJ","Safra-Correlation-ID":"{{idSessao}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/serasa/documentos?tipoPessoa={{contaSelecionada@tipoPessoaCode}}&baseDocumento={{contaSelecionada@baseDocumento}}","responseStatusVariable":"cartaSerasaStatus","responseBodyVariable":"cartaSerasaResponse"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"natureza"}]},{"$id":"fbe08ff3-fccc-4721-9c4b-289850945adc","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/serasa/documentos?tipoPessoa=F&baseDocumento={{contaSelecionada@baseDocumento}} | GET | {{cartaSerasaStatus}} | {{cartaSerasaResponse}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"natureza"}]},{"$id":"702086fe-456c-463f-978e-4cc2bf8dbc67","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"natureza\"","$invalid":false,"settings":{"function":"run","source":"function run(cartaSerasa) {\n\ttry {\n\t\tconst { anotacoes } = JSON.parse(cartaSerasa).data\n\t\tconst anotacoesFiltradas = anotacoes.filter(anotacao => anotacao.natureza.toLowerCase() === 'pefin')\n\t\tif (anotacoesFiltradas.length === 0) {\n\t\t\treturn false\n\t\t}\n\t\tconst ocorrencias = anotacoesFiltradas.some(anotacao => anotacao.ocorrencias.some(ocorrencia => ocorrencia.natureza.toUpperCase() === 'VM'))\n\t\tif (ocorrencias) {\n\t\t\treturn 'VM'\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["cartaSerasaResponse"],"outputVariable":"natureza","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"natureza"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd7ac5d1-dcf9-461c-a331-2294e82de210","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-6bd4d1a0-b008-45ab-b701-c3b57dca7e9f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-333bb05d-4f75-4a19-a14b-2eed17714d5d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"c9417e98-f984-43b7-a88a-e61ba1687105","root":false,"$title":"[M.5.5.0][HTTP] Verifica carta serasa","$position":{"top":"2245px","left":"2050px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5712e2bb-cd2e-4766-ae4a-0a0f88f24c55":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"53ecccb3-e087-49da-8667-d20438985d9a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8d3a9912-951d-4bfc-ac47-2a281fc57f02","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"Caca_POS\"","$invalid":false,"settings":{"variable":"atendimento","value":"Caca_POS"},"conditions":[]},{"$id":"b0e87449-cedc-4403-99b9-f0a312c926bd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Whatsapp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: \"Caca_POS\",\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a70cb04f-0d4c-47b7-8093-5e2df5401351","$typeOfContent":"","type":"SetVariable","$title":"Set \"msg\" to \"\"","$invalid":false,"settings":{"variable":"msg"},"conditions":[]},{"$id":"c9b1067a-9377-4513-b20a-b8916212b51c","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"possuiMovimentacaoResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/movimentacoes/verificar?codigoEC={{contaSelecionada@ec}}&qtdDiasApuracao=40","responseStatusVariable":"possuiMovimentacaoStatus","responseBodyVariable":"possuiMovimentacaoResponse"},"conditions":[]},{"$id":"5027774e-ab70-4033-8755-d02bdad8edcd","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/movimentacoes/verificar?codigoEC={{contaSelecionada@ec}}&qtdDiasApuracao=40 | GET | {{possuiMovimentacaoStatus}} | {{possuiMovimentacaoResponse}}"},"conditions":[]},{"$id":"0f7ba8ea-1b21-431f-92a7-ced3d7a0d706","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{possuiMovimentacaoStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"possuiMovimentacaoStatus"}]},{"$id":"99c24419-0295-4d86-a26a-58a2ae6eca97","$typeOfContent":"","type":"SetVariable","$title":"Set \"possuiMovimentacao\"","$invalid":false,"settings":{"variable":"possuiMovimentacao","value":"{{possuiMovimentacaoResponse@data.possuiMovimentacao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"possuiMovimentacaoResponse@data.possuiMovimentacao"}]}],"$leavingCustomActions":[{"$id":"271f6538-acf2-4082-bbbc-5a1cbe0b5201","$typeOfContent":"","type":"TrackEvent","$title":"Track \"consolidado api request\"","$invalid":false,"settings":{"extras":{"contaSelecionada":"{{contaSelecionada}}","idSessao":"idSessao","identity":"{{contact.identity}}"},"category":"consolidado api request","action":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/movimentacoes/verificar?codigoEC=contaSelecionada@ec&qtdDiasApuracao=40 | {{possuiMovimentacaoStatus}}"},"conditions":[]},{"$id":"899b0fcf-a95a-42db-ab36-2b708dd3f4c9","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"caca_pos"},"address":"WhatsApp PJ"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-85f59604-4dbf-409d-ae1e-aca5bdfc7777","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-66051ef9-e068-4945-84f2-31a7fac5500c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3fedf138-1e1a-4b9e-85e4-eaa99940ecfc","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f706c6ca-eae3-47be-9e93-bff390c9f7fa","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-48ac091f-1bc6-40ff-a28b-161ceffb48c1","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5712e2bb-cd2e-4766-ae4a-0a0f88f24c55","root":false,"$title":"[Redirect] to WhatsApp PJ (Caca_POS)","$position":{"top":"2244px","left":"2772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8bdb0c9-7ac2-4d33-b754-0ce2d7b91015":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"34120cc9-a2c3-4e91-ba2d-f37b270730d7","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2933b32-696b-4532-b156-6022f8920fa9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e8bdb0c9-7ac2-4d33-b754-0ce2d7b91015","root":false,"$title":"[GO TO][M.2.0.3][HTTP] Verifica PF","$position":{"top":"1314px","left":"1229px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"01a08c4d-c367-434b-8b4c-1f00f39ad7a5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'f2c4d052-2f9b-4aa8-9925-48aa824fc35c',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1fcbc09f-4e87-4048-8b38-9d133ae4376b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-72f891bb-a7b4-42c2-92db-7a11b94e3261","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"01a08c4d-c367-434b-8b4c-1f00f39ad7a5","root":false,"$title":"[Redirect] To \"Autenticacao\"","$position":{"top":"1837px","left":"2042px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true}},"configuration":{"builder:minimumIntentScore":"0.65","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/devspdmain2","builder:useTunnelOwnerContext":"true","builder:stateExpiration":"0.00:15:00","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","env":"Dev","bot":"Bot Main Dev","serviceName":"Bot Main Dev","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8289653d-805d-4f39-8379-c506c2360cca","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = !regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    const state = JSON.parse(voltarState)\n    try {\n        if (!voltarState) {\n            const state = {}\n            state[botOrigin] = [blockId]\n            return state\n        }\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}