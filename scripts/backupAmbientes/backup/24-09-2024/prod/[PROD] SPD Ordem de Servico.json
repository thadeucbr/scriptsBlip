{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"5411fbe0-034c-43b1-b7ca-875eeb2d3037","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"d0614c9a-d900-4226-8861-4f98cf8f9f5a","conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"blockDestinationId"}],"$invalid":false},{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"7d8fc905-331d-431c-bf44-9d4acb367815","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"708c4f89-8669-45b0-8509-7eeaa871ef9f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"37321bf8-0e7d-470d-968a-59681c18f640","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4d9b281c-4c03-4a43-8bc3-2d4025467aa3","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-1293d711-aa71-4df1-8d90-4f3433ab94e5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1d5508d7-5626-44d7-9dad-0df9bcfc99ea","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9e209aef-bf7a-44e2-a34a-fdbd934afe34","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d2c7e728-6c47-4b17-a62c-5393cee1ad3c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"398px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"16b76ac0-0b7b-4cc7-b08f-734f14211c35","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"c213efed-ef4f-428e-a007-1bfab601d137","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[{"$id":"d579f0be-f77a-4125-a795-dbd07cbfc0e6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: 'cascata',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"error","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-10d3c3da-991d-4f5a-a03d-6db9021f4a7b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"145px","left":"714px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"826eebc0-5c19-4067-9030-b50d65db86f0","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db","typeOfStateId":"state","$connId":"con_13","$id":"c6bb96ee-88fa-431d-8176-290906d11cb6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"welcome","$title":"[OS.1.0.0] Menu inicial (vazio)","$position":{"top":"623px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aff15d5d-1d32-4603-8a24-23c689e82d9f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"0daf7077-0424-4321-a919-50b1bf44411a","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-663c1234-16d2-4e64-9581-9df7addfb599","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"error","$title":"[Redirect] cascata","$position":{"top":"311px","left":"714px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c8cfe224-4cd0-4ed5-b8a3-670826decce3":{"$contentActions":[{"action":{"$id":"16901986-2f78-4444-83eb-a44ec6edae11","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"23064fa9-1004-4487-a55e-d95c7cfdee67","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"23064fa9-1004-4487-a55e-d95c7cfdee67","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"09c1036a-5dec-4a5e-b826-904c18c5e81d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2ae79b4f-d03b-4ae0-aba1-da0afb5a8f52","type":"text/plain","content":"Não foram encontradas ordens de serviço.","metadata":{}},"$cardContent":{"document":{"id":"2ae79b4f-d03b-4ae0-aba1-da0afb5a8f52","type":"text/plain","content":"Não foram encontradas ordens de serviço."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f1f6fd23-1872-4ac0-a46d-fee5940d3f93","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"07ce4c3b-9ead-4f5b-9e29-6cf7cb07b925","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-59983a0a-9cd6-411b-9608-15a684846040","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bbda307c-9483-4035-a8d5-3d965b4ac4c7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c8cfe224-4cd0-4ed5-b8a3-670826decce3","root":false,"$title":"[OS.2.0.1] Sem ordens de serviço","$position":{"top":"1085px","left":"1092px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"01384329-fe1a-4363-9269-8506cb22a57b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c8cfe224-4cd0-4ed5-b8a3-670826decce3","typeOfStateId":"state","$connId":"con_18","$id":"c9d4c510-5dfe-466a-9d67-8fd0c88d8d18","conditions":[{"source":"context","comparison":"lessThan","values":["1"],"variable":"ordensDeServico@quantidade"}],"$invalid":false},{"stateId":"13044285-94b8-4147-be1a-69b7d822a20c","typeOfStateId":"state","$connId":"con_23","$id":"c2de64fe-676e-404c-bb5b-9e947fda2738","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ordensDeServico@quantidade"}],"$invalid":false},{"stateId":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","typeOfStateId":"state","$connId":"con_28","$id":"0288bedd-821b-4ce2-b1b8-7a08f8009d75","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"ordemSelecionada"}],"$invalid":false},{"stateId":"13044285-94b8-4147-be1a-69b7d822a20c","typeOfStateId":"state","$connId":"con_33","$id":"2a402962-4fb4-4fbd-933e-f28bd848a85a","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"ordensDeServico@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0712f016-6292-4ee0-83b4-0642cbdca179","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyOrdernsDeServicos\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/vendas-servicos/vendas/tracking-credenciadoras/v1/ordens-servicos?documento={{contaSelecionada@doc}}","responseStatusVariable":"statusOrdensDeServicos","responseBodyVariable":"bodyOrdensDeServicos"},"conditions":[]},{"$id":"b644474d-1e2c-4e96-9c5b-a3e08df1ee18","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordensDeServico\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyOrdensDeServico) {\n\ttry {\n\t\tconst { data } = JSON.parse(bodyOrdensDeServico)\n\t\treturn {\n\t\t\tordens: data.detalhe,\n\t\t\tquantidade: data.detalhe.length\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tordens: [],\n\t\t\terror: err.message,\n\t\t\tquantidade: 0\n\t\t}\n\t}\n}","inputVariables":["bodyOrdensDeServicos"],"outputVariable":"ordensDeServico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"13a6f5ab-f968-4ee4-8e37-de760d87214e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1b97622e-0a7f-47a3-9edb-9c8f6f24e5f5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordemSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ordens) {\n\ttry {\n\t\tconst { ordens, quantidade } = JSON.parse(ordens)\n\t\tif (quantidade == 1) {\n\t\treturn ordens[0]\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["ordensDeServico"],"outputVariable":"ordemSelecionada","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-11955cbd-6beb-4900-bb99-63e61d3499ec","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f05b3f4c-5e82-419e-836c-0bdc9a599b11","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fa3a10c8-c4c6-4071-ab9d-bbbf6ddda706","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db","root":false,"$title":"[OS.2.0.0] Consultar Ordens de Serviço","$position":{"top":"1073px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3fc1e4ae-ec02-4487-af4b-935157cee4a0":{"$contentActions":[{"action":{"$id":"7cc16948-8367-4416-ad37-578c8726e6b5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"24efe6bf-a419-4865-8f78-ffa115030afe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"24efe6bf-a419-4865-8f78-ffa115030afe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f0536076-d120-439d-8376-f2bc8247f9f6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f6551f22-407b-4429-8230-5ccd5e8a8605","type":"text/plain","content":"{{msgOrdemDeServico}}","metadata":{}},"$cardContent":{"document":{"id":"f6551f22-407b-4429-8230-5ccd5e8a8605","type":"text/plain","content":"{{msgOrdemDeServico}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"045f315b-96e7-4306-b361-9ee01cd3603e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"d20bdbe8-2ab9-441c-b88b-c057938a742a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOrdemDeServico\"","$invalid":false,"settings":{"function":"run","source":"function parseDateTime(date) {\n\ttry {\n\t\tconst [ano, mes, dia] = date.split('T')[0].split('-')\n\t\tconst [hora, minuto] = date.split('T')[1].split(':')\n\t\treturn `${dia}/${mes}/${ano}`\n\t} catch (err) {\n\t\treturn date\n\t}\n}\n\nfunction run(ordemSelecionada) {\n\ttry {\n\t\tconst { numero, observacao, dataAbertura, dataFechamento, motivoStatus } = JSON.parse(ordemSelecionada)\n\t\tlet msg = `Aqui está sua <b>Ordem de Serviço</b>:\n\t\t\n<b>Ordem:</b> ${numero} - ${observacao}\n<b>Data de abertura:</b> ${parseDateTime(dataAbertura)}`\n\t\tif(motivoStatus) {\n\t\t\tmsg += `\\n<b>Detalhamento do status:</b> ${motivoStatus}`\n\t\t}\n\t\tif (dataFechamento) {\n\t\t\tmsg += `\\n<b>Data de fechamento:</b> ${parseDateTime(dataFechamento)}`\n\t\t}\n\t\treturn msg\n\t} catch (err) {\n\t\treturn `Ops, algo deu errado!`\n\t}\n}","inputVariables":["ordemSelecionada"],"outputVariable":"msgOrdemDeServico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c242c11-53aa-4536-bb7a-1ed180dc4085","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bb582402-f4a6-4287-9662-e410e2f627cd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8ef4c1ce-372f-4c8b-92c9-9eda00667aa5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-119eebee-e96c-4781-b9a0-4dbe9737dadf","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","root":false,"$title":"[OS.2.1.1] Exibir ordem de serviço","$position":{"top":"1278px","left":"1679px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8dfeba9-bad4-435d-ab4a-f95e575eddfa":{"$contentActions":[{"action":{"$id":"f0d853a2-3722-4621-a960-85f10bf68a92","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b986d835-6a06-497d-9b92-2efe05e4d93b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b986d835-6a06-497d-9b92-2efe05e4d93b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"05ea6ab2-057d-4ba1-95a9-dccf45e750e8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f3415afa-6d75-4cf0-a055-7c7fd63b2b80","type":"text/plain","content":"Por gentileza, digite o número da ordem de serviço.","metadata":{}},"$cardContent":{"document":{"id":"f3415afa-6d75-4cf0-a055-7c7fd63b2b80","type":"text/plain","content":"Por gentileza, digite o número da ordem de serviço."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7020d498-7d0e-4fa2-b2a9-87a0b9932502","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5b54c9b7-5aba-4b41-b696-0437605aa6c2","typeOfStateId":"state","$connId":"con_38","$id":"f1521bfd-b1b5-4f70-8eae-0cd3ad631495","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0076522b-bd01-49e1-bca4-cda1990847c3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4ac44125-d74f-458c-89a9-bf4fb9114409","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-293008db-12c7-4173-8dc7-e4c3b6f243fd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","root":false,"$title":"[OS.2.3.0] Solicita numero da ordem de serviço","$position":{"top":"1929px","left":"1077px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"050272ed-7e5b-41f2-a8a4-566639ef9b4d":{"$contentActions":[{"action":{"$id":"370eace4-f748-4e6a-a4de-ef8435d4b5d0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1a633c3f-8e37-4e10-9fd9-7998fa29c847","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1a633c3f-8e37-4e10-9fd9-7998fa29c847","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7d3c7f7a-1cd0-4625-bf47-abb3ecaef27e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"4bcaa3e5-231a-4810-8b29-ec84d30564d9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbe4955f-783e-4612-ad54-4c50bc00a196","typeOfStateId":"state","$connId":"con_43","$id":"31a037eb-2aae-48f5-8268-3d59d6d8af04","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e8606010-fc52-4b27-840a-3fd919ba8e16","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst headerText = \"Certo, você possui o número da ordem de serviço que deseja consultar?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7e7690db-a508-4e23-bef3-61001254ca22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"050272ed-7e5b-41f2-a8a4-566639ef9b4d","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-27a2d68d-e7fe-4b3b-b96b-a67eb0d176fc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9d045a56-8420-4298-9008-22d2301f74b4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-36c25fbe-ac84-42cf-b7ae-913a3142050c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"050272ed-7e5b-41f2-a8a4-566639ef9b4d","root":false,"$title":"[OS.2.2.0] Possui o número da ordem?","$position":{"top":"1725px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"95569003-63b3-4ba9-b3cf-9f5728e2ad98":{"$contentActions":[{"action":{"$id":"78477448-78e0-4a09-a042-c3fb6c5ab6fb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"336d8a11-e2db-42bd-b4e4-faaf9a640d15","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"336d8a11-e2db-42bd-b4e4-faaf9a640d15","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f7682a6e-81df-4e51-979e-02204ba2e9d8","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ba9bb29-f01c-4ecd-9260-669b4676d079","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7c95dbd3-c3cf-4a8e-bccb-bd3879a17c2c","typeOfStateId":"state","$connId":"con_48","$id":"5955bcd9-7d48-4e46-8c19-7a0204991049","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a1641a9c-b82b-4bc3-9ef5-a1caf18528e5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Tentar novamente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Encerrar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst headerText = \"v\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ae6d5bd0-0b12-4403-8032-6bdc3d968806","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0ea0d20a-d809-4739-99ca-a54b5d220053","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-03eb23e5-3ca0-4180-aaf2-b18bbf51dc2e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7e22f6dc-2288-4f45-99d0-f81a815d0a73","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"95569003-63b3-4ba9-b3cf-9f5728e2ad98","root":false,"$title":"[OS.2.2.1] Não possui o numero da OS","$position":{"top":"1929px","left":"1673px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5c39115b-5993-40d6-992b-12d3e5dc4201":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9778ae8b-b065-4d03-b337-576fae1afc1e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"5c39115b-5993-40d6-992b-12d3e5dc4201","root":false,"$title":"T -> [OS.2.0.0] Consultar ordens de serivço","$position":{"top":"2307px","left":"1673px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"13044285-94b8-4147-be1a-69b7d822a20c":{"$contentActions":[{"action":{"$id":"5920c12f-007f-49fa-b210-9f02851930a9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b5570e59-5004-4b76-950f-5cbcace7e49d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b5570e59-5004-4b76-950f-5cbcace7e49d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c4770493-1de9-4e4f-8c59-8b4d449b3ada","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b5462fcc-0ec9-4bde-9c18-bc9ecdcaa809","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"80abcb78-a29d-41d9-aacc-09c023ed74ee","typeOfStateId":"state","$connId":"con_53","$id":"8a65b97e-2941-4d5f-9b1b-1317598b4703","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"59e0290e-b625-44bd-b35b-29359ebd31c4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(ordensDeServico, contaSelecionada) {\n\ttry {\n\t\tconst { ordens } = JSON.parse(ordensDeServico)\n\t\tconst { primeiroNome } = JSON.parse(contaSelecionada)\n\t\tconst menuButtons = ordens\n\t\t\t.slice(0, 80)\n\t\t\t.sort((a, b) => new Date(b.dataAbertura) - new Date(a.dataAbertura))\n\t\t\t.slice(0, 9).map(ordem => ({ id: ordem.numero, title: `OS:${ordem.numero}`, description: ordem.observacao.slice(0, 71) }))\n\n\t\tif (menuButtons.length === 9) {\n\t\t\tmenuButtons.push({\n\t\t\t\tid: 'digitarOs',\n\t\t\t\ttitle: 'Não encontrei minha O.S',\n\t\t\t\tdescription: 'Digite o número da sua O.S'\n\t\t\t})\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `${primeiroNome}, essas são as suas *Ordens de Serviço* mais recentes:`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Ordens de serviço\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuButtons\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"text\",\n\t\t\t\"text\": {\n\t\t\t\t\"body\": err.message\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["ordensDeServico","contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d8b77aed-2f38-4e06-a481-6d8452e866b2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"13044285-94b8-4147-be1a-69b7d822a20c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3ebf562a-c45f-40bb-b5e2-b4faa6cd4a4a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-32aa44c7-14ab-4430-b1f2-d4e35f57e9ec","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-077d557e-f265-4c72-bde1-6126f596a75e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"13044285-94b8-4147-be1a-69b7d822a20c","root":false,"$title":"[OS.2.1.0] Exibe ordens de serivço","$position":{"top":"1272px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"80abcb78-a29d-41d9-aacc-09c023ed74ee":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b5462fcc-0ec9-4bde-9c18-bc9ecdcaa809","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"050272ed-7e5b-41f2-a8a4-566639ef9b4d","typeOfStateId":"state","$connId":"con_58","$id":"92e610b6-2e7b-4afa-8af5-eb2166f80a42","conditions":[{"source":"context","comparison":"equals","values":["não encontrei"],"variable":"userInput"}],"$invalid":false},{"stateId":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","typeOfStateId":"state","$connId":"con_63","$id":"c2714701-4211-4048-853e-a2d47fab3627","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"6f735b1f-f8e5-4c6c-ae6d-116a621dbeb3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput, ordensDeServico) {\n\ttry {\n\t\tif (!userInput) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tif (userInput.match(/n[ã|a]o encontrei/i)) {\n\t\t\treturn 'não encontrei'\n\t\t}\n\n\t\tconst { ordens } = JSON.parse(ordensDeServico)\n\t\tconst numeroOsSelecionado = userInput.replace(/\\D/g, '')\n\t\tconst ordemSelecionada = ordens.find((ordem) => ordem.numero == numeroOsSelecionado)\n\t\tif (ordemSelecionada) {\n\t\t\treturn ordemSelecionada\n\t\t}\n\t\treturn 'input inesperado'\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["input.content","ordensDeServico"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b63d4a69-c5d4-4664-95f9-0b31d43bc1b5","$typeOfContent":"","type":"SetVariable","$title":"Set \"ordemSelecionada\" to \"{userInput} \"","$invalid":false,"settings":{"variable":"ordemSelecionada","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"a5de9f0b-8db0-4476-b571-e2a6ab654f25","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"e3f73cac-c3f2-40a0-9c6e-f1497c489316","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f9917e2d-e0a2-4851-bf1b-e71e596abb6d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-98516655-e156-4f94-8906-7e48f070a84f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3d699453-25cf-4b3c-b558-8100226fb16b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-624e541a-5658-4e0d-92b7-134960fde9b0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-87a516cb-6116-4aed-bf5a-426d0b89dae2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"80abcb78-a29d-41d9-aacc-09c023ed74ee","root":false,"$title":"[OS.2.1.0] Seleciona ordem de serviço","$position":{"top":"1440px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bbe4955f-783e-4612-ad54-4c50bc00a196":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"4bcaa3e5-231a-4810-8b29-ec84d30564d9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","typeOfStateId":"state","$connId":"con_68","$id":"4df218e3-f74e-4fe1-b034-7aaa52d2a5bf","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"95569003-63b3-4ba9-b3cf-9f5728e2ad98","typeOfStateId":"state","$connId":"con_73","$id":"d668f3b9-29ec-44af-9bb6-339d2a185a1d","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"dc9b6ff7-1fb6-4978-b044-d5aebe213045","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(inputUsuario) {\n  const invalidInputMessage = \"input inesperado\";\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    const regexDictionary = {\n      \"si[mn]|tem|sei\": \"Sim\",\n      \"n[aã]o|n[aã]o tenho\": \"Não\"\n    };\n\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, \"i\").test(inputUsuario.toLowerCase())) {\n        return regexDictionary[regex];\n      }\n    }\n    return invalidInputMessage;\n  } catch (err) {\n    return invalidInputMessage;\n  }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"65ab88e6-c304-4cb0-9176-55e76c5f2ccd","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"9ddb775b-2e44-47e2-80b8-e277dad49019","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"8d506a28-5684-4f1e-bb9a-3e90dab7d953","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":["Sim","Não"],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fcc99d66-17b2-4665-9f33-7e6812b9b224","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8a792e86-3938-449d-8041-796177724fea","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ce8d4005-8041-4ac8-9244-a67d1fab5594","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bfbf4d1d-e9cb-4ce7-b7e2-a49c3b264b46","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bbe4955f-783e-4612-ad54-4c50bc00a196","root":false,"$title":"[OS.2.2.0] Valida se possui o numero da ordem","$position":{"top":"1929px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5b54c9b7-5aba-4b41-b696-0437605aa6c2":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"83779d45-ddd1-4a54-928e-02e33faa16bf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"47ae7cfb-365d-4484-a1e2-83eede1e2980","typeOfStateId":"state","$connId":"con_78","$id":"48141d28-2e99-4dce-9207-4b13f47e3c2a","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"b0de2c29-10b3-4df1-9a84-ee102f5c9ff3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function checkInputType(input) {\n    if (input.includes('latitude') && input.includes('longitude')) {\n        return 'location';\n    } else if (input.includes('phoneNumber') || input.includes('cellPhoneNumber')) {\n        return 'contact';\n    } else if (input.includes('type')) {\n        input = JSON.parse(input);\n        return input.type;\n    }\n\n    return 'text/plain';\n}\n\nfunction run(message) {\n    try {\n            \t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n        const inputType = checkInputType(message)\n        if (inputType !== 'text/plain' || isNaN(message)) {\n            return 'input inesperado'\n        }\n        return message\n    } catch (err) {\n        return err.message\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a509855e-2f1a-46ce-9754-2270e2c05f22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"04388c63-8217-4225-861e-a42fea4d8756","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-44b6c648-b2c9-499b-98e9-b9333b5631b5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-19204522-f655-4a23-9bed-96b3cbcb6a9f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2cf47967-035b-4b4e-a33f-01d6a09ad6be","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"5b54c9b7-5aba-4b41-b696-0437605aa6c2","root":false,"$title":"[OS.2.3.0] Valida numero digitado","$position":{"top":"2177px","left":"1077px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7c95dbd3-c3cf-4a8e-bccb-bd3879a17c2c":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"1a685442-c36d-410c-b814-f8bdc4421011","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5c39115b-5993-40d6-992b-12d3e5dc4201","typeOfStateId":"state","$connId":"con_83","$id":"03b1f528-0be3-4030-a718-d00f42ff029a","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"02033cba-1235-405a-aa48-da0919a895b6","typeOfStateId":"state","$connId":"con_88","$id":"75702183-cf16-4c96-ae48-ec989eb094ae","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"2b707dc7-ba56-4822-9f29-439f371c7235","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(inputUsuario) {\n  const invalidInputMessage = \"input inesperado\";\n  try {\n        \t\tif (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n    const regexDictionary = {\n      \"si[mn]|tem|sei\": \"Sim\",\n      \"n[aã]o|n[aã]o tenho\": \"Não\"\n    };\n\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, \"i\").test(inputUsuario.toLowerCase())) {\n        return regexDictionary[regex];\n      }\n    }\n    return invalidInputMessage;\n  } catch (err) {\n    return invalidInputMessage;\n  }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5a0383f1-9b94-41ed-a0ea-0d90ec92a963","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"efdf793a-d962-4818-8682-702d975a8611","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"492ac110-29d9-4b92-b7fa-09fc7926b0c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9124fb1-5b93-44f1-b9d1-4dbfe0c20b47","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-24a6a3cc-4ef5-4eb5-9aae-7e1fbda95f8e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c0ea1ebf-d01a-4365-bce2-d6ad60cea4da","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8612449f-1d7c-4a2d-adb2-5adb86102386","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7c95dbd3-c3cf-4a8e-bccb-bd3879a17c2c","root":false,"$title":"[OS.2.2.1] Valida se quer tentar novamente","$position":{"top":"2119px","left":"1673px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"47ae7cfb-365d-4484-a1e2-83eede1e2980":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28f4f6ba-6cb4-43ba-8bff-77d86f6420f6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7e355c61-75b8-4493-a5f3-12aba597f4b3","typeOfStateId":"state","$connId":"con_93","$id":"cdcece4a-99e7-4032-a5a1-40e886bf9e2a","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"ordemSelecionada"}],"$invalid":false},{"stateId":"a8969fc6-4d34-43b6-895f-bfc5e97286a7","typeOfStateId":"state","$connId":"con_98","$id":"c8939d3b-4d81-4b54-b280-e4daeb8443fb","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"ordemSelecionada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"090f7b10-83d8-4389-bcdb-f9305226f489","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyOrdernsDeServicos\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/vendas-servicos/vendas/tracking-credenciadoras/v1/ordens-servicos/{{userInput}}","responseStatusVariable":"statusOrdensDeServicos","responseBodyVariable":"bodyOrdensDeServicos"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"421ecd7e-ad51-44d5-b10c-31cb38a9047c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordensDeServico\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyOrdensDeServico) {\n\ttry {\n\t\tconst { data } = JSON.parse(bodyOrdensDeServico)\n\t\treturn {\n\t\t\tordens: data.detalhe,\n\t\t\tquantidade: data.detalhe.length\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tordens: [],\n\t\t\terror: err.message,\n\t\t\tquantidade: 0\n\t\t}\n\t}\n}","inputVariables":["bodyOrdensDeServicos"],"outputVariable":"ordensDeServico","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"fa20cf58-d597-44f0-8865-bb13a5ddbcdd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordemSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ordens) {\n\ttry {\n\t\tconst { ordens, quantidade } = JSON.parse(ordens)\n\t\tif (quantidade == 1) {\n\t\treturn ordens[0]\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["ordensDeServico"],"outputVariable":"ordemSelecionada","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dcedea26-b56d-4f54-8792-50f3d2336843","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-bc5e55a6-7f25-4ef0-ad87-be1a60552a93","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"47ae7cfb-365d-4484-a1e2-83eede1e2980","root":false,"$title":"[OS.2.4.0] Consulta OS pelo número","$position":{"top":"2356px","left":"1077px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7e355c61-75b8-4493-a5f3-12aba597f4b3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fb95e6bb-652b-4613-8efb-189d3ed093b4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7e355c61-75b8-4493-a5f3-12aba597f4b3","root":false,"$title":"T -> [OS.2.1.1] Exibir ordem de serviço","$position":{"top":"2367px","left":"1311px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8969fc6-4d34-43b6-895f-bfc5e97286a7":{"$contentActions":[{"action":{"$id":"bd0405b7-6cf9-4b9a-863c-ccc083f357ae","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"776705a2-3958-4e06-877f-8c6384ce2bbd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"776705a2-3958-4e06-877f-8c6384ce2bbd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3e21768b-8e63-4712-b752-6c718f463167","$typeOfContent":"text","type":"SendMessage","settings":{"id":"afad0cd7-1388-4815-93f0-d9279b09e4d4","type":"text/plain","content":"Não consegui encontrar uma ordem de serviço com esse número: *{{userInput}}*","metadata":{}},"$cardContent":{"document":{"id":"afad0cd7-1388-4815-93f0-d9279b09e4d4","type":"text/plain","content":"Não consegui encontrar uma ordem de serviço com esse número: *{{userInput}}*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"93eee8ba-8b90-4162-b43e-5f9088eb32ef","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c9bc1cc0-ef2b-408a-b99b-3edc06a03778","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c9bc1cc0-ef2b-408a-b99b-3edc06a03778","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"06a02668-1ebf-44c0-825e-30d893c892bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"002ef0e6-8b0e-441b-a666-c6c1d0f0db2c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a3526248-5e5a-4772-a3a1-ba6fc20bc45f","typeOfStateId":"state","$connId":"con_103","$id":"d37ec527-4cba-47c7-bdb1-6999bc271381","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"83d9a029-0532-4232-8641-b4d20b6e2a6b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst headerText = \"Quer tentar novamente?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d2af8822-0892-4960-8b28-053d67f40436","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0aac046b-3073-418b-ab9c-d98e9f39a0e9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bfe4253c-6d5d-4ddb-9e14-e8695f562ef2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-04c240a5-217d-45ab-a18d-372efb4d0c25","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a8969fc6-4d34-43b6-895f-bfc5e97286a7","root":false,"$title":"[OS.2.4.1] OS Não encontrada","$position":{"top":"2558px","left":"1077px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a3526248-5e5a-4772-a3a1-ba6fc20bc45f":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c338c673-c741-46b0-b544-e2898fd082d9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","typeOfStateId":"state","$connId":"con_108","$id":"d0abb0b0-871b-4272-b2e3-219fb6b99c20","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"83aab034-b5d7-4f25-8c39-dbf330e6550a","typeOfStateId":"state","$connId":"con_113","$id":"a168f4fa-3148-4b14-bd11-d3fe352185f0","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a2d3e65e-580d-4bbb-bee2-210dfac0a796","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(inputUsuario) {\n  const invalidInputMessage = \"input inesperado\";\n  try {\n        \t\tif (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n    const regexDictionary = {\n      \"si[mn]|tem|sei\": \"Sim\",\n      \"n[aã]o|n[aã]o tenho\": \"Não\"\n    };\n\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, \"i\").test(inputUsuario.toLowerCase())) {\n        return regexDictionary[regex];\n      }\n    }\n    return invalidInputMessage;\n  } catch (err) {\n    return invalidInputMessage;\n  }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b4f751c-54fa-4a9a-b7dc-d572c3d20494","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"38a3109d-241a-46b1-912e-09f4ede97eb8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"0055521b-4631-47c1-839c-38926c4c65d3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-073146f0-9fd8-4702-8675-397adab571d9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b086346c-27cb-47f2-bb8a-ed0953eee90c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-59059f91-00cd-4bf5-810d-5f160bd61140","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-257fe1f0-404e-49c4-8811-a76953b5d7bb","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a3526248-5e5a-4772-a3a1-ba6fc20bc45f","root":false,"$title":"[OS.2.4.1] Valida input OS Não encontrada","$position":{"top":"2242px","left":"721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ffd9b720-683d-4d20-b51b-5e24ef2059b0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8114a3c9-e406-40d8-afe3-ee7ce4894c17","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3609e45c-d5c1-4815-8b62-a12eb02fc4f2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || ''}`.trim(),\n\t\t\tstateDestination: 'onboarding',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"19eaac42-0b42-463b-b999-2cf455941e7a","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a4c62987-f129-4b77-b7c2-f1ed7237a266","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-05c0ff0f-1c59-436d-a0b6-b3779bd3beaf","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","root":false,"$title":"[Redirect] Finalização","$position":{"top":"152px","left":"1814px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"83aab034-b5d7-4f25-8c39-dbf330e6550a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"58d1de0f-9e5e-4d4d-9e94-b97846ab1128","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"83aab034-b5d7-4f25-8c39-dbf330e6550a","root":false,"$title":"T -> Finalização","$position":{"top":"2276px","left":"438.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"02033cba-1235-405a-aa48-da0919a895b6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"74e9d6a5-8fd9-49af-bd5c-29a71c5843f9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"02033cba-1235-405a-aa48-da0919a895b6","root":false,"$title":"T -> Finalização","$position":{"top":"2153px","left":"1917px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","urlCHT":"https://api.safra.com.br","serviceName":"Bot OS","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/prodspdordemdeservico","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a9c61922-e070-489d-a5a4-7aae9c197025","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"currentDate\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return getFormatDate();\n}\n\nfunction getFormatDate() {\n    const dataAtual = new Date();\n\n    const getDay = String(dataAtual.getDate()).padStart(2, '0');\n    const getMonth = String(dataAtual.getMonth() + 1).padStart(2, '0');\n    const getYear = dataAtual.getFullYear();\n    const getHour = String(dataAtual.getHours()).padStart(2, '0');\n    const getMinutes = String(dataAtual.getMinutes()).padStart(2, '0');\n    const getSeconds = String(dataAtual.getSeconds()).padStart(2, '0');\n\n    return `${getDay}/${getMonth}/${getYear}`;\n}","inputVariables":[],"outputVariable":"currentDate","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fc800b6c-83b4-4945-88bc-622e95112822","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    if (!voltarState) {\n        const state = {}\n        state[botOrigin] = [blockId]\n        return state\n    }\n    const state = JSON.parse(voltarState)\n    try {\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}