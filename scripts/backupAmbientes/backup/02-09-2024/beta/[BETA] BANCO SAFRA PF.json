{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"Inicio"},"editable":false,"deletable":false,"position":"right"},"$invalid":false,"variable":"Inicio"},"$invalid":false,"$$hashKey":"object:50912"}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"a9b1a209-9569-4cea-ad23-18eb18c623ad","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId","$$hashKey":"object:50925"}],"$invalid":false,"$$hashKey":"object:50915"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"ExecuteScript","$title":"PHONENUMBER","$invalid":false,"settings":{"function":"run","source":"     function run(identity) {\n\n                if(identity.split(\"@\")[1] == \"wa.gw.msging.net\"){\n\n                var resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2,identity.length);\n\n               \n                      if(resultPhoneWithoutCode.length < 11){\n\n                      var newArraySplice = resultPhoneWithoutCode.split(\"\");\n                       var returnNewArraySplice =  newArraySplice.splice(2,0,\"9\");\n\n                       return newArraySplice.join(\"\")\n\n                      }else{\n\n\n                        return resultPhoneWithoutCode\n                      }\n                  \n\n                }\n\n                return identity\n\n            }","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8fde23c5-f72e-4b99-846b-ac75d27b90e4","$typeOfContent":"","type":"ExecuteScript","$title":"DDD","$invalid":false,"settings":{"function":"run","source":"function run(phoneNumber) {\n\n                if(phoneNumber != \"\"){\n                    return ddd = phoneNumber.substr(0, 2);\n                }\n\n                return \"\";\n            }","inputVariables":["phoneNumber"],"outputVariable":"ddd","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"20459279-16f7-4c5c-991b-918617f6077f","$typeOfContent":"","type":"ExecuteScript","$title":"TELEFONE SEM DDD","$invalid":false,"settings":{"function":"run","source":"function run(phoneNumber) {\n\n                if(phoneNumber != \"\"){\n                    return ddd = phoneNumber.substr(2);\n                }\n\n                return \"\";\n            }","inputVariables":["phoneNumber"],"outputVariable":"telefoneSemDDD","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"26f66d7f-421f-4ff1-8afd-1879e21a7746","$typeOfContent":"","type":"SetVariable","$title":"agenciaPiloto","$invalid":false,"settings":{"variable":"agenciaPiloto","value":"-"},"conditions":[]},{"$id":"660ba25b-75e2-4672-8652-644dba78632a","$typeOfContent":"","type":"SetVariable","$title":"broadcastComercial","$invalid":false,"settings":{"variable":"broadcastComercial","value":"false"},"conditions":[]},{"$id":"2b6bb731-fc6b-4469-9d81-fd00252fd3b4","$typeOfContent":"","type":"SetVariable","$title":"broadcastAg2","$invalid":false,"settings":{"variable":"broadcastAg2","value":"false"},"conditions":[]},{"$id":"2d773357-acb9-4b5f-b15b-e1b1ddd2da16","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"origemCampanhaPadrao\"","$invalid":false,"settings":{"function":"run","source":"function run(calendarDatetime, inputMessage, inputContent, broadcast, identity) {\n    const date = new Date(calendarDatetime);\n    \n    const dataFormatada = dataAtualFormatada(date);\n    let metadataCampanha = metadata(inputMessage);\n    const origem = origemCampanha(inputContent, metadataCampanha, broadcast);\n    const canal = origemCanal(identity);\n    metadataCampanha = metadataCampanha != \"\" ? metadataCampanha : \"nao possui campanha\";\n\n    const trackOrigemCampanha = `${dataFormatada} | ${identity} | ${metadataCampanha} | ${canal} | ${origem} | ${inputContent}`\n    \n    return { \n        trackOrigemCampanha,\n        canal\n    };\n}\n\nfunction dataAtualFormatada(data) {\n    const dia = data.getDate().toString();\n    const diaF = (dia.length == 1) ? '0' + dia : dia;\n    const mes = (data.getMonth() + 1).toString(); //+1 pois no getMonth Janeiro começa com zero.\n    const mesF = (mes.length == 1) ? '0' + mes : mes;\n    const anoF = data.getFullYear();\n    const hora = data.getHours().toString();\n    const horaF = (hora.length == 1) ? '0' + hora : hora;\n    const min = data.getMinutes().toString();\n    const minF = (min.length == 1) ? '0' + min : min;\n    const seg = data.getSeconds().toString();\n    const segF = (seg.length == 1) ? '0' + seg : seg;\n\n    return `${diaF}/${mesF}/${anoF} ${horaF}:${minF}:${segF}`;\n}\n\nfunction metadata(inputMessage) {\n    try {\n        let inputMessageFormatted = JSON.parse(inputMessage);\n        // let inputMessageFormatted = inputMessage;\n        let metadata = inputMessageFormatted.metadata;\n\n        if (metadata && metadata['#wa.referral.headline']) {\n            const metadataCampanha = `${metadata['#wa.referral.source_id']} | ${metadata['#wa.referral.source_url']} | ${metadata['#wa.referral.headline']} | ${metadata['#wa.referral.body']} | ${metadata['#wa.referral.source_type']} | ${metadata['#wa.referral.image.id']}`\n            return metadataCampanha;\n        } else {\n            const metadataCampanha = \"\"\n            return metadataCampanha;\n        }\n    } catch (err) {\n        const metadataCampanha = \"\";\n        return metadataCampanha;\n    }\n}\n\nfunction origemCampanha(inputContent, metadata, broadcast) {\n    try {\n        const sourceUrl = metadata;\n        if (sourceUrl != \"\") {\n            return \"Campanha\"\n        } else if(broadcast){\n            return `broadcast | ${broadcast}`\n        }\n        return \"organico\"\n    } catch (err) {\n        return \"organico\"\n    }\n}\n\nfunction origemCanal(identity) {\n    try {\n        const source = identity.split('@')[1].split('.')[0];\n        switch (source) {\n            case 'wa':\n                return \"whatsapp\";\n                break;\n            case 'businesschat':\n                return \"businesschat\";\n                break;\n            case '0mn':\n                return \"blipchat\";\n                break;\n            case 'messenger':\n                return \"messenger\";\n                break;\n            case 'telegram':\n                return \"telegram\";\n                break;\n            case 'instagram':\n                return \"instagram\";\n                break;\n            case 'mailgun':\n                return \"email\";\n                break;\n            case 'workplace':\n                return \"workchat\";\n                break;\n            case 'tunnel':\n                return \"whatsapp\";\n                break;\n            case 'abs':\n                return \"teams\";\n                break;\n            default:\n                return \"new\"\n                break;\n        }\n\n    } catch (error) {\n        return false;\n    }\n}","inputVariables":["calendar.datetime","input.message","input.content","contact.extras.broadcastOrigem","contact.identity"],"outputVariable":"origemCampanhaPadrao","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"3a93296a-56a4-4d18-8d08-031107055532","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Origem campanha [[canal]]\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Origem campanha {{origemCampanhaPadrao@canal}}","action":"{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"origemCampanhaPadrao"},{"comparison":"exists","source":"context","values":[],"variable":"origemCampanhaPadrao@trackOrigemCampanha"}]},{"$id":"27d9fc57-038a-4d95-b15f-812902842088","$typeOfContent":"","type":"SetVariable","$title":"Set \"respostaTemplate\" to \"input.content\"","$invalid":false,"settings":{"value":"{{input.content}}","variable":"respostaTemplate"},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.broadcastOrigem"}]},{"$id":"682eeb5e-80b6-40a8-b276-9bd16cc61d38","$typeOfContent":"","type":"MergeContact","$title":"Canal","$invalid":false,"settings":{"extras":{"Canal":"WhatsApp"}},"conditions":[{"values":["@wa"],"source":"context","comparison":"contains","variable":"contact.identity"}]},{"$id":"af2bdb35-4f62-47bd-a704-2c797ab66daa","$typeOfContent":"","type":"SetVariable","$title":"verticalSaude","$invalid":false,"settings":{"variable":"verticalSaude","value":"aberturaContaPJ"},"conditions":[{"values":["conta PJ com benefícios"],"source":"input","comparison":"contains"}]},{"$id":"aaf73ccd-03d0-414f-96fa-e5cea62d3cfb","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionTypeMedia\"","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"false"},"conditions":[]},{"$id":"e181501a-c587-40ed-ba5d-2c62ffba53e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"facf4f35-9616-4f7f-ad92-2c31330de15d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state);\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"b292ce4f-1590-44a1-bc78-fea4f5ccc391","$invalid":false,"typeOfStateId":"state"},"id":"onboarding","root":true,"$position":{"top":"22px","left":"111px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#CCA2E1","label":"InputScripts","id":"blip-tag-8cc68c9d-bdf1-45ef-95b7-7824d8eef532","canChangeBackground":false},{"id":"blip-tag-7523156f-5607-4308-8b2e-37b144d6130d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-886f2086-bdb4-4121-80e3-45ef76977ea6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7714c021-c385-41c3-864f-4d7fb1a442c8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-33b8082d-2a40-4e42-b27f-47bfe68c098d","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-6afe289a-4dca-49bf-8ff0-3ad354da2902","label":"UserInput","background":"#000000","canChangeBackground":false}]},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e4c1acf3-e610-4d60-8a8c-771c988209d3","typeOfStateId":"state","$connId":"con_63","$id":"c41fa6b6-8508-4eb5-b413-e003d5172e89","conditions":[{"source":"context","comparison":"equals","values":["f338e3e6-65d2-4706-a7bc-77bd22a1a7e8"],"variable":"state.previous.id"}],"$invalid":false},{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$connId":"con_83","$invalid":false,"$id":"123e9e4d-3cd3-4571-8335-0ea4e57e0176"}],"$enteringCustomActions":[{"$id":"dbdbdf72-324c-4dc6-a58d-6b89dd9b7402","$typeOfContent":"","type":"ExecuteScript","$title":"Pegar Bloco do Erro","$invalid":false,"settings":{"function":"run","source":"function run(stateName) {\n    try {\n        const regex = new RegExp(\"FC(.\\\\d{1,2}){2,}\", \"gi\");\n        stateName = stateName.match(regex)[0]\n        return stateName;\n    } catch (err) {\n        return stateName;\n    }\n}","inputVariables":["state.previous.name"],"outputVariable":"stateName","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"exceptionCode"}]},{"$id":"fe82913d-a3ba-4b73-90d9-3c5e36f9b4c6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || \"inatividade\",\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `principal ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message,\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","input.intent.name","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"fallback","$position":{"top":"262px","left":"2097px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-57dc348c-d88f-4635-8d03-801f24b5bb5d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}]},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"961133a7-a6bd-4932-b51e-5bc66e054525","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"Inicio","$invalid":false,"settings":{"extras":{"telefone":"{{identity}}","userName":"{{contact.name}}","Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Inicio","action":"{{Inicio}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"Inicio"}]},{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"action":"{{state.name}}","category":"lastState"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a719f4a3-c4dd-4447-944e-b85120b7ba4f","$invalid":false,"typeOfStateId":"state"},"id":"welcome","$position":{"top":"1140.5px","left":"18.25px"},"$title":"[1] Boas vindas","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#CCA2E1","label":"InputScripts","canChangeBackground":false,"id":"blip-tag-8cc68c9d-bdf1-45ef-95b7-7824d8eef532"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"id":"blip-tag-9df7dfee-0834-4588-869b-67ec87f381f7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}]},"error":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a1f34699-dd5c-43b6-8345-fde58dc32c0d","type":"text/plain","content":"User Input"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"error","$position":{"top":"0px","left":"2445px"},"$title":"[E.0] Erro padrão","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#CCA2E1","label":"InputScripts","canChangeBackground":false,"id":"blip-tag-8cc68c9d-bdf1-45ef-95b7-7824d8eef532"},{"id":"blip-tag-fe3bd30d-edc0-4b32-8131-27e6d0d46f40","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}]},"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7e03f21c-9e6b-4d6e-bc00-1da813e220ce","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:47320"}],"$conditionOutputs":[{"stateId":"3c555d39-68eb-466b-9063-6adeb01132fc","$connId":"con_103","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime","$$hashKey":"object:47356"}],"$invalid":false,"$id":"d898d1cc-25f2-4c5c-b445-f6a9f9f4b9b8","typeOfStateId":"state","$$hashKey":"object:47323"}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"CheckWorkTime","$invalid":false,"settings":{"function":"run","source":"function run(selectTeam) {\n    try {\n        let data = new Date();\n        let dayMonth = data.getDate();\n        let dayWeek = data.getDay();\n        let convertHours = (data.getUTCHours() - 3) < 0 ? (data.getUTCHours() - 3) + 24 : (data.getUTCHours() - 3);\n        let hours = convertHours < 10 ? '0' + convertHours : convertHours;\n        let minutes = data.getMinutes() < 10 ? '0' + data.getMinutes() : data.getMinutes();\n        let hoursAndMinutes = hours + \":\" + minutes;\n        let selectedChannel = selectTeam;\n        let channel = selectedChannel == \"default\" ? 0 : 0\n        let weekDefault = { \"start\": \"09:00\", \"end\": \"17:59\" };\n        let weekDeNotFound = { \"start\": \"09:00\", \"end\": \"17:59\" };\n        let objRules = {\n            \"rules\": [\n                { \"default\":  [null, weekDefault, weekDefault, weekDefault, weekDefault, null, null] }\n            ]\n        }\n        if (!objRules.rules[channel][selectedChannel]) {\n\n            if (dayWeek === 0 || dayWeek === 6) {\n             return false;\n            } else {\n\n            return hoursAndMinutes >= weekDeNotFound.start && hoursAndMinutes <= weekDeNotFound.end;\n\n            }\n        } else {\n            let resultDay = objRules.rules[channel][selectedChannel][dayWeek];\n            return hoursAndMinutes >= resultDay.start && hoursAndMinutes <= resultDay.end;\n        }\n    }\n    catch (e) {\n        return e;\n    }\n}","inputVariables":["selectTeam"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]}],"$leavingCustomActions":[{"type":"SetVariable","$title":"limpa contador","$invalid":false,"settings":{"variable":"contador","value":""},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","root":false,"$title":"[4] Verifica horario atendimento","$position":{"top":"412px","left":"1735.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3c555d39-68eb-466b-9063-6adeb01132fc":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"aa0d29d3-bab1-427d-9188-93b3638acbcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"aa0d29d3-bab1-427d-9188-93b3638acbcd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"504721a0-3d44-4e95-82cc-dd33718b906a","type":"text/plain","content":"Este atendimento está disponível de Segunda à Sexta-Feira das 09:00 ás 18:00, exceto feriados.","metadata":{}},"$cardContent":{"document":{"id":"504721a0-3d44-4e95-82cc-dd33718b906a","type":"text/plain","content":"Este atendimento está disponível de Segunda à Sexta-Feira das 09:00 ás 18:00, exceto feriados."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3c27a585-faa8-4361-94da-a2b79dfd507c","type":"SendMessage","settings":{"id":"04e9137a-04a8-4710-bcfb-79787d344f55","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"04e9137a-04a8-4710-bcfb-79787d344f55","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"dc197845-a5d8-4eb7-b016-7d2f992247e8","type":"text/plain","content":"Por favor retorne o contato dentro desse horário."},"$cardContent":{"document":{"id":"dc197845-a5d8-4eb7-b016-7d2f992247e8","type":"text/plain","content":"Por favor retorne o contato dentro desse horário."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd1c385b-7adc-4efb-b829-3b137d4e97c0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Fora de Horario","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Fora de Horario","action":"Fora do Horario | {{phoneNumber}}"},"conditions":[]},{"$id":"33de45fb-2c28-48cc-87d6-21b97682313e","$typeOfContent":"","type":"MergeContact","$title":"Limpa Broadcast","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"id":"3c555d39-68eb-466b-9063-6adeb01132fc","root":false,"$title":"[4.1] Fora do horario de atendimento","$position":{"top":"482px","left":"1286px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"background":"#CCA2E1","label":"InputScripts","canChangeBackground":false,"id":"blip-tag-8cc68c9d-bdf1-45ef-95b7-7824d8eef532"},{"background":"#1FE5BD","label":"LastStateUpdateScript","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c"},{"background":"#E5BD1F","label":"SaveContent","canChangeBackground":false,"id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20e57c"},{"id":"blip-tag-02c26071-15c3-46e9-b180-5a38ca1d2c1b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f39e46dc-246e-463f-8aa8-f0d18bc5b2b5","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-2cea0c39-af5a-43ea-8855-0765d8353520","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}]},"73ad5a7d-cd03-447c-9cd3-7aa1dfb65db3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"210bd45a-fc00-4f64-8da1-001f04b35ebb","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]},{"type":"ExecuteScript","$title":"encodedContact","$invalid":false,"settings":{"function":"run","source":"function run(contact) {\n    return encodeURIComponent(contact);\n}","inputVariables":["contact.identity"],"outputVariable":"encodedContact","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessCommand","$title":"Ticket","$invalid":false,"settings":{"method":"get","to":"postmaster@desk.msging.net","uri":"/tickets?$filter=customerIdentity%20eq%20'{{encodedContact}}'%20and%20(status%20eq%20'ClosedAttendant')&$take=1","variable":"ticketResponse"},"conditions":[]},{"type":"ExecuteScript","$title":"Horario de Abertura do Ticket","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    if(_ticket.resource.items.length > 0){\n        let date = new Date(_ticket.resource.items[0].openDate);\n        let day = date.getUTCDate() < 10 ? \"0\" + date.getUTCDate() : date.getUTCDate();\n        let month = (date.getUTCMonth()+1) < 10 ? \"0\" + (date.getUTCMonth()+1) : (date.getUTCMonth()+1);\n        let hour = (date.getUTCHours()-3) < 10 ? \"0\" + (date.getUTCHours()-3) : (date.getUTCHours()-3);\n        let minutes = date.getUTCMinutes() < 10 ? \"0\" + date.getUTCMinutes() : date.getUTCMinutes();\n        let seconds =  date.getUTCSeconds() < 10 ? \"0\" +  date.getUTCSeconds() :  date.getUTCSeconds();\n        let newDate = day + \"/\" + month + \"/\" + date.getUTCFullYear() + \" \" + hour + \":\" + minutes + \":\" + seconds;\n        return newDate;\n    }\n\n    return \"\";\n}","inputVariables":["ticketResponse"],"outputVariable":"openHourTicket","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Tag do Ticket","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    if(_ticket.resource.items.length > 0 && \n        _ticket.resource.items[0].tags &&\n        _ticket.resource.items[0].tags.length > 0){\n\n            return _ticket.resource.items[0].tags.join(\",\");\n    }\n\n    return \"\";\n}","inputVariables":["ticketResponse"],"outputVariable":"ticketTags","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Numero do Ticket","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    if(_ticket.resource.items.length > 0){\n            return _ticket.resource.items[0].sequentialId;\n    }\n\n    return \"\";\n}","inputVariables":["ticketResponse"],"outputVariable":"sequentialId","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Email Atendente","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    if(_ticket.resource.items.length > 0){\n            return _ticket.resource.items[0].agentIdentity;\n    }\n\n    return \"\";\n}","inputVariables":["ticketResponse"],"outputVariable":"agentIdentity","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"email Encode Atendente","$invalid":false,"settings":{"function":"run","source":"function run(email) {\n    return encodeURIComponent(email); \n}","inputVariables":["agentIdentity"],"outputVariable":"emailEncode","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Guid Id","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}","inputVariables":[],"outputVariable":"newGuidId","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"Nome Atendente","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{config.token}}"},"method":"POST","body":"{\n  \"id\": \"{{newGuidId}}\",\n  \"to\": \"postmaster@blip.ai\",\n  \"method\": \"get\",\n  \"uri\": \"lime://{{config.blip}}/accounts/{{emailEncode}}\"\n}","uri":"{{config.commands}}","responseStatusVariable":"statusEncode","responseBodyVariable":"retornoUsuario"},"conditions":[]},{"type":"ExecuteScript","$title":"Nome Atendente","$invalid":false,"settings":{"function":"run","source":"function run(ticket) {\n    let _ticket = JSON.parse(ticket);\n\n    return _ticket.resource.fullName;\n}","inputVariables":["retornoUsuario"],"outputVariable":"nomeAtendente","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"Quarentena NPS","$invalid":false,"settings":{"function":"run","source":"function run(dataAvaliacao) {\n\n    if(!dataAvaliacao){\n\n     return 'nada'\n    }\n\n     const dateWithoutHours =  dataAvaliacao.split(' ')[0].split(\"/\");\n    const newDateWithouHoures = dateWithoutHours[1] + '/' + dateWithoutHours[0] + '/' + dateWithoutHours[2];\n    let date = new Date();\n    let day = date.getUTCDate() < 10 ? \"0\" + date.getUTCDate() : date.getUTCDate();\n    let month = (date.getUTCMonth()+1) < 10 ? \"0\" + (date.getUTCMonth()+1) : (date.getUTCMonth()+1);\n    let dateNow = month + \"/\" + day + \"/\" + date.getUTCFullYear();\n    let date1 = new Date(newDateWithouHoures); \n    let date2 = new Date(dateNow);\n    let  Difference_In_Time = date2.getTime() - date1.getTime(); \n    let Difference_In_Days = Difference_In_Time / (1000 * 3600 * 24); \n    const retorno  =  Difference_In_Days > 30 ? true : false;\n    return retorno;\n   }","inputVariables":["dataAvaliacao"],"outputVariable":"mostraNPS","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"dataAvaliacao"}]}],"$leavingCustomActions":[{"$id":"48e9fcdb-3148-4b16-8a36-d4aba0d5fe33","$typeOfContent":"","type":"MergeContact","$title":"LIMPAR BROADCAST","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-","Campanha":"-"}},"conditions":[]},{"$id":"efb2a9f1-782d-433d-b1e6-c95119a569e6","$typeOfContent":"","type":"SetVariable","$title":"Limpar CampanhaInvestimentos","$invalid":false,"settings":{"variable":"CampanhaInvestimentos","value":"false"},"conditions":[]},{"$id":"5a948abe-96c1-4bd4-9452-ef732afa70be","$typeOfContent":"","type":"SetVariable","$title":"Limpa CampanhaCartaoVisa","$invalid":false,"settings":{"variable":"CampanhaCartaoVisa","value":"false"},"conditions":[]},{"$id":"4dc8ad31-5fac-4cf6-b2cb-a0260cd47667","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" CLEAR","$invalid":false,"settings":{"variable":"state","value":"-"},"conditions":[]},{"$id":"d77c5869-24d2-4b8c-bef8-55e507c94817","$typeOfContent":"","type":"SetVariable","$title":"Set \"intencaoIdentificada\" CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada","value":""},"conditions":[]}],"$inputSuggestions":[],"$tags":[{"id":"blip-tag-931f2eb9-17a0-4ce3-9012-ef051ef9cdc6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-eb592c0c-3095-4056-a012-0fccaaa089a7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c3ac1836-2d71-4b4e-8dd6-53994efe9c73","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-abf177a9-941a-4b9a-970d-1c1827599770","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-53bd39ce-415d-4254-87a8-707fd9cd6eda","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-9634f85b-be52-4101-8422-4fdd9176a9fd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"$defaultOutput":{"stateId":"29af1410-cb72-4b16-b724-0ca73681ada1","$invalid":false},"id":"73ad5a7d-cd03-447c-9cd3-7aa1dfb65db3","root":false,"$title":"[7] Agradecimento","$position":{"top":"640px","left":"1289px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"29af1410-cb72-4b16-b724-0ca73681ada1":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"1c536774-9a99-4a5c-a623-8276695b9ed8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"$cardContent":{"document":{"id":"1c536774-9a99-4a5c-a623-8276695b9ed8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5b113b97-e527-48d0-98d0-98cae402e7a3","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]},{"type":"TrackEvent","$title":"Retorno","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Retorno","action":"{{selectTeam}}|{{retorno}}"},"conditions":[]},{"type":"ExecuteScript","$title":"Greeting","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\n            function run() {\n                   d = new Date();\n            hour = d.getHours();\n\n            return hour < 5 ?  \" Boa noite\":\n                   hour < 12 ? \" Bom dia\" :\n                   hour < 18 ? \" Boa tarde\" : \"Boa noite\";//Return value will be saved as \"Return value variable\" field name\n            }","inputVariables":[],"outputVariable":"greeting","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"anterior retorno cliente","action":"{{state.previous.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.previous.name"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c","canChangeBackground":false},{"id":"blip-tag-e0092c95-8565-4aad-b5ac-6d86c9615ac5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-20179e08-0cdb-4708-ab8e-97bd0bb91733","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ebfaefb4-b025-4b1c-935f-56b12649a548","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"29af1410-cb72-4b16-b724-0ca73681ada1","root":false,"$title":"[1.1] Retorno Cliente","$position":{"top":"491px","left":"1500px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a719f4a3-c4dd-4447-944e-b85120b7ba4f":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"c464ce29-8049-483b-ab12-95e880de260c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"$cardContent":{"document":{"id":"c464ce29-8049-483b-ab12-95e880de260c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"d3ef6626-c53b-49f2-80b2-e4909c91a349","type":"text/plain","content":"Para seguir com seu atendimento, preciso que <b>digite o seu CPF.</b>\n\nInforme os 11 dígitos sem pontos ou traços:\n<b>Exemplo: 99999999999</b>","metadata":{}},"$cardContent":{"document":{"id":"d3ef6626-c53b-49f2-80b2-e4909c91a349","type":"text/plain","content":"Para seguir com seu atendimento, preciso que <b>digite o seu CPF.</b>\n\nInforme os 11 dígitos sem pontos ou traços:\n<b>Exemplo: 99999999999</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"57d32b13-e302-46fc-81b3-70ba03dc8976","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1e5fb093-df86-4c66-b130-2160f0de712e","$connId":"con_118","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"$id":"ca152e84-43e9-4c45-807e-17a9ad2be054"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"$tags":[{"id":"blip-tag-c2e977a5-59ce-406e-98f7-a1108b2f5278","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-82f1a167-e555-49c4-8a40-7368dd748302","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a719f4a3-c4dd-4447-944e-b85120b7ba4f","root":false,"$title":"[2.1] Informe CPF","$position":{"top":"1273.25px","left":"16px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"182d5b10-eb4e-4c90-885f-31c9799e0aa9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7152f115-fbec-4e2d-a239-ee9d518973d3","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","typeOfStateId":"state","$connId":"con_133","$id":"3c21450b-19f0-4dc4-98fe-ef9a58672c21","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"CampanhaInvestimentos"}],"$invalid":false},{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","typeOfStateId":"state","$connId":"con_138","$id":"9fc11eae-96a3-4ed9-8875-dc3461eed92c","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"CampanhaCartaoVisa"}],"$invalid":false}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]},{"type":"ExecuteScript","$title":"Limpa CPF CNPJ","$invalid":false,"settings":{"function":"run","source":"function run(documento) {\r\n\r\n   // let cpfCnpjRegex = new RegExp(\"([0-9]{2}[\\.]?[0-9]{3}[\\.]?[0-9]{3}[\\/]?[0-9]{4}[-]?[0-9]{2})|([0-9]{3}[\\.]?[0-9]{3}[\\.]?[0-9]{3}[-]?[0-9]{2})\");\r\n    //let testeDoc = cpfCnpjRegex.test(documento);\r\n\r\n   // if(testeDoc){\r\n\r\n     let  documento = documento.replace(/\\D/g, '');\r\n\r\n       return documento\r\n    //}\r\n\r\n}","inputVariables":["cpf"],"outputVariable":"cpf","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"SetVariable","$title":"CPF / CNPJ","$invalid":false,"settings":{"variable":"cpf","value":"{{cpf}}"},"conditions":[]},{"$id":"0b6829cb-4db9-46a7-a79b-ffda50facd45","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"d4582c52-a0ba-4ff9-ad2b-351dc2b059aa","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"function run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"686691ee-9b61-46b7-bbc8-23ccfe3e6754","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CONSULTA CARTERIZACAO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","uri":"{{config.urlCHT}}/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{cpf}}&codigoSegmento={{config.codigoSegmento}}","responseStatusVariable":"statusCarterizacao","responseBodyVariable":"bodyCarterizacao"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"]}]},{"$id":"4323d0ed-15a1-4d26-8bed-a2d719bd8b51","$typeOfContent":"","type":"SetVariable","$title":"carterizacao","$invalid":false,"settings":{"variable":"carterizacao","value":"{{bodyCarterizacao@data}}"},"conditions":[]},{"$id":"3112dff3-1189-4fc5-97f8-5f937eb41ad1","$typeOfContent":"","type":"ExecuteScript","$title":"conta 9 numeros","$invalid":false,"settings":{"function":"run","source":"\n            function run(carterizcao) {\n                if(carterizcao != \"\"){\n                    carterizcao = JSON.parse(carterizcao);\n                    return carterizcao.conta.padStart(9, '0');\n                }\n\n                return \"\";\n            }","inputVariables":["carterizacao"],"outputVariable":"numeroConta","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c2152298-97b7-4789-b1b9-4d909e9a53f1","$typeOfContent":"","type":"ProcessHttp","$title":"GET dados cliente","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/contas-pessoa-juridica/v1/contas?agencia={{carterizacao@agencia}}&conta={{numeroConta}}","responseStatusVariable":"statusDados","responseBodyVariable":"bodyDados"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"]}]},{"$id":"1a84bba4-a79a-42dd-8b7b-9b82896240e2","$typeOfContent":"","type":"SetVariable","$title":"dados","$invalid":false,"settings":{"variable":"dados","value":"{{bodyDados@data}}"},"conditions":[]},{"type":"SetVariable","$title":"select Team","$invalid":false,"settings":{"value":"Default","variable":"selectTeam"},"conditions":[]},{"type":"ExecuteScript","$title":"Select Team","$invalid":false,"settings":{"function":"run","source":"function run (bodyCarterizacao) {\n    let carterizacao = JSON.parse(bodyCarterizacao);\n    if(carterizacao != \"\" && carterizacao != null) {\n        return carterizacao.data.sigla;\n    }\n}","inputVariables":["bodyCarterizacao"],"outputVariable":"selectTeam","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusCarterizacao","values":["200"]}]},{"$id":"de055b52-0f3d-4aa5-b251-e32627c89f28","type":"SetVariable","$title":"contaAberta","$invalid":false,"settings":{"variable":"contaAberta","value":"{{returnObject@contaAberta}}"},"conditions":[]}],"$leavingCustomActions":[{"type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"cpf":"{{cpf}}","cliente":"{{dados@nome}}","gerente":"{{selectTeam}}","filial":"{{returnObject@filial}}","agencia":"{{carterizacao@agencia}}","conta":"{{numeroConta}}"},"name":"{{dados@nome}}","phoneNumber":"{{identity}}"},"conditions":[]},{"type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"empresa","value":"{{dados@nome}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f901d2ea-42e7-4467-be98-05dd27a15f58","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-62bc1cd0-f002-407a-bc15-ee796d58ab8b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-124fb34d-00a2-4abf-9975-fab91ae650e1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f29448c3-0944-4c2e-8794-a2a06680995c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b2088e66-07fc-4753-a0b1-fab1623f9530","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"182d5b10-eb4e-4c90-885f-31c9799e0aa9","root":false,"$title":"[3] Consulta CNPJ Recursos","$position":{"top":"376px","left":"589px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e5fb093-df86-4c66-b130-2160f0de712e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"5d12659d-a813-49d7-a09b-9e4cd1fbe9c4","type":"text/plain","textContent":"Entrada do usuário","content":"cpf"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"cpf","expiration":"0:15"},"$invalid":false,"$$hashKey":"object:49228"}],"$conditionOutputs":[{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_148","$id":"5557e846-9383-4e4d-91ef-fe1984159e1b","conditions":[{"source":"input","comparison":"notExists","values":[],"$$hashKey":"object:49253"}],"$invalid":false,"$$hashKey":"object:49231"},{"stateId":"3413a4cc-2e85-4fb3-9e9b-e019227e4c71","typeOfStateId":"state","$connId":"con_153","$id":"ce4b3727-4261-4504-88ba-6c128cef3bdb","conditions":[{"source":"context","comparison":"equals","values":["invalido"],"variable":"cpfLimpo@valid","$$hashKey":"object:49267"}],"$invalid":false,"$$hashKey":"object:49232"},{"stateId":"3413a4cc-2e85-4fb3-9e9b-e019227e4c71","$connId":"con_5127","conditions":[{"source":"context","comparison":"equals","values":["False"],"variable":"validaCpfCnpj","$$hashKey":"object:49285"}],"$invalid":false,"$id":"e93fe68e-42e3-4b1c-bac8-d11f8e3ce060","typeOfStateId":"state","$$hashKey":"object:49233"},{"stateId":"ab293966-31e2-49ed-b540-c5a2b74dc793","$connId":"con_163","conditions":[{"source":"context","comparison":"equals","values":["True"],"variable":"validaCpfCnpj","$$hashKey":"object:49301"}],"$invalid":false,"$id":"0abe5fea-fdac-4ad5-b9da-2b5f9daccb0b","typeOfStateId":"state","$$hashKey":"object:49234"}],"$enteringCustomActions":[{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]}],"$leavingCustomActions":[{"$id":"e10166da-a92e-4893-9814-28be148c55cc","$typeOfContent":"","type":"ExecuteScript","$title":"Limpa CPF","$invalid":false,"settings":{"function":"run","source":"// Blocklist common values.\nconst CPF_BLOCKLIST = [\n    '00000000000',\n    '11111111111',\n    '22222222222',\n    '33333333333',\n    '44444444444',\n    '55555555555',\n    '66666666666',\n    '77777777777',\n    '88888888888',\n    '99999999999',\n    '12345678909'\n];\n\nfunction run(input) {\n    try {\n        let inputObject = cpfTreatment(input);\n\n        return inputObject;\n    } catch (e) {\n        return { \n            input: \"input inesperado\",\n            valid: \"invalido\"\n        };\n    }\n}\n\nconst cpfTreatment = (strCPF) => {\n    strCPF = strCPF.replace(/\\D+/g, \"\");\n\n    // CPF must have 11 chars\n    if (strCPF.length !== 11) {\n        return { \n            input: \"input inesperado\",\n            valid: \"invalido\"\n        };\n    }\n\n    // CPF can't be blocklisted\n    if (CPF_BLOCKLIST.includes(strCPF)) {\n        return { \n            input: \"input inesperado\",\n            valid: \"invalido\"\n        };\n    }\n\n    let numbers = strCPF.substr(0, 9);\n    numbers += verifierDigitCpf(numbers);\n    numbers += verifierDigitCpf(numbers);\n\n    return numbers.substr(-2) === strCPF.substr(-2) ?  numbers  : { input: \"input inesperado\", valid: \"invalido\" };\n};\n\nconst verifierDigitCpf = (digits) => {\n    const numbers = digits\n        .split('')\n        .map(num => {\n            return parseInt(num, 10);\n        });\n\n    const modulus = numbers.length + 1;\n    const multiplied = numbers.map((num, index) => num * (modulus - index));\n    const mod = multiplied.reduce((buffer, num) => buffer + num) % 11;\n\n    return (mod < 2 ? 0 : 11 - mod);\n};","inputVariables":["input.content"],"outputVariable":"cpfLimpo","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ExecuteScript","$title":"valida CPF","$invalid":false,"settings":{"function":"run","source":"function run(documento) {\n    documento = documento.replace(/\\D/g, '');\n    if (documento.length == 11) {\n        documento = (\"000000000\" + documento).slice(-11);\n        return verifyDoc()[\"validCpf\"](documento);\n    } else {\n        return verifyDoc()[\"validCnpj\"](documento);\n    }\n\n}\nfunction verifyDoc(documento) {\n    return {\n        validCpf: function (cpf) {\n            if (!cpf || cpf.length != 11\n                || cpf == \"00000000000\"\n                || cpf == \"11111111111\"\n                || cpf == \"22222222222\"\n                || cpf == \"33333333333\"\n                || cpf == \"44444444444\"\n                || cpf == \"55555555555\"\n                || cpf == \"66666666666\"\n                || cpf == \"77777777777\"\n                || cpf == \"88888888888\"\n                || cpf == \"99999999999\")\n                return false\n            var soma = 0\n            var resto\n            for (var i = 1; i <= 9; i++)\n                soma = soma + parseInt(cpf.substring(i - 1, i)) * (11 - i)\n            resto = (soma * 10) % 11\n            if ((resto == 10) || (resto == 11)) resto = 0\n            if (resto != parseInt(cpf.substring(9, 10))) return false\n            soma = 0\n            for (var i = 1; i <= 10; i++)\n                soma = soma + parseInt(cpf.substring(i - 1, i)) * (12 - i)\n            resto = (soma * 10) % 11\n            if ((resto == 10) || (resto == 11)) resto = 0\n            if (resto != parseInt(cpf.substring(10, 11))) return false\n            return true\n        },\n        validCnpj: function (cnpj) {\n            if (!cnpj || cnpj.length != 14\n                || cnpj == \"00000000000000\"\n                || cnpj == \"11111111111111\"\n                || cnpj == \"22222222222222\"\n                || cnpj == \"33333333333333\"\n                || cnpj == \"44444444444444\"\n                || cnpj == \"55555555555555\"\n                || cnpj == \"66666666666666\"\n                || cnpj == \"77777777777777\"\n                || cnpj == \"88888888888888\"\n                || cnpj == \"99999999999999\")\n                return false\n            var tamanho = cnpj.length - 2\n            var numeros = cnpj.substring(0, tamanho)\n            var digitos = cnpj.substring(tamanho)\n            var soma = 0\n            var pos = tamanho - 7\n            for (var i = tamanho; i >= 1; i--) {\n                soma += numeros.charAt(tamanho - i) * pos--\n                if (pos < 2) pos = 9\n            }\n            var resultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n            if (resultado != digitos.charAt(0)) return false;\n            tamanho = tamanho + 1\n            numeros = cnpj.substring(0, tamanho)\n            soma = 0\n            pos = tamanho - 7\n            for (var i = tamanho; i >= 1; i--) {\n                soma += numeros.charAt(tamanho - i) * pos--\n                if (pos < 2) pos = 9\n            }\n            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11\n            if (resultado != digitos.charAt(1)) return false\n            return true;\n        }\n    }\n}","inputVariables":["cpfLimpo"],"outputVariable":"validaCpfCnpj","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2c328477-2bc6-4deb-a5c2-fdd5b7980359","$typeOfContent":"","type":"SetVariable","$title":"Set CPF Limpo","$invalid":false,"settings":{"variable":"cpf","value":"{{cpfLimpo}}"},"conditions":[]},{"$id":"d24c8d82-487d-40eb-bfe3-b9b835c97972","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"cpf":"{{cpf}}"}},"conditions":[]},{"$id":"5fb20450-70f3-4cab-97d4-9a243ddc76d4","$typeOfContent":"","type":"ExecuteScript","$title":"Pega base CPF","$invalid":false,"settings":{"function":"run","source":"function run(cpf) {\n\n\tconst baseCpf = \"\";\n\n    baseCpf = cpf.substr(0, 9);\n    return baseCpf;\n\n    }","inputVariables":["contact.extras.cpf"],"outputVariable":"baseCpf","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.cpf"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"$tags":[{"id":"blip-tag-fb58481e-9d05-4d96-aca4-e3c560fabbf5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ae5d46c9-ecc5-4033-a494-7352d9c722ae","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5fe943b4-2cb9-4b2b-8eee-4f483f51850b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-577e0d95-39df-4d96-82f6-1f9ad3086740","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-eeffd584-e0ba-4f0f-bcaf-d76f5ea4e707","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1e5fb093-df86-4c66-b130-2160f0de712e","root":false,"$title":"[2.1] Valida numero CPF","$position":{"top":"1243.57px","left":"248.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"825b8785-89eb-46ce-9797-27de17e9bf2b":{"$contentActions":[{"action":{"$id":"cd1a3b6b-0272-4466-91ac-03dec1b3b647","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c1928b94-5e3b-4a69-8ba7-93f02419c126","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c1928b94-5e3b-4a69-8ba7-93f02419c126","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fb25b75e-5824-40a4-a76f-f388ab576127","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e49681a8-cb4e-4a58-ad74-91648253c697","type":"text/plain","content":"Olá! Tudo bem? \nBem-vindo ao atendimento com seu Especialista do Banco Safra.","metadata":{}},"$cardContent":{"document":{"id":"e49681a8-cb4e-4a58-ad74-91648253c697","type":"text/plain","content":"Olá! Tudo bem? \nBem-vindo ao atendimento com seu Especialista do Banco Safra."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5b113b97-e527-48d0-98d0-98cae402e7a3","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4e6643bf-ab39-49db-9edb-c49f0038aec6","typeOfStateId":"state","$connId":"con_173","$id":"29236935-5348-463f-81eb-553f6a4ffa45","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"agenciaPiloto"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c","canChangeBackground":false},{"id":"blip-tag-220b76aa-4509-482e-927a-38309cf32ff7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"825b8785-89eb-46ce-9797-27de17e9bf2b","root":false,"$title":"[2.1] Saudacao Carteirizado","$position":{"top":"241px","left":"590px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7d2151ae-fe14-4175-b43b-a10d0ed25da9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c0f606a-c029-4381-89c3-726e5df5c07e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$connId":"con_198","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusToken"}],"$invalid":false,"$id":"0a6ca259-2571-4c40-ad2b-4ad9be2922d9"},{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$connId":"con_203","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusAPIHorario"}],"$invalid":false,"$id":"c3297053-cb46-4c58-b5e9-b450db3255d5"},{"stateId":"3c555d39-68eb-466b-9063-6adeb01132fc","$connId":"con_213","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime"}],"$invalid":false,"$id":"c9c17bee-241a-4a6a-bd1a-762ff3467e9f","typeOfStateId":"state"}],"$enteringCustomActions":[{"$id":"0ca14679-bea4-4f72-8467-3624f773c731","$typeOfContent":"","type":"ExecuteScript","$title":"Verifica Fila","$invalid":false,"settings":{"function":"run","source":"function run(selectTeam,broadcastOrigem)\n{\n\n    const filaHorarioAtendimento = \"Default\";\n\n\t\tif (selectTeam == \"SUZYALB\"){\n\t\t\tfilaHorarioAtendimento = \"Fopa\";\n\t\t}else if (selectTeam == \"MARSANS\"){\n\t\t\tfilaHorarioAtendimento = \"Fopa\";\t\t\n\t\t}else if (broadcastOrigem == \"pf_horario_estendido_fopa_v3\"){\n\t\t\tfilaHorarioAtendimento = \"Fopa\";\n        }else{\n            filaHorarioAtendimento = \"Default\";\n        }\n\t\treturn filaHorarioAtendimento;\n}","inputVariables":["selectTeam","contact.extras.broadcastOrigem"],"outputVariable":"filaHorarioAtendimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"820cd2f9-4102-437f-a7c5-1fde8d3554f0","$typeOfContent":"","type":"ExecuteScript","$title":"VERIFICA HORARIO","$invalid":false,"settings":{"function":"run","source":"function run(offset) {\n\n\n\nlet now = new Date;\n\nlet utc_timestamp = Date.UTC(now.getUTCFullYear(), \n\n now.getUTCMonth(), \n\n now.getUTCDate(),\n\n now.getUTCHours(), \n\n now.getUTCMinutes(), \n\n now.getUTCSeconds(), \n\n now.getUTCMilliseconds());\n\n\n\n  var date = new Date(utc_timestamp + offset * 3600 * 1000);\n\n\n\n    return date.getHours();\n\n\n}","inputVariables":["config.dateTimeOffset"],"outputVariable":"hora","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"lastState","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"lastState","action":"{{state.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state.name"}]},{"$id":"c0ce4e8a-0859-4af7-a6d6-672e202d392d","$typeOfContent":"","type":"ExecuteScript","$title":"encodingUrl","$invalid":false,"settings":{"function":"run","source":"\nfunction run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"ProcessHttp","$title":"TOKEN API HORÁRIO","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"65dc2cdd-a971-486d-bfb9-32015461dfdc","$typeOfContent":"","type":"ProcessHttp","$title":"API HORÁRIO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/horarios-atendimentos/v1/horarios-atendimentos?idFila={{config.botIdentity}}&team={{filaHorarioAtendimento}}","responseStatusVariable":"statusAPIHorario","responseBodyVariable":"bodyAPIHorario"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"]}]},{"$id":"f1193233-2e6d-48b6-b13b-380f35c70d94","$typeOfContent":"","type":"ExecuteScript","$title":"TRATA RETORNO API HORÁRIO","$invalid":false,"settings":{"function":"run","source":"function run (retornoAPI) {\n    const obj = JSON.parse(retornoAPI);\n\n    return obj.data.isWorkTime;\n}","inputVariables":["bodyAPIHorario"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusAPIHorario"}],"continueOnError":true},{"type":"TrackEvent","$title":"STATUS API HORARIO TOKEN","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Status API Horario Token","action":"{{statusToken}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"statusToken"}]},{"type":"TrackEvent","$title":"STATUS API HORARIO","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Status API Horario","action":"{{statusAPIHorario}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"statusAPIHorario"}]},{"$id":"f63004ba-a758-4597-9958-5f760e284fea","$typeOfContent":"","type":"SetVariable","$title":"isWorkTime feriado","$invalid":false,"settings":{"variable":"isWorkTime","value":"false"},"conditions":[{"source":"context","comparison":"equals","variable":"calendar.date","values":["2021-10-12"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0a2d7b49-9df3-4e94-9714-eefd7ed84a6e","$invalid":false},"$tags":[{"id":"blip-tag-1ba23784-0f85-4ebc-bbe0-b665b152f9ed","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ba10b9a8-9951-4e21-8547-48f6c0a72587","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d6ca5001-4fcf-4e32-9a92-8cc75d8994b6","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-74d1f7c1-2b1a-4cca-afd8-ed9e244e8daa","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"7d2151ae-fe14-4175-b43b-a10d0ed25da9","root":false,"$title":"[4] Api horario atendimento","$position":{"top":"323px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"caab0796-5b5d-440f-a3e3-ec59bf6cb90a":{"$contentActions":[{"action":{"$id":"103a7540-89db-477f-a832-11308dd80871","type":"SendMessage","settings":{"id":"1cf888c0-b77c-4668-af30-a0c1e2d5e035","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cf888c0-b77c-4668-af30-a0c1e2d5e035","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6c8559de-d3b3-454b-bfe4-88a62750b77e","type":"SendMessage","settings":{"id":"c8365597-db26-4f3a-8642-e075f3e21e6f","type":"text/plain","content":"Obrigado. Caso queira falar sobre investimentos, produtos de crédito, seguros e câmbio é só enviar uma mensagem neste canal de 2ª a 6ª feira das 09h às 18h. exceto feriados. Até logo!","metadata":{}},"$cardContent":{"document":{"id":"c8365597-db26-4f3a-8642-e075f3e21e6f","type":"text/plain","content":"Obrigado. Caso queira falar sobre investimentos, produtos de crédito, seguros e câmbio é só enviar uma mensagem neste canal de 2ª a 6ª feira das 09h às 18h. exceto feriados. Até logo!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5653644-7598-4df0-9fb4-b1d0dddc2acd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5f8c2904-4075-4cda-8b0c-ed9ab4f63cfd","type":"MergeContact","$title":"Limpa broadcast Origem","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6e258fef-bdda-4fab-a9f3-e78f15ef402e","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-a87a6c89-78c6-4732-b6ee-2f3fe8b6b5fa","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"caab0796-5b5d-440f-a3e3-ec59bf6cb90a","root":false,"$title":"encerra","$position":{"top":"9px","left":"1215.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c10a7d5a-387a-4aa5-a035-8bd99b7937a9":{"$contentActions":[{"action":{"$id":"17416666-fbab-446f-985e-799c62567685","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c47bd444-d0b9-402e-879d-a039ec8e2080","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c47bd444-d0b9-402e-879d-a039ec8e2080","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"12f0a71b-99d2-441c-a582-579b8e22861e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e22d4e47-6eea-4f95-873c-f1ae27c6af8d","type":"text/plain","content":"Infelizmente ainda não conseguimos falar sobre outros assuntos por este canal. Você pode acessar nosso app Safra para realizar transações e consultas a qualquer momento e caso precise de ajuda com desbloqueios, liberações de transações financeiras, acessos ou problemas com o app, perda ou roubo do seu cartão ou token conte com a nossa central de atendimento através do *55 11 3253 4455* para capital e grande São Paulo ou *0300 105 1234* para demais localidades de 2ª a 6ª feira das 08h às 21h30, exceto feriados.","metadata":{}},"$cardContent":{"document":{"id":"e22d4e47-6eea-4f95-873c-f1ae27c6af8d","type":"text/plain","content":"Infelizmente ainda não conseguimos falar sobre outros assuntos por este canal. Você pode acessar nosso app Safra para realizar transações e consultas a qualquer momento e caso precise de ajuda com desbloqueios, liberações de transações financeiras, acessos ou problemas com o app, perda ou roubo do seu cartão ou token conte com a nossa central de atendimento através do *55 11 3253 4455* para capital e grande São Paulo ou *0300 105 1234* para demais localidades de 2ª a 6ª feira das 08h às 21h30, exceto feriados."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"13740459-6596-41b0-bd3f-f9ebb38d9fc6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f203ce02-9275-411f-863d-4e25e26cf27b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f203ce02-9275-411f-863d-4e25e26cf27b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4532b2b9-43d1-465c-9458-3ee1ea88963b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"14975075-f0c2-4a38-b47d-4d148690686f","type":"text/plain","content":"Caso queira falar sobre investimentos, produtos de crédito, seguros e câmbio é só enviar uma mensagem neste canal. A assessoria digital está disponível de 2ª a 6ª feira das 09h às 18h. exceto feriados. Obrigado e até logo!","metadata":{}},"$cardContent":{"document":{"id":"14975075-f0c2-4a38-b47d-4d148690686f","type":"text/plain","content":"Caso queira falar sobre investimentos, produtos de crédito, seguros e câmbio é só enviar uma mensagem neste canal. A assessoria digital está disponível de 2ª a 6ª feira das 09h às 18h. exceto feriados. Obrigado e até logo!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"fe8caf6b-86ed-4af3-ad70-572f172cc936","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6bbaefa6-916c-4a0b-a405-df7f6b88c5ee","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-73c18c6e-9b48-467b-83ca-e0113dbe9ecf","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c10a7d5a-387a-4aa5-a035-8bd99b7937a9","root":false,"$title":"[12.1] Outros","$position":{"top":"648px","left":"500px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1619b516-7334-46ce-b621-2dc6bc9e27ca":{"$contentActions":[{"action":{"$id":"74e8470b-0802-4700-a580-0da480ac4d2d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"206c4929-6fe4-48c8-9dfe-b87ed6aaf054","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"206c4929-6fe4-48c8-9dfe-b87ed6aaf054","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4c70a831-c087-4b16-9cdb-a35cb752f827","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f0eb29c7-da05-4603-8f87-f5e866b37a5a","type":"text/plain","content":"Ok! Em breve irei te ligar.","metadata":{}},"$cardContent":{"document":{"id":"f0eb29c7-da05-4603-8f87-f5e866b37a5a","type":"text/plain","content":"Ok! Em breve irei te ligar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"07eac7e5-b4c6-463a-9f97-9a051f827db2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f7455aaa-1f3a-4b2c-9662-4ef2e7e5bb62","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-1ebf42b6-71d2-4aa4-ad59-4aad7278f736","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1619b516-7334-46ce-b621-2dc6bc9e27ca","root":false,"$title":"Ok! Em breve irei te ligar.","$position":{"top":"347px","left":"1064px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d18030bf-9d9d-4482-af7f-8bc1633a3e38":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f6800502-1a55-4e55-bdcf-35f030e290d4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_528","$id":"e26255eb-057c-420f-92eb-be4d9154c571","conditions":[{"source":"context","comparison":"notEquals","values":["success"],"variable":"bodyDispatchMessage@status"}],"$invalid":false,"stateId":"c745182e-9d95-4e22-ac58-85999dc86bac"},{"typeOfStateId":"state","$connId":"con_533","$id":"12282e25-8ce1-457e-91d7-e9baa176ffe7","conditions":[{"source":"context","comparison":"equals","values":["success"],"variable":"bodyDispatchMessage@status"}],"$invalid":false,"stateId":"de6caf99-3a7d-4b02-916b-239a50005633"}],"$enteringCustomActions":[{"$id":"3da1134b-2ba0-4bf9-8069-fe58a6b4383b","$typeOfContent":"","type":"ExecuteScript","$title":"Definir Horário Agendamento","$invalid":false,"settings":{"function":"run","source":"// Função para verificar se a data é um sábado (6) ou domingo (0)\nfunction isWeekend(date) {\n  return date.getDay() === 6 || date.getDay() === 0;\n}\n\n// Função para verificar se a data é um feriado nacional (adicionar feriados conforme necessário)\nfunction isHoliday(date) {\n  // Adicione aqui a lista de feriados no formato 'MM/DD'\n  const holidays = [\n    '01/01', // Ano Novo\n    '04/21', // Dia de Tiradentes\n    '05/01', // Dia do Trabalhador\n    '09/07', // Dia da Independência\n    '10/12', // Nossa Senhora Aparecida\n    '11/02', // Dia de Finados\n    '11/15', // Proclamação da República\n    '12/25', // Natal\n  ];\n\n  const month = date.getMonth() + 1; // getMonth() retorna valores de 0 a 11\n  const day = date.getDate();\n  const dateString = `${month.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;\n\n  return holidays.includes(dateString);\n}\n\n// Função para obter o próximo dia útil às 9h da manhã\nfunction getNextBusinessDay(currentDate = new Date(), hours = 9) {\n  // Verifica se o dia atual é fim de semana ou feriado\n  if (isWeekend(currentDate) || isHoliday(currentDate)) {\n    // Avança para o próximo dia e chama a função recursivamente\n    const nextDay = new Date(currentDate);\n    nextDay.setDate(currentDate.getDate() + 1);\n    return getNextBusinessDay(nextDay, hours);\n  }\n\n  // Define a hora para 9h da manhã\n  currentDate.setHours(hours, 0, 0, 0);\n\n  // Formata a data como uma string no formato \"YYYY-MM-DD HH:mm:ss\"\n  const dateString = currentDate.toISOString() //.slice(0, 19).replace('T', ' ');\n\n  return dateString;\n}\n\nfunction run () {\n\tconst nextBusinessDayAt9AM = getNextBusinessDay();\n\treturn nextBusinessDayAt9AM;\n}","inputVariables":[],"outputVariable":"horarioAgendamento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d74c92fd-2288-4854-b7b8-f9d36cd8073e","$typeOfContent":"","type":"ExecuteScript","$title":"Define Configurações do agendamento","$invalid":false,"settings":{"function":"run","source":"const config = {\n    botId: '{{config.botIdentityRouter}}', // id do Bot que será utilizado para enviar o broadcast\n    flowId: '{{config.flowId}}', // *IMPORTANTE* flowId do Bot que será utilizado para enviar o broadcast\n    stateId: 'onboarding', // Bloco que o cliente será direcionado, por padrão como em qualquer envio de broadcast, é o bloco Início\n    nomeCampanha: 'Cross-Sell-{{contact.extras.documento}}',\n    telefone: '+55{{phoneNumber}}',\n    template: 'agendamento_cross_sell',\n    email: 'bruno.paixao@safra.com.br', // email para notificação em caso de falha no envio\n    apiKey: \"{{config.apiKeyRouter}}\", // API KEY do Bot que será utilizado para enviar o broadcast\n    vars: '',\n    varsList: '',\n}\n\nfunction run(horarioAgendamento) {\n    const horarioMaisTresHoras = new Date(horarioAgendamento);\n    return { ...config, agendamento: horarioMaisTresHoras }\n}","inputVariables":["horarioAgendamento"],"outputVariable":"scheduleConfig","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f577872a-fe40-4725-99da-756ef430e1d2","$typeOfContent":"","type":"ProcessHttp","$title":"New Campaign","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{scheduleConfig@apiKey}}"},"method":"POST","body":"{\n    \"id\": \"{{random.guid}}\",\n    \"to\": \"postmaster@activecampaign.msging.net\",\n    \"method\": \"set\",\n    \"uri\": \"/campaigns\",\n    \"type\": \"application/vnd.iris.activecampaign.campaign+json\",\n    \"resource\": {\n        \"name\": \"{{scheduleConfig@nomeCampanha}}-{{calendar.unixTime}}\",\n        \"campaignType\": \"Individual\",\n        \"masterState\": \"{{scheduleConfig@botId}}@msging.net\",\n        \"flowId\": \"{{scheduleConfig@flowId}}\",\n        \"stateId\": \"{{scheduleConfig@stateId}}\",\n        \"scheduled\": \"{{scheduleConfig@agendamento}}\",\n        \"notificationEmail\": \"{{scheduleConfig@email}}\",\n        \"notificationEmailLanguage\": \"pt-BR\"\n    },\n    \"metadata\": {\n        \"blip_portal.email\": \"{{scheduleConfig@email}}\",\n        \"server.shouldStore\": \"true\"\n    }\n}","uri":"{{config.commands}}","responseStatusVariable":"statusSetCampaign","responseBodyVariable":"bodySetCampaign"},"conditions":[]},{"$id":"b6fbca61-98b1-4bee-ae2a-6d6769df8b3b","$typeOfContent":"","type":"SetVariable","$title":"Definir campaignId","$invalid":false,"settings":{"variable":"campaignId","value":"{{bodySetCampaign@resource.id}}"},"conditions":[{"source":"context","comparison":"equals","variable":"bodySetCampaign@status","values":["success"]}]},{"$id":"443d4e2c-3be1-4627-9523-3d9893ef6f73","$typeOfContent":"","type":"ProcessHttp","$title":"New Audience","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{scheduleConfig@apiKey}}"},"method":"POST","body":"{\n    \"id\": \"{{random.guid}}\",\n    \"to\": \"postmaster@activecampaign.msging.net\",\n    \"method\": \"set\",\n    \"uri\": \"/audiences/{{campaignId}}\",\n    \"type\": \"application/vnd.iris.activecampaign.audience+json\",\n    \"resource\": {\n        \"recipient\": \"{{scheduleConfig@telefone}}\",\n        \"recipientType\": \"phoneNumber\",\n        \"channelType\": \"whatsApp\",\n        \"messageParams\": \"{{scheduleConfig@vars}}\"\n    },\n    \"metadata\": {\n        \"blip_portal.email\": \"{{scheduleConfig@email}}\",\n        \"server.shouldStore\": \"true\"\n    }\n}","uri":"{{config.commands}}","responseStatusVariable":"statusSetAudience","responseBodyVariable":"bodySetAudience"},"conditions":[{"source":"context","comparison":"equals","variable":"bodySetCampaign@status","values":["success"]}]},{"$id":"b822dcc2-2ca5-42ae-8ad8-10c8a5b4eac4","$typeOfContent":"","type":"ProcessHttp","$title":"Schedule Message","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{scheduleConfig@apiKey}}"},"method":"POST","body":"{\n    \"id\": \"{{random.guid}}\",\n    \"to\": \"postmaster@activecampaign.msging.net\",\n    \"method\": \"set\",\n    \"uri\": \"/messages/{{campaignId}}\",\n    \"type\": \"application/vnd.iris.activecampaign.message+json\",\n    \"resource\": {\n        \"messageTemplate\": \"{{scheduleConfig@template}}\",\n        \"messageTemplateLanguage\": \"pt_BR\",\n        \"messageParams\": \"{{scheduleConfig@varsList}}\",\n        \"channelType\": \"whatsApp\"\n    },\n    \"metadata\": {\n        \"blip_portal.email\": \"{{scheduleConfig@email}}\",\n        \"server.shouldStore\": \"true\"\n    }\n}","uri":"{{config.commands}}","responseStatusVariable":"statusSetSchdule","responseBodyVariable":"bodySetSchedule"},"conditions":[{"source":"context","comparison":"equals","variable":"bodySetCampaign@status","values":["success"]}]},{"$id":"15310644-b0cd-4989-bd1e-2dffa793d6e0","$typeOfContent":"","type":"ProcessHttp","$title":"Dispatch Message","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{scheduleConfig@apiKey}}"},"method":"POST","body":"{\n    \"id\": \"{{random.guid}}\",\n    \"to\": \"postmaster@activecampaign.msging.net\",\n    \"method\": \"set\",\n    \"uri\": \"/dispatch\",\n    \"type\": \"application/vnd.iris.activecampaign.campaign+json\",\n    \"resource\": {\n        \"id\": \"{{campaignId}}\"\n    },\n    \"metadata\": {\n        \"blip_portal.email\": \"{{scheduleConfig@email}}\",\n        \"server.shouldStore\": \"true\"\n    }\n}","uri":"{{config.commands}}","responseStatusVariable":"statusDispatchMessage","responseBodyVariable":"bodyDispatchMessage"},"conditions":[{"source":"context","comparison":"equals","variable":"bodySetCampaign@status","values":["success"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-8d533207-bad2-42c0-a979-962f9a966a70","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fcc6fc08-1d93-4cd3-9e53-be591bb23553","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-7bc789fe-6d73-4449-a52d-643ab1f73c10","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"d18030bf-9d9d-4482-af7f-8bc1633a3e38","root":false,"$title":"Agendamento","$position":{"top":"2156px","left":"2321px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"de6caf99-3a7d-4b02-916b-239a50005633":{"$contentActions":[{"action":{"$id":"d647aef1-fb9e-422c-80e8-be2aa8c34a93","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"044aaf96-271a-4217-975e-4020bd16a1dc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"044aaf96-271a-4217-975e-4020bd16a1dc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"55c8349e-106b-44ef-8928-13d6320a24dd","$typeOfContent":"text","type":"SendMessage","settings":{"id":"5b3960c3-1a12-4757-bd67-7b1e4f3dfea5","type":"text/plain","content":"Obrigado! Um atendente te retornará no\nperíodo selecionado.","metadata":{}},"$cardContent":{"document":{"id":"5b3960c3-1a12-4757-bd67-7b1e4f3dfea5","type":"text/plain","content":"Obrigado! Um atendente te retornará no\nperíodo selecionado."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"12148801-a99f-4bd2-8d2b-eb515c915e70","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_538","$id":"5746ac0e-d210-43a6-a6b8-88f1da6f7ed9","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-d3ef5961-a713-4622-a96c-ba2781fc8d62","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"de6caf99-3a7d-4b02-916b-239a50005633","root":false,"$title":"Sucesso no agendamento","$position":{"top":"2304.14px","left":"2319.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c745182e-9d95-4e22-ac58-85999dc86bac":{"$contentActions":[{"action":{"$id":"c137d253-4911-4691-bc0f-ec67176ed13d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aada8feb-08d3-461b-9205-446b5aec510c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"aada8feb-08d3-461b-9205-446b5aec510c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c886864f-c3e8-4152-932b-95d413123526","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d135ebf4-70af-4619-87c4-15b39c11ae59","type":"text/plain","content":"Não foi possível realizar o agendamento. Tente novamente mais tarde.","metadata":{}},"$cardContent":{"document":{"id":"d135ebf4-70af-4619-87c4-15b39c11ae59","type":"text/plain","content":"Não foi possível realizar o agendamento. Tente novamente mais tarde."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ff7db5e8-db0f-459c-815a-32a9134d801b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_543","$id":"3ce6ad61-aaab-44f6-9cdd-790f48846324","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-95770bd7-2c3b-4481-8f04-3b35398ee7c6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c745182e-9d95-4e22-ac58-85999dc86bac","root":false,"$title":"Falha no agendamento","$position":{"top":"2151.61px","left":"2087px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ca9e5431-2817-4708-8891-b94244cfef9b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4239081-aca1-4815-a672-41d2de8b0941","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7d2151ae-fe14-4175-b43b-a10d0ed25da9","typeOfStateId":"state","$connId":"con_568","$id":"c14217d8-e894-4f51-a333-a54af94934f1","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"broadcastComercial"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"76b7e5a7-d2de-4f0b-9356-0252c082b1b3","$typeOfContent":"","type":"SetVariable","$title":"Limpa carterizacao","$invalid":false,"settings":{"variable":"carterizacao","value":"-"},"conditions":[]},{"$id":"30e65a2c-5d72-4521-849b-749aa1ea9dc4","$typeOfContent":"","type":"SetVariable","$title":"carterizacao AG2","$invalid":false,"settings":{"variable":"carterizacao","value":"{{bodyCarterizacaoAg2@data}}"},"conditions":[]},{"$id":"fef3ece5-3a42-482f-90d8-483ce29956d3","$typeOfContent":"","type":"ProcessHttp","$title":"GET DADOS CLIENTE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","uri":"{{config.urlCHT}}/contas-pessoa-juridica/v1/clientes?tipoPessoa=F&cpfCnpj={{baseCpf}}","responseStatusVariable":"statusDados","responseBodyVariable":"bodyDados"},"conditions":[]},{"$id":"76f53cbf-59ca-4458-813b-6888774aec5b","$typeOfContent":"","type":"SetVariable","$title":"dados","$invalid":false,"settings":{"variable":"dados","value":"{{bodyDados@data}}"},"conditions":[]},{"type":"ExecuteScript","$title":"SelectTeam","$invalid":false,"settings":{"function":"run","source":"function run (bodyCarterizacao) {\n    let carterizacao = JSON.parse(bodyCarterizacao);\n    if(carterizacao != \"\" && carterizacao != null) {\n        return carterizacao.sigla;\n    }\n}","inputVariables":["carterizacao"],"outputVariable":"selectTeam","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"61dadc19-a0d0-49fb-bd1c-60dac4bb8321","$typeOfContent":"","type":"ExecuteScript","$title":"Agencias Piloto","$invalid":false,"settings":{"function":"run","source":"function run(agencia) {\n\n\tconst agenciaPiloto = \"\";\n\n        if(agencia == \"07100\"){\n            agenciaPiloto = \"false\";\n\t\t}else{\n\t\t\t agenciaPiloto = \"true\";\n\t\t}\n\t\treturn agenciaPiloto;\n    }","inputVariables":["numeroAgencia"],"outputVariable":"agenciaPiloto","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d9674bc-2203-4d4f-bdcb-a47211cbc9c5","$typeOfContent":"","type":"ExecuteScript","$title":"Primeiro Nome","$invalid":false,"settings":{"function":"run","source":"            function run(dados) {\n                dados = JSON.parse(dados);\n                if(dados != \"\"){\n                   nomeCliente =  dados.nomeCliente.toLowerCase();\n                   splitSting = nomeCliente.split(\" \");\n                   nomeCliente = splitSting[0];\n                    return nomeCliente[0].toUpperCase() + nomeCliente.substring(1) ;\n                }\n\n                return \"\";\n            }","inputVariables":["dados"],"outputVariable":"nome","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"94626a3d-5dfa-4147-bdf0-2341e77b29a8","$typeOfContent":"","type":"SetVariable","$title":"Msg Saudacao AG2","$invalid":false,"settings":{"variable":"MsgSaudacaoAg2","value":"Olá {{nome}}! Tudo bem? Como posso te ajudar?"},"conditions":[]},{"$id":"69a7b7d8-4ee8-4a36-9b15-4ddc10ab057c","$typeOfContent":"","type":"ExecuteScript","$title":"Nome Gerente","$invalid":false,"settings":{"function":"run","source":"            function run(carterizcao) {\n                carterizcao = JSON.parse(carterizcao);\n                if(carterizcao != \"\"){\n                    return carterizcao.nome;\n                }\n\n                return \"\";\n            }","inputVariables":["carterizacao"],"outputVariable":"nomeGerente","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"677d6853-1d86-4963-b87d-c32b1410edfa","$typeOfContent":"","type":"ExecuteScript","$title":"email","$invalid":false,"settings":{"function":"run","source":"            function run(dados) {\n                dados = JSON.parse(dados);\n                if(dados != \"\"){\n                    return dados.email;\n                }\n\n                return \"\";\n            }","inputVariables":["dados"],"outputVariable":"email","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dados"}]},{"$id":"d2f3a814-1885-4be6-8afe-66e4ab92ce1b","$typeOfContent":"","type":"ExecuteScript","$title":"cidade","$invalid":false,"settings":{"function":"run","source":"            function run(dados) {\n                dados = JSON.parse(dados);\n                if(dados != \"\"){\n                    return dados.endereco.cidade;\n                }\n\n                return \"\";\n            }","inputVariables":["dados"],"outputVariable":"cidade","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dados"}]},{"$id":"f25f7ef7-80ed-4788-a722-821d87b600f6","$typeOfContent":"","type":"ExecuteScript","$title":"baseCpfCnpj","$invalid":false,"settings":{"function":"run","source":"             function run(dados) {\n                dados = JSON.parse(dados);\n                if(dados != \"\"){\n                    return dados.baseCpfCnpj;\n                }\n\n                return \"\";\n            }","inputVariables":["dados"],"outputVariable":"baseCpfCnpj","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dados"}]},{"$id":"699f9038-b052-48f7-b1a2-50dafa33a94a","$typeOfContent":"","type":"ExecuteScript","$title":"digitoVerificadorCpfCnpj","$invalid":false,"settings":{"function":"run","source":"             function run(dados) {\n                dados = JSON.parse(dados);\n                if(dados != \"\"){\n                    return dados.digitoVerificadorCpfCnpj;\n                }\n\n                return \"\";\n            }","inputVariables":["dados"],"outputVariable":"digitoVerificadorCpfCnpj","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dados"}]}],"$leavingCustomActions":[{"$id":"0da65b00-3042-451b-810f-6a39b1129806","$typeOfContent":"","type":"SetVariable","$title":"Monta CPF","$invalid":false,"settings":{"variable":"cpf","value":"{{baseCpfCnpj}}{{digitoVerificadorCpfCnpj}}"},"conditions":[]},{"$id":"bf682f5d-9761-4f21-be0f-21e1f4aaa613","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{},"name":"{{dados@nomeCliente}}","phoneNumber":"{{phoneNumber}}","email":"{{email}}","city":"{{cidade}}","taxDocument":"{{contact.extras.cpf}}"},"conditions":[]},{"$id":"615755a0-ee46-4410-9f99-4a2d16632a9e","$typeOfContent":"","type":"ExecuteScript","$title":"codigoCliente","$invalid":false,"settings":{"function":"run","source":"            function run(dados) {\n                dados = JSON.parse(dados);\n                if(dados != \"\"){\n                    return dados.codigoCliente;\n                }\n\n                return \"\";\n            }","inputVariables":["dados"],"outputVariable":"codigoCliente","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dados"}]}],"$inputSuggestions":[],"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c","canChangeBackground":false},{"id":"blip-tag-cea3533b-33f3-4461-9db8-f36511d804d7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-014499b3-17ef-428b-8ed1-4c125f703337","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-493477f7-5e05-40bd-9e11-3a010f60a06e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1af4d3c0-5e65-4964-bf91-908b9be17c1c","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"$defaultOutput":{"stateId":"4e6643bf-ab39-49db-9edb-c49f0038aec6","$invalid":false,"typeOfStateId":"state"},"id":"ca9e5431-2817-4708-8891-b94244cfef9b","root":false,"$title":"Cliente AG2","$position":{"top":"646px","left":"281px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ab293966-31e2-49ed-b540-c5a2b74dc793":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4239081-aca1-4815-a672-41d2de8b0941","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1fa1cdc-bd40-4adf-8da4-24d896abb4cd","typeOfStateId":"state","$connId":"con_633","$id":"34b84eb3-6a49-47e5-bd15-e4ab1c177d2c","conditions":[{"source":"context","comparison":"notEquals","values":["erro","false"],"variable":"contas"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fafa320b-548b-4acb-b22e-3d2c2668dbd5","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run () {\n    return 'client_id={{config.clientId}}&grant_type={{config.grantType}}&client_secret={{config.clientSecret}}';\n}","inputVariables":[],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"02380d5d-cf0e-44fc-b79f-835949907199","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"5932ce2d-3056-4e3e-b534-ea852833f5a7","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"28d9a7a3-0516-4b3a-af56-1b6966ee16ad","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CONSULTA LISTA CONTAS","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","responseStatusVariable":"statusListaContas","responseBodyVariable":"bodyListaContas","uri":"{{config.urlSafra}}/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas?baseDocumento={{baseCpf}}&tipoPessoa=PF"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"]},{"values":[],"source":"context","comparison":"exists","variable":"baseCpf"}]},{"$id":"db7efec9-a6ba-43d6-becb-1e4402703de9","$typeOfContent":"","type":"ExecuteScript","$title":"Define Contas","$invalid":false,"settings":{"function":"run","source":"const run = (contas) => {\n\ttry {\n\t\tconst { data } = JSON.parse(contas)\n\t\t\n\t\tif(data.length < 1) return false\n\t\n\t\treturn {\n\t\t data\n\t\t}\n\t}catch(err) {\n\t\treturn 'erro script define contas' \n\t}\n}","inputVariables":["bodyListaContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"98a633ad-fd9d-46c6-b4a8-1b99203458ae","$typeOfContent":"","type":"ExecuteScript","$title":"Definir Qtd Contas","$invalid":false,"settings":{"function":"run","source":"const run = (contas) => {\n\ttry {\n\t\tconst { data } = JSON.parse(contas)\n\t\t\n\t\tif(data.length < 1) {\n\t\t\tqtdcontas = 0\n\t\t}else{\n\t\t\tqtdcontas = data.length\n\t\t}\n\t\treturn qtdcontas;\n\n\t}catch(err) {\n\t\treturn 'erro script define contas' \n\t}\n}","inputVariables":["bodyListaContas"],"outputVariable":"qtdcontas","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c","canChangeBackground":false},{"id":"blip-tag-065400bf-e25c-44f7-9dbe-3c2e55a3665c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cb6277a2-05f1-4659-9e2a-efff8e44bcbf","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"$defaultOutput":{"stateId":"fallback","$invalid":false},"id":"ab293966-31e2-49ed-b540-c5a2b74dc793","root":false,"$title":"Verifica carterização","$position":{"top":"1414px","left":"251px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5f167461-62e3-4b66-a9a9-46e95ee3d8ef":{"$contentActions":[{"action":{"$id":"f0100f4f-db2a-412a-a83f-f478f040c5a1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f84fbb94-892c-414a-bdda-7ce0fcd6f72e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f84fbb94-892c-414a-bdda-7ce0fcd6f72e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ad91b263-5a0e-41b9-af5a-6d53edcfdb4b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a404f3db-3587-433c-a61a-1b6e93022c2c","type":"text/plain","content":"O atendimento foi finalizado. O Banco Safra agradece o seu contato.","metadata":{}},"$cardContent":{"document":{"id":"a404f3db-3587-433c-a61a-1b6e93022c2c","type":"text/plain","content":"O atendimento foi finalizado. O Banco Safra agradece o seu contato."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"30be65ba-fff7-4dde-a4a8-38806a424cc2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"21cacb87-0751-4b58-b66a-12df2ab51890","$typeOfContent":"","type":"MergeContact","$title":"Limpa Broadcast","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]},{"$id":"507a9131-6709-4cfc-ac33-ecae25b460f4","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" CLEAR","$invalid":false,"settings":{"variable":"state","value":"-"},"conditions":[]},{"$id":"a81a172b-5932-4eb6-89d7-8cc71925b7e6","$typeOfContent":"","type":"SetVariable","$title":"Set \"intencaoIdentificada\" CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada","value":""},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-d9e2bd88-066d-4dd2-8850-e7a61d04a065","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-dce35042-b82e-43b9-811c-8bcef6544efe","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-801a7ec2-b1b0-4924-9bb5-54096f0afd28","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5f167461-62e3-4b66-a9a9-46e95ee3d8ef","root":false,"$title":"Finaliza Atendimento","$position":{"top":"1505.67px","left":"1610px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b292ce4f-1590-44a1-bc78-fea4f5ccc391":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a4239081-aca1-4815-a672-41d2de8b0941","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:50187"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"fafa320b-548b-4acb-b22e-3d2c2668dbd5","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run () {\n    return 'client_id={{config.clientId}}&grant_type={{config.grantType}}&client_secret={{config.clientSecret}}';\n}","inputVariables":[],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"02380d5d-cf0e-44fc-b79f-835949907199","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"5932ce2d-3056-4e3e-b534-ea852833f5a7","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cb6766d2-fd23-4911-86a3-7facba44901b","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CONSULTA TELEFONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","responseStatusVariable":"statusConsultaTelefone","responseBodyVariable":"bodyConsultaTelefone","uri":"https://api.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais?tipoPessoa=F&ddd={{ddd}}&numeroCelular={{telefoneSemDDD}}"},"conditions":[{"source":"context","comparison":"equals","variable":"statusToken","values":["200"],"$$hashKey":"object:51173"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$tags":[{"background":"#1FE5BD","label":"LastStateUpdateScript","id":"blip-tag-62d0f16e-9923-4f7d-b397-fb22de20d57c","canChangeBackground":false},{"id":"blip-tag-e856d340-a593-45e1-8b79-971c2d94dfb3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-29711b11-a6ce-46bb-86b0-05971a24ac26","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-88415199-6e05-4f90-87dc-50c1ab24d408","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a04fb614-af67-40c2-9297-a19bac13941d","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"id":"b292ce4f-1590-44a1-bc78-fea4f5ccc391","root":false,"$title":"Serviço Consulta de Telefone","$position":{"top":"184px","left":"111px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a9bb0b9e-8421-4d2b-a6f6-a6a141f29f1b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"30be65ba-fff7-4dde-a4a8-38806a424cc2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5f167461-62e3-4b66-a9a9-46e95ee3d8ef","typeOfStateId":"state","$connId":"con_1018","$id":"075f3604-0b3f-4e9f-8ab6-83340ed435d1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7c6425f4-50be-422e-b288-ce54e6784f82","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataHoraBR\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n    var hoje = new Date();\n\n    let day = hoje.getDate() < 10 ? '0' + hoje.getDate() : hoje.getDate();\n    let month = hoje.getMonth() + 1;\n    const newDate = `${day}/${month < 10 ? '0' + month : month}/${hoje.getFullYear()} - ${hoje.getHours() < 10 ? '0' + hoje.getHours() : hoje.getHours()}:${hoje.getMinutes()}:${hoje.getSeconds() < 10 ? '0' + hoje.getSeconds() : hoje.getSeconds()}`\n    return newDate;\n}","inputVariables":[],"outputVariable":"dataHoraBR","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e414c599-0375-4fd1-9528-cb4ab61e72bc","$typeOfContent":"","type":"SetVariable","$title":"Set \"sequencialId\"","$invalid":false,"settings":{"variable":"sequencialId","value":"{{input.content@sequentialId}}"},"conditions":[]},{"$id":"a1fe4868-12f6-464a-a7fb-984ef152f819","$typeOfContent":"","type":"SetVariable","$title":"Set \"responseTags\"","$invalid":false,"settings":{"variable":"responseTags","value":"{{input.content@tags}}"},"conditions":[]},{"$id":"861d39b0-e22c-416d-8fb3-8abaebb63e42","$typeOfContent":"","type":"SetVariable","$title":"Set \"responseTeam\"","$invalid":false,"settings":{"variable":"responseTeam","value":"{{input.content@team}}"},"conditions":[]},{"$id":"7ef76e81-33db-4ea1-a6c3-8b80019e5927","$typeOfContent":"","type":"SetVariable","$title":"Set \"agentIdentity\"","$invalid":false,"settings":{"variable":"agentIdentity","value":"{{input.content@agentIdentity}}"},"conditions":[]},{"$id":"1d6eb13d-8f68-453d-a6c1-0a40b70c05c8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"agentIdentity\" formatado","$invalid":false,"settings":{"function":"run","source":"function run(email) {\n\n    const mail = email.split('@')[0];\n   \n    return mail.replace(\"%40\", \"@\");\n}","inputVariables":["agentIdentity"],"outputVariable":"agentIdentity","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"agentIdentity"}]},{"$id":"1f8b9543-f0f2-4d53-8184-07359ca17e86","$typeOfContent":"","type":"TrackEvent","$title":"Ticket Notificacao Ativa Novo","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"action":"#{{sequencialId}} - {{dataHoraBr}} - {{contact.identity}} - {{contact.extras.broadcastOrigem}} - {{respostaTemplate}} - {{contact.extras.ec}} - {{agentIdentity}}","category":"Ticket Notificacao Ativa Novo"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-35e18919-ab94-44b6-b4a4-2a0f322519bb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d0569253-1b59-416a-adc3-401527147aad","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-05a174e4-eed6-4ee6-8459-cc02485bf49f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"a9bb0b9e-8421-4d2b-a6f6-a6a141f29f1b","root":false,"$title":"Atendimento humano FInalizado","$position":{"top":"1340.75px","left":"1609.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f7455aaa-1f3a-4b2c-9662-4ef2e7e5bb62":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c0ee647b-579b-40ac-9b1e-937109f7d26d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"4cf1b179-22d4-412c-ac97-d71db63ae981","$typeOfContent":"","type":"SetVariable","$title":"selectTeam Previdencia","$invalid":false,"settings":{"variable":"selectTeam","value":"CelulaPrevidencia"},"conditions":[{"values":["consumer_ofertacrm_previdencia_privada_v2"],"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem"}]}],"$leavingCustomActions":[{"$id":"50fccb71-e4a9-4d5e-84c0-46f3a09363c9","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP - Set","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key c2FmcmFwcm9kZ2VyZGlncGY6cDBJVGdoZklOYmRndEUyc1RCZTQ="},"method":"POST","body":"{\n   \"id\":\"{{$guid}}\",\n   \"method\":\"set\",\n   \"uri\":\"/contacts\",\n   \"type\":\"application/vnd.lime.contact+json\",\n   \"resource\":{\n      \"identity\":\"{{tunnel.identity}}\",\n      \"name\":\"{{dados@nomeCliente}}\",\n      \"email\":\"{{email}}\",\n      \"city\":\"{{cidade}}\",\n      \"phoneNumber\":\"{{phoneNumber}}\",\n      \"extras\":{\n         \"cliente\":\"{{dados@nomeCliente}}\",\n         \"cpf\":\"{{cpf}}\",\n         \"conta\":\"{{numeroConta}}\",\n         \"agencia\":\"{{numeroAgencia}}\",\n         \"nome gerente\":\"{{nomeGerente}}\",\n         \"gerente\":\"{{selectTeam}}\",\n         \"team\":\"{{selectTeam}}\",\n         \"prospect nome\":\"{{prospectNome}}\"\n      }\n   }\n}","uri":"https://safra.http.msging.net/commands","responseStatusVariable":"statusSet","responseBodyVariable":"responseSet"},"conditions":[]},{"$id":"0f10c540-61fb-40f9-ab03-ba20be4d5c16","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP","$invalid":false,"settings":{"headers":{"Authorization":"Key cm91dGVyd2hhdHNhcHBkaWdpdGFsOloxblJra21TRko5eEh3RnZXVjZt","Content-Type":"application/json"},"method":"POST","body":"{\n   \"id\":\"{{$guid}}\",\n   \"method\":\"set\",\n   \"uri\":\"/contacts\",\n   \"type\":\"application/vnd.lime.contact+json\",\n   \"resource\":{\n      \"identity\":\"{{contact.identity}}\",\n      \"name\":\"{{dados@nomeCliente}}\",\n      \"email\":\"{{email}}\",\n      \"city\":\"{{cidade}}\",\n      \"phoneNumber\":\"{{phoneNumber}}\",\n      \"extras\":{\n         \"cliente\":\"{{dados@nomeCliente}}\",\n         \"cpf\":\"{{cpf}}\",\n         \"conta\":\"{{numeroConta}}\",\n         \"agencia\":\"{{numeroAgencia}}\",\n         \"nome gerente\":\"{{nomeGerente}}\",\n         \"gerente\":\"{{selectTeam}}\",\n         \"team\":\"{{selectTeam}}\",\n         \"prospect nome\":\"{{prospectNome}}\"\n      }\n   }\n}","uri":"https://safra.http.msging.net/commands","responseStatusVariable":"teste4","responseBodyVariable":"teste5"},"conditions":[]},{"$id":"09284b35-52c1-48a0-a393-771d46c9804d","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{},"name":"{{contact.extras.Extras2}}"},"conditions":[{"values":["consumer_ofertacrm_remarketing_ag2","consumer_ofertacrm_remarketing_v2","consumer_ofertacrm_mgm_indicado"],"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem"}]},{"$id":"a5d7ec5e-a7c9-47a1-9a1f-7d5dcd22c660","$typeOfContent":"","type":"TrackEvent","$title":"Campanhas ClickToWhatsApp","$invalid":false,"settings":{"extras":{},"action":"{{dataHora}}|{{phoneNumber}}|{{cpf}}|{{CampanhaClickToWhatsapp}}|{{dados@nomeCliente}}","category":"CampanhaClick"},"conditions":[{"values":["campanha_mgm","acao_remarketing","safra_building_blocks"],"source":"context","comparison":"equals","variable":"CampanhaClickToWhatsapp"}]},{"$id":"87d6f45f-197c-4a6e-bb3a-040c4f242783","$typeOfContent":"","type":"TrackEvent","$title":"TrackingDadosBlip","$invalid":false,"settings":{"extras":{},"category":"TrackingDadosBlip","action":"{{dataHora}}|prodinstitucionalpf|{{phoneNumber}}|{{cpf}}|{{codigoCliente}}|{{origemCampanhaPadrao@trackOrigemCampanha}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"276252b8-723c-488e-a593-f47a045511dd","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6d8c7bb9-9b97-4c6c-9c79-5b6bb99c83a1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e280d077-9182-4952-8337-2bf7717a6792","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d6f4aca7-f57f-4c8f-9ea0-54a376f7dd68","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"f7455aaa-1f3a-4b2c-9662-4ef2e7e5bb62","root":false,"$title":"Set Contact Extras","$position":{"top":"982.75px","left":"1205px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"276252b8-723c-488e-a593-f47a045511dd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"87318efe-312f-4d3c-b574-a347527a3473","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"e0b1c9a4-87d7-4efe-b508-83c70362dcd2","$typeOfContent":"","type":"SetVariable","$title":"zera Nivel","$invalid":false,"settings":{"variable":"nivel","value":"-","expiration":10},"conditions":[]},{"$id":"f17ddd37-f4ed-449c-8894-951319f98111","$typeOfContent":"","type":"ExecuteScript","$title":"set redirectContext","$invalid":false,"settings":{"function":"run","source":"function run( selectTeam, codigoSegmento, nivel) {\n\tif(nivel == \"N1\"){\n\t\treturn \"atendimentoN1\";\n\t};\n\n\tif(selectTeam == \"FOPA\" || selectTeam == \"fopa duvidas\"){\n\t\treturn \"atendimentoDigital\";\n\t};\n\n\tif(selectTeam == \"Einstein\" || selectTeam == \"CelulaPrevidencia\"){\n\t\treturn \"atendimentoAg2\";\n\t};\n\n\tif(codigoSegmento == \"0007\" | codigoSegmento == \"7\"){\n\t\treturn \"atendimentoAg2\";\n\t}\n\n\tif(codigoSegmento == \"0021\" | codigoSegmento == \"21\"){\n\t\treturn \"atendimentoDigital\";\n\t}\n\n\tif(codigoSegmento == \"0023\" | codigoSegmento == \"23\"){\n\t\treturn \"atendimentoSafraOne\";\n\t}\n\n\treturn \"atendimentoN1\";\n}","inputVariables":["selectTeam","codigoSegmento","nivel"],"outputVariable":"redirectContext","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"d427b188-9df4-4dfa-88e5-64e5cda88f36","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a atendimento humano","$invalid":false,"settings":{"context":{"type":"text/plain","value":"atendimento humano"},"address":"{{redirectContext}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"68bb4204-0e00-4aae-a4cc-c4f1542b14d1","$typeOfContent":"","type":"SetVariable","$title":"zerar bodyCarterizacaoAg2","$invalid":false,"settings":{"variable":"bodyCarterizacaoAg2"},"conditions":[]},{"$id":"0e4b8a2b-db27-4a0a-aac2-b43a7370dd01","$typeOfContent":"","type":"SetVariable","$title":"zerar bodyCarterizacaoDigital","$invalid":false,"settings":{"variable":"bodyCarterizacaoDigital"},"conditions":[]},{"$id":"da9db642-1420-429d-b454-861fcdc15671","$typeOfContent":"","type":"SetVariable","$title":"zerar bodyCarterizacaoOne","$invalid":false,"settings":{"variable":"bodyCarterizacaoOne"},"conditions":[]},{"$id":"87a6325c-981d-41aa-ae10-aab171ce1fd5","$typeOfContent":"","type":"SetVariable","$title":"zerar statusCarterizacaoOne","$invalid":false,"settings":{"variable":"statusCarterizacaoOne"},"conditions":[]},{"$id":"a438ce23-7f66-4cbb-9eab-4c75b2215c1b","$typeOfContent":"","type":"SetVariable","$title":"zerar statusCarterizacaoAG2","$invalid":false,"settings":{"variable":"statusCarterizacaoAG2"},"conditions":[]},{"$id":"4b58ab01-b782-4b1f-9083-063cfdd1607c","$typeOfContent":"","type":"SetVariable","$title":"zerar statusCarterizacaoDigital","$invalid":false,"settings":{"variable":"statusCarterizacaoDigital"},"conditions":[]},{"$id":"30ba42af-cbe9-42e4-a4f9-38307499ff5a","$typeOfContent":"","type":"SetVariable","$title":"verticalSaude","$invalid":false,"settings":{"variable":"verticalSaude","value":"-"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ddcee104-7756-41e6-a491-f7063638c72d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-acd7a952-8f2c-4a19-82a9-da57b0df56b6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-94f0e0c5-ffb4-46a5-9235-69bcc4a3a7a1","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"276252b8-723c-488e-a593-f47a045511dd","root":false,"$title":"R - Atendimento Humano","$position":{"top":"1203px","left":"1598px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3413a4cc-2e85-4fb3-9e9b-e019227e4c71":{"$contentActions":[{"action":{"$id":"e67122b8-d090-4061-a3d1-6a4a22ab65fd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5367f31a-73c1-4000-a360-062849fb1454","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5367f31a-73c1-4000-a360-062849fb1454","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"865718aa-0fc3-425f-a00f-e470438181b2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"54db0ed2-ee50-4312-93dc-04b925572c92","type":"text/plain","content":"Este CPF não é válido. Digite novamente o CPF com 11 dígitos como no exemplo: <b>99999999999</b>.","metadata":{}},"$cardContent":{"document":{"id":"54db0ed2-ee50-4312-93dc-04b925572c92","type":"text/plain","content":"Este CPF não é válido. Digite novamente o CPF com 11 dígitos como no exemplo: <b>99999999999</b>."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"af7b20d8-fcff-4168-b504-031e92099268","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1e5fb093-df86-4c66-b130-2160f0de712e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd553f66-2e9f-4aa6-951e-e2d2259a4913","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3413a4cc-2e85-4fb3-9e9b-e019227e4c71","root":false,"$title":"[E.1.0.0] - Erro CPF","$position":{"top":"0px","left":"2645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1fa1cdc-bd40-4adf-8da4-24d896abb4cd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5363cfc6-6c96-4367-a7e8-82ae58ab3363","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a297ec85-0596-4cda-a81c-a9d3d81d4235","typeOfStateId":"state","$connId":"con_1278","$id":"1ebf0365-2d4e-4657-845f-725ec8be5f01","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"qtdcontas"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dd2d4ba1-b076-4a83-a1b6-15a1e9661e00","$typeOfContent":"","type":"ExecuteScript","$title":"numeroConta","$invalid":false,"settings":{"function":"run","source":"function run(bodyListaContas) {\n\tlet numeroConta = JSON.parse(bodyListaContas)\n\n\tnumeroConta = numeroConta.data[0].numeroConta\n\treturn numeroConta\n}","inputVariables":["bodyListaContas"],"outputVariable":"numeroConta","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"equals","variable":"qtdcontas"}]},{"$id":"9cd55b0a-6a06-4502-a540-10c96bc07f8c","$typeOfContent":"","type":"ExecuteScript","$title":"numeroAgencia","$invalid":false,"settings":{"function":"run","source":"function run(bodyListaContas) {\n\tlet numeroAgencia = JSON.parse(bodyListaContas)\n\n\tnumeroAgencia = numeroAgencia.data[0].numeroAgencia\n\treturn numeroAgencia\n}","inputVariables":["bodyListaContas"],"outputVariable":"numeroAgencia","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"equals","variable":"qtdcontas"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1b6cef70-5c7f-4303-a133-ab32dc6bd2f6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d4dff90a-e79a-481c-a78a-457727badcd3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"a1fa1cdc-bd40-4adf-8da4-24d896abb4cd","root":false,"$title":"[GO TO] menu seleção de contas","$position":{"top":"1921px","left":"637px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1b6cef70-5c7f-4303-a133-ab32dc6bd2f6":{"$contentActions":[{"action":{"$id":"1dce4658-b5eb-4fca-9d15-602df0f27386","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbdc6fe-5f44-4fa1-9b84-69d4554a3839","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbdc6fe-5f44-4fa1-9b84-69d4554a3839","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c1eae954-58b5-4fb7-bf36-321e0ca08c4d","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menu@contentType}}","rawContent":"{{menu@menu}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"a76f71dd-fafa-488f-b3de-6805b19eeac8","type":"text/plain","textContent":"Entrada do usuário","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"onboarding","typeOfStateId":"state","$connId":"con_1283","$id":"b27e2734-cde2-4fc9-a674-d1cb93d334b5","conditions":[{"source":"input","comparison":"notExists","values":[]}],"$invalid":false},{"stateId":"a719f4a3-c4dd-4447-944e-b85120b7ba4f","typeOfStateId":"state","$connId":"con_1288","$id":"08b92df5-e8b3-488e-aa4d-3d4d3bddf978","conditions":[{"source":"input","comparison":"contains","values":["CPF"]}],"$invalid":false},{"stateId":"a297ec85-0596-4cda-a81c-a9d3d81d4235","typeOfStateId":"state","$connId":"con_1293","$id":"09acb1a3-7d1d-4754-b611-7996b1c2d773","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"validaMenu@input"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0aa0a03d-9bcc-4155-9c9e-956acbfb24f6","$typeOfContent":"","type":"ExecuteScript","$title":"Define templateMenu","$invalid":false,"settings":{"function":"run","source":"const run = (rawContas) => {\n\tconst {data} = JSON.parse(rawContas)\n\n\t    const contas = data.map(option => {\n      return {\n         text: `Conta: ${option.numeroConta}`,\n        description: `AG: ${option.numeroAgencia}`\n      }\n    })\n\n    const template = {\n      title: '',\n      body: `Vi que você tem mais de uma conta. \n\nQual delas você quer usar para o atendimento?`,\n      options: contas\n    }\n\n\treturn template\n}","inputVariables":["contas"],"outputVariable":"templateMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b9f565ef-fd75-4f87-b758-7370ddabc2aa","$typeOfContent":"","type":"ExecuteScript","$title":"Montar menu -> menuPrincipal","$invalid":false,"settings":{"function":"run","source":"{{resource.FABRICA_MENU}}\n\nfunction run(templateMenu, canal = 'BLIPCHAT') {\n  try {\n    const CANAL = canal ? canal.toUpperCase() : 'BLIPCHAT';\n    const template = JSON.parse(templateMenu)\n    let menu = {};\n    let contentType = 'application/json';\n\n    if (CANAL === 'WHATSAPP') {\n      menu = fabricaMenu.criarMenuWhatsApp(template);\n    }\n    else\n      if (CANAL === 'BLIPCHAT') {\n        menu = fabricaMenu.criarMenuBlipChat(template);\n        contentType = 'application/vnd.lime.select+json';\n      }\n      else {\n        contentType = 'text/plain';\n        menu = `<b>${template.title}</b>\n      \n      `;\n        template.options.forEach((option, index) => {\n          menu += `${index + 1} - ${option.text}\n        `;\n        });\n        menu += `\n      Digite o número desejado. 😀`\n      }\n\n    return { menu, contentType };\n  } catch (error) {\n    return { err: error.toString() };\n  }\n}\n","inputVariables":["templateMenu","contact.extras.Canal"],"outputVariable":"menu","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b4a81e8c-2c6e-45e8-bd13-04e6fb89a108","type":"ExecuteScript","$title":"validarMenu() -> validaMenu","$invalid":false,"settings":{"function":"run","source":"\n// Exemplos variáveis de entrada:\n// templateMenu = resource.menuPrincipal\n// userInput = input.content\nfunction run(templateMenu, userInput = '') {\n  const retorno = {\n    inputOriginal: userInput,\n  }\n  try {\n    const menu = JSON.parse(templateMenu);\n\n    const escolhaMenu = validarOpcoes(menu.options, userInput);\n\n    if (escolhaMenu) {\n      retorno.input = escolhaMenu.text;\n      retorno.id = escolhaMenu.id;\n    }\n\n    // variável de saída: validaMenu\n    return retorno;\n  } catch (error) {\n    const err = error.toString();\n    retorno.err = err;\n    return retorno;\n  }\n}\n\nconst validarOpcoes = (options, input) => {\n  const INPUT = input.toUpperCase();\n  let ID;\n\n  const escolha = options.find((option, index) => {\n    const id = option.id ? option.id : index + 1;\n    const TEXT = option.text.toUpperCase();\n    const FULL_TEXT = `${id} - ${option.text}`.toUpperCase();\n    const DESCRIPTION = option.description\n      ? option.description.toUpperCase()\n      : null;\n\n    // Salva o id\n    ID = id;\n\n    return (\n      INPUT == id.toString() ||\n      INPUT == TEXT ||\n      INPUT == FULL_TEXT ||\n      INPUT == DESCRIPTION\n    );\n  });\n\n  return escolha ? { text: escolha.text, id: ID } : false;\n};\n","inputVariables":["templateMenu","input.content"],"outputVariable":"validaMenu","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8c047348-79a2-4f01-8c04-ee1953c88d61","$typeOfContent":"","type":"ExecuteScript","$title":"define informaçoes da conta para o contato","$invalid":false,"settings":{"function":"run","source":"const run = (contas, inputObj) => {\n\ttry{\n\t\tconst {data} = JSON.parse(contas)\n\t\tconst {input} = JSON.parse(inputObj)\n\t\tconst numeroConta = input.split(' ')[1]\n\t\tconst conta = data.find(i => i.numeroConta === numeroConta)\n\t\treturn conta !== undefined ? conta : false\n\t}catch(err) {\n\t\treturn false\n\t}\n\n\t\n}","inputVariables":["contas","validaMenu"],"outputVariable":"informacoesDaConta","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cf521238-1d41-4bd2-a942-bdcd72bb2053","$typeOfContent":"","type":"MergeContact","$title":"salva informacoes da conta","$invalid":false,"settings":{"extras":{"numeroConta":"{{informacoesDaConta@numeroConta}}","numeroAgencia":"{{informacoesDaConta@numeroAgencia}}","codigoCliente":"{{informacoesDaConta@codigoCliente}}","situacaoConta":"{{informacoesDaConta@situacaoConta}}","tipoConta":"{{informacoesDaConta@codigoTipoConta}}"}},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"informacoesDaConta"}]},{"$id":"0681a01c-56a0-4607-81d2-0d4e6611ebf2","$typeOfContent":"","type":"SetVariable","$title":"numeroConta","$invalid":false,"settings":{"variable":"numeroConta","value":"{{informacoesDaConta@numeroConta}}"},"conditions":[]},{"$id":"dc669ff5-98cf-4211-a7e3-b53ec4b1ff67","$typeOfContent":"","type":"SetVariable","$title":"numeroAgencia","$invalid":false,"settings":{"value":"{{informacoesDaConta@numeroAgencia}}","variable":"numeroAgencia"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1b6cef70-5c7f-4303-a133-ab32dc6bd2f6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cecd320a-9bde-43d1-806c-73ba792bcff5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3ccb627b-201e-4159-a4ff-a26bd0c2a2eb","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-d56bd578-9ca7-4fa0-b98c-da9bf5521c1e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b1bc121b-afbd-4345-ad6b-5a9e90f12ac7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-16d2c11e-b200-4b8c-ae9b-e46a8151488a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1b6cef70-5c7f-4303-a133-ab32dc6bd2f6","root":false,"$title":"menu seleção de contas","$position":{"top":"2058px","left":"634px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a297ec85-0596-4cda-a81c-a9d3d81d4235":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"74bd3b81-3f3e-4300-b8d9-403b9ab527b0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ca9e5431-2817-4708-8891-b94244cfef9b","typeOfStateId":"state","$connId":"con_1298","$id":"a6cc4300-1664-4544-a81f-0ebc11632b6e","conditions":[{"source":"context","comparison":"equals","values":["07100"],"variable":"numeroAgencia"},{"values":["acao_remarketing","safra_building_blocks","campanha_mgm"],"source":"context","comparison":"equals","variable":"CampanhaClickToWhatsapp"}],"$invalid":false},{"stateId":"ca9e5431-2817-4708-8891-b94244cfef9b","typeOfStateId":"state","$connId":"con_1303","$id":"084671f2-d1d1-414e-b5ca-0a1d1cfbe126","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusCarterizacaoAG2"}],"$invalid":false},{"stateId":"cf6776cd-3457-45f1-b18e-d10455a39ea0","typeOfStateId":"state","$connId":"con_1328","$id":"22484be4-870e-431a-a3b9-ee62063461da","conditions":[{"source":"context","comparison":"matches","values":["\\b\\d+\\b"],"variable":"codigoSegmento"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d0a6648b-3f5d-4db2-b7ea-9ea2e59905a9","$typeOfContent":"","type":"SetVariable","$title":"statusCarterizacaoAG2","$invalid":false,"settings":{"variable":"statusCarterizacaoAG2","value":"-"},"conditions":[]},{"$id":"634cea0c-b97f-4796-8239-f3db3cd5069e","$typeOfContent":"","type":"SetVariable","$title":"statusCarterizacaoDigital","$invalid":false,"settings":{"variable":"statusCarterizacaoDigital","value":"-"},"conditions":[]},{"$id":"36e2d82f-52a3-48ae-8d4b-754023fc2531","$typeOfContent":"","type":"SetVariable","$title":"statusCarterizacaoOne","$invalid":false,"settings":{"variable":"statusCarterizacaoOne","value":"-"},"conditions":[]},{"$id":"824eb489-1509-4946-9e95-4a16e4b56096","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run () {\n    return 'client_id={{config.clientId}}&grant_type={{config.grantType}}&client_secret={{config.clientSecret}}';\n}","inputVariables":[],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"64b98748-a362-41e6-86c0-05bfb03dea64","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"458d6de4-59fb-4e86-93e2-fdae6f639166","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"28b8b0e1-603f-4b83-a316-5c8a4a83ede6","$typeOfContent":"","type":"ProcessHttp","$title":"CONSULTA Segmento","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","uri":"{{config.urlSafra}}/chat-assistente/gerentes/v1/gerentes?agencia={{numeroAgencia}}&conta={{numeroConta}}","responseStatusVariable":"statusConsultaSegmento","responseBodyVariable":"bodyConsultaSegmento"},"conditions":[]},{"$id":"0ba19299-59f1-4ef9-bae9-16a09ca2b95f","$typeOfContent":"","type":"SetVariable","$title":"Definir DadosBodyConsultaSegmento","$invalid":false,"settings":{"variable":"bodyConsultaSegmento","value":"{{bodyConsultaSegmento@data}}"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusConsultaSegmento"}]},{"$id":"93e4638c-6490-4fe5-bc16-1d928fcbdf4f","$typeOfContent":"","type":"ExecuteScript","$title":"Pega Segmento","$invalid":false,"settings":{"function":"run","source":"            function run(bodyConsultaSegmento) {\n                bodyConsultaSegmento = JSON.parse(bodyConsultaSegmento);\n                if(bodyConsultaSegmento != \"\"){\n                    return bodyConsultaSegmento.codigoSegmento;\n                }\n\n                return \"\";\n            }","inputVariables":["bodyConsultaSegmento"],"outputVariable":"codigoSegmento","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusConsultaSegmento"}]}],"$leavingCustomActions":[{"$id":"547f234c-55fe-4fad-a2d7-7bc82012a1db","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CONSULTA SEG AG2","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","responseStatusVariable":"statusCarterizacaoAG2","responseBodyVariable":"bodyCarterizacaoAg2","uri":"{{config.urlCHT}}/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contact.extras.cpf}}&codigoSegmento={{config.segmentoAG2}}"},"conditions":[{"source":"context","comparison":"equals","variable":"codigoSegmento","values":["0007"]}]},{"$id":"831ee641-9da9-452e-8b87-50df4d15f457","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CONSULTA SEG DIGITAL","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","uri":"{{config.urlCHT}}/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contact.extras.cpf}}&codigoSegmento={{config.codigoSegmento}}","responseStatusVariable":"statusCarterizacaoDigital","responseBodyVariable":"bodyCarterizacaoDigital"},"conditions":[{"values":["21","0021"],"source":"context","comparison":"equals","variable":"codigoSegmento"}]},{"$id":"22b73434-88e0-44c3-b180-dcff0083831a","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CONSULTA SEG ONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","uri":"{{config.urlCHT}}/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contact.extras.cpf}}&codigoSegmento={{config.codigoSegmentoOne}}","responseStatusVariable":"statusCarterizacaoOne","responseBodyVariable":"bodyCarterizacaoOne"},"conditions":[{"values":["23","0023"],"source":"context","comparison":"equals","variable":"codigoSegmento"}]},{"$id":"6803b0ff-5315-4116-9c84-a1903249ba31","$typeOfContent":"","type":"ProcessHttp","$title":"GET DADOS CLIENTE para 07100","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Bot-ID":"safraprodgerdigpf"},"method":"GET","uri":"{{config.urlCHT}}/contas-pessoa-juridica/v1/clientes?tipoPessoa=F&cpfCnpj={{baseCpf}}","responseStatusVariable":"statusDados","responseBodyVariable":"bodyDados"},"conditions":[{"values":["07100"],"source":"context","comparison":"equals","variable":"numeroAgencia"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b4970c12-2eec-4e89-87a8-7808d80ffe0b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5907a17b-7c8a-466e-a2aa-77f34401c752","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-331165a5-f516-48e6-87bb-5622ee0238b6","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"a297ec85-0596-4cda-a81c-a9d3d81d4235","root":false,"$title":"Consulta Segmento","$position":{"top":"2194px","left":"632px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4e6643bf-ab39-49db-9edb-c49f0038aec6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7fb36fa7-0ef4-4f4c-beda-bff794c729d5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7","typeOfStateId":"state","$connId":"con_1723","$id":"4c09c361-4fb9-415d-9184-68ec7552c578","conditions":[{"source":"context","comparison":"notEquals","values":["None"],"variable":"intencaoIdentificada@intent"},{"values":["null"],"source":"context","comparison":"notEquals","variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"9864ca6b-46ef-4821-8b0e-1a019ecb36a6","typeOfStateId":"state","$connId":"con_1728","$id":"94637f36-26e0-44c4-b0ba-4e4bd4278c9a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"93ddc840-305a-48a6-a794-081363df1fb1","$typeOfContent":"","type":"TrackEvent","$title":"Inicio piloto dados","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Inicio piloto dados","action":"Exibicao"},"conditions":[]},{"$id":"8d7cc6dc-f88e-4848-bc05-c152459de57e","$typeOfContent":"","type":"TrackEvent","$title":"Inicio piloto dados","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Inicio piloto dados","action":"{{contact.identity}} | {{contact.extras.cpf}} | {{contas}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-b6ea3fe9-923c-4a54-86cf-291ca86e34dd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4e6643bf-ab39-49db-9edb-c49f0038aec6","root":false,"$title":"[PF.1.0.0] Inicio Piloto NLP","$position":{"top":"654px","left":"2404px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"82de60ae-3a90-4719-b838-62a7e9bc2924":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"91445145-a309-4ba9-a562-9cbc4f526127","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"624d09dd-af9b-4e6b-a6a6-dab63481ad6c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, intencaoIdentificada,serviceName) {\n\ttry {\n\t\tintencaoIdentificada = JSON.parse(intencaoIdentificada)\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName,\n\t\t\tbotDestination: \"extrato\",\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: intencaoIdentificada.input,\n\t\t\tintent: intencaoIdentificada.intent\n\t\t}\n\t} catch (error) {\n\t\treturn \"\"\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","intencaoIdentificada","config.serviceName"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"24dd5ddb-16f2-4bc3-b962-125017be6bef","type":"Redirect","$title":"Redirect to {service} without input","$invalid":false,"settings":{"address":"{{state@botDestination}}","context":{"type":"text/plain","value":"{{state@lastInput}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9f066003-ef30-4171-a826-6da21b035eaf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1bd2587e-e3ee-4270-b68d-956b40aaff5d","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"82de60ae-3a90-4719-b838-62a7e9bc2924","root":false,"$title":"[Desativado][Redirect] To Extrato","$position":{"top":"662px","left":"2597.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9d1c3cfd-5b20-4bb9-892e-53e4b340117d":{"$contentActions":[{"action":{"$id":"eae94e8b-f00d-4c6e-aa75-4ff7f63d6434","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8cfadc8d-833e-484e-9110-305e318cf3a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8cfadc8d-833e-484e-9110-305e318cf3a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"405edfa7-f137-4dba-b1e6-df4d13c150be","$typeOfContent":"text","type":"SendMessage","settings":{"id":"53b16e06-51a4-4628-b38a-a1f9426563d2","type":"text/plain","content":"Olá, sou o <b>Assistente Digital do Safra</b> e estou aqui para <b>te ajudar com dúvidas, consultas e serviços relacionados à sua conta.</b>","metadata":{}},"$cardContent":{"document":{"id":"53b16e06-51a4-4628-b38a-a1f9426563d2","type":"text/plain","content":"Olá, sou o <b>Assistente Digital do Safra</b> e estou aqui para <b>te ajudar com dúvidas, consultas e serviços relacionados à sua conta.</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"78d15107-5af0-4851-8c7f-fbf1dceefeb7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"73e7c695-ded4-47bc-8877-fd0a29e4dfc8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"73e7c695-ded4-47bc-8877-fd0a29e4dfc8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f646940b-6137-4d73-aa45-17a4fa713b7d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e4f7fef1-ef77-417f-8902-f61305ec2fa1","type":"text/plain","content":"Como posso ajudar?","metadata":{}},"$cardContent":{"document":{"id":"e4f7fef1-ef77-417f-8902-f61305ec2fa1","type":"text/plain","content":"Como posso ajudar?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd773774-f366-4d77-8aeb-29af5b66f18f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f338e3e6-65d2-4706-a7bc-77bd22a1a7e8","typeOfStateId":"state","$connId":"con_1733","$id":"35d1aacf-2564-4b66-aaf5-43a3fdf5990a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e8a1c91-61ee-4d97-97c5-b3ca0f95cf7a","$typeOfContent":"","type":"TrackEvent","$title":"Saudacao piloto exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Saudacao piloto exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6612b3ba-f21e-4768-87e0-a70af1395d36","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b28d54ea-f204-4f0f-9279-6c00aa214cb9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9d1c3cfd-5b20-4bb9-892e-53e4b340117d","root":false,"$title":"[PF.2.0.1][MSG] Saudação Piloto","$position":{"top":"827.286px","left":"2403px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f338e3e6-65d2-4706-a7bc-77bd22a1a7e8":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"187210cb-5394-4b73-8868-89da636ddf49","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$connId":"con_1738","$id":"49d9b416-0788-4690-afa9-ffa368b6c132","conditions":[{"source":"intent","comparison":"exists","values":[]}],"$invalid":false,"stateId":"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7"},{"stateId":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","typeOfStateId":"state","$connId":"con_1743","$id":"44335b3e-6ddd-468b-8a9d-dcd688b69264","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9e3f997c-a1f5-405b-9561-400ed19548ef","$typeOfContent":"","type":"TrackEvent","$title":"Piloto validacao intencao contador","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Piloto validacao intencao contador","action":"Contador"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c68efea6-9752-409e-b61e-b999e3276d87","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"233cc0b6-2618-42ce-836e-91560f92052c","$typeOfContent":"","type":"TrackEvent","$title":"Intencoes e inputs saudacao dados","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Intencoes e inputs saudacao dados","action":"{{contact.identity}} | {{input.content}} | {{input.state.name}} | {{calendar.datetime}}"},"conditions":[]},{"$id":"36325988-93fd-4787-8234-c5b36955cbc8","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"contatoGerente\"","$invalid":false,"settings":{"variable":"exceptionType","value":"contatoGerente"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cca7151d-0548-4cb8-8b1d-af0be337f0b4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d31c22fb-58ca-4ffc-8a80-2af7eaeac211","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-15ae7d54-f91a-4ab2-8978-2135a78934f5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-2b886923-9a24-442f-ae93-c5ce6bde39a6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f338e3e6-65d2-4706-a7bc-77bd22a1a7e8","root":false,"$title":"[PF.2.0.0][INPUT] Validação Intenção","$position":{"top":"1013.29px","left":"2328px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"eddeb205-5810-40e9-9d0d-69b714415542":{"$contentActions":[{"action":{"$id":"669c68a1-bbe4-4d2f-b250-23e22997624e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"96394cbe-5d3d-48b3-8f50-60709244121c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"96394cbe-5d3d-48b3-8f50-60709244121c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7d7ec819-5db8-4511-8d1c-71df944febd2","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c1e16903-9abc-4a7e-8410-a2eb3783a5a6","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"99fb026e-686f-4573-9041-e767a11421ee","typeOfStateId":"state","$connId":"con_1748","$id":"4876368f-574d-4430-8071-82ea849a5141","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7","typeOfStateId":"state","$connId":"con_1758","$id":"9070784a-a648-4018-a118-29c0b6ecc037","conditions":[{"source":"intent","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"75cd8716-02d6-4f6d-a466-267ca34870a9","$typeOfContent":"","type":"TrackEvent","$title":"Encerrar exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Encerrar exibicao","action":"Exibicao"},"conditions":[]},{"$id":"9bb020dd-1f88-4dfe-9b07-54e0a96ed520","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" CLEAR","$invalid":false,"settings":{"variable":"state","value":"-"},"conditions":[]},{"$id":"1b59c5fb-5dbd-4805-a359-07ba5d1baca2","$typeOfContent":"","type":"SetVariable","$title":"Set \"intencaoIdentificada\" CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada","value":""},"conditions":[]},{"$id":"a0a61a5d-94b6-4172-8309-226af64f7dc2","$typeOfContent":"","type":"SetVariable","$title":"Set \"SaudacaoJaFoiFeita\" CLEAR","$invalid":false,"settings":{"variable":"SaudacaoJaFoiFeita","value":"-"},"conditions":[]},{"$id":"b04c4018-6388-4a7d-ba92-dc489eb9b667","$typeOfContent":"","type":"SetVariable","$title":"CLEAR \"errorCounter\"","$invalid":false,"settings":{"variable":"errorCounter"},"conditions":[]},{"$id":"e485821d-b787-41d7-90d3-90e069b77a7c","$typeOfContent":"","type":"SetVariable","$title":"CLEAR \"exceptionType\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]},{"$id":"0123cdc0-c2a6-4eac-be68-dd3d956586e1","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionTypeMedia CLEAR","$invalid":false,"settings":{"variable":"exceptionTypeMedia"},"conditions":[]},{"$id":"5876213c-76c8-4ade-b422-068c0be98aed","$typeOfContent":"","type":"SetVariable","$title":"Set \"contas\" CLEAR","$invalid":false,"settings":{"variable":"contas","value":"false"},"conditions":[]},{"$id":"1663fd65-3a01-4755-bb56-980054352c13","$typeOfContent":"","type":"SetVariable","$title":"Set \"qtdcontas\" CLEAR","$invalid":false,"settings":{"variable":"qtdcontas"},"conditions":[]},{"$id":"aa70304e-8a97-4c5f-b325-5aa642cec55a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Consegui te ajudar com o que precisava?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"48cf32ce-27fe-4f12-b6bc-6fdcef3f5f4b","$typeOfContent":"","type":"SetVariable","$title":"Set redirectMessage CLEAR","$invalid":false,"settings":{"variable":"redirectMessage"},"conditions":[]},{"$id":"e8239738-a286-4025-8302-2a10d0377c73","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"588ce693-ed2c-4261-b631-b9bbd3ac01ab","$typeOfContent":"","type":"MergeContact","$title":"Limpa Broadcast","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$leavingCustomActions":[{"$id":"d86bc61f-ecdd-449f-859d-326768c2b22f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e87999a1-eeb1-4d1d-8f2a-f6b617fbdfc1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"78166275-5dd2-4391-b0d8-392ee08d757c","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"7bfc582f-b28f-4420-8b86-33f5a58827b0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"9119a8d2-b9a1-4b49-a56e-45a5fe1df7b0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3fc6973e-153b-4ac6-90a8-6b4b8dc24381","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1dbc9f2f-f256-4a01-80d5-2602367a25f7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-259d49aa-f3de-4e2c-9d0a-e11f77194f7f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1f5d960b-6cf2-4a07-a168-273eb82582f6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1b36d827-a2bd-4147-b48a-24165df1bdea","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-0b79f139-1a40-44e0-80b4-bab548f92b8b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-59d23bff-8209-46a7-ae4f-7c52ddfcf05b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"eddeb205-5810-40e9-9d0d-69b714415542","root":false,"$title":"[PF.2.1.0][MSG][INPUT] Encerramento","$position":{"top":"1680.57px","left":"2588.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e4c1acf3-e610-4d60-8a8c-771c988209d3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cede0f5a-5453-45c2-a4fd-e95e478bdd14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c7eb5b06-ca45-4d7e-be53-b9e17da7fd6d","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a47b9266-9bda-4ef7-b452-8e01c5b44394","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e4c1acf3-e610-4d60-8a8c-771c988209d3","root":false,"$title":"[Redirect] to cascata","$position":{"top":"417.333px","left":"2220.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cf6776cd-3457-45f1-b18e-d10455a39ea0":{"$contentActions":[{"action":{"$id":"e486e172-b174-4028-8f96-681853bde7e2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4da318a3-1a1f-481d-9037-4c0d5fd209a4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4da318a3-1a1f-481d-9037-4c0d5fd209a4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8c6fd0e5-28ba-4bf7-9b89-4ea09e11d1bb","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ecf9c586-f4de-4dd7-826a-629b9b185517","type":"text/plain","content":"Realizamos uma busca e identificamos que no momento essa conta possui um segmento <b>({{codigoSegmento}})</b> que não faz parte deste modelo de atendimento.","metadata":{}},"$cardContent":{"document":{"id":"ecf9c586-f4de-4dd7-826a-629b9b185517","type":"text/plain","content":"Realizamos uma busca e identificamos que no momento essa conta possui um segmento <b>({{codigoSegmento}})</b> que não faz parte deste modelo de atendimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"51f93b91-b5b4-4120-a3c3-4ee555606424","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"15972d17-526e-4e04-8f52-a0bf8d84add5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"15972d17-526e-4e04-8f52-a0bf8d84add5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dfc25d6b-5dfe-4f6f-a0a3-d4da013c1804","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0047651f-9e53-4bcf-aa05-ddc8bd716676","type":"text/plain","content":"Para entrar em contato com o Banco Safra, ligue para as centrais de atendimento:\n\n<b>PESSOA FÍSICA</b>:\n55 11 3253 4455 Capital e Grande São Paulo | 0300 105 1234 Demais localidades\nDe 2ª a 6ª feira, das 8h ás 21h30, exceto feriados.\n\n<b>SAFRA HIGH NET</b>:\n55 11 3003 9096 Capital e Grande São Paulo | 0800 722 9096 Demais localidades\nDe 2ª a 6ª feira, das 8h ás 21h30, exceto feriados.\n\n<b>SAFRA PRIVATE BANKING</b>:\n55 11 3253 4455 Capital e Grande São Paulo | 0800 772 2155 Demais localidades\nDe 2ª a 6ª feira, das 8h ás 21h30, exceto feriados.","metadata":{"#message.spinText":"true"}},"$cardContent":{"document":{"id":"0047651f-9e53-4bcf-aa05-ddc8bd716676","type":"text/plain","content":"Para entrar em contato com o Banco Safra, ligue para as centrais de atendimento:\n\n<b>PESSOA FÍSICA</b>:\n55 11 3253 4455 Capital e Grande São Paulo | 0300 105 1234 Demais localidades\nDe 2ª a 6ª feira, das 8h ás 21h30, exceto feriados.\n\n<b>SAFRA HIGH NET</b>:\n55 11 3003 9096 Capital e Grande São Paulo | 0800 722 9096 Demais localidades\nDe 2ª a 6ª feira, das 8h ás 21h30, exceto feriados.\n\n<b>SAFRA PRIVATE BANKING</b>:\n55 11 3253 4455 Capital e Grande São Paulo | 0800 772 2155 Demais localidades\nDe 2ª a 6ª feira, das 8h ás 21h30, exceto feriados."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0a7aca13-0405-41cd-9784-2eb8fb3a1480","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1767876b-0823-460d-aef8-ce1317e3df36","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1767876b-0823-460d-aef8-ce1317e3df36","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"45e22042-090b-4ec9-8655-f5331fe54a90","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e78455f2-51dc-4487-af97-a9d4728f0188","type":"text/plain","content":"Caso queira saber mais sobre nossos canais de atendimento, acesse:\n https://www.safra.com.br/atendimento/atendimento-ao-cliente/telefones.htm","metadata":{}},"$cardContent":{"document":{"id":"e78455f2-51dc-4487-af97-a9d4728f0188","type":"text/plain","content":"Caso queira saber mais sobre nossos canais de atendimento, acesse:\n https://www.safra.com.br/atendimento/atendimento-ao-cliente/telefones.htm"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3ee0f74-c5e7-48ab-b2fe-ca636d244b61","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0514afb9-aa98-4326-a677-2d5c1abc064c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cf6776cd-3457-45f1-b18e-d10455a39ea0","root":false,"$title":"Segmento Ainda Não Disponivel","$position":{"top":"2355px","left":"632px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"df6d322b-86e9-48da-a8df-d92839950539":{"$contentActions":[{"action":{"$id":"eae94e8b-f00d-4c6e-aa75-4ff7f63d6434","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8cfadc8d-833e-484e-9110-305e318cf3a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8cfadc8d-833e-484e-9110-305e318cf3a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"405edfa7-f137-4dba-b1e6-df4d13c150be","$typeOfContent":"text","type":"SendMessage","settings":{"id":"53b16e06-51a4-4628-b38a-a1f9426563d2","type":"text/plain","content":"Como posso te ajudar hoje?","metadata":{}},"$cardContent":{"document":{"id":"53b16e06-51a4-4628-b38a-a1f9426563d2","type":"text/plain","content":"Como posso te ajudar hoje?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd773774-f366-4d77-8aeb-29af5b66f18f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f338e3e6-65d2-4706-a7bc-77bd22a1a7e8","typeOfStateId":"state","$connId":"con_1763","$id":"35d1aacf-2564-4b66-aaf5-43a3fdf5990a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e8a1c91-61ee-4d97-97c5-b3ca0f95cf7a","$typeOfContent":"","type":"TrackEvent","$title":"Saudacao piloto exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Saudacao piloto exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0bc8b5c6-e67c-4abd-9121-d9e0b8954b26","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-78075ad3-8642-4783-8a22-4fbcd42441cd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"df6d322b-86e9-48da-a8df-d92839950539","root":false,"$title":"[PF.2.0.1][MSG] Como ajudar?","$position":{"top":"826.571px","left":"2216px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ebc39789-37c0-4716-a46b-02150dcd40a7":{"$contentActions":[{"action":{"$id":"eae94e8b-f00d-4c6e-aa75-4ff7f63d6434","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8cfadc8d-833e-484e-9110-305e318cf3a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8cfadc8d-833e-484e-9110-305e318cf3a2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"405edfa7-f137-4dba-b1e6-df4d13c150be","$typeOfContent":"text","type":"SendMessage","settings":{"id":"53b16e06-51a4-4628-b38a-a1f9426563d2","type":"text/plain","content":"Ótimo, como posso te ajudar?","metadata":{}},"$cardContent":{"document":{"id":"53b16e06-51a4-4628-b38a-a1f9426563d2","type":"text/plain","content":"Ótimo, como posso te ajudar?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd773774-f366-4d77-8aeb-29af5b66f18f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f338e3e6-65d2-4706-a7bc-77bd22a1a7e8","typeOfStateId":"state","$connId":"con_1768","$id":"35d1aacf-2564-4b66-aaf5-43a3fdf5990a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e8a1c91-61ee-4d97-97c5-b3ca0f95cf7a","$typeOfContent":"","type":"TrackEvent","$title":"Saudacao piloto exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Saudacao piloto exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c2cad573-1e17-4e72-9fc2-0d05748b15f5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7a529ba7-3b00-4ee6-8713-6a5c901e570d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ebc39789-37c0-4716-a46b-02150dcd40a7","root":false,"$title":"[PF.2.0.3][MSG] Ótimo","$position":{"top":"831.714px","left":"2583.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4b5c1d35-22f7-40d0-a065-3a53f5459b3a","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"add185f5-47a6-4d22-afe1-7ea5a6202fbc","$typeOfContent":"","type":"TrackEvent","$title":"identified intent name","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"identified intent name","action":"{{input.intent.name}} | {{intencaoIdentificada@intent}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.intent.name"}]},{"$id":"cfd1daad-b46a-45d0-9b57-ea0a4c36a1bb","$typeOfContent":"","type":"TrackEvent","$title":"identified intent name dados","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"identified intent name dados","action":"{{input.intent.name}} | {{intencaoIdentificada@intent}} | {{input.content}} | {{contact.identity}} | {{contas}} | {{calendar.datetime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-978b8fb2-c5d5-4bee-9322-c866479dea10","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7","root":false,"$title":"[SET] Direcionamento de Intencoes","$position":{"top":"1150px","left":"2571.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ed2a5fb2-da6f-4961-b14d-e302fa57b991":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"action":{"$id":"050b7faa-c985-4824-98e4-96806e124f6b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"da5dbd85-7f97-46e7-bd06-d9f1a41721a6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"da5dbd85-7f97-46e7-bd06-d9f1a41721a6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2277261f-1fd3-4041-ad2a-494985ee2067","typeOfStateId":"state","$connId":"con_1783","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Câmbio\",\n\t\t\t\t\"description\": \"Compra e venda de moeda estrangeira\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Corretora\",\n\t\t\t\t\"description\": \"Invista na Corretora\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Renegociação\",\n\t\t\t\t\"description\": \"Consultas, Boletos, Renegociação, Dúvidas e atendimento\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Falar com gerente\",\n\t\t\t\t\"description\": \"Fale com o seu gerente\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Outros assuntos\",\n\t\t\t\t\"description\": \"Digite o que você precisa\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Toque no *botão abaixo* para ver os *assuntos em que posso te ajudar*. Se quiser falar sobre *outro tema*, digite em poucas palavras o que *você precisa*.` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Ver opções\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2afb616d-9f1d-4da1-be08-cf3d1a1ea793","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f0ec870-bdc2-4bdf-9abe-9f71701d22b4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-95bd4c56-71a1-4e12-892a-9793672d29ec","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","root":false,"$title":"[PF.3.0.1][MSG] Menu Assuntos","$position":{"top":"1184px","left":"2326px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2277261f-1fd3-4041-ad2a-494985ee2067":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7","typeOfStateId":"state","$connId":"con_1788","$id":"3a28db6d-f312-4f99-9d13-4f26121d50f8","conditions":[{"source":"intent","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"{{state.name}} validação","action":"{{input.content}} | {{intencaoIdentificada@intent}}"},"conditions":[]},{"$id":"be792b73-054c-4e22-ae1c-d064fb316994","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9f0941c8-a1f8-4fae-b810-7887f763ce8a","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f7af9c0f-ae4e-4c0d-a391-dc904e9a895d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b7a59127-6635-4677-9492-72e5bcd0f4ca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-15667d4e-47a7-4820-931c-c3ef55944300","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2277261f-1fd3-4041-ad2a-494985ee2067","root":false,"$title":"[PF.3.0.1][INPUT] Menu Assuntos","$position":{"top":"1353px","left":"2297.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bbaeedb9-b42a-4691-b57e-d2bd0a20bcd8":{"$contentActions":[{"action":{"$id":"e042909d-03c1-406c-9a9c-3584ae0444c9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d149bc9b-a925-43cc-aa1b-24993d2537f5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d149bc9b-a925-43cc-aa1b-24993d2537f5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4f970291-b90f-4dc9-ac03-631b9d5ae042","$typeOfContent":"text","type":"SendMessage","settings":{"id":"1b48f4ac-afd9-4b4d-b8a2-4b8084c92d58","type":"text/plain","content":"Digite em poucas palavras o que <b>você precisa</b>.","metadata":{}},"$cardContent":{"document":{"id":"1b48f4ac-afd9-4b4d-b8a2-4b8084c92d58","type":"text/plain","content":"Digite em poucas palavras o que <b>você precisa</b>."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a85f689a-e987-4156-a863-4c29f4f234d9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0cab3d11-71e4-4643-9929-b9b5e128485f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0cab3d11-71e4-4643-9929-b9b5e128485f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f2225d5c-2138-4b41-a90f-36ecb8e31fe0","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4bb3ab6f-4e19-47ee-8d3b-d75e319b7da7","typeOfStateId":"state","$connId":"con_1793","$id":"8f28ad58-98c9-4ce7-a23e-16873ad8dcea","conditions":[{"source":"intent","comparison":"exists","values":[]}],"$invalid":false},{"stateId":"abce8f39-55f4-43ef-82d4-bac762680c9c","typeOfStateId":"state","$connId":"con_1798","$id":"0e06fb3b-eade-48a3-bc22-12bfa1dc67eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"34f87f4b-1035-4600-a810-d20cd32bc7c6","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"58711537-9207-4340-947d-bd4543be9623","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-26760267-25cb-4144-856b-7fa05784c543","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-71894f27-54ad-4a75-9b8a-48c1735e21c3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-45e076de-815e-47dc-bca7-d1478798d380","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7c6acedb-5d1d-4af7-9772-2b0d181b638a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bbaeedb9-b42a-4691-b57e-d2bd0a20bcd8","root":false,"$title":"[F.4.1.0] Outros assuntos","$position":{"top":"1496px","left":"2299px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"abce8f39-55f4-43ef-82d4-bac762680c9c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bddb7e36-ea3a-41e0-b651-4a87e43f3475","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"60d85b77-5323-47db-af11-f48983b38e74","typeOfStateId":"state","$connId":"con_1818","$id":"697ff66a-921d-4057-9955-cb7704c3f603","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e998cd63-626f-4880-b4f1-1003e8ef04f5","$typeOfContent":"","type":"TrackEvent","$title":"numeroAgencia Conta Transbordo Exibicao","$invalid":false,"settings":{"extras":{},"category":"numeroAgencia Conta Transbordo Exibicao","action":"{{numeroAgencia}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"dcea1713-fd6f-4bc1-a9ee-de2f2860d468","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" CLEAR","$invalid":false,"settings":{"variable":"state","value":"-"},"conditions":[]},{"$id":"41d09bc3-3587-449b-9987-018dbab38df5","$typeOfContent":"","type":"SetVariable","$title":"Set \"SaudacaoJaFoiFeita\" CLEAR","$invalid":false,"settings":{"variable":"SaudacaoJaFoiFeita","value":"-"},"conditions":[]},{"$id":"7b8ba98d-3e10-46aa-809f-ff908b49a3a8","$typeOfContent":"","type":"MergeContact","$title":"Limpa Broadcast","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-be6139ba-1087-4ed3-ba28-11e98a5aeaa7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-070c164c-99c9-4d5b-849d-fd074ae9c2a5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4d6eab6b-97f3-4968-91e6-121b74c8f172","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"abce8f39-55f4-43ef-82d4-bac762680c9c","root":false,"$title":"[SET] Valida Tipo Conta Transbordo","$position":{"top":"1668px","left":"2346px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9f0941c8-a1f8-4fae-b810-7887f763ce8a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8602c58f-d69f-47b9-8555-95396b3b8113","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"abce8f39-55f4-43ef-82d4-bac762680c9c","typeOfStateId":"state","$connId":"con_1833","$id":"d02692a2-fe30-4d02-baf9-08be75c73f58","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6fc7aae9-67de-4138-95c2-41197f96f166","$typeOfContent":"","type":"TrackEvent","$title":"numeroAgencia exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"numeroAgencia exibicao","action":"{{numeroAgencia}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"numeroAgencia"}]},{"$id":"5f0d0156-c08d-4a68-8083-3b1441218416","$typeOfContent":"","type":"TrackEvent","$title":"numeroAgencia dados","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"numeroAgencia dados","action":"{{numeroAgencia}} | {{contact.identity}} | {{input.content}} | {{contas}} | {{calendar.datetime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0be98602-7840-49b3-8738-9c7ea638f704","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"9f0941c8-a1f8-4fae-b810-7887f763ce8a","root":false,"$title":"[SET] Valida Destino Intencao Não Identificada","$position":{"top":"1341.33px","left":"2564.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"60d85b77-5323-47db-af11-f48983b38e74":{"$contentActions":[{"action":{"$id":"1126cd31-9afe-42b7-a180-5a4e9c3f7b9a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"46c95cef-fca8-4612-9c09-771758f5ab51","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"46c95cef-fca8-4612-9c09-771758f5ab51","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c35deaef-389b-4cea-9a6d-a74bbb3cb777","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7b8a0b66-d178-490d-a7ee-fc17fd48d000","type":"text/plain","content":"Entendi. Aguarde um momento. Em breve seu gerente irá te ajudar.","metadata":{}},"$cardContent":{"document":{"id":"7b8a0b66-d178-490d-a7ee-fc17fd48d000","type":"text/plain","content":"Entendi. Aguarde um momento. Em breve seu gerente irá te ajudar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"16afd773-3586-460c-adfc-1accc592fc6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0b54320b-c2d0-47f3-bfae-439eca8292bf","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"ece82bfc-47db-44c5-b0d1-0d7b03e0a1e0","$typeOfContent":"","type":"SetVariable","$title":"Set \"intencaoIdentificada\" CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada","value":""},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9a86ff32-3e87-4e30-888e-54bce17495a0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e888490e-b739-4c49-b4a6-2f21f2669a4f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ff9a3d7c-0dfb-433d-8319-db8eebbf02fe","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"60d85b77-5323-47db-af11-f48983b38e74","root":false,"$title":"[PF.6.0.0] Direcionar [Transbordo Gerente]","$position":{"top":"1644.57px","left":"2126.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9864ca6b-46ef-4821-8b0e-1a019ecb36a6":{"$contentActions":[{"action":{"$id":"050b7faa-c985-4824-98e4-96806e124f6b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"da5dbd85-7f97-46e7-bd06-d9f1a41721a6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"da5dbd85-7f97-46e7-bd06-d9f1a41721a6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"66b908fc-2b94-4ef0-8301-c1c737f0d89c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c4a37853-9ec3-4600-9f74-dfc40d96990b","type":"text/plain","content":"Olá, sou o <b>Assistente Digital do Safra</b> e estou aqui para <b>te ajudar com dúvidas, consultas e serviços relacionados à sua conta.</b>","metadata":{}},"$cardContent":{"document":{"id":"c4a37853-9ec3-4600-9f74-dfc40d96990b","type":"text/plain","content":"Olá, sou o <b>Assistente Digital do Safra</b> e estou aqui para <b>te ajudar com dúvidas, consultas e serviços relacionados à sua conta.</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"42b44052-01ce-44ce-9989-1e804d95e2fe","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"568fd09d-7f1d-47da-bab0-92f8c0528500","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"568fd09d-7f1d-47da-bab0-92f8c0528500","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ed2a5fb2-da6f-4961-b14d-e302fa57b991","typeOfStateId":"state","$connId":"con_1843","$id":"fe248107-bc34-4745-9ab7-0977941e034f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Câmbio\",\n\t\t\t\t\"description\": \"Compra e venda de moeda estrangeira\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Corretora\",\n\t\t\t\t\"description\": \"Invista na Corretora\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Renegociação\",\n\t\t\t\t\"description\": \"Consultas, Boletos, Renegociação, Dúvidas e atendimento\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Conta Global\",\n\t\t\t\t\"description\": \"Dúvidas e atendimento para Conta Global\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Falar com gerente\",\n\t\t\t\t\"description\": \"Fale com o seu gerente\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"6\",\n\t\t\t\t\"title\": \"Outros assuntos\",\n\t\t\t\t\"description\": \"Digite o que você precisa\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, toque no *botão abaixo* para ver os *assuntos em que posso te ajudar*. Se quiser falar sobre *outro tema*, digite em poucas palavras o que *você precisa*.` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Opções\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"d5fdad47-9c89-44bc-a585-d1c747a3216d","$typeOfContent":"","type":"ExecuteScript","$title":"recurso","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run() {\n\tvar obj = {\n\t\t\"Cambio\": \"cambioonboarding|welcome\",\n\t\t\"Corretora\": \"Corretora|welcome\",\n\t\t\"Conta Global\": \"Conta Global|welcome\",\n\t\t\"Renegociação\": \"principal|6303085c-1873-4c23-a1e3-3f2e9a4f3f3d\",\n\t\t\"Falar com gerente\": \"principal|abce8f39-55f4-43ef-82d4-bac762680c9c\",\n\t\t\"Outros assuntos\": \"principal|bbaeedb9-b42a-4691-b57e-d2bd0a20bcd8\",\n\t\t\"Abra sua conta\": \"principal|4aad23d1-c5ad-4626-bacf-3ae45e2b16d4\"\n\t}\n\treturn \"Hello BLiP\"; //Return value will be saved as \"Return value variable\" field name\n}","inputVariables":[],"outputVariable":"recurso","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d148179a-fd6a-4c41-9ace-371c35e5c648","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-16241b19-2d3a-4ceb-9b55-aef2cd85786d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-91418df6-a526-4696-ab4a-a3b55b460157","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9864ca6b-46ef-4821-8b0e-1a019ecb36a6","root":false,"$title":"[PF.3.0.0][MSG] Saudacao Menu","$position":{"top":"1185px","left":"2111px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6303085c-1873-4c23-a1e3-3f2e9a4f3f3d":{"$contentActions":[{"action":{"$id":"0d4f2189-1e3e-4e9b-9265-e08f5c1c5c79","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b874f3a6-0285-43e2-b284-1165df815e23","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b874f3a6-0285-43e2-b284-1165df815e23","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1d1e7f69-6b6c-482a-aa0a-725bd31b37be","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd773774-f366-4d77-8aeb-29af5b66f18f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0e8a1c91-61ee-4d97-97c5-b3ca0f95cf7a","$typeOfContent":"","type":"TrackEvent","$title":"Saudacao piloto exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"Saudacao piloto exibicao","action":"Exibicao"},"conditions":[]},{"$id":"f5eb6212-4b3d-474c-a7c7-49a309746988","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"texto do corpo do conteúdo interativo\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"texto do botão de ação\",\n        \"url\": \"https://x.blip.ai/\"\n      }\n    }\n  }\n}\n\nfunction run() {\n  try {\n    dynamicContent.interactive.body.text = `Temos um número dedicado para falar sobre Renegociação.\nToque no botão abaixo que te levo pra lá.`\n    dynamicContent.interactive.action.parameters.display_text = `Ir para Renegociação`\n    dynamicContent.interactive.action.parameters.url = `https://bit.ly/4ddUdjD`\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eddeb205-5810-40e9-9d0d-69b714415542","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-48b38748-60b5-4bad-ac8f-cff675050b0a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5e8ad5f7-2dcc-45d5-86e1-d6da6ea0ecbb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bcfe2768-e532-4b23-86f8-962b376ad5d1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6303085c-1873-4c23-a1e3-3f2e9a4f3f3d","root":false,"$title":"[PF.4.0.0][MSG] Renegociação Informativo","$position":{"top":"988.714px","left":"2576.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3fc6973e-153b-4ac6-90a8-6b4b8dc24381":{"$contentActions":[{"action":{"$id":"e1dda375-8c1b-4d43-b6b7-22ca11c593c8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"851db781-bc7b-464b-b961-ef2d173a65a0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"851db781-bc7b-464b-b961-ef2d173a65a0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4443e715-d7d1-477a-a0a0-3ae72b4e2ad9","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e0c37c1f-cc8a-4b84-84de-9c811320d2bb","type":"text/plain","content":"Vamos tentar novamente? \nÉ só escolher uma das opções.","metadata":{}},"$cardContent":{"document":{"id":"e0c37c1f-cc8a-4b84-84de-9c811320d2bb","type":"text/plain","content":"Vamos tentar novamente? \nÉ só escolher uma das opções."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"46aff93d-7cea-4f4f-9688-d3c8806421fe","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eddeb205-5810-40e9-9d0d-69b714415542","typeOfStateId":"state","$connId":"con_1853","$id":"1ec119d9-108f-4864-b30e-a87fd4f39344","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"214821d8-7652-4241-9aed-41f5fb5062b7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-838f399c-ebbe-4dc0-b44f-33628d65c877","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b16896d7-082b-4c05-853a-e5ffc488a306","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3fc6973e-153b-4ac6-90a8-6b4b8dc24381","root":false,"$title":"[PF.2.1.0] Botão Inesperado","$position":{"top":"1838px","left":"2347px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"99fb026e-686f-4573-9041-e767a11421ee":{"$contentActions":[{"action":{"$id":"8098c6ce-620d-4020-be22-f91d33316f29","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a62e13d6-8e92-4620-b3de-d3755f49d3a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a62e13d6-8e92-4620-b3de-d3755f49d3a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"01601683-efde-42d3-9d8b-26568609da21","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6aa19268-766e-4665-838f-596d2a0db08d","type":"text/plain","content":"Ótimo. Se precisar de ajuda com outro assunto, é só me chamar. Até logo.","metadata":{}},"$cardContent":{"document":{"id":"6aa19268-766e-4665-838f-596d2a0db08d","type":"text/plain","content":"Ótimo. Se precisar de ajuda com outro assunto, é só me chamar. Até logo."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bf76bdb9-be08-44f5-8e79-de180d1341ec","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"2bc67be1-5673-4c25-b38a-ec8f9b8d6934","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"7122844f-7f20-4edd-b19a-26988d0575dd","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} exibicao","$invalid":false,"settings":{"extras":{"Identity":"{{contact.identity}}","Doc":"{{contact.extras.cpf}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"b8f5ff12-0718-43cf-abe6-31012c89e199","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" CLEAR","$invalid":false,"settings":{"variable":"state","value":"-"},"conditions":[]},{"$id":"067a1e42-2b95-435e-b744-f8dd2e3fca8a","$typeOfContent":"","type":"SetVariable","$title":"Set \"intencaoIdentificada\" CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada","value":""},"conditions":[]},{"$id":"539afc1c-1518-4585-8de4-7f6f37271f7d","$typeOfContent":"","type":"SetVariable","$title":"Set \"SaudacaoJaFoiFeita\" CLEAR","$invalid":false,"settings":{"variable":"SaudacaoJaFoiFeita","value":"-"},"conditions":[]},{"$id":"b59d0d3d-0cb9-4962-869b-7636c661a9ad","$typeOfContent":"","type":"SetVariable","$title":"CLEAR \"errorCounter\"","$invalid":false,"settings":{"variable":"errorCounter"},"conditions":[]},{"$id":"eed6434a-0fab-4d0f-8e02-9db4d307946e","$typeOfContent":"","type":"SetVariable","$title":"CLEAR \"exceptionType\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]},{"$id":"c434f51c-0795-4322-b61a-2d20690b9567","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionTypeMedia CLEAR","$invalid":false,"settings":{"variable":"exceptionTypeMedia"},"conditions":[]},{"$id":"d620df1e-c146-4ca1-98c6-e8f5777d9ed1","$typeOfContent":"","type":"SetVariable","$title":"Set \"contas\" CLEAR","$invalid":false,"settings":{"variable":"contas","value":"false"},"conditions":[]},{"$id":"1d865328-ef3a-406e-9584-0949cd7e45ae","$typeOfContent":"","type":"SetVariable","$title":"Set \"qtdcontas\" CLEAR","$invalid":false,"settings":{"variable":"qtdcontas"},"conditions":[]},{"$id":"08d07b91-0e9b-429c-b481-7a864a978446","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Consegui te ajudar com o que precisava?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12e41690-0673-4b1d-86f7-041ad4fbb352","$typeOfContent":"","type":"SetVariable","$title":"Set redirectMessage CLEAR","$invalid":false,"settings":{"variable":"redirectMessage"},"conditions":[]},{"$id":"f624af92-ea8e-4518-a0f5-90afd6ec7490","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"cbf3d14f-b272-4a51-8fb6-cfc623ebaf33","$typeOfContent":"","type":"MergeContact","$title":"Limpa Broadcast","$invalid":false,"settings":{"extras":{"broadcastOrigem":"-"}},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-828f985d-b484-414b-80f8-412a5aa4aa41","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-93a51df5-6ff1-4aad-86e5-bb7bf07fb742","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-58710722-d414-417c-801d-552c8aaea538","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-43accc47-79cf-416d-aad6-1ee996191c7a","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-7819f111-b2b0-4de4-92ca-b18a90a96b5b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"99fb026e-686f-4573-9041-e767a11421ee","root":false,"$title":"[PF.2.2.0]Agradece Finaliza","$position":{"top":"1892px","left":"2588px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.7","builder:stateTrack":"false","builder:useTunnelOwnerContext":"true","startDate":"09:00","endDate":"22:00","workDays":"1,2,3,4,5","token":"Key c2FmcmFwcm9kZ2VyZGlncGY6cDBJVGdoZklOYmRndEUyc1RCZTQ=","apiKey":"c2FmcmFwcm9kZ2VyZGlncGY6cDBJVGdoZklOYmRndEUyc1RCZTQ=","isHoliday":"false","builder:stateExpiration":"1.00:00:00","deskHours":"08:00|20:00|1,2,3,4,5|MICGARC;08:00|19:00|1,2,3,4,5|GABRCOS;08:00|22:00|1,2,3,4,5|CARLHUR;08:00|22:00|1,2,3,4,5|ANANJOS;12:00|17:00|1,2,3,4,5|ROBS;08:00|20:15|1,2,3,4,5|marchib","botIdentity":"safraprodgerdigpf","commands":"https://safra.http.msging.net/commands","blip":"blip.ai","builder:#localTimeZone":"E. South America Standard Time","urlSafra":"https://api.safra.com.br","urlCHT":"https://api.safra.com.br/chat-assistente","clientSecret":"5312b6d5-acb8-4165-9458-ef445876473e","clientId":"BLIP","grantType":"client_credentials","codigoSegmento":"0021","codigoSegmentoOne":"0023","segmentoAG2":"0007","gateway":"https://sts-api.safra.com.br/api","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/safrabetagerdigpfag11","safraOneToken":"Key c2FmcmFhdGVuZGltZW50b3NhZnJhb25lcHJvZDpuSE5XM1RuMWFaRlRsbTBVbmNxVQ==","digitalToken":"Key c2FmcmFhdGVuZGltZW50b2RpZ2l0YWxwcm9kOjJpcTU3Y1oyTjBJN25zM1I5dXp4","ag2Token":"Key c2FmcmFhdGVuZGltZW50b2FnMnByb2Q6N0Zjc2VWRVhxMmJxRkltTlhaUUU=","clientSecretHml":"ee1f5004-2400-4ab1-9af7-d9168d517204","contentTypeUrlencoded":"application/x-www-form-urlencoded","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}