{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"df28333f-d509-4c3f-acd7-6d4801130bae","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8c695219-8026-443c-a4f1-68132d1b4803","typeOfStateId":"state","$connId":"con_3","$id":"253b6bdd-9c0e-40e8-adf1-0da8e620ce31","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7a7ce5da-c71c-4acf-9020-0bd226587789","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intentBody\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tconst userInput = JSON.parse(inputContent).input.content\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": userInput\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": inputContent\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["input.content"],"outputVariable":"intentBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f4300622-8f73-4228-b1f9-694f43f37678","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"intentResponse\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.commandsKey}}","Content-Type":"application/json"},"method":"POST","body":"{{intentBody}}","uri":"{{config.commandsUrl}}","responseStatusVariable":"IntentStatus","responseBodyVariable":"IntentResponse"},"conditions":[]},{"$id":"7e5a543b-577f-4b62-b9c4-c286f47c13cb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(intent, accuracy) {\n\ttry {\n\t\tinput = JSON.parse(intent).resource.text;\n\t\treturn {\n\t\t\tinput: input,\n\t\t\tintent: findIntention(intent, accuracy)\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction findIntention(intent, accuracy) {\n\ttry {\n\t\tintent = JSON.parse(intent).resource.intentions\n\t\tindentifiedIntent = intent.filter(({ score }) => score > Number(accuracy))\n\t\tif (indentifiedIntent.length > 0) {\n\t\t\treturn indentifiedIntent[0].name;\n\t\t}\n\t\treturn null\n\t} catch (err) {\n\t\treturn null\n\t}\n}","inputVariables":["intentResponse","config.accuracy"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e2d62597-ab55-4f55-8fc5-c1a5671d0bd8","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CANAL WA","$invalid":false,"settings":{"extras":{"Canal":"WhatsApp"}},"conditions":[{"values":["@wa"],"source":"context","comparison":"contains","variable":"contact.identity"}]},{"$id":"f982c13c-c774-46ec-9305-81eccfe1b930","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"ac453170-b6fc-4785-9cda-5224fd07805f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f804a3b-8957-4712-b319-7b8e89ecf05e","$typeOfContent":"","type":"SetVariable","$title":"intencao","$invalid":false,"settings":{"variable":"intencao","value":"{{input.intent.name}}"},"conditions":[]},{"$id":"72d069df-c08d-4258-8ca7-27b9a3c44d86","$typeOfContent":"","type":"ExecuteScript","$title":"tracking intencao","$invalid":false,"settings":{"function":"run","source":"const run = (contact, intent) => {\n\ttry {\n\t\tconst intencao = JSON.parse(intent)\n\t\tconst dataRaw = new Date()\n\t\tdataRaw.setHours(new Date().getHours() - 3)\n\t\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\t\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\t\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\n\t\tconst telefone = contact.split(\"@\")[0]\n\t\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27a3e501-d334-4e7a-977c-446c3b8626c8","$typeOfContent":"","type":"TrackEvent","$title":"intencao inicio","$invalid":false,"settings":{"extras":{},"category":"intencao inicio","action":"{{tracking}}"},"conditions":[]},{"$id":"75134677-7fb0-4843-ace1-d95386034256","$typeOfContent":"","type":"TrackEvent","$title":"intencao api result","$invalid":false,"settings":{"extras":{},"action":"{{intentBody}} | {{IntentStatus}} | {{intentResponse}}","category":"intencao api result"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e86071e6-1bd3-40a3-a6a3-9da20147ee51","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-bee2c56c-3a2f-49fa-aa1f-918bdbf74bc5","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-70f53398-e08a-41bf-9162-e05d5a0f45c2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f6888d94-3402-4309-88fa-7540bddecb69","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-1e6fe3a4-16ab-4849-88bf-7e082ef3cab6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-459406b3-e744-4284-b9d6-bc3dfbcd9499","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7ae6e0a5-4b36-4d32-8445-088d08f16f77","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"0px","left":"645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsComments":{"6d0f89c4-1a0f-40dc-ad21-629081da0e65":{"id":"6d0f89c4-1a0f-40dc-ad21-629081da0e65","text":"Teste","blocksIdList":["0abed19b-40e3-454c-bed3-c97f190fd32a"]}}},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72829bcb-49a0-4a88-b0e3-898db393e89b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"16b6d1b6-a332-48b5-8e88-ded1c07dd2ac","typeOfStateId":"state","$connId":"con_8","$id":"48a208af-981b-43f9-ba5b-8fc364063d16","conditions":[{"source":"context","comparison":"equals","values":["alterar conta","senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos","status de entrega"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","typeOfStateId":"state","$connId":"con_13","$id":"8ba9e0cf-d9d6-4089-bcee-0d58113b5ab4","conditions":[{"source":"intent","comparison":"equals","values":["sair"]}],"$invalid":false},{"stateId":"0fb18c4b-3d1a-4905-b922-197db4f5d1c8","typeOfStateId":"state","$connId":"con_18","$id":"084cd0d7-a8c3-492a-8711-a167b4d4299b","conditions":[{"source":"context","comparison":"equals","values":["a35fa267-f2b7-4298-83d9-b0924114e971"],"variable":"state.previous.id"},{"values":["extratoMaisAntigoQueDoisAnos"],"source":"context","variable":"exceptionType","comparison":"equals"}],"$invalid":false},{"stateId":"c6b1d835-f571-4c7a-975d-6e088158bc68","typeOfStateId":"state","$connId":"con_23","$id":"f1bf2dfa-0521-47c4-895c-a65177602f3f","conditions":[{"source":"context","comparison":"equals","values":["a5803973-dd8d-471a-bab6-a57c7add1a09","d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00"],"variable":"state.previous.id"},{"values":["erroApi"],"source":"context","comparison":"equals","variable":"exceptionType"}],"$invalid":false},{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","typeOfStateId":"state","$connId":"con_28","$id":"2f26d807-7949-4db0-a32a-042e9b3d231c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"5e0a82b2-14ed-445a-8f22-c5a4775ba950","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intentBody\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tconst userInput = JSON.parse(inputContent).input.content\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": userInput\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": inputContent\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["input.content"],"outputVariable":"intentBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"58b237c9-39cc-481f-83bb-05c924f8f352","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"intentResponse\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.commandsKey}}","Content-Type":"application/json"},"method":"POST","body":"{{intentBody}}","uri":"{{config.commandsUrl}}","responseStatusVariable":"intentStatus","responseBodyVariable":"IntentResponse"},"conditions":[]},{"$id":"189201a9-f4a0-4d72-a55d-5fb3018cc024","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(intent, accuracy) {\n\ttry {\n\t\tinput = JSON.parse(intent).resource.text;\n\t\treturn {\n\t\t\tinput: input,\n\t\t\tintent: findIntention(intent, accuracy)\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction findIntention(intent, accuracy) {\n\ttry {\n\t\tintent = JSON.parse(intent).resource.intentions\n\t\tindentifiedIntent = intent.filter(({ score }) => score > Number(accuracy))\n\t\tif (indentifiedIntent.length > 0) {\n\t\t\treturn indentifiedIntent[0].name;\n\t\t}\n\t\treturn null\n\t} catch (err) {\n\t\treturn null\n\t}\n}","inputVariables":["intentResponse","config.accuracy"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2598689f-011e-4846-8841-e65691f3b175","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (intent) => {\n\ttry {\n\t\tintent = JSON.parse(intent);\n\t\tif (intent === 'alterar conta') return false\n\t\treturn true\n\t}\n\tcatch(e){\n\t\treturn false;\n\t}\n}","inputVariables":["intencaoIdentificada"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b749e6f-4d9f-4fec-a545-61c985b00566","$typeOfContent":"","type":"ExecuteScript","$title":"tracking intencao","$invalid":false,"settings":{"function":"run","source":"const run = (contact, intent) => {\n\ttry {\n\t\tconst intencao = JSON.parse(intent)\n\t\tconst dataRaw = new Date()\n\t\tdataRaw.setHours(new Date().getHours() - 3)\n\t\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\t\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\t\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\n\t\tconst telefone = contact.split(\"@\")[0]\n\t\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"62917b79-3344-4a48-9415-d9a297fd9f71","$typeOfContent":"","type":"TrackEvent","$title":"intencao excecao","$invalid":false,"settings":{"extras":{},"category":"intencao excecao","action":"{{tracking}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"tracking"}]},{"$id":"214041e2-8352-4b79-b12f-6d3e3c9dd578","$typeOfContent":"","type":"TrackEvent","$title":"intencao api result","$invalid":false,"settings":{"extras":{},"action":"{{intentBody}} | {{IntentStatus}} | {{intentResponse}}","category":"intencao api result"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-52000cd5-f837-4195-bd55-b3d0e933ee4f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"background":"#7762E3","label":"ProcessHttp","id":"blip-tag-f6888d94-3402-4309-88fa-7540bddecb69","canChangeBackground":false},{"background":"#61D36F","label":"TrackEvent","id":"blip-tag-459406b3-e744-4284-b9d6-bc3dfbcd9499","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"176px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3add2fc9-71b1-4b63-a43e-a45f30df11ec":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4b190c25-7a56-4038-8e46-917c4a2ff876","typeOfStateId":"state","$connId":"con_33","$id":"de2cb42b-eca9-484f-9ea3-9d888467274c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4dfd3130-e5d2-4b15-af26-d9ea6066f2bb","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["config.clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{url}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"8ad0157c-c65a-4fc6-be53-c06ea4a46b06","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4b190c25-7a56-4038-8e46-917c4a2ff876","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d484dedf-95d6-41c0-ae64-5a2c314a288f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-77cf7219-97a9-40e2-a05e-a40934c9ba3e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cf3a0fec-2e9c-4c84-a6aa-d2c97d4fff27","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-64ddac0b-0ca0-48e0-9466-e36517b06894","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","root":false,"$title":"[API] TOKEN","$position":{"top":"569px","left":"645.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"4b190c25-7a56-4038-8e46-917c4a2ff876":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1a0c612-23cf-4cdd-90d0-488577ad654c","typeOfStateId":"state","$connId":"con_38","$id":"01d64960-24a8-4e44-af78-9b2092666742","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d18a9411-9fbd-4bac-b998-6790ee64a610","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@phoneIndentificationURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(phoneNumber) {\n  phoneNumber = JSON.parse(phoneNumber);\n\n  return JSON.stringify({\n    tipoPessoa: \"F\",\n    ddd: phoneNumber.DDD,\n    numeroCelular: phoneNumber.phone\n  //  ddd: '{{config.ddd}}',\n  //  numeroCelular: '{{config.telefone}}'\n  });\n}\n","inputVariables":["phoneNumber"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"IDENTIFICAÇÃO DE TELEFONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Safra-Bot-ID":"{{safraBotId}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusTelIdent","responseBodyVariable":"responseTelIdent"},"conditions":[]},{"$id":"6e9d8fa1-60c4-4275-9122-eeaf2fb1108c","$typeOfContent":"","type":"ExecuteScript","$title":"customerName","$invalid":false,"settings":{"function":"run","source":"function run(responseTelIdent) {\n  responseTelIdent = JSON.parse(responseTelIdent);\n  return capitalizeText(responseTelIdent.data.nome);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["responseTelIdent"],"outputVariable":"customerName","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"ae5ef5a3-53ae-4765-96c9-c53295c7daac","$typeOfContent":"","type":"ExecuteScript","$title":"documentBase","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n  response = JSON.parse(response);\n  return response.data.baseDocumento;\n}\n","inputVariables":["responseTelIdent"],"outputVariable":"documentBase","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"ef942c4a-646b-4e75-8652-9c06e141d730","$typeOfContent":"","type":"ExecuteScript","$title":"document","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n  response = JSON.parse(response);\n  const data = response.data;\n  return `${data.baseDocumento}${data.digitosVerificadoresDocumento}`;\n}","inputVariables":["responseTelIdent"],"outputVariable":"document","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"07da6220-267f-43b4-b2e2-063b38e58769","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusTelIdent}} | {{responseTelIdent}} | {{contact.identity}}"},"conditions":[]},{"$id":"d0e53900-81ca-4508-a50c-112b1cf39555","$typeOfContent":"","type":"ExecuteScript","$title":"nome","$invalid":false,"settings":{"function":"run","source":"const run = (response) => {\n\tconst nome = JSON.parse(response).data.nome.split(' ')[0]\n\treturn nome\n}","inputVariables":["responseTelIdent"],"outputVariable":"nome","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"ccf4e020-233d-46b6-ab04-f0093c3dd858","$typeOfContent":"","type":"ExecuteScript","$title":"email","$invalid":false,"settings":{"function":"run","source":"const run = (response) => {\n\ttry {\n\t\tconst email = JSON.parse(response).data.email;\n\t\treturn email;\n\t}\n\tcatch (e) {\n\t\treturn \"-\"\n\t}\n}","inputVariables":["responseTelIdent"],"outputVariable":"email","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true}],"$leavingCustomActions":[{"$id":"7b0fd582-5841-4cab-b0bb-5edcc8a65b4c","$typeOfContent":"","type":"MergeContact","$title":"Set customerName and Mail","$invalid":false,"settings":{"extras":{},"name":"{{customerName}}","email":"{{email}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a1a0c612-23cf-4cdd-90d0-488577ad654c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-14544d82-f74c-4998-aac2-2658e3f0932a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4bb13d36-8735-4099-a5f0-61381dac3ec2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b38b379f-1419-44cc-af7e-eec4768ff0e2","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-2d8a734d-5801-4037-8e44-2b4e5b56f2ca","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-95a5ff73-4728-4916-8c08-a6fb886f5407","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"4b190c25-7a56-4038-8e46-917c4a2ff876","root":false,"$title":"[API] IDENTIFICAÇÃO DE TELEFONE","$position":{"top":"701px","left":"647px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"d9359361-57c8-4d39-a392-69b769f419d6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","typeOfStateId":"state","$connId":"con_43","$id":"a22b28c5-ac7a-4378-833e-b17c7d46a61a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"19a2c97f-ea54-419f-996b-e0bf649b7fc4","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@customerDataIndentificationURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(agency, account) {\n\treturn JSON.stringify({\n    agencia: agency,\n    conta: account\n  })\n}","inputVariables":["agency","account"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"IDENTIFICACAO DADOS CLIENTE","$invalid":false,"settings":{"headers":{"Safra-Bot-ID":"{{safraBotId}}","User-Agent":"Fiddler","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusClientData","responseBodyVariable":"responseClientData"},"conditions":[]},{"$id":"0721a989-53d8-4191-94ef-840d2aa17dc8","$typeOfContent":"","type":"ExecuteScript","$title":"segmentCode","$invalid":false,"settings":{"function":"run","source":"function run(responseClientData) {\n  responseClientData = JSON.parse(responseClientData);\n  const segmentCode = responseClientData.data.codigoSegmento;\n  return String(segmentCode).padStart(4, \"0\");\n}","inputVariables":["responseClientData"],"outputVariable":"segmentCode","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusClientData"}]},{"$id":"ca373739-5116-4242-a632-095e4a7b91b0","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusClientData}} | {{responseClientData}} | {{contact.identity}}"},"conditions":[]},{"$id":"127be61e-bc3e-4aed-8df4-94aa32267b88","$typeOfContent":"","type":"ExecuteScript","$title":"dados cliente","$invalid":false,"settings":{"function":"run","source":"const run = (response, listaContas) => {\n\tconst {agencia, conta, documento} = JSON.parse(response).data\n\tconst {codigoCliente} = JSON.parse(listaContas).data[0]\n\treturn {\n\t\tagencia: String(agencia),\n\t\tconta: String(conta),\n\t\tdocumento,\n\t\tcodCliente: codigoCliente\n\t}\n}","inputVariables":["responseClientData","responseAccountLists"],"outputVariable":"dadosCliente","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusClientData"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-df688618-6aca-47ae-ae86-381c7443eee4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-cdcb442c-feb8-4fdd-9bc2-2881d6fa8f33","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b44ad80a-a2cf-428d-8abb-38cab9052ed8","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a499a094-a461-48a2-9cf0-3511ae243639","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"d9359361-57c8-4d39-a392-69b769f419d6","root":false,"$title":"[API] IDENTIFICACAO DADOS CLIENTE","$position":{"top":"2695.43px","left":"676.429px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","textColor":"#ffffff"}},"b34040c5-af17-45f9-b86b-80c66c404a50":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d9d0be3e-336c-4ce7-a1a5-ebaa2a5d4a73","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","typeOfStateId":"state","$connId":"con_48","$id":"50bab68f-c748-4c64-a027-abe878317bfa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a97ceb66-d503-4a4d-ac59-797dab99f865","$typeOfContent":"","type":"SetVariable","$title":"env","$invalid":false,"settings":{"variable":"env","value":"{{config.env}}"},"conditions":[]},{"$id":"f6129fee-2112-4b3b-b3a1-cc903713a865","$typeOfContent":"","type":"ExecuteScript","$title":"envSettings","$invalid":false,"settings":{"function":"run","source":"function run(env) {\n  const envSettings = {\n    \"PRD\": {\n      tokenURL: \"https://sts-api.safra.com.br/api/oauth/token\",\n      phoneIndentificationURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais\",\n      accountListsURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas\",\n      customerDataIndentificationURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/dados-cadastrais\",\n      managerCharterizationURL:\n        \"https://api.safra.com.br/chat-assistente/contas-pessoa-fisica/v1/gerentes\",\n    },\n    \"HML\": {\n      tokenURL: \"https://sts-api-hml.safra.com.br/api/oauth/token\",\n      phoneIndentificationURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais\",\n      accountListsURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas\",\n      customerDataIndentificationURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/dados-cadastrais\",\n      managerCharterizationURL:\n        \"https://api-hml.safra.com.br/chat-assistente/contas-pessoa-fisica/v1/gerentes\",\n    },\n  };\n\n  return envSettings[env];\n}","inputVariables":["env"],"outputVariable":"envSettings","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c43b25be-a10a-4b17-8108-7f9a284fdcfe","$typeOfContent":"","type":"SetVariable","$title":"safraBotId","$invalid":false,"settings":{"variable":"safraBotId","value":"safraprodgerdigpf"},"conditions":[]},{"$id":"6967121f-40d4-44de-bc64-f7f22fb7f800","$typeOfContent":"","type":"SetVariable","$title":"clientSecret","$invalid":false,"settings":{"variable":"clientSecret","value":"{{config.clientSecret}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8ca06bd6-eb34-4c71-967a-487db3b21b5c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d2683173-62a2-4c3c-8a4c-08937fbbb2a2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"b34040c5-af17-45f9-b86b-80c66c404a50","root":false,"$title":"[ENVIRONMENT SETTINGS]","$position":{"top":"416px","left":"645.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1a0c612-23cf-4cdd-90d0-488577ad654c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b394ca77-7b57-463c-8c25-e9bb2a03ef24","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"738f3f08-3ecb-42a6-9e34-b0c98d43a841","typeOfStateId":"state","$connId":"con_53","$id":"b4b10ac1-b973-423d-b3a6-b77039c0cfe2","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"customerFound"}],"$invalid":false},{"stateId":"facfc3e9-b838-42a8-b4f6-db9d1c11556b","typeOfStateId":"state","$connId":"con_58","$id":"4968e28b-4e1e-45ca-b965-a921eaa2089c","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"customerFound"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3e4944cf-9e69-4408-ab72-0f2d583e4126","$typeOfContent":"","type":"ExecuteScript","$title":"customerFound","$invalid":false,"settings":{"function":"run","source":"function run(statusTelIdent) {\n  const apiStatusRegExp = new RegExp(\"^2[0-9]{2}$\");\n  return apiStatusRegExp.test(statusTelIdent);\n}","inputVariables":["statusTelIdent"],"outputVariable":"customerFound","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusTelIdent"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5582d71a-1f55-4742-a5eb-d1a48ff26e14","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"a1a0c612-23cf-4cdd-90d0-488577ad654c","root":false,"$title":"[LO] Cliente encontrado?","$position":{"top":"882px","left":"646.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"738f3f08-3ecb-42a6-9e34-b0c98d43a841":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8317d8de-fce1-491c-b3c1-1f760e630ce1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8325d14c-c78f-4a7a-9c20-9ac10444761d","typeOfStateId":"state","$connId":"con_63","$id":"234f497e-b747-48ee-af7d-4431f62ef022","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"738f3f08-3ecb-42a6-9e34-b0c98d43a841","root":false,"$title":"[LO] Cliente Identificado (Sim)","$position":{"top":"997px","left":"428.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"facfc3e9-b838-42a8-b4f6-db9d1c11556b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9a4806c2-7579-4fa3-b2af-d0a768164525","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"872e291f-f7e3-47e4-bf53-a2fdc8d416b2","typeOfStateId":"state","$connId":"con_68","$id":"b4a56403-94c9-4136-a471-2ee30354da6a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"facfc3e9-b838-42a8-b4f6-db9d1c11556b","root":false,"$title":"[LO] Cliente Identificado (Não)","$position":{"top":"1016px","left":"848.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c695219-8026-443c-a4f1-68132d1b4803":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c6611948-44ea-4e09-ab41-06901d7eeceb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b86a601-9a6a-4460-9dee-a4fbe9026a3f","typeOfStateId":"state","$connId":"con_73","$id":"b3ad993d-6609-48be-8f5a-ab161f1dd560","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0f13b448-9c11-4d2b-b070-13a7d1bfb2d5","$typeOfContent":"","type":"ExecuteScript","$title":"userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  const DEFAULT_CHANNEL = \"other\";\n  const GOOGLE_CHANNEL = \"gbm\";\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n\n  const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n  const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n  const GOOGLE_IDENTIFIER = \"businessmessages.gw.msging.net\";\n  const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n  const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n\n  const CHANNEL_INDEX = 1;\n  const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL_INDEX];\n\n  switch (contactChannelIdentifier) {\n    case WHATSAPP_IDENTIFIER:\n      return WHATSAPP_CHANNEL;\n\n    case BLIPCHAT_IDENTIFIER:\n      return BLIPCHAT_CHANNEL;\n\n    case FACEBOOK_IDENTIFIER:\n      return FACEBOOK_CHANNEL;\n\n    case INSTAGRAM_IDENTIFIER:\n      return INSTAGRAM_CHANNEL;\n\n    case GOOGLE_IDENTIFIER:\n      return GOOGLE_CHANNEL;\n\n    default:\n      return DEFAULT_CHANNEL;\n  }\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0b3d078-ffcd-47ab-90bd-1e3be8a69ddb","$typeOfContent":"","type":"ExecuteScript","$title":"bold","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const GOOGLE_CHANNEL = \"gbm\";\n\n  switch (userChannel) {\n    case WHATSAPP_CHANNEL:\n      return {\n        open: \"*\",\n        close: \"*\",\n      };\n    case BLIPCHAT_CHANNEL:\n    case GOOGLE_CHANNEL:\n      return {\n        open: \"<b>\",\n        close: \"</b>\",\n      };\n    case FACEBOOK_CHANNEL:\n    case INSTAGRAM_CHANNEL:\n      return {\n        open: \"\",\n        close: \"\",\n      };\n  }\n\n  return {\n    open: \"<b>\",\n    close: \"</b>\",\n  };\n}","inputVariables":["userChannel"],"outputVariable":"bold","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"01def259-21f1-4de1-861e-0ef38b05e835","$typeOfContent":"","type":"ExecuteScript","$title":"italic","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const GOOGLE_CHANNEL = \"gbm\";\n\n  switch (userChannel) {\n    case WHATSAPP_CHANNEL:\n      return {\n        open: \"_\",\n        close: \"_\",\n      };\n    case BLIPCHAT_CHANNEL:\n    case GOOGLE_CHANNEL:\n      return {\n        open: \"<i>\",\n        close: \"</i>\",\n      };\n    case FACEBOOK_CHANNEL:\n    case INSTAGRAM_CHANNEL:\n      return {\n        open: \"\",\n        close: \"\",\n      };\n  }\n\n  return {\n    open: \"\",\n    close: \"\",\n  };\n}","inputVariables":["userChannel"],"outputVariable":"italic","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b5a3b0c-9a60-4e21-acb4-c9e3162cffbe","$typeOfContent":"","type":"ExecuteScript","$title":"platform","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  // const contactDomain = contactIdentity.split(\"@\")[1];\n\n  // switch (contactDomain) {\n  //   case \"wa.gw.msging.net\":\n  //   case \"tunnel.msging.net\":\n  //     return \"Whatsapp\";\n  //   case \"telegram.gw.msging.net\":\n  //     return \"Telegram\";\n  //   case \"messenger.gw.msging.net\":\n  //     return \"Messenger\";\n  //   case \"instagram.gw.msging.net\":\n  //     return \"Instagram\";\n  //   case \"0mn.io\":\n  //     return \"Blipchat\";\n  //   case \"mailgun.gw.msging.net\":\n  //     return \"email\";\n  //   case \"businessmessages.gw.msging.net\":\n  //     return \"gbm\";\n  // }\n\n  return \"Whatsapp\";\n}","inputVariables":["contact.identity"],"outputVariable":"platform","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3de4c1e-9544-4918-a0fe-97688e173d7c","$typeOfContent":"","type":"ExecuteScript","$title":"phoneNumber","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  const phoneNumber = contactIdentity.split(\"@\")[0];\n  const onlyNumbers = phoneNumber.replace(/\\D/g, \"\");\n  if (onlyNumbers.length < 12) return \"cannot get\";\n\n  const DDI = onlyNumbers.substring(0, 2);\n  const DDD = onlyNumbers.substring(2, 4);\n  const phone = onlyNumbers.substring(4);\n\n  return JSON.stringify({\n    DDI,\n    DDD,\n    phone,\n  });\n}","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e20a44e4-8639-4bb9-9ecd-cb49ddef1150","$typeOfContent":"","type":"MergeContact","$title":"Set PhoneNumber","$invalid":false,"settings":{"extras":{},"phoneNumber":"{{phoneNumber@DDI}}{{phoneNumber@DDD}}{{phoneNumber@phone}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"phoneNumber"}]},{"$id":"9335d785-07f6-44aa-8ff6-9a66f014e9cd","$typeOfContent":"","type":"ExecuteScript","$title":"Metadata","$invalid":false,"settings":{"function":"run","source":"function run(inputMessage) {\n  const inputMessageFormatted = JSON.parse(inputMessage);\n  const metadata = inputMessageFormatted.metadata;\n\n  if (metadata && metadata[\"#wa.referral.headline\"]) {\n    return JSON.stringify({\n      headline: metadata[\"#wa.referral.headline\"],\n      body: metadata[\"#wa.referral.body\"],\n      source_type: metadata[\"#wa.referral.source_type\"],\n      source_id: metadata[\"#wa.referral.source_id\"],\n      source_url: metadata[\"#wa.referral.source_url\"],\n      media_id: metadata[\"#wa.referral.image.id\"],\n    });\n  }\n\n  return JSON.stringify(inputMessageFormatted);\n}","inputVariables":["input.message"],"outputVariable":"metadata","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"input.message"}]},{"$id":"f11014e4-8f03-4991-90b2-e339ff1aa09d","$typeOfContent":"","type":"SetVariable","$title":"empty userInput","$invalid":false,"settings":{"variable":"userInput"},"conditions":[]},{"$id":"d1a0a4f6-d0b7-4b5d-b7a4-7df60fe147af","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"3df757f2-32c4-4c3c-a370-2bfb60b1a241","$typeOfContent":"","type":"ExecuteScript","$title":"MOCK phoneNumber FOR DEVELOPERS NUMBERS","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  return JSON.stringify({\n    \"DDI\": \"55\",\n    \"DDD\": \"11\",\n    \"phone\": \"973806326\"\n  });\n}\n //SCRIPT SÓ RODA QUANDO O CONTACT.IDENTITY CONTEM O NUMERO DE UM DOS DESENVOLVEDORES","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[{"values":["5531975705747","5511971704940"],"source":"context","comparison":"contains","variable":"contact.identity"}]}],"$leavingCustomActions":[{"$id":"ac978481-72d5-44b6-acc5-5fb9ef9e488d","$typeOfContent":"","type":"SetVariable","$title":"bo","$invalid":false,"settings":{"variable":"bo","value":"{{bold@open}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bold"}]},{"$id":"89b05175-e6cd-43b6-8c13-6c8d3d309e4b","$typeOfContent":"","type":"SetVariable","$title":"bc","$invalid":false,"settings":{"variable":"bc","value":"{{bold@close}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bold"}]},{"$id":"1d40e2b8-77e6-4880-91d0-93ca640f84cd","$typeOfContent":"","type":"SetVariable","$title":"io","$invalid":false,"settings":{"variable":"io","value":"{{italic@open}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"italic"}]},{"$id":"1efde720-8139-463f-9a67-a7feb93860aa","$typeOfContent":"","type":"SetVariable","$title":"ic","$invalid":false,"settings":{"variable":"ic","value":"{{italic@close}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"italic"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2818c585-ef68-4cc8-8719-b467e1fc8e40","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-be7c9b57-6995-43ab-856c-420fa8ecc2b9","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-05fb2123-e8b4-42dc-b5c7-731c8250e8e5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"8c695219-8026-443c-a4f1-68132d1b4803","root":false,"$title":"[REQUIREMENTS]","$position":{"top":"129px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0cf9f29a-0472-46df-ae36-20e3f79508e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"10c26107-6c39-44b5-a9b5-af21214d8d4d","typeOfStateId":"state","$connId":"con_78","$id":"087a9992-01a5-4a3f-92f3-f1579763dfcd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"815bfea0-f1dd-46f3-b45b-a731de22dde7","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@accountListsURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(documentBase, cpf) {\n  let base = documentBase;\n  if (!documentBase) base = cpf.slice(0, -2);\n\n  return JSON.stringify({\n    baseDocumento: base,\n    tipoPessoa: \"PF\",\n  });\n}","inputVariables":["documentBase","cpf"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"LISTA QUANTIDADE DE CONTAS","$invalid":false,"settings":{"headers":{"Safra-Bot-ID":"{{safraBotId}}","User-Agent":"Fiddler","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusAccountLists","responseBodyVariable":"responseAccountLists"},"conditions":[]},{"$id":"0d4c790d-315d-4b56-adcc-c8ba5c70f750","$typeOfContent":"","type":"ExecuteScript","$title":"customerAccounts","$invalid":false,"settings":{"function":"run","source":"function run(responseAccountLists) {\n  responseAccountLists = JSON.parse(responseAccountLists);\n  return JSON.stringify({\n    accounts: responseAccountLists.data,\n  });\n}","inputVariables":["responseAccountLists"],"outputVariable":"customerAccounts","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusAccountLists"}]},{"$id":"33f1197e-1a77-40d5-831b-b56281517358","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusAccountLists}} | {{responseAccountLists}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"10c26107-6c39-44b5-a9b5-af21214d8d4d","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b6959830-a910-4eae-9206-798094d4dbe6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5329c8ed-2222-4fd3-b56d-fa3f6302fcc6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f3e351a9-3942-4ced-bc15-6aac729d0872","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f566cbec-6802-4540-b017-4159b6b170bc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0cf9f29a-0472-46df-ae36-20e3f79508e9","root":false,"$title":"[API] LISTA QUANTIDADE DE CONTAS","$position":{"top":"1821.11px","left":"472.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"10c26107-6c39-44b5-a9b5-af21214d8d4d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72c4be29-d90a-430d-afc8-207359c9cb81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e91577bf-4ecd-48fa-8812-4c4e61629844","typeOfStateId":"state","$connId":"con_83","$id":"09497a59-7458-44e0-8340-131003b789fa","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveAnyAccount"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c88e3926-4b1f-4ee6-84b6-297d5668ff4d","$typeOfContent":"","type":"ExecuteScript","$title":"haveAnyAccount","$invalid":false,"settings":{"function":"run","source":"function run(statusAccountLists, customerAccounts) {\n  const httpStatusOkRegExp = /^2[0-9]{2}$/;\n  if (!httpStatusOkRegExp.test(statusAccountLists)) return false;\n\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.data;\n\n  return accounts.length ? true : false;\n}","inputVariables":["statusAccountLists","responseAccountLists"],"outputVariable":"haveAnyAccount","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-12576f6f-8999-498c-ad13-d90f514c6a4c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"10c26107-6c39-44b5-a9b5-af21214d8d4d","root":false,"$title":"[LO] Possui conta?","$position":{"top":"1982.33px","left":"471.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7f67c95-a085-461a-8ce6-4165162dd1f3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","typeOfStateId":"state","$connId":"con_88","$id":"1adf25db-e068-4174-ba57-c671704395e4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8d8ee891-ba5a-464b-b091-8dc80b2fd474","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{envSettings@tokenURL}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"bbc6c427-f3b9-4e05-af44-26702beb6928","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0e307043-581a-434a-a106-71affbe8771a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-2d167522-203f-4d9c-a07a-b69540ca2eaf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-69b03514-fad9-4256-9c9b-0a44eff81ec0","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-bd30f57e-d711-4827-86c7-ec9b4a08a756","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"f7f67c95-a085-461a-8ce6-4165162dd1f3","root":false,"$title":"[API] TOKEN","$position":{"top":"1703px","left":"471.778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","commentsIdList":[]}},"e91577bf-4ecd-48fa-8812-4c4e61629844":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c300c442-1478-4053-a9d7-187127182ed0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","typeOfStateId":"state","$connId":"con_93","$id":"8dc06ce1-8e2e-49a7-99e4-df60ac69c379","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e91577bf-4ecd-48fa-8812-4c4e61629844","root":false,"$title":"[LO] Sim","$position":{"top":"2105px","left":"471px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0a31548-ebcb-457e-b9c2-1e31eedffb91","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","typeOfStateId":"state","$connId":"con_98","$id":"de585554-613d-4b35-9fc1-5a00107c5353","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea","root":false,"$title":"[LO] Não","$position":{"top":"2304.29px","left":"675.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0db8c9b1-f826-4ee2-a7cd-877dc177d168":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72c4be29-d90a-430d-afc8-207359c9cb81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"003aacd8-b430-48a3-bdb5-086e06563962","typeOfStateId":"state","$connId":"con_103","$id":"81769a02-af8e-42c3-a9e3-cad5c2865780","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveManyAccounts"},{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}],"$invalid":false},{"stateId":"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea","typeOfStateId":"state","$connId":"con_108","$id":"ded8fb00-ecc6-4caf-a79f-aff0fc2cdd4d","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"haveManyAccounts"}],"$invalid":false},{"stateId":"c7fc7784-b1cd-42e6-8ffd-21c98867bb74","typeOfStateId":"state","$connId":"con_113","$id":"b1a329c7-afcf-4a50-9ec0-2f785f32b1b4","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveManyAccounts"},{"values":["true"],"source":"context","comparison":"equals","variable":"isAccountInCache"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c88e3926-4b1f-4ee6-84b6-297d5668ff4d","$typeOfContent":"","type":"ExecuteScript","$title":"haveManyAccounts","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n\n  return accounts.length > 1 ? true : false;\n}","inputVariables":["customerAccounts"],"outputVariable":"haveManyAccounts","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8662626-26ec-45fd-86a1-0dacc170f661","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (agencia = false, conta = false) => {\n\ttry {\n\t\tif (conta && agencia) {\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contact.extras.conta","contact.extras.agencia"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"haveManyAccounts"}]},{"$id":"d310d719-7838-45cc-951d-9fada7c086fe","$typeOfContent":"","type":"SetVariable","$title":"CLEAR intencaoIdentificada IF intent is alterar conta","$invalid":false,"settings":{"variable":"intencaoIdentificada"},"conditions":[{"values":["alterar conta"],"source":"context","comparison":"equals","variable":"intencaoIdentificada@intent"}]},{"$id":"c52a7af5-315d-41db-8d64-0a230806a680","$typeOfContent":"","type":"SetVariable","$title":"clienteJaSaudado","$invalid":false,"settings":{"variable":"clienteJaSaudado","value":"Sim"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a5179b8f-5bfb-496b-bf38-25079c196751","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-12a30997-9010-42fb-a077-dc31d9d3e328","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","root":false,"$title":"[LO] Possui mais de uma conta?","$position":{"top":"2197px","left":"470px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"003aacd8-b430-48a3-bdb5-086e06563962":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c300c442-1478-4053-a9d7-187127182ed0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"37df718d-571b-48d2-9714-a47329aa9326","typeOfStateId":"state","$connId":"con_118","$id":"bb0cfdd2-d138-47dd-9949-a3927b6861fb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"37df718d-571b-48d2-9714-a47329aa9326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"003aacd8-b430-48a3-bdb5-086e06563962","root":false,"$title":"[LO] Sim","$position":{"top":"2288.25px","left":"275px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"37df718d-571b-48d2-9714-a47329aa9326":{"$contentActions":[{"action":{"$id":"0fa91206-ef77-451f-ae7b-c56698f2e7dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"85afe670-761a-477a-bb50-eb5f11a1ff18","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"85afe670-761a-477a-bb50-eb5f11a1ff18","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e6637913-93db-4c07-a987-c826ff2c9c3e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9defc467-85f2-44a3-8568-e6b86ae67815","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae","typeOfStateId":"state","$connId":"con_123","$id":"6344b6d6-c7ea-4652-bc6b-af68d35875db","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"processedInput@input"}],"$invalid":false},{"stateId":"1d2549f7-5406-4598-b022-9bf845a798db","typeOfStateId":"state","$connId":"con_128","$id":"6da8b9eb-64f3-48a5-a699-72c973375f78","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"processedInput@isValid"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c53b1b07-4d91-4560-a8ea-98e09ac8fdff","$typeOfContent":"","type":"TrackEvent","$title":"Exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta exibicao conta exibicaoia","action":"Exibicao"},"conditions":[]},{"$id":"2efc1bb6-60d6-4f0f-abf5-014323c6f466","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, customerAccounts) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n\n    customerAccounts = JSON.parse(customerAccounts);\n\n    const accounts = customerAccounts.accounts;\n    const text = `Escolha qual a conta você quer\nseguir com o atendimento.`;\n    let isButton = false;\n    let isList = true;\n    const description = [];\n    const options = [];\n    accounts.forEach((account, index) => {\n        options.push(`Conta: ${account.numeroConta}`);\n    });\n   accounts.forEach((account, index) => {\n        description.push(`AG: ${account.numeroAgencia}`);\n    });\n\n    options.push(\"Encerrar atendimento\");\n\n    if(options.length>10){\n        platform = \"blipchat\";\n    }\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher conta',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n  return words.join(\" \");\n}","inputVariables":["bold","platform","customerAccounts"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"acff923d-9176-4d25-b9bd-dd0e113f68e6","$typeOfContent":"","type":"SetVariable","$title":"typeError","$invalid":false,"settings":{"variable":"typeError","value":"menuDinamico"},"conditions":[]}],"$leavingCustomActions":[{"$id":"79af0c70-9064-4eaa-a266-8f272349299f","$typeOfContent":"","type":"ExecuteScript","$title":"processedInput","$invalid":false,"settings":{"function":"run","source":"function run(input, inputType, customerAccounts) {\n  const error = JSON.stringify({\n    status: \"input inválido\",\n    input: input ? input : \"usuário inativo\",\n    isValid: false,\n    type: \"menuDinamico\",\n  });\n\n  if (inputType !== \"text/plain\") return error;\n\n  customerAccounts = JSON.parse(customerAccounts);\n  input = input.trim();\n\n  // A opção e o número da opção são incluidos automaticamente na regexp\n  const menuOptions = {\n    \"Encerrar atendimento\": [\"encerrar\", \"sair\"],\n  };\n  const options = [\"Encerrar atendimento\"];\n  const accounts = customerAccounts.accounts;\n  const charLimit = 24;\n\n  accounts.forEach((account) => {\n    const textOption = `Conta: ${account.numeroConta}`;\n\n    if (textOption.length < charLimit) {\n      menuOptions[account.numeroConta] = [textOption];\n    } else {\n      menuOptions[account.numeroConta] = [];\n    }\n\n    options.push(account.numeroConta);\n  });\n\n  const matches = options.find((option, index) => {\n    let regexp = `^${option}$|`;\n    menuOptions[option].forEach((validationString) => {\n      validationString = validationString.replace(/^\\^|\\$$/g, \"\");\n      regexp += `^${validationString}$|`;\n    });\n    regexp += `^${index}$`;\n\n    return input.match(new RegExp(regexp, \"gim\"));\n  });\n\n  return matches\n    ? JSON.stringify({\n        status: \"input válido\",\n        input: matches,\n        isValid: true,\n        type: \"menuDinamico\",\n      })\n    : error;\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["input.content","input.type","customerAccounts"],"outputVariable":"processedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"11511b15-bdce-4aa5-a99b-523b1f98a4d6","$typeOfContent":"","type":"ExecuteScript","$title":"agency","$invalid":false,"settings":{"function":"run","source":"function run(processedInput, customerAccounts) {\n  processedInput = JSON.parse(processedInput);\n  customerAccounts = JSON.parse(customerAccounts);\n\n  const accounts = customerAccounts.accounts;\n  const selectedAccound = processedInput.input;\n  const accountFound = accounts.find(\n    (account) => account.numeroConta === selectedAccound\n  );\n\n  return accountFound ? accountFound.numeroAgencia : \"not found\";\n}","inputVariables":["processedInput","customerAccounts"],"outputVariable":"agency","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"},{"values":["Encerrar atendimento"],"source":"context","comparison":"notEquals","variable":"processedInput@input"}]},{"$id":"857b547e-87b1-4a39-a012-96dd49fc26d3","$typeOfContent":"","type":"SetVariable","$title":"account","$invalid":false,"settings":{"variable":"account","value":"{{processedInput@input}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"},{"values":["Encerrar atendimento"],"source":"context","comparison":"notEquals","variable":"processedInput@input"}]},{"$id":"0644ed59-b204-4e28-a1c1-91133c3c33d1","$typeOfContent":"","type":"TrackEvent","$title":"Selecao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta selecao","action":"{{processedInput@input}} | {{processedInput@status}}"},"conditions":[{"values":[],"source":"input","variable":"processedInput","comparison":"exists"},{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"}]},{"$id":"4f354dac-e0d9-4a62-9752-915bade6ef24","$typeOfContent":"","type":"TrackEvent","$title":"Inesperado","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["false"],"source":"context","comparison":"equals","variable":"processedInput@isValid"}]},{"$id":"1f9c424a-92c9-4be8-8d38-edb8dd299b65","$typeOfContent":"","type":"SetVariable","$title":"maisDeUmaConta","$invalid":false,"settings":{"variable":"maisDeUmaConta","value":"true"},"conditions":[]},{"$id":"2b24506d-1dba-4d6d-8737-7a3d65f893d0","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"agencia":"{{agency}}","conta":"{{account}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-cb10cc84-9f4f-49c1-9fc8-29a4d35dd3ec","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-34141f58-829b-4e65-86ec-1d57ad2ffc27","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bdf8a7d0-0dcb-4a91-ad7d-5a87cb4ef153","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a987c4fe-7d46-4e3b-8693-5aa0ab98a7c7","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-c949997d-fd30-4fc2-8ff9-fd67bc3e6520","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-0fd6b4bb-43f7-4459-9628-4582c328eec9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"37df718d-571b-48d2-9714-a47329aa9326","root":false,"$title":"[S.0.0.4][MENU] Conta","$position":{"top":"2453px","left":"274.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d9359361-57c8-4d39-a392-69b769f419d6","typeOfStateId":"state","$connId":"con_133","$id":"c40ec843-2bc1-4f3f-84b4-dc5f01399803","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47fb19ae-97b8-45a5-a9a9-55f1a3b05733","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{envSettings@tokenURL}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"566db329-3250-4b47-95c8-8ab581164fe8","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-87714094-2c4b-4c60-811b-789e35a987d5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-941590c4-14c0-448a-a476-5c6945f226ae","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f899f5f5-6775-44c0-8f27-8ba7d7a8a0c5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f8c6ff7d-94a9-46c1-84b2-a81b9a068d2a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","root":false,"$title":"[API] TOKEN","$position":{"top":"2564.57px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","commentsIdList":[]}},"1d2549f7-5406-4598-b022-9bf845a798db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cf8d0062-29c3-482a-92e3-955fef4240e9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1d2549f7-5406-4598-b022-9bf845a798db","root":false,"$title":"[GO TO] Identificação dados cliente","$position":{"top":"2666.75px","left":"384.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5f7ad7cf-be36-4a51-8011-147230ec120a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","typeOfStateId":"state","$connId":"con_138","$id":"204b8e6c-10f7-437c-a97e-0cf4a716a503","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8cbc2047-3951-48c5-a1ee-ea9832f3d3c1","$typeOfContent":"","type":"ExecuteScript","$title":"agency","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].numeroAgencia;\n}","inputVariables":["customerAccounts"],"outputVariable":"agency","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8cd07d53-d3cb-4d50-aa0c-9732952df248","$typeOfContent":"","type":"ExecuteScript","$title":"account","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].numeroConta;\n}\n","inputVariables":["customerAccounts"],"outputVariable":"account","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"faf56847-8a41-466e-a185-650f2dfc6f07","$typeOfContent":"","type":"ExecuteScript","$title":"codCliente","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].codigoCliente;\n}\n","inputVariables":["customerAccounts"],"outputVariable":"codCliente","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2d0798bd-8b60-4637-a989-797257074902","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","root":false,"$title":"[LO] Agencia/Conta","$position":{"top":"2414px","left":"675.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b86a601-9a6a-4460-9dee-a4fbe9026a3f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7731b29d-79e9-408d-868f-e704945aac88","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","typeOfStateId":"state","$connId":"con_143","$id":"8f5902c7-74fb-49c9-aae9-1bb487d7b61d","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"shouldIgnoreManager"}],"$invalid":false},{"stateId":"b34040c5-af17-45f9-b86b-80c66c404a50","typeOfStateId":"state","$connId":"con_148","$id":"c9227554-6f6b-433a-9868-25e15aaacdbc","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"shouldIgnoreManager"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"41e52afb-7158-41a2-8167-e96252b8b449","$typeOfContent":"","type":"ExecuteScript","$title":"ignoredManagersList","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return JSON.stringify([\n    {\n      name: \"Larrissa Marques\",\n      phoneNumber: \"11913529137\",\n    },\n    {\n      nome: \"Ana Paula A Gregório\",\n      phoneNumber: \"11970818618\",\n    },\n    {\n      nome: \"Erica Fernanda Ribeiro Silva\",\n      phoneNumber: \"11976900666\",\n    },\n    {\n      nome: \"Maria Gabriela F P de Oliveira\",\n      phoneNumber: \"11965982891\",\n    },\n    {\n      nome: \"Ana Paula Vicente S de Souza\",\n      phoneNumber: \"21973875675\",\n    },\n  ]);\n}\n","inputVariables":[],"outputVariable":"ignoredManagersList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f6c27603-d33b-4ada-8a89-7bd7c66a3598","$typeOfContent":"","type":"ExecuteScript","$title":"shouldIgnoreManager","$invalid":false,"settings":{"function":"run","source":"function run(ignoredManagersList, packsConfig) {\n  ignoredManagersList = JSON.parse(ignoredManagersList);\n  packsConfig = JSON.parse(packsConfig);\n\n  const routerPhone = packsConfig[\"PhoneNumber\"];\n  const managerFound = ignoredManagersList.find(\n    (manager) => manager.phoneNumber === routerPhone\n  );\n\n  return Boolean(managerFound);\n}","inputVariables":["ignoredManagersList","resource.packs.configuration"],"outputVariable":"shouldIgnoreManager","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ignoredManagersList"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4ff480f9-d7eb-4bea-9e22-3ff7310c07b0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7b86a601-9a6a-4460-9dee-a4fbe9026a3f","root":false,"$title":"[LO] Ignorar gerente?","$position":{"top":"256px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94ba7949-9cc9-457e-a542-2f3a8d76ee33":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e06cb4b8-6e15-429c-9968-2e276c9a053a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"343px","left":"872px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eec29ed0-812d-42fa-afd3-58e0dc4a5326":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a9b1a875-3cef-422b-9657-4ff83624d57b","$typeOfContent":"","type":"SetVariable","$title":"CLEAR intencaoIdentificada","$invalid":false,"settings":{"variable":"intencaoIdentificada"},"conditions":[]},{"$id":"27a61707-69c2-4bf5-8e0d-23c5113b3d5e","$typeOfContent":"","type":"ExecuteScript","$title":"skpRedirectContent","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, inputType, serviceName, parentServiceName) {\n  return {\n        \"origin\": \"PreEnd\",\n        \"flow\": \"finalizacao\",\n        \"input\": {\n            \"content\": inputContent,\n            \"type\": inputType\n        } \n    };\n};","inputVariables":["input.content","input.type","config.serviceName","config.parentServiceName"],"outputVariable":"skpRedirectContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9e2830e3-5e5c-46a2-8307-27c5bfa29347","$typeOfContent":"","type":"Redirect","$title":"Redirect \"skpParentServiceName\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{skpRedirectContent}}"},"address":"{{config.parentServiceName}}"},"conditions":[]},{"$id":"e540f160-e433-4017-b5e4-c4f34ea10973","$typeOfContent":"","type":"SetVariable","$title":"clienteJaSaudado","$invalid":false,"settings":{"variable":"clienteJaSaudado","value":"Não"},"conditions":[]},{"$id":"d7632d3b-4d1d-42d2-9324-6cc94ff840db","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"6cfcebf8-195e-4f33-9b59-7a1ac6adf108","$typeOfContent":"","type":"SetVariable","$title":"empty isAccountInCache","$invalid":false,"settings":{"variable":"isAccountInCache","value":"false"},"conditions":[]},{"$id":"24b8b67c-d2db-4b9e-ad88-93429a9cad0f","$typeOfContent":"","type":"SetVariable","$title":"empty responseTelIdent","$invalid":false,"settings":{"variable":"responseTelIdent"},"conditions":[]},{"$id":"d3b23287-0bd9-4eb6-bd96-dd0d473fcbb6","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (intent) => {\n\ttry {\n\t\treturn false;\n\t}\n\tcatch(e){\n\t\treturn false;\n\t}\n}","inputVariables":["intencaoIdentificada"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-829c9d63-04e7-417a-bda1-96799a25c7d4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5083be55-f3a2-4e8f-93b1-26d810fd118a","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-1e6fe3a4-16ab-4849-88bf-7e082ef3cab6","canChangeBackground":false}],"id":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","root":false,"$title":"[Redirect] Employee Finalização","$position":{"top":"227px","left":"1276px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e65ae042-2867-4005-9f6f-c24781ded992":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"27a61707-69c2-4bf5-8e0d-23c5113b3d5e","$typeOfContent":"","type":"ExecuteScript","$title":"skpRedirectContent","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, inputType, serviceName, parentServiceName) {\n  return {\n        \"origin\": serviceName,\n        \"flow\": parentServiceName,\n        \"input\": {\n            \"content\": inputContent,\n            \"type\": inputType\n        } \n    };\n};","inputVariables":["input.content","input.type","config.serviceName","config.parentServiceName"],"outputVariable":"skpRedirectContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9e2830e3-5e5c-46a2-8307-27c5bfa29347","$typeOfContent":"","type":"Redirect","$title":"Redirect \"skpParentServiceName\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{skpRedirectContent}}"},"address":"{{config.parentServiceName}}"},"conditions":[]},{"$id":"3e857d5a-7821-4c4c-8e95-0e6b88b9a035","$typeOfContent":"","type":"SetVariable","$title":"clienteJaSaudado","$invalid":false,"settings":{"variable":"clienteJaSaudado","value":"Não"},"conditions":[]},{"$id":"83b2986e-6afb-4bd0-a59e-ba8d8283698a","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"0609853b-4599-4f55-a803-29e4d9130334","$typeOfContent":"","type":"SetVariable","$title":"empty isAccountInCache","$invalid":false,"settings":{"variable":"isAccountInCache"},"conditions":[]},{"$id":"e38542c4-439b-40b5-95ec-ae4846beda1d","$typeOfContent":"","type":"SetVariable","$title":"empty responseTelIdent","$invalid":false,"settings":{"variable":"responseTelIdent"},"conditions":[]},{"$id":"62052518-5176-40fd-91bf-46cc80e91c7a","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (intent) => {\n\ttry {\n\t\treturn false;\n\t}\n\tcatch(e){\n\t\treturn false;\n\t}\n}","inputVariables":["intencaoIdentificada"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7bc31714-1aea-40b1-91f9-a464b7b7447b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-28b0ccb6-bcc7-4b23-bc4a-9883318905e7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"background":"#FF4A1E","label":"SetVariable","id":"blip-tag-1e6fe3a4-16ab-4849-88bf-7e082ef3cab6","canChangeBackground":false}],"id":"e65ae042-2867-4005-9f6f-c24781ded992","root":false,"$title":"[Redirect] Employee Transbordo","$position":{"top":"60px","left":"1282px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae","root":false,"$title":"[GO TO] Employee Finalização","$position":{"top":"2664.5px","left":"166.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4f2f8bca-5b12-450f-ab5a-cdfa022d2359":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"74f92265-ef2b-4c15-ab2e-f764d8b5320a","typeOfStateId":"state","$connId":"con_153","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","typeOfStateId":"state","$connId":"con_158","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"b7adc970-3748-4b05-b3cf-c62fbf818ad0","typeOfStateId":"state","$connId":"con_163","$id":"919866b3-ce6d-4004-8857-cd7817271d2a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run () {\n    return 'client_id=BLIP&grant_type=client_credentials&client_secret=5312b6d5-acb8-4165-9458-ef445876473e';\n}","inputVariables":[],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"https://api.safra.com.br/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{dadosCliente@documento}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\tconst cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoesAtivo\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn 0\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6e1462f6-98b9-4d7e-bfb9-adc477a13600","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f021fec-5201-43fe-9cbf-e7f7c8ec150c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","root":false,"$title":"[S.1.0.0] possui cartao?","$position":{"top":"1007px","left":"2272px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a7b4b5e0-118a-4a24-abe7-921da96f44bf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a81c2652-6c5c-4be0-899c-06b296aa5703","typeOfStateId":"state","$connId":"con_168","$id":"093a2a6a-e179-4910-b8b9-9bd05b76f497","conditions":[{"source":"context","comparison":"equals","values":["422"],"variable":"statusSenha"}],"$invalid":false},{"stateId":"22a29581-50cc-4866-b9c7-25f8b0d7e6b4","typeOfStateId":"state","$connId":"con_173","$id":"aea53c73-dca2-48d0-b913-5c6c249af32d","conditions":[{"source":"context","comparison":"equals","values":["senha transacional"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"ca9d3934-31b7-4812-b8d8-213d1cd6fecd","typeOfStateId":"state","$connId":"con_178","$id":"27d20aa2-d394-41fa-884c-cc329b14c857","conditions":[{"source":"context","comparison":"equals","values":["senha do cartao"],"variable":"intencaoIdentificada@intent"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"79abb350-68d3-43d9-b4b0-59bbc5517197","$typeOfContent":"","type":"ProcessHttp","$title":"responseSenha","$invalid":false,"settings":{"headers":{"amc-aplicacao":"IBJ","Content-Type":"application/json","Authorization":"Bearer {{token}}"},"method":"POST","body":"{\n  \"documento\": \"{{dadosCliente@documento}}\",\n  \"numeroCartao\": \"{{finalCartao}}\"\n}","uri":"https://api.safra.com.br/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/senhas/reemitir","responseStatusVariable":"statusSenha","responseBodyVariable":"responseSenha"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a5842ae7-d2cd-4683-8dc4-c486ddb51dc3","$typeOfContent":"","type":"MergeContact","$title":"set erro api","$invalid":false,"settings":{"extras":{"erro":"{{bodySenha}}"}},"conditions":[{"values":["204"],"source":"context","comparison":"notEquals","variable":"statusSenha"}]},{"$id":"e9351d9a-c19b-47df-9443-1547aeabc29f","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document, bodySenha) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha}  | ${bodySenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document","bodySenha"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0b79c298-5844-4aae-b9e5-cc0a612278dc","$typeOfContent":"","type":"TrackEvent","$title":"API senha","$invalid":false,"settings":{"extras":{},"category":"API senha","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-95725ec5-b014-4fb9-ac90-56d051677ab6","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ffdda95f-927c-4541-a1f8-617b0158c39c","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-6022c515-5b14-425d-93d5-e8e55812b5bf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d04689f7-c934-4031-a24d-31ee13bddd7d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96","root":false,"$title":"[S.2.0.0] senha","$position":{"top":"1376px","left":"2274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"74f92265-ef2b-4c15-ab2e-f764d8b5320a":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","typeOfStateId":"state","$connId":"con_183","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Vi que você tem mais de um cartão do Safra.\nEscolhe o cartão que precisa da senha ou me manda os 4 últimos números do cartão que eu consulto aqui.`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cbb14fac-4845-42ad-9868-e09f3025ce53","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-db37472d-7216-4794-a6e6-89406c5f606d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7fbf2294-81c9-4987-9d1f-a9d9ccb6f079","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"74f92265-ef2b-4c15-ab2e-f764d8b5320a","root":false,"$title":"[S.1.0.1]+ 1 cartao","$position":{"top":"1117px","left":"2493px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96","typeOfStateId":"state","$connId":"con_188","$id":"5561f97b-bfe5-4b0f-b9ac-f4b159fc4eb3","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\t\t\t\n\t\t}\n\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-aa88d8f9-d57b-49a8-93bc-5eac5084537b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","root":false,"$title":"[S.1.0.2]dados cartao","$position":{"top":"1222px","left":"2274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ca9d3934-31b7-4812-b8d8-213d1cd6fecd":{"$contentActions":[{"action":{"$id":"b8d0d200-3e8d-4711-ba17-4cc6de4292dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"09e2d8d0-db23-4f84-995f-58ea428a1e88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"09e2d8d0-db23-4f84-995f-58ea428a1e88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7c5205c9-8ed6-41af-8a8c-12e39e0d87ce","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ddf27379-63a2-4bc7-a152-55d4a3f6f77b","type":"text/plain","content":"{{mensagem}}","metadata":{}},"$cardContent":{"document":{"id":"ddf27379-63a2-4bc7-a152-55d4a3f6f77b","type":"text/plain","content":"{{mensagem}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"43b855ee-f3b3-402f-884c-7ce60445fe21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a00cbee5-4a86-4f8d-b43c-66d9a5dde93e","$typeOfContent":"","type":"ExecuteScript","$title":"mensagem","$invalid":false,"settings":{"function":"run","source":"const run = (finalCartao, qtdCartoes) => {\n\n\tif(qtdCartoes === 'um')\treturn `Claro, enviei no seu e-mail o PDF com a senha do seu cartão final ${finalCartao}`\n\treturn 'Ótimo, enviei no seu e-mail o PDF com a senha do seu cartão.'\n}","inputVariables":["finalCartao","qtdCartoes"],"outputVariable":"mensagem","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d89a51ae-df92-4b23-8b9c-b09ea8f297ee","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f9b1d6ad-aa77-465a-afca-85c01ebd3846","$typeOfContent":"","type":"TrackEvent","$title":"senha cartao exibicao","$invalid":false,"settings":{"extras":{},"category":"senha cartao exibicao","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c23fc1fb-fa3f-46b3-9ffb-614d3a4efeee","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bd986589-1538-4835-89d3-521a7caefead","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b7ec4542-0c7a-4db8-87ae-95c0cdc38f86","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ca9d3934-31b7-4812-b8d8-213d1cd6fecd","root":false,"$title":"[S.2.0.2] mensagem senha cartao","$position":{"top":"1447px","left":"2048px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"22a29581-50cc-4866-b9c7-25f8b0d7e6b4":{"$contentActions":[{"action":{"$id":"b083eaf8-e6a2-4b7f-ab59-d4ecde3805a7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"50751650-15b1-43e9-9823-5878673510e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"50751650-15b1-43e9-9823-5878673510e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ee42534-2af6-4263-ab9f-6ee39887a558","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3f69fa75-2105-479f-bdea-58de2a427d01","type":"text/plain","content":"Claro, enviei um PDF no seu e-mail com sua senha transacional.","metadata":{}},"$cardContent":{"document":{"id":"3f69fa75-2105-479f-bdea-58de2a427d01","type":"text/plain","content":"Claro, enviei um PDF no seu e-mail com sua senha transacional."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b7f03bea-65b7-4a1f-bbac-dd6de383f925","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c4798faf-f2c7-4e99-b78a-f29819f07560","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"daa65377-5402-4a4b-82ef-5a665e31c999","$typeOfContent":"","type":"TrackEvent","$title":"senha transacional exibicao","$invalid":false,"settings":{"extras":{},"category":"senha transacional exibicao","action":"{{tracking}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-37a20c71-8afb-433a-ba9d-d59d49124d3c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a0c593ff-3e0d-4b32-bd80-0eb124476f2e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-411f5213-bed9-47ab-8933-a86edfc5352b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"22a29581-50cc-4866-b9c7-25f8b0d7e6b4","root":false,"$title":"[S.2.0.1] mensagem senha transacional","$position":{"top":"1426px","left":"2494px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"257f1171-0297-4b48-8a1c-89a7959b201f":{"$contentActions":[{"action":{"$id":"5c4cc545-a9dc-42d8-8f97-5053697ab697","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed1b3173-87d9-412b-a602-0f703bee9fb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"{{mensagemOla}}","metadata":{}},"$cardContent":{"document":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"{{mensagemOla}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f38dcdda-ffa8-484d-984b-ed99704f4332","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"f5d1137b-79a1-4a8f-ac78-edd355372dbf","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemOla","$invalid":false,"settings":{"function":"run","source":"const run = (nome, maisDeUmaConta = false, clienteJaSaudado) => {\n\ttry {\n\t\tconst nomePequeno = nome.toLowerCase()\n\t\tnome = nomePequeno.replace(/^./, nomePequeno[0].toUpperCase()) //primeira letra maiuscula\n\t\tconst frases = ['Como posso te ajudar', 'Em que posso te ajudar', 'No que posso te ajudar', 'Como posso ajudar']\n\n\t\tconst index = Math.floor(Math.random() * 10 % 2)\n\t\tconst hora = new Date().getHours()\n\n\t\tlet greeting;\n\t\tif (hora >= 5 && hora < 12) {\n\t\t\tgreeting = 'bom dia'\n\t\t} else if (hora >= 12 && hora < 18) {\n\t\t\tgreeting = \"boa tarde\"\n\t\t} else if (hora >= 18 || hora < 5) {\n\t\t\tgreeting = 'boa noite'\n\t\t}\n\n\t\tif (clienteJaSaudado == \"Sim\") {\n\t\t\treturn `${frases[index]}?`\n\t\t}\n\t\treturn `Olá ${nome}, ${greeting}.\n\t\t\n${frases[index]}?`\n\t}\n\tcatch (err) {\n\t\treturn `Olá ${nome}.`\n\t}\n\n}","inputVariables":["nome","maisDeUmaConta","clienteJaSaudado"],"outputVariable":"mensagemOla","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"2dd3df38-de36-409d-b6fd-47bea1a355fc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intentBody\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tconst userInput = JSON.parse(inputContent).input.content\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": userInput\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": inputContent\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["input.content"],"outputVariable":"intentBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c0445b5-715e-45f2-93c9-1d5a72390576","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"intentResponse\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.commandsKey}}","Content-Type":"application/json"},"method":"POST","body":"{{intentBody}}","uri":"{{config.commandsUrl}}","responseStatusVariable":"intentStatus","responseBodyVariable":"IntentResponse"},"conditions":[]},{"$id":"4ec9da18-6ece-492e-b21c-0b5819b0de4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(intent, accuracy) {\n\ttry {\n\t\tinput = JSON.parse(intent).resource.text;\n\t\treturn {\n\t\t\tinput: input,\n\t\t\tintent: findIntention(intent, accuracy)\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction findIntention(intent, accuracy) {\n\ttry {\n\t\tintent = JSON.parse(intent).resource.intentions\n\t\tindentifiedIntent = intent.filter(({ score }) => score > Number(accuracy))\n\t\tif (indentifiedIntent.length > 0) {\n\t\t\treturn indentifiedIntent[0].name;\n\t\t}\n\t\treturn null\n\t} catch (err) {\n\t\treturn null\n\t}\n}","inputVariables":["intentResponse","config.accuracy"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5758f1d9-7fc7-48a5-a81a-680f1fb6d5aa","$typeOfContent":"","type":"ExecuteScript","$title":"tracking intencao","$invalid":false,"settings":{"function":"run","source":"const run = (contact, intent) => {\n\ttry {\n\t\tconst intencao = JSON.parse(intent)\n\t\tconst dataRaw = new Date()\n\t\tdataRaw.setHours(new Date().getHours() - 3)\n\t\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\t\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\t\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\n\t\tconst telefone = contact.split(\"@\")[0]\n\t\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"34442060-d0c5-45e3-bd27-e356282d763f","$typeOfContent":"","type":"TrackEvent","$title":"intencao em que posso ajudar","$invalid":false,"settings":{"extras":{},"category":"intencao em que posso ajudar","action":"{{tracking}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"tracking"}]},{"$id":"306c4acf-4607-4069-b820-8519c1e5a770","$typeOfContent":"","type":"TrackEvent","$title":"intencao api result","$invalid":false,"settings":{"extras":{},"action":"{{intentBody}} | {{IntentStatus}} | {{intentResponse}}","category":"intencao api result"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ea1a9319-37cb-4b03-97c7-24bfb7bbf94f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f3fbcad-c63e-4b97-9626-aa703d489a87","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-5ca7cee9-4edc-4545-8506-f754548cace7","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"257f1171-0297-4b48-8a1c-89a7959b201f","root":false,"$title":"Em que posso ajudar?","$position":{"top":"1290px","left":"248px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7fc7784-b1cd-42e6-8ffd-21c98867bb74":{"$contentActions":[{"action":{"$id":"0e16bcbd-29d5-419f-a0dd-3c9f78351cca","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"50ba1b1b-41fb-4ba4-874e-c895c0d0827d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"50ba1b1b-41fb-4ba4-874e-c895c0d0827d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"76d70635-744e-4e57-b69d-32982dbad6f5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"42e08227-0189-47be-ac76-7b38f10d9f1d","type":"text/plain","content":"Neste momento você está sendo atendido através da conta\n \n<b>Agência</b>: {{contact.extras.agencia}}\n<b>Conta</b>: {{contact.extras.conta}}\n \nSe precisar trocar, é só me falar que altero pra você.","metadata":{}},"$cardContent":{"document":{"id":"42e08227-0189-47be-ac76-7b38f10d9f1d","type":"text/plain","content":"Neste momento você está sendo atendido através da conta\n \n<b>Agência</b>: {{contact.extras.agencia}}\n<b>Conta</b>: {{contact.extras.conta}}\n \nSe precisar trocar, é só me falar que altero pra você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"57d8d937-48f6-4da8-8af0-d8500d92de51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bef6a3e2-6355-4e98-88cd-4887e0a27752","$typeOfContent":"","type":"SetVariable","$title":"agency","$invalid":false,"settings":{"variable":"agency","value":"{{contact.extras.agencia}}"},"conditions":[]},{"$id":"8a9eb21b-68b6-493b-ba49-ba68fd304f4c","$typeOfContent":"","type":"SetVariable","$title":"agency","$invalid":false,"settings":{"variable":"account","value":"{{contact.extras.conta}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d9359361-57c8-4d39-a392-69b769f419d6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-55dd68c5-f2f0-4d7b-923e-79afb84df51f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1db12b05-b509-486e-96e7-4af648cc7aef","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c7fc7784-b1cd-42e6-8ffd-21c98867bb74","root":false,"$title":"isAccountInCache","$position":{"top":"2170.86px","left":"680.286px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","typeOfStateId":"state","$connId":"con_193","$id":"5f7c2538-32ae-46ac-a15a-ee1797bf7ce9","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"OSADesligado"}],"$invalid":false},{"stateId":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","typeOfStateId":"state","$connId":"con_198","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_SENHA_TRANSACIONAL\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-beb58cbd-7463-4336-a6ef-6b91e407384f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-968a19f9-26e5-4948-a724-0b30fa97a1f8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2ec39383-43ab-47d7-bd73-c5e40c1d0ed1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"822px","left":"2272.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"19eb9819-6e40-4264-afa8-46d3ae5e3782":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"61ec3822-3b20-4fa7-b27d-520fc240a63f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f7f67c95-a085-461a-8ce6-4165162dd1f3","typeOfStateId":"state","$connId":"con_203","$id":"4867cbd2-e8d4-44c9-9348-f8162515acaf","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"19eb9819-6e40-4264-afa8-46d3ae5e3782","root":false,"$title":"Conta","$position":{"top":"1603px","left":"472.444px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8325d14c-c78f-4a7a-9c20-9ac10444761d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"403b443c-70ab-4f60-a8b2-2cf0086b9215","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9","typeOfStateId":"state","$connId":"con_208","$id":"183d046b-378c-4c0e-88c5-66840154c224","conditions":[{"source":"context","comparison":"contains","values":["senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos","status de entrega"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"257f1171-0297-4b48-8a1c-89a7959b201f","typeOfStateId":"state","$connId":"con_213","$id":"002749c3-9935-40dc-b600-a7a4a5bf7a2d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"8325d14c-c78f-4a7a-9c20-9ac10444761d","root":false,"$title":"[LO] Define Redirect","$position":{"top":"1141px","left":"429.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9":{"$contentActions":[{"action":{"$id":"7416321b-1d5f-4354-9229-6d1ee5fa578c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0bb4c5e2-36db-42bf-94d3-fb760e983b3c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0bb4c5e2-36db-42bf-94d3-fb760e983b3c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b2399964-e106-46ed-8b89-457844098298","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a4d3db4c-b293-4419-8026-cb01da55f9ee","type":"text/plain","content":"{{mensagemOla}}","metadata":{}},"$cardContent":{"document":{"id":"a4d3db4c-b293-4419-8026-cb01da55f9ee","type":"text/plain","content":"{{mensagemOla}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e8971cf5-3890-4f91-9c01-b8df71c79f0c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","typeOfStateId":"state","$connId":"con_218","$id":"65694a40-7410-4ca8-8307-aebebd049444","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e7ac2ad4-3089-4b35-9ef3-c7c8adba97cb","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemOla","$invalid":false,"settings":{"function":"run","source":"const run = (nome, maisDeUmaConta = false, clienteJaSaudado) => {\n\ttry {\n\t\tconst nomePequeno = nome.toLowerCase()\n\t\tnome = nomePequeno.replace(/^./, nomePequeno[0].toUpperCase()) //primeira letra maiuscula\n\t\tconst index = Math.floor(Math.random() * 10 % 2)\n\t\tconst hora = new Date().getHours()\n\n\t\tlet greeting;\n\t\tif (hora >= 5 && hora < 12) {\n\t\t\tgreeting = 'bom dia'\n\t\t} else if (hora >= 12 && hora < 18) {\n\t\t\tgreeting = \"boa tarde\"\n\t\t} else if (hora >= 18 || hora < 5) {\n\t\t\tgreeting = 'boa noite'\n\t\t}\n\n\t\treturn `Olá ${nome}, ${greeting}.`\n\t}\n\tcatch (err) {\n\t\treturn `Olá ${nome}.`\n\t}\n\n}","inputVariables":["nome","maisDeUmaConta","clienteJaSaudado"],"outputVariable":"mensagemOla","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4b116068-59ab-48b9-a4f2-6cc654f6e2dc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-26741a8b-b482-4f59-b886-61094069cd18","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9","root":false,"$title":"[LO] Intencao Especifica","$position":{"top":"1254.5px","left":"652.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94f0d218-33bc-4943-965f-bfb4f0205121":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1f0e49ad-194d-43f3-a53c-1059fd49c0d6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"94f0d218-33bc-4943-965f-bfb4f0205121","root":false,"$title":"[GO TO] Conta","$position":{"top":"1429px","left":"652px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6409c653-f585-4dc3-8039-4c7453131a4f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3f370aae-e3cb-483c-978b-5f988b90e0d1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c789b4b6-f614-4658-98bd-3dc0a2ba0f48","typeOfStateId":"state","$connId":"con_223","$id":"68771426-1c14-4bc3-b4d3-e082091ee9a7","conditions":[{"source":"context","comparison":"contains","values":["senha do cartao","senha transacional"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"55270663-c4fc-4407-8ac5-e859e7d9d5f0","typeOfStateId":"state","$connId":"con_228","$id":"1d0f5912-779c-41a7-baed-913f4d034e11","conditions":[{"source":"context","comparison":"equals","values":["fatura do cartao"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"127757c2-0404-4ee1-887c-6b60d71a3a77","typeOfStateId":"state","$connId":"con_233","$id":"acbc2748-5086-4db3-9dbc-4d76da94722a","conditions":[{"source":"context","comparison":"equals","values":["posicao investimentos"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"1376549f-3a8a-4f11-869e-1960f295a5ef","typeOfStateId":"state","$connId":"con_238","$id":"bf740b6f-5c27-4084-81b8-3e1d2157309d","conditions":[{"source":"context","comparison":"equals","values":["extrato"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8","typeOfStateId":"state","$connId":"con_243","$id":"b6aaddcb-0742-4ff2-864d-3ddb169e4cc4","conditions":[{"source":"context","comparison":"equals","values":["alterar conta"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"d64a1b9a-d7fb-4a53-884a-d34085a5601b","typeOfStateId":"state","$connId":"con_248","$id":"0c6dd484-3e36-4278-85a3-db4773e191e7","conditions":[{"source":"context","comparison":"equals","values":["status de entrega"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"cdd34564-0396-44f2-a37d-978173c3889d","typeOfStateId":"state","$connId":"con_253","$id":"9a025280-50e8-43fc-b683-0f24f665aed5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6409c653-f585-4dc3-8039-4c7453131a4f","root":false,"$title":"[LO] Redirect to Intent","$position":{"top":"2892px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c789b4b6-f614-4658-98bd-3dc0a2ba0f48":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"29db6934-db3e-4ec2-aa38-63e03e5e28f8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7f659926-dc88-4644-8b7a-f565172719dd","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c789b4b6-f614-4658-98bd-3dc0a2ba0f48","root":false,"$title":"[GO TO] Senha","$position":{"top":"3033px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7f659926-dc88-4644-8b7a-f565172719dd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4db89b2f-6610-4fef-a60d-397cfa0acb20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3","typeOfStateId":"state","$connId":"con_258","$id":"89d71240-6f55-4031-97de-0d19c5402a93","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"7f659926-dc88-4644-8b7a-f565172719dd","root":false,"$title":"[Inicio] Senha","$position":{"top":"673.667px","left":"2272px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"872e291f-f7e3-47e4-bf53-a2fdc8d416b2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cb24993-c716-4d70-bc9a-b0b5059007d3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"872e291f-f7e3-47e4-bf53-a2fdc8d416b2","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"1016px","left":"1068.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0901ef90-046a-400a-af6a-448451b6d2cd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"ae186038-de48-45ff-bcc3-12ef5883d325","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn false;\n}","inputVariables":[],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3b81df9-3de1-4dad-ad5b-b33afa397e3a","$typeOfContent":"","type":"SetVariable","$title":"agencia","$invalid":false,"settings":{"variable":"agencia"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"50997dc8-f861-4233-800c-7120f2f9c0b2","$typeOfContent":"","type":"SetVariable","$title":"conta","$invalid":false,"settings":{"variable":"conta"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"e04e4f0e-5c29-4c3f-a5c1-9e9766b2e068","$typeOfContent":"","type":"MergeContact","$title":"conta/agencia","$invalid":false,"settings":{"extras":{"conta":"{{conta}}","agencia":"{{agencia}}"}},"conditions":[{"values":["false"],"source":"context","variable":"isAccountInCache","comparison":"equals"}]},{"$id":"9ca8a87d-6e74-4b39-b2b3-bfcf3d78b738","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5f7a11a3-b1a2-46e8-83ad-3bdb997eeb50","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1dbb0e20-e399-4a50-a9e2-e4dcec13c805","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-090a1582-72ad-4e2d-85bd-ce491142c078","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8","root":false,"$title":"[GO TO] Conta","$position":{"top":"3042.25px","left":"1393px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a81c2652-6c5c-4be0-899c-06b296aa5703":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b0581502-33d7-44e9-a2b8-ec69dc729fe0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"a81c2652-6c5c-4be0-899c-06b296aa5703","root":false,"$title":"[GO TO] employee transbordo","$position":{"top":"1527px","left":"2273px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a4d00d38-2ac4-4881-8808-879f3ce6b708":{"$contentActions":[{"action":{"$id":"5c4cc545-a9dc-42d8-8f97-5053697ab697","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed1b3173-87d9-412b-a602-0f703bee9fb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"Posso te ajudar em algo mais?","metadata":{}},"$cardContent":{"document":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"Posso te ajudar em algo mais?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f38dcdda-ffa8-484d-984b-ed99704f4332","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3f739f15-0056-45e3-89b4-29d2ae4d3efa","typeOfStateId":"state","$connId":"con_263","$id":"d3cec968-0120-4586-8aad-7f0289dd777c","conditions":[{"source":"context","comparison":"contains","values":["Negation"],"variable":"SmallTalksIdentified"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4e1c5171-6212-4fc3-998e-6fe98f62cfee","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5e790807-8af2-4707-8bcf-189cddaaa279","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = ( contact, intent) => {\n\tconst intencao = JSON.parse(intent)\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4602aedf-7f28-42c4-ac41-dfde63fada53","$typeOfContent":"","type":"TrackEvent","$title":"intencao te ajudo em algo mais","$invalid":false,"settings":{"extras":{},"category":"intencao Te ajudo em algo mais","action":"{{tracking}}"},"conditions":[]},{"$id":"0f119d00-08fc-4fb6-8de9-6794cc8861cd","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"ac347e98-44d3-42fd-ab3e-5ca00b54e487","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7843052d-b287-4e3a-ab8d-f8d44c3a045f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-12f00a56-ce8a-4442-87d1-4d6546b9b8cf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-928c622d-bf1f-45a6-b10c-4ab3ac754ced","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-e22160c3-b88c-4ada-9131-9add352aa4b1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-8d4b8412-0acc-4943-acb5-c73912145f11","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a4d00d38-2ac4-4881-8808-879f3ce6b708","root":false,"$title":"Te ajudo em algo mais","$position":{"top":"280.75px","left":"2726.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a35fa267-f2b7-4298-83d9-b0924114e971":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"85a9c4c8-745d-4f90-84fb-0d7054fe9048","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"871d7bbd-2b33-4a84-b028-b6e692ed9510","typeOfStateId":"state","$connId":"con_268","$id":"0799e07e-6c68-4d66-93db-731882a29c75","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["extratoDataInvalida"],"source":"context","comparison":"equals","variable":"dataExtractor@error"},{"values":["871d7bbd-2b33-4a84-b028-b6e692ed9510"],"source":"context","comparison":"notEquals","variable":"state.previous.id"}],"$invalid":false},{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","typeOfStateId":"state","$connId":"con_273","$id":"684758e1-01af-41cd-a10c-8e71515ff988","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1e6bd2c1-66d3-490f-9fd8-414b7ab0c81b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"8e5c42e8-afdc-47ed-a38d-9f0ce3f6b929","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, statePreviousId, smalltalks) {\n  try {\n    if (smalltalks && smalltalks.includes(\"Confirmation\") && statePreviousId === '871d7bbd-2b33-4a84-b028-b6e692ed9510') {\n      const currentDate = new Date();\n      const endDate = currentDate;\n      const startDate = new Date(currentDate.getTime() - 30 * 24 * 60 * 60 * 1000);\n      return `${formatDate(startDate)}|${formatDate(endDate)}`;\n    }\n\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n        return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n\n      return `${formatDate(startDate)}|${formatDate(endDate)}`; // Retorna as datas \n    } else {\n      return { error: 'extratoDataInvalida' };\n    }\n\n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","state.previous.id","bodySmallTalks"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b49e58c-0e49-46dd-8ada-a72a82f2fb15","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dataExtractor@error\"","$invalid":false,"settings":{"variable":"exceptionType","value":"{{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]}],"$leavingCustomActions":[{"$id":"a324f2ac-e7dd-462b-8481-9c7e796c3d12","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input inesperado\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input inesperado","action":"{{state.previous.name}} | {{dataExtractor@error}} | {{input.content}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"03afa7a9-af25-4854-909f-4ef6560f9698","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato error\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato error","action":"{{state.previous.name}} | {{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"08e90e47-63cf-48ed-98e7-c6907d863acb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input","action":"{{state.previous.name}} | {{input.content}} | {{dataExtractor}}"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-45bc4d37-69c6-45df-b20d-72dfdcbf8f1e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4ef8ed07-301d-47a2-a469-3eb8c579e376","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-60647a43-2476-411e-8fb1-7535dd69ce83","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"a35fa267-f2b7-4298-83d9-b0924114e971","root":false,"$title":"[E.1.0.0][SET] Valida input do usuario","$position":{"top":"790.75px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"871d7bbd-2b33-4a84-b028-b6e692ed9510":{"$contentActions":[{"action":{"$id":"c2e2aa97-b7f7-4109-aa5e-b5f8ff075ebb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31a774e3-1d14-4de6-bf94-f2e868f9f018","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 30 dias mesmo?","metadata":{}},"$cardContent":{"document":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 30 dias mesmo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c3010671-a4a8-40a4-bba4-45ecfb8bf0dc","type":"text/plain","textContent":"Entrada do usuário","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_278","$id":"7d932bee-eec1-4f19-af13-fb5eab80f880","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c42adbc3-7434-4ba0-bdce-f7172bacdf40","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"69e4094c-6b73-4d36-9f82-de14b9701e33","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"24eb1e8d-1c43-4ecb-ba40-cf5e09bf3d1e","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"cb116792-f53d-4b60-9840-c6b840b70078","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b580f4ad-db37-4fdb-a9f6-b19b6766616f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-42b6c85d-bac6-4ec4-a2ef-6443fe820ad8","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ba95be4f-c86b-4f58-b101-f78b2cbead5a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7dd1b06e-0069-4cfb-b36a-4c5464011cfe","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-26589447-fbd1-4d79-ac57-9be7eb8b757e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"871d7bbd-2b33-4a84-b028-b6e692ed9510","root":false,"$title":"[E.2.0.0][MSG][INPUT] Pergunta periodo","$position":{"top":"791px","left":"3579px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"84742bd8-cf3a-42eb-9872-710107fa5f1c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"704f8e0c-512c-44bd-8610-570d27ba2318","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"116ba504-bb26-46fe-a74c-b5c69bf357b1","typeOfStateId":"state","$connId":"con_283","$id":"680ab48e-6724-42a4-b347-c8f6bb2b2a94","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e4399cb-56e8-4301-bb19-311701963b5f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"320e7bbc-121f-4624-96c5-11e42d9203c0","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" to \"\"","$invalid":false,"settings":{"variable":"SmallTalksIdentified"},"conditions":[]},{"$id":"1bfb6c91-f57e-4f41-b361-9308f05634fe","$typeOfContent":"","type":"ExecuteScript","$title":"msgHomologacao","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(x) {\n\treturn `[Homologação]\n\tEstamos enviando o extrato do seguinte período identificado:\n\t ${x}`\n}\n","inputVariables":["dataExtractor"],"outputVariable":"msgHomologacao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c0c2cb45-b715-485f-8ee4-07083b5df0f8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0114cb0c-e132-483c-bc36-a8ba9e19a7ad","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-349f35f8-8069-4932-b35a-4eea408a2ecd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"84742bd8-cf3a-42eb-9872-710107fa5f1c","root":false,"$title":"[E.3.0.0][SET] Periodo identificado","$position":{"top":"972px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"116ba504-bb26-46fe-a74c-b5c69bf357b1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4f2d3b75-84c0-45a8-b360-7f2c6d54c651","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"76e66b96-c6e8-466c-86f4-f626d201cf17","typeOfStateId":"state","$connId":"con_288","$id":"d037e357-9421-4aa6-a28d-0f713698a796","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"dentroDosTrintaDias"},{"values":["200","202"],"source":"context","comparison":"equals","variable":"statusEnvioExtrato"}],"$invalid":false},{"stateId":"d71495a0-6203-423b-aace-67e3f4df6e8d","typeOfStateId":"state","$connId":"con_293","$id":"ab69c031-b50f-4452-afb5-55f5ee35a4a2","conditions":[{"source":"context","comparison":"equals","values":["200","202"],"variable":"statusEnvioExtrato"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b123ae2f-d64e-4d7e-9f0a-deaf7bfcbbf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"15145df0-8255-4969-be2e-3815b8cbe69b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyExtrato\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, dataExtractor) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tlet data = dataExtractor.split('|');\n\t\treturn {\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"dataInicial\": data[0],\n\t\t\t\"dataFinal\": data[1],\n\t\t\t\"limite\": \"100\",\n\t\t\t\"pagina\": \"1\"\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","dataExtractor"],"outputVariable":"bodyExtrato","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b99e86a4-7aa9-45a0-ace8-0a0313f88277","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioExtrato","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/extratos/notificar","responseStatusVariable":"statusEnvioExtrato","responseBodyVariable":"responseEnvioExtrato","body":"{{bodyExtrato}}"},"conditions":[]},{"$id":"9faa9ff1-b545-4baf-a1ae-d75b5278dbd9","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusEnvioExtrato"}]}],"$leavingCustomActions":[{"$id":"15f80a3c-18f8-4740-bfc5-bda768be8b26","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dentroDosTrintaDias\"","$invalid":false,"settings":{"function":"run","source":"function run(dateRange) {\n  const dates = dateRange.split('|');\n  const startDate = new Date(dates[0]);\n  const endDate = new Date(dates[1]);\n\n  const today = new Date();\n  const thirtyDaysAgo = new Date(today);\n  thirtyDaysAgo.setDate(today.getDate() - 30);\n\n  return startDate >= thirtyDaysAgo && endDate <= today;\n}","inputVariables":["dataExtractor"],"outputVariable":"dentroDosTrintaDias","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dc240ebb-6ee8-42a1-9cd2-51a77122c976","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6ec53552-1957-48de-906e-fac1ee2a8a3e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1b576df1-ce70-4788-9d61-d904c03e1372","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b865b722-1827-4cf7-a62c-65c5fdb09390","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"116ba504-bb26-46fe-a74c-b5c69bf357b1","root":false,"$title":"[E.4.0.0][HTTP] Chamada API extrato","$position":{"top":"1228px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d71495a0-6203-423b-aace-67e3f4df6e8d":{"$contentActions":[{"action":{"$id":"29bed67c-944d-44ae-879f-ddc9e2b59535","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1be677b9-0ba2-4253-8195-0c2df8f53386","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1be677b9-0ba2-4253-8195-0c2df8f53386","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"46cc202b-1b1f-4d35-ba89-0a4374bd464b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e6d6973b-27a7-47ad-ab69-49cd141b72b3","type":"text/plain","content":"Vou te mandar o extrato no seu email.","metadata":{}},"$cardContent":{"document":{"id":"e6d6973b-27a7-47ad-ab69-49cd141b72b3","type":"text/plain","content":"Vou te mandar o extrato no seu email."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac9e2a78-d133-4eb0-9e06-3edb448dab26","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"feacc199-138a-4b53-97c5-4df7b2f4c4a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"6000"},"metadata":{}},"$cardContent":{"document":{"id":"feacc199-138a-4b53-97c5-4df7b2f4c4a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"6000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"17b054b5-dee7-4578-b44d-10efb424d5af","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2cab5dac-8e04-4681-b3dd-eb0d9190f2a2","type":"text/plain","content":"Pronto, já enviei pra você.","metadata":{}},"$cardContent":{"document":{"id":"2cab5dac-8e04-4681-b3dd-eb0d9190f2a2","type":"text/plain","content":"Pronto, já enviei pra você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39e7ffb0-588b-41df-a249-cdc91ff8dcb5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","typeOfStateId":"state","$connId":"con_298","$id":"35de290e-abe4-40d8-a726-7132d31e8e42","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3278d444-f319-4c66-bec9-756745c09af5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1c04255-c798-4fb2-86bb-efaf159746f1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-51a04b30-935f-431c-8254-161b81439355","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d71495a0-6203-423b-aace-67e3f4df6e8d","root":false,"$title":"[E.5.1.0][MSG] Extrato periodo superior a 30 dias","$position":{"top":"1413px","left":"3521px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"76e66b96-c6e8-466c-86f4-f626d201cf17":{"$contentActions":[{"action":{"$id":"afb67201-0ee5-440d-9044-1db7ce8a730d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ab33e144-dd1a-494c-8d29-e2286c26cec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ab33e144-dd1a-494c-8d29-e2286c26cec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8211c06a-a0d3-4b14-91d6-0fe471315a05","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c0b76e85-85bf-48ec-949c-e3369a685a77","type":"text/plain","content":"Pronto, mandei no seu e-mail o extrato de conta corrente.","metadata":{}},"$cardContent":{"document":{"id":"c0b76e85-85bf-48ec-949c-e3369a685a77","type":"text/plain","content":"Pronto, mandei no seu e-mail o extrato de conta corrente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"68ac32a9-f842-40b9-a31d-ecdd4319d48b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","typeOfStateId":"state","$connId":"con_303","$id":"13504498-eb7a-48b7-9020-3a0397e0be89","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"177d52fa-e9af-4381-a06a-a327c6c4720c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-91f7c6a9-1b91-4a04-83a1-79e390a5d286","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-61897651-3717-457e-bf4a-ab3be94ab9a3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"76e66b96-c6e8-466c-86f4-f626d201cf17","root":false,"$title":"[E.5.0.0][MSG] Extrato dos ultimos 30 dias","$position":{"top":"1425px","left":"3082px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55a7184f-25ce-4f2d-a9e5-99adb4b54b43":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5822295d-51e6-42a6-ae0e-28bb39a46558","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d5a63910-77b8-414a-97ea-21e82114edd9","typeOfStateId":"state","$connId":"con_308","$id":"fdbe7338-e666-4cb1-9301-1cdb5e300ffa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"feca63b9-ee12-4878-824a-3d9bd6d5bc7c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-99e9a54a-846a-4f37-a039-2165ac74eae9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","root":false,"$title":"[E.6.0.0] Finalização jornada extrato","$position":{"top":"1689px","left":"3305px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c606331c-9875-44ec-bdb4-da4571c9dd01","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5aba1012-65f4-4562-9aa9-419d0b772741","typeOfStateId":"state","$connId":"con_313","$id":"a78c027b-40db-464b-8ffc-659e1ed74f06","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a","root":false,"$title":"[Inicio] Extrato","$position":{"top":"496px","left":"3294.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0fb18c4b-3d1a-4905-b922-197db4f5d1c8":{"$contentActions":[{"action":{"$id":"232e975d-726f-4a57-bda5-a2bced451599","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d6e3eae9-acca-4410-9841-862c3e5d5819","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d6e3eae9-acca-4410-9841-862c3e5d5819","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d6594ec-3e50-446a-91f3-0e1dee0e70c5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"be7a0115-d4a9-4a28-ad1a-fccb560179d6","type":"text/plain","content":"Eu só consigo te mandar o extrato de até dois anos.","metadata":{}},"$cardContent":{"document":{"id":"be7a0115-d4a9-4a28-ad1a-fccb560179d6","type":"text/plain","content":"Eu só consigo te mandar o extrato de até dois anos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"13edf47f-db94-4720-9248-40abcb638142","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6e74e30b-8e31-43d5-bf54-7d89eed6c0d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6e74e30b-8e31-43d5-bf54-7d89eed6c0d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"020184c4-1b78-4cf8-a7d5-da43e481d5f6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"27347564-ac1d-4483-988a-2c1a2c169e53","type":"text/plain","content":"Eu posso te enviar de algum outro período dentro de 2 anos.\nPode ser?","metadata":{}},"$cardContent":{"document":{"id":"27347564-ac1d-4483-988a-2c1a2c169e53","type":"text/plain","content":"Eu posso te enviar de algum outro período dentro de 2 anos.\nPode ser?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"cede0f5a-5453-45c2-a4fd-e95e478bdd14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d656533c-7bf1-4c99-9309-c499e37ac1b4","typeOfStateId":"state","$connId":"con_318","$id":"39c07ed9-150c-4b78-af02-e1122d9f5c35","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"},{"values":["Confirmation"],"source":"context","comparison":"contains","variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"36276848-e740-4865-8e94-708187eaf9f4","typeOfStateId":"state","$connId":"con_323","$id":"2dcbac91-64d2-4ccb-9f32-e2004343929e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5635f770-a2b5-4769-98bf-0688c27a73b1","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]}],"$leavingCustomActions":[{"$id":"beb72ee9-e004-40ba-acb1-7cc8deaefe3e","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"09f3494b-a751-4e29-99a2-7e61d5fc7608","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e22ff38c-8ab9-4617-820e-3462c58fbe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, smalltalks, statePreviousId) {\n  try {\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n          return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n          return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n      \n      // Removendo a validação de 90 dias\n      return `${formatDate(startDate)} - ${formatDate(endDate)}`; // Retorna as datas sem validação\n  } else {\n    return { error: 'extratoDataInvalida' };\n  }\n  \n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","SmallTalksIdentified","state.previous.id"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3fe1fa9d-e114-455c-a428-49e039096674","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-81081aa6-afe4-4c9d-9314-fd0269aa9c4c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ed6d98ed-2ebd-4ff2-b07a-b62148863be7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-7dc4d60c-96bc-4f7f-8700-3e46aa0342a5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b9cd4d9b-b0cd-482f-a81f-2a74c6ca2f2a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-014268df-4bf7-42b5-9703-23903ede44c9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-c1c8e913-61ff-4223-9792-1a44baad87db","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0fb18c4b-3d1a-4905-b922-197db4f5d1c8","root":false,"$title":"[Exceção][Extrato] Periodo superior a 2 anos","$position":{"top":"153px","left":"1780px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36276848-e740-4865-8e94-708187eaf9f4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a4d4d95-25b1-454f-9cdc-ef3b0b29b04f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"36276848-e740-4865-8e94-708187eaf9f4","root":false,"$title":"[GO TO] [E.3.0.0][SET] Periodo identificado","$position":{"top":"210.333px","left":"2029px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d656533c-7bf1-4c99-9309-c499e37ac1b4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"15c780e0-24f8-44e7-9144-6c6dba1df205","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"871d7bbd-2b33-4a84-b028-b6e692ed9510","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d656533c-7bf1-4c99-9309-c499e37ac1b4","root":false,"$title":"[GO TO][E.2.0.0] Pergunta periodo","$position":{"top":"361px","left":"2023px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d5a63910-77b8-414a-97ea-21e82114edd9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5b5edd6a-0a08-4d8f-b469-30a5f7be519c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d5a63910-77b8-414a-97ea-21e82114edd9","root":false,"$title":"[GO TO] Te ajudo em algo mais","$position":{"top":"1891px","left":"3305px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e92decba-2f27-4b5b-a0ec-c761214c6811":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5064a085-443c-419b-b25e-b6ffa7059ce0","typeOfStateId":"state","$connId":"con_328","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"e92decba-2f27-4b5b-a0ec-c761214c6811","root":false,"$title":"[Inicio] Posicao Investimento","$position":{"top":"272px","left":"4310px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"15a79232-ef1a-4238-9477-382cae383baf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76052a9b-f55c-4fd6-8ac8-da0510909330","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00","typeOfStateId":"state","$connId":"con_333","$id":"cb9cb40d-af26-4aeb-86d0-2dd147eb7fd5","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"email"}],"$invalid":false},{"stateId":"5215041d-b5f5-49eb-895c-0648cc1546a1","typeOfStateId":"state","$connId":"con_338","$id":"d6317b53-b402-4aa0-af65-27b8293d6b92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"036556d2-9bbe-4d55-9702-aacf808a6c86","$typeOfContent":"","type":"SetVariable","$title":"Set \"PossuiEmails\"","$invalid":false,"settings":{"variable":"PossuiEmails","value":"{{contact.email}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ab2c60fa-9288-4fe8-a368-f8a89347a3d7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"15a79232-ef1a-4238-9477-382cae383baf","root":false,"$title":"[PI.2.0.0][SET] Tem Email?","$position":{"top":"939px","left":"4307.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3c80ea3-9508-44e7-9d24-73fcd3780435","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba","typeOfStateId":"state","$connId":"con_343","$id":"a12de166-4304-4415-baa9-e63cee99fca5","conditions":[{"source":"context","comparison":"equals","values":["200","202","204"],"variable":"statusEnvioPosicaoInvestimento"}],"$invalid":false},{"stateId":"36730683-8874-4b01-af50-a78da194c2d1","typeOfStateId":"state","$connId":"con_348","$id":"58fdd2cd-584c-4153-98f9-9daa8fdaf332","conditions":[{"source":"context","comparison":"equals","values":["404"],"variable":"statusEnvioPosicaoInvestimento"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9b407411-0fbf-4259-9828-5dad272400f9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"79be6e3e-488c-4887-abc0-340af9124931","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusEnvioEmailInvestimento"}]},{"$id":"dce5fa17-2588-4453-af45-f3754ce37c50","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyPosicaoInvestimento\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, segmentCode, customerName) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\treturn {\n\t\t\t\"nome\": customerName,\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"segmento\": segmentCode\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","segmentCode","customerName"],"outputVariable":"bodyPosicaoInvestimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4d7fed09-e1f7-4511-b113-b441d4062ab7","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioPosicaoInvestimento","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/gerenciamento-investimentos/posicao-investimentos/assistente-virtual/v1/posicoes-investimentos/relatorios/enviar","responseStatusVariable":"statusEnvioPosicaoInvestimento","responseBodyVariable":"responseEnvioPosicaoInvestimento","body":"{{bodyPosicaoInvestimento}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-343dbb5e-45c6-4382-8199-003ea4600790","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ec3de69b-0ae9-486f-95c9-7e50827aa85a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-29f132bf-98c4-4656-912b-88bb0d84d8d4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8c82c232-44ee-4442-935a-d9edb107427d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00","root":false,"$title":"[PI.3.0.0][HTTP] Cockpit Envio Email","$position":{"top":"1097px","left":"4308px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba":{"$contentActions":[{"action":{"$id":"3ffa3499-b5f6-4813-ac8f-229e2a32e38a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"540fd19b-d231-4461-894a-9f85e590148e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"540fd19b-d231-4461-894a-9f85e590148e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dab25d29-83a8-4221-92fd-2f4ca5b23c37","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ee27f1c8-b8f9-4886-af69-c45e6bb7d862","type":"text/plain","content":"Enviei o PDF com essas informações no seu e-mail. Dá uma olhada lá, que te mandei agora.","metadata":{}},"$cardContent":{"document":{"id":"ee27f1c8-b8f9-4886-af69-c45e6bb7d862","type":"text/plain","content":"Enviei o PDF com essas informações no seu e-mail. Dá uma olhada lá, que te mandei agora."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"541d072d-0f81-462f-9dbf-461e52f1869d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","typeOfStateId":"state","$connId":"con_353","$id":"26541ff9-3045-4160-94e1-2e42afefb080","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"acd10bdc-5e59-477b-a444-9874bb17576a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c273f681-61a1-4350-80ca-3bf208335705","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-78ff2481-e1b1-4ee7-ac2a-a6021d523b13","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba","root":false,"$title":"[PI.3.0.1][MSG] Email Enviado","$position":{"top":"1317px","left":"4118px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62aec317-124c-4a6f-8eb5-347b96526b10":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"62aec317-124c-4a6f-8eb5-347b96526b10","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"826px","left":"4548px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"721152e9-4da1-4e8f-889c-f7edd710a8d5","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708"},"isAiGenerated":false,"$tags":[],"id":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","root":false,"$title":"[GO TO] Finalizacao","$position":{"top":"1478.5px","left":"4302.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"c6b1d835-f571-4c7a-975d-6e088158bc68":{"$contentActions":[{"action":{"$id":"953d30c2-836a-4e4f-8caa-f643dcef106f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"321c788b-6b3b-4b10-a4d9-03c491e0a9cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"321c788b-6b3b-4b10-a4d9-03c491e0a9cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0487808c-5f3b-4b84-b18c-5bf249875e03","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6f73761f-5d9e-4471-b3de-a683244cdd2e","type":"text/plain","content":"No momento, estamos enfrentando instabilidade em nosso sistema.","metadata":{}},"$cardContent":{"document":{"id":"6f73761f-5d9e-4471-b3de-a683244cdd2e","type":"text/plain","content":"No momento, estamos enfrentando instabilidade em nosso sistema."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"42212050-83b1-4709-b2c0-f3f04d64a522","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"526ec006-18a4-4ce8-94aa-4f740d45526b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"526ec006-18a4-4ce8-94aa-4f740d45526b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d8eaaa6-12ce-433f-bae8-475e764f1ae6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1f141b-f598-4b23-8fcf-f7c5863150ed","type":"text/plain","content":"Você pode tentar novamente mais tarde, vou te transferir em contato com seu gerente.","metadata":{}},"$cardContent":{"document":{"id":"ea1f141b-f598-4b23-8fcf-f7c5863150ed","type":"text/plain","content":"Você pode tentar novamente mais tarde, vou te transferir em contato com seu gerente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"480d7b51-2ec1-4aa9-bbec-0f3d5e9d269f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"e65ae042-2867-4005-9f6f-c24781ded992"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4ac5cd07-4eff-4947-9fc1-d49521f78919","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c6b1d835-f571-4c7a-975d-6e088158bc68","root":false,"$title":"[Exceção][API] Erro de API (generico)","$position":{"top":"327px","left":"1781px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"469e36b0-7e94-4c65-8b9e-4cab91f23487":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"451ffe67-c4d9-46d1-a6fe-516a8358f445","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e566e5e8-7dab-4252-8c8c-fd6e994b3d92","typeOfStateId":"state","$connId":"con_358","$id":"53fef6b0-defd-43a9-86ce-13620426a4b7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"469e36b0-7e94-4c65-8b9e-4cab91f23487","root":false,"$title":"[Inicio] Fatura do cartão","$position":{"top":"476px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55270663-c4fc-4407-8ac5-e859e7d9d5f0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"801a3e0f-86fa-456d-81ef-605719df9032","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"469e36b0-7e94-4c65-8b9e-4cab91f23487","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"55270663-c4fc-4407-8ac5-e859e7d9d5f0","root":false,"$title":"[GO TO] Fatura do cartao","$position":{"top":"3020px","left":"459px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b056c54-8b78-47f7-a632-a5c1e959642f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d1bca5c2-5488-439f-82e8-608821b7f9ff","typeOfStateId":"state","$connId":"con_363","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3688cb85-f2ae-4c26-baf0-1822644c1820","typeOfStateId":"state","$connId":"con_368","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"bd552257-7201-4ce6-abf3-fc2d61dc4c75","typeOfStateId":"state","$connId":"con_373","$id":"bc48ea37-4d95-41b5-b713-f1317e571aec","conditions":[{"source":"context","comparison":"equals","values":["zero"],"variable":"qtdCartoes"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\t// const cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoes.filter(cartao => cartao.funcao !== 'D' && Number(cartao.valorLimite) > 0 && cartao.titular == true)\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\tif(qtdCartoes == 0){\n\t\t\treturn 'zero'\n\t\t}\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"a2a360be-2aa9-460d-8da9-64c717044182","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusDadosCartao}} | {{bodyDadosCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3bc9e409-9029-4210-846a-1fbe995323ca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-042054ae-067a-4ba5-9658-c07c07adeb1b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-74bae18c-3699-4dab-b953-727870846cad","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4b056c54-8b78-47f7-a632-a5c1e959642f","root":false,"$title":"[FC.1.0.0] possui cartao?","$position":{"top":"790.765px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d1bca5c2-5488-439f-82e8-608821b7f9ff":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3688cb85-f2ae-4c26-baf0-1822644c1820","typeOfStateId":"state","$connId":"con_378","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Notei que você tem mais de um cartão.\nDe qual você precisa da fatura?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"62544c3d-12b0-4d22-9ed5-33000a9a8f28","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4bfd977b-31bb-4ab0-8f60-596150ba172c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fc9614fd-8db5-420a-bfaa-c8855a09df4f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5fb5251c-b762-427a-8640-1790877bca8e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-2ed112ca-b3e9-47ec-9f8b-58cf86c8aa84","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d1bca5c2-5488-439f-82e8-608821b7f9ff","root":false,"$title":"[FC.1.0.1] + 1 cartao","$position":{"top":"886px","left":"6015px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e566e5e8-7dab-4252-8c8c-fd6e994b3d92":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4b056c54-8b78-47f7-a632-a5c1e959642f","typeOfStateId":"state","$connId":"con_383","$id":"1363c31e-c9dd-4e99-9070-50ed442caec6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"OSADesligado"}],"$invalid":false},{"stateId":"4b056c54-8b78-47f7-a632-a5c1e959642f","typeOfStateId":"state","$connId":"con_388","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"17352244-c34b-44ff-a559-ffda621952ba","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"0a9d3079-e348-4c6c-9bc7-428f6e0b3333","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e71dd334-4838-41df-affc-bf88fca6f53b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"1b108629-49d4-40f9-9aa7-fbb79b3474fa","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_FATURA_CARTAO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"088bf1e0-a005-4875-9ca8-4f36d0a3c8a3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-767c8e12-b175-4c94-9a8f-fefaa81a4d84","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2e0e27a0-9428-430a-b88e-7ba887aa4d77","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b107b2bf-4b33-4d3f-83cf-c59c06fec9bf","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"e566e5e8-7dab-4252-8c8c-fd6e994b3d92","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"614px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3688cb85-f2ae-4c26-baf0-1822644c1820":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"144e0deb-79c9-41b2-bff3-47c22a4af2de","typeOfStateId":"state","$connId":"con_393","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6b2f2d43-66e8-4099-989b-20eedff16f3a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9bba8db-43ff-4fc4-a948-3ceba9b196a8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2262ebfb-ac9d-4ecc-a367-a68ee06c1933","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3688cb85-f2ae-4c26-baf0-1822644c1820","root":false,"$title":"[FC.1.0.3] dados cartao","$position":{"top":"975px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"144e0deb-79c9-41b2-bff3-47c22a4af2de":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0fb360e7-1896-439a-b583-1c0e36cce25a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","typeOfStateId":"state","$connId":"con_398","$id":"225bb4e1-4530-4aa0-b0ad-bedaa597fee0","conditions":[{"source":"context","comparison":"equals","values":["erro"],"variable":"faturasFechada"}],"$invalid":false},{"stateId":"45680e8a-4388-4d90-a3f1-f4d6c08701cd","typeOfStateId":"state","$connId":"con_403","$id":"30b3da72-e4c4-4f0b-8a48-f21f4fa1c2e9","conditions":[{"source":"context","comparison":"equals","values":["nao existe faturas fechada"],"variable":"faturasFechada"}],"$invalid":false},{"stateId":"80599c19-a325-43df-83d3-ea28215148be","typeOfStateId":"state","$connId":"con_408","$id":"f665beb3-a11e-4b58-bba0-f768e6b7dd7f","conditions":[{"source":"context","comparison":"notEquals","values":["nao existe faturas fechada"],"variable":"faturasFechada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9b85f98f-ec30-434c-87cf-1bf3d6a9a0e5","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6f17324f-3f33-4eb9-b2ab-a72f3e602e5a","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b6fdb7e-4c3e-4e01-97ce-c614b16d9b8a","$typeOfContent":"","type":"ProcessHttp","$title":"GET Fatura \"responseFatura\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"CHT","Authorization":"Bearer {{token}}","Safra-Bot-ID":"skillautenticacao"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes/{{finalCartao}}/faturas?view=RESUMOS","responseStatusVariable":"statusFatura","responseBodyVariable":"responseFatura"},"conditions":[]},{"$id":"bf56aaa1-fb47-4ae7-992e-43cb5ec17046","$typeOfContent":"","type":"ExecuteScript","$title":"faturasFechada","$invalid":false,"settings":{"function":"run","source":"const run = (faturas) => {\n\ttry {\n\t\tfaturas = JSON.parse(faturas).data.faturas\n\t\tconst faturasFechada = faturas.filter(fatura => fatura.status === \"Fechado\")\n\t\tif (faturasFechada.length == 0) return 'nao existe faturas fechada'\n\n\t\treturn faturasFechada.map(fatura => {\n\t\t\tfatura.valor = formatValue(fatura.valor)\n\t\t\treturn fatura\n\t\t})\n\t} catch (err) {\n\t\treturn \"erro\"\n\t}\n}\n\nfunction formatValue(valor) {\n        return `${\n                parseFloat(valor)\n                        .toFixed(2)\n                        .replace(\".\", \",\")\n                        .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")}`;\n}","inputVariables":["responseFatura"],"outputVariable":"faturasFechada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"26d10741-7014-4f81-a98d-68dde4652890","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"087498d5-aad6-4668-8a43-edc1135740ae","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusFatura}} | {{responseFatura}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-defc61d2-501e-48ef-89ee-264b58ed0856","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-3607a945-3fc2-48d5-9193-4d79d49baf2a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1e5e95fa-c741-49c6-98bf-b4e62086eaaf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"144e0deb-79c9-41b2-bff3-47c22a4af2de","root":false,"$title":"[FC.2.0.0] possui fatura?","$position":{"top":"1160px","left":"5773px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"45680e8a-4388-4d90-a3f1-f4d6c08701cd":{"$contentActions":[{"action":{"$id":"5e147fde-6a29-4758-82e1-93ec825b157c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2c8ce3f9-c264-4de6-a3ac-a57ee7118188","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2c8ce3f9-c264-4de6-a3ac-a57ee7118188","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"277d0e7c-c947-466b-af33-5a9ee04092ba","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d68780e3-5431-40cd-b656-57b28fc585f1","type":"text/plain","content":"O seu cartão com final *{{finalCartao}}* não tem faturas fechadas. Assim que a sua fatura fechar, você vai conseguir ver as informações aqui.","metadata":{}},"$cardContent":{"document":{"id":"d68780e3-5431-40cd-b656-57b28fc585f1","type":"text/plain","content":"O seu cartão com final *{{finalCartao}}* não tem faturas fechadas. Assim que a sua fatura fechar, você vai conseguir ver as informações aqui."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"135e3ef2-d7db-4b3c-ac40-5c2dd381d677","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2217518e-2b6e-41f2-b4d6-e32d34f691e0","typeOfStateId":"state","$connId":"con_413","$id":"46a1a658-395b-458e-8833-0de30ffbb914","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"cb9daaf9-00f4-44d3-b12c-f3ffa46e6487","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5f2e3612-93d3-43a2-a272-615d09f43c7e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d3c28074-afa1-40a5-85af-c3fc634f4018","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"45680e8a-4388-4d90-a3f1-f4d6c08701cd","root":false,"$title":"[FC.2.0.1] não possui fatura fechada","$position":{"top":"1147px","left":"6001px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"80599c19-a325-43df-83d3-ea28215148be":{"$contentActions":[{"action":{"$id":"11b1f560-1596-4c04-8c44-b59517b3ecf5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee612725-185c-4810-824b-37e99ff764ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee612725-185c-4810-824b-37e99ff764ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c90a002a-60b7-4da5-8ba6-e035539be126","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}\n"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c1deb80f-d9db-400e-9040-a19a687c2002","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3ebdf2d9-61e7-4334-b280-06466b167329","typeOfStateId":"state","$connId":"con_418","$id":"b6fdd9d4-4419-4e03-a78c-da2501297363","conditions":[{"source":"context","comparison":"notEquals","values":["erro"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48d58e13-cf0b-4933-a032-c57dcbb714da","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, faturas) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n        platform = 'blipchat';\n    \n    faturas = JSON.parse(faturas)\n\n    const meses = {\n        \"01\": \"Janeiro\",\n        \"02\": \"Fevereiro\",\n        \"03\": \"Março\",\n        \"04\": \"Abril\",\n        \"05\": \"Maio\",\n        \"06\": \"Junho\",\n        \"07\": \"Julho\",\n        \"08\": \"Agosto\",\n        \"09\": \"Setembro\",\n        \"10\": \"Outubro\",\n        \"11\": \"Novembro\",\n        \"12\": \"Dezembro\"\n    }\n\n    const text = `Por aqui, consigo te mostrar as 3 últimas faturas fechadas. De qual mês você quer ver?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    faturas.forEach((fatura, index) => {\n        const mes = fatura.dataVencimento.split(\"-\")[1]\n        const mesExtenso = meses[mes]\n        options.push(`${mesExtenso} - R$ ${fatura.valor}`);\n    });\n    faturas.forEach((fatura, index) => {\n        const data = fatura.dataVencimento.split(\"-\")\n        const dia = data[2]\n        const mes = data[1]\n        const ano = data[0]\n        description.push(`Vencimento - ${dia}/${mes}/${ano}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n    let words = text.split(\" \");\n\n    words = words.map(\n        (word) =>\n            word.length &&\n            `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n    );\n\n    return words.join(\" \");\n}","inputVariables":["bold","platform","faturasFechada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3411f1d-a156-4140-a5ef-21fe40832e3b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"08b2f556-9a69-4019-b10b-16e5587c9d02","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (faturas, input) => {\n\ttry {\n\t\tfaturas = JSON.parse(faturas)\n\t\tinput = JSON.parse(input)\n\t\tconst indexFatura = input.metadata[\"#wa.interactive.list.id\"] - 1;\n\t\tconst faturaEscolhida = faturas[indexFatura]\n\t\tif (faturaEscolhida) {\n\t\t\treturn faturaEscolhida\n\t\t}\n\t\treturn \"erro\"\n\t} catch (err) {\n\t\treturn \"erro\"\n\t}\n}","inputVariables":["faturasFechada","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1a4f5526-dd09-4327-9135-86f941aae5a9","$typeOfContent":"","type":"ExecuteScript","$title":"dataVencimento","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n\ttry {\n\t\tuserInput = JSON.parse(userInput)\n\n\t\treturn userInput.dataVencimento\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["userInput"],"outputVariable":"dataVencimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f5019cb-ac7c-48ce-88a7-d52057f681dd","$typeOfContent":"","type":"ExecuteScript","$title":"mesFatura","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n\treturn input.split('-')[0]\n}","inputVariables":["input.content"],"outputVariable":"mesFatura","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-23e9a900-55d9-44b3-b9fc-a1415e036cf0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-57245664-ac8d-473f-a5ad-283b997c3e93","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c918701e-804d-4010-bbe8-eff4ea9e105f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-71b84f0a-8f93-4424-a048-601033337db9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"80599c19-a325-43df-83d3-ea28215148be","root":false,"$title":"[FC.2.0.2] menu selecao de fatura","$position":{"top":"1299px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2e88b5e4-f472-4ace-a610-20adec4364f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","root":false,"$title":"[GO TO] transbordo employee","$position":{"top":"1192px","left":"5508px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3ebdf2d9-61e7-4334-b280-06466b167329":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"47048efa-3fc8-477e-bb3b-25d37c711e1e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e70e2e4-54e8-4272-bf41-56419b681b7e","typeOfStateId":"state","$connId":"con_423","$id":"cdaa5fc2-a0ed-4cf0-8826-e869a8be14ed","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0b5e9fbc-6151-4992-b24e-551155e1a2ff","$typeOfContent":"","type":"ProcessHttp","$title":"POST send PDF \"responsePDF\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"5d6a5c8a-e5a5-486d-835a-6dd13ac241bd","Safra-Aplicacao":"CHT","Safra-Bot-ID":"skillautenticacao","Content-Type":"application/json","Authorization":"Bearer {{token}}"},"method":"POST","body":"{\n  \"tipoPessoa\": \"F\",\n  \"documento\": \"{{document}}\",\n  \"numeroCartao\": \"{{finalCartao}}\",\n  \"dataVencimento\": \"{{dataVencimento}}\",\n  \"agencia\": \"{{agency}}\",\n  \"conta\": \"{{account}}\"\n}","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/faturas/enviar","responseStatusVariable":"statusPDF","responseBodyVariable":"responsePDF"},"conditions":[]},{"$id":"d5013813-9608-4790-af1e-0e7abe0181cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-34e03164-5238-4c33-9abe-027ff8c275c2","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-23ea7915-8094-4f14-a28f-64db04fc902b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3ebdf2d9-61e7-4334-b280-06466b167329","root":false,"$title":"[FC.2.0.3][HTTP] envia pdf","$position":{"top":"1443px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e70e2e4-54e8-4272-bf41-56419b681b7e":{"$contentActions":[{"action":{"$id":"674a9397-12c2-413b-98f7-ef616a568cfe","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7d7a9e15-fa7e-4501-8448-bb382e07aa95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7d7a9e15-fa7e-4501-8448-bb382e07aa95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"26c903a9-190b-4a52-b6a5-64981ed2d92d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f86a0d95-f15a-43a6-bf66-9fd00a2e194f","type":"text/plain","content":"Acabei de enviar no seu e-mail o PDF da fatura fechada de {{mesFatura}}","metadata":{}},"$cardContent":{"document":{"id":"f86a0d95-f15a-43a6-bf66-9fd00a2e194f","type":"text/plain","content":"Acabei de enviar no seu e-mail o PDF da fatura fechada de {{mesFatura}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5881d756-8534-4084-9875-e1f6c63de59f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9ab8a87-8c98-4058-88df-2f6fa26200b3","typeOfStateId":"state","$connId":"con_428","$id":"5bb0d7b6-8f35-4aad-9812-a94817b0f748","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"50a7c80c-6045-49a4-9e64-0be1eb0d6996","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f64fed0c-7d02-4c44-8b1f-b48d2d40ff01","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f7bcc6df-db75-4852-ae4c-a55e590289d8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e70e2e4-54e8-4272-bf41-56419b681b7e","root":false,"$title":"[FC.2.0.4][MSG] envio email","$position":{"top":"1577px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c9ab8a87-8c98-4058-88df-2f6fa26200b3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"799558ff-6be8-422c-a251-c0045bf39e1f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c9ab8a87-8c98-4058-88df-2f6fa26200b3","root":false,"$title":"[GO TO] Algo Mais","$position":{"top":"1718px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0abed19b-40e3-454c-bed3-c97f190fd32a":{"$contentActions":[{"action":{"$id":"4b063091-af65-4f11-ac3f-42755d3f7aa3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"eb4edc1d-67f1-438a-97b2-bb2bf38701a8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"eb4edc1d-67f1-438a-97b2-bb2bf38701a8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4578"},{"action":{"$id":"36ed1437-839c-48c5-a667-3b1b0b68627c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4931d1ab-a1be-4555-bfc2-ed92ff5544f2","type":"text/plain","content":"Key c2tpbGxhdXRlbnRpY2FjYW86QkJiODVuVzgwQkRTR1Y3dzUwamc=","metadata":{}},"$cardContent":{"document":{"id":"4931d1ab-a1be-4555-bfc2-ed92ff5544f2","type":"text/plain","content":"Key c2tpbGxhdXRlbnRpY2FjYW86QkJiODVuVzgwQkRTR1Y3dzUwamc="},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:4579"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7d4600a3-efdf-4eda-932e-b183cef0a4cf","type":"text/plain","textContent":"Entrada do usuário","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:4580"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5cd53ec9-66e0-4e7f-923b-f0072f05053c","$typeOfContent":"","type":"ExecuteScript","$title":"bodycartao","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn {\n    \"data\": [\n        {\n            \"nomePortador\": \"LUCAS LOPES\",\n            \"descricao\": \"CARTAO SAFRA VISA\",\n            \"funcao\": \"C\",\n            \"numero\": \"8015\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": true,\n            \"codigoSegmento\": \"0\",\n            \"dataEmbossamento\": \"2022-09-12\",\n            \"status\": \" \",\n            \"codigoTipo\": \"0270\",\n            \"codigoCorTipo\": \"00\",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \"M\",\n            \"diaCiclo\": \"26\",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 17400,\n            \"numeroConta\": \"4732700050728007\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 17400,\n            \"idProcessadora\": \"00000000\",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \" \"\n        },\n        {\n            \"nomePortador\": \"LUCAS LOPES\",\n            \"descricao\": \"CARTAO BANCARIO SAFRA VISA ELECTRON\",\n            \"funcao\": \"D\",\n            \"numero\": \"6119\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": true,\n            \"codigoSegmento\": \"0\",\n            \"dataEmbossamento\": \"2023-10-24\",\n            \"status\": \" \",\n            \"codigoTipo\": \"0018\",\n            \"codigoCorTipo\": \"18\",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \"M\",\n            \"diaCiclo\": \"00\",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 0,\n            \"numeroConta\": \"4790180490326002\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 0,\n            \"idProcessadora\": \"00000000\",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \" \"\n        },\n        {\n            \"nomePortador\": \"CAMILA PORTO LOPES\",\n            \"descricao\": \"CARTAO SAFRA VISA\",\n            \"funcao\": \"C\",\n            \"numero\": \"8049\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": false,\n            \"codigoSegmento\": \" \",\n            \"dataEmbossamento\": \" \",\n            \"status\": \" \",\n            \"codigoTipo\": \"0270\",\n            \"codigoCorTipo\": \" \",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \" \",\n            \"diaCiclo\": \" \",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 17400,\n            \"numeroConta\": \"4732700050728007\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 0,\n            \"idProcessadora\": \" \",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \"43699400875\"\n        }\n    ]\n}\n}","inputVariables":[],"outputVariable":"bodycartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8c5031e3-be72-4445-9552-dda221b2dedd","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn [\n    {\n        \"nomePortador\": \"LUCAS LOPES\",\n        \"descricao\": \"CARTAO SAFRA VISA\",\n        \"funcao\": \"C\",\n        \"numero\": \"8015\",\n        \"situacao\": \"A\",\n        \"bandeira\": \"V\",\n        \"titular\": true,\n        \"codigoSegmento\": \"0\",\n        \"dataEmbossamento\": \"2022-09-12\",\n        \"status\": \" \",\n        \"codigoTipo\": \"0270\",\n        \"codigoCorTipo\": \"00\",\n        \"motivoCancelamento\": \" \",\n        \"sexoPortador\": \"M\",\n        \"diaCiclo\": \"26\",\n        \"debitoAutomatico\": false,\n        \"valorLimite\": 17400,\n        \"numeroConta\": \"4732700050728007\",\n        \"codigoExibicao\": \"1\",\n        \"valorLimitePreAprovado\": 17400,\n        \"idProcessadora\": \"00000000\",\n        \"ofertaCartao\": false,\n        \"ordemExibicao\": 0,\n        \"cpfAdicional\": \" \"\n    }\n]\n}","inputVariables":[],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a849f179-6905-4375-9221-fafd66aee386","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"0abed19b-40e3-454c-bed3-c97f190fd32a","root":false,"$title":"21.10-14:00","$position":{"top":"0px","left":"274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"commentsIdList":["6d0f89c4-1a0f-40dc-ad21-629081da0e65"]}},"127757c2-0404-4ee1-887c-6b60d71a3a77":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0d31d7ba-ad81-4fbf-b835-8342e8f8f93e","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e92decba-2f27-4b5b-a0ec-c761214c6811","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"127757c2-0404-4ee1-887c-6b60d71a3a77","root":false,"$title":"[GO TO] Pos Invest","$position":{"top":"3035.5px","left":"939.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1376549f-3a8a-4f11-869e-1960f295a5ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6968e527-191a-4e18-a2d4-29bb29a4d1b8","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1376549f-3a8a-4f11-869e-1960f295a5ef","root":false,"$title":"[GO TO] Extrato","$position":{"top":"2970.33px","left":"1149.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5064a085-443c-419b-b25e-b6ffa7059ce0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","typeOfStateId":"state","$connId":"con_433","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","typeOfStateId":"state","$connId":"con_438","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_POSICAO_INVESTIMENTOS\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8e8bfa09-8f67-40e2-ad9c-9b39ef1d6c64","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5eab0292-90c5-4c6a-961f-ac78e2d4f3a5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d064180f-c631-4c63-a2ca-e8b2a93035c6","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5064a085-443c-419b-b25e-b6ffa7059ce0","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"419px","left":"4308.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b6390f47-bc7b-4c7a-9d19-4218a060ca2e","typeOfStateId":"state","$connId":"con_443","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d162fc53-23bb-4776-bf04-551bf8cfbdb0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1d1cedcf-c130-424d-99ee-11cadc81ddc1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-81149cca-ab60-46ac-a92d-1091f3710b04","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6045f5ac-9e59-49cb-a4c9-7395d58c2a09","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","root":false,"$title":"[PI.1.0.0][MSG] Inicio Posicao Investimento","$position":{"top":"579px","left":"4308.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5aba1012-65f4-4562-9aa9-419d0b772741":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_448","$id":"ac43fe69-3261-440c-b31c-b0487bbf3412","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_453","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_EXTRATO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d9d05903-c6e6-4594-aaff-d7c6ac804cc8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-be0c03b5-7b73-4789-a234-dbcf48417465","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-24cd92d5-4ed0-4a52-9f51-89cb2ba71263","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5aba1012-65f4-4562-9aa9-419d0b772741","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"615px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36730683-8874-4b01-af50-a78da194c2d1":{"$contentActions":[{"action":{"$id":"e10d710c-6594-4765-934f-318f3b430de7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1e96f9d6-a837-4f98-a24c-1f8ce4b090ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1e96f9d6-a837-4f98-a24c-1f8ce4b090ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"791c5e88-1c1c-46bd-b39a-32c6db5612c0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a20261cc-8e37-41aa-bcf9-45e4702d018d","type":"text/plain","content":"Não consegui encontrar nenhum histórico de posição de investimento.","metadata":{}},"$cardContent":{"document":{"id":"a20261cc-8e37-41aa-bcf9-45e4702d018d","type":"text/plain","content":"Não consegui encontrar nenhum histórico de posição de investimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"99a60ed7-9825-4e76-8c67-4495e4c58979","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","typeOfStateId":"state","$connId":"con_458","$id":"fe88d63f-39a3-4b38-8086-c26256ee2bff","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fa916ccc-3cb7-453e-a856-9438ed25754e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-02d9681b-2bb2-4fe3-adfd-0f65f004aa70","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4d062241-9268-4cc3-b128-d552bdc20a9c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"36730683-8874-4b01-af50-a78da194c2d1","root":false,"$title":"[PI.3.1.3][MSG] Não Encontrou","$position":{"top":"1322px","left":"4490.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3f739f15-0056-45e3-89b4-29d2ae4d3efa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2f815a99-f5ce-4b32-88b8-ffbb00e96f20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3f739f15-0056-45e3-89b4-29d2ae4d3efa","root":false,"$title":"[GO TO]Employee Finalizacao","$position":{"top":"292.286px","left":"2987.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b6390f47-bc7b-4c7a-9d19-4218a060ca2e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"15a79232-ef1a-4238-9477-382cae383baf","typeOfStateId":"state","$connId":"con_463","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"62aec317-124c-4a6f-8eb5-347b96526b10","typeOfStateId":"state","$connId":"con_468","$id":"21d715be-894a-4854-85b9-95921a90912d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b6ca16d6-f0e6-4ae6-904d-1ba236e2dd91","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dbf48a14-1a24-47b1-a08b-b18624f90848","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f94c35c1-f27a-423b-a919-82ef09dffe44","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-384d8265-0668-4e9e-bdc9-4161bc7ca0c0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-56b6edec-871f-43b9-986c-70f2f2db4e5e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b6390f47-bc7b-4c7a-9d19-4218a060ca2e","root":false,"$title":"[PI.1.0.0][INPUT] Inicio Posicao Investimento","$position":{"top":"761.5px","left":"4308.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5215041d-b5f5-49eb-895c-0648cc1546a1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76052a9b-f55c-4fd6-8ac8-da0510909330","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62aec317-124c-4a6f-8eb5-347b96526b10","typeOfStateId":"state","$connId":"con_473","$id":"d6317b53-b402-4aa0-af65-27b8293d6b92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9491f50b-ca70-4363-8536-39a65005c827","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-48daf53f-20e9-4386-a6fc-18d248c3b3b0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5215041d-b5f5-49eb-895c-0648cc1546a1","root":false,"$title":"[PI.2.0.1]Não Possui Email","$position":{"top":"1001px","left":"4548px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2217518e-2b6e-41f2-b4d6-e32d34f691e0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"428fa2de-56e5-430c-a2ce-ae1bf665af89","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2217518e-2b6e-41f2-b4d6-e32d34f691e0","root":false,"$title":"[GO TO] Te ajudo em algo mais ","$position":{"top":"1326px","left":"5999px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cdd34564-0396-44f2-a37d-978173c3889d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5bdb5b0d-6df3-4f4a-a41b-fd66aaa0f6d2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"257f1171-0297-4b48-8a1c-89a7959b201f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"cdd34564-0396-44f2-a37d-978173c3889d","root":false,"$title":"[GO TO] Em que posso ajudar? ","$position":{"top":"2953px","left":"177px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"329bc5fc-e554-4d1f-865b-1a858c603a5b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a9602b1-d07e-43c2-9161-3649457eab05","typeOfStateId":"state","$connId":"con_478","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"329bc5fc-e554-4d1f-865b-1a858c603a5b","root":false,"$title":"[Inicio] Status de entrega (Tracking cartão)","$position":{"top":"481.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8a9602b1-d07e-43c2-9161-3649457eab05":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","typeOfStateId":"state","$connId":"con_483","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","typeOfStateId":"state","$connId":"con_488","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_RASTREIO_CARTAO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c03cb467-6441-4ab1-8281-81219d9acd5b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f2403eb7-a422-478e-a1ac-d1b0e4ffe0c5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-019691ba-17c9-47cb-a58d-0470113ac648","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"8a9602b1-d07e-43c2-9161-3649457eab05","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"669.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer acompanhar o status de entrega do cartão, certo?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer acompanhar o status de entrega do cartão, certo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a69b80a8-332b-4300-b3f4-728077b1e9e8","typeOfStateId":"state","$connId":"con_493","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","typeOfStateId":"state","$connId":"con_498","$id":"5596a3bd-f403-4093-8fdc-9f64ac7364d6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"358c4d79-4df5-4017-ae25-c47880069f49","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} smalltalk\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} smalltalk","action":"{{input.content}} | {{SmallTalksIdentified}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-48124dd1-6a8e-47f2-a0b7-fc477628b46c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-120459a7-4312-46a2-804d-f643dcbecc2f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ec1c514c-68de-4dfe-a4df-912b650ae66d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-59fe09fb-aa7b-40b6-a4a9-06bbb427ac8c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-1ad7f86d-98d3-4d04-83ee-1753d555975e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","root":false,"$title":"[TC.1.0.0] Inicio Status Entrega Cartão","$position":{"top":"870.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a69b80a8-332b-4300-b3f4-728077b1e9e8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2a9eb715-b6b9-44e9-97b3-e07e68158a77","typeOfStateId":"state","$connId":"con_503","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","typeOfStateId":"state","$connId":"con_508","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","typeOfStateId":"state","$connId":"con_513","$id":"cf47ca1d-f27f-44c8-ad64-3b14336dbd8a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4f03222c-f367-4c2c-b32e-04057918a290","$typeOfContent":"","type":"SetVariable","$title":"CLEAR qtdCartoes","$invalid":false,"settings":{"variable":"qtdCartoes"},"conditions":[]},{"$id":"ce913fdb-a682-48fc-a49d-d64da00eae80","$typeOfContent":"","type":"SetVariable","$title":"CLEAR cartoes","$invalid":false,"settings":{"variable":"cartoes"},"conditions":[]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\treturn cartoes.filter(cartao => cartao.situacao == 'P' || cartao.situacao == 'I')\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\tif(qtdCartoes == 0){\n\t\t\treturn 'zero'\n\t\t}\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"85861d9d-bb03-4c24-9c67-5424fe9e5cfb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusDadosCartao}} | {{bodyDadosCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c0ef6f5d-e883-4a9f-ba59-9649fb4888cf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7d6601eb-fc02-47b9-b72c-f3fd042ebe11","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-05b1bf49-f622-435a-a96c-e99e00b7b996","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d33c577a-8ac2-4167-bba3-d9c92e9d417c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"a69b80a8-332b-4300-b3f4-728077b1e9e8","root":false,"$title":"[TC.2.0.0] possui cartao?","$position":{"top":"1115px","left":"6778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2a9eb715-b6b9-44e9-97b3-e07e68158a77":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","typeOfStateId":"state","$connId":"con_518","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"OLD","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\") {\n        platform = 'blipchat';\n    }\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `De qual cartão você quer ver o andamento da entrega?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0, 6)\n        const cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        options.push(`${cartaoInfo[0].nomeComercial}`);\n\n    });\n    cartoes.forEach((cartao, index) => {\n        cartao.titular = cartao.titular ? \"Titular\" : \"Adicional\"\n        description.push(`${cartao.nomePortador.split(' ')[0]} - ${cartao.titular} - Final ${cartao.numero}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n    let words = text.split(\" \");\n\n    words = words.map(\n        (word) =>\n            word.length &&\n            `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n    );\n\n    return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"OLD","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"891af007-b02b-499d-8e00-2110df18e241","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, bin) => {\n\ttry {\n\t\tlet { header, body, action } = menu(cartoes, bin);\n\t\treturn buildWhatsApp(header, body, action);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nconst buildWhatsApp = (header, body, action) => {\n\treturn {\n\t\t'type': 'application/json',\n\t\t'content': {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": header,\n\t\t\t\t\"body\": body,\n\t\t\t\t\"action\": action\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst menu = (cartoes, bin) => {\n\tbin = JSON.parse(bin)\n\tcartoes = JSON.parse(cartoes);\n\tlet options = [];\n\tlet description = []\n\tlet objOpcoes = [];\n\tcartoes.forEach((cartao, index) => {\n\t\tconst cartaoBin = cartao.numeroConta.substr(0, 6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n\t\tcartao.titular = cartao.titular ? \"Titular\" : \"Adicional\"\n\t\tobjOpcoes.push({\n\t\t\t\"id\": `${cartao.numero}`,\n\t\t\t\"title\": `${cartaoInfo[0].nomeComercial.substring(0, 24)}`,\n\t\t\t\"description\": `${cartao.nomePortador.split(' ')[0]} - ${cartao.titular} - Final ${cartao.numero}`\n\t\t})\n\t});\n\n\tlet textMenu = \"De qual cartão você quer ver o andamento da entrega?\"\n\treturn {\n\t\t\"body\": {\n\t\t\t\"text\": textMenu\n\t\t},\n\t\t\"action\": {\n\t\t\t\"button\": \"Escolher cartão\",\n\t\t\t\"sections\": [\n\t\t\t\t{\n\t\t\t\t\t\"rows\": objOpcoes\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n};","inputVariables":["cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3dee8925-bfa3-4088-b9ac-b42a1cb6711a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tconst jsonData = JSON.parse(input);\n\tinput = jsonData.metadata['#wa.interactive.list.id'];\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a8630a87-0647-4bd1-b852-2a7b8ec458c7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b4e7caf8-0e00-474e-8d2e-a66c092b9080","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d5c0faf5-956d-4305-be67-855d10c5a37d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-4feb3390-9146-484d-a35a-548aa5e39bca","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2a9eb715-b6b9-44e9-97b3-e07e68158a77","root":false,"$title":"[TC.2.0.1] + 1 cartao","$position":{"top":"1231px","left":"6984px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1f4c4ef1-3207-4427-b309-8b8737f683db","typeOfStateId":"state","$connId":"con_523","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"815d152c-844b-4d3f-bb12-26b7453fb53d","$typeOfContent":"","type":"ExecuteScript","$title":"dadosCartao","$invalid":false,"settings":{"function":"run","source":"function run(cartoes, finalCartao, bin) {\n\ttry {\n\t\tlet data = JSON.parse(cartoes);\n\t\tbin = JSON.parse(bin);\n\t\tlet filteredData = data.filter(card => card.numero == finalCartao);\n\t\tfilteredData = filteredData.map(card => {\n\t\t\tswitch (card.funcao) {\n\t\t\t\tcase 'M':\n\t\t\t\t\tcard.funcao = 'débito e crédito';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tcard.funcao = 'débito';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'C':\n\t\t\t\t\tcard.funcao = 'crédito';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn card;\n\t\t});\n\n\t\tlet cartao = filteredData[0];\n\t\tlet cartaoBin = cartao.numeroConta.substr(0, 6)\n\t\tlet cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n\t\tcartao.descricao = `${cartaoInfo[0].nomeComercial}`;\n\t\treturn cartao;\n\n\t}\n\tcatch (error) {\n\t\treturn error.message;\n\t}\n}\n","inputVariables":["cartoes","finalCartao","resource.binNomesCartao"],"outputVariable":"dadosCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1259dd8a-a07b-4d3e-8329-7677e6986260","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f8099743-92db-4cff-898d-9049d39cdbdb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-53a48e2f-ea08-43cf-a4ed-4230230c6f66","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","root":false,"$title":"[TC.2.0.3] dados cartao","$position":{"top":"1337px","left":"6778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f4c4ef1-3207-4427-b309-8b8737f683db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6a31ac9-d06c-4b92-a222-6828bdee783f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"f6d9f432-19f6-49f1-b611-9337a4410be1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ba80368d-d7c9-4705-ad98-dbbc1b490083","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"ba80368d-d7c9-4705-ad98-dbbc1b490083","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"3310b47e-0e8a-4aa2-9a40-835963200ff9","typeOfStateId":"state","$connId":"con_528","$id":"34d05073-ad3d-4e49-8f9d-bcb16671cebd","conditions":[{"source":"context","comparison":"equals","values":["95"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"f59664df-7729-4589-81fb-7c048d04fb27","typeOfStateId":"state","$connId":"con_533","$id":"4197b936-bdad-4c22-ba6a-c97eb2ede938","conditions":[{"source":"context","comparison":"equals","values":["96"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"5716fc03-71b2-4648-a278-7f638cf06567","typeOfStateId":"state","$connId":"con_538","$id":"b364a870-e2e0-4132-a7e4-a56d03b8ea07","conditions":[{"source":"context","comparison":"equals","values":["98"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"ce332aaf-0e6e-4a29-9b7a-c2bae4f25909","typeOfStateId":"state","$connId":"con_543","$id":"809feec5-6d9c-4e9b-9c8d-f23001e62647","conditions":[{"source":"context","comparison":"equals","values":["91"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"7241083e-dc56-44e1-87ba-041f6c7b305b","typeOfStateId":"state","$connId":"con_548","$id":"00f41fd6-10e5-4df6-b293-cccb28c58bb0","conditions":[{"source":"context","comparison":"equals","values":["92"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"7cb8bd6b-f7b5-49c9-ad64-8696249dcf0f","typeOfStateId":"state","$connId":"con_553","$id":"a9efa47b-e705-4050-93bc-9d8eec16bc1d","conditions":[{"source":"context","comparison":"equals","values":["97","90","89"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"5d4d5550-6eed-4b47-838d-eee09a11e45d","typeOfStateId":"state","$connId":"con_558","$id":"c64fab22-0a52-4418-bfe5-04d520cc5c73","conditions":[{"source":"context","comparison":"equals","values":["93"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"5b6a08e9-04f6-41c0-b5e0-09c686d90de4","typeOfStateId":"state","$connId":"con_563","$id":"93f9918f-bcd9-45aa-b9e9-b9abe8c29e32","conditions":[{"source":"context","comparison":"equals","values":["94"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"83674938-6816-4e1a-a74b-3b7b5c7f6492","typeOfStateId":"state","$connId":"con_568","$id":"41c63b94-0b34-4865-961a-1f7139dc5222","conditions":[{"source":"context","comparison":"equals","values":["99"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"3db6d61b-3876-42ab-8dc8-9f9de25a369e","typeOfStateId":"state","$connId":"con_573","$id":"9d3985ec-886f-41ad-8a15-2635e5001dec","conditions":[{"source":"context","comparison":"equals","values":["88"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"821770d1-280a-41c6-9846-1e004ad37f12","typeOfStateId":"state","$connId":"con_578","$id":"23abef87-c881-42c4-a721-57478b43fd7d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c0fdf284-b11c-4a9d-8a89-94bc59c1cc91","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9fe83c7a-a9a6-417c-9b3d-ab726c11859b","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"f99def29-777b-4d31-9423-50499e73c6ba","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80c455ba-c02a-432d-ab3d-8237ff30be4a","$typeOfContent":"","type":"ProcessHttp","$title":"dados rastreio cartao \"bodyRastreioCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes/{{finalCartao}}?view=RASTREIO","responseStatusVariable":"statusRastreioCartao","responseBodyVariable":"bodyRastreioCartao"},"conditions":[]},{"$id":"84baccad-0c9f-4f44-b0cb-24105a86424f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ultimoCodigoRastreio\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(response) {\n\ttry {\n\t\tresponse = JSON.parse(response);\n\t\tconst ultimoCodigoStatus = response.data.rastreio.slice(-1)[0].codigoStatus;\n\t\treturn ultimoCodigoStatus;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyRastreioCartao"],"outputVariable":"ultimoCodigoRastreio","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bf62e6f0-4809-497a-9f0a-bd4c7f587307","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"529cd89c-6e07-46a1-9b9a-17f0a907f92e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusRastreioCartao}} | {{bodyRastreioCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7864c5f0-2abe-49ff-97fb-e19e205b2adb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-07234a0e-3dfe-4cb2-8f00-2e6b6574a02f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-92e3d22b-ea31-4d4f-a582-a88daec8d9b2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-50f2f112-f044-449e-b53e-423ee33789a3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1f4c4ef1-3207-4427-b309-8b8737f683db","root":false,"$title":"[TC.3.0.0] Valida Status do Cartao","$position":{"top":"1521px","left":"6778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"979px","left":"7058px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"3310b47e-0e8a-4aa2-9a40-835963200ff9":{"$contentActions":[{"action":{"$id":"c77ac296-bf20-407c-a354-9c8b92903126","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"036d8206-fa6f-493b-8e2f-e7ac8b3daccc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"036d8206-fa6f-493b-8e2f-e7ac8b3daccc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"131d768a-2ac6-4e97-8880-952763e5bbc3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"37e4d64f-6937-45c5-9f93-fb76c849a32e","type":"text/plain","content":"Já recebemos o seu pedido do cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final <b>{{dadosCartao@numero}}</b>. Em breve, ele vai ser emitido.","metadata":{}},"$cardContent":{"document":{"id":"37e4d64f-6937-45c5-9f93-fb76c849a32e","type":"text/plain","content":"Já recebemos o seu pedido do cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final <b>{{dadosCartao@numero}}</b>. Em breve, ele vai ser emitido."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2c62e1f2-a4e9-4659-a2e2-7aa213321322","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1ebc7453-6c14-4182-8054-a581e400c711","typeOfStateId":"state","$connId":"con_583","$id":"fc301a55-4e16-4923-b389-fa278009a9b2","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","typeOfStateId":"state","$connId":"con_588","$id":"2e0c5f59-be42-4d22-a240-eae921e7f6c0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9655b546-ca1c-4d6f-a44a-7e91dc76541a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ced33bea-720f-4cd1-aaf8-5e41cf8bdb46","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5774b0ba-333e-439c-8f23-8d9f239d976a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3310b47e-0e8a-4aa2-9a40-835963200ff9","root":false,"$title":"[TC.3.1.0] 95 - Solicitado","$position":{"top":"1881.5px","left":"6233px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f59664df-7729-4589-81fb-7c048d04fb27":{"$contentActions":[{"action":{"$id":"b45805f6-723e-4a7e-8a01-e71b09dac19d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"929b727a-49cb-4401-bcd2-65dbb66a9ec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"929b727a-49cb-4401-bcd2-65dbb66a9ec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a045f929-0270-4539-8d70-bc5065d6c74d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2e33f7af-92a7-4e60-9734-06fbb59000f4","type":"text/plain","content":"O seu cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final\n<b>{{dadosCartao@numero}}</b>, já foi emitido. Em breve, ele vai chegar até você.","metadata":{}},"$cardContent":{"document":{"id":"2e33f7af-92a7-4e60-9734-06fbb59000f4","type":"text/plain","content":"O seu cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final\n<b>{{dadosCartao@numero}}</b>, já foi emitido. Em breve, ele vai chegar até você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d0168f74-25b5-4793-84e6-9992f82c6067","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1ebc7453-6c14-4182-8054-a581e400c711","typeOfStateId":"state","$connId":"con_593","$id":"d66cbe54-ead2-4c02-9be1-c7d4592d1cc3","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","typeOfStateId":"state","$connId":"con_598","$id":"3d939de6-d44d-4fb7-90a3-04623940e3ed","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7de3132f-f35d-4187-882a-16beec8476d8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-695d75e0-4176-45a7-9fb7-33058cce3ffd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dcca7ab9-32fe-4d24-bac4-baec033f015d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f59664df-7729-4589-81fb-7c048d04fb27","root":false,"$title":"[TC.3.2.0] 96 - Em Producao","$position":{"top":"1895px","left":"6457px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5716fc03-71b2-4648-a278-7f638cf06567":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_603","$id":"a73c3432-fcf3-4bd5-8096-21500a3cce90","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_a_caminho\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3219cbb-440a-4dfd-919a-a16fa549aac0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7403862b-c1b1-4c4c-a5a2-6d120cf1b987","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-834d7df5-bb47-43fc-b764-5dad42b5cb87","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-30983e3a-fbd3-4f09-b3a0-0d2ecb5eac81","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5716fc03-71b2-4648-a278-7f638cf06567","root":false,"$title":"[TC.3.3.0] 98 - Em Entrega","$position":{"top":"1892px","left":"6650px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"821770d1-280a-41c6-9846-1e004ad37f12":{"$contentActions":[{"action":{"$id":"aa794c34-d8fd-411a-94dd-3d3d36c2202b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b104476c-dd56-4da0-b273-b1d827bf981d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b104476c-dd56-4da0-b273-b1d827bf981d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"84a34a20-cbe8-4d3b-803d-254a16095455","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3b3c9d16-86bc-4c04-86a1-c068f906221d","type":"text/plain","content":"Não estou conseguindo encontrar o status de entrega do cartão, aguarde um momento..","metadata":{}},"$cardContent":{"document":{"id":"3b3c9d16-86bc-4c04-86a1-c068f906221d","type":"text/plain","content":"Não estou conseguindo encontrar o status de entrega do cartão, aguarde um momento.."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cd4c973-93ae-4ef1-afc5-8d5cb0cfa14b","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a787b34e-ae30-4285-af48-0d9c1855fa71","typeOfStateId":"state","$connId":"con_608","$id":"62780529-70e3-47d2-9c13-015f42be7547","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1c968f8d-406e-4642-a20a-9b0c0975cd0a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a7284783-c596-4610-bc23-c4b3687ea4d1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5b067ef1-4e7a-4bfb-8352-9daf348ecc98","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"821770d1-280a-41c6-9846-1e004ad37f12","root":false,"$title":"[TC.3.0.1] Status não encontrado","$position":{"top":"1922px","left":"8171.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a787b34e-ae30-4285-af48-0d9c1855fa71":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"a787b34e-ae30-4285-af48-0d9c1855fa71","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"1933px","left":"8383.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"3c5e78b8-d507-439e-a6b7-247f8e239fdd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"94a1a7d4-e542-40ad-b433-dc10d272a236","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","root":false,"$title":"[GO TO] Te ajudo em algo mais?","$position":{"top":"2118.5px","left":"6519px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1ebc7453-6c14-4182-8054-a581e400c711":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"84b08aa5-6fba-451c-9023-849fe9fdf128","typeOfStateId":"state","$connId":"con_613","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ver outro cartão\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Você quer ver o andamento de entrega de algum outro cartão que listei?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-616d401f-88da-4401-9d7e-0d1027498eb4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b6ea647e-0eaa-48db-be40-511f06814632","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1c25b877-66eb-470d-808f-b0689aad3b39","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1ebc7453-6c14-4182-8054-a581e400c711","root":false,"$title":"[TC.3.1.1] Mais de um cartão","$position":{"top":"2095.25px","left":"6261.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"84b08aa5-6fba-451c-9023-849fe9fdf128":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","typeOfStateId":"state","$connId":"con_618","$id":"a3c52f71-5933-4c0b-b4cb-cc845826a08a","conditions":[{"source":"context","comparison":"equals","values":["Finalizar"],"variable":"userInput"}],"$invalid":false},{"stateId":"c3a0caea-2e69-4d42-8122-c06b7bf5efdf","typeOfStateId":"state","$connId":"con_623","$id":"89912912-cdb2-4721-8d86-dea3b33bde0b","conditions":[{"source":"context","comparison":"equals","values":["Ver outro cartão"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-47d8dd6b-f690-4f5c-b419-e65bbc6f45c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8d23beba-163d-4f68-b76a-615b12a9313d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1232ac9d-8f6c-4221-ae42-37056b284b4a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4c595dd8-d39c-46a8-be0b-2b95d544e972","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"84b08aa5-6fba-451c-9023-849fe9fdf128","root":false,"$title":"[TC.3.1.1] [INPUT] Mais de um cartão","$position":{"top":"2289.86px","left":"6262.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c3a0caea-2e69-4d42-8122-c06b7bf5efdf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6756a285-a76a-48f1-8928-12ed7e3d03ad","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a69b80a8-332b-4300-b3f4-728077b1e9e8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c3a0caea-2e69-4d42-8122-c06b7bf5efdf","root":false,"$title":"[GO TO] [TC.2.0.0] possui cartao?","$position":{"top":"2460px","left":"6261.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ce332aaf-0e6e-4a29-9b7a-c2bae4f25909":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_628","$id":"f8478bd9-b009-4f64-9d10-cd6e95eaeb36","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"\nfunction run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_primeira_tentativa\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12a08ccc-82c0-4313-90a7-6588fefe1f50","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-628e9bac-ff47-4f77-85ee-7f91a20ee6f7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-142bdea9-4c02-4016-ac13-79a21f38b30c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f086dada-0ca0-4c21-8ee0-23a944d0d2c0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ce332aaf-0e6e-4a29-9b7a-c2bae4f25909","root":false,"$title":"[TC.3.4.0] 91 - Tentativa de Entrega 1","$position":{"top":"1891px","left":"6838px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7241083e-dc56-44e1-87ba-041f6c7b305b":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_633","$id":"d827a289-c6c8-4baf-aac9-56d7d3b33af4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"\nfunction run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_segunda_tentativa\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f48091a0-7e88-4acb-8e45-2973df4a81c6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3bb295ee-0cf4-498a-af85-02a8bdc972aa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-79f52ef4-7a71-43f4-ac13-0a699dcb620f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f0be90d3-26fa-4b32-b497-6742657d262c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7241083e-dc56-44e1-87ba-041f6c7b305b","root":false,"$title":"[TC.3.5.0] 92 - Tentativa de Entrega 2","$position":{"top":"1895px","left":"7022px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7cb8bd6b-f7b5-49c9-ad64-8696249dcf0f":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_638","$id":"c7c63bb7-c8f2-4320-a647-62d652c1b17f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"\nfunction run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_foi_entregue\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b0e93dc5-d434-49db-a8c2-576fd502a459","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-958efaaa-95ec-4a80-98db-835bc6810e98","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fb112f2e-ef8b-4128-aab9-c8386fe44182","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6643d0b7-6ca5-4b6e-a145-c266773685b0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7cb8bd6b-f7b5-49c9-ad64-8696249dcf0f","root":false,"$title":"[TC.3.6.0] 97-90-89 - Entregue","$position":{"top":"1899px","left":"7210px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d4d5550-6eed-4b47-838d-eee09a11e45d":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_643","$id":"6560169d-7fdc-4285-b5a8-532d4ee21d4f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Fizemos a última tentativa de entrega do seu cartão *${dadosCartao.descricao}* na\nfunçao de *${dadosCartao.funcao}* com final *${dadosCartao.numero}*, mas nao tinha ninguem no endereço.\n\nVocê quer continuar por aqui ou posso finalizar o atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7bbffe1b-7cdf-4006-b108-35ed13fe6e20","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ee3957d2-e926-44d4-ad36-71317e74a522","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-11018ef3-5c2d-4e34-b6db-758767147b65","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5d4d5550-6eed-4b47-838d-eee09a11e45d","root":false,"$title":"[TC.3.7.0] 93 - Tentativa de Entrega 3","$position":{"top":"1904px","left":"7393px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5b6a08e9-04f6-41c0-b5e0-09c686d90de4":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_648","$id":"c64e3f7d-b976-4c06-972e-a7c9ee74f89b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Fizemos uma tentativa de entrega do seu cartao *${dadosCartao.descricao}* na função de\n*${dadosCartao.funcao}* com final *${dadosCartao.numero}*, mas nao conseguimos. Vou precisar revisar o seu endereço\nde entrega.\n\nVoce quer continuar por aqui ou posso finalizar seu atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd2357f8-e836-476d-8ec5-35f436bcdd46","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-faddbdce-6499-4a93-9689-dd8770e4d4a1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ef648f5c-d99c-471a-8162-27aa8ac2f57e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5b6a08e9-04f6-41c0-b5e0-09c686d90de4","root":false,"$title":"[TC.3.8.0] 94 - Revisar endereco entrega","$position":{"top":"1909px","left":"7587.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"83674938-6816-4e1a-a74b-3b7b5c7f6492":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_653","$id":"cb7266a2-3630-473e-a515-75404e2dcee2","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Não conseguimos entregar seu cartão *${dadosCartao.descricao}* na função de *${dadosCartao.funcao}* com final\n*${dadosCartao.numero}*. Preciso analisar melhor essa situação.\n\nVocê quer continuar por aqui ou posso finalizar seu atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9cddebdf-35db-44b6-abb2-c947586842c1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bbfebeaf-41c6-4765-8a25-8a2915173903","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3e1fdd94-be39-4539-acad-e8e37962a7fe","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"83674938-6816-4e1a-a74b-3b7b5c7f6492","root":false,"$title":"[TC.3.9.0] 99 - Não entregue","$position":{"top":"1916.67px","left":"7787.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3db6d61b-3876-42ab-8dc8-9f9de25a369e":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_658","$id":"ddf20f6c-90f6-4c5c-8b25-86cf90174b6c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `O seu cartão *${dadosCartao.descricao}* na função de *${dadosCartao.funcao}* com final *${dadosCartao.numero}* não foi\nentregue. Preciso analisar melhor essa situação.\n\nVocê quer continuar por aqui ou posso finalizar seu atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cd541764-1118-4866-88e1-bfe3e9dc35d1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-95c13dc6-fc26-4a50-b318-dfb04f8f078d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b67a2c06-760e-4b31-b826-c141a4f94230","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3db6d61b-3876-42ab-8dc8-9f9de25a369e","root":false,"$title":"[TC.3.10.0] 88 - Extraviado","$position":{"top":"1918.33px","left":"7973px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"670c9a1f-3128-491e-bc7c-c2ddf2041f4e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a0243a75-a5ef-42bd-a8b4-ee82b0c5e2db","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ba3da958-10db-4e8c-8254-3b9c4914569e","typeOfStateId":"state","$connId":"con_663","$id":"01f47c2e-d39e-447d-8f65-33400411dc1a","conditions":[{"source":"context","comparison":"equals","values":["Continuar por aqui"],"variable":"userInput"}],"$invalid":false},{"stateId":"f9104304-1199-4675-8374-430655df0b48","typeOfStateId":"state","$connId":"con_668","$id":"1f63ac2d-d655-46c8-8f5d-0a08680045dd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9ccf4ca5-113c-4170-8048-1e0b3dea35f4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"eba384e3-b60f-4779-8ca1-f7d3205821c3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n    try {\n        if (!inputUsuario) return 'inatividade'\n\n        const options = {\n            \"^((1|primeir[oa]|finalizar))$\": \"Finalizar\",\n            \"^((2|segund[ao]|continuar por aqui))$\": \"Continuar por aqui\"\n        }\n\n        inputUsuario = inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")\n\n        for (let regex in options) {\n            if (new RegExp(regex, 'i').test(inputUsuario)) {\n                return options[regex]\n            }\n        }\n        return 'input inesperado'\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b2c7235e-ef98-42f6-a0b3-e7d1cb893a29","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-adbeb951-f091-41c6-b02c-6c0e8d836f7a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9821d300-be62-4f6e-808b-fc2ca7bbb46f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-73a3050d-c242-41a4-adf7-9243341abc4b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","root":false,"$title":"[TC.4.0.0] Validacao Resposta","$position":{"top":"2210px","left":"7328.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ba3da958-10db-4e8c-8254-3b9c4914569e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"36dbb166-7d5f-4bd2-b415-4dab659ef9ba","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ba3da958-10db-4e8c-8254-3b9c4914569e","root":false,"$title":"[GO TO] Employee Transbordo ","$position":{"top":"2436.5px","left":"7136.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f9104304-1199-4675-8374-430655df0b48":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"db70079b-dafc-486c-8911-756528b4e9bf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"f9104304-1199-4675-8374-430655df0b48","root":false,"$title":"[GO TO] Employee Finalização   ","$position":{"top":"2444.5px","left":"7533.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d64a1b9a-d7fb-4a53-884a-d34085a5601b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2360104b-898e-457f-918e-ef0244429365","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"329bc5fc-e554-4d1f-865b-1a858c603a5b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d64a1b9a-d7fb-4a53-884a-d34085a5601b","root":false,"$title":"[GO TO] Status de entrega","$position":{"top":"2896px","left":"1358.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"16b6d1b6-a332-48b5-8e88-ded1c07dd2ac":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bff410bd-26ae-4a36-b5ee-bd2801f00e0d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"69627292-9be3-442f-bddd-17001453148c","typeOfStateId":"state","$connId":"con_673","$id":"e42c7ff5-7a12-4c6d-8f2e-200af4283965","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"responseClientData"}],"$invalid":false},{"stateId":"544ad214-f67e-4d1a-87dd-cbb80aad7818","typeOfStateId":"state","$connId":"con_678","$id":"178510eb-0a78-473c-a3da-c017700cdb9d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"16b6d1b6-a332-48b5-8e88-ded1c07dd2ac","root":false,"$title":"[SET] Has Client Data?","$position":{"top":"410px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bd552257-7201-4ce6-abf3-fc2d61dc4c75":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17f13d18-9b07-419e-80b7-7b049032d9f9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"bd552257-7201-4ce6-abf3-fc2d61dc4c75","root":false,"$title":"[GO TO] Employee Transbordo  ","$position":{"top":"854.286px","left":"5519.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b7adc970-3748-4b05-b3cf-c62fbf818ad0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5658247a-4281-4202-9398-cd9ea00fa09e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"b7adc970-3748-4b05-b3cf-c62fbf818ad0","root":false,"$title":"[GO TO] Employ Transbordo","$position":{"top":"1123px","left":"2037px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"544ad214-f67e-4d1a-87dd-cbb80aad7818":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bff410bd-26ae-4a36-b5ee-bd2801f00e0d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"544ad214-f67e-4d1a-87dd-cbb80aad7818","root":false,"$title":"[GO TO] Redirect to identified intent","$position":{"top":"657px","left":"1616px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69627292-9be3-442f-bddd-17001453148c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2f46d9d6-2a7c-425c-983b-1208b07ef841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"69627292-9be3-442f-bddd-17001453148c","root":false,"$title":"[GO TO] Conta ","$position":{"top":"676px","left":"1408px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.65","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/devspdintencoes","builder:useTunnelOwnerContext":"true","builder:stateExpiration":"0.00:15:00","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","env":"Dev"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}