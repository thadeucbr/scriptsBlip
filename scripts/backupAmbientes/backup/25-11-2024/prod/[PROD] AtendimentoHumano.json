{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"252dbbd6-b37f-4493-9c66-2a0e1f031d98","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"2ea47fda-f02e-4cb9-a540-7a3c9add4168","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"ec5991e0-6921-4f19-9020-ccf05ae07f2f","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"0a06cefe-117c-480f-8dad-bef8fdeb3d3e","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4dce4904-6e5d-4d5f-86cc-9efbb8bd1508","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"d3b82733-a776-4ee9-916d-e5422b12d3af","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1f11be8e-dce0-47f4-b6a7-33198f4074f0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-96621d7e-a62b-4160-af88-cc9a1ff6e2ee","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fca2c7c1-d1ee-4e60-8ed5-7949adea27d6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"124px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7f9c45f2-07ff-4eea-b5d2-54025bf7b400","type":"text/plain"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"05a0fd9b-f6b2-4a87-9fa8-f4857aca21fa","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"fallback","$title":"Exceções","$position":{"top":"92px","left":"1490px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"action":{"$id":"01b8083e-9389-4ca7-91b0-d8990b31f72a","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"c8acddcc-a1e8-40e0-852c-40157c186304","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1fef7059-7489-4368-8ba0-52602ef029d4","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0e753dbf-d0a5-43cb-9087-5874d0808d59","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"error","$title":"Erro padrão","$position":{"top":"81px","left":"1705px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"723cfa31-6e62-457c-808f-058dc7ddc66a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"34902f40-4eef-4315-917a-803d34c9ba2f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"54e0dd61-7dfc-48b2-8ce8-253891bd84bf","typeOfStateId":"state","$connId":"con_13","$id":"4b4cdbc2-fa9e-442f-b1c9-63fa70a4a783","conditions":[{"source":"context","comparison":"equals","values":["emp1"],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"54e0dd61-7dfc-48b2-8ce8-253891bd84bf","typeOfStateId":"state","$connId":"con_18","$id":"a4c58c7e-4bd8-4b80-bd9e-2751a6fff41e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"723cfa31-6e62-457c-808f-058dc7ddc66a","root":false,"$title":"[AH.2.0.0] Atendimento Gerentes","$position":{"top":"603px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6fa758ab-c567-4f4d-936e-7e524c091892":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00d88841-5e7e-45de-9367-198de9ea8e6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00d88841-5e7e-45de-9367-198de9ea8e6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"80bc5452-d74d-441e-a85f-4e9a7a6b16e7","type":"text/plain","content":"No momento, não consigo te transferir para seu gerente. O atendimento é de segunda a sexta das 9h às 21h, exceto feriados.\n\nSe precisar entrar em contato fora deste horário, a central de atendimento pessoa jurídica pode te ajudar:\n\n• Capital e Grande São Paulo:\n(11) 3175-8248\n\n• Demais localidades\n0300 015 7575","metadata":{}},"$cardContent":{"document":{"id":"80bc5452-d74d-441e-a85f-4e9a7a6b16e7","type":"text/plain","content":"No momento, não consigo te transferir para seu gerente. O atendimento é de segunda a sexta das 9h às 21h, exceto feriados.\n\nSe precisar entrar em contato fora deste horário, a central de atendimento pessoa jurídica pode te ajudar:\n\n• Capital e Grande São Paulo:\n(11) 3175-8248\n\n• Demais localidades\n0300 015 7575","metadata":{}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd1c385b-7adc-4efb-b829-3b137d4e97c0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"105470a0-0131-4cdb-9db2-b60e0997a97b","$invalid":false,"typeOfStateId":"state"},"id":"6fa758ab-c567-4f4d-936e-7e524c091892","root":false,"$title":"[AH.2.3.0] Fora do horario de atendimento","$position":{"top":"1465px","left":"173px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-81ea7700-39e6-421d-97be-781f13193f1f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"isAiGenerated":false},"bf1d18c3-7de4-4f75-8817-239b4fcf993c":{"$contentActions":[{"action":{"$id":"6e13eac5-fc9c-49df-a244-6baa2ef031b0","type":"SendMessage","settings":{"id":"c4f46f4c-ec10-47ad-bd24-3ffd077aa4ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4f46f4c-ec10-47ad-bd24-3ffd077aa4ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7fde6a79-d777-480b-8b47-30fc27ac8363","type":"SendMessage","settings":{"id":"9665efe7-68a1-4825-8aba-6f4f5ba46ccf","type":"text/plain","content":"Aguarde, você está sendo direcionado para o seu gerente. Esse processo pode levar algum tempo, agradecemos a sua paciência e compreensão. \n\nEm breve, você será atendido!","metadata":{}},"$cardContent":{"document":{"id":"9665efe7-68a1-4825-8aba-6f4f5ba46ccf","type":"text/plain","content":"Aguarde, você está sendo direcionado para o seu gerente. Esse processo pode levar algum tempo, agradecemos a sua paciência e compreensão. \n\nEm breve, você será atendido!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e1146dc1-320e-4b16-919a-a4ba2a3937f3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5abc748a-ad8b-4166-b0d2-eb7c11595684","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5abc748a-ad8b-4166-b0d2-eb7c11595684","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"88dac9fc-12c7-4c38-b3a4-83bc258ef941","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0ce371b3-ffd7-4bda-9f1e-6b4d7e53a47b","type":"text/plain","content":"Se desejar, você pode digitar *SAIR* a qualquer momento para encerrar o atendimento.","metadata":{}},"$cardContent":{"document":{"id":"0ce371b3-ffd7-4bda-9f1e-6b4d7e53a47b","type":"text/plain","content":"Se desejar, você pode digitar *SAIR* a qualquer momento para encerrar o atendimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"4fb59875-a2a3-4d4d-b35f-bcb11ff38d46","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1d08cfc6-9698-4d24-a308-9bb5e400957f","typeOfStateId":"state","$connId":"con_23","$id":"2f1a0e23-54c7-438a-a8b9-e6e59b29d8d3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a53ca151-6fd2-4cd6-accb-a14de3ac1037","$typeOfContent":"","type":"MergeContact","$title":"Set \"team\" to \"{contaSelecionada@filaGerente}\"","$invalid":false,"settings":{"extras":{"team":"{{contaSelecionada@filaGerente}}"}},"conditions":[]},{"$id":"4e622200-43e6-4594-97cc-ad409b0d503f","$typeOfContent":"","type":"MergeContact","$title":"Set \"team\" if \"broadcast\"","$invalid":false,"settings":{"extras":{"team":"Default"}},"conditions":[{"values":["reativacao_emp1","reativacao_emp1_v2"],"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem"}]},{"$id":"b3c31a6d-2b9c-4517-bbaa-e963a099e245","type":"SetVariable","$title":"Set \"tunnelMain\" to \"{tunnel.identity}\"","$invalid":false,"settings":{"variable":"tunnelMain","value":"{{tunnel.identity}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-483735ea-8eae-422a-98bc-ef9aad266304","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-f1ffae08-7abb-486f-8662-38047e8043fb","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-afe97f51-f23b-437e-9387-e9151bc62443","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bf1d18c3-7de4-4f75-8817-239b4fcf993c","root":false,"$title":"[AH.2.4.0] Define fila de atendimento","$position":{"top":"1680px","left":"408px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5a9c72b7-bfaf-4105-86c1-9cf8be316c37":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c0f606a-c029-4381-89c3-726e5df5c07e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bf1d18c3-7de4-4f75-8817-239b4fcf993c","$connId":"con_28","conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}],"$invalid":false,"$id":"77727111-c15f-4795-9b2f-163be66ffac7","typeOfStateId":"state"},{"stateId":"6fa758ab-c567-4f4d-936e-7e524c091892","$connId":"con_33","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime"}],"$invalid":false,"$id":"6412da4c-8e08-4fc1-a1d7-33f6bde1b36f"}],"$enteringCustomActions":[{"$id":"ad5b301e-f8b8-46e1-8c6e-d10d95682442","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP horario","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/horarios-atendimentos/v1/horarios-atendimentos?idFila={{config.botIdentity}}&team=default","responseStatusVariable":"statusIsWorkTime","responseBodyVariable":"bodyIsWorkTime"},"conditions":[]},{"$id":"ecf75b13-2b1e-4f31-aa04-a4a33d34bd9a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"isWorkTime\"","$invalid":false,"settings":{"function":"run","source":"function run(retornoAPI) {\n    try {\n        const obj = JSON.parse(retornoAPI);\n        return obj.data.isWorkTime;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["bodyIsWorkTime"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"STATUS API HORARIO","$invalid":false,"settings":{"extras":{},"category":"Status API Horario","action":"{{statusIsWorkTime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-34688180-68f3-42e3-9e46-6bc3c5d9f16f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a6039cc3-2c02-4917-9c5e-687efa4a5f73","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a26c6a91-c983-478b-9b1c-29e3df35d122","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5a9c72b7-bfaf-4105-86c1-9cf8be316c37","root":false,"$title":"[AH.2.2.0] Api horario atendimento","$position":{"top":"1276px","left":"369px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c7d220bd-2237-49f4-88ec-14c555bf202c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c7d220bd-2237-49f4-88ec-14c555bf202c","root":false,"$title":"[GO TO][Redirect] WhatsApp PJ (atendente)","$position":{"top":"1126px","left":"1858px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"105470a0-0131-4cdb-9db2-b60e0997a97b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-de792fd1-b7a0-46c2-ba7d-267d011a87dc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3ad34979-6b5f-4081-a92b-b5fc3cfefc11","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"105470a0-0131-4cdb-9db2-b60e0997a97b","root":false,"$title":"[Redirect] To  Finalizacao (Welcome)","$position":{"top":"1653px","left":"704px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1d08cfc6-9698-4d24-a308-9bb5e400957f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"98dd806d-c9af-4ade-8243-750f87466651","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"09702f26-b5f2-4f37-9a47-3a2b230b9854","type":"Redirect","$title":"Redirect to \"emp1\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"emp1"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7046ff39-dcca-4e7e-980b-264f49d92858","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1d08cfc6-9698-4d24-a308-9bb5e400957f","root":false,"$title":"[Redirect] to Emp1","$position":{"top":"1886px","left":"408px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"12bba0f4-d1e2-4c3f-8496-7df481f83955":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"805099b3-4e7f-45e0-bd67-34404bac3d14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"105470a0-0131-4cdb-9db2-b60e0997a97b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"12bba0f4-d1e2-4c3f-8496-7df481f83955","root":false,"$title":"[GO TO][Redirect] To  Finalizacao (Welcome)","$position":{"top":"1030px","left":"955px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"500a7166-13c4-46cc-ae76-b1230f80203b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-12bf7e68-1efa-4956-96d5-b9522cd4e88e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-546c4b21-7275-4c70-b9a9-2b71b6f464a8","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"500a7166-13c4-46cc-ae76-b1230f80203b","root":false,"$title":"[Redirect] To  Finalizacao (Finalizar)","$position":{"top":"86px","left":"1091px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1bf05d26-3661-4d02-a79a-a83bc40e7346":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: '7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1d4923db-d54b-437c-bd99-e07d24126de0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bc458be7-2071-4aa5-9f33-968686f07abe","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1bf05d26-3661-4d02-a79a-a83bc40e7346","root":false,"$title":"[Redirect] To Autenticacao & Retorno [Redirect] PJ","$position":{"top":"341px","left":"454px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"ec5991e0-6921-4f19-9020-ccf05ae07f2f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e1d4832-050e-4133-8da2-c0bbf0d541bc","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"723cfa31-6e62-457c-808f-058dc7ddc66a","typeOfStateId":"state","$connId":"con_38","$id":"7c50d3d1-2d8a-41ae-aceb-7a0f442cd3b8","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"1bf05d26-3661-4d02-a79a-a83bc40e7346","typeOfStateId":"state","$connId":"con_43","$id":"eb90e6f8-288c-4ff3-b3d6-79180d18912d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"ec5991e0-6921-4f19-9020-ccf05ae07f2f","$title":"[AH.0.0.0] Valida segmento (PJ|Gerentes)","$position":{"top":"363px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44":{"$contentActions":[{"action":{"$id":"7f941396-4934-45f0-9dc3-bdc641a2a46f","type":"SendMessage","settings":{"id":"a215588f-64c1-43a5-84dc-76ceae43297b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a215588f-64c1-43a5-84dc-76ceae43297b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8f0bfdac-f580-473e-948a-c74131d5bdf9","type":"SendMessage","settings":{"id":"b21f1c5f-478e-4d74-bf85-f673d0d51df8","type":"text/plain","content":"Aguarde um momento que logo um especialista irá atender","metadata":{}},"$cardContent":{"document":{"id":"b21f1c5f-478e-4d74-bf85-f673d0d51df8","type":"text/plain","content":"Aguarde um momento que logo um especialista irá atender"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ede93084-4fe4-4395-bc74-d31c784f5300","type":"SendMessage","settings":{"id":"66079202-6213-4dd3-91e4-0a3e270a6162","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"66079202-6213-4dd3-91e4-0a3e270a6162","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"87a9a62b-859f-4da9-8de2-c5e582110fb1","type":"SendMessage","settings":{"id":"70ea6af4-3bf8-45fa-88ce-f854a96ab651","type":"text/plain","content":"Se você não conseguir esperar ou se quiser finalizar essa conversa, é só digitar *SAIR*","metadata":{}},"$cardContent":{"document":{"id":"70ea6af4-3bf8-45fa-88ce-f854a96ab651","type":"text/plain","content":"Se você não conseguir esperar ou se quiser finalizar essa conversa, é só digitar *SAIR*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"80981a49-20a3-44ec-812f-373e8f6e5d52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94a68d08-0bfc-492c-bc82-4dbe570d9cfe","typeOfStateId":"state","$connId":"con_48","$id":"3bd394bd-b531-4fc8-ad1d-08b660a69194","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"830565da-0123-4152-a31a-1e9e7144b7bd","type":"ExecuteScript","$title":"Seta Equipe","$invalid":false,"settings":{"function":"run","source":"function run(numeroSegmento, naoCliente, inputIntencao, tag, broadcast, logistica, template) {\r\n\r\n    numeroSegmento = parseInt(numeroSegmento)\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Suporte_Tecnico\") {\r\n        return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Safrapay_Digital\") {\r\n        return \"WhatsApp_Safrapay_Digital\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Prata_Bronze_Empresas\") {\r\n        return \"WhatsApp_Prata_Bronze_Empresas\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Perda_Roubo\") {\r\n        return \"WhatsApp_Perda_Roubo\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Middle\") {\r\n        return \"WhatsApp_Middle\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Large_Corporate\") {\r\n        return \"WhatsApp_Large_Corporate\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Empresas2\") {\r\n        return \"WhatsApp_Empresas2\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Empresas1\") {\r\n        return \"WhatsApp_Empresas1\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Default\") {\r\n        return \"WhatsApp_Default\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Corporate\") {\r\n        return \"WhatsApp_Corporate\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Caça_POS\") {\r\n        return \"WhatsApp_Caça_POS\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Atacado\") {\r\n        return \"WhatsApp_Atacado\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Safra_Limites_Operacionais\") {\r\n        return \"Safra_Limites_Operacionais\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Descred_Safrapay_Digital\") {\r\n        return \"Descred_Safrapay_Digital\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Mesa_de_Vendas\") {\r\n        return \"Mesa_de_Vendas\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Descred_Emp1\") {\r\n        return \"Descred_Emp1\"\r\n    }\r\n    if (broadcast == \"mesa_arv_estabelecimento_natal\" || broadcast == \"mesa_arv_estabelecimento\" || broadcast == \"antecipacao_avulsa_3003\" || broadcast == \"antecipacao_avulsa_pag_func_3003\" || broadcast == \"antecipacao_cancelada_3003\" || broadcast == \"antecipacao_cancelada_pag_func_3003\" || broadcast == \"antecipacao_nunca_antecipou_3003\" || broadcast == \"antecipacao_nunca_antecipou_pag_func_3003\" || broadcast == \"antecipacao_d15_d30_3003\" || broadcast == \"antecipacao_d15_d30_pag_func_3003\" || broadcast == \"arv_eventual_contratacao_abandono_2\" || broadcast == \"arv_eventual_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_2\" || broadcast == \"arv_automatico_contratacao_abandono_3\" || broadcast == \"taxa_esp_mesaarv_bus_1809_v2\") {\r\n        return \"Mesa_Arv\"\r\n    }\r\n    if (logistica == \"sim\") {\r\n        return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n\r\n    if (inputIntencao == \"Perda ou Roubo\") {\r\n        return \"WhatsApp_Perda_Roubo\"\r\n    }\r\n\r\n\r\n\r\n    const digital = [5, 18, 19, 21];\r\n\r\n    const atacado = [8, 11, 13];\r\n\r\n    const empresas = [14, 6, 7, 10, 16, 20, 22, 30];\r\n\r\n    const largeCorporate = [1, 2, 4, 15]\r\n\r\n\r\n\r\n    if (inputIntencao == \"Desejo falar sobre a notificação de inatividade da minha máquina SafraPay\" || broadcast == \"devolucao_maquinas\" || template == \"devolucao_maquinas\" || broadcast == \"devolucao_maquinas_v2\" || template == \"devolucao_maquinas_v2\" || broadcast == \"devolucao_maquinas_v3\" || template == \"devolucao_maquinas_v3\") {\r\n        return \"WhatsApp_Caça_POS\"\r\n    }\r\n\r\n    if (broadcast == \"caca_pos_nao_inatividade\" || template == \"caca_pos_nao_inatividade\" || broadcast == \"caca_pos_nao_inatividade_v2\" || template == \"caca_pos_nao_inatividade_v2\" || broadcast == \"caca_pos_nao_inatividade_v3\" || template == \"caca_pos_nao_inatividade_v3\") {\r\n        return \"whatsapp_caca_canceladas\"\r\n    }\r\n\r\n    if (inputIntencao == \"Suporte Tecnico\") {\r\n        return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n    if (inputIntencao == \"Descredenciamento\" && numeroSegmento == 20) {\r\n        return \"Descred_Emp1\"\r\n    }\r\n\r\n    if (inputIntencao == \"Vendas Online\") {\r\n        return \"Whatsapp_TEF_Ecommerce\"\r\n    }\r\n\r\n    if (digital.includes(numeroSegmento)) {\r\n\r\n        if (inputIntencao == \"Descredenciamento\") {\r\n            return \"Descred_Safrapay_Digital\"\r\n        }\r\n\r\n        return \"WhatsApp_Safrapay_Digital\"\r\n    }\r\n\r\n    if (empresas.includes(numeroSegmento)) {\r\n        return \"WhatsApp_Empresas1\";\r\n    }\r\n\r\n    if (numeroSegmento == 3) {\r\n        return \"WhatsApp_Corporate\"\r\n    }\r\n\r\n    if (numeroSegmento == 9) {\r\n        return \"WhatsApp_Middle\"\r\n    }\r\n\r\n    if (numeroSegmento == 17) {\r\n        return \"WhatsApp_Empresas2\"\r\n    }\r\n\r\n\r\n    if (atacado.includes(numeroSegmento)) {\r\n        return \"WhatsApp_Atacado\";\r\n    }\r\n\r\n    if (largeCorporate.includes(numeroSegmento)) {\r\n        return \"WhatsApp_Large_Corporate\"\r\n    }\r\n\r\n    if (naoCliente == 'true') {\r\n        return \"Mesa_de_Vendas\";\r\n    }\r\n\r\n    return \"WhatsApp_Default\";\r\n\r\n}","inputVariables":["numeroSegmento","naoCliente","input.content","responseTags","contact.extras.broadcastOrigem","logistica","contact.extras.campaignMessageTemplate"],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1f27b7fd-44a0-4cd7-a456-346e5c20792b","type":"ExecuteScript","$title":"Compacta Equipe","$invalid":false,"settings":{"function":"run","source":"function run(setaEquipe) {\n    const equipe = setaEquipe;\n    const compactaEquipe = equipe.replace(/_/gi, \"\")\n    return compactaEquipe;\n}","inputVariables":["setaEquipe"],"outputVariable":"compactaEquipe","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1fba3e3f-bf1c-4512-be96-8ce8934ef8a9","type":"ProcessHttp","$title":"HTTP - SUBSCRIBE INATIVIDADE","$invalid":false,"settings":{"headers":{"X-Blip-User":"{{tunnel.identity}}","X-Blip-Bot":"{{config.botIdentity}}","X-Desk-Team":"{{compactaEquipe}}"},"method":"POST","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}","uri":"{{config.urlTake}}/v1/Subscription/Subscribe","responseStatusVariable":"statusInatividade"},"conditions":[]},{"$id":"8393e21c-9fb9-4514-90a3-030744cd83f0","type":"ProcessCommand","$title":"GET ATTENDANTS","$invalid":false,"settings":{"to":"postmaster@desk.msging.net","method":"get","uri":"/attendants?$take=99999","variable":"attendants"},"conditions":[]},{"$id":"4dc54cc2-fcec-4dc4-802d-1f431949fe74","type":"ExecuteScript","$title":"CHECK ATTENDANT STATUS","$invalid":false,"settings":{"function":"run","source":"function run(attendants, agentEmail) {\n    if (!agentEmail || agentEmail == 'undefined') {\n        return false;\n    } else {\n        attendants = JSON.parse(attendants).resource.items;\n        const attendant = attendants.filter(function (a) {\n            return a.identity == encodeURIComponent(agentEmail) + '@blip.ai';\n        });\n        return attendant.length > 0 ? attendant[0].status == 'Online' : false;\n    }\n}","inputVariables":["attendants","contact.extras.agentEmail"],"outputVariable":"atendenteOnline","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"contains","variable":"contact.extras.Equipe","values":["@"]}]},{"$id":"5759876f-125b-4c17-b33b-f06b0d2aca3c","type":"ExecuteScript","$title":"Autenticado ?","$invalid":false,"settings":{"function":"run","source":"function run (autenticado) {\n    if (autenticado == \"true\"){\n        return 'Sim'\n    } else return 'Não'\n}","inputVariables":["autenticado"],"outputVariable":"auth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"eb25ca8f-64db-4a0c-8812-337090b4a732","$typeOfContent":"","type":"ProcessCommand","$title":"Processar comando","$invalid":false,"settings":{"to":"postmaster@desk.msging.net","method":"get","uri":"/teams/agents-online","variable":"teams"},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"eeaf5ac3-5450-47bd-b7c3-1f4bf4b59ea2","$typeOfContent":"","type":"ProcessHttp","$title":"Verifica Resource","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiKey}}","Content-Type":"application/json"},"method":"POST","body":"{\n    \"id\": \"{{random.guid}}\",\n    \"method\": \"get\",\n    \"uri\": \"/resources/{{contact.extras.ec}}\"\n}","uri":"{{config.commands}}","responseStatusVariable":"statusResource","responseBodyVariable":"bodyResource"},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"4373aa70-33cd-45ac-b876-5ee268680e9d","$typeOfContent":"","type":"ExecuteScript","$title":"Carteira MEsa_ARV","$invalid":false,"settings":{"function":"run","source":"function run(result) {\n\n    const result = JSON.parse(result);\n\n    if (result.status == \"success\") {\n        return result.resource;\n    }\n    return \"Mesa_Arv\"\n\n}","inputVariables":["bodyResource"],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"95dd5844-5a4b-4c65-8e37-19d99970302b","$typeOfContent":"","type":"ExecuteScript","$title":"Seta Equipe Resource","$invalid":false,"settings":{"function":"run","source":"function run() {\n  try {\n    const selectTeam = '{{setaEquipe}}'.split('|')[0];\n    const { resource } = JSON.parse('{{teams}}');\n\n    if (!resource) return 'Mesa_Arv';\n\n    const atendente = resource.items.find(\n      (fila) => fila.name === selectTeam && fila.agentsOnline > 0\n    );\n    if (atendente) return atendente.name;\n\n    return 'Mesa_Arv';\n  } catch (error) {\n    return 'Mesa_Arv';\n  }\n}","inputVariables":[],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"7a4b4991-10ef-4f8d-86a6-08052315f273","type":"MergeContact","$title":"setaEquipe","$invalid":false,"settings":{"extras":{"Autenticação":"{{auth}}","Equipe":"{{setaEquipe}}","TAG":"{{responseTags}}"}},"conditions":[]},{"$id":"62a90736-ca02-49d5-acff-4d198bdb5166","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Equipe":"{{responseTeam}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"aguardandoRetorno","values":["true"]}]},{"$id":"a7cbde79-a11d-4182-b185-7b42ee889ac6","type":"SetVariable","$title":"finalizacaoAtendimentoBot","$invalid":false,"settings":{"variable":"finalizacaoAtendimentoBot","value":"true"},"conditions":[]},{"$id":"96fe93cf-bdcb-4456-8c50-e9e6ea349be3","type":"MergeContact","$title":"VPO AGENTEMAIL","$invalid":false,"settings":{"extras":{"Equipe":"{{agentIdentity}}"}},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.agentEmail"},{"source":"context","comparison":"equals","variable":"responseTags","values":["Inatividade Cliente"]},{"source":"context","comparison":"contains","variable":"setaEquipe","values":["Mesa_de_Vendas"]}]},{"$id":"0a7ba6ac-b42d-44fb-a984-e5b7bb010397","type":"MergeContact","$title":"RESET AGENTEMAIL","$invalid":false,"settings":{"extras":{"Equipe":"Mesa_de_Vendas"}},"conditions":[{"source":"context","comparison":"contains","variable":"contact.extras.Equipe","values":["@"]},{"source":"context","comparison":"notEquals","variable":"atendenteOnline","values":["true"]}]}],"$leavingCustomActions":[{"$id":"43c05027-7726-4a34-a0f6-c3dcba05b65f","$typeOfContent":"","type":"TrackEvent","$title":"autoservicoAtendimento","$invalid":false,"settings":{"extras":{},"category":"autoservicoAtendimento","action":"1"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"autoservico"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94a68d08-0bfc-492c-bc82-4dbe570d9cfe","$invalid":false},"$tags":[{"id":"blip-tag-21878056-4309-4015-b5b4-7571b7ab7b4b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f0dd1828-f354-483f-bffb-3d30fc40d630","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9b39bdfc-61f9-48d3-b8b6-864a7daf62e2","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-5b360a9b-700a-4cda-84e2-ff6c7f9291c0","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-77cbfbf0-76d6-4fc9-bf79-10733b053187","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1f791ac9-c7fd-4a8a-879d-1f701ee519fa","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2c235ae7-f5f6-4186-8b44-2a5adc341eb3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44","root":false,"$title":"Pré Transbordo Contingência","$position":{"top":"715px","left":"1860px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"94a68d08-0bfc-492c-bc82-4dbe570d9cfe":{"$contentActions":[{"action":{"$id":"9176ce0e-1c29-4578-9ca6-a6e62ea82e9f","type":"SendMessage","settings":{"id":"a0832bb1-e5a6-417a-834f-f1e7d18c6f46","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a0832bb1-e5a6-417a-834f-f1e7d18c6f46","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d932805d-65cd-473f-8338-2fe139ea9268","type":"SendMessage","settings":{"id":"2e6f3188-a20c-4c82-97ff-5c211e9ab6d3","type":"text/plain","content":"{{msgMensagemInformativa}}","metadata":{}},"$cardContent":{"document":{"id":"2e6f3188-a20c-4c82-97ff-5c211e9ab6d3","type":"text/plain","content":"{{msgMensagemInformativa}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c7812143-dd8c-49c1-86f9-0c268e9a7795","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$connId":"con_53","$id":"7e37c3f9-87d4-45a9-92c3-59e331f233b7","conditions":[{"source":"context","comparison":"contains","values":["Transferir"],"variable":"responseTags"}],"$invalid":false,"typeOfStateId":"state","stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c"},{"stateId":"b58718a4-907a-43af-b61c-1cf7c5d934a1","typeOfStateId":"state","$connId":"con_58","$id":"40c924b5-a382-49b8-aeb3-a497c0312090","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5199afbb-600f-4b68-9edf-14c0a912ae27","type":"ExecuteScript","$title":"msg","$invalid":false,"settings":{"function":"run","source":"function run(setaEquipe, fila) {\n    if (setaEquipe == \"Mesa_de_Vendas\") {\n        return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 30 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n    }\n\n    if (setaEquipe == \"Produto\" || setaEquipe == \"Operacional\" || setaEquipe == \"IndicadosCSI\" || setaEquipe == \"WhatsApp_Caça_POS\" || setaEquipe == \"Safra_Limites_Operacionais\") {\n        return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 10 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n    }\n\n    if (setaEquipe == \"Descred_Safrapay_Digital\") {\n        return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 9 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n    }\n    if (setaEquipe == \"Mesa_Arv\" || fila == \"Mesa_Arv\" || setaEquipe == \"Logistica_hypo_varejo\" || fila == \"Logistica_hypo_varejo\") {\n        return \"\"\n    }\n    return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 5 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n\n}","inputVariables":["setaEquipe","fila"],"outputVariable":"msgMensagemInformativa","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3016e4fa-12e4-42a5-b75d-5ef7d65ced75","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"assuntoTransferencia","value":"{{assunto}}"},"conditions":[]},{"$id":"df857880-d13c-426d-9f66-42805cf237ab","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"assuntoTransferencia","action":"{{assuntoTransferencia}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"assuntoTransferencia"}]}],"$leavingCustomActions":[{"$id":"7e2744f9-8640-41d1-8844-fc60ee325021","$typeOfContent":"","type":"SetVariable","$title":"limpa msg","$invalid":false,"settings":{"variable":"msgMensagemInformativa"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"b58718a4-907a-43af-b61c-1cf7c5d934a1","$invalid":false},"$tags":[{"id":"blip-tag-c7401733-56f1-4f8a-9816-a70b05a0cba1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ac8343cf-5ac3-491f-960f-c6002fa31eca","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5d7c95ac-7104-40dc-8fab-a0dc1aeaaf47","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ebddef9d-4271-4571-b598-b8c63fec7a97","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"94a68d08-0bfc-492c-bc82-4dbe570d9cfe","root":false,"$title":"Mensagem Informativa","$position":{"top":"906px","left":"1400px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"b58718a4-907a-43af-b61c-1cf7c5d934a1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a08654e-301e-4dda-8b1e-b55c2549bc3d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$connId":"con_63","$id":"ad811c2e-f9cf-419e-a983-b8aa63316a17","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"typeOfStateId":"state","stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c"}],"$enteringCustomActions":[{"$id":"72e66603-bb1f-4908-b469-a1a8637e38a5","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - GET TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusTokenFront","responseBodyVariable":"bodyTokenFront"},"conditions":[]},{"$id":"4d28dded-341b-4e3a-9041-c87d6cdb58ce","$typeOfContent":"","type":"ExecuteScript","$title":"JS - GET TOKEN","$invalid":false,"settings":{"function":"run","source":"function run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyTokenFront"],"outputVariable":"tokenFront","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusTokenFront","values":["200"]}]},{"$id":"e6c4d466-1e9d-42c3-87cf-2a084cc0586d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP SOLICITA FILA PERFIL HIBRIDO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{tokenFront}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.gateway}}/chat-assistente/atendimentos-hibridos/v1/perfils/{{setaEquipe}}","responseStatusVariable":"statusFila","responseBodyVariable":"bodyFila"},"conditions":[{"source":"context","comparison":"equals","variable":"statusTokenFront","values":["200"]}]},{"$id":"d6e705b5-0593-415d-9c41-4e5ab1519c34","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CODIGOPERFIL HIBRIDO","$invalid":false,"settings":{"function":"run","source":"function run(bodyFila) {\n\n  const {data:{codigoPerfil}} = JSON.parse(bodyFila);\n\n    return codigoPerfil || 0\n}","inputVariables":["bodyFila"],"outputVariable":"codigoPerfil","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200","202"]}]},{"$id":"083e5df0-94fa-4411-a712-966469ea6840","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CRIAR PAYLOAD","$invalid":false,"settings":{"function":"run","source":"\nfunction run(random, codigoPerfil, dataTime, documento) {\n\n    let callId = random\n    if (documento == null) {\n        documento = \"0\"\n    }\n    const payload = {\n        \"callId\": callId,\n        \"cpfCnpj\": documento,\n        \"dataHoraInclusao\": dataTime,\n        \"usuarioInclusao\": \"WAPJ\",\n        \"idCanal\":\"6\",\n        \"parametrosBilhete\": [\n            {\n                \"callId\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"CodigoPerfilHibrido\",\n                \"valor\": codigoPerfil\n            },\n            {\n                \"callid\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"IDENTIFICACAOTOKEN\",\n                \"valor\": \"15\"\n            }\n        ]\n    }\n    return payload;\n}","inputVariables":["random.guid","codigoPerfil","calendar.datetime","cpf"],"outputVariable":"payloadBilhetes","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200","202"]}]},{"$id":"706726ae-b4b9-44aa-bdd0-f8ac82df3a7c","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CRIAR PAYLOAD Cliente PJ","$invalid":false,"settings":{"function":"run","source":"function run(random, codigoPerfil, dataTime, documento) {\n\n    let callId = random\n    if (documento == null) {\n        documento = \"0\"\n    }\n    const payload = {\n        \"callId\": callId,\n        \"cpfCnpj\": documento,\n        \"dataHoraInclusao\": dataTime,\n        \"usuarioInclusao\": \"WAPJ\",\n        \"idCanal\": \"6\",\n        \"parametrosBilhete\": [\n            {\n                \"callId\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"CodigoPerfilHibrido\",\n                \"valor\": codigoPerfil\n            },\n            {\n                \"callid\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"IDENTIFICACAOTOKEN\",\n                \"valor\": \"15\"\n            }\n        ]\n    }\n    return payload;\n}","inputVariables":["random.guid","codigoPerfil","calendar.datetime","cnpj"],"outputVariable":"payloadBilhetes","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200","202"]},{"source":"context","comparison":"equals","variable":"tipoPessoa","values":["PJ"]}]},{"$id":"63f5606b-1f9c-49ce-86df-6eee44b01bb4","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CRIA BILHETE FRONT UNICO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{tokenFront}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"POST","body":"{{payloadBilhetes}}","uri":"{{config.gateway}}/chat-assistente/atendimentos-hibridos/v1/bilhetes","responseStatusVariable":"statusBilhete","responseBodyVariable":"bodyBilhete"},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200"]}]},{"$id":"82e64acb-cb13-4a2f-9d04-7fcb79032244","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CRIA URL DO FRONT UNCIO","$invalid":false,"settings":{"function":"run","source":"function run(bodyBilhete) {\n\n    try {\n\n        const { data: { url } } = JSON.parse(bodyBilhete);\n\n        return url;\n\n    } catch (e) {\n\n        return 'Não informada'\n\n    }\n\n}","inputVariables":["bodyBilhete"],"outputVariable":"urlFrontUnico","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200"]}],"continueOnError":true},{"$id":"da16c3c7-1b2d-42b4-9532-38f22d71adeb","$typeOfContent":"","type":"ExecuteScript","$title":"Separa call id","$invalid":false,"settings":{"function":"run","source":"\nfunction run(callId) {\n\n    const id = callId.split(\"callid=\")[1] || \"não identificado\";\n\n    return id;\n\n}\n","inputVariables":["urlFrontUnico"],"outputVariable":"callID","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"f9ba124b-a1c5-4467-b4fb-27bea1cc792e","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CONTATO URL FRONT UNICO","$invalid":false,"settings":{"extras":{"urlFront":"{{urlFrontUnico}}","codigoPerfil":"{{codigoPerfil}}","callID":"{{callID}}"}},"conditions":[{"source":"context","comparison":"notEquals","variable":"codigoPerfil","values":["0"]}]},{"$id":"77a23849-387c-488e-8a8b-a5cf7fbcfe0e","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CONTATO URL FRONT","$invalid":false,"settings":{"extras":{"urlFront":"{{urlFrontUnico}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"codigoPerfil","values":["0"]}]},{"$id":"47511a20-2341-4de6-9c31-9ee2678acc7c","$typeOfContent":"","type":"MergeContact","$title":"URL VPO","$invalid":false,"settings":{"extras":{"urlVPO":"https://portalspa-sp2-hml.safracredenciadora.com.br/vpo-backoffice-b/core/receptive-chat/tabulador?telefone={{phoneNumber}}"}},"conditions":[{"source":"context","comparison":"contains","variable":"fila","values":["Mesa_de_Vendas"]}]}],"$leavingCustomActions":[{"$id":"626b6740-d0d5-4695-b35c-a0846188955b","$typeOfContent":"","type":"ExecuteScript","$title":"horaMin","$invalid":false,"settings":{"function":"run","source":"function run(offset) {\n    offset = parseFloat(offset);\n    let now = new Date();\n    let utc_timestamp = Date.UTC(\n        now.getUTCFullYear(),\n        now.getUTCMonth(),\n        now.getUTCDate(),\n        now.getUTCHours(),\n        now.getUTCMinutes(),\n        now.getUTCSeconds(),\n        now.getUTCMilliseconds()\n    );\n\n    let dataCompleta =  new Date(utc_timestamp + (offset + 3) * 3600 * 1000);\n    let  dataHora = dataCompleta.getHours() + \":\" + dataCompleta.getMinutes();\n    return dataHora;\n}","inputVariables":["config.dateTimeOffset"],"outputVariable":"horaMin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"877076ee-2c26-4434-b85b-5361c540ed40","$typeOfContent":"","type":"ExecuteScript","$title":"hora","$invalid":false,"settings":{"function":"run","source":"function run(offset) {\n    offset = parseFloat(offset);\n    let now = new Date();\n    let utc_timestamp = Date.UTC(\n        now.getUTCFullYear(),\n        now.getUTCMonth(),\n        now.getUTCDate(),\n        now.getUTCHours(),\n        now.getUTCMinutes(),\n        now.getUTCSeconds(),\n        now.getUTCMilliseconds()\n    );\n\n    let dataCompleta =  new Date(utc_timestamp + offset * 3600 * 1000);\n    let dataHora = dataCompleta.getHours() + 3;\n    return dataHora;\n}","inputVariables":["config.dateTimeOffset"],"outputVariable":"hora","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3304c1c7-25df-42f5-8a99-4fd22530a7d5","$typeOfContent":"","type":"TrackEvent","$title":"horaMin","$invalid":false,"settings":{"extras":{},"category":"horaMin","action":"{{horaMin}}"},"conditions":[]},{"$id":"c22902b0-1c46-4b2d-84a6-6271a06575f4","$typeOfContent":"","type":"TrackEvent","$title":"hora","$invalid":false,"settings":{"extras":{},"category":"hora","action":"{{hora}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c"},"$tags":[{"id":"blip-tag-f4f64615-5a3a-4dd8-b53a-6e48dacd87b4","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c0fc2d5c-a743-4d6a-9a4f-3350bf7f7e45","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c50d1527-7646-4ec9-80c2-8549eed1329a","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-2202a0de-0720-4b67-9240-4719fb0b20c4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"b58718a4-907a-43af-b61c-1cf7c5d934a1","root":false,"$title":"Perfil Hibrido","$position":{"top":"1041px","left":"2187px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c7b0f22e-f89f-4086-a4df-2bf1cd25ca45","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bd7da39a-aed6-4c2d-a325-06ca753cf1ad","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cf8373d3-151d-412a-a273-e4aeae4112ee","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"$tags":[{"id":"blip-tag-9d41f762-bd04-4c71-979f-716e86cd2b9f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1115e2fe-1002-454d-b884-1cc6208079b7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"88px","left":"1287px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"23ef6fd4-86e8-42c5-a2cc-a2f68461ea9d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"80981a49-20a3-44ec-812f-373e8f6e5d52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44","typeOfStateId":"state","$connId":"con_68","$id":"282b4493-f492-422a-86fa-2efc320575d6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"39107b13-104e-49c9-a7ad-f614795639e6","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"atendimento","value":"humano"},"conditions":[]},{"$id":"f4f918ef-23e5-4482-b881-e0b8124a3c6d","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"Humano","action":"1"},"conditions":[]},{"$id":"830565da-0123-4152-a31a-1e9e7144b7bd","type":"ExecuteScript","$title":"Seta Equipe","$invalid":false,"settings":{"function":"run","source":"const tags = {\r\n  'Transferir para: WhatsApp_Suporte_Tecnico': 'WhatsApp_Suporte_Tecnico',\r\n  'Transferir para: WhatsApp_Safrapay_Digital': 'WhatsApp_Safrapay_Digital',\r\n  'Transferir para: WhatsApp_Prata_Bronze_Empresas': 'WhatsApp_Prata_Bronze_Empresas',\r\n  'Transferir para: WhatsApp_Perda_Roubo': 'WhatsApp_Perda_Roubo',\r\n  'Transferir para: WhatsApp_Middle': 'WhatsApp_Middle',\r\n  'Transferir para: WhatsApp_Large_Corporate': 'WhatsApp_Large_Corporate',\r\n  'Transferir para: WhatsApp_Empresas2': 'WhatsApp_Empresas2',\r\n  'Transferir para: WhatsApp_Empresas1': 'WhatsApp_Empresas1',\r\n  'Transferir para: WhatsApp_Default': 'WhatsApp_Default',\r\n  'Transferir para: WhatsApp_Corporate': 'WhatsApp_Corporate',\r\n  'Transferir para: WhatsApp_Caça_POS': 'WhatsApp_Caça_POS',\r\n  'Transferir para: WhatsApp_Atacado': 'WhatsApp_Atacado',\r\n  'Transferir para: Safra_Limites_Operacionais': 'Safra_Limites_Operacionais',\r\n  'Transferir para: Descred_Safrapay_Digital': 'Descred_Safrapay_Digital',\r\n  'Transferir para: Mesa_de_Vendas': 'Mesa_de_Vendas',\r\n  'Transferir para: Descred_Emp1': 'Descred_Emp1',\r\n}\r\n\r\nconst filasBroadcasts = {\r\n  'Mesa_de_Vendas': [\r\n    'mesa_arv_estabelecimento_natal',\r\n    'mesa_arv_estabelecimento',\r\n    'antecipacao_avulsa_3003',\r\n    'antecipacao_avulsa_pag_func_3003',\r\n    'antecipacao_cancelada_3003',\r\n    'antecipacao_cancelada_pag_func_3003',\r\n    'antecipacao_nunca_antecipou_3003',\r\n    'antecipacao_nunca_antecipou_pag_func_3003',\r\n    'antecipacao_d15_d30_3003',\r\n    'antecipacao_d15_d30_pag_func_3003',\r\n    'arv_eventual_contratacao_abandono_2',\r\n    'arv_eventual_contratacao_abandono_1',\r\n    'arv_automatico_contratacao_abandono_1',\r\n    'arv_automatico_contratacao_abandono_2',\r\n    'arv_automatico_contratacao_abandono_3',\r\n    'taxa_esp_mesaarv_bus_1809_v2',\r\n  ],\r\n  'WhatsApp_Caça_POS': [\r\n    'devolucao_maquinas',\r\n    'devolucao_maquinas_v2',\r\n    'devolucao_maquinas_v3',\r\n  ],\r\n  'whatsapp_caca_canceladas': [\r\n    'caca_pos_nao_inatividade',\r\n    'caca_pos_nao_inatividade_v2',\r\n    'caca_pos_nao_inatividade_v3',\r\n  ],\r\n}\r\n\r\nconst filasPorSegmento = {\r\n  digital: [5, 18, 19, 21],\r\n  atacado: [8, 11, 13],\r\n  empresas: [14, 6, 7, 10, 16, 20, 22, 30],\r\n  largeCorporate: [1, 2, 4, 15]\r\n}\r\n\r\nconst filasPorInput = {\r\n  'Perda ou Roubo': 'WhatsApp_Perda_Roubo',\r\n  'Suporte Tecnico': 'WhatsApp_Suporte_Tecnico',\r\n  'Descredenciamento': 'Descred_Emp1',\r\n  'Vendas Online': 'Whatsapp_TEF_Ecommerce',\r\n}\r\n\r\nconst segmentosExclusivos = {\r\n  3: 'WhatsApp_Corporate',\r\n  9: 'WhatsApp_Middle',\r\n  17: 'WhatsApp_Empresas2',\r\n}\r\nfunction run(numeroSegmento, naoCliente, inputIntencao, tag, broadcast, logistica, template) {\r\n  try {\r\n    numeroSegmento = parseInt(numeroSegmento)\r\n\r\n    if (tag) {\r\n      if (tags[tag]) {\r\n        return tags[tag]\r\n      }\r\n    }\r\n\r\n    if (broadcast || template) {\r\n      if (filasBroadcasts.Mesa_de_Vendas.includes(broadcast) || filasBroadcasts.Mesa_de_Vendas.includes(template)) {\r\n        return \"Mesa_de_Vendas\"\r\n      }\r\n      if (filasBroadcasts.WhatsApp_Caça_POS.includes(broadcast) || filasBroadcasts.WhatsApp_Caça_POS.includes(template)) {\r\n        return \"WhatsApp_Caça_POS\"\r\n      }\r\n      if (filasBroadcasts.whatsapp_caca_canceladas.includes(broadcast) || filasBroadcasts.whatsapp_caca_canceladas.includes(template)) {\r\n        return \"whatsapp_caca_canceladas\"\r\n      }\r\n    }\r\n\r\n    if (logistica == \"sim\") {\r\n      return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n    if (filasPorInput[inputIntencao]) {\r\n      return filasPorInput[inputIntencao]\r\n    }\r\n\r\n    if (filasPorSegmento.digital.includes(numeroSegmento)) {\r\n      if (inputIntencao == \"Descredenciamento\") {\r\n        return \"Descred_Safrapay_Digital\"\r\n      }\r\n      return \"WhatsApp_Safrapay_Digital\"\r\n    }\r\n\r\n    if (filasPorSegmento.empresas.includes(numeroSegmento)) {\r\n      return \"WhatsApp_Empresas1\";\r\n    }\r\n\r\n    if (segmentosExclusivos[numeroSegmento]) {\r\n      return segmentosExclusivos[numeroSegmento]\r\n    }\r\n\r\n    if (filasPorSegmento.atacado.includes(numeroSegmento)) {\r\n      return \"WhatsApp_Atacado\";\r\n    }\r\n\r\n    if (filasPorSegmento.largeCorporate.includes(numeroSegmento)) {\r\n      return \"WhatsApp_Large_Corporate\"\r\n    }\r\n\r\n    if (naoCliente == 'true') {\r\n      return \"Mesa_de_Vendas\";\r\n    }\r\n\r\n    return \"WhatsApp_Default\";\r\n  } catch (err) {\r\n    return 'WhatsApp_Default'\r\n  }\r\n}","inputVariables":["numeroSegmento","naoCliente","input.content","responseTags","contact.extras.broadcastOrigem","logistica","contact.extras.campaignMessageTemplate"],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18d8ef55-bf7f-439d-be90-3c4348650248","type":"MergeContact","$title":"Equipe","$invalid":false,"settings":{"extras":{"Equipe":"{{setaEquipe}}"}},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44"},"$tags":[{"id":"blip-tag-8f3761c6-0d9f-4635-a41c-16a24101bc06","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-42d643d9-6528-45c0-a3e9-f2dc5c7900cf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7e834faf-5d30-4dfb-a00c-432e31473ecc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5b919506-4942-4526-bf46-02dbdf1866a2","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"23ef6fd4-86e8-42c5-a2cc-a2f68461ea9d","root":false,"$title":"Pré Transbordo","$position":{"top":"552px","left":"1858px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"6ea6c988-da8c-4bec-9510-cbc0dab53b9a":{"$contentActions":[{"action":{"$id":"268a1f86-d0c9-4856-ba17-d9cd37437932","type":"SendMessage","settings":{"id":"7cbe2711-1a9f-4d45-bf44-5d967d2a8c9f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7cbe2711-1a9f-4d45-bf44-5d967d2a8c9f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a45b98df-5cae-40ce-98c9-f547b9a9bae0","type":"SendMessage","settings":{"id":"876e1204-6e7c-4689-ba59-c6433b1bbe02","type":"text/plain","content":"{{msgForaHorarioAtendimento}}","metadata":{}},"$cardContent":{"document":{"id":"876e1204-6e7c-4689-ba59-c6433b1bbe02","type":"text/plain","content":"{{msgForaHorarioAtendimento}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"336384a1-4ae2-41a7-bc88-5710a3a825e4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"9c3390ba-b3cb-4700-9553-3d1303dbe6dd","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"Fora horário","action":"1"},"conditions":[]},{"$id":"37a18ef2-e1b2-46d0-8f8a-6cb115f3009e","type":"SetVariable","$title":"estado","$invalid":false,"settings":{"variable":"estado","value":"Fora do Horario de Atendimento"},"conditions":[]},{"$id":"f2d2dc23-0c26-43e9-aa0b-9e42ea3e4250","type":"ExecuteScript","$title":"mensagens","$invalid":false,"settings":{"function":"run","source":"function run(fila) {\n\n    if (fila == \"Mesa_de_Vendas\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Suporte_Tecnico\"  || fila == \"Whatsapp_TEF_Ecommerce\") {\n        return \"O atendimento neste canal está disponível de segunda a sexta das 8h00 às 21h00, exceto feriados. Para suporte técnico de sua maquininha Safrapay/Ecommerce, entre em contato por telefone no número 11 3175-8248 para Capital e Grande São Paulo ou 0300 015 7575 para demais localidades, atendimento disponível 24 horas por dia e 7 dias por semana.\"\n\n    }\n\n    if (fila == \"WhatsApp_Perda_Roubo\") {\n        return \"Para esta solicitação nosso horário de atendimento pelo whatsApp é de Segunda a Sexta das 8h00 às 21h00, exceto feriados!\\n\\\nNossos contatos para atendimento fora desse horário são (11)3175-8248 para Capital e Grande São Paulo e 0300 015 7575 Demais localidades. Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Safra_Limites_Operacionais\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Mesa_Arv\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Descred_Safrapay_Digital\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Descred_Emp1\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Atacado\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Large_Corporate\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Corporate\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Middle\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Safrapay_Digital\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Empresas1\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Empresas2\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Premium_Empresas2\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Premium_Empresas1\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Premium_Digital\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Caça_POS\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Prata_Bronze_Empresas\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Default\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n    if (fila == \"Logistica_hypo_varejo\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 17h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n}","inputVariables":["fila"],"outputVariable":"msgForaHorarioAtendimento","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"289f5f48-c0df-4ae3-bc60-ad2f3a59a654","type":"SetVariable","$title":"limpa msg","$invalid":false,"settings":{"variable":"msgForaHorarioAtendimento"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"500a7166-13c4-46cc-ae76-b1230f80203b"},"$tags":[{"id":"blip-tag-230b592b-c08c-4e7b-b05a-b8dde19df249","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3dabbd2a-6c89-4e9c-8d5b-7a81f62ef124","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-57c8aad5-30ce-4164-8601-6ca867798145","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d88ac2a5-55c5-4e8a-9f25-c102070d2ab6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6ea6c988-da8c-4bec-9510-cbc0dab53b9a","root":false,"$title":"Fora do Horario de Atendimento","$position":{"top":"543px","left":"2328px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5998b844-bc9d-46a5-93b9-923ec229b8a6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c7b0f22e-f89f-4086-a4df-2bf1cd25ca45","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$connId":"con_73","$id":"7a90a052-27fd-4aa5-865d-79fb8094cf88","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWeekend"}],"$invalid":false,"typeOfStateId":"state","stateId":"6ea6c988-da8c-4bec-9510-cbc0dab53b9a"},{"stateId":"23ef6fd4-86e8-42c5-a2cc-a2f68461ea9d","$connId":"con_78","$id":"554c25e7-3aa1-47e7-a25f-ea655f7bbcec","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a919f2e8-55ac-4ad1-87f9-8bb9cda2190b","type":"SetVariable","$title":"estado","$invalid":false,"settings":{"variable":"estado","value":"Verifica Horario de Atendimento"},"conditions":[]},{"$id":"2ffae401-1e27-45ac-ad57-51030ad63325","$typeOfContent":"","type":"ExecuteScript","$title":"SETA FILA VOLTA DE INATIVIDADE","$invalid":false,"settings":{"function":"run","source":"\nfunction run(team) {\n    return team\n}\n","inputVariables":["responseTeam"],"outputVariable":"fila","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"aguardandoRetorno","values":["true"]}]},{"$id":"a8867d9f-f581-4d2e-9fda-377636c2ce8c","type":"ExecuteScript","$title":"seta equipe para fila","$invalid":false,"settings":{"function":"run","source":"function run(numeroSegmento, naoCliente, inputIntencao, tag, broadcast, logistica, template) {\n\n    numeroSegmento = parseInt(numeroSegmento)\n\n    if (tag == \"Transferir para: WhatsApp_Suporte_Tecnico\") {\n        return \"WhatsApp_Suporte_Tecnico\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Safrapay_Digital\") {\n        return \"WhatsApp_Safrapay_Digital\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Prata_Bronze_Empresas\") {\n        return \"WhatsApp_Prata_Bronze_Empresas\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Perda_Roubo\") {\n        return \"WhatsApp_Perda_Roubo\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Middle\") {\n        return \"WhatsApp_Middle\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Large_Corporate\") {\n        return \"WhatsApp_Large_Corporate\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Empresas2\") {\n        return \"WhatsApp_Empresas2\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Empresas1\") {\n        return \"WhatsApp_Empresas1\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Default\") {\n        return \"WhatsApp_Default\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Corporate\") {\n        return \"WhatsApp_Corporate\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Caça_POS\") {\n        return \"WhatsApp_Caça_POS\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Atacado\") {\n        return \"WhatsApp_Atacado\"\n    }\n\n    if (tag == \"Transferir para: Safra_Limites_Operacionais\") {\n        return \"Safra_Limites_Operacionais\"\n    }\n\n    if (tag == \"Transferir para: Descred_Safrapay_Digital\") {\n        return \"Descred_Safrapay_Digital\"\n    }\n\n    if (tag == \"Transferir para: Mesa_de_Vendas\") {\n        return \"Mesa_de_Vendas\"\n    }\n\n    if (tag == \"Transferir para: Descred_Emp1\") {\n        return \"Descred_Emp1\"\n    }\n    if (broadcast == \"mesa_arv_estabelecimento_natal\" || broadcast == \"mesa_arv_estabelecimento\" || broadcast == \"antecipacao_avulsa_3003\" || broadcast == \"antecipacao_avulsa_pag_func_3003\" || broadcast == \"antecipacao_cancelada_3003\" || broadcast == \"antecipacao_cancelada_pag_func_3003\" || broadcast == \"antecipacao_nunca_antecipou_3003\" || broadcast == \"antecipacao_nunca_antecipou_pag_func_3003\" || broadcast == \"antecipacao_d15_d30_3003\" || broadcast == \"antecipacao_d15_d30_pag_func_3003\" || broadcast == \"arv_eventual_contratacao_abandono_2\" || broadcast == \"arv_eventual_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_2\" || broadcast == \"arv_automatico_contratacao_abandono_3\" || broadcast == \"taxa_esp_mesaarv_bus_1809_v2\") {\n        return \"Mesa_Arv\"\n    }\n    if (logistica == \"sim\") {\n        return \"WhatsApp_Suporte_Tecnico\"\n    }\n\n\n    if (inputIntencao == \"Perda ou Roubo\") {\n        return \"WhatsApp_Perda_Roubo\"\n    }\n\n\n\n    const digital = [5, 18, 19, 21];\n\n    const atacado = [8, 11, 13];\n\n    const empresas = [14, 6, 7, 10, 16, 20, 22, 30];\n\n    const largeCorporate = [1, 2, 4, 15]\n\n\n\n    if (inputIntencao == \"Desejo falar sobre a notificação de inatividade da minha máquina SafraPay\" || broadcast == \"devolucao_maquinas\" || template == \"devolucao_maquinas\" || broadcast == \"devolucao_maquinas_v2\" || template == \"devolucao_maquinas_v2\" || broadcast == \"devolucao_maquinas_v3\" || template == \"devolucao_maquinas_v3\") {\n        return \"WhatsApp_Caça_POS\"\n    }\n\n    if (broadcast == \"caca_pos_nao_inatividade\" || template == \"caca_pos_nao_inatividade\" || broadcast == \"caca_pos_nao_inatividade_v2\" || template == \"caca_pos_nao_inatividade_v2\" || broadcast == \"caca_pos_nao_inatividade_v3\" || template == \"caca_pos_nao_inatividade_v3\") {\n        return \"whatsapp_caca_canceladas\"\n    }\n\n    if (inputIntencao == \"Suporte Tecnico\") {\n        return \"WhatsApp_Suporte_Tecnico\"\n    }\n\n    if (inputIntencao == \"Descredenciamento\" && numeroSegmento == 20) {\n        return \"Descred_Emp1\"\n    }\n\n    if (inputIntencao == \"Vendas Online\") {\n        return \"Whatsapp_TEF_Ecommerce\"\n    }\n\n    if (digital.includes(numeroSegmento)) {\n\n        if (inputIntencao == \"Descredenciamento\") {\n            return \"Descred_Safrapay_Digital\"\n        }\n\n        return \"WhatsApp_Safrapay_Digital\"\n    }\n\n    if (empresas.includes(numeroSegmento)) {\n        return \"WhatsApp_Empresas1\";\n    }\n\n    if (numeroSegmento == 3) {\n        return \"WhatsApp_Corporate\"\n    }\n\n    if (numeroSegmento == 9) {\n        return \"WhatsApp_Middle\"\n    }\n\n    if (numeroSegmento == 17) {\n        return \"WhatsApp_Empresas2\"\n    }\n\n\n    if (atacado.includes(numeroSegmento)) {\n        return \"WhatsApp_Atacado\";\n    }\n\n    if (largeCorporate.includes(numeroSegmento)) {\n        return \"WhatsApp_Large_Corporate\"\n    }\n\n    if (naoCliente == 'true') {\n        return \"Mesa_de_Vendas\";\n    }\n\n    return \"WhatsApp_Default\";\n\n}","inputVariables":["numeroSegmento","naoCliente","input.content","responseTags","contact.extras.broadcastOrigem","logistica","contact.extras.campaignMessageTemplate"],"outputVariable":"fila","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"aguardandoRetorno","values":["true"]}]},{"$id":"fc02b706-e55b-4fb6-89bf-fb89e351323f","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN API HORÁRIO","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"a95952de-616f-4de6-8c75-e47fec80f7c9","type":"ProcessHttp","$title":"API - HORARIO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/horarios-atendimentos/v1/horarios-atendimentos?idFila={{config.botIdentity}}&team={{fila}}","responseStatusVariable":"statusIsWorkTime","responseBodyVariable":"bodyAPIHorario"},"conditions":[]},{"$id":"a6f09c55-f963-4f85-a0fd-d2f5a515f48c","$typeOfContent":"","type":"ExecuteScript","$title":"TRATA RETORNO API HORÁRIO","$invalid":false,"settings":{"function":"run","source":"function run (retornoAPI) {\n    const obj = JSON.parse(retornoAPI);\n\n    return obj.data.isWorkTime;\n}","inputVariables":["bodyAPIHorario"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusIsWorkTime"}],"continueOnError":false},{"$id":"574fe18b-f170-424c-98f3-c5524e05da34","type":"ExecuteScript","$title":"dentro ou fora do horario de atendimento","$invalid":false,"settings":{"function":"run","source":"function run(isWorkTime) {\n\n    const label = isWorkTime == 'true' ? \"Dentro\" : \"Fora\"\n    return label;\n\n}","inputVariables":["isWorkTime"],"outputVariable":"labelHorario","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0a9fc40a-42ca-4b29-835a-d9ef5d7b7068","type":"ExecuteScript","$title":"Converte Data e Hora","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n    var hoje = new Date();\n    \n    let day = hoje.getDate() < 10 ? '0' + hoje.getDate() : hoje.getDate();\n    let month = hoje.getMonth() + 1;\n    const newDate = `${day}/${month < 10 ? '0' + month : month}/${hoje.getFullYear()} - ${hoje.getHours() < 10 ? '0' + hoje.getHours() : hoje.getHours()}:${hoje.getMinutes()}:${hoje.getSeconds() < 10 ? '0' + hoje.getSeconds() : hoje.getSeconds()}`\n    return newDate;\n}","inputVariables":[],"outputVariable":"dataHoraBR","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b6f52c9-a57f-4afb-bada-c6905cf5fc3b","$typeOfContent":"","type":"ExecuteScript","$title":"Work Fim de Semana","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const now = new Date().toLocaleString(\"en-US\", { timeZone: \"America/Sao_Paulo\" });\n    const weekDay = new Date(now).getDay();\n\n    if (weekDay == \"0\" || weekDay == \"6\") {\n        return true;\n    }\n\n    return false;\n}","inputVariables":[],"outputVariable":"isWeekend","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cf1b4d8-3287-4982-85ee-b284ef61922b","type":"TrackEvent","$title":"Derivação","$invalid":false,"settings":{"extras":{},"category":"Derivação","action":"{{dataHoraBR}}|{{phoneClient}}|{{labelHorario}}"},"conditions":[]},{"$id":"e9c9deff-51ab-49de-b02b-c32e5772016d","type":"TrackEvent","$title":"Horário de Atendimento Detalhado","$invalid":false,"settings":{"extras":{},"category":"Horário de Atendimento Detalhado","action":"{{dataHoraBR}}|{{labelHorario}}"},"conditions":[]},{"$id":"2b18aa84-8b0f-4ae3-bf8e-cd2d02710959","type":"TrackEvent","$title":"Horário de Atendimento Volume dentro","$invalid":false,"settings":{"extras":{},"category":"Horário de Atendimento - Volume","action":"Dentro"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}]},{"$id":"afb7795e-682d-4997-ab55-e785e03031da","type":"TrackEvent","$title":"Horário de Atendimento Volume fora","$invalid":false,"settings":{"extras":{},"category":"Horário de Atendimento - Volume","action":"Fora"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["false"]}]},{"$id":"a3ef328c-71f8-4371-83e0-167083558077","type":"TrackEvent","$title":"Teste - Derivação","$invalid":false,"settings":{"extras":{},"category":"Teste - Derivação - {{fila}}","action":"{{dataHoraBR}}-{{phoneClient}}-{{labelHorario}}"},"conditions":[]},{"$id":"f8d0aa3a-1c97-4c97-a914-95cba208ce77","type":"TrackEvent","$title":"Teste - Horário de Atendimento Detalhado","$invalid":false,"settings":{"extras":{},"category":"Teste - Horário de Atendimento Detalhado - {{fila}}","action":"{{dataHoraBR}}|{{labelHorario}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a1247b09-f8d0-4524-8620-3978ffe4a0a0","type":"TrackEvent","$title":"Teste - Horário de Atendimento - Volume","$invalid":false,"settings":{"extras":{},"category":"Teste - Horário de Atendimento - Volume - {{fila}}","action":"Dentro"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}]},{"$id":"bc2fe563-3a8f-4d49-b8ce-95ed22a35d26","type":"TrackEvent","$title":"Teste - Horário de Atendimento - Volume","$invalid":false,"settings":{"extras":{},"category":"Teste - Horário de Atendimento - Volume - {{fila}}","action":"Fora"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["false"]}]},{"$id":"2c6ebab9-deae-492e-bf10-1fb7e9ae9c84","$typeOfContent":"","type":"TrackEvent","$title":"Status API DE HORARIO","$invalid":false,"settings":{"extras":{},"category":"Status API DE HORARIO","action":"Data - {{calendar.datetime}} - Cel - {{phoneClient}} - Status - {{statusIsWorkTime}} - MSG {{bodyAPIHorario}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusIsWorkTime","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"6ea6c988-da8c-4bec-9510-cbc0dab53b9a"},"$tags":[{"id":"blip-tag-7202e4f1-a52e-4949-a1dd-bf271e51b294","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-74f0fc35-65de-4736-9dbd-07283075ee6e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2088d210-3e06-4626-a531-790b006612df","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d148db1f-7fa8-4f6d-bcfc-54b6daa33ea1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5998b844-bc9d-46a5-93b9-923ec229b8a6","root":false,"$title":"[DESATIVADO] Verifica Horario de Atendimento","$position":{"top":"420px","left":"2088px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"54e0dd61-7dfc-48b2-8ce8-253891bd84bf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"880bffe5-8535-4540-ab13-7bff7dfc7f81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9f5d9e11-583a-4e70-9b90-e316ffd37c80","typeOfStateId":"state","$connId":"con_83","$id":"ba7c0be8-d96f-4595-bdfc-fbe8133b4b7c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ac5407c1-a420-407d-9bb5-bd9d759a8055","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ddced25e-73e6-436e-8cf2-5481097fdfba","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"a6d10ab2-9985-433c-9dc3-41349c0338e4","$typeOfContent":"","type":"ProcessHttp","$title":"Process  \"bodyContatoGerente\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Aplicacao":"CHT"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusContatoGerente","responseBodyVariable":"bodyContatoGerente"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"54e0dd61-7dfc-48b2-8ce8-253891bd84bf","root":false,"$title":"[AH.2.1.0] Api contato gerentes","$position":{"top":"840px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20da5fb6-c7e7-4943-96fd-af2e7eb96db7":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"44d3fa60-29c7-4158-896e-f160ea0ff63a","typeOfStateId":"state","$connId":"con_88","$id":"77bfbffd-33e7-48d4-8ae8-50d552e0dbdd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Falar agora\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\t\t\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Ver o menu inicial\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Encerrar atendimento\",\n\t\t\t\t\"description\": \"\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Além das informações que compartilhei, você gostaria de falar com seu gerente por aqui?` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Opções\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8d575e5b-2e4e-4d89-abcc-e89e201daf6f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0f434f37-4415-4e1f-977a-5c4b79851889","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-be1ad4cd-78cb-4751-a59f-1c2f075dca5e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"20da5fb6-c7e7-4943-96fd-af2e7eb96db7","root":false,"$title":"[AH.2.1.2] Menu Como deseja seguir?","$position":{"top":"767px","left":"1014px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9f5d9e11-583a-4e70-9b90-e316ffd37c80":{"$contentActions":[{"action":{"$id":"65f9e04b-0175-40ba-8a4a-2edaa10d8bef","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"33eee1a2-3536-4212-af1f-2017adb8d5a4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"33eee1a2-3536-4212-af1f-2017adb8d5a4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"99de0c22-17e7-4835-a31c-4401d933f1d4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"de16ba30-470a-4fdd-9240-acbce1ab1b6e","type":"text/plain","content":"Encontrei os contatos do seu gerente.","metadata":{}},"$cardContent":{"document":{"id":"de16ba30-470a-4fdd-9240-acbce1ab1b6e","type":"text/plain","content":"Encontrei os contatos do seu gerente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"02d97eda-ae5a-40d4-b987-698701b0053d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0233a64c-8ea7-4430-b10d-b10e0af69f9d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0233a64c-8ea7-4430-b10d-b10e0af69f9d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"29eeefc5-eb6f-4c54-be6d-61ab98711cf9","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6caebb3e-d7ba-49dc-87b2-2578d1fbf7fb","type":"text/plain","content":"Gerente: {{nomeFormatado}}\n\nTelefone: {{telefoneFormatado}}\n\nE-mail: {{contatoGerente@email}}","metadata":{}},"$cardContent":{"document":{"id":"6caebb3e-d7ba-49dc-87b2-2578d1fbf7fb","type":"text/plain","content":"Gerente: {{nomeFormatado}}\n\nTelefone: {{telefoneFormatado}}\n\nE-mail: {{contatoGerente@email}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6d2fb77a-cf3d-4d68-8954-1679009c6c1e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"568aa6ab-cd73-4876-87c1-7c8dbd4fdba8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"83f6cae6-01b1-4621-8343-64d74b9c6d99","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"83f6cae6-01b1-4621-8343-64d74b9c6d99","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"12bba0f4-d1e2-4c3f-8496-7df481f83955","typeOfStateId":"state","$connId":"con_93","$id":"94391de3-9974-46a8-89cc-a6ae8620d2b6","conditions":[{"source":"context","comparison":"equals","values":["emp2"],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"20da5fb6-c7e7-4943-96fd-af2e7eb96db7","typeOfStateId":"state","$connId":"con_98","$id":"727dab30-a74c-48ca-98cf-da3d5f3b7c62","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"31bef465-6a14-4b2f-8246-a7a4f454f6d4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contatoGerente\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(contatoGerente) {\n\ttry {\n\t\tlet contatoGerente = JSON.parse(contatoGerente);\n\t\tcontatoGerente = contatoGerente.data\n\t\treturn JSON.stringify(contatoGerente);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyContatoGerente"],"outputVariable":"contatoGerente","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6ded193e-72b0-4537-a73e-42e5a11cb88c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telefoneFormatado\"","$invalid":false,"settings":{"function":"run","source":"function run(contatoGerente) {\n\ttry {\n\t\tlet contatoGerente = JSON.parse(contatoGerente);\n\t\tcontatoGerente = contatoGerente.contato.telefone\n\t\tlet telefone = contatoGerente.substr(2);\n\t\ttelefone = telefone.replace(/^(\\d{2})(\\d)/g,\"($1) $2\")\n\t\ttelefone = telefone.replace(/(\\d)(\\d{4})$/,\"$1-$2\")\n\t\treturn telefone;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n","inputVariables":["contatoGerente"],"outputVariable":"telefoneFormatado","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false},{"$id":"2af58fa6-4be4-4228-9c92-9f8146968004","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"nomeFormatado\"","$invalid":false,"settings":{"function":"run","source":"function run(contatoGerente) {\n\ttry {\n\t\tlet contatoGerente = JSON.parse(contatoGerente);\n\t\tcontatoGerente = contatoGerente.nome\n\t\tlet nome = contatoGerente.toLowerCase()\n\t\tnome = nome.replace(/\\b\\w/g, match => match.toUpperCase())\n\t\treturn nome;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n","inputVariables":["contatoGerente"],"outputVariable":"nomeFormatado","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9f5d9e11-583a-4e70-9b90-e316ffd37c80","root":false,"$title":"[AH.2.1.1] Lista contato gerente","$position":{"top":"1041px","left":"702px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"44d3fa60-29c7-4158-896e-f160ea0ff63a":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8397c4c5-18eb-4b96-9afa-713a81d4081c","typeOfStateId":"state","$connId":"con_103","$id":"00850002-a9aa-46cf-85d6-91384617a0a9","conditions":[{"source":"context","comparison":"equals","values":["Ver o menu inicial"],"variable":"userInput"}],"$invalid":false},{"stateId":"5a9c72b7-bfaf-4105-86c1-9cf8be316c37","typeOfStateId":"state","$connId":"con_108","$id":"99f22495-ec47-436c-a9ee-e5e3e267d68a","conditions":[{"source":"context","comparison":"equals","values":["Falar agora"],"variable":"userInput"}],"$invalid":false},{"stateId":"105470a0-0131-4cdb-9db2-b60e0997a97b","typeOfStateId":"state","$connId":"con_113","$id":"6f12663e-5535-480f-a0bb-a060e6cd6e89","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\nfunction run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f05fe711-8b02-494b-a6f1-cb08c17f8dd4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d620d83e-6a1a-4d3f-aebe-7411d33edda9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-39c0565c-f513-43af-8c72-2290cad1648b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b19c5c70-671c-47a4-93e5-1e3a90d7f26e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"44d3fa60-29c7-4158-896e-f160ea0ff63a","root":false,"$title":"[AH.2.1.3][INPUT] Menu Como deseja seguir?","$position":{"top":"1465px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8397c4c5-18eb-4b96-9afa-713a81d4081c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Bot Main ${env || ''}`.trim(),\n\t\t\tstateDestination: '30e39880-1d2a-439a-a0ed-1e7210966286',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"76749ce2-c212-4b7b-9e4d-818f5a12c7f1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Finalizacao \"{state.name}\" registro\"","$invalid":false,"settings":{"extras":{},"category":"SPD Finalizacao {{state.name}} registro","action":"Registro"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a23d9947-ff33-4a00-9191-03e453bd3af5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b50dc260-ac60-49a3-8660-2144161ae706","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9eea410a-6ff5-4043-8ef9-976d0e2bdd58","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"8397c4c5-18eb-4b96-9afa-713a81d4081c","root":false,"$title":"[Redirect] to Main (Menu inicial)","$position":{"top":"1476px","left":"920px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"atendimentohumano","urlCHT":"https://api.safra.com.br","botIdentity":"prodspdatendimentohumano","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/prodspdatendimentohumano","urlToken":"https://sts-api.safra.com.br","clientSecret":"5312b6d5-acb8-4165-9458-ef445876473e","urlTake":"https://ticketmonitor.cs.blip.ai","commands":"https://safra.http.msging.net/commands","apiKey":"Key cm91dGVyc2FmcmFwcm9kd2hhdHNhcHBwajpuOHBSSDJRRW5NRTFvb3Jybk4wbA==","gateway":"https://api.safra.com.br","clientId":"BLIP","grantType":"client_credentials"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}