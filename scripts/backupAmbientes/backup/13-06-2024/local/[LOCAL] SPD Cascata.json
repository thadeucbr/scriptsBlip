{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"69cbe533-65de-408a-9611-ce0b70b5077e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"570f1179-ac3e-4eb0-b85c-1925dc3322da","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"8a85a65c-b3b5-46af-ae85-3f9e25093880","$connId":"con_3","$id":"25ddee3d-e913-4979-b3d1-fb31cb136c54","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"eabf60bc-f6aa-41c4-9b75-ac7770899f61","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"errorCounter\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(counter, state) {\n\tconst parsedState = JSON.parse(state)\n\ttry {\n\t\tif (!counter) {\n\t\t\treturn {\n\t\t\t\tcounter: 1,\n\t\t\t\tlastErrorState: parsedState.stateOrigin\n\t\t\t}\n\t\t}\n\t\tconst parsedCounter = JSON.parse(counter)\n\t\tif (parsedCounter.lastErrorState == parsedState.stateOrigin) {\n\t\t\tparsedCounter.counter++\n\t\t\treturn parsedCounter\n\t\t}\n\t\treturn {\n\t\t\tcounter: 1,\n\t\t\tlastErrorState: parsedState.stateOrigin\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tcounter: 1,\n\t\t\tlastErrorState: parsedState.stateOrigin,\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["errorCounter","state"],"outputVariable":"errorCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"001b3365-cad0-47b1-ae20-c814467616de","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c31b3de0-af46-4338-9c98-f4c3517c489b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata origem\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata origem","action":"{{state@botOrigin}}|{{state@stateNameOrigin}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state@botOrigin"}]},{"$id":"39e8b5d7-db4d-44eb-8ffd-82f52eb903fd","$typeOfContent":"","type":"TrackEvent","$title":"Track \"cascata inputs inesperados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"cascata inputs inesperados","action":"{{contact.identity}} | {{state@stateNameOrigin}} | {{state@lastInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"state@intent"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-9371fd62-a8ed-4f94-b9d2-96e7d2641d7f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-777265af-dae5-4fd5-bf2c-8a7a12ec2c44","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cb01c391-42c6-4eff-bfa4-8456cb6a2e76","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$position":{"top":"42px","left":"2036px"},"$title":"Início da Skill de Cascata de Validações","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9aacf0d-1a7b-4907-8c0e-62a8fa0d0777","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8cbb51a1-fb61-46da-8f0c-eb10cd445422","type":"SetVariable","$title":"Define service | Exceção","$invalid":false,"settings":{"variable":"service","value":"Exceção"},"conditions":[]},{"$id":"86771cdd-fc26-4fdc-8234-c77de90f72a4","$typeOfContent":"","type":"TrackEvent","$title":"Cascata regex global validacao","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata regex global validacao","action":"Nao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$invalid":false},"$tags":[{"id":"blip-tag-c87e45e7-4221-4f28-bee3-3f144da855e4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0b4d20f5-7a64-428f-8a26-92856932de72","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"fallback","$position":{"top":"41px","left":"2442.5px"},"$title":"Exceções da Skill de Cascata de Validações","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5290ae6c-fa56-45ef-b20b-48b4598219da":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"57184874-a6c1-4af8-bd51-450d1571b0bd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d63e64cb-adbe-466a-804e-6c4a0737fd06","$connId":"con_8","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"hasEmoji"}],"$invalid":false,"$id":"2b7c3dad-b44d-4a15-b96a-404da7ca1eb1"},{"stateId":"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c","$connId":"con_13","$id":"fcd0a596-adfd-4599-b717-94ccd27cb232","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Define hasEmoji","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    const emojisPattern = /\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]/gmi;\n\n    return input.match(emojisPattern) ? \"Sim\" : \"Nao\";\n};","inputVariables":["input.content"],"outputVariable":"hasEmoji","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Contem emoji validacao | {hasEmoji}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Contem emoji validacao","action":"{{hasEmoji}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"hasEmoji"}]},{"$id":"51033df0-6b65-402f-8bf9-bc8ac8ab8095","$typeOfContent":"","type":"SetVariable","$title":"Define emojiCleanedInput | {input.content}","$invalid":false,"settings":{"variable":"emojiCleanedInput","value":"{{input.content}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-850175f1-1b82-445e-9643-f7aa45d99f37","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a116f897-b2fe-4f80-9a73-14ca62babdb6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-97afbfc8-8b5f-4c32-9c4d-578e11aa16fd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"5290ae6c-fa56-45ef-b20b-48b4598219da","root":false,"$title":"V.1.0.1 | Contém emoji?","$position":{"top":"410px","left":"1761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d63e64cb-adbe-466a-804e-6c4a0737fd06":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"290a883d-b2d3-4b4d-97a7-aa73093a4ce8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","$connId":"con_18","$id":"9ff2624c-bf88-44f4-8e21-3d3d85d8b42d","conditions":[{"source":"context","comparison":"equals","values":["Nao"],"variable":"isEmojiOnly"}],"$invalid":false}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Remove emoji from user input | emojiCleanedInput","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    var regex = /(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\u0023-\\u0039]\\ufe0f?\\u20e3|\\u3299|\\u3297|\\u303d|\\u3030|\\u24c2|\\ud83c[\\udd70-\\udd71]|\\ud83c[\\udd7e-\\udd7f]|\\ud83c\\udd8e|\\ud83c[\\udd91-\\udd9a]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\ude01-\\ude02]|\\ud83c\\ude1a|\\ud83c\\ude2f|\\ud83c[\\ude32-\\ude3a]|\\ud83c[\\ude50-\\ude51]|\\u203c|\\u2049|[\\u25aa-\\u25ab]|\\u25b6|\\u25c0|[\\u25fb-\\u25fe]|\\u00a9|\\u00ae|\\u2122|\\u2139|\\ud83c\\udc04|[\\u2600-\\u26FF]|\\u2b05|\\u2b06|\\u2b07|\\u2b1b|\\u2b1c|\\u2b50|\\u2b55|\\u231a|\\u231b|\\u2328|\\u23cf|[\\u23e9-\\u23f3]|[\\u23f8-\\u23fa]|\\ud83c\\udccf|\\u2934|\\u2935|[\\u2190-\\u21ff])/gim;\n \n    return input.replace(regex, \"\"); \n};","inputVariables":["input.content"],"outputVariable":"emojiCleanedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aadf8bc9-d179-464f-8c28-1f01306a5210","type":"ExecuteScript","$title":"Define if is only emoji | isEmojiOnly","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    return input.length < 1 ? 'Sim' : 'Nao';\n}","inputVariables":["emojiCleanedInput"],"outputVariable":"isEmojiOnly","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1cd93245-206e-4ed3-9ada-26c2cfee32a9","type":"TrackEvent","$title":"Apenas emoji validacao | {isEmojiOnly}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{isEmojiOnly}}","category":"Apenas emoji validacao"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"isEmojiOnly"}]},{"$id":"2aee7595-7e7f-49f0-b1a5-14c9b229e611","$typeOfContent":"","type":"SetVariable","$title":"Define exceptionType | E.4.0.5 IF isEmojiOnly EQUALS Sim","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"EX.5.0.5"},"conditions":[{"source":"context","comparison":"equals","variable":"isEmojiOnly","values":["Sim"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6a111ebb-dbf3-4c55-b7e3-cacc69e0f971","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2c3f9247-1f2f-4fcb-90a5-215d189e9706","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2ebbd5c1-2c98-4666-b115-a50eeef5d23c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"d63e64cb-adbe-466a-804e-6c4a0737fd06","root":false,"$title":"V.1.0.2 | É só emoji?","$position":{"top":"653px","left":"2039px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2eb427b6-88d1-4e5a-b2be-124b3487ec7c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a839d7cf-7485-4d9b-9f83-e3d874025ead","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"17029488-1307-40a8-864e-c180e5967a15","$connId":"con_23","$id":"90067d6d-4bef-44d3-b85d-8d80003c00e9","conditions":[{"source":"context","comparison":"equals","values":["Inicio"],"variable":"keyword"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}],"$invalid":false},{"stateId":"682d0d06-8269-4e35-9847-1f4c41f77b74","$connId":"con_28","$id":"20509c52-1419-4d73-b477-3358407a23e6","conditions":[{"source":"context","comparison":"equals","values":["Sair"],"variable":"keyword"}],"$invalid":false},{"stateId":"d5664065-f8b1-45da-a499-64541dabe512","typeOfStateId":"state","$connId":"con_33","$id":"c1ce3fc9-bd91-4de4-8d4f-74004e28e546","conditions":[{"source":"context","comparison":"approximateTo","values":["Voltar"],"variable":"keyword"}],"$invalid":false}],"$enteringCustomActions":[{"type":"SetVariable","$title":"Define keyword | Input inesperado","$invalid":false,"settings":{"variable":"keyword","value":"Input inesperado"},"conditions":[]},{"type":"SetVariable","$title":"Define keyword | Sair","$invalid":false,"settings":{"variable":"keyword","value":"Sair"},"conditions":[{"source":"context","comparison":"approximateTo","variable":"emojiCleanedInput","values":["Sair","Finalizar","Encerrar","Parar","Não quero mais"]}]},{"type":"SetVariable","$title":"Define keyword | Inicio","$invalid":false,"settings":{"variable":"keyword","value":"Inicio"},"conditions":[{"source":"context","comparison":"approximateTo","variable":"emojiCleanedInput","values":["Início","Menu inicial","Voltar ao início","Menu principal","Menu"]},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}]},{"$id":"1fc51801-8cb9-49b0-aae3-06277b6def19","$typeOfContent":"","type":"SetVariable","$title":"Definir keyword | Voltar","$invalid":false,"settings":{"variable":"keyword","value":"Voltar"},"conditions":[{"source":"input","comparison":"matches","values":["[Vv]olta(r)?"]}]}],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Palavra chave validacao | Sim IF keyword DIFFERENT Input inesperado","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave validacao","action":"Sim"},"conditions":[{"source":"context","comparison":"notEquals","variable":"keyword","values":["Input inesperado"]}]},{"type":"TrackEvent","$title":"Palavra chave validacao | Nao IF keyword EQUALS Input inesperado","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave validacao","action":"Nao"},"conditions":[{"source":"context","comparison":"equals","variable":"keyword","values":["Input inesperado"]}]},{"$id":"8552bd91-650e-4a79-b56a-ef9e679c6127","$typeOfContent":"","type":"TrackEvent","$title":"Palavra chave input | {input.content}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"a91e45ee-ec03-4577-b5c2-57a78945bedd","$typeOfContent":"","type":"TrackEvent","$title":"Palavra chave origem | {lastBot} | {origin}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave origem","action":"{{lastBot}} | {{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-ee4f99ca-2b3d-4473-8412-cd9c8b17b17a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-00cf0acc-30f4-432d-b5e3-4d1546269cf0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","root":false,"$title":"V.1.0.3 | É palavra-chave?","$position":{"top":"573px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"17029488-1307-40a8-864e-c180e5967a15":{"$contentActions":[{"action":{"$id":"22c0d20c-0749-405a-b62e-56b8a71a96d9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"455c2045-61cb-4a12-a8f9-675397a05e92","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"455c2045-61cb-4a12-a8f9-675397a05e92","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dccfd024-e914-40e5-b9f5-bf216e684a93","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ad19f16e-3d56-4c99-b803-18f6b7c8b47e","type":"text/plain","content":"Ok, vamos voltar ao <b>menu inicial</b>.","metadata":{}},"$cardContent":{"document":{"id":"ad19f16e-3d56-4c99-b803-18f6b7c8b47e","type":"text/plain","content":"Ok, vamos voltar ao <b>menu inicial</b>."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"96a83f2d-3348-4096-86ec-3ac7902d9981","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$connId":"con_38","$id":"15d28779-3511-4c19-a3ff-1cf95d757ff4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"009524ce-02f6-4906-93bf-abb9a9b9b8bf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(state, stateOriginCascata, env, contaSelecionada, lastInput, intent, serviceName) {\n\ttry {\n\t\tconst parsedState = JSON.parse(state)\n\t\treturn {\n\t\t\tbotDestination: `Bot Main ${env || ''}`.trim(),\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateDestination: contaSelecionada ? '30e39880-1d2a-439a-a0ed-1e7210966286' : 'welcome',\n\t\t\tstateOrigin: stateOriginCascata,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: stateOriginCascata,\n\t\t\tbotDestination: `Bot Main ${env || ''}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state","state.id","config.env","contaSelecionada","input.content","userInput","config.serviceName"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d482be5c-d195-4c6b-9cd4-078080b28f18","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata inicio\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata inicio","action":"Execução"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$invalid":false},"$tags":[{"id":"blip-tag-f93ddd02-6f0a-4026-b18c-bad7225b189c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a5417806-9455-497b-9d1b-5b5393c92b4e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-133bdd1e-69c4-4ae4-a5d5-4488db9493b1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"17029488-1307-40a8-864e-c180e5967a15","root":false,"$title":"V.3.0.0 | Início","$position":{"top":"849px","left":"518px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"682d0d06-8269-4e35-9847-1f4c41f77b74":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"49983deb-100e-40ef-bef5-f0ed40b99f56","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","typeOfStateId":"state","$connId":"con_43","$id":"56ee7620-897d-43fc-8f7c-896a39c6fac6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6b87e2ea-d6ab-4bcd-b23d-6efb5b36d4be","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"CES\"","$invalid":false,"settings":{"variable":"pesquisa","value":"CES"},"conditions":[]},{"$id":"a600c34b-61bc-4f32-90c4-87b0c175b938","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: 'V.2.0.0',\n\t\t\tbotDestination: `finalizacao ${env || ''}`.trim(),\n\t\t\tstateDestination: 'f3581c1e-7b0e-4a12-a9a9-3ae812274b25',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tbotDestination: `Bot Main ${env||''}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3bb4f18a-451b-414d-a6d7-7ee6c27e1376","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata sair\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata sair","action":"Execução"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$invalid":false},"$tags":[{"id":"blip-tag-c26fe1c5-8082-4383-a5f9-719c4625d74d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-26a609b0-2b88-4347-a464-8ab25050ca1e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d41aa7f8-923b-4ca3-82b0-09f2448dbe99","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"682d0d06-8269-4e35-9847-1f4c41f77b74","root":false,"$title":"V.2.0.0 | Sair","$position":{"top":"849px","left":"306px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eab7fb29-aab4-4fe3-9863-aaf7d566f195":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","typeOfStateId":"state","$connId":"con_48","$id":"7fa891ab-e624-49b4-be83-f1535cd57f92","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"keyword"},{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"keyword"}],"$invalid":false},{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","typeOfStateId":"state","$connId":"con_53","$id":"419b74c4-1d02-43c1-9c25-be867a76d625","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","root":false,"$title":"Redireciona ao Serviço","$position":{"top":"1117.68px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bb52d812-0e95-4584-ac15-711f12ee5d34":{"$contentActions":[{"action":{"$id":"7f0a60fe-a313-480d-9f25-77bbb7afa413","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7c6b34a-5eac-4903-b45f-423ede216e21","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7c6b34a-5eac-4903-b45f-423ede216e21","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a0485b27-fc09-493f-bd19-a1a921aac2c1","$typeOfContent":"text","type":"SendMessage","settings":{"id":"4422bfcf-46b5-49b7-b13f-c5f63a6faab8","type":"text/plain","content":"Ok, vou verificar se alguém pode te atender agora.","metadata":{}},"$cardContent":{"document":{"id":"4422bfcf-46b5-49b7-b13f-c5f63a6faab8","type":"text/plain","content":"Ok, vou verificar se alguém pode te atender agora."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"49983deb-100e-40ef-bef5-f0ed40b99f56","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$connId":"con_58","$id":"b7ee5e82-728d-4d4c-a156-e5567c20eaf8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"75fcc0ee-ae52-4f93-bf3b-fe612a880305","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata Transbordo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata Transbordo","action":"Execução"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$invalid":false},"$tags":[{"id":"blip-tag-b16f2374-76d2-48c7-95f5-3b792e1b9a92","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-98b8464d-c202-4381-aa7c-b3875fb3d325","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-5a3c8c5c-b4fe-41fb-817c-af4092b0e8f4","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bb52d812-0e95-4584-ac15-711f12ee5d34","root":false,"$title":"V.4.0.0 | Transbordo","$position":{"top":"859px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0496e4a3-cdab-41fc-bf34-58bd4531ca5c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"44d0ba64-4d21-4ecb-9b10-eedc04cfa0dd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5290ae6c-fa56-45ef-b20b-48b4598219da","$connId":"con_63","$id":"32fb3a30-902c-4325-a2b7-35aea1cb0a93","conditions":[{"source":"context","comparison":"equals","values":["Nao"],"variable":"isInputNotText"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"03e45ef7-8977-4ebe-9ad7-83f5c19f6b0e","$typeOfContent":"","type":"ExecuteScript","$title":"Set input type | inputType","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        if (input.includes('latitude') && input.includes('longitude')) {\n            return 'location';\n        } else if (input.includes('phoneNumber') || input.includes('cellPhoneNumber')) {\n            return 'contact';\n        } else if (input.includes('type')) {\n            input = JSON.parse(input.replace(/\\\\/g, ''));\n            return input.type;\n        }\n        return 'text/plain';\n    } catch (err) {\n        return 'text/plain'\n    }\n}","inputVariables":["input.content"],"outputVariable":"inputType","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2484ff78-34a8-41c9-9548-5d5395ae1418","$typeOfContent":"","type":"ExecuteScript","$title":"Set is input not text | isInputNotText","$invalid":false,"settings":{"function":"run","source":"const run = (inputType) => {\n    return inputType != 'text/plain' ? 'Sim' : 'Nao';\n}","inputVariables":["inputType"],"outputVariable":"isInputNotText","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4c371dc2-e978-4582-bf07-7532d6e5e3c2","$typeOfContent":"","type":"TrackEvent","$title":"Contem midia validacao | {isInputNotText}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Contem midia validacao","action":"{{isInputNotText}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"isInputNotText"}]},{"$id":"6f4c8fcb-a8a9-4085-bcf9-f88252322c30","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exceptionTypeMedia\"","$invalid":false,"settings":{"function":"run","source":"const run = (inputCVType) => {\n    try {\n        const match = matchKey(MEDIA_TYPES, inputCVType);\n        return MEDIA_TYPES[match] || MEDIA_TYPES[\"default\"];\n\n    } catch (e) {\n        return MEDIA_TYPES['default']\n    }\n}\n\nconst MEDIA_TYPES = {\n    \"audio\": \"EX.5.0.0\",\n    \"image\": \"EX.5.0.1\",\n    \"sticker\": \"EX.5.0.1\",\n    \"video\": \"EX.5.0.2\",\n    \"location\": \"EX.5.0.3\",\n    \"file\": \"EX.5.0.4\",\n    \"pdf\": \"EX.5.0.4\",\n    \"emoji\": \"EX.5.0.5\",\n    \"contact\": \"EX.5.0.6\",\n    default: \"E.3.5.0\"\n};\n\n//string extension \"contains\".\nObject.defineProperty(String.prototype, \"contains\", {\n    value: function contains(str) {\n        return this.indexOf(str) > -1;\n    },\n    writable: true,\n    configurable: true\n});\n\nconst matchKey = (options, input) => {\n    return Object.keys(options).find(key => (\n        input.contains(key)\n    ));\n}\n","inputVariables":["inputType"],"outputVariable":"exceptionTypeMedia","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"isInputNotText"}]},{"$id":"4cbab52f-c979-49ca-979b-e66aa1c15714","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"function ValidarConteudo(inputOriginType) {\n    const starts = [\n        \"application/\",\n        \"audio/\",\n        \"video/\",\n        \"image/\",\n        \"link\",\n        \"location\",\n        \"contact\",\n        \"application/zip\"\n    ];\n    const result = starts.find(item => inputOriginType.startsWith(item));\n    return result ? result : 'Não encontrado';\n}\nfunction run(inputContent, inputType) {\n    try {\n        let input = ValidarConteudo(inputType);\n        if (input == 'Não encontrado') {\n            if (inputContent.includes(\"type\")) {\n                return JSON.parse(inputContent.replace(/\\\\/g, '')).type;\n            }\n            else if (inputContent.includes(\"http\")) {\n                return \"link/\";\n            } else if (inputContent.includes(\"latitude\") && inputContent.includes(\"longitude\")) {\n                return \"location\";\n            } else if (inputContent.includes(\"phoneNumber\") || inputContent.includes(\"cellPhoneNumber\")) {\n                return \"contact\";\n            }\n        }\n        return inputContent;\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"teste123","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b6ffa2e2-4406-4fe4-ad66-830ad90e131f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3277daeb-a0cc-4813-acb2-e64acbf533dc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0496e4a3-cdab-41fc-bf34-58bd4531ca5c","root":false,"$title":"V.1.0.0 | É uma imagem, um áudio, local. ou arq.?","$position":{"top":"378px","left":"2036px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d5664065-f8b1-45da-a499-64541dabe512":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"67568262-8c37-40d8-9fc0-5ce7f870bfa9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","typeOfStateId":"state","$connId":"con_68","$id":"e002f1e6-1a05-4b28-aa3c-a8c8175ef051","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b1d55167-3b7f-4747-a6df-437ed72bd665","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"lastVoltarState\"","$invalid":false,"settings":{"function":"run","source":"function run(voltarState, botOrigin) {\n\ttry {\n\t\tconst { botOrigin } = JSON.parse(botOrigin)\n\t\tconst state = JSON.parse(voltarState)\n\t\treturn state[botOrigin][state[botOrigin].length - 1]\n\t} catch (err) {\n\t\treturn 'onboarding'\n\t}\n}","inputVariables":["voltarState","state"],"outputVariable":"lastVoltarState","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6cff0a0e-3901-4f0d-82f8-7bfab8ec6fa5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata voltar\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata voltar","action":"Execução"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c25c0136-bbcb-49dd-9b11-131bf710b1cb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function run(voltarState, botOrigin) {\n\ttry {\n\t\tconst { botOrigin } = JSON.parse(botOrigin)\n\t\tconst state = JSON.parse(voltarState)\n\t\tif (state[botOrigin].length === 0) {\n\t\t\treturn state\n\t\t}\n\t\tstate[botOrigin].pop()\n\t\treturn state\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["voltarState","state"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6406e447-efd9-4eac-8ba1-400fb88924ef","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(voltar, state, stateOrigin, lastInput, intent, env) {\n\ttry {\n\t\tconst parsedState = JSON.parse(state)\n\t\tconst voltarState = JSON.parse(voltar)\n\t\tif (voltar == false) {\n\t\t\tthrow new Error('reset')\n\t\t}\n\n\t\tif (parsedState.botOrigin !== `Bot Main ${env || ''}`.trim() && voltarState[parsedState.botOrigin].length === 0) {\n\t\t\treturn {\n\t\t\t\tbotDestination: `Bot Main ${env || ''}`.trim(),\n\t\t\t\tbotOrigin: 'cascata',\n\t\t\t\tstateDestination: voltarState[`Bot Main ${env || ''}`.trim()][voltarState[`Bot Main ${env || ''}`.trim()].length - 1],\n\t\t\t\tstateOrigin,\n\t\t\t\tlastInput,\n\t\t\t\tintent\n\t\t\t}\n\t\t}\n\t\tconst id = voltarState[parsedState.botOrigin][voltarState[parsedState.botOrigin].length - 1]\n\t\treturn {\n\t\t\tbotDestination: parsedState.botOrigin,\n\t\t\tbotOrigin: 'cascata',\n\t\t\tstateDestination: id,\n\t\t\tstateOrigin,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: 'cascata',\n\t\t\tstateOrigin,\n\t\t\tbotDestination: `Bot Main ${env || ''}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["voltarState","state","state.id","input.content","userInput","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-77287df4-1c63-4d62-8ecf-7c05fa299c57","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7d959e8b-d0b3-425c-bad3-eb0d54b7a1ad","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"d5664065-f8b1-45da-a499-64541dabe512","root":false,"$title":"V.5.0.0 | Voltar","$position":{"top":"877px","left":"1631px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d572c06a-8476-4635-8b8b-daae47879d31","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ccd08df4-3bc4-4e38-807c-bd181e0eb0cf","typeOfStateId":"state","$connId":"con_73","$id":"4e6a5f5d-3432-4e9e-97ea-0351c981a24b","conditions":[{"source":"intent","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}],"$invalid":false},{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","typeOfStateId":"state","$connId":"con_78","$id":"32f49376-122a-44ac-ae96-f604b65d2f0f","conditions":[{"source":"intent","comparison":"notExists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"26ef6a24-b0b2-44c0-a81f-1071c320ad59","$typeOfContent":"","type":"TrackEvent","$title":"Track \"cascata intencao identificada\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"cascata intencao identificada","action":"{{contact.identity}} | {{input.intent.name}}"},"conditions":[{"values":[],"source":"intent","comparison":"exists"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d9913f17-dcfc-4e9e-8c5a-bbd1f646e902","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f","root":false,"$title":"V.1.1.0 | Intenção identificada?","$position":{"top":"410px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ccd08df4-3bc4-4e38-807c-bd181e0eb0cf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fb04a0e5-544e-4a8d-b8a3-09792bee555d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:917"}],"$conditionOutputs":[{"stateId":"745be74e-a31c-4f30-81a9-c2474476f950","typeOfStateId":"state","$connId":"con_83","$id":"85986bde-0e8a-4644-ab06-478a709d657e","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"podeSeguirIntencao@allowed","$$hashKey":"object:937"},{"values":["true"],"source":"context","comparison":"equals","variable":"podeSeguirIntencao@auth","$$hashKey":"object:938"}],"$invalid":false,"$$hashKey":"object:919"},{"stateId":"1b9f31ca-a5f0-4bc9-9bab-6e466d50a324","typeOfStateId":"state","$connId":"con_88","$id":"9756a5b8-0291-4ff5-b1d9-0d96514cab11","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"podeSeguirIntencao@allowed","$$hashKey":"object:964"}],"$invalid":false,"$$hashKey":"object:920"}],"$enteringCustomActions":[{"$id":"15fc5292-d1b2-4180-8dac-11a1e82b5f4a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"podeSeguirIntencao\"","$invalid":false,"settings":{"function":"run","source":"const intentDestination = [\n  {\n    intent: 'Acesso',\n    destinationBlock: 'ed7daa5a-8ec1-479d-b17d-bbdb3093bf90', // [A.2.0.0]\n    destinationBot: 'App',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Alterações cadastrais',\n    destinationBlock: '8dde4e04-03a4-49d0-b329-73923e1d59b7', // [A.3.0.0]\n    destinationBot: 'App',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Alterar domicílio',\n    destinationBlock: 'f2bd8402-1da3-41b4-ad11-2e5d699e3107', // [A.4.0.0]\n    destinationBot: 'App',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Antecipar Saldo',\n    destinationBlock: '16cc5d45-c8d8-4b01-b000-e76eff268c33', // [M.5.3.0]\n    destinationBot: 'Bot Main',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Aplicativo',\n    destinationBlock: 'welcome',\n    destinationBot: 'App',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Baixar aplicativo',\n    destinationBlock: 'b1c8e006-ddb2-4d2a-9832-b66b95b20c0c',\n    destinationBot: 'App',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Condições e taxas',\n    destinationBlock: 'a5ddf643-13c0-4a81-a174-e1aa9dd86873', // [M.5.1.1]\n    destinationBot: 'Bot Main',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Consulta de Protocolo',\n    destinationBlock: '9347f7bd-f145-45c2-8df9-09c201063df1', // S.2.0.0\n    destinationBot: 'Bot Soluções',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Consultar máquinas',\n    destinationBlock: '24ee326c-2f65-4cf1-944e-2b178eaf2a82', // [TC.4.0.0]\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"codigoEc\", \"doc\"],\n    auth: true\n  },\n  {\n    intent: 'Consultar ordem de serviço',\n    destinationBlock: 'fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db', // [OS.2.0.0]\n    destinationBot: 'Bot OS',\n    requirements: [\"doc\"],\n    auth: false\n  },\n  {\n    intent: 'Conta corrente',\n    destinationBlock: '16cc5d45-c8d8-4b01-b000-e76eff268c33', // [M.5.3.0]\n    destinationBot: 'Bot Main',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Contratar antecipacao',\n    destinationBlock: 'a5ddf643-13c0-4a81-a174-e1aa9dd86873', //TC.1.0.0\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"doc\"]\n  },\n  {\n    intent: 'Descredenciamento',\n    destinationBlock: '2c5ecc04-daf8-4fee-ac52-1e4c15182f30', //S.1.0.0\n    destinationBot: 'Bot Soluções', \n    requirements: [\"agencia\", \"doc\"]\n  },\n  {\n    intent: 'Domicílio bancário',\n    destinationBlock: 'ad3f23f8-0c79-4faf-8b19-06ad242f99d2', // [TC.6.0.0]\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"codigoEc\"],\n    auth: true\n  },\n  {\n    intent: 'Erro no aplicativo',\n    destinationBlock: 'fbfdaef0-87b1-4457-9fb2-4e3c3932e3be',\n    destinationBot: 'App', // [A.2.6.0]\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  // {\n  //   intent: 'Extrato Conta Corrente',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  // {\n  //   intent: 'Extrato recebimentos',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  // {\n  //   intent: 'Extrato vendas',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  {\n    intent: 'Extratos',\n    destinationBlock: 'b18c91b6-6d84-4148-a01a-025c0acab39b',  // [M.5.3.1]\n    destinationBot: 'Bot Main',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  // {\n  //   intent: 'Falar com um atendente',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  // {\n  //   intent: 'Falar sobre conta',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  // {\n  //   intent: 'Fazer Pix',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  {\n    intent: 'Máquinas Safrapay',\n    destinationBlock: 'e0d2ce64-3265-46bd-b396-f53ad65b26e6',// [M.5.1.0]\n    destinationBot: 'Bot Main',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'pacotes',\n    destinationBlock: '191a2f33-c58e-4a64-9e66-af23348bcbad', //[CC.3.0.0]\n    destinationBot: 'contacorrente',\n    requirements: [\"agencia\", \"codigoEc\", \"doc\"],\n    auth: false\n  },\n  //      {\n  //   intent: 'Pagar conta',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  // {\n  //   intent: 'Perda ou Roubo',\n  //   destinationBlock: '',\n  //   destinationBot: '',\n  //   requirements: [\"agencia\"]\n  // },\n  {\n    intent: 'Problemas de Login',\n    destinationBlock: 'ed7daa5a-8ec1-479d-b17d-bbdb3093bf90',\n    destinationBot: 'App',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Questionar uma cobrança',\n    destinationBlock: '4a101355-7808-4bb7-a96d-7053a966074a', // [TC.7.0.0]\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"codigoEc\"],\n    auth: true\n  },\n  {\n    intent: 'Simulador de vendas',\n    destinationBlock: 'c391e959-860e-4eaf-86b9-71fcd8888c86', // [MS.2.0.0]\n    destinationBot: 'Bot Máquina Safrapay',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'Suporte Técnico',\n    destinationBlock: '4f6e7e6d-21b4-4b11-9913-6aa5149a7469', //[MS.5.0.0]\n    destinationBot: 'Bot Máquina Safrapay',\n    requirements: [\"agencia\"]\n  },\n  {\n    intent: 'Taxa Pix na SafraPay',\n    destinationBlock: '91dec6e6-2e08-462d-8d81-d38d2b223594', // [TC.5.0.0]\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"codigoEc\"],\n    auth: true\n  },\n  {\n    intent: 'Taxas de antecipação',\n    destinationBlock: 'cac63fde-6671-4aa1-9a67-efc2f5336711', // [TC.3.0.0]\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"codigoEc\"],\n    auth: true\n  },\n  {\n    intent: 'Taxas de venda',\n    destinationBlock: 'c4fec3d1-c20d-43de-9160-8a93f67989eb',  // [TC.2.0.0]\n    destinationBot: 'Bot Taxas e Condições',\n    requirements: [\"agencia\", \"codigoEc\"],\n    auth: true\n  },\n  {\n    intent: 'Venda não recebida',\n    destinationBlock: '4b038e89-c130-4869-a541-4954e12ebf81', // [MS.4.0.0]\n    destinationBot: 'Bot Máquina Safrapay',\n    requirements: [\"agencia\"],\n    auth: false\n  },\n  {\n    intent: 'cartoes',\n    destinationBlock: '37f23f86-2009-43f1-b7a5-f50093c784f0', // CC.2.0.0\n    destinationBot: 'contacorrente',\n    requirements: [\"agencia\"],\n    auth: false\n  }\n\n]\n\nfunction checkVariables(contaSelecionada, selectedEc) {\n  try {\n    let variables = []\n    if (contaSelecionada) {\n      contaSelecionada = JSON.parse(contaSelecionada)\n      const keyContaSelecionada = Object.keys(contaSelecionada)\n      keyContaSelecionada.forEach((key) => {\n        if (contaSelecionada[key]) {\n          return variables.push(key)\n        }\n      })\n    }\n    if (selectedEc) {\n      selectedEc = JSON.parse(selectedEc)\n      const keySelectedEc = Object.keys(selectedEc)\n      keySelectedEc.forEach((key) => {\n        if (selectedEc[key]) {\n          return variables.push(key)\n        }\n      })\n    }\n    return variables\n  } catch (err) {\n    return []\n  }\n}\n\nfunction run(intencaoIdentificada, contaSelecionada, selectedEc) {\n  try {\n    const intent = intentDestination.find(intent => intent.intent.toLowerCase() === intencaoIdentificada.toLowerCase())\n    const userContext = {\n      variables: checkVariables(contaSelecionada, selectedEc),\n      destinationBlock: '',\n      allowed: false,\n      auth: false\n    }\n    if (intent) {\n      if (intent.requirements.length === 0 || intent.requirements[0] === '') {\n        userContext.allowed = true;\n        userContext.destinationBlock = intent.destinationBlock;\n        userContext.destinationBot = intent.destinationBot\n      } else {\n        userContext.allowed = intent.requirements.every(requirement => userContext.variables.includes(requirement));\n        if (userContext.allowed) {\n          userContext.destinationBlock = intent.destinationBlock;\n          userContext.destinationBot = intent.destinationBot\n          userContext.auth = intent.auth\n        }\n      }\n    }\n    return userContext\n  } catch (err) {\n    return {\n      allowed: false,\n      destinationBlock: '',\n      error: err.message\n    }\n  }\n}","inputVariables":["input.intent.name","contaSelecionada","selectedEc"],"outputVariable":"podeSeguirIntencao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d6a4352e-8681-4e6e-9a80-57b953d952cf","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata pode seguir para intencao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata pode seguir para intencao","action":"{{podeSeguirIntencao@allowed}} | {{input.intent.name}} | {{state@botOrigin}} | {{state@stateNameOrigin}} |  {{podeSeguirIntencao@destinationBot}} | {{podeSeguirIntencao@destinationBlock}} | {{podeSeguirIntencao@error}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-de58f4b9-21dd-4c1f-b5fb-7c31fe265cab","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1b768c07-23dc-4065-9700-902fb711d7c5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"ccd08df4-3bc4-4e38-807c-bd181e0eb0cf","root":false,"$title":"V.1.1.1 | Pode ir para menu?","$position":{"top":"410px","left":"804px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1b9f31ca-a5f0-4bc9-9bab-6e466d50a324":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1c894be-7dec-4e0a-abc0-ebec19fb5481","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:704"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"db762318-f104-47b6-af92-909f17e2c40e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(stateDestination, previousStateName, lastInput, intent, serviceName, env, previousBlockId) {\n  try {\n    let match = previousStateName.match(/\\[(.*?)\\]/);\n    let stateNameOrigin = match ? match[1] : previousStateName;\n    const parsedUserContext = JSON.parse(stateDestination)\n    let botDestination = parsedUserContext.destinationBot\n\n    return {\n      botOrigin: serviceName,\n      stateOrigin: previousStateName,\n      stateNameOrigin,\n      botDestination: `${parsedUserContext.destinationBot} ${env || ''}`.trim(),\n      stateDestination: `${parsedUserContext.destinationBlock}`,\n      lastInput: lastInput || intent,\n      intent\n    }\n  } catch (err) {\n    return {\n      botOrigin: serviceName,\n      stateOrigin: previousBlockId,\n      botDestination: `Bot Main ${env || ''}`.trim(),\n      stateDestination: 'welcome',\n      lastInput: lastInput || intent,\n      error: err.message\n    }\n  }\n}","inputVariables":["podeSeguirIntencao","state.previous.name","input.content","userInput","config.serviceName","config.env","state.previous.id"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"43f112a9-c1fc-4b48-a80e-3ac7c78e2a6a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata redirecionamento itencao identificada\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata redirecionamento intencao identificada","action":"Execução"},"conditions":[]},{"$id":"d307522c-a4d9-4f7c-91cf-1516ce90a779","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"{input.intent.name}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{input.intent.name}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"49af42e2-558e-4f66-aa06-46d57f55b607","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"{state@botDestination\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f99b691a-2485-405d-adbe-5a5066b2ea6f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8c08dcb4-3b95-45bd-bc59-237efae9c134","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-49a5eb01-8924-47fa-9d5e-996af9d13563","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1227c0e5-6db6-4ea5-bc2a-58b916d06a0f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1b9f31ca-a5f0-4bc9-9bab-6e466d50a324","root":false,"$title":"Redirecionar a servico Intenção identificada","$position":{"top":"398px","left":"507px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"443b3cfd-efc8-4c50-bca0-b3b0bededdf8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"49da7094-6b9f-4b0c-bfcc-bc716811cce6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"769c7141-9568-474a-8a42-864efa4a8ffc","$typeOfContent":"","type":"TrackEvent","$title":"Tack \"SPD Cascata redirecionamento palavra chave\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata redirecionamento palavra chave","action":"Execução"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a0b45bc0-32c3-4331-91a9-71ea03584574","type":"Redirect","$title":"Redirect to service palavra chave","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4cd61ffd-2691-4c7b-b2c3-7678c7b7bb88","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d930173f-691d-4c9d-b281-392f4c6ef45e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","root":false,"$title":"Redirecionamento palavra chave","$position":{"top":"1373px","left":"806.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#ff0202"}},"61c0e618-6db5-47ae-b2a0-5e6df1d366de":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f28b96d0-7d8c-40c7-9fe5-efae76ffb89a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"75397f2c-0d54-4553-b3d3-cc09b358e42c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata redirecionamento exceptions\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata redirecionamento exceptions","action":"Execução"},"conditions":[]}],"$leavingCustomActions":[{"$id":"52882c4a-3404-417c-a945-44c405ccc3a2","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"exceptionEnv\"","$invalid":false,"settings":{"function":"run","source":"function run(env) {\n\ttry {\n\t\tvar ex = `exception ${env || \"\"}`.trim();\n\t\treturn ex;\n\t}\n\tcatch (err) {\n\t\treturn 'exception';\n\t}\n}","inputVariables":["config.env"],"outputVariable":"exceptionEnv","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"efc4ca6e-2b50-4722-a54d-5a7d31ed2f91","type":"Redirect","$title":"Redirect to service input inesperado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"{{exceptionEnv}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-48289201-548f-4f46-b8f9-af8d0a4d8a46","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-87059d4a-4a93-4d18-bd0b-113e0194f380","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b3fc09ea-e317-4aef-b440-926cae6b92fb","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","root":false,"$title":"Redirecionamento exceptions","$position":{"top":"1365.67px","left":"1351.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fb0000"}},"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"39b81d3e-b518-4385-9178-139df59b8215","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fdc1e734-c8c0-4668-9940-8ea76047b2b7","typeOfStateId":"state","$connId":"con_93","$id":"5de924ca-d1e9-4783-974c-33043c80894a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"bodySmallTalks@analysis.cursed"},{"values":["true"],"source":"context","comparison":"equals","variable":"bodySmallTalks@analysis.cursed"}],"$invalid":false},{"stateId":"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f","typeOfStateId":"state","$connId":"con_98","$id":"b5159fe7-a16b-4c6c-bbe4-8ba0aca48a3a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a920be0e-7cfc-4675-b1da-d3b2a77e2988","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8e408164-fe2e-44bb-bef6-6b7ecd1174c3","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c","root":false,"$title":"Verifica SmallTalks","$position":{"top":"422px","left":"1476px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fdc1e734-c8c0-4668-9940-8ea76047b2b7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6aafc1c-d7e2-4159-bd25-aa81a7f50923","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1084127e-2b59-440a-836b-172ab322617c","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"ofensa\"","$invalid":false,"settings":{"variable":"exceptionType","value":"ofensa"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-44366ca6-b477-4321-89b3-8fcd7726e22f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"fdc1e734-c8c0-4668-9940-8ea76047b2b7","root":false,"$title":"R -> Exceptions (ofensa)","$position":{"top":"248px","left":"1466px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8a85a65c-b3b5-46af-ae85-3f9e25093880":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"88a5941c-fc50-4f9e-b5bf-197f7a70078e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5198f9f6-914a-4757-9118-be1fdb35430f","typeOfStateId":"state","$connId":"con_103","$id":"3f26cd44-5e5e-4ba0-b301-cd393f57acee","conditions":[{"source":"context","comparison":"equals","values":["unauthorized"],"variable":"apiStatus"}],"$invalid":false},{"stateId":"4595bd74-84f9-41de-a46e-c35cb2200532","typeOfStateId":"state","$connId":"con_108","$id":"1fdba152-b6ca-4ec3-a384-57142d3f1af0","conditions":[{"source":"context","comparison":"notEquals","values":["ok"],"variable":"apiStatus"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"apiStatus"},{"values":[],"source":"context","comparison":"exists","variable":"apiStatus"}],"$invalid":false},{"stateId":"0496e4a3-cdab-41fc-bf34-58bd4531ca5c","typeOfStateId":"state","$connId":"con_113","$id":"1533ba85-4405-445b-89df-ff75c7a528ec","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a1c5ba05-81c8-452e-a57a-466e1a384525","$typeOfContent":"","type":"TrackEvent","$title":"Track \"cascata erros de api\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"cascata erros de api","action":"{{contact.identity}} | {{state@stateNameOrigin}} | {{apiStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"apiStatus"},{"values":["ok"],"source":"context","comparison":"notEquals","variable":"apiStatus"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-aab236e6-2261-4d65-a2bf-43a2d671cd4c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"8a85a65c-b3b5-46af-ae85-3f9e25093880","root":false,"$title":"Valida erro de API","$position":{"top":"240px","left":"2036px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5198f9f6-914a-4757-9118-be1fdb35430f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"989438af-f9e0-4a7d-9daa-7c88fc36247f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4595bd74-84f9-41de-a46e-c35cb2200532","typeOfStateId":"state","$connId":"con_118","$id":"5871f2c4-e957-48c3-a6c1-7750c5828019","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusToken"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e2e67c0b-054a-42b6-bf7a-381465fd0c67","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3d7f736-690d-467f-be86-7144ea39c9dd","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"549c7138-3a48-492d-acc2-aca8ee8f38dd","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata erro de api\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata erro de api","action":"Token"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d57df537-ec69-4b4c-ad86-59a2f4f9620b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(state, stateOrigin, env, lastInput, intent) {\n\ttry {\n\t\tconst parsedState = JSON.parse(state)\n\t\treturn {\n\t\t\tbotDestination: parsedState.botOrigin,\n\t\t\tbotOrigin: 'cascata',\n\t\t\tstateDestination: parsedState.stateOrigin,\n\t\t\tstateOrigin,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\tconst parsedState = JSON.parse(state)\n\t\treturn {\n\t\t\tbotOrigin: 'cascata',\n\t\t\tstateOrigin,\n\t\t\tbotDestination: `$Bot Main ${env || ''}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state","state.id","config.env","input.content","userInput"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ac7a175-75c7-4789-8d83-ae49cd76b72d","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusToken"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-76827af7-e1a7-41da-9683-e541a79097c6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fc47eb0c-1d93-4aea-b1bf-8717c2630c44","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-58bda26b-07c1-4826-b88c-043a93e646cc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-90072bcd-09f2-4831-bfaf-0a4571b887a4","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5198f9f6-914a-4757-9118-be1fdb35430f","root":false,"$title":"Gera novo token","$position":{"top":"380px","left":"2444px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4595bd74-84f9-41de-a46e-c35cb2200532":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"09654982-c4c3-46e1-9a20-0b90a8411204","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"95825e4b-a3a9-43a7-9c55-5e1494230187","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"eb0e1af7-2c66-4c0c-85d5-4c77472a1462","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Cascata erro de api\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Cascata erro de api","action":"Erro"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d92c4df7-6cea-47e1-86ce-95f35db96f76","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-613aefe0-bb07-42bf-a268-381bdef858fd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4595bd74-84f9-41de-a46e-c35cb2200532","root":false,"$title":"Erro de api","$position":{"top":"216px","left":"2444px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"745be74e-a31c-4f30-81a9-c2474476f950":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(env, podeSeguirIntencao, intent, previousStateName) {\n\ttry {\n\t\tconst { destinationBlock, destinationBot } = JSON.parse(podeSeguirIntencao)\n\t\treturn {\n\t\t\tbotOrigin: `${destinationBot} ${env || ''}`.trim(),\n\t\t\tstateOrigin: destinationBlock,\n\t\t\tstateNameOrigin: '[V.1.1]',\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["config.env","podeSeguirIntencao","input.intent.name","state.previous.name"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"7c7ae79f-6c05-4d21-866e-aab9d38bf6fe","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"{state@botDestination\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fbdb0ca1-9c40-40cb-bfa0-76cd572f5429","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-76762a18-6814-437b-b0a8-dea468ff00fb","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"745be74e-a31c-4f30-81a9-c2474476f950","root":false,"$title":"Redirect to \"Autenticacao\"","$position":{"top":"181px","left":"804px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b65a4661-93a2-446e-bbb9-fc7405861e2e":{"$contentActions":[{"action":{"$id":"f555cb84-901f-4a8e-99ce-4ee32cc6a05b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"91df1a59-1d8b-40c9-834e-886b45ef4d2b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"91df1a59-1d8b-40c9-834e-886b45ef4d2b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ca77ce7-52ff-41b0-b26b-686fbbed0613","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c065c6c5-41d0-4260-82c0-e5eada83c4bf","type":"text/plain","content":"TESTE","metadata":{}},"$cardContent":{"document":{"id":"c065c6c5-41d0-4260-82c0-e5eada83c4bf","type":"text/plain","content":"TESTE"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f7685964-6449-4f0b-8f40-45936a172a5d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1c4ae103-6bf2-4ec0-b9e0-b7dbd432f328","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b65a4661-93a2-446e-bbb9-fc7405861e2e","root":false,"$title":"[TESTE INTERNO] LOCAL TO DEV","$position":{"top":"42px","left":"1824px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/spdcascatata1","serviceName":"cascata","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","env":"Dev"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}