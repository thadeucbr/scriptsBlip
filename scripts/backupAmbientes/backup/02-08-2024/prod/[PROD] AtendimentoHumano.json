{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"252dbbd6-b37f-4493-9c66-2a0e1f031d98","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"2ea47fda-f02e-4cb9-a540-7a3c9add4168","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"ec5991e0-6921-4f19-9020-ccf05ae07f2f","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"0a06cefe-117c-480f-8dad-bef8fdeb3d3e","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d3b82733-a776-4ee9-916d-e5422b12d3af","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-72dbd30f-ecf8-4ad3-8ab4-48c00bcc26b3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a7819d4c-329c-4c19-b50f-09a041edd481","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"124px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7f9c45f2-07ff-4eea-b5d2-54025bf7b400","type":"text/plain"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"05a0fd9b-f6b2-4a87-9fa8-f4857aca21fa","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"fallback","$title":"Exceções","$position":{"top":"87px","left":"1799.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"action":{"$id":"01b8083e-9389-4ca7-91b0-d8990b31f72a","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"c8acddcc-a1e8-40e0-852c-40157c186304","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1fef7059-7489-4368-8ba0-52602ef029d4","type":"text/plain","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6133102b-a814-4cae-9e58-c06ceb43988b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"error","$title":"Erro padrão","$position":{"top":"76px","left":"2036.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"723cfa31-6e62-457c-808f-058dc7ddc66a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"34902f40-4eef-4315-917a-803d34c9ba2f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5a9c72b7-bfaf-4105-86c1-9cf8be316c37","typeOfStateId":"state","$connId":"con_13","$id":"4b4cdbc2-fa9e-442f-b1c9-63fa70a4a783","conditions":[{"source":"context","comparison":"equals","values":["emp1"],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"9a6f3021-b73e-4a50-8ada-691ed5fecfd8","typeOfStateId":"state","$connId":"con_18","$id":"a4c58c7e-4bd8-4b80-bd9e-2751a6fff41e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"723cfa31-6e62-457c-808f-058dc7ddc66a","root":false,"$title":"[AH.2.0.0] Atendimento Gerentes","$position":{"top":"603px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6fa758ab-c567-4f4d-936e-7e524c091892":{"$contentActions":[{"action":{"type":"SendMessage","settings":{"id":"00d88841-5e7e-45de-9367-198de9ea8e6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00d88841-5e7e-45de-9367-198de9ea8e6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"type":"SendMessage","settings":{"id":"80bc5452-d74d-441e-a85f-4e9a7a6b16e7","type":"text/plain","content":"O horário de atendimento do Gerente Safra Empresas é de segunda à sexta-feira das 09 às 18 horas, exceto feriados. \n\nA Central de Atendimento \nPessoa Jurídica pode ajudar. \n\nPara capitais e Grande São Paulo ligue (11) 3175-8248 e demais localidades ligue 0300 015 7575. \n\nEstamos à sua disposição. \nObrigado!","metadata":{}},"$cardContent":{"document":{"id":"80bc5452-d74d-441e-a85f-4e9a7a6b16e7","type":"text/plain","content":"O horário de atendimento do Gerente Safra Empresas é de segunda à sexta-feira das 09 às 18 horas, exceto feriados. \n\nA Central de Atendimento \nPessoa Jurídica pode ajudar. \n\nPara capitais e Grande São Paulo ligue (11) 3175-8248 e demais localidades ligue 0300 015 7575. \n\nEstamos à sua disposição. \nObrigado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"fd1c385b-7adc-4efb-b829-3b137d4e97c0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"105470a0-0131-4cdb-9db2-b60e0997a97b","$invalid":false,"typeOfStateId":"state"},"id":"6fa758ab-c567-4f4d-936e-7e524c091892","root":false,"$title":"[AH.2.3.0] Fora do horario de atendimento","$position":{"top":"998px","left":"508px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-47d908fa-3aff-49e4-9ffa-9a5d6a98d3f8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"isAiGenerated":false},"bf1d18c3-7de4-4f75-8817-239b4fcf993c":{"$contentActions":[{"action":{"$id":"6e13eac5-fc9c-49df-a244-6baa2ef031b0","type":"SendMessage","settings":{"id":"c4f46f4c-ec10-47ad-bd24-3ffd077aa4ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4f46f4c-ec10-47ad-bd24-3ffd077aa4ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7fde6a79-d777-480b-8b47-30fc27ac8363","type":"SendMessage","settings":{"id":"9665efe7-68a1-4825-8aba-6f4f5ba46ccf","type":"text/plain","content":"Aguarde, você está sendo direcionado para o seu gerente. Essse processo pode levar algum tempo, agradecemos a sua paciência e compreensão. \n\nEm breve, você será atendido!","metadata":{}},"$cardContent":{"document":{"id":"9665efe7-68a1-4825-8aba-6f4f5ba46ccf","type":"text/plain","content":"Aguarde, você está sendo direcionado para o seu gerente. Essse processo pode levar algum tempo, agradecemos a sua paciência e compreensão. \n\nEm breve, você será atendido!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e1146dc1-320e-4b16-919a-a4ba2a3937f3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5abc748a-ad8b-4166-b0d2-eb7c11595684","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5abc748a-ad8b-4166-b0d2-eb7c11595684","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"88dac9fc-12c7-4c38-b3a4-83bc258ef941","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0ce371b3-ffd7-4bda-9f1e-6b4d7e53a47b","type":"text/plain","content":"Se desejar, você pode digitar *SAIR* a qualquer momento para encerrar o atendimento.","metadata":{}},"$cardContent":{"document":{"id":"0ce371b3-ffd7-4bda-9f1e-6b4d7e53a47b","type":"text/plain","content":"Se desejar, você pode digitar *SAIR* a qualquer momento para encerrar o atendimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"4fb59875-a2a3-4d4d-b35f-bcb11ff38d46","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1d08cfc6-9698-4d24-a308-9bb5e400957f","typeOfStateId":"state","$connId":"con_23","$id":"2f1a0e23-54c7-438a-a8b9-e6e59b29d8d3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a53ca151-6fd2-4cd6-accb-a14de3ac1037","$typeOfContent":"","type":"MergeContact","$title":"Set \"team\" to \"{contaSelecionada@filaGerente}\"","$invalid":false,"settings":{"extras":{"team":"{{contaSelecionada@filaGerente}}"}},"conditions":[]},{"$id":"4e622200-43e6-4594-97cc-ad409b0d503f","$typeOfContent":"","type":"MergeContact","$title":"Set \"team\" if \"broadcast\"","$invalid":false,"settings":{"extras":{"team":"Default"}},"conditions":[{"values":["reativacao_emp1","reativacao_emp1_v2"],"source":"context","comparison":"equals","variable":"contact.extras.broadcastOrigem"}]},{"$id":"b3c31a6d-2b9c-4517-bbaa-e963a099e245","type":"SetVariable","$title":"Set \"tunnelMain\" to \"{tunnel.identity}\"","$invalid":false,"settings":{"variable":"tunnelMain","value":"{{tunnel.identity}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-5a6e35c3-d0c1-4133-bf5f-3d94f4049653","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-c3e4d994-f3e7-45a7-a083-e8ad1ed4f422","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e02dc781-eacf-4bf8-9fef-2c7554d004ce","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bf1d18c3-7de4-4f75-8817-239b4fcf993c","root":false,"$title":"[AH.2.4.0] Define fila de atendimento","$position":{"top":"960px","left":"1026px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5a9c72b7-bfaf-4105-86c1-9cf8be316c37":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c0f606a-c029-4381-89c3-726e5df5c07e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bf1d18c3-7de4-4f75-8817-239b4fcf993c","$connId":"con_28","conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}],"$invalid":false,"$id":"77727111-c15f-4795-9b2f-163be66ffac7","typeOfStateId":"state"},{"stateId":"6fa758ab-c567-4f4d-936e-7e524c091892","$connId":"con_33","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime"}],"$invalid":false,"$id":"6412da4c-8e08-4fc1-a1d7-33f6bde1b36f"}],"$enteringCustomActions":[{"$id":"ad5b301e-f8b8-46e1-8c6e-d10d95682442","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP horario","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/horarios-atendimentos/v1/horarios-atendimentos?idFila={{config.botIdentity}}&team=default","responseStatusVariable":"statusIsWorkTime","responseBodyVariable":"bodyIsWorkTime"},"conditions":[]},{"$id":"ecf75b13-2b1e-4f31-aa04-a4a33d34bd9a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"isWorkTime\"","$invalid":false,"settings":{"function":"run","source":"function run(retornoAPI) {\n    try {\n        const obj = JSON.parse(retornoAPI);\n        return obj.data.isWorkTime;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["bodyIsWorkTime"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"STATUS API HORARIO","$invalid":false,"settings":{"extras":{},"category":"Status API Horario","action":"{{statusIsWorkTime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-5dd91ed8-171b-4104-966f-20620dbb892c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-ad70a4d6-0441-44cc-a83b-dc600520b81c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6dd73c71-e8be-4616-9daf-60255270fa8b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5a9c72b7-bfaf-4105-86c1-9cf8be316c37","root":false,"$title":"[AH.2.2.0] Api horario atendimento","$position":{"top":"807px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"9a6f3021-b73e-4a50-8ada-691ed5fecfd8":{"$contentActions":[{"action":{"$id":"2bfbd566-a6bd-40a8-8c6f-1c2914248525","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa4aecac-8402-497e-aa9a-f3dc5a922c43","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa4aecac-8402-497e-aa9a-f3dc5a922c43","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c2f90b7f-40e7-49a0-a578-9587dac0f05f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2ea5920a-16e7-4c00-b2cd-68f28a90de0f","type":"text/plain","content":"Neste caso, pedimos por gentileza que entre em contato com o seu gerente.\nPara isso, siga as seguintes instruções:\n• Internet Banking:\n1. Acesse a página inicial.\n2. Clique no menu superior direito.\n3. Selecione a opção \"Meu Gerente\".\n4. As informações do gerente serão apresentadas em um card.\n• Mobile:\n1. Vá para a tela inicial.\n2. No canto superior direito, toque no ícone de gerente ao lado esquerdo da lupa.\n3. As informações do gerente serão exibidas.","metadata":{}},"$cardContent":{"document":{"id":"2ea5920a-16e7-4c00-b2cd-68f28a90de0f","type":"text/plain","content":"Neste caso, pedimos por gentileza que entre em contato com o seu gerente.\nPara isso, siga as seguintes instruções:\n• Internet Banking:\n1. Acesse a página inicial.\n2. Clique no menu superior direito.\n3. Selecione a opção \"Meu Gerente\".\n4. As informações do gerente serão apresentadas em um card.\n• Mobile:\n1. Vá para a tela inicial.\n2. No canto superior direito, toque no ícone de gerente ao lado esquerdo da lupa.\n3. As informações do gerente serão exibidas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"84ad3053-d033-4c09-93d8-404f7f0b1a3c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"12bba0f4-d1e2-4c3f-8496-7df481f83955","typeOfStateId":"state","$connId":"con_38","$id":"59360793-dff3-48ad-b1f1-44beb502897d","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@doc"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"500a7166-13c4-46cc-ae76-b1230f80203b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e29e2125-dcbb-4b87-8663-c1440c4438f2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9a6f3021-b73e-4a50-8ada-691ed5fecfd8","root":false,"$title":"[AH.2.0.1] Finalização segmento emp2","$position":{"top":"592px","left":"259px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7d220bd-2237-49f4-88ec-14c555bf202c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c7d220bd-2237-49f4-88ec-14c555bf202c","root":false,"$title":"[GO TO][Redirect] WhatsApp PJ (atendente)","$position":{"top":"1110px","left":"1400px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"105470a0-0131-4cdb-9db2-b60e0997a97b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0c844a7a-b117-4e2d-bc85-73d33d6015e3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0f1f0516-752f-48c2-b7cd-def3add6559a","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"105470a0-0131-4cdb-9db2-b60e0997a97b","root":false,"$title":"[Redirect] To  Finalizacao (Welcome)","$position":{"top":"67px","left":"1052px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1d08cfc6-9698-4d24-a308-9bb5e400957f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"98dd806d-c9af-4ade-8243-750f87466651","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"09702f26-b5f2-4f37-9a47-3a2b230b9854","type":"Redirect","$title":"Redirect to \"emp1\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"emp1"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c439da0b-3610-483d-9e75-fec00d279766","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1d08cfc6-9698-4d24-a308-9bb5e400957f","root":false,"$title":"[Redirect] to Emp1","$position":{"top":"1220px","left":"1026px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"12bba0f4-d1e2-4c3f-8496-7df481f83955":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"805099b3-4e7f-45e0-bd67-34404bac3d14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"105470a0-0131-4cdb-9db2-b60e0997a97b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"12bba0f4-d1e2-4c3f-8496-7df481f83955","root":false,"$title":"[GO TO][Redirect] To  Finalizacao (Welcome)","$position":{"top":"381px","left":"259px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"500a7166-13c4-46cc-ae76-b1230f80203b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6ca42239-a1e1-41db-9c2b-eb11b6c46ec9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9553fade-24d3-4dc7-ab82-8f4e9e10ddfb","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"500a7166-13c4-46cc-ae76-b1230f80203b","root":false,"$title":"[Redirect] To  Finalizacao (Finalizar)","$position":{"top":"67px","left":"1248px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1bf05d26-3661-4d02-a79a-a83bc40e7346":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: '7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3b140d14-6075-444e-9270-2a63c25e0695","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8ae2c4a4-6ce4-4a3f-b231-9fb1069c0263","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1bf05d26-3661-4d02-a79a-a83bc40e7346","root":false,"$title":"[Redirect] To Autenticacao & Retorno [Redirect] PJ","$position":{"top":"340.429px","left":"1033.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"ec5991e0-6921-4f19-9020-ccf05ae07f2f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e1d4832-050e-4133-8da2-c0bbf0d541bc","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"723cfa31-6e62-457c-808f-058dc7ddc66a","typeOfStateId":"state","$connId":"con_43","$id":"7c50d3d1-2d8a-41ae-aceb-7a0f442cd3b8","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"1bf05d26-3661-4d02-a79a-a83bc40e7346","typeOfStateId":"state","$connId":"con_48","$id":"eb90e6f8-288c-4ff3-b3d6-79180d18912d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"ec5991e0-6921-4f19-9020-ccf05ae07f2f","$title":"[AH.0.0.0] Valida segmento (PJ|Gerentes)","$position":{"top":"363px","left":"703px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44":{"$contentActions":[{"action":{"$id":"7f941396-4934-45f0-9dc3-bdc641a2a46f","type":"SendMessage","settings":{"id":"a215588f-64c1-43a5-84dc-76ceae43297b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a215588f-64c1-43a5-84dc-76ceae43297b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8f0bfdac-f580-473e-948a-c74131d5bdf9","type":"SendMessage","settings":{"id":"b21f1c5f-478e-4d74-bf85-f673d0d51df8","type":"text/plain","content":"Aguarde um momento que logo um especialista irá atender","metadata":{}},"$cardContent":{"document":{"id":"b21f1c5f-478e-4d74-bf85-f673d0d51df8","type":"text/plain","content":"Aguarde um momento que logo um especialista irá atender"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ede93084-4fe4-4395-bc74-d31c784f5300","type":"SendMessage","settings":{"id":"66079202-6213-4dd3-91e4-0a3e270a6162","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"66079202-6213-4dd3-91e4-0a3e270a6162","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"87a9a62b-859f-4da9-8de2-c5e582110fb1","type":"SendMessage","settings":{"id":"70ea6af4-3bf8-45fa-88ce-f854a96ab651","type":"text/plain","content":"Se você não conseguir esperar ou se quiser finalizar essa conversa, é só digitar *SAIR*","metadata":{}},"$cardContent":{"document":{"id":"70ea6af4-3bf8-45fa-88ce-f854a96ab651","type":"text/plain","content":"Se você não conseguir esperar ou se quiser finalizar essa conversa, é só digitar *SAIR*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"80981a49-20a3-44ec-812f-373e8f6e5d52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94a68d08-0bfc-492c-bc82-4dbe570d9cfe","typeOfStateId":"state","$connId":"con_53","$id":"3bd394bd-b531-4fc8-ad1d-08b660a69194","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"830565da-0123-4152-a31a-1e9e7144b7bd","type":"ExecuteScript","$title":"Seta Equipe","$invalid":false,"settings":{"function":"run","source":"function run(numeroSegmento, naoCliente, inputIntencao, tag, broadcast, logistica, template) {\r\n\r\n    numeroSegmento = parseInt(numeroSegmento)\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Suporte_Tecnico\") {\r\n        return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Safrapay_Digital\") {\r\n        return \"WhatsApp_Safrapay_Digital\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Prata_Bronze_Empresas\") {\r\n        return \"WhatsApp_Prata_Bronze_Empresas\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Perda_Roubo\") {\r\n        return \"WhatsApp_Perda_Roubo\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Middle\") {\r\n        return \"WhatsApp_Middle\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Large_Corporate\") {\r\n        return \"WhatsApp_Large_Corporate\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Empresas2\") {\r\n        return \"WhatsApp_Empresas2\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Empresas1\") {\r\n        return \"WhatsApp_Empresas1\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Default\") {\r\n        return \"WhatsApp_Default\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Corporate\") {\r\n        return \"WhatsApp_Corporate\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Caça_POS\") {\r\n        return \"WhatsApp_Caça_POS\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: WhatsApp_Atacado\") {\r\n        return \"WhatsApp_Atacado\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Safra_Limites_Operacionais\") {\r\n        return \"Safra_Limites_Operacionais\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Descred_Safrapay_Digital\") {\r\n        return \"Descred_Safrapay_Digital\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Mesa_de_Vendas\") {\r\n        return \"Mesa_de_Vendas\"\r\n    }\r\n\r\n    if (tag == \"Transferir para: Descred_Emp1\") {\r\n        return \"Descred_Emp1\"\r\n    }\r\n    if (broadcast == \"mesa_arv_estabelecimento_natal\" || broadcast == \"mesa_arv_estabelecimento\" || broadcast == \"antecipacao_avulsa_3003\" || broadcast == \"antecipacao_avulsa_pag_func_3003\" || broadcast == \"antecipacao_cancelada_3003\" || broadcast == \"antecipacao_cancelada_pag_func_3003\" || broadcast == \"antecipacao_nunca_antecipou_3003\" || broadcast == \"antecipacao_nunca_antecipou_pag_func_3003\" || broadcast == \"antecipacao_d15_d30_3003\" || broadcast == \"antecipacao_d15_d30_pag_func_3003\" || broadcast == \"arv_eventual_contratacao_abandono_2\" || broadcast == \"arv_eventual_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_2\" || broadcast == \"arv_automatico_contratacao_abandono_3\" || broadcast == \"taxa_esp_mesaarv_bus_1809_v2\") {\r\n        return \"Mesa_Arv\"\r\n    }\r\n    if (logistica == \"sim\") {\r\n        return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n\r\n    if (inputIntencao == \"Perda ou Roubo\") {\r\n        return \"WhatsApp_Perda_Roubo\"\r\n    }\r\n\r\n\r\n\r\n    const digital = [5, 18, 19, 21];\r\n\r\n    const atacado = [8, 11, 13];\r\n\r\n    const empresas = [14, 6, 7, 10, 16, 20, 22, 30];\r\n\r\n    const largeCorporate = [1, 2, 4, 15]\r\n\r\n\r\n\r\n    if (inputIntencao == \"Desejo falar sobre a notificação de inatividade da minha máquina SafraPay\" || broadcast == \"devolucao_maquinas\" || template == \"devolucao_maquinas\" || broadcast == \"devolucao_maquinas_v2\" || template == \"devolucao_maquinas_v2\" || broadcast == \"devolucao_maquinas_v3\" || template == \"devolucao_maquinas_v3\") {\r\n        return \"WhatsApp_Caça_POS\"\r\n    }\r\n\r\n    if (broadcast == \"caca_pos_nao_inatividade\" || template == \"caca_pos_nao_inatividade\" || broadcast == \"caca_pos_nao_inatividade_v2\" || template == \"caca_pos_nao_inatividade_v2\" || broadcast == \"caca_pos_nao_inatividade_v3\" || template == \"caca_pos_nao_inatividade_v3\") {\r\n        return \"whatsapp_caca_canceladas\"\r\n    }\r\n\r\n    if (inputIntencao == \"Suporte Tecnico\") {\r\n        return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n    if (inputIntencao == \"Descredenciamento\" && numeroSegmento == 20) {\r\n        return \"Descred_Emp1\"\r\n    }\r\n\r\n    if (inputIntencao == \"Vendas Online\") {\r\n        return \"Whatsapp_TEF_Ecommerce\"\r\n    }\r\n\r\n    if (digital.includes(numeroSegmento)) {\r\n\r\n        if (inputIntencao == \"Descredenciamento\") {\r\n            return \"Descred_Safrapay_Digital\"\r\n        }\r\n\r\n        return \"WhatsApp_Safrapay_Digital\"\r\n    }\r\n\r\n    if (empresas.includes(numeroSegmento)) {\r\n        return \"WhatsApp_Empresas1\";\r\n    }\r\n\r\n    if (numeroSegmento == 3) {\r\n        return \"WhatsApp_Corporate\"\r\n    }\r\n\r\n    if (numeroSegmento == 9) {\r\n        return \"WhatsApp_Middle\"\r\n    }\r\n\r\n    if (numeroSegmento == 17) {\r\n        return \"WhatsApp_Empresas2\"\r\n    }\r\n\r\n\r\n    if (atacado.includes(numeroSegmento)) {\r\n        return \"WhatsApp_Atacado\";\r\n    }\r\n\r\n    if (largeCorporate.includes(numeroSegmento)) {\r\n        return \"WhatsApp_Large_Corporate\"\r\n    }\r\n\r\n    if (naoCliente == 'true') {\r\n        return \"Mesa_de_Vendas\";\r\n    }\r\n\r\n    return \"WhatsApp_Default\";\r\n\r\n}","inputVariables":["numeroSegmento","naoCliente","input.content","responseTags","contact.extras.broadcastOrigem","logistica","contact.extras.campaignMessageTemplate"],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1f27b7fd-44a0-4cd7-a456-346e5c20792b","type":"ExecuteScript","$title":"Compacta Equipe","$invalid":false,"settings":{"function":"run","source":"function run(setaEquipe) {\n    const equipe = setaEquipe;\n    const compactaEquipe = equipe.replace(/_/gi, \"\")\n    return compactaEquipe;\n}","inputVariables":["setaEquipe"],"outputVariable":"compactaEquipe","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1fba3e3f-bf1c-4512-be96-8ce8934ef8a9","type":"ProcessHttp","$title":"HTTP - SUBSCRIBE INATIVIDADE","$invalid":false,"settings":{"headers":{"X-Blip-User":"{{tunnel.identity}}","X-Blip-Bot":"{{config.botIdentity}}","X-Desk-Team":"{{compactaEquipe}}"},"method":"POST","body":"{\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n}","uri":"{{config.urlTake}}/v1/Subscription/Subscribe","responseStatusVariable":"statusInatividade"},"conditions":[]},{"$id":"8393e21c-9fb9-4514-90a3-030744cd83f0","type":"ProcessCommand","$title":"GET ATTENDANTS","$invalid":false,"settings":{"to":"postmaster@desk.msging.net","method":"get","uri":"/attendants?$take=99999","variable":"attendants"},"conditions":[]},{"$id":"4dc54cc2-fcec-4dc4-802d-1f431949fe74","type":"ExecuteScript","$title":"CHECK ATTENDANT STATUS","$invalid":false,"settings":{"function":"run","source":"function run(attendants, agentEmail) {\n    if (!agentEmail || agentEmail == 'undefined') {\n        return false;\n    } else {\n        attendants = JSON.parse(attendants).resource.items;\n        const attendant = attendants.filter(function (a) {\n            return a.identity == encodeURIComponent(agentEmail) + '@blip.ai';\n        });\n        return attendant.length > 0 ? attendant[0].status == 'Online' : false;\n    }\n}","inputVariables":["attendants","contact.extras.agentEmail"],"outputVariable":"atendenteOnline","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"contains","variable":"contact.extras.Equipe","values":["@"]}]},{"$id":"5759876f-125b-4c17-b33b-f06b0d2aca3c","type":"ExecuteScript","$title":"Autenticado ?","$invalid":false,"settings":{"function":"run","source":"function run (autenticado) {\n    if (autenticado == \"true\"){\n        return 'Sim'\n    } else return 'Não'\n}","inputVariables":["autenticado"],"outputVariable":"auth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"eb25ca8f-64db-4a0c-8812-337090b4a732","$typeOfContent":"","type":"ProcessCommand","$title":"Processar comando","$invalid":false,"settings":{"to":"postmaster@desk.msging.net","method":"get","uri":"/teams/agents-online","variable":"teams"},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"eeaf5ac3-5450-47bd-b7c3-1f4bf4b59ea2","$typeOfContent":"","type":"ProcessHttp","$title":"Verifica Resource","$invalid":false,"settings":{"headers":{"Authorization":"{{config.apiKey}}","Content-Type":"application/json"},"method":"POST","body":"{\n    \"id\": \"{{random.guid}}\",\n    \"method\": \"get\",\n    \"uri\": \"/resources/{{contact.extras.ec}}\"\n}","uri":"{{config.commands}}","responseStatusVariable":"statusResource","responseBodyVariable":"bodyResource"},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"4373aa70-33cd-45ac-b876-5ee268680e9d","$typeOfContent":"","type":"ExecuteScript","$title":"Carteira MEsa_ARV","$invalid":false,"settings":{"function":"run","source":"function run(result) {\n\n    const result = JSON.parse(result);\n\n    if (result.status == \"success\") {\n        return result.resource;\n    }\n    return \"Mesa_Arv\"\n\n}","inputVariables":["bodyResource"],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"95dd5844-5a4b-4c65-8e37-19d99970302b","$typeOfContent":"","type":"ExecuteScript","$title":"Seta Equipe Resource","$invalid":false,"settings":{"function":"run","source":"function run() {\n  try {\n    const selectTeam = '{{setaEquipe}}'.split('|')[0];\n    const { resource } = JSON.parse('{{teams}}');\n\n    if (!resource) return 'Mesa_Arv';\n\n    const atendente = resource.items.find(\n      (fila) => fila.name === selectTeam && fila.agentsOnline > 0\n    );\n    if (atendente) return atendente.name;\n\n    return 'Mesa_Arv';\n  } catch (error) {\n    return 'Mesa_Arv';\n  }\n}","inputVariables":[],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"fila","values":["Mesa_Arv"]}]},{"$id":"7a4b4991-10ef-4f8d-86a6-08052315f273","type":"MergeContact","$title":"setaEquipe","$invalid":false,"settings":{"extras":{"Autenticação":"{{auth}}","Equipe":"{{setaEquipe}}","TAG":"{{responseTags}}"}},"conditions":[]},{"$id":"62a90736-ca02-49d5-acff-4d198bdb5166","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"Equipe":"{{responseTeam}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"aguardandoRetorno","values":["true"]}]},{"$id":"a7cbde79-a11d-4182-b185-7b42ee889ac6","type":"SetVariable","$title":"finalizacaoAtendimentoBot","$invalid":false,"settings":{"variable":"finalizacaoAtendimentoBot","value":"true"},"conditions":[]},{"$id":"96fe93cf-bdcb-4456-8c50-e9e6ea349be3","type":"MergeContact","$title":"VPO AGENTEMAIL","$invalid":false,"settings":{"extras":{"Equipe":"{{agentIdentity}}"}},"conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.extras.agentEmail"},{"source":"context","comparison":"equals","variable":"responseTags","values":["Inatividade Cliente"]},{"source":"context","comparison":"contains","variable":"setaEquipe","values":["Mesa_de_Vendas"]}]},{"$id":"0a7ba6ac-b42d-44fb-a984-e5b7bb010397","type":"MergeContact","$title":"RESET AGENTEMAIL","$invalid":false,"settings":{"extras":{"Equipe":"Mesa_de_Vendas"}},"conditions":[{"source":"context","comparison":"contains","variable":"contact.extras.Equipe","values":["@"]},{"source":"context","comparison":"notEquals","variable":"atendenteOnline","values":["true"]}]}],"$leavingCustomActions":[{"$id":"43c05027-7726-4a34-a0f6-c3dcba05b65f","$typeOfContent":"","type":"TrackEvent","$title":"autoservicoAtendimento","$invalid":false,"settings":{"extras":{},"category":"autoservicoAtendimento","action":"1"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"autoservico"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94a68d08-0bfc-492c-bc82-4dbe570d9cfe","$invalid":false},"$tags":[{"id":"blip-tag-d2628c5c-38ae-4f0f-a059-faeb43f804ca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6522774d-3467-4fe5-bdc3-1ec095eae1f8","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-43384e9d-c62c-47a2-8466-71767dadeea5","label":"ProcessCommand","background":"#FC91AE","canChangeBackground":false},{"id":"blip-tag-30dd5e84-8d99-458f-93de-9178c0a14659","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-a78be6c0-0024-4b98-beb5-ca99e6898b1f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8f8de798-a684-4208-a932-2ce1f329eb64","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-25169f0c-8351-47c3-a4f8-1b55992197a7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44","root":false,"$title":"Pré Transbordo Contingência","$position":{"top":"704px","left":"1400px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"94a68d08-0bfc-492c-bc82-4dbe570d9cfe":{"$contentActions":[{"action":{"$id":"9176ce0e-1c29-4578-9ca6-a6e62ea82e9f","type":"SendMessage","settings":{"id":"a0832bb1-e5a6-417a-834f-f1e7d18c6f46","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a0832bb1-e5a6-417a-834f-f1e7d18c6f46","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d932805d-65cd-473f-8338-2fe139ea9268","type":"SendMessage","settings":{"id":"2e6f3188-a20c-4c82-97ff-5c211e9ab6d3","type":"text/plain","content":"{{msgMensagemInformativa}}","metadata":{}},"$cardContent":{"document":{"id":"2e6f3188-a20c-4c82-97ff-5c211e9ab6d3","type":"text/plain","content":"{{msgMensagemInformativa}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c7812143-dd8c-49c1-86f9-0c268e9a7795","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$connId":"con_58","$id":"7e37c3f9-87d4-45a9-92c3-59e331f233b7","conditions":[{"source":"context","comparison":"contains","values":["Transferir"],"variable":"responseTags"}],"$invalid":false,"typeOfStateId":"state","stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c"},{"stateId":"b58718a4-907a-43af-b61c-1cf7c5d934a1","typeOfStateId":"state","$connId":"con_63","$id":"40c924b5-a382-49b8-aeb3-a497c0312090","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5199afbb-600f-4b68-9edf-14c0a912ae27","type":"ExecuteScript","$title":"msg","$invalid":false,"settings":{"function":"run","source":"function run(setaEquipe, fila) {\n    if (setaEquipe == \"Mesa_de_Vendas\") {\n        return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 30 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n    }\n\n    if (setaEquipe == \"Produto\" || setaEquipe == \"Operacional\" || setaEquipe == \"IndicadosCSI\" || setaEquipe == \"WhatsApp_Caça_POS\" || setaEquipe == \"Safra_Limites_Operacionais\") {\n        return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 10 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n    }\n\n    if (setaEquipe == \"Descred_Safrapay_Digital\") {\n        return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 9 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n    }\n    if (setaEquipe == \"Mesa_Arv\" || fila == \"Mesa_Arv\" || setaEquipe == \"Logistica_hypo_varejo\" || fila == \"Logistica_hypo_varejo\") {\n        return \"\"\n    }\n    return \"Mensagem Informativa! Precisamos que você fique sempre ativo na conversa, pois caso eu envie alguma mensagem e você fique 5 min sem retornar, a conversa será encerrada Automaticamente pelo sistema. Continuamos trabalhando sempre, para melhorar cada vez mais seu atendimento!\"\n\n}","inputVariables":["setaEquipe","fila"],"outputVariable":"msgMensagemInformativa","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3016e4fa-12e4-42a5-b75d-5ef7d65ced75","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"assuntoTransferencia","value":"{{assunto}}"},"conditions":[]},{"$id":"df857880-d13c-426d-9f66-42805cf237ab","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"assuntoTransferencia","action":"{{assuntoTransferencia}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"assuntoTransferencia"}]}],"$leavingCustomActions":[{"$id":"7e2744f9-8640-41d1-8844-fc60ee325021","$typeOfContent":"","type":"SetVariable","$title":"limpa msg","$invalid":false,"settings":{"variable":"msgMensagemInformativa"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"b58718a4-907a-43af-b61c-1cf7c5d934a1","$invalid":false},"$tags":[{"id":"blip-tag-6c0859ad-a539-4a44-a291-ab3599abbd89","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7f0df072-036a-40ec-982e-d193628ca798","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e0a3d0a2-4d27-47b4-be67-e18c97d37b49","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b5ed5821-2901-4c13-bbc0-aa995fa4e152","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"94a68d08-0bfc-492c-bc82-4dbe570d9cfe","root":false,"$title":"Mensagem Informativa","$position":{"top":"906px","left":"1400px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"b58718a4-907a-43af-b61c-1cf7c5d934a1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a08654e-301e-4dda-8b1e-b55c2549bc3d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$connId":"con_68","$id":"ad811c2e-f9cf-419e-a983-b8aa63316a17","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false,"typeOfStateId":"state","stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c"}],"$enteringCustomActions":[{"$id":"72e66603-bb1f-4908-b469-a1a8637e38a5","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - GET TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusTokenFront","responseBodyVariable":"bodyTokenFront"},"conditions":[]},{"$id":"4d28dded-341b-4e3a-9041-c87d6cdb58ce","$typeOfContent":"","type":"ExecuteScript","$title":"JS - GET TOKEN","$invalid":false,"settings":{"function":"run","source":"function run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyTokenFront"],"outputVariable":"tokenFront","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusTokenFront","values":["200"]}]},{"$id":"e6c4d466-1e9d-42c3-87cf-2a084cc0586d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP SOLICITA FILA PERFIL HIBRIDO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{tokenFront}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.gateway}}/chat-assistente/atendimentos-hibridos/v1/perfils/{{setaEquipe}}","responseStatusVariable":"statusFila","responseBodyVariable":"bodyFila"},"conditions":[{"source":"context","comparison":"equals","variable":"statusTokenFront","values":["200"]}]},{"$id":"d6e705b5-0593-415d-9c41-4e5ab1519c34","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CODIGOPERFIL HIBRIDO","$invalid":false,"settings":{"function":"run","source":"function run(bodyFila) {\n\n  const {data:{codigoPerfil}} = JSON.parse(bodyFila);\n\n    return codigoPerfil || 0\n}","inputVariables":["bodyFila"],"outputVariable":"codigoPerfil","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200","202"]}]},{"$id":"083e5df0-94fa-4411-a712-966469ea6840","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CRIAR PAYLOAD","$invalid":false,"settings":{"function":"run","source":"\nfunction run(random, codigoPerfil, dataTime, documento) {\n\n    let callId = random\n    if (documento == null) {\n        documento = \"0\"\n    }\n    const payload = {\n        \"callId\": callId,\n        \"cpfCnpj\": documento,\n        \"dataHoraInclusao\": dataTime,\n        \"usuarioInclusao\": \"WAPJ\",\n        \"idCanal\":\"6\",\n        \"parametrosBilhete\": [\n            {\n                \"callId\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"CodigoPerfilHibrido\",\n                \"valor\": codigoPerfil\n            },\n            {\n                \"callid\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"IDENTIFICACAOTOKEN\",\n                \"valor\": \"15\"\n            }\n        ]\n    }\n    return payload;\n}","inputVariables":["random.guid","codigoPerfil","calendar.datetime","cpf"],"outputVariable":"payloadBilhetes","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200","202"]}]},{"$id":"706726ae-b4b9-44aa-bdd0-f8ac82df3a7c","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CRIAR PAYLOAD Cliente PJ","$invalid":false,"settings":{"function":"run","source":"function run(random, codigoPerfil, dataTime, documento) {\n\n    let callId = random\n    if (documento == null) {\n        documento = \"0\"\n    }\n    const payload = {\n        \"callId\": callId,\n        \"cpfCnpj\": documento,\n        \"dataHoraInclusao\": dataTime,\n        \"usuarioInclusao\": \"WAPJ\",\n        \"idCanal\": \"6\",\n        \"parametrosBilhete\": [\n            {\n                \"callId\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"CodigoPerfilHibrido\",\n                \"valor\": codigoPerfil\n            },\n            {\n                \"callid\": callId,\n                \"cpfCnpj\": documento,\n                \"chave\": \"IDENTIFICACAOTOKEN\",\n                \"valor\": \"15\"\n            }\n        ]\n    }\n    return payload;\n}","inputVariables":["random.guid","codigoPerfil","calendar.datetime","cnpj"],"outputVariable":"payloadBilhetes","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200","202"]},{"source":"context","comparison":"equals","variable":"tipoPessoa","values":["PJ"]}]},{"$id":"63f5606b-1f9c-49ce-86df-6eee44b01bb4","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - CRIA BILHETE FRONT UNICO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{tokenFront}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"POST","body":"{{payloadBilhetes}}","uri":"{{config.gateway}}/chat-assistente/atendimentos-hibridos/v1/bilhetes","responseStatusVariable":"statusBilhete","responseBodyVariable":"bodyBilhete"},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200"]}]},{"$id":"82e64acb-cb13-4a2f-9d04-7fcb79032244","$typeOfContent":"","type":"ExecuteScript","$title":"JS - CRIA URL DO FRONT UNCIO","$invalid":false,"settings":{"function":"run","source":"function run(bodyBilhete) {\n\n    try {\n\n        const { data: { url } } = JSON.parse(bodyBilhete);\n\n        return url;\n\n    } catch (e) {\n\n        return 'Não informada'\n\n    }\n\n}","inputVariables":["bodyBilhete"],"outputVariable":"urlFrontUnico","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusFila","values":["200"]}],"continueOnError":true},{"$id":"da16c3c7-1b2d-42b4-9532-38f22d71adeb","$typeOfContent":"","type":"ExecuteScript","$title":"Separa call id","$invalid":false,"settings":{"function":"run","source":"\nfunction run(callId) {\n\n    const id = callId.split(\"callid=\")[1] || \"não identificado\";\n\n    return id;\n\n}\n","inputVariables":["urlFrontUnico"],"outputVariable":"callID","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"f9ba124b-a1c5-4467-b4fb-27bea1cc792e","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CONTATO URL FRONT UNICO","$invalid":false,"settings":{"extras":{"urlFront":"{{urlFrontUnico}}","codigoPerfil":"{{codigoPerfil}}","callID":"{{callID}}"}},"conditions":[{"source":"context","comparison":"notEquals","variable":"codigoPerfil","values":["0"]}]},{"$id":"77a23849-387c-488e-8a8b-a5cf7fbcfe0e","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CONTATO URL FRONT","$invalid":false,"settings":{"extras":{"urlFront":"{{urlFrontUnico}}"}},"conditions":[{"source":"context","comparison":"equals","variable":"codigoPerfil","values":["0"]}]},{"$id":"47511a20-2341-4de6-9c31-9ee2678acc7c","$typeOfContent":"","type":"MergeContact","$title":"URL VPO","$invalid":false,"settings":{"extras":{"urlVPO":"https://portalspa-sp2-hml.safracredenciadora.com.br/vpo-backoffice-b/core/receptive-chat/tabulador?telefone={{phoneNumber}}"}},"conditions":[{"source":"context","comparison":"contains","variable":"fila","values":["Mesa_de_Vendas"]}]}],"$leavingCustomActions":[{"$id":"626b6740-d0d5-4695-b35c-a0846188955b","$typeOfContent":"","type":"ExecuteScript","$title":"horaMin","$invalid":false,"settings":{"function":"run","source":"function run(offset) {\n    offset = parseFloat(offset);\n    let now = new Date();\n    let utc_timestamp = Date.UTC(\n        now.getUTCFullYear(),\n        now.getUTCMonth(),\n        now.getUTCDate(),\n        now.getUTCHours(),\n        now.getUTCMinutes(),\n        now.getUTCSeconds(),\n        now.getUTCMilliseconds()\n    );\n\n    let dataCompleta =  new Date(utc_timestamp + (offset + 3) * 3600 * 1000);\n    let  dataHora = dataCompleta.getHours() + \":\" + dataCompleta.getMinutes();\n    return dataHora;\n}","inputVariables":["config.dateTimeOffset"],"outputVariable":"horaMin","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"877076ee-2c26-4434-b85b-5361c540ed40","$typeOfContent":"","type":"ExecuteScript","$title":"hora","$invalid":false,"settings":{"function":"run","source":"function run(offset) {\n    offset = parseFloat(offset);\n    let now = new Date();\n    let utc_timestamp = Date.UTC(\n        now.getUTCFullYear(),\n        now.getUTCMonth(),\n        now.getUTCDate(),\n        now.getUTCHours(),\n        now.getUTCMinutes(),\n        now.getUTCSeconds(),\n        now.getUTCMilliseconds()\n    );\n\n    let dataCompleta =  new Date(utc_timestamp + offset * 3600 * 1000);\n    let dataHora = dataCompleta.getHours() + 3;\n    return dataHora;\n}","inputVariables":["config.dateTimeOffset"],"outputVariable":"hora","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3304c1c7-25df-42f5-8a99-4fd22530a7d5","$typeOfContent":"","type":"TrackEvent","$title":"horaMin","$invalid":false,"settings":{"extras":{},"category":"horaMin","action":"{{horaMin}}"},"conditions":[]},{"$id":"c22902b0-1c46-4b2d-84a6-6271a06575f4","$typeOfContent":"","type":"TrackEvent","$title":"hora","$invalid":false,"settings":{"extras":{},"category":"hora","action":"{{hora}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c"},"$tags":[{"id":"blip-tag-2ac8d6e0-842b-4559-8cba-836b5fbe44e5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-dc921da5-4de4-459b-96f8-77af96b4d3ee","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c88beb83-228f-4471-91dd-2d840e3275ab","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-58eab910-c527-4852-bbf6-8421efec277e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"b58718a4-907a-43af-b61c-1cf7c5d934a1","root":false,"$title":"Perfil Hibrido","$position":{"top":"1025px","left":"1729.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c7b0f22e-f89f-4086-a4df-2bf1cd25ca45","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bd7da39a-aed6-4c2d-a325-06ca753cf1ad","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cf8373d3-151d-412a-a273-e4aeae4112ee","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"$tags":[{"id":"blip-tag-657e75f3-acee-4a24-993e-f41888d30efa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2fee774b-1622-4aa2-a4dc-8e6f40496ac3","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"7788f7e6-ff23-4cb7-8ebb-ac837c1dc5c8","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"68.5714px","left":"1441.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"23ef6fd4-86e8-42c5-a2cc-a2f68461ea9d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"80981a49-20a3-44ec-812f-373e8f6e5d52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44","typeOfStateId":"state","$connId":"con_73","$id":"282b4493-f492-422a-86fa-2efc320575d6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"39107b13-104e-49c9-a7ad-f614795639e6","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"atendimento","value":"humano"},"conditions":[]},{"$id":"f4f918ef-23e5-4482-b881-e0b8124a3c6d","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"Humano","action":"1"},"conditions":[]},{"$id":"830565da-0123-4152-a31a-1e9e7144b7bd","type":"ExecuteScript","$title":"Seta Equipe","$invalid":false,"settings":{"function":"run","source":"const tags = {\r\n  'Transferir para: WhatsApp_Suporte_Tecnico': 'WhatsApp_Suporte_Tecnico',\r\n  'Transferir para: WhatsApp_Safrapay_Digital': 'WhatsApp_Safrapay_Digital',\r\n  'Transferir para: WhatsApp_Prata_Bronze_Empresas': 'WhatsApp_Prata_Bronze_Empresas',\r\n  'Transferir para: WhatsApp_Perda_Roubo': 'WhatsApp_Perda_Roubo',\r\n  'Transferir para: WhatsApp_Middle': 'WhatsApp_Middle',\r\n  'Transferir para: WhatsApp_Large_Corporate': 'WhatsApp_Large_Corporate',\r\n  'Transferir para: WhatsApp_Empresas2': 'WhatsApp_Empresas2',\r\n  'Transferir para: WhatsApp_Empresas1': 'WhatsApp_Empresas1',\r\n  'Transferir para: WhatsApp_Default': 'WhatsApp_Default',\r\n  'Transferir para: WhatsApp_Corporate': 'WhatsApp_Corporate',\r\n  'Transferir para: WhatsApp_Caça_POS': 'WhatsApp_Caça_POS',\r\n  'Transferir para: WhatsApp_Atacado': 'WhatsApp_Atacado',\r\n  'Transferir para: Safra_Limites_Operacionais': 'Safra_Limites_Operacionais',\r\n  'Transferir para: Descred_Safrapay_Digital': 'Descred_Safrapay_Digital',\r\n  'Transferir para: Mesa_de_Vendas': 'Mesa_de_Vendas',\r\n  'Transferir para: Descred_Emp1': 'Descred_Emp1',\r\n}\r\n\r\nconst filasBroadcasts = {\r\n  'Mesa_de_Vendas': [\r\n    'mesa_arv_estabelecimento_natal',\r\n    'mesa_arv_estabelecimento',\r\n    'antecipacao_avulsa_3003',\r\n    'antecipacao_avulsa_pag_func_3003',\r\n    'antecipacao_cancelada_3003',\r\n    'antecipacao_cancelada_pag_func_3003',\r\n    'antecipacao_nunca_antecipou_3003',\r\n    'antecipacao_nunca_antecipou_pag_func_3003',\r\n    'antecipacao_d15_d30_3003',\r\n    'antecipacao_d15_d30_pag_func_3003',\r\n    'arv_eventual_contratacao_abandono_2',\r\n    'arv_eventual_contratacao_abandono_1',\r\n    'arv_automatico_contratacao_abandono_1',\r\n    'arv_automatico_contratacao_abandono_2',\r\n    'arv_automatico_contratacao_abandono_3',\r\n    'taxa_esp_mesaarv_bus_1809_v2',\r\n  ],\r\n  'WhatsApp_Caça_POS': [\r\n    'devolucao_maquinas',\r\n    'devolucao_maquinas_v2',\r\n    'devolucao_maquinas_v3',\r\n  ],\r\n  'whatsapp_caca_canceladas': [\r\n    'caca_pos_nao_inatividade',\r\n    'caca_pos_nao_inatividade_v2',\r\n    'caca_pos_nao_inatividade_v3',\r\n  ],\r\n}\r\n\r\nconst filasPorSegmento = {\r\n  digital: [5, 18, 19, 21],\r\n  atacado: [8, 11, 13],\r\n  empresas: [14, 6, 7, 10, 16, 20, 22, 30],\r\n  largeCorporate: [1, 2, 4, 15]\r\n}\r\n\r\nconst filasPorInput = {\r\n  'Perda ou Roubo': 'WhatsApp_Perda_Roubo',\r\n  'Suporte Tecnico': 'WhatsApp_Suporte_Tecnico',\r\n  'Descredenciamento': 'Descred_Emp1',\r\n  'Vendas Online': 'Whatsapp_TEF_Ecommerce',\r\n}\r\n\r\nconst segmentosExclusivos = {\r\n  3: 'WhatsApp_Corporate',\r\n  9: 'WhatsApp_Middle',\r\n  17: 'WhatsApp_Empresas2',\r\n}\r\nfunction run(numeroSegmento, naoCliente, inputIntencao, tag, broadcast, logistica, template) {\r\n  try {\r\n    numeroSegmento = parseInt(numeroSegmento)\r\n\r\n    if (tag) {\r\n      if (tags[tag]) {\r\n        return tags[tag]\r\n      }\r\n    }\r\n\r\n    if (broadcast || template) {\r\n      if (filasBroadcasts.Mesa_de_Vendas.includes(broadcast) || filasBroadcasts.Mesa_de_Vendas.includes(template)) {\r\n        return \"Mesa_de_Vendas\"\r\n      }\r\n      if (filasBroadcasts.WhatsApp_Caça_POS.includes(broadcast) || filasBroadcasts.WhatsApp_Caça_POS.includes(template)) {\r\n        return \"WhatsApp_Caça_POS\"\r\n      }\r\n      if (filasBroadcasts.whatsapp_caca_canceladas.includes(broadcast) || filasBroadcasts.whatsapp_caca_canceladas.includes(template)) {\r\n        return \"whatsapp_caca_canceladas\"\r\n      }\r\n    }\r\n\r\n    if (logistica == \"sim\") {\r\n      return \"WhatsApp_Suporte_Tecnico\"\r\n    }\r\n\r\n    if (filasPorInput[inputIntencao]) {\r\n      return filasPorInput[inputIntencao]\r\n    }\r\n\r\n    if (filasPorSegmento.digital.includes(numeroSegmento)) {\r\n      if (inputIntencao == \"Descredenciamento\") {\r\n        return \"Descred_Safrapay_Digital\"\r\n      }\r\n      return \"WhatsApp_Safrapay_Digital\"\r\n    }\r\n\r\n    if (filasPorSegmento.empresas.includes(numeroSegmento)) {\r\n      return \"WhatsApp_Empresas1\";\r\n    }\r\n\r\n    if (segmentosExclusivos[numeroSegmento]) {\r\n      return segmentosExclusivos[numeroSegmento]\r\n    }\r\n\r\n    if (filasPorSegmento.atacado.includes(numeroSegmento)) {\r\n      return \"WhatsApp_Atacado\";\r\n    }\r\n\r\n    if (filasPorSegmento.largeCorporate.includes(numeroSegmento)) {\r\n      return \"WhatsApp_Large_Corporate\"\r\n    }\r\n\r\n    if (naoCliente == 'true') {\r\n      return \"Mesa_de_Vendas\";\r\n    }\r\n\r\n    return \"WhatsApp_Default\";\r\n  } catch (err) {\r\n    return 'WhatsApp_Default'\r\n  }\r\n}","inputVariables":["numeroSegmento","naoCliente","input.content","responseTags","contact.extras.broadcastOrigem","logistica","contact.extras.campaignMessageTemplate"],"outputVariable":"setaEquipe","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"18d8ef55-bf7f-439d-be90-3c4348650248","type":"MergeContact","$title":"Equipe","$invalid":false,"settings":{"extras":{"Equipe":"{{setaEquipe}}"}},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"4256ecc3-d3c4-4d29-bfcf-8ef2c96b1f44"},"$tags":[{"id":"blip-tag-b88bf76b-fa44-4d76-b8e6-ccd17868c82b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1a87e640-9f4c-440d-b6ef-51e4672e3d19","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7562132b-f53f-4c16-8e38-02c25a4f78e6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-16cc13d6-c02f-4d72-859e-66026624ca90","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"23ef6fd4-86e8-42c5-a2cc-a2f68461ea9d","root":false,"$title":"Pré Transbordo","$position":{"top":"536px","left":"1400px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"6ea6c988-da8c-4bec-9510-cbc0dab53b9a":{"$contentActions":[{"action":{"$id":"268a1f86-d0c9-4856-ba17-d9cd37437932","type":"SendMessage","settings":{"id":"7cbe2711-1a9f-4d45-bf44-5d967d2a8c9f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7cbe2711-1a9f-4d45-bf44-5d967d2a8c9f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a45b98df-5cae-40ce-98c9-f547b9a9bae0","type":"SendMessage","settings":{"id":"876e1204-6e7c-4689-ba59-c6433b1bbe02","type":"text/plain","content":"{{msgForaHorarioAtendimento}}","metadata":{}},"$cardContent":{"document":{"id":"876e1204-6e7c-4689-ba59-c6433b1bbe02","type":"text/plain","content":"{{msgForaHorarioAtendimento}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"336384a1-4ae2-41a7-bc88-5710a3a825e4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"9c3390ba-b3cb-4700-9553-3d1303dbe6dd","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"Fora horário","action":"1"},"conditions":[]},{"$id":"37a18ef2-e1b2-46d0-8f8a-6cb115f3009e","type":"SetVariable","$title":"estado","$invalid":false,"settings":{"variable":"estado","value":"Fora do Horario de Atendimento"},"conditions":[]},{"$id":"f2d2dc23-0c26-43e9-aa0b-9e42ea3e4250","type":"ExecuteScript","$title":"mensagens","$invalid":false,"settings":{"function":"run","source":"function run(fila) {\n\n    if (fila == \"Mesa_de_Vendas\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Suporte_Tecnico\"  || fila == \"Whatsapp_TEF_Ecommerce\") {\n        return \"O atendimento neste canal está disponível de segunda a sexta das 8h00 às 21h00, exceto feriados. Para suporte técnico de sua maquininha Safrapay/Ecommerce, entre em contato por telefone no número 11 3175-8248 para Capital e Grande São Paulo ou 0300 015 7575 para demais localidades, atendimento disponível 24 horas por dia e 7 dias por semana.\"\n\n    }\n\n    if (fila == \"WhatsApp_Perda_Roubo\") {\n        return \"Para esta solicitação nosso horário de atendimento pelo whatsApp é de Segunda a Sexta das 8h00 às 21h00, exceto feriados!\\n\\\nNossos contatos para atendimento fora desse horário são (11)3175-8248 para Capital e Grande São Paulo e 0300 015 7575 Demais localidades. Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Safra_Limites_Operacionais\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Mesa_Arv\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Descred_Safrapay_Digital\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"Descred_Emp1\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Atacado\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Large_Corporate\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Corporate\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Middle\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Safrapay_Digital\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Empresas1\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Empresas2\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Premium_Empresas2\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Premium_Empresas1\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Premium_Digital\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Caça_POS\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Prata_Bronze_Empresas\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 18h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n    if (fila == \"WhatsApp_Default\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 8h00 às 21h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n    if (fila == \"Logistica_hypo_varejo\") {\n        return \"Para esta solicitação nosso horário de atendimento é de Segunda a Sexta das 9h00 às 17h00, exceto feriados! Por favor, retorne o contato!\";\n    }\n\n}","inputVariables":["fila"],"outputVariable":"msgForaHorarioAtendimento","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"289f5f48-c0df-4ae3-bc60-ad2f3a59a654","type":"SetVariable","$title":"limpa msg","$invalid":false,"settings":{"variable":"msgForaHorarioAtendimento"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"500a7166-13c4-46cc-ae76-b1230f80203b"},"$tags":[{"id":"blip-tag-79bca123-6861-4186-8aa7-228a7c219087","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ca80745f-a47b-48dd-83d9-607c731821cc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b9d147e8-c1c6-4db1-b123-b75736b24260","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3df0da4f-38a3-468b-b512-89a68095d285","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6ea6c988-da8c-4bec-9510-cbc0dab53b9a","root":false,"$title":"Fora do Horario de Atendimento","$position":{"top":"527px","left":"1870.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5998b844-bc9d-46a5-93b9-923ec229b8a6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c7b0f22e-f89f-4086-a4df-2bf1cd25ca45","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$connId":"con_78","$id":"7a90a052-27fd-4aa5-865d-79fb8094cf88","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWeekend"}],"$invalid":false,"typeOfStateId":"state","stateId":"6ea6c988-da8c-4bec-9510-cbc0dab53b9a"},{"stateId":"23ef6fd4-86e8-42c5-a2cc-a2f68461ea9d","$connId":"con_83","$id":"554c25e7-3aa1-47e7-a25f-ea655f7bbcec","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a919f2e8-55ac-4ad1-87f9-8bb9cda2190b","type":"SetVariable","$title":"estado","$invalid":false,"settings":{"variable":"estado","value":"Verifica Horario de Atendimento"},"conditions":[]},{"$id":"2ffae401-1e27-45ac-ad57-51030ad63325","$typeOfContent":"","type":"ExecuteScript","$title":"SETA FILA VOLTA DE INATIVIDADE","$invalid":false,"settings":{"function":"run","source":"\nfunction run(team) {\n    return team\n}\n","inputVariables":["responseTeam"],"outputVariable":"fila","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"aguardandoRetorno","values":["true"]}]},{"$id":"a8867d9f-f581-4d2e-9fda-377636c2ce8c","type":"ExecuteScript","$title":"seta equipe para fila","$invalid":false,"settings":{"function":"run","source":"function run(numeroSegmento, naoCliente, inputIntencao, tag, broadcast, logistica, template) {\n\n    numeroSegmento = parseInt(numeroSegmento)\n\n    if (tag == \"Transferir para: WhatsApp_Suporte_Tecnico\") {\n        return \"WhatsApp_Suporte_Tecnico\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Safrapay_Digital\") {\n        return \"WhatsApp_Safrapay_Digital\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Prata_Bronze_Empresas\") {\n        return \"WhatsApp_Prata_Bronze_Empresas\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Perda_Roubo\") {\n        return \"WhatsApp_Perda_Roubo\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Middle\") {\n        return \"WhatsApp_Middle\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Large_Corporate\") {\n        return \"WhatsApp_Large_Corporate\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Empresas2\") {\n        return \"WhatsApp_Empresas2\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Empresas1\") {\n        return \"WhatsApp_Empresas1\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Default\") {\n        return \"WhatsApp_Default\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Corporate\") {\n        return \"WhatsApp_Corporate\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Caça_POS\") {\n        return \"WhatsApp_Caça_POS\"\n    }\n\n    if (tag == \"Transferir para: WhatsApp_Atacado\") {\n        return \"WhatsApp_Atacado\"\n    }\n\n    if (tag == \"Transferir para: Safra_Limites_Operacionais\") {\n        return \"Safra_Limites_Operacionais\"\n    }\n\n    if (tag == \"Transferir para: Descred_Safrapay_Digital\") {\n        return \"Descred_Safrapay_Digital\"\n    }\n\n    if (tag == \"Transferir para: Mesa_de_Vendas\") {\n        return \"Mesa_de_Vendas\"\n    }\n\n    if (tag == \"Transferir para: Descred_Emp1\") {\n        return \"Descred_Emp1\"\n    }\n    if (broadcast == \"mesa_arv_estabelecimento_natal\" || broadcast == \"mesa_arv_estabelecimento\" || broadcast == \"antecipacao_avulsa_3003\" || broadcast == \"antecipacao_avulsa_pag_func_3003\" || broadcast == \"antecipacao_cancelada_3003\" || broadcast == \"antecipacao_cancelada_pag_func_3003\" || broadcast == \"antecipacao_nunca_antecipou_3003\" || broadcast == \"antecipacao_nunca_antecipou_pag_func_3003\" || broadcast == \"antecipacao_d15_d30_3003\" || broadcast == \"antecipacao_d15_d30_pag_func_3003\" || broadcast == \"arv_eventual_contratacao_abandono_2\" || broadcast == \"arv_eventual_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_1\" || broadcast == \"arv_automatico_contratacao_abandono_2\" || broadcast == \"arv_automatico_contratacao_abandono_3\" || broadcast == \"taxa_esp_mesaarv_bus_1809_v2\") {\n        return \"Mesa_Arv\"\n    }\n    if (logistica == \"sim\") {\n        return \"WhatsApp_Suporte_Tecnico\"\n    }\n\n\n    if (inputIntencao == \"Perda ou Roubo\") {\n        return \"WhatsApp_Perda_Roubo\"\n    }\n\n\n\n    const digital = [5, 18, 19, 21];\n\n    const atacado = [8, 11, 13];\n\n    const empresas = [14, 6, 7, 10, 16, 20, 22, 30];\n\n    const largeCorporate = [1, 2, 4, 15]\n\n\n\n    if (inputIntencao == \"Desejo falar sobre a notificação de inatividade da minha máquina SafraPay\" || broadcast == \"devolucao_maquinas\" || template == \"devolucao_maquinas\" || broadcast == \"devolucao_maquinas_v2\" || template == \"devolucao_maquinas_v2\" || broadcast == \"devolucao_maquinas_v3\" || template == \"devolucao_maquinas_v3\") {\n        return \"WhatsApp_Caça_POS\"\n    }\n\n    if (broadcast == \"caca_pos_nao_inatividade\" || template == \"caca_pos_nao_inatividade\" || broadcast == \"caca_pos_nao_inatividade_v2\" || template == \"caca_pos_nao_inatividade_v2\" || broadcast == \"caca_pos_nao_inatividade_v3\" || template == \"caca_pos_nao_inatividade_v3\") {\n        return \"whatsapp_caca_canceladas\"\n    }\n\n    if (inputIntencao == \"Suporte Tecnico\") {\n        return \"WhatsApp_Suporte_Tecnico\"\n    }\n\n    if (inputIntencao == \"Descredenciamento\" && numeroSegmento == 20) {\n        return \"Descred_Emp1\"\n    }\n\n    if (inputIntencao == \"Vendas Online\") {\n        return \"Whatsapp_TEF_Ecommerce\"\n    }\n\n    if (digital.includes(numeroSegmento)) {\n\n        if (inputIntencao == \"Descredenciamento\") {\n            return \"Descred_Safrapay_Digital\"\n        }\n\n        return \"WhatsApp_Safrapay_Digital\"\n    }\n\n    if (empresas.includes(numeroSegmento)) {\n        return \"WhatsApp_Empresas1\";\n    }\n\n    if (numeroSegmento == 3) {\n        return \"WhatsApp_Corporate\"\n    }\n\n    if (numeroSegmento == 9) {\n        return \"WhatsApp_Middle\"\n    }\n\n    if (numeroSegmento == 17) {\n        return \"WhatsApp_Empresas2\"\n    }\n\n\n    if (atacado.includes(numeroSegmento)) {\n        return \"WhatsApp_Atacado\";\n    }\n\n    if (largeCorporate.includes(numeroSegmento)) {\n        return \"WhatsApp_Large_Corporate\"\n    }\n\n    if (naoCliente == 'true') {\n        return \"Mesa_de_Vendas\";\n    }\n\n    return \"WhatsApp_Default\";\n\n}","inputVariables":["numeroSegmento","naoCliente","input.content","responseTags","contact.extras.broadcastOrigem","logistica","contact.extras.campaignMessageTemplate"],"outputVariable":"fila","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"notEquals","variable":"aguardandoRetorno","values":["true"]}]},{"$id":"fc02b706-e55b-4fb6-89bf-fb89e351323f","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN API HORÁRIO","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"a95952de-616f-4de6-8c75-e47fec80f7c9","type":"ProcessHttp","$title":"API - HORARIO","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/horarios-atendimentos/v1/horarios-atendimentos?idFila={{config.botIdentity}}&team={{fila}}","responseStatusVariable":"statusIsWorkTime","responseBodyVariable":"bodyAPIHorario"},"conditions":[]},{"$id":"a6f09c55-f963-4f85-a0fd-d2f5a515f48c","$typeOfContent":"","type":"ExecuteScript","$title":"TRATA RETORNO API HORÁRIO","$invalid":false,"settings":{"function":"run","source":"function run (retornoAPI) {\n    const obj = JSON.parse(retornoAPI);\n\n    return obj.data.isWorkTime;\n}","inputVariables":["bodyAPIHorario"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusIsWorkTime"}],"continueOnError":false},{"$id":"574fe18b-f170-424c-98f3-c5524e05da34","type":"ExecuteScript","$title":"dentro ou fora do horario de atendimento","$invalid":false,"settings":{"function":"run","source":"function run(isWorkTime) {\n\n    const label = isWorkTime == 'true' ? \"Dentro\" : \"Fora\"\n    return label;\n\n}","inputVariables":["isWorkTime"],"outputVariable":"labelHorario","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0a9fc40a-42ca-4b29-835a-d9ef5d7b7068","type":"ExecuteScript","$title":"Converte Data e Hora","$invalid":false,"settings":{"function":"run","source":"function run() {\n\n    var hoje = new Date();\n    \n    let day = hoje.getDate() < 10 ? '0' + hoje.getDate() : hoje.getDate();\n    let month = hoje.getMonth() + 1;\n    const newDate = `${day}/${month < 10 ? '0' + month : month}/${hoje.getFullYear()} - ${hoje.getHours() < 10 ? '0' + hoje.getHours() : hoje.getHours()}:${hoje.getMinutes()}:${hoje.getSeconds() < 10 ? '0' + hoje.getSeconds() : hoje.getSeconds()}`\n    return newDate;\n}","inputVariables":[],"outputVariable":"dataHoraBR","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b6f52c9-a57f-4afb-bada-c6905cf5fc3b","$typeOfContent":"","type":"ExecuteScript","$title":"Work Fim de Semana","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const now = new Date().toLocaleString(\"en-US\", { timeZone: \"America/Sao_Paulo\" });\n    const weekDay = new Date(now).getDay();\n\n    if (weekDay == \"0\" || weekDay == \"6\") {\n        return true;\n    }\n\n    return false;\n}","inputVariables":[],"outputVariable":"isWeekend","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cf1b4d8-3287-4982-85ee-b284ef61922b","type":"TrackEvent","$title":"Derivação","$invalid":false,"settings":{"extras":{},"category":"Derivação","action":"{{dataHoraBR}}|{{phoneClient}}|{{labelHorario}}"},"conditions":[]},{"$id":"e9c9deff-51ab-49de-b02b-c32e5772016d","type":"TrackEvent","$title":"Horário de Atendimento Detalhado","$invalid":false,"settings":{"extras":{},"category":"Horário de Atendimento Detalhado","action":"{{dataHoraBR}}|{{labelHorario}}"},"conditions":[]},{"$id":"2b18aa84-8b0f-4ae3-bf8e-cd2d02710959","type":"TrackEvent","$title":"Horário de Atendimento Volume dentro","$invalid":false,"settings":{"extras":{},"category":"Horário de Atendimento - Volume","action":"Dentro"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}]},{"$id":"afb7795e-682d-4997-ab55-e785e03031da","type":"TrackEvent","$title":"Horário de Atendimento Volume fora","$invalid":false,"settings":{"extras":{},"category":"Horário de Atendimento - Volume","action":"Fora"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["false"]}]},{"$id":"a3ef328c-71f8-4371-83e0-167083558077","type":"TrackEvent","$title":"Teste - Derivação","$invalid":false,"settings":{"extras":{},"category":"Teste - Derivação - {{fila}}","action":"{{dataHoraBR}}-{{phoneClient}}-{{labelHorario}}"},"conditions":[]},{"$id":"f8d0aa3a-1c97-4c97-a914-95cba208ce77","type":"TrackEvent","$title":"Teste - Horário de Atendimento Detalhado","$invalid":false,"settings":{"extras":{},"category":"Teste - Horário de Atendimento Detalhado - {{fila}}","action":"{{dataHoraBR}}|{{labelHorario}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a1247b09-f8d0-4524-8620-3978ffe4a0a0","type":"TrackEvent","$title":"Teste - Horário de Atendimento - Volume","$invalid":false,"settings":{"extras":{},"category":"Teste - Horário de Atendimento - Volume - {{fila}}","action":"Dentro"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["true"]}]},{"$id":"bc2fe563-3a8f-4d49-b8ce-95ed22a35d26","type":"TrackEvent","$title":"Teste - Horário de Atendimento - Volume","$invalid":false,"settings":{"extras":{},"category":"Teste - Horário de Atendimento - Volume - {{fila}}","action":"Fora"},"conditions":[{"source":"context","comparison":"equals","variable":"isWorkTime","values":["false"]}]},{"$id":"2c6ebab9-deae-492e-bf10-1fb7e9ae9c84","$typeOfContent":"","type":"TrackEvent","$title":"Status API DE HORARIO","$invalid":false,"settings":{"extras":{},"category":"Status API DE HORARIO","action":"Data - {{calendar.datetime}} - Cel - {{phoneClient}} - Status - {{statusIsWorkTime}} - MSG {{bodyAPIHorario}}"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusIsWorkTime","values":["200"]}]}],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"6ea6c988-da8c-4bec-9510-cbc0dab53b9a"},"$tags":[{"id":"blip-tag-80ece2c8-28a3-4cd5-96d6-608e84e7436c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-140ad174-ae97-44c3-8727-1d7b05df825e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3024da2b-1ada-4515-a8b4-d6007a2f9533","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0736a739-e179-4356-8c99-bc9d66855135","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5998b844-bc9d-46a5-93b9-923ec229b8a6","root":false,"$title":"[DESATIVADO] Verifica Horario de Atendimento","$position":{"top":"403.857px","left":"1631px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"atendimentohumano","urlCHT":"https://api.safra.com.br","botIdentity":"prodspdatendimentohumano","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/prodspdatendimentohumano","urlToken":"https://sts-api.safra.com.br","clientSecret":"5312b6d5-acb8-4165-9458-ef445876473e","urlTake":"https://ticketmonitor.cs.blip.ai","commands":"https://safra.http.msging.net/commands","apiKey":"Key cm91dGVyc2FmcmFwcm9kd2hhdHNhcHBwajpuOHBSSDJRRW5NRTFvb3Jybk4wbA==","gateway":"https://api.safra.com.br"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}