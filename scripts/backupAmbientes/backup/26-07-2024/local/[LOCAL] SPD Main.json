{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"765dc076-b87b-40d4-a571-f64fa62e7341","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"0e4a3f84-4473-4985-a879-6efe1da438a4","conditions":[{"values":["false"],"source":"context","variable":"blockDestinationId","comparison":"notEquals"}],"$invalid":false},{"stateId":"3e06cd93-6019-4a34-8468-b364f7ec47e9","typeOfStateId":"state","$connId":"con_3","$id":"a4b61067-650f-40f5-b8fb-a4084131f605","conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contact.extras.broadcastOrigem"},{"values":["-"],"source":"context","comparison":"notEquals","variable":"contact.extras.broadcastOrigem"}],"$invalid":false},{"stateId":"a8d2f811-ac89-4e91-9b16-c93b4b661447","typeOfStateId":"state","$connId":"con_8","$id":"d7da0159-8b49-4eda-858f-06339a90237e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8c8cd4d0-da09-4045-8009-266626552731","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f13d7473-79a6-48ac-a970-e65229fecfab","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"telephone\"","$invalid":false,"settings":{"function":"run","source":"function formatPhone(identity) {\n    if (identity.split(\"@\")[1] == \"wa.gw.msging.net\") {\n        let resultPhoneWithoutCode = identity.split(\"@\")[0].substring(2, identity.length);\n        if (resultPhoneWithoutCode.length < 11) {\n            let newArraySplice = resultPhoneWithoutCode.split(\"\");\n            let returnNewArraySplice = newArraySplice.splice(2, 0, \"9\");\n            return newArraySplice.join(\"\")\n        } else {\n            return resultPhoneWithoutCode\n        }\n    }\n    return identity\n}\n\nfunction run(contactPhone) {\n    try {\n        const identity = formatPhone(contactPhone)\n        let telephone = identity.substring(2, identity.length);\n        let ddd = identity.substring(0, 2);\n        let objectResponse = {\n            \"ddd\": ddd,\n            \"telephone\": telephone\n        };\n        return objectResponse;\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["contact.identity"],"outputVariable":"telephone","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3b58ebd1-d3b2-4707-9fc9-37b0543ca67b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-602607bb-b791-4845-8cb6-078b0e843fe4","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"10px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bd18d48b-197a-4546-900b-5bd5cf12f99b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","typeOfStateId":"state","$connId":"con_13","$id":"41b772e3-09eb-4036-a1bf-83b66dc726fc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"18c6e28f-a1ec-41b6-89c8-4fbf15c2b8fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3596008-01fa-4e08-88d5-bf813e8b57d4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f13e7fbd-372e-45ce-a30f-de575a5cb830","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-18130cb6-e19c-4cb2-864c-a000830d55bb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"17px","left":"407px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"4bd87cdf-8b20-4797-a08c-9eaa81374421","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! Boas-vindas ao atendimento virtual do Banco Safra para sua empresa. 😊","metadata":{}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! Boas-vindas ao atendimento virtual do Banco Safra para sua empresa. 😊"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"7041049f-fd4e-459b-bb19-e47d71e9580e","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"314dd865-7fe1-4276-af20-5567014eb6a7","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7e068d62-af04-4916-a1ff-eb223d8dcb99","typeOfStateId":"state","$connId":"con_18","$id":"f403b145-fa9f-499a-9342-b138d5c11025","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7f373a4d-0201-4c29-8e9a-5f151816d10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"fe319907-8b8e-446d-9bed-4223996dd5cf","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fcbf5dea-5071-4b71-883f-ceb7cc0ddec2","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"9050bf5d-13ad-4128-b393-23a5def318ca","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1154d2fc-4cb3-4982-83c8-399486742aef","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main input inicial\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main boas vindas input inicial","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"82c18de3-a766-4dac-ad75-28f3c2c10b4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlToken}}/api/oauth/token | {{encodingUrl}} | {{statusToken}} | {{bodyToken}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-237bc19c-a1d1-4ecc-8a3c-d60d5a564a8c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-caf6bd91-c711-4e6a-a4e5-c034dc4a4c25","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9d34dbb6-04b9-49fb-bb92-02c3b1eddd8d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-59f1fa89-b211-4391-aa80-64c6dcbb64b1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"welcome","$title":"[M.1.0.0][MSG][HTTP] Boas vindas","$position":{"top":"326px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7e068d62-af04-4916-a1ff-eb223d8dcb99":{"$contentActions":[{"action":{"$id":"de77b127-178b-4dad-bdc1-7f7468a7591f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Por gentileza, para seguirmos com o atendimento, precisamos que você informe o CPF do titular da conta.","metadata":{}},"$cardContent":{"document":{"id":"87270121-7c15-4ec7-9779-ab80ff9ee440","type":"text/plain","content":"Por gentileza, para seguirmos com o atendimento, precisamos que você informe o CPF do titular da conta."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f64784f0-07f1-4543-aee4-dda0709eb450","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c4a0b0b5-3f41-4581-b1ba-a0186d2847f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2108dc0d-7efc-4120-a380-d1624ed0e0b4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os números, como neste exemplo:👇\nCPF: 43913590806","metadata":{}},"$cardContent":{"document":{"id":"0d2dadb9-dd40-432e-bfb9-9c6b8186670c","type":"text/plain","content":"Use apenas os números, como neste exemplo:👇\nCPF: 43913590806"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32fafead-1ba1-4524-94bb-6913efeee86c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","typeOfStateId":"state","$connId":"con_23","$id":"417421c1-8ac6-48ad-bb1f-b9d634898dc4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2adb915b-9570-4bb6-940a-9908820ad6f7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0d73b1ba-e76c-459f-83dc-6dbe64c82c6b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e1718e2f-a23e-4206-9493-69c0fba580ba","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7e068d62-af04-4916-a1ff-eb223d8dcb99","root":false,"$title":"[M.2.0.0][MSG] Solicita CPF","$position":{"top":"505px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75b55cb8-4764-479d-b17d-48776ccc45c9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"05944f68-1d49-4a49-9782-622dee31cc95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"775e2746-a52f-48d0-9442-e17cd0c2fd82","typeOfStateId":"state","$connId":"con_28","$id":"6dd06b3f-39e7-44d9-ac8d-574696ee3d78","conditions":[{"values":["0"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":["unauthorized"],"source":"context","comparison":"notEquals","variable":"apiStatus"}],"$invalid":false},{"stateId":"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c","typeOfStateId":"state","$connId":"con_33","$id":"c8051bdc-1fcd-46fe-8b0d-6232681d6d3c","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada"}],"$invalid":false},{"stateId":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","typeOfStateId":"state","$connId":"con_38","$id":"b064be9b-d3c5-4a7c-b43c-ce5864fa1f62","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contas"},{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarContas@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fc784833-8d2f-4e3c-a9f6-a29e08d7b490","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyContas\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"CHT"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/usuarios/{{contact.extras.cpf}}/shortnames?expand=contas","responseStatusVariable":"statusContas","responseBodyVariable":"bodyContas"},"conditions":[]},{"$id":"cb7e2bdc-f341-44e7-9c67-eb82c80317a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contas\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyContas) {\n\ttry {\n\t\tconst contas = JSON.parse(bodyContas).data;\n\t\tlet arrContas = []\n\t\tlet totalLoops = 0;\n\n\t\tfor (let index = 0; index < contas.length; index++) {\n\t\t\tif (totalLoops > 100) break;\n\t\t\tfor (let indexB = 0; indexB < contas[index].contas.length; indexB++) {\n\t\t\t\tif (totalLoops > 100) break;\n\t\t\t\tconst novaConta = contas[index].contas[indexB];\n\t\t\t\tnovaConta.canal = contas[index].canal\n\t\t\t\tnovaConta.shortname = contas[index].shortname;\n\t\t\t\tnovaConta.usuario = contas[index].id\n\t\t\t\tnovaConta.codigoSegmento = contas[index].codigoSegmento\n\t\t\t\tnovaConta.nivel = contas[index].nivel\n\t\t\t\tarrContas.push(novaConta)\n\t\t\t\ttotalLoops++;\n\t\t\t}\n\t\t\ttotalLoops++;\n\t\t}\n\t\treturn {\n\t\t\tquantidadeContas: arrContas.length,\n\t\t\tcontas: arrContas\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tquantidadeContas: 0,\n\t\t\tcontas: [],\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["bodyContas"],"outputVariable":"contas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2cab7169-21a8-41aa-aa30-5a74ceb7ddc4","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"SPD Main {state.name} quantidade de contas\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} quantidade de contas","action":"{{contas@quantidadeContas}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contas@quantidadeContas"}]},{"$id":"fe38dc09-941f-4136-bcf0-a84d2114fcd3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(data) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\treturn contas[0]\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contas"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"lessThanOrEquals","variable":"contas@quantidadeContas"}]},{"$id":"15fcf271-3186-45b1-89b2-c4f954b7e5e3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusContas"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"de1c5968-7160-4dfd-9b03-cf94d6d31aae","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarContas\"","$invalid":false,"settings":{"function":"run","source":"const replaceAt = (string, index, replacement) => {\n\treturn string.substr(0, index) + replacement + string.substr(index + replacement.length);\n};\n\n// function list(contas, maisContas) {\n// \ttry {\n// \t\tconst buttons = contas.map((conta, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: `${conta.agencia}-${conta.conta}`,\n// \t\t\t\ttitle: `AG${replaceAt(conta.agencia, 1, \"XXX\")} CC${replaceAt(conta.conta, 2, \"XXXX\")}`,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outras contas'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.\";\n// \t\tconst buttonTitle = \"Mostrar contas\";\n// \t\tconst headerText = \"Escolha uma conta\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn false;\n// \t}\n// }\n\nfunction run(data, stateName, idSessao) {\n\ttry {\n\t\tconst { contas } = JSON.parse(data)\n\t\tlet textoContas = ''\n\t\tcontas.slice(0, 100)\n\t\t\t.forEach((conta, index) => textoContas += `*${index + 1}* - AG ${replaceAt(conta.agencia, 1, \"XXX\")}\\nCC ${replaceAt(conta.conta, 2, \"XXXX\")}\\n`)\n\t\treturn textoContas\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["contas","state.name","idSessao"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarContas"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"contas@quantidadeContas"}]},{"$id":"fd849d5e-7996-4de5-8ac4-92f1f18d707d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarContas@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarContas@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarContas@tracking"}]},{"$id":"ac7d3117-f8b5-4b22-b4fb-94bdccb70f82","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"1d578318-ae43-44ca-9716-3d5722d4af8f","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/shortnames-vinculados?cpf={{contact.extras.cpf}} | GET | {{statusContas}} | {{bodyContas}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5b7636cd-f25d-42b0-9481-41405b144d6f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-faafe42b-2f53-46ad-b0c5-4802ffdf9278","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-10a1f866-f07f-46f5-a034-7183f3dd0c97","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"75b55cb8-4764-479d-b17d-48776ccc45c9","root":false,"$title":"[M.3.0.0][MSG][HTTP] Verifica contas","$position":{"top":"895px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ccd3d0b-0b52-4fef-9461-3b688137f8dd":{"$contentActions":[{"action":{"$id":"a0c6e498-307e-4a39-88a4-ee3ae564f480","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4ccbe2dd-f7c3-41c2-a5a5-9057f5e074e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4ccbe2dd-f7c3-41c2-a5a5-9057f5e074e1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0b08869f-3c71-4e06-9631-117ca59b598a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"87b70612-954e-4af0-bedc-5087f21df870","type":"text/plain","content":"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar.","metadata":{}},"$cardContent":{"document":{"id":"87b70612-954e-4af0-bedc-5087f21df870","type":"text/plain","content":"Você possui mais de uma conta. Escolha abaixo sobre qual deseja tratar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0aedb2ed-ce43-4be2-8c14-e3b930c10e33","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"afde8c23-50eb-48b6-8058-2b2d12f31d63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"afde8c23-50eb-48b6-8058-2b2d12f31d63","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c3855dce-6b69-4b77-b2f3-e326807e1e11","$typeOfContent":"text","type":"SendMessage","settings":{"id":"42345d41-fdd9-46ab-b01a-50df57e2f6df","type":"text/plain","content":"Digite o número da opção escolhida. \nExemplo: *1*","metadata":{}},"$cardContent":{"document":{"id":"42345d41-fdd9-46ab-b01a-50df57e2f6df","type":"text/plain","content":"Digite o número da opção escolhida. \nExemplo: *1*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9a86d7f8-7fde-4106-ab85-790593c485be","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3f72e5a9-e1dc-4e82-bddb-7ccb329d38c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3f72e5a9-e1dc-4e82-bddb-7ccb329d38c3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed7f19d1-e2d5-4928-b4dd-137383f4dfa2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"777b5cfc-09a5-4c63-8f94-d76bb4e2313b","type":"text/plain","content":"{{exibeSelecionarContas}}","metadata":{}},"$cardContent":{"document":{"id":"777b5cfc-09a5-4c63-8f94-d76bb4e2313b","type":"text/plain","content":"{{exibeSelecionarContas}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"83ae0e89-15eb-4001-8dd9-6073bb965b59","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","typeOfStateId":"state","$connId":"con_43","$id":"60fa561d-5338-454d-a2cd-641f936ca51e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48c846c9-dbf9-4efc-91ed-56921dc4595e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-861104d0-d275-4483-8c43-447b36c07081","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5ad2d795-6210-4f0b-a097-a1b09d0b37db","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7ccd3d0b-0b52-4fef-9461-3b688137f8dd","root":false,"$title":"[M.3.1.0][MSG]Seleciona conta","$position":{"top":"1118px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"775e2746-a52f-48d0-9442-e17cd0c2fd82":{"$contentActions":[{"action":{"$id":"54831eb1-0ba8-4a8b-a6fe-37725d2e0c25","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cd460814-5a56-44b5-94cd-8f36ce75cff2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d506add8-6da2-44d4-90d7-ceb4e7bdf17e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Parece que ainda não é nosso cliente. 🤔\n \nSó um instante, seu atendimento será transferido para um atendente.","metadata":{}},"$cardContent":{"document":{"id":"cdef2487-f685-45cf-bfef-435e65dd565c","type":"text/plain","content":"Parece que ainda não é nosso cliente. 🤔\n \nSó um instante, seu atendimento será transferido para um atendente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6a40c5ea-eb78-4056-8d3f-f4890e27497c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c7d220bd-2237-49f4-88ec-14c555bf202c","typeOfStateId":"state","$connId":"con_48","$id":"0c22bedb-8fff-4b14-8e4c-d722fb022b44","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a2e0fc43-30c6-4423-958d-6a9c1f2035d5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"6762adcf-fc02-40d1-822c-37f0b1c1da82","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\"","$invalid":false,"settings":{"variable":"naoCliente","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0e14b6c5-3d5a-41f7-a983-e27f050a3326","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2bbb01ac-f52a-4421-9d86-11e07bff6f5e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-51bb2e38-ddc9-4f6d-a222-bfcb091b2497","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"775e2746-a52f-48d0-9442-e17cd0c2fd82","root":false,"$title":"[M.3.0.1][MSG] Transbordo cliente não identificado","$position":{"top":"895px","left":"361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"7b5bce4a-368f-48ac-8c8a-171e31e5b096":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fde8a193-6fdc-4490-bbf2-a99a74582176","typeOfStateId":"state","$connId":"con_53","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"fde8a193-6fdc-4490-bbf2-a99a74582176","typeOfStateId":"state","$connId":"con_58","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4afea420-704b-4f88-bc62-056d81224ff3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyDadosConta\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusDadosConta","responseBodyVariable":"bodyDadosConta"},"conditions":[]},{"$id":"0b6ff513-c46d-4619-b433-dc17203974a9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyUsuarios\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios","responseStatusVariable":"statusUsuarios","responseBodyVariable":"bodyUsuarios"},"conditions":[]},{"$id":"cb9f0cf9-050b-49e7-a0ca-4cad3e0181fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada, bodyDadosConta, bodyUsuarios, cpf) {\n\ttry {\n\n\t\tconst { tipoPessoa, baseDocumento, filialCnpj, digitoCpf, nome } = JSON.parse(bodyDadosConta).data\n\t\tconst conta = JSON.parse(contaSelecionada)\n\t\tconst parsedBodyUsuarios = JSON.parse(bodyUsuarios).data\n\n\t\tconta['nomeEmpresa'] = nome\n\t\tconta['tipoPessoa'] = tipoPessoa\n\t\tconta['doc'] = cpf\n\t\tif (conta.usuario) {\n\t\t\tconta['usuario'] = conta.usuario.trim()\n\t\t}\n\t\tif (tipoPessoa === 'PJ') {\n\t\t\tlet doc = baseDocumento + \"000\" + filialCnpj\n\t\t\tlet digito = digitoCpf\n\t\t\tif (digitoCpf < 10) {\n\t\t\t\tdigito = \"0\" + digitoCpf\n\t\t\t}\n\t\t\tconta['doc'] = baseDocumento + \"000\" + filialCnpj + digito\n\t\t\twhile (conta['doc'].length < 14) {\n\t\t\t\tconta['doc'] = `0${conta['doc']}`\n\t\t\t}\n\t\t}\n\t\tif (parsedBodyUsuarios.length > 0) {\n\t\t\tlet primeiroNome = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome.split(' ')[0].toLowerCase()\n\t\t\tprimeiroNome = primeiroNome[0].toUpperCase() + primeiroNome.slice(1)\n\t\t\tconta['nomeCompleto'] = parsedBodyUsuarios.find((usuario) => conta.usuario.trim() === usuario.id.trim()).nome\n\t\t\tconta['primeiroNome'] = primeiroNome\n\t\t} else {\n\t\t\tconta['nomeCompleto'] = ''\n\t\t\tconta['primeiroNome'] = ''\n\t\t}\n\t\treturn conta\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["contaSelecionada","bodyDadosConta","bodyUsuarios","contact.extras.cpf"],"LocalTimeZoneEnabled":false,"outputVariable":"contaSelecionada"},"conditions":[]},{"$id":"068dbd3d-971c-4d11-b2f7-f05cb07c2169","$typeOfContent":"","type":"MergeContact","$title":"Set \"contactName\"","$invalid":false,"settings":{"extras":{},"name":"{{contaSelecionada@nomeCompleto}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@nomeCompleto"}]},{"$id":"ad6ae249-8b81-4b5e-93fa-74c1ab9dd3a4","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyEC\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/estabelecimentos?cpfCnpj={{contaSelecionada@doc}}","responseStatusVariable":"statusEC","responseBodyVariable":"bodyEC"},"conditions":[]},{"$id":"b9ed4fe7-ce29-4729-887d-06be26d85470","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ecList\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tconst ecs = JSON.parse(data).data;\n\t\tconst ecList = ecs.filter((ec) => ec.indSitEC === 'A')\n\t\treturn {\n\t\t\tecList,\n\t\t\tecQuantity: ecList.length\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyEC"],"outputVariable":"ecList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dde995d3-a23f-4103-9da6-45fd22ade501","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} quantidade ec\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{ecList@ecQuantity}}","category":"SPD Main {{state.name}} quantidade ec"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ecList@ecQuantity"}]},{"$id":"fcc19fae-2b77-4513-b177-9904e8917360","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selectedEc\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ecList) {\n\ttry {\n\t\tif(JSON.parse(ecList).ecQuantity != 1) {\n\t\t\treturn ''\n\t\t}\n\t\tconst ec = JSON.parse(ecList).ecList[0]\n\t\treturn ec\n\t} catch (err) {\n\t\treturn ''\n\t}\n}","inputVariables":["ecList"],"outputVariable":"selectedEc","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2f0e851b-7a56-468d-bd87-ba103ff23ccd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => !status)) {\n\t\t\treturn 'timeout'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDadosConta","statusUsuarios","statusEC"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7755e648-2c4a-47d9-842a-ef9e24d718a6","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-juridica/v1/contas?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusDadosConta}} | {{bodyDadosConta}}"},"conditions":[]},{"$id":"8abc6e92-2865-41ef-a6a5-d48d09e6f445","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/shortnames/{{contaSelecionada@shortname}}/usuarios | GET | {{statusUsuarios}} | {{bodyUsuarios}}","category":"SPD Main {{state.name}} api resumo"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d82cc8cc-3a78-4839-bc94-57ff631f6514","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"7057224c-9e8c-4d86-8160-810ca6c47bc9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exibeSelecionarEc\"","$invalid":false,"settings":{"function":"run","source":"// function list(ecs, maisContas) {\n// \ttry {\n// \t\tconst buttons = ecs.map((ec, index) => {\n// \t\t\treturn {\n// \t\t\t\tid: ec.codigoEc,\n// \t\t\t\ttitle: ec.codigoEc,\n// \t\t\t}\n// \t\t})\n\n// \t\tif (maisContas === true) {\n// \t\t\tbuttons.push({\n// \t\t\t\tid: 'mais',\n// \t\t\t\ttitle: 'Mostrar outros ecs'\n// \t\t\t})\n// \t\t}\n// \t\tconst mainText = \"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro.\\n\\nPor gentileza, digite a opção desejada.👇\";\n// \t\tconst buttonTitle = \"Selecionar EC\";\n// \t\tconst headerText = \"Escolha um ec\";\n// \t\treturn {\n// \t\t\t\"recipient_type\": \"individual\",\n// \t\t\t\"type\": \"interactive\",\n// \t\t\t\"interactive\": {\n// \t\t\t\t\"type\": \"list\",\n// \t\t\t\t\"header\": {\n// \t\t\t\t\t\"type\": \"text\",\n// \t\t\t\t\t\"text\": \"\"\n// \t\t\t\t},\n// \t\t\t\t\"body\": {\n// \t\t\t\t\t\"text\": mainText,\n// \t\t\t\t},\n// \t\t\t\t\"action\": {\n// \t\t\t\t\t\"button\": buttonTitle,\n// \t\t\t\t\t\"sections\": [\n// \t\t\t\t\t\t{\n// \t\t\t\t\t\t\t\"title\": headerText,\n// \t\t\t\t\t\t\t\"rows\": buttons\n// \t\t\t\t\t\t}\n// \t\t\t\t\t]\n// \t\t\t\t}\n// \t\t\t}\n// \t\t}\n// \t} catch (err) {\n// \t\treturn err.message;\n// \t}\n// }\n\nfunction run(data, idSessao, stateName) {\n\ttry {\n\t\tconst { ecList } = JSON.parse(data)\n\t\tconst message = ''\n\t\tecList.forEach((ec, index) => message += `*${index + 1}* - EC: ${ec.codigoEc}\\n`)\n\t\treturn message\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: true,\n\t\t\terrorMessage: err.message,\n\t\t\ttracking: `${idSessao} | ${stateName} | ${err.message}`\n\t\t}\n\t}\n}","inputVariables":["ecList","idSessao","state.name"],"LocalTimeZoneEnabled":false,"outputVariable":"exibeSelecionarEc"},"conditions":[{"values":["1"],"source":"context","comparison":"greaterThan","variable":"ecList@ecQuantity"}]},{"$id":"6364306a-32c9-4b27-8efb-74824dae1de6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main script error\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main script error","action":"{{exibeSelecionarEc@tracking}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"exibeSelecionarEc@error"},{"comparison":"exists","source":"context","values":[],"variable":"exibeSelecionarEc@tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-589781f1-9b9c-495b-a70b-ef8f0d1f13ac","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-2dc49a15-aebc-4720-a3c3-2597b3f7d488","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-44c70f7c-e5f6-4935-a007-63445ef43ae0","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-bed9d6a0-8edb-4961-8621-c8f65fc29560","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","root":false,"$title":"[M.4.0.0][MSG][HTTP] Obtem EC","$position":{"top":"1128px","left":"1229px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f13e7fbd-372e-45ce-a30f-de575a5cb830":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-1c6f0fc2-cc4e-4565-86e2-00ba94e68e98","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f13e7fbd-372e-45ce-a30f-de575a5cb830","root":false,"$title":"[Redirect] To cascata","$position":{"top":"5px","left":"137px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a":{"$contentActions":[{"action":{"$id":"573516a7-6247-4ab4-8054-793ae9a89e1d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"329e980f-b6df-4fe0-9d5c-8ff0a5eb0260","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5aa9ffd-855e-4039-9345-c68c1ad4cb2e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro.","metadata":{}},"$cardContent":{"document":{"id":"f2002719-cf83-4c34-9354-aa9949a854c6","type":"text/plain","content":"Encontrei mais de um Estabelecimento Comercial (*EC*) no seu cadastro."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"27b2d5e1-e8be-4ca9-8e08-d1f77f8160e0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"67578171-d4fe-4d96-9fba-de8050f9a557","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"67578171-d4fe-4d96-9fba-de8050f9a557","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"57b83adb-262e-4779-8587-4d77cdff5627","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2717464f-4fd3-455c-98f7-08d08bc2a04b","type":"text/plain","content":"Por gentileza, digite a opção desejada.👇","metadata":{}},"$cardContent":{"document":{"id":"2717464f-4fd3-455c-98f7-08d08bc2a04b","type":"text/plain","content":"Por gentileza, digite a opção desejada.👇"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fd5493d7-9512-482c-8677-c3c856e153e5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4b16ab37-c01a-4ce1-8342-c2bd167b872c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4b16ab37-c01a-4ce1-8342-c2bd167b872c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2859d8fe-a5a5-4092-badf-985c1a987152","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b139f598-e763-492b-8b8d-b5b5cb908af0","type":"text/plain","content":"{{exibeSelecionarEc}}","metadata":{}},"$cardContent":{"document":{"id":"b139f598-e763-492b-8b8d-b5b5cb908af0","type":"text/plain","content":"{{exibeSelecionarEc}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ed65c28f-2f50-414c-b58a-802440f38900","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e567a78-dbb9-4216-baa4-9d476bc2b887","typeOfStateId":"state","$connId":"con_63","$id":"ea6ea425-ef88-4bf1-89c2-387725bcce85","conditions":[{"values":[],"source":"input","comparison":"exists","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd4b372a-bdbd-4379-90a0-b180541ac632","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5cc4cf00-3427-4e99-bb3a-280b5bd364a4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bcd0b29a-83a2-49eb-9e73-381a05161bba","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","root":false,"$title":"[M.4.1.0][MSG] Selecionar EC","$position":{"top":"1128px","left":"1723px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"30e39880-1d2a-439a-a0ed-1e7210966286":{"$contentActions":[{"action":{"$id":"e456922a-5fe5-404b-b33f-c7b85c103959","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ed3815ac-c7cf-4c6c-ad39-6bd05be10b5e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ed3815ac-c7cf-4c6c-ad39-6bd05be10b5e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3fe99f5b-8d15-485b-b146-09689a0b563c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"5856f6e3-4041-4263-8f0a-1c8673613f19","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você pode digitar <b>Voltar</b> para voltar uma etapa, e <b>Sair</b> para finalizar o atendimento a qualquer momento.","metadata":{}},"$cardContent":{"document":{"id":"5856f6e3-4041-4263-8f0a-1c8673613f19","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você pode digitar <b>Voltar</b> para voltar uma etapa, e <b>Sair</b> para finalizar o atendimento a qualquer momento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d8e25b49-af9d-42cb-9189-a7d020ab0974","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6eab91e1-a8d9-4f36-877e-bd3049512919","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"595bbc26-6daf-4319-a175-17192cf276fc","typeOfStateId":"state","$connId":"con_68","$id":"f6b5a2f4-95b2-4b95-a158-703dc53dc4eb","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3aa9d290-4cc4-4607-a662-a0366eb1b3d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"83de69ad-cc6d-4f42-8b73-e78b4a5e5528","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n\t{\n\t\t\"id\": \"1\",\n\t\t\"title\": \"Perda ou Roubo\",\n\t\t\"description\": \"Bloqueio por perda ou roubo\"\n\t},\n\t{\n\t\t\"id\": \"2\",\n\t\t\"title\": \"Máquinas Safrapay\",\n\t\t\"description\": \"Taxas, Suporte, Retirada de máquina, Vendas, Antecipação, entre outros.\"\n\t},\n\t{\n\t\t\"id\": \"3\",\n\t\t\"title\": \"Conta Corrente\",\n\t\t\"description\": \"Pix, Falar sobre conta, Consultar Pacotes\"\n\t},\n\t{\n\t\t\"id\": \"4\",\n\t\t\"title\": \"Soluções\",\n\t\t\"description\": \"Consulta de protocolo, Boletos, Descredenciamento\"\n\t},\n\t{\n\t\t\"id\": \"5\",\n\t\t\"title\": \"Apoio à Navegação\",\n\t\t\"description\": \"Acesso, Alterações cadastrais, Alterar domicílio\"\n\t},\n\t{\n\t\t\"id\": \"6\",\n\t\t\"title\": \"Transação não autorizada\",\n\t\t\"description\": \"Meu pagamento não foi autorizado\"\n\t},\n\t{\n\t\t\"id\": \"7\",\n\t\t\"title\": \"Produtos\",\n\t\t\"description\": \"Seguros, Investimento, Desempenho e Cartão,  Talão de cheque\"\n\t}\n]\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n\tif (posicao > menuOptions.length) {\n\t\tposicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n\t}\n\tif (menuOptions.find(option => option.id == posicao)) {\n\t\tquantidadeItens = menuOptions.length\n\t\tfor (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n\t\t\tmenuOptions[i].id = (i + 2).toString()\n\t\t}\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72) || ''\n\t\t})\n\t} else {\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72)\n\t\t})\n\t}\n\tmenuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n\t// Parametro de busca é o title ou description da opção que deseja atualizar\n\tconst opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tmenuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n\tmenuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao);\n\n\tif (!opcao) {\n\t\treturn;\n\t}\n\n\tconst hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n\tif (hasPermission) {\n\t\treturn;\n\t}\n\n\tconst index = menuOptions.indexOf(opcao);\n\tif (index > -1) {\n\t\tmenuOptions.splice(index, 1);\n\t}\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\nfunction removeDescricaoDoBotao({ tituloDoBotao, parteASerRemovida, listaPermissoes, permissaoNecessaria }) {\n\tif (listaPermissoes.includes(permissaoNecessaria)) {\n\t\treturn\n\t}\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions[index].description = menuOptions[index].description.replace(parteASerRemovida, '')\n}\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada) {\n\ttry {\n\t\tconst { cpfAppKey, permissoes, ec, segmentoGerente } = JSON.parse(contaSelecionada)\n\t\tif (!ec) {\n\t\t\tatualizaOpcaoMenu({\n\t\t\t\tparametroDeBusca: 'Máquinas Safrapay',\n\t\t\t\ttitle: 'Máquinas Safrapay',\n\t\t\t\tdescription: 'Condições e taxas, Suporte, Vendas, Antecipação, entre outros.'\n\t\t\t})\n\t\t}\n\n\t\tif (cpfAppKey != 'false') {\n\t\t\tatualizaOpcaoMenu({\n\t\t\t\tparametroDeBusca: 'Conta Corrente',\n\t\t\t\ttitle: 'Conta Corrente',\n\t\t\t\tdescription: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.'\n\t\t\t})\n\t\t}\n\n\t\tif (segmentoGerente) {\n\t\t\tif (segmentoGerente == 'emp1') {\n\t\t\t\tatualizaOpcaoMenu({\n\t\t\t\t\tparametroDeBusca: 'Produtos',\n\t\t\t\t\ttitle: 'Produtos',\n\t\t\t\t\tdescription: 'Seguros, Investimento, Renegociação, Gravame, Desempenho e Cartão'\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tatualizaOpcaoMenu({\n\t\t\t\t\tparametroDeBusca: 'Produtos',\n\t\t\t\t\ttitle: 'Produtos',\n\t\t\t\t\tdescription: 'Seguros, Investimento, Renegociação, Cartão, Cheque, entre outros.'\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Soluções', parteASerRemovida: 'Consulta de protocolo, ', permissaoNecessaria: 'consultaDeProtocolo', listaPermissoes: permissoes })\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Soluções', parteASerRemovida: ', Descredenciamento', permissaoNecessaria: 'desinstalacao', listaPermissoes: permissoes })\n\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Conta Corrente', parteASerRemovida: 'Extratos, ', permissaoNecessaria: 'extratoDeContaCorrente', listaPermissoes: permissoes })\n\t\tremoveDescricaoDoBotao({ tituloDoBotao: 'Conta Corrente', parteASerRemovida: 'Fazer pix, ', permissaoNecessaria: 'transferenciaPix', listaPermissoes: permissoes })\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Por aqui podemos te ajudar com os seguintes assuntos`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha um assunto\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\texceptionType: 'reiniciarFluxo',\n\t\t\tdynamicContent: {\n\t\t\t\t\"type\": \"text\",\n\t\t\t\t\"text\": {\n\t\t\t\t\t\"body\": \"Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12d17c26-02d6-4b25-b6ba-aefbc1b7a22d","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"d45b7520-a5d6-472f-bca9-4b71a0406b88","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"5170536a-29da-42f7-8e55-c189b5af2326","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8dc8e741-5d1f-45f0-bf28-549679496406","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5c0fe795-e794-466e-8921-60c73e1e1390","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8a41b834-e734-4a96-967c-7d4e7fb4b4af","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6aef676a-8c9d-4cbc-afa1-75bd12fdd1b1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"30e39880-1d2a-439a-a0ed-1e7210966286","root":false,"$title":"[M.5.0.0][MSG] Menu Principal","$position":{"top":"1612px","left":"1720px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5ddf643-13c0-4a81-a174-e1aa9dd86873":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5b733936-1903-4654-b904-fc7b72d289cc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Bot Máquina Safrapay ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'e0d2ce64-3265-46bd-b396-f53ad65b26e6',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d02ef8e1-41a6-4df8-ae88-9f54609b5548","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-3c65cf14-7624-4bf6-ab4f-ef1e8967648d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1c0f1e5e-49dc-4830-9145-cdddf32eac0b","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$title":"[Redirect] To Maquina Safrapay","$position":{"top":"1665px","left":"1288px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"491c0860-a3da-491c-bfc6-3b7f99e29c29":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"18838d12-aaf3-43c0-b6ae-1c14204ca89a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"525c6b7f-cc74-42fb-a747-f7948ebc0984","typeOfStateId":"state","$connId":"con_73","$id":"833fd40f-f365-49d2-a884-7dd4bbf5345e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"be5d1b5c-8ea6-4363-b2b8-3bf398126ac5","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpf\" to \"{contact.extras.cpf}\"","$invalid":false,"settings":{"variable":"cpf","value":"{{contact.extras.cpf}}"},"conditions":[]},{"$id":"b9150719-3abd-4de0-91a9-0e0a46b2e951","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoCliente\" to \"{contaSelecionada@codigoCliente}\"","$invalid":false,"settings":{"variable":"codigoCliente","value":"{{contaSelecionada@codigoCliente}}"},"conditions":[]},{"$id":"4d44859f-0717-41e5-ba98-576f390ab95a","$typeOfContent":"","type":"SetVariable","$title":"Set \"conta\" to \"{contaSelecionada@conta}\"","$invalid":false,"settings":{"variable":"conta","value":"{{contaSelecionada@conta}}"},"conditions":[]},{"$id":"85eb4b94-9458-4cf2-8406-5b4562fea7c7","$typeOfContent":"","type":"SetVariable","$title":"Set \"agencia\" to \"{contaSelecionada@agencia}\"","$invalid":false,"settings":{"variable":"agencia","value":"{{contaSelecionada@agencia}}"},"conditions":[]},{"$id":"af88479f-0eb6-4d73-8bf0-02d336989e40","$typeOfContent":"","type":"SetVariable","$title":"Set \"codigoSegmento\" to \"{contaSelecionada@codigoSegmento}\"","$invalid":false,"settings":{"variable":"codigoSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"8b5f060f-1017-40ea-9648-500fe736f645","$typeOfContent":"","type":"SetVariable","$title":"Set \"agenciaConta\" to \"{contaSelecionada}\"","$invalid":false,"settings":{"variable":"agenciaConta","value":"{{contaSelecionada}}"},"conditions":[]},{"$id":"1f7211bd-def1-4d54-920b-5e89a70cc76c","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoPessoa\" to \"{contaSelecionada@tipoPessoa}\"","$invalid":false,"settings":{"variable":"tipoPessoa","value":"{{contaSelecionada@tipoPessoa}}"},"conditions":[]},{"$id":"7909d9f8-3adc-4e98-8ac6-0157dd3cae94","$typeOfContent":"","type":"SetVariable","$title":"Set \"doc\" to \"{contaSelecionada@doc}\"","$invalid":false,"settings":{"variable":"doc","value":"{{contaSelecionada@doc}}"},"conditions":[]},{"$id":"148cc8da-b70b-4e08-b2b0-fbd643dc2932","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortname\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"shortname","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"e73aeada-145c-4b79-8ebd-c951c98a76ce","$typeOfContent":"","type":"SetVariable","$title":"Set \"ec\" to \"selectedEc@codigoEc\"","$invalid":false,"settings":{"variable":"ec","value":"{{selectedEc@codigoEc}}"},"conditions":[]},{"$id":"204f5d88-cf49-44a6-a048-aa84cbfb0d42","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"64588b09-10f5-41e0-b2ce-5c17fc3c210e","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{codigoSegmento}\"","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"02b7bc32-f8f9-4c46-bcfc-910d4c30f381","$typeOfContent":"","type":"SetVariable","$title":"Set \"shortnameFull\" to \"{contaSelecionada@shortname}\"","$invalid":false,"settings":{"variable":"shortnameFull","value":"{{contaSelecionada@shortname}}"},"conditions":[]},{"$id":"558f5241-b041-4355-a445-98049bb6ee82","$typeOfContent":"","type":"SetVariable","$title":"Set \"usuario\" to \"{contaSelecionada@usuario}\"","$invalid":false,"settings":{"variable":"usuario","value":"{{contaSelecionada@usuario}}"},"conditions":[]},{"$id":"909c2e2e-bf98-48eb-aaa6-fede43fd5d63","$typeOfContent":"","type":"SetVariable","$title":"Set \"nome\" to \"{contact.name}\"","$invalid":false,"settings":{"variable":"nome","value":"{{contact.name}}"},"conditions":[]},{"$id":"d3b43eaf-fb6e-4407-9dd1-aa13f7690077","$typeOfContent":"","type":"SetVariable","$title":"Set \"naoCliente\" to \"false\"","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]},{"$id":"5f2161cd-02b6-4e82-89b7-0054c54a0c0b","$typeOfContent":"","type":"SetVariable","$title":"Set \"tipoCliente\" to \"bdsp\"","$invalid":false,"settings":{"variable":"tipoCliente","value":"Bdsp"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}]},{"$id":"86666ff3-fd19-414d-8746-2a9e287541cd","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"402216b1-da34-4435-b20a-e857ea018e84","$typeOfContent":"","type":"ExecuteScript","$title":"phone","$invalid":false,"settings":{"function":"run","source":"function run(phone) {\n    let extracted_phone = phone\n        .split('@')[0]\n    if (extracted_phone.length == 10)\n        extracted_phone = extracted_phone\n            .substr(0, 2)\n            .concat('9', extracted_phone.substr(2));\n    return extracted_phone;\n}","inputVariables":["contact.identity"],"outputVariable":"phone","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"04fec05f-0acb-4d18-8550-9cdbfbd40958","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"{state@assunto}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{state@assunto}}"},"conditions":[]},{"$id":"27243618-496f-48c3-9b3e-a338e038e479","$typeOfContent":"","type":"SetVariable","$title":"Set \"nomeCompleto\" to \"{nome}\"","$invalid":false,"settings":{"variable":"nomeCompleto","value":"{{nome}}"},"conditions":[]},{"$id":"ad35f69b-4be8-485d-8a73-df753ffd3e48","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"const transferMessage = {\n\t'antecipar saldo': 'Antecipar saldo',\n\t'fazer pix': 'Fazer Pix',\n\t'pagar conta': 'Pagar contas',\n\t'extrato conta corrente': 'Extrato Conta',\n\t'extrato vendas': 'Extrato Vendas',\n\t'extrato recebimentos': 'Extrato Recebimentos',\n\t'perda ou roubo': 'Perda ou Roubo',\n\t'suporte técnico': 'Suporte Tecnico',\n\t'não recebi minha venda': 'Venda não recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'apoio à navegação': 'Aplicativo',\n\t'suporte e configurações': 'Suporte e Configurações',\n\t'transação não autorizada': 'Transação não Autorizada',\n\t'seguros': 'Seguros'\n}\n\nconst assunto = {\n\t'antecipar saldo': 'antecipação',\n\t'fazer pix': 'pix',\n\t'pagar conta': 'pagar contas',\n\t'extrato conta corrente': 'extrato conta',\n\t'extrato vendas': 'extrato vendas',\n\t'extrato recebimentos': 'extrato recebimentos',\n\t'perda ou roubo': 'perda ou roubo',\n\t'suporte técnico': 'Suporte Técnico',\n\t'aplicativo': \"Aplicativo\",\n\t'consultar protocolo': 'Consulta de Protocolo',\n\t'simulador de vendas': 'Simulador de vendas',\n\t'não recebi minha venda': 'Venda não recebida',\n\t'descredenciamento': 'Descredenciamento',\n\t'apoio à navegação': 'Apoio Aplicativo',\n\t'suporte e configurações': 'Suporte e Configurações',\n\t'transação não autorizada': 'Transação não Autorizada',\n\t'seguros': 'Seguros'\n}\n\nconst botDestination = {\n\t'antecipar saldo': 'WhatsApp PJ',\n\t'fazer pix': 'WhatsApp PJ',\n\t'pagar conta': 'WhatsApp PJ',\n\t'extrato conta corrente': 'WhatsApp PJ',\n\t'extrato vendas': 'WhatsApp PJ',\n\t'extrato recebimentos': 'WhatsApp PJ',\n\t'perda ou roubo': 'WhatsApp PJ',\n\t'suporte técnico': 'WhatsApp PJ',\n\t'consulta os': 'Bot OS',\n\t'aplicativo': 'App',\n\t\"não recebi minha venda\": \"Bot Máquina Safrapay\",\n\t'consultar protocolo': 'Bot Máquina Safrapay',\n\t'simulador de vendas': 'Bot Máquina Safrapay',\n\t'descredenciamento': 'WhatsApp PJ',\n\t'apoio à navegação': 'App',\n\t'suporte e configurações': 'Bot Máquina Safrapay',\n\t'transação não autorizada': 'Bot Máquina Safrapay',\n\t'seguros': 'seguros'\n}\n\nconst stateDestination = {\n\t'consulta os': 'fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db',\n\t'não recebi minha venda': '4051c1ad-de53-4ef3-bfa0-add7a989e960',\n\t'consultar protocolo': '168598f7-bb5b-4eb0-a37e-45f8c48ccdde',\n\t'simulador de vendas': 'c391e959-860e-4eaf-86b9-71fcd8888c86',\n\t'descredenciamento': 'inicio',\n\t'apoio à navegação': 'Welcome',\n\t'suporte e configurações': '4f6e7e6d-21b4-4b11-9913-6aa5149a7469',\n\t'transação não autorizada': 'f0a8601f-5de1-4885-9b44-4f4a6e062c01',\n\t'seguros': 'Welcome'\n}\n\nfunction run(userInput, env, previousBlockid, cpfAppKey, serviceName, previousStateName) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tif (!cpfAppKey && userInput.toLowerCase() === 'fazer pix') {\n\t\t\tuserInput = 'pix'\n\t\t}\n\n\t\tlet destination = botDestination[userInput.toLowerCase()] || `excecoes ${env || \"\"}`.trim()\n\t\tif (env === 'Dev' && destination !== 'WhatsApp PJ') {\n\t\t\tdestination = `${destination} ${env}`\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: destination,\n\t\t\tstateDestination: stateDestination[userInput.toLowerCase()] || 'welcome',\n\t\t\tuserInput: transferMessage[userInput.toLowerCase()] || userInput,\n\t\t\tassunto: assunto[userInput.toLowerCase()] || userInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: userInput,\n\t\t\tuserInput,\n\t\t\terror: err.message\n\t\t}\n\t}\n}\n\n","inputVariables":["userInput","config.env","state.previous.id","cpfAppKey","config.serviceName","state.previous.name"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7f8280ca-d437-4ee7-99a9-d39b57871a9a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{calendar.datetime}} | {{state}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ff75f886-2927-448a-9d91-df08de3fa584","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e937ba57-5f6f-4a7d-ba70-7a59c469435a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a14b7a68-1426-4b76-9aaa-a439a67ab53f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"491c0860-a3da-491c-bfc6-3b7f99e29c29","root":false,"$title":"[Temporario][OLD] Redireciona ao serviço","$position":{"top":"1976px","left":"1285px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"525c6b7f-cc74-42fb-a747-f7948ebc0984":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"af4b8e88-5277-4acd-9664-bd434b53ff39","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3996e980-1a2e-48dc-8e6b-238fd5523544","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-58bcdedd-1160-4a8e-9c9a-e5015f7c571e","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"525c6b7f-cc74-42fb-a747-f7948ebc0984","root":false,"$title":"[Redirect] ao serviço","$position":{"top":"1988px","left":"1000px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06ecab99-d5ad-491b-b680-03a429bc6091","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"75b55cb8-4764-479d-b17d-48776ccc45c9","typeOfStateId":"state","$connId":"con_78","$id":"e6b2d820-969b-4e4a-becb-b8c0b2598b73","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ffe4a4c7-1ce7-4d67-a423-5c3d2c01b375","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(cpf, exception) {\n    const invalidCpfMessage = 'input inesperado';\n    try {\n        if (!cpf) {\n            return 'inatividade'\n        }\n        if (exception === 'quickReply' || exception === 'skip') {\n            if (cpf.match(/tentar (novamente|novamnete|novament|novametne)/i)) {\n                return 'tentar novamente'\n            }\n            if (cpf.match(/encerrar(a|ar|ra|r)/i)) {\n                return 'encerrar'\n            }\n            return invalidCpfMessage\n        }\n        \n        cpf = cpf.replace(/\\D/g, '');\n        if (cpf.length !== 11 || /^(.)\\1*$/.test(cpf)) {\n            return invalidCpfMessage;\n        }\n        let sum = 0;\n        let remainder;\n        for (let i = 1; i <= 9; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(9, 10))) {\n            return invalidCpfMessage;\n        }\n        sum = 0;\n        for (let i = 1; i <= 10; i++) {\n            sum += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        }\n        remainder = (sum * 10) % 11;\n        if ((remainder === 10) || (remainder === 11)) {\n            remainder = 0;\n        }\n        if (remainder !== parseInt(cpf.substring(10, 11))) {\n            return invalidCpfMessage;\n        }\n        return cpf;\n    } catch (err) {\n        return invalidCpfMessage;\n    }\n}","inputVariables":["input.content","exception"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8ceee10-b751-4f03-9fea-cf15009ee655","$typeOfContent":"","type":"MergeContact","$title":"Set \"cpf\" to \"{userInput}\"","$invalid":false,"settings":{"extras":{"cpf":"{{userInput}}"}},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":[],"source":"input","comparison":"exists"}]},{"$id":"768bd9d1-acb2-4a9e-9a2b-e9d31c5c6d06","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0f3dc18b-2a49-43ac-8e0f-fc9c50bb46cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"4d5083d0-0c1a-431c-94b0-6961c2f6cb94","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.2.0.1","variable":"exceptionType"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cf61aea5-e848-4278-b35c-487893149caa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e34ebdc4-9344-4bd3-a609-2583a19d18e1","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-1392c1e2-63d9-4083-b4b2-98f80a8901b6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-412ed91d-92e8-48e4-a05f-2aad492c8f91","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-8ec25e84-3eb6-4b97-ab4a-54368cef5b16","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0ea8c0cf-9a1c-43a3-bea5-faca5c68f191","root":false,"$title":"[M.2.0.1][INPUT] Valida CPF","$position":{"top":"697px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"fbd38da5-c763-4500-aaf8-955e2461e1a8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c","typeOfStateId":"state","$connId":"con_83","$id":"23207c0a-4052-4886-8c62-fa4af789e8fd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f549ed1f-5144-4910-b3eb-1d4931affe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(message, contas) {\n\ttry {\n\t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tif (isNaN(message)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tconst index = Number(message) - 1\n\t\tconst parsedContas = JSON.parse(contas)\n\t\tconst contaSelecionada = parsedContas.contas[index]\n\t\tif (!contaSelecionada) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\treturn contaSelecionada\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","contas"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c40f5e3d-554a-4b05-9ff3-b668ef7cecdc","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"contaSelecionada","value":"{{userInput}}"},"conditions":[{"values":["input inesperado","inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"d3c4d368-dab9-428c-8a29-11cb27cd80bb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f1e9fe18-56a9-4b25-b28b-807e3fbd01ea","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"7b51d409-9bdc-42d5-b838-86cbdd2eede0","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.3.1.1","variable":"exceptionType"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-98f686fc-0caa-4fc6-bdd8-ec28f1a97436","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7436d180-c6c5-4747-a725-09c35810c6ea","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bb20fb88-efee-406c-8126-d778100039d2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f602b69f-ed8d-4a20-9839-8bb067340a10","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f0483df1-ca2c-45e5-95b0-8a1b9c27d0fb","root":false,"$title":"[M.3.1.1][INPUT] Valida Seleção de conta","$position":{"top":"1334px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e567a78-dbb9-4216-baa4-9d476bc2b887":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"633713cd-19ca-4db4-89db-7d7f4e743c98","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"c2169ab5-6936-4b69-aadb-73b7330b39bc","typeOfStateId":"state","$connId":"con_88","$id":"88d96d36-20fb-4051-aea1-130b6fadaef6","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"992bb5b8-1303-48c7-931a-f01ab2eaf914","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(message, ec) {\n\ttry {\n\t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n\n\t\tif (isNaN(message)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tconst index = Number(message) - 1\n\t\tconst parsedEc = JSON.parse(ec)\n\t\tconst ecSelecionado = parsedEc.ecList[index]\n\t\tif (!ecSelecionado) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\treturn ecSelecionado\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content","ecList"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"493ad05b-2c7d-4996-9039-3779f2364a01","$typeOfContent":"","type":"SetVariable","$title":"Set \"selectedEc\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"selectedEc","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"710fb3be-ade5-4044-970a-b609fe9d3947","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"023a3323-c889-4d8b-9b1e-0a3e90055e1f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"51e3ecb2-3cd4-4e9e-85ad-bd5a2e11fb00","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" TO \"M.2.0.1\"","$invalid":false,"settings":{"value":"M.4.1.1","variable":"exceptionType"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4c77b390-d94e-4b8e-9f78-b91466321041","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-372633d1-debe-4784-8599-39aa40634212","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b7977481-9a93-4674-b408-6a9104f96275","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-48f25858-236e-411c-b1c4-c7ddb0bfaed1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0e567a78-dbb9-4216-baa4-9d476bc2b887","root":false,"$title":"[M.4.1.1][INPUT] Valida Seleção de ec","$position":{"top":"1141px","left":"2040px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"595bbc26-6daf-4319-a175-17192cf276fc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","typeOfStateId":"state","$connId":"con_93","$id":"a99636d2-f26d-493c-bc1a-ce50e9e39b6a","conditions":[{"source":"context","comparison":"equals","values":["Máquinas Safrapay"],"variable":"userInput"}],"$invalid":false},{"stateId":"c5482705-133e-4f31-b01e-7930e16e12a3","typeOfStateId":"state","$connId":"con_98","$id":"3a5498b9-e6af-4239-ae43-67f3bf7dfb1f","conditions":[{"source":"context","comparison":"equals","values":["Soluções"],"variable":"userInput"}],"$invalid":false},{"stateId":"20bd236e-277f-4ecf-94f0-f63bdcd5efb6","typeOfStateId":"state","$connId":"con_103","$id":"a50f025c-4721-4cdc-bf81-06efe1aeb30b","conditions":[{"source":"context","comparison":"equals","values":["Conta corrente"],"variable":"userInput"}],"$invalid":false},{"stateId":"621b7935-89f3-450d-87b1-6caf539d5ec7","typeOfStateId":"state","$connId":"con_108","$id":"40c7bc98-7ffd-4bf8-b539-ad3cc80cb673","conditions":[{"source":"context","comparison":"equals","values":["Produtos"],"variable":"userInput"}],"$invalid":false},{"stateId":"491c0860-a3da-491c-bfc6-3b7f99e29c29","typeOfStateId":"state","$connId":"con_113","$id":"e618a090-8648-4609-b70b-ec545b004438","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"172bdd8d-2409-4bc2-8335-09884e2ecb33","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n\nfunction run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f082125-b0fd-4f51-9297-74bfc4b4c961","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"38306ba1-03a0-4eaf-a340-f50c2d48264d","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ab889191-fb1d-4935-9e7a-3fc688cbeede","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"precisaKBA\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(userInput) {\n\ttry {\n\t\tconst listaKBA = [\n\t\t\t\"Descredenciamento\",\n\t\t\t'Questionar uma cobrança',\n\t\t\t'pacotes',\n\t\t\t'Simulador de vendas',\n\t\t\t'Taxa Pix na Safrapay',\n\t\t\t'Taxas de antecipação',\n\t\t\t'Taxas de venda',\n\t\t\t'Consultar máquinas',\n\t\t\t'Domicílio bancário']\n\t\t\tconst precisaKBA = listaKBA.some(intencao => userInput === intencao)\n\n\t\t\tif (precisaKBA){\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t} catch(erro){\n\t\treturn false\n\t}\n}","inputVariables":["userInput"],"outputVariable":"precisaKBA","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a39d9f66-ffe2-40a0-9d91-8307c0d8cdb0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"2c33d508-83ac-45cd-b327-99711864563b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-07a71764-71fb-4988-aeaf-47a1df8cb317","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d659e701-21b5-4524-b873-59bbc5673efe","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-84aea48e-b901-4651-840d-fee245a2c4b0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-66ac4cbf-476f-41e3-859a-5690dc64097b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"595bbc26-6daf-4319-a175-17192cf276fc","root":false,"$title":"[M.5.0.0][INPUT] Menu Principal","$position":{"top":"1816px","left":"1720px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7d220bd-2237-49f4-88ec-14c555bf202c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',//Refatorar\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a28b84f3-24b9-4629-bcb9-2ba5d783cb66","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0a2f5c0f-196e-411a-945b-5b18602072fc","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c7d220bd-2237-49f4-88ec-14c555bf202c","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"895px","left":"126px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c5482705-133e-4f31-b01e-7930e16e12a3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Soluções ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d4298a8d-1afd-4a91-84a2-fc09dcf31ed6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-788a7880-468f-4582-81a2-e60d018ed42b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f794f041-bcb7-4769-83f9-4712534b97d5","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c5482705-133e-4f31-b01e-7930e16e12a3","root":false,"$title":"[Redirect] To Soluções","$position":{"top":"1816px","left":"1289px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"621b7935-89f3-450d-87b1-6caf539d5ec7":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b97c4ff7-f36a-4b19-8940-73380870d248","typeOfStateId":"state","$connId":"con_118","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n\t{\n\t\t\"id\": \"1\",\n\t\t\"title\": \"Seguros\",\n\t\t\"description\": \"Informações sobre seguros.\"\n\t},\n\t{\n\t\t\"id\": \"2\",\n\t\t\"title\": \"Investimentos\",\n\t\t\"description\": \"\"\n\t},\n\t{\n\t\t\"id\": \"3\",\n\t\t\"title\": \"Renegociação\",\n\t\t\"description\": \"Renegociação de dívidas\"\n\t},\n\t{\n\t\t\"id\": \"4\",\n\t\t\"title\": \"Gravame\",\n\t\t\"description\": \"Linha de crédito\"\n\t},\n\t{\n\t\t\"id\": \"5\",\n\t\t\"title\": \"Meu Desempenho Safrapay\",\n\t\t\"description\": \"Contratar, cancelamento e dúvidas\"\n\t},\n\t{\n\t\t\"id\": \"6\",\n\t\t\"title\": \"Cartão\",\n\t\t\"description\": \"Solicitar e desbloquear cartão, esqueci minha senha e perda/roubo\"\n\t},\n\t{\n\t\t\"id\": \"7\",\n\t\t\"title\": \"Talão de cheque\",\n\t\t\"description\": \"Como solicitar novo talão de cheques\"\n\t}\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n\tif (posicao > menuOptions.length) {\n\t\tposicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n\t}\n\tif (menuOptions.find(option => option.id == posicao)) {\n\t\tquantidadeItens = menuOptions.length\n\t\tfor (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n\t\t\tmenuOptions[i].id = (i + 2).toString()\n\t\t}\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72) || ''\n\t\t})\n\t} else {\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72)\n\t\t})\n\t}\n\tmenuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n\t// Parametro de busca é o title ou description da opção que deseja atualizar\n\tconst opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tmenuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n\tmenuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (permissoes.includes(permissoesNecessarias)) {\n\t\treturn\n\t}\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n */\nfunction run(contaSelecionada) {\n\ttry {\n\t\tconst { segmentoGerente } = JSON.parse(contaSelecionada)\n\n\t\tif (!segmentoGerente) {\n\t\t\tremoveOpcaoDoMenu({ tituloDoBotao: 'Gravame' })\n\t\t\tremoveOpcaoDoMenu({ tituloDoBotao: 'Renegociação' })\n\t\t}\n\n\t\tif (segmentoGerente === 'emp1') {\n\t\t\tremoveOpcaoDoMenu({ tituloDoBotao: 'Talão de cheque' })\n\t\t}\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo! Sobre *Produtos*, do que você precisa? Escolha na lista a seguir:`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\texceptionType: 'reiniciarFluxo',\n\t\t\tdynamicContent: {\n\t\t\t\t\"type\": \"text/plain\",\n\t\t\t\t\"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c2c6bdf2-80db-4300-af7a-11c8f4f5476d","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"02e6f307-30a9-40d5-b508-b962c38ac9f9","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"a5a4ebf2-b21a-4bf6-94b6-c1674c4e33c6","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b56e5f5f-1b98-437e-9355-44a0b1fc2024","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9707e133-ba8f-42bc-abab-24c6d313bb8e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8da94141-b740-406e-92a0-15bdc62b88a4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e7b6caaa-8f12-4f8c-84d8-f103bdcd7997","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"621b7935-89f3-450d-87b1-6caf539d5ec7","root":false,"$title":"[M.5.4.0][MSG] Produtos","$position":{"top":"2058px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b97c4ff7-f36a-4b19-8940-73380870d248":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b2d0943f-28c6-40ee-87a3-c98641dda5eb","typeOfStateId":"state","$connId":"con_123","$id":"94856239-8f60-4ab0-a169-b974a0e70313","conditions":[{"source":"context","comparison":"equals","values":["Meu Desempenho Safrapay"],"variable":"userInput"}],"$invalid":false},{"stateId":"384b6397-2b2e-4808-af80-3c5540244ccf","typeOfStateId":"state","$connId":"con_128","$id":"5fab60e0-7cd2-4bff-a18a-6c2ef1e01717","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7ab3855e-f2c3-4d87-b332-606c3aa8c341","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e38bc6ad-593c-449c-a4a0-99c923f8696c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-494384de-02b0-4741-814d-6e91ef385cfb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e0a490e3-7832-4cd9-936f-aa9986fbf87b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b97c4ff7-f36a-4b19-8940-73380870d248","root":false,"$title":"[M.5.4.0][INPUT] Produtos","$position":{"top":"2257px","left":"1721px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"384b6397-2b2e-4808-af80-3c5540244ccf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10c195ed-131d-4823-a09f-de96fb954625","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5e03585d-c827-4161-8532-e49447d72933","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\tconst destination = {\n\t\t'Seguros': {\n\t\t\tbotDestination: 'seguros',\n\t\t\tstateDestination: 'welcome'\n\t\t},\n\t\t'Investimentos': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'f88bbdeb-3963-49e0-a355-edc20350bbfd'\n\t\t},\n\t\t'Renegociação': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: '5ea0cac6-c5fd-49f9-9423-54d0e660adae'\n\t\t},\n\t\t'Gravame': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: '1e3206de-707e-4dac-9749-9f24d53110c0'\n\t\t},\n\t\t'Talão de cheque': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'c1af60de-05a9-4466-8c99-b2ddb36a220a'\n\t\t},\n\t\t'Cartão': {\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: '37f23f86-2009-43f1-b7a5-f50093c784f0'\n\t\t}\n\t}\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst destinationBot = destination[intent]\n\t\tif (!destinationBot) {\n\t\t\tthrow new Error('invalid destination')\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\t...destinationBot,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: \"\",\n\t\t\tstateNameOrigin: \"\",\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"820ba5c8-e91c-44fe-8276-cbdc5aeb6c67","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-daa6ad2b-dd47-48c8-aa57-fd1ef1012c0f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4a1acde2-a567-4a84-aff9-a76c2ae158e8","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"384b6397-2b2e-4808-af80-3c5540244ccf","root":false,"$title":"[Redirect] Menu produtos","$position":{"top":"2441px","left":"1551px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20bd236e-277f-4ecf-94f0-f63bdcd5efb6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"10c195ed-131d-4823-a09f-de96fb954625","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5e03585d-c827-4161-8532-e49447d72933","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: 'contacorrente',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"820ba5c8-e91c-44fe-8276-cbdc5aeb6c67","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1f170bd1-7b58-4c45-b883-3fc3ee76ae62","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4632a7f4-de1a-47a6-9335-e7e0a5e18875","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"20bd236e-277f-4ecf-94f0-f63bdcd5efb6","root":false,"$title":"[Redirect] Menu Conta Corrente","$position":{"top":"1816px","left":"2030px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b2d0943f-28c6-40ee-87a3-c98641dda5eb":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fd7b8c78-dba9-45c2-a0db-aca46722d054","typeOfStateId":"state","$connId":"con_133","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n\t{\n\t\t\"id\": \"1\",\n\t\t\"title\": \"Contratar\",\n\t\t\"description\": \"\"\n\t},\n\t{\n\t\t\"id\": \"2\",\n\t\t\"title\": \"Cancelamento\",\n\t\t\"description\": \"\"\n\t},\n\t{\n\t\t\"id\": \"3\",\n\t\t\"title\": \"Dúvidas\",\n\t\t\"description\": \"\"\n\t}\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n\tif (posicao > menuOptions.length) {\n\t\tposicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n\t}\n\tif (menuOptions.find(option => option.id == posicao)) {\n\t\tquantidadeItens = menuOptions.length\n\t\tfor (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n\t\t\tmenuOptions[i].id = (i + 2).toString()\n\t\t}\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72) || ''\n\t\t})\n\t} else {\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72)\n\t\t})\n\t}\n\tmenuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n\t// Parametro de busca é o title ou description da opção que deseja atualizar\n\tconst opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tmenuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n\tmenuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (permissoes.includes(permissoesNecessarias)) {\n\t\treturn\n\t}\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada) {\n\ttry {\n\t\t// const { segmentoGerente } = JSON.parse(contaSelecionada)\n\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, sobre *Meu Desempenho Safrapay* como podemos te ajudar?`\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Escolha uma opção\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\texceptionType: 'reiniciarFluxo',\n\t\t\tdynamicContent: {\n\t\t\t\t\"type\": \"text/plain\",\n\t\t\t\t\"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9ac0c986-563b-469a-8115-face235dd247","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"023a3972-dd2e-4075-8b2b-6660bc2f68d1","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"a8538802-bcab-45a0-a326-fd578e9d1f0f","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a7a7c606-c4ee-4973-beb7-0d457e9cbfd3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-21398590-964f-49cf-b809-d88601a4f950","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1bff462e-d0e3-4e69-98bb-7b680a400d14","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4186bf6c-2842-4312-b969-1c9548953936","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b2d0943f-28c6-40ee-87a3-c98641dda5eb","root":false,"$title":"[M.5.4.1][MSG] Meu Desempenho","$position":{"top":"2454px","left":"1960px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fd7b8c78-dba9-45c2-a0db-aca46722d054":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","typeOfStateId":"state","$connId":"con_138","$id":"9df32c47-7799-4014-bb2a-33ed9f012542","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\",\n        \"4\": \"quart[ao]|[qc]uat(r)?o\",\n        \"5\": \"quint[ao]|[sc]inc[ou]\",\n        \"6\": \"sext[ao]|[sc]inc[uo]\",\n        \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n        \"8\": \"oitav[ao]|oit[ou]\",\n        \"9\": \"non[ao]|nov[ei]\",\n        \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n        rows.forEach((button, index) => {\n            const key = `\\\\b${index + 1}\\\\b|${posicoes[index + 1]}|${button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()}`\n            regexDictionary[key] = button.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-19f29c4c-4f60-4f67-8794-7bad740d5bcf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bf04d85a-5e9e-4917-b312-1f97971ac3c6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-32a13223-ee83-4505-91b0-74b2da286acf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4b57c39a-ac3f-412f-a8bd-bef9c2b30f40","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"fd7b8c78-dba9-45c2-a0db-aca46722d054","root":false,"$title":"[M.5.4.1][INPUT] Meu Desempenho","$position":{"top":"2677px","left":"1960px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f2c4d052-2f9b-4aa8-9925-48aa824fc35c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fddf678d-21aa-4e76-940d-4c7350e5e95b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2ca1bf69-9397-47dc-ae96-a4f8f6e54a90","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","root":false,"$title":"[Redirect] to Atendimento Humano","$position":{"top":"2893px","left":"1960px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8d2f811-ac89-4e91-9b16-c93b4b661447":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5d50808-89ef-4829-a22e-9ff8a722b3ed","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","typeOfStateId":"state","$connId":"con_143","$id":"362ef9b3-c7dc-472a-bf56-7e87ff699ceb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"2d666d07-e7b6-4ebf-b17a-36a613c3163f","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"bot\"","$invalid":false,"settings":{"variable":"atendimento","value":"bot"},"conditions":[]},{"$id":"39e7c0e1-eba2-4cc4-a850-89ed3ea6ff5f","$typeOfContent":"","type":"SetVariable","$title":"Set \"idSessao\" to \"{random.guid}\"","$invalid":false,"settings":{"variable":"idSessao","value":"{{random.guid}}"},"conditions":[]},{"$id":"006f7ef8-db09-4c02-91c3-236244038996","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main id sessao\"","$invalid":false,"settings":{"extras":{},"category":"SPD Main id sessao","action":"{{calendar.datetime}} | {{contact.identity}} | {{idSessao}}"},"conditions":[]},{"$id":"082408ed-5e16-420c-bbaf-431414b2beff","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionTypeMedia\" to \"false\"","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"false"},"conditions":[]},{"$id":"5e8be885-1804-47b0-b82e-3f9d6bf65a13","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"\"","$invalid":false,"settings":{"variable":"contaSelecionada"},"conditions":[]},{"$id":"a09b5d09-2b3d-4d30-aac1-dc4539f56ea1","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"errorCounter\"","$invalid":false,"settings":{"variable":"errorCounter","expiration":1},"conditions":[]},{"$id":"182cbadf-5180-4961-a503-6595224b8caf","$typeOfContent":"","type":"SetVariable","$title":"Set \"returnStateAuth\" to \"false\"","$invalid":false,"settings":{"variable":"returnStateAuth","value":"false"},"conditions":[]},{"$id":"c21ffa88-e7c7-4c64-bbf4-ca1858acb9db","$typeOfContent":"","type":"SetVariable","$title":"Set \"autenticado\" to \"false\"","$invalid":false,"settings":{"variable":"autenticado","value":"false"},"conditions":[]},{"$id":"35857fee-39ca-4a12-ac7b-a6330b3986be","$typeOfContent":"","type":"SetVariable","$title":"Set \"cpfAppKey\" to \"\"","$invalid":false,"settings":{"variable":"cpfAppKey"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1eb77059-3a98-4e59-ba2b-1c6f974cfc6e","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"inicio\"","$invalid":false,"settings":{"variable":"assunto","value":"inicio"},"conditions":[]},{"$id":"0c352339-18f4-4aac-ad53-ee731d41e2e5","$typeOfContent":"","type":"SetVariable","$title":"Set \"autoservico\" to \"\"","$invalid":false,"settings":{"variable":"autoservico"},"conditions":[]},{"$id":"445f9420-03a2-40e6-b147-f4dc22d999eb","$typeOfContent":"","type":"SetVariable","$title":"Set \"autenticadoKba\" to \"false\"","$invalid":false,"settings":{"variable":"autenticadoKba","value":"false"},"conditions":[]},{"$id":"9a603e47-85a1-48bc-8f5e-f05b77789460","$typeOfContent":"","type":"SetVariable","$title":"Set \"voltarState\" to \"\"","$invalid":false,"settings":{"variable":"voltarState"},"conditions":[]},{"$id":"488b16b0-d9e5-445a-9fd4-98aaf6fbbe95","$typeOfContent":"","type":"MergeContact","$title":"Reset \"extras\"","$invalid":false,"settings":{"extras":{"cpf":"-","broadcastOrigem":"-","team":"-"}},"conditions":[]},{"$id":"0653f0d8-05ec-4dbb-a7de-4a23318e2546","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a21d606d-c1bd-473c-ae34-4bf3b58cab53","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0a2b176c-5159-478a-b79b-acef29735c82","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e5b271be-268a-4ccf-9059-641bf13565ed","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"a8d2f811-ac89-4e91-9b16-c93b4b661447","root":false,"$title":"[M.0.0.0] Limpa Variaveis","$position":{"top":"155px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fde8a193-6fdc-4490-bbf2-a99a74582176":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a92fceaf-398b-4a1c-a11d-9706d16172aa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9479f7b-dc6b-4f15-b610-2c69bdd1a97a","typeOfStateId":"state","$connId":"con_148","$id":"5405182f-cdaa-46c6-a002-8573045dca48","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ecList@ecQuantity"},{"values":[],"source":"context","comparison":"notExists","variable":"exibeSelecionarEc@error"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"c2169ab5-6936-4b69-aadb-73b7330b39bc","typeOfStateId":"state","$connId":"con_153","$id":"a4db9b7f-178d-4554-8ecc-f2a55f4999a6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"506cda97-d7be-4c56-95ee-1513a6449bed","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager","value":"504"},"conditions":[]},{"$id":"3595f2db-845a-46a9-b8e4-971d340e6e61","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager2\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager2","value":"504"},"conditions":[]},{"$id":"2a9a6927-9903-4663-8428-728f53b306e1","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager3\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager3","value":"504"},"conditions":[]},{"$id":"c0c0c6b8-1afd-4ce4-b885-925a92a8cd73","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusAccountManager4\" to \"504\"","$invalid":false,"settings":{"variable":"statusAccountManager4","value":"504"},"conditions":[]}],"$leavingCustomActions":[{"$id":"30d3d657-a220-4319-960b-99da5d05028d","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" AG/CONTA","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{idSessao}}","Safra-Bot-ID":"{{config.serviceName}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusAccountManager","responseBodyVariable":"bodyAccountManager"},"conditions":[]},{"$id":"681fd1ec-ab7f-46cf-acb8-a00fcdeaedda","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Agencia/Conta","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/gerentes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET | {{statusAccountManager}} | {{bodyAccountManager}}"},"conditions":[]},{"$id":"6ba9e482-f73a-4643-8d14-45bb28306258","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" Segmento 20","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0020","responseStatusVariable":"statusAccountManager2","responseBodyVariable":"bodyAccountManager"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}]},{"$id":"45fe4d58-7c28-438c-950f-952042acd9ec","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Segmento 20","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0020 | GET | {{statusAccountManager2}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager"}]},{"$id":"feac2a4a-087d-414a-93eb-345ca1f991f5","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" Segmento 17","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0017","responseStatusVariable":"statusAccountManager3","responseBodyVariable":"bodyAccountManager"},"conditions":[{"source":"context","comparison":"notEquals","variable":"statusAccountManager2","values":["200"]},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"}]},{"$id":"fbbe8643-7f87-4484-8e52-216ad1b09264","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\" Segmento 17","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/contas-pessoa-fisica/v1/gerentes?cpfCnpj={{contaSelecionada@doc}}&codigoSegmento=0017 | GET | {{statusAccountManager3}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager2"}]},{"$id":"27d6671d-9b1c-47c7-9d6c-cdcd9929aea3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAccountManager\" using \"GET\" PHONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J","responseStatusVariable":"statusAccountManager4","responseBodyVariable":"bodyAccountManager"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"variaveldesativada"}]},{"$id":"81e4f97d-b045-488d-82ab-e91b2d278d4c","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/gerentes/v1/carteiras?dddCelular={{telephone@ddd}}&numeroCelular={{telephone@telephone}}&tipoPessoa=J | GET | {{statusAccountManager4}} | {{bodyAccountManager}}"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusAccountManager3"},{"values":["504"],"source":"context","comparison":"notEquals","variable":"statusAccountManager3"}]},{"$id":"57d42e37-72f1-43e5-8a0b-49cc9217f78e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyAccountManager, contaSelecionada) {\n\ttry {\n\t\tconst selecionada = JSON.parse(contaSelecionada)\n\t\tconst { id, sigla, codigoSegmento } = JSON.parse(bodyAccountManager).data\n\t\tselecionada['filaGerente'] = sigla || id\n\t\tif (Number(codigoSegmento) === 17) {\n\t\t\tselecionada['segmentoGerente'] = 'emp2'\n\t\t}\n\t\tif (Number(codigoSegmento) === 20) {\n\t\t\tselecionada['segmentoGerente'] = 'emp1'\n\t\t}\n\t\treturn selecionada\n\t} catch (err) {\n\t\treturn contaSelecionada\n\t}\n}","inputVariables":["bodyAccountManager","contaSelecionada"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85a01d06-18f8-424a-9835-0cadc7a1f8f8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 200)) {\n\t\t\treturn 'ok'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\treturn 'erro api'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusAccountManager","statusAccountManager2","statusAccountManager3","statusAccountManager4"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"51538566-a3e0-4f14-9c21-42ddcaf26d1c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5e37f231-799f-427b-b9b8-58d5d371eaf5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-b8d21936-4992-4324-974b-5694ea176797","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-12e7634f-b9e1-4721-be12-e3e70aafd14f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-515d925f-a28c-47f4-b7e6-f762559acc75","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fde8a193-6fdc-4490-bbf2-a99a74582176","root":false,"$title":"[M.4.0.1][HTTP] Obtem Carterização","$position":{"top":"1116px","left":"1477px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e06cd93-6019-4a34-8468-b364f7ec47e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17e64ee0-3424-4597-bb39-91427781d927","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1401706f-cf89-4342-a34c-48af501b1be6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `broadcast ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"6e98faa6-4465-42b7-8aad-85e25ef1a72e","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8c480a7c-791c-45aa-8830-4b480587d808","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e405c89e-c5f5-401f-b3a2-feca4eb2ac72","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"3e06cd93-6019-4a34-8468-b364f7ec47e9","root":false,"$title":"[Redirect] To broadcast","$position":{"top":"149px","left":"967px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c2169ab5-6936-4b69-aadb-73b7330b39bc":{"$contentActions":[{"action":{"$id":"736281f9-0eff-4a05-9dff-f34beca69225","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"29c4f6d5-641c-4867-be97-d4f34d2e1f68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"29c4f6d5-641c-4867-be97-d4f34d2e1f68","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cef2034b-c428-42cd-898d-a3259185c171","$typeOfContent":"text","type":"SendMessage","settings":{"id":"85d225b1-b127-4177-aa29-0b5d516fd714","type":"text/plain","content":"{{msgCpfAppkey}}","metadata":{}},"$cardContent":{"document":{"id":"85d225b1-b127-4177-aa29-0b5d516fd714","type":"text/plain","content":"{{msgCpfAppkey}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cd2af6b-1fb5-4d7a-9f57-ec1f93729c4a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7643c242-b10a-455c-9881-9180b292de9e","typeOfStateId":"state","$connId":"con_158","$id":"3359c0af-c107-4cc8-96a4-bbbac99c8979","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4e4c26c2-c277-41fc-a70c-1a08afff6f0f","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyAppKey\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"SPD"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/autorizacoes-acessos-clientes/assistente-virtual/v1/chaves?documento={{contact.extras.cpf}}","responseStatusVariable":"statusAppKey","responseBodyVariable":"bodyAppKey"},"conditions":[{"source":"context","comparison":"notEquals","variable":"resource.bdsp","values":["false"]}]},{"$id":"26be31b2-7973-4187-adcf-c1e125eb2e82","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"cpfAppKey\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyAppKey) {\n\ttry {\n\t\tconst { chave } = JSON.parse(bodyAppKey).data\n\t\tif (chave) {\n\t\t\treturn chave.replace('-onboarding', \"\")\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["bodyAppKey"],"outputVariable":"cpfAppKey","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"e28ae169-5d15-49ed-b7ff-b9da221b80c6","$typeOfContent":"","type":"SetVariable","$title":"Set \"appKey\" to \"{cpfAppKey}\"","$invalid":false,"settings":{"variable":"appKey","value":"{{cpfAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"d078a281-edce-43ef-a79d-121a8c0d6a6e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgCpfAppkey\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(cpfAppKey, msgBdsp) {\n\ttry {\n\t\tif (msgBdsp == 'false') {\n\t\t\treturn \"\"\n\t\t}\n\t\tif (cpfAppKey && cpfAppKey != 'false') {\n\t\t\treturn `Temos novidades incríveis para você! Agora é possível *fazer PIX*, *consultar extratos*, *antecipar saldo* e *pagar contas* diretamente por este canal.\n\n É muito fácil:\n1. Acesse o *menu principal*.\n2. Selecione a opção *Conta Corrente*.\n3. Escolha a funcionalidade que você precisa.\n\nExperimente e aproveite todas as facilidades que preparamos para você!`\n\t\t}\n\t\treturn \"\"\n\t} catch (err) {\n\t\treturn \"\"\n\t}\n}","inputVariables":["cpfAppKey","resource.msgBdsp"],"outputVariable":"msgCpfAppkey","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"6ce6494e-31d8-4a6c-b635-d312dc602401","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatusCpfAppKey\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 200)) {\n\t\t\treturn 'ok'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 404)) {\n\t\t\treturn 'ok-notfound'\n\t\t}\n\t\tif (apiStatus.some((status) => status == 500)) {\n\t\t\treturn 'ok-error'\n\t\t}\n\t\treturn 'erro api'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusAppKey"],"outputVariable":"apiStatusCpfAppKey","LocalTimeZoneEnabled":false},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"171f1ea6-19c3-4527-9392-3ba371856c5e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo v2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/vendas-servicos/clientes/autorizacoes-acessos-clientes/assistente-virtual/v1/chaves?documento={{contact.extras.cpf}} | GET | {{statusAppKey}} | {{bodyAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"78469bd6-6ff8-4db1-8b30-230c12f1c295","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{apiStatusCpfAppKey}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatusCpfAppKey"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]},{"$id":"3b17b9ff-79fd-4b0d-b271-f4660d219e44","$typeOfContent":"","type":"TrackEvent","$title":"Track \"dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{calendar.datetime}} | {{contaSelecionada@doc}} | {{apiStatusCpfAppKey}}"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"resource.bdsp"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9f992d9d-48fc-4f37-a085-da9c0118a21a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-af4d5113-3d2e-4493-a5e4-9004dc206716","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-46573053-3f7c-4792-a208-e146bac4f6fc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3b1e1284-c620-469a-a542-62822ba08d60","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e3539683-3899-42d6-84cb-2365072d53ca","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c2169ab5-6936-4b69-aadb-73b7330b39bc","root":false,"$title":"[M.4.0.2][HTTP] Obtem CpfAppKey","$position":{"top":"1284px","left":"1717px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17659cb5-b9cb-435f-8276-aff558a0ec09","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b5bce4a-368f-48ac-8c8a-171e31e5b096","typeOfStateId":"state","$connId":"con_163","$id":"84b1d1fd-1b15-47ee-b6a0-63ad1b7fbb27","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6e32ecd-0036-422a-9b52-a2c5248982af","$typeOfContent":"","type":"SetVariable","$title":"Set \"bodyPermissoes\" to \"\"","$invalid":false,"settings":{"variable":"bodyPermissoes"},"conditions":[]},{"$id":"f75ff11d-d50b-46c1-886f-5ff06163ecf8","$typeOfContent":"","type":"SetVariable","$title":"Set \"statusPermissoes\" to \"\"","$invalid":false,"settings":{"variable":"statusPermissoes"},"conditions":[]},{"$id":"74468b7c-274c-4ee0-8495-575bab43bd11","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyPermissoes\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Bot-ID":"{{application.identifier}}","Safra-Aplicacao":"IPJ"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/usuarios/{{contaSelecionada@usuario}}/shortnames/{{contaSelecionada@shortname}}/permissoes","responseStatusVariable":"statusPermissoes","responseBodyVariable":"bodyPermissoes"},"conditions":[{"values":["MASTER"],"source":"context","comparison":"notEquals","variable":"contaSelecionada@nivel"}]},{"$id":"037828e8-1e4f-4593-a8ca-719ff17ae1c1","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api resumo","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api resumo","action":"{{statusPermissoes}} | bodyPermissoes"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c5ab13dd-9cb0-4f41-b51d-026b3a956013","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-64542599-57d1-4307-97cb-f7cb6330cdaf","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-210ec721-4757-415f-b033-eb31029a0e26","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"2df0f2b1-a1a6-4c77-b2e2-f319c1f0530c","root":false,"$title":"[M.3.1.2][HTTP] Obtem Permissionamento","$position":{"top":"1105px","left":"1002px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7643c242-b10a-455c-9881-9180b292de9e":{"$contentActions":[{"action":{"$id":"0e0be1ae-6e66-4684-8c39-60977c9300b0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ad9ae410-69e8-4343-8f34-3bb77f46fe22","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ad9ae410-69e8-4343-8f34-3bb77f46fe22","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:810"},{"action":{"$id":"4fd6f44f-e6e8-40ae-9303-6e03683af83b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2d194d8e-4e7d-4ed0-b2d7-6d938b49630f","type":"text/plain","content":"<b>Mensagem exibida apenas em desenvolvimento</b>\n\nNivel: {{contaSelecionada@nivel}}\n\nPermissoes:\n{{contaSelecionada@permissoes}}\n\nEC:\n{{contaSelecionada@ec}}\n\ncpfAppKey:\n{{contaSelecionada@cpfAppKey}}\n\nSegmento:\n{{contaSelecionada@segmentoGerente}}","metadata":{}},"$cardContent":{"document":{"id":"2d194d8e-4e7d-4ed0-b2d7-6d938b49630f","type":"text/plain","content":"<b>Mensagem exibida apenas em desenvolvimento</b>\n\nNivel: {{contaSelecionada@nivel}}\n\nPermissoes:\n{{contaSelecionada@permissoes}}\n\nEC:\n{{contaSelecionada@ec}}\n\ncpfAppKey:\n{{contaSelecionada@cpfAppKey}}\n\nSegmento:\n{{contaSelecionada@segmentoGerente}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:811"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6f53c324-2714-4b4f-a5e9-19080ec30458","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:812"}],"$conditionOutputs":[{"stateId":"30e39880-1d2a-439a-a0ed-1e7210966286","typeOfStateId":"state","$connId":"con_168","$id":"d33810d9-c5b9-472c-991b-487206cbfc2b","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:834"}],"$invalid":false,"$$hashKey":"object:824"}],"$enteringCustomActions":[{"$id":"aa19e1aa-873c-4bd3-9ce5-2d9607f58458","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"permissionList\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyPermissoes, contaSelecionada, listaPermissoes) {\n    try {\n        const parsedListaPermissoes = JSON.parse(listaPermissoes);\n        const { nivel } = JSON.parse(contaSelecionada);\n\n        if (nivel.toUpperCase() === 'MASTER') {\n            const permissoes = [];\n            Object.values(parsedListaPermissoes).forEach(grupo =>\n                Object.values(grupo).forEach(perm =>\n                    permissoes.push(...perm)\n                )\n            );\n            return permissoes;\n        }\n\n        const parsedBodyPermissoes = JSON.parse(bodyPermissoes);\n        let permissoes = [];\n\n        parsedBodyPermissoes.data.forEach(({ codigoGrupo, codigosServicos }) => {\n            if (parsedListaPermissoes[codigoGrupo]) {\n                codigosServicos.forEach(codigoServico => {\n                    const permissoesGrupo = parsedListaPermissoes[codigoGrupo][codigoServico];\n                    if (permissoesGrupo) {\n                        permissoes.push(...permissoesGrupo);\n                    }\n                });\n            }\n        });\n        return [...new Set(permissoes.sort((a, b) => a.localeCompare(b)))]\n    } catch (err) {\n        return { error: err.message };\n    }\n}","inputVariables":["bodyPermissoes","contaSelecionada","resource.listaPermissoes"],"outputVariable":"permissionList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"86a53fb6-7c67-4363-9efa-0a71be14af8d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"contaSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(permissionList, cpfAppKey, contaSelecionada, selectedEc) {\n\ttry {\n\t\tconst parsedPermissionList = JSON.parse(permissionList)\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada)\n\n\t\tparsedContaSelecionada.permissoes = parsedPermissionList\n\t\tparsedContaSelecionada.cpfAppKey = cpfAppKey || false\n\n\t\tif (selectedEc) {\n\t\t\tconst { codigoEc } = JSON.parse(selectedEc)\n\t\t\tparsedContaSelecionada.ec = codigoEc\n\t\t} else {\n\t\t\tparsedContaSelecionada.ec = false\n\t\t}\n\t\t\n\t\treturn parsedContaSelecionada\n\t} catch (err) {\n\t\treturn { error: err.message, contaSelecionada: JSON.parse(contaSelecionada) }\n\t}\n}","inputVariables":["permissionList","cpfAppKey","contaSelecionada","selectedEc"],"outputVariable":"contaSelecionada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e891e1c9-f680-43c2-bea3-28978a55dfba","$typeOfContent":"","type":"SetVariable","$title":"Set \"numeroSegmento\" to \"{contaSelecionada@codigoSegmento}\" (USA EM WS PJ)","$invalid":false,"settings":{"variable":"numeroSegmento","value":"{{contaSelecionada@codigoSegmento}}"},"conditions":[]},{"$id":"1325c31f-89fd-4a95-af5d-c09e08f4264f","$typeOfContent":"","type":"SetVariable","$title":"set \"naoCliente\" TO \"false\" (Usa em WS PJ)","$invalid":false,"settings":{"variable":"naoCliente","value":"false"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8c0eac48-6620-48c4-8e40-8d199f1590cd","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} permissionList erro\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} permissionList erro","action":"{{permissionList@error}} || {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"permissionList@error"}]},{"$id":"b7778a47-6ae5-44b4-bb3c-af7ac6b7da14","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} contaSelecionada erro\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} contaSelecionada erro","action":"{{contaSelecionada@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@error"}]},{"$id":"0708cc50-e9f0-424b-9201-dc0df249b565","$typeOfContent":"","type":"SetVariable","$title":"Set \"contaSelecionada\" to \"{contaSelecionada@contaSelecionada}\"","$invalid":false,"settings":{"variable":"contaSelecionada","value":"{{contaSelecionada@contaSelecionada}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@error"},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@contaSelecionada"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8bdb291d-2a7f-4fcc-99d6-d541d44d1668","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fa3e576f-c718-4b80-a959-e6232020bd9e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3166dc6c-e817-493c-8c10-72d30f4ddcb9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7643c242-b10a-455c-9881-9180b292de9e","root":false,"$title":"[M.4.0.3][SET] Define permissionamento","$position":{"top":"1469px","left":"2046px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.65","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/devspdmain2","builder:useTunnelOwnerContext":"true","builder:stateExpiration":"0.00:15:00","clientId":"BLIP","grantType":"client_credentials","urlToken":"https://sts-api-hml.safra.com.br","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","env":"Dev","bot":"Bot Main Dev","serviceName":"Bot Main Dev","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"8289653d-805d-4f39-8379-c506c2360cca","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = !regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    const state = JSON.parse(voltarState)\n    try {\n        if (!voltarState) {\n            const state = {}\n            state[botOrigin] = [blockId]\n            return state\n        }\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}