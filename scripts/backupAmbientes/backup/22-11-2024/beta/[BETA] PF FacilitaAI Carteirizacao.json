{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"df28333f-d509-4c3f-acd7-6d4801130bae","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8c695219-8026-443c-a4f1-68132d1b4803","typeOfStateId":"state","$connId":"con_3","$id":"253b6bdd-9c0e-40e8-adf1-0da8e620ce31","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7a7ce5da-c71c-4acf-9020-0bd226587789","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intentBody\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tconst userInput = JSON.parse(inputContent).input.content\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": userInput\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": inputContent\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["input.content"],"outputVariable":"intentBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f4300622-8f73-4228-b1f9-694f43f37678","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"intentResponse\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.commandsKey}}","Content-Type":"application/json"},"method":"POST","body":"{{intentBody}}","uri":"{{config.commandsUrl}}","responseStatusVariable":"IntentStatus","responseBodyVariable":"IntentResponse"},"conditions":[]},{"$id":"7e5a543b-577f-4b62-b9c4-c286f47c13cb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(intent, accuracy) {\n\ttry {\n\t\tinput = JSON.parse(intent).resource.text;\n\t\treturn {\n\t\t\tinput: input,\n\t\t\tintent: findIntention(intent, accuracy)\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction findIntention(intent, accuracy) {\n\ttry {\n\t\tintent = JSON.parse(intent).resource.intentions\n\t\tindentifiedIntent = intent.filter(({ score }) => score > Number(accuracy))\n\t\tif (indentifiedIntent.length > 0) {\n\t\t\treturn indentifiedIntent[0].name;\n\t\t}\n\t\treturn null\n\t} catch (err) {\n\t\treturn null\n\t}\n}","inputVariables":["intentResponse","config.accuracy"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e2d62597-ab55-4f55-8fc5-c1a5671d0bd8","$typeOfContent":"","type":"MergeContact","$title":"DEFINIR CANAL WA","$invalid":false,"settings":{"extras":{"Canal":"WhatsApp"}},"conditions":[{"values":["@wa"],"source":"context","comparison":"contains","variable":"contact.identity"}]},{"$id":"f982c13c-c774-46ec-9305-81eccfe1b930","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"ac453170-b6fc-4785-9cda-5224fd07805f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f804a3b-8957-4712-b319-7b8e89ecf05e","$typeOfContent":"","type":"SetVariable","$title":"intencao","$invalid":false,"settings":{"variable":"intencao","value":"{{input.intent.name}}"},"conditions":[]},{"$id":"72d069df-c08d-4258-8ca7-27b9a3c44d86","$typeOfContent":"","type":"ExecuteScript","$title":"tracking intencao","$invalid":false,"settings":{"function":"run","source":"const run = (contact, intent) => {\n\ttry {\n\t\tconst intencao = JSON.parse(intent)\n\t\tconst dataRaw = new Date()\n\t\tdataRaw.setHours(new Date().getHours() - 3)\n\t\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\t\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\t\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\n\t\tconst telefone = contact.split(\"@\")[0]\n\t\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27a3e501-d334-4e7a-977c-446c3b8626c8","$typeOfContent":"","type":"TrackEvent","$title":"intencao inicio","$invalid":false,"settings":{"extras":{},"category":"intencao inicio","action":"{{tracking}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"tracking"}]},{"$id":"75134677-7fb0-4843-ace1-d95386034256","$typeOfContent":"","type":"TrackEvent","$title":"intencao api result","$invalid":false,"settings":{"extras":{},"action":"{{intentBody}} | {{IntentStatus}} | {{intentResponse}}","category":"intencao api result"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bcce6ab9-c078-4680-a579-83fa75d1ce74","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c95d8e9d-e09f-4d09-9f1b-021e311878e5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5b94d666-7e99-4c6e-93c2-dc6c9f7a7e49","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-1527be23-0f83-4294-8303-23d514dd0047","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e92835ce-083b-4fef-a63d-68c6f55c67e1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7362307c-9984-451a-85bc-fd1dcca92320","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"0px","left":"645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsComments":{"6d0f89c4-1a0f-40dc-ad21-629081da0e65":{"id":"6d0f89c4-1a0f-40dc-ad21-629081da0e65","text":"Teste","blocksIdList":["0abed19b-40e3-454c-bed3-c97f190fd32a"]},"f9d37de0-f22b-4c0e-9b6f-314aede2be83":{"id":"f9d37de0-f22b-4c0e-9b6f-314aede2be83","text":"Essa regra deveria ficar na API intermediaria.\n\nIsso dentro do Blip é uma gambiarra.","blocksIdList":["053082c2-9024-4d1c-a4a1-14129be5faa0"]}}},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72829bcb-49a0-4a88-b0e3-898db393e89b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"16b6d1b6-a332-48b5-8e88-ded1c07dd2ac","typeOfStateId":"state","$connId":"con_8","$id":"48a208af-981b-43f9-ba5b-8fc364063d16","conditions":[{"source":"context","comparison":"equals","values":["alterar conta","senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos","status de entrega","aviso viagem","envio comprovante"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","typeOfStateId":"state","$connId":"con_13","$id":"8ba9e0cf-d9d6-4089-bcee-0d58113b5ab4","conditions":[{"source":"intent","comparison":"equals","values":["sair"]}],"$invalid":false},{"stateId":"0fb18c4b-3d1a-4905-b922-197db4f5d1c8","typeOfStateId":"state","$connId":"con_18","$id":"084cd0d7-a8c3-492a-8711-a167b4d4299b","conditions":[{"source":"context","comparison":"equals","values":["a35fa267-f2b7-4298-83d9-b0924114e971"],"variable":"state.previous.id"},{"values":["extratoMaisAntigoQueDoisAnos"],"source":"context","variable":"exceptionType","comparison":"equals"}],"$invalid":false},{"stateId":"c6b1d835-f571-4c7a-975d-6e088158bc68","typeOfStateId":"state","$connId":"con_23","$id":"f1bf2dfa-0521-47c4-895c-a65177602f3f","conditions":[{"source":"context","comparison":"equals","values":["a5803973-dd8d-471a-bab6-a57c7add1a09","d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00"],"variable":"state.previous.id"},{"values":["erroApi"],"source":"context","comparison":"equals","variable":"exceptionType"}],"$invalid":false},{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","typeOfStateId":"state","$connId":"con_28","$id":"2f26d807-7949-4db0-a32a-042e9b3d231c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"5e0a82b2-14ed-445a-8f22-c5a4775ba950","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intentBody\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tconst userInput = JSON.parse(inputContent).input.content\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": userInput\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": inputContent\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["input.content"],"outputVariable":"intentBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"58b237c9-39cc-481f-83bb-05c924f8f352","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"intentResponse\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.commandsKey}}","Content-Type":"application/json"},"method":"POST","body":"{{intentBody}}","uri":"{{config.commandsUrl}}","responseStatusVariable":"intentStatus","responseBodyVariable":"IntentResponse"},"conditions":[]},{"$id":"189201a9-f4a0-4d72-a55d-5fb3018cc024","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(intent, accuracy) {\n\ttry {\n\t\tinput = JSON.parse(intent).resource.text;\n\t\treturn {\n\t\t\tinput: input,\n\t\t\tintent: findIntention(intent, accuracy)\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction findIntention(intent, accuracy) {\n\ttry {\n\t\tintent = JSON.parse(intent).resource.intentions\n\t\tindentifiedIntent = intent.filter(({ score }) => score > Number(accuracy))\n\t\tif (indentifiedIntent.length > 0) {\n\t\t\treturn indentifiedIntent[0].name;\n\t\t}\n\t\treturn null\n\t} catch (err) {\n\t\treturn null\n\t}\n}","inputVariables":["intentResponse","config.accuracy"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2598689f-011e-4846-8841-e65691f3b175","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (intent) => {\n\ttry {\n\t\tintent = JSON.parse(intent);\n\t\tif (intent === 'alterar conta') return false\n\t\treturn true\n\t}\n\tcatch(e){\n\t\treturn false;\n\t}\n}","inputVariables":["intencaoIdentificada"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b749e6f-4d9f-4fec-a545-61c985b00566","$typeOfContent":"","type":"ExecuteScript","$title":"tracking intencao","$invalid":false,"settings":{"function":"run","source":"const run = (contact, intent) => {\n\ttry {\n\t\tconst intencao = JSON.parse(intent)\n\t\tconst dataRaw = new Date()\n\t\tdataRaw.setHours(new Date().getHours() - 3)\n\t\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\t\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\t\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\n\t\tconst telefone = contact.split(\"@\")[0]\n\t\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"62917b79-3344-4a48-9415-d9a297fd9f71","$typeOfContent":"","type":"TrackEvent","$title":"intencao excecao","$invalid":false,"settings":{"extras":{},"category":"intencao excecao","action":"{{tracking}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"tracking"}]},{"$id":"214041e2-8352-4b79-b12f-6d3e3c9dd578","$typeOfContent":"","type":"TrackEvent","$title":"intencao api result","$invalid":false,"settings":{"extras":{},"action":"{{intentBody}} | {{IntentStatus}} | {{intentResponse}}","category":"intencao api result"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6a7d9ba8-89ce-483f-81a2-417fe413717b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4f506f07-82a3-43f3-82db-229e2c79f641","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-df6bc5d2-054d-423c-a65f-6472231e1466","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"176px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3add2fc9-71b1-4b63-a43e-a45f30df11ec":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4b190c25-7a56-4038-8e46-917c4a2ff876","typeOfStateId":"state","$connId":"con_33","$id":"de2cb42b-eca9-484f-9ea3-9d888467274c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4dfd3130-e5d2-4b15-af26-d9ea6066f2bb","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["config.clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{url}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"8ad0157c-c65a-4fc6-be53-c06ea4a46b06","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4b190c25-7a56-4038-8e46-917c4a2ff876","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7eb3a127-3b07-4e8e-943e-2d47aefa9ef9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6ee54d28-04be-434a-ac12-d011469104c8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-43d298b4-0951-4c7b-aec6-5d26a04ce096","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d89ad977-b7ee-4cb2-8102-31c8285ba698","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","root":false,"$title":"[API] TOKEN","$position":{"top":"569px","left":"645.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"4b190c25-7a56-4038-8e46-917c4a2ff876":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1a0c612-23cf-4cdd-90d0-488577ad654c","typeOfStateId":"state","$connId":"con_38","$id":"01d64960-24a8-4e44-af78-9b2092666742","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d18a9411-9fbd-4bac-b998-6790ee64a610","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@phoneIndentificationURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(phoneNumber) {\n  phoneNumber = JSON.parse(phoneNumber);\n\n  return JSON.stringify({\n    tipoPessoa: \"F\",\n    ddd: phoneNumber.DDD,\n    numeroCelular: phoneNumber.phone\n  //  ddd: '{{config.ddd}}',\n  //  numeroCelular: '{{config.telefone}}'\n  });\n}\n","inputVariables":["phoneNumber"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"IDENTIFICAÇÃO DE TELEFONE","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{token}}","Safra-Bot-ID":"{{safraBotId}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusTelIdent","responseBodyVariable":"responseTelIdent"},"conditions":[]},{"$id":"6e9d8fa1-60c4-4275-9122-eeaf2fb1108c","$typeOfContent":"","type":"ExecuteScript","$title":"customerName","$invalid":false,"settings":{"function":"run","source":"function run(responseTelIdent) {\n  responseTelIdent = JSON.parse(responseTelIdent);\n  return capitalizeText(responseTelIdent.data.nome);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["responseTelIdent"],"outputVariable":"customerName","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"ae5ef5a3-53ae-4765-96c9-c53295c7daac","$typeOfContent":"","type":"ExecuteScript","$title":"documentBase","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n  response = JSON.parse(response);\n  return response.data.baseDocumento;\n}\n","inputVariables":["responseTelIdent"],"outputVariable":"documentBase","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"ef942c4a-646b-4e75-8652-9c06e141d730","$typeOfContent":"","type":"ExecuteScript","$title":"document","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n  response = JSON.parse(response);\n  const data = response.data;\n  return `${data.baseDocumento}${data.digitosVerificadoresDocumento}`;\n}","inputVariables":["responseTelIdent"],"outputVariable":"document","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusTelIdent"}]},{"$id":"07da6220-267f-43b4-b2e2-063b38e58769","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusTelIdent}} | {{responseTelIdent}} | {{contact.identity}}"},"conditions":[]},{"$id":"d0e53900-81ca-4508-a50c-112b1cf39555","$typeOfContent":"","type":"ExecuteScript","$title":"nome","$invalid":false,"settings":{"function":"run","source":"const run = (response) => {\n\tconst nome = JSON.parse(response).data.nome.split(' ')[0]\n\treturn nome\n}","inputVariables":["responseTelIdent"],"outputVariable":"nome","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"ccf4e020-233d-46b6-ab04-f0093c3dd858","$typeOfContent":"","type":"ExecuteScript","$title":"email","$invalid":false,"settings":{"function":"run","source":"const run = (response) => {\n\ttry {\n\t\tconst email = JSON.parse(response).data.email;\n\t\treturn email;\n\t}\n\tcatch (e) {\n\t\treturn \"-\"\n\t}\n}","inputVariables":["responseTelIdent"],"outputVariable":"email","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true}],"$leavingCustomActions":[{"$id":"7b0fd582-5841-4cab-b0bb-5edcc8a65b4c","$typeOfContent":"","type":"MergeContact","$title":"Set customerName and Mail","$invalid":false,"settings":{"extras":{},"name":"{{customerName}}","email":"{{email}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a1a0c612-23cf-4cdd-90d0-488577ad654c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4951ab47-9051-412e-963b-48cc19036103","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-50e5f88d-56cb-445b-b494-3f5f51f26d2b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dbd766eb-149b-4ab4-8595-f9bf7babf372","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-8950a039-efa8-49c8-9f99-0997c618a79b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4c64c091-1450-48de-a479-8952b507b56c","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"4b190c25-7a56-4038-8e46-917c4a2ff876","root":false,"$title":"[API] IDENTIFICAÇÃO DE TELEFONE","$position":{"top":"701px","left":"647px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"d9359361-57c8-4d39-a392-69b769f419d6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","typeOfStateId":"state","$connId":"con_43","$id":"a22b28c5-ac7a-4378-833e-b17c7d46a61a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"dadosCliente"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"19a2c97f-ea54-419f-996b-e0bf649b7fc4","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@customerDataIndentificationURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(agency, account) {\n\treturn JSON.stringify({\n    agencia: agency,\n    conta: account\n  })\n}","inputVariables":["agency","account"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"IDENTIFICACAO DADOS CLIENTE","$invalid":false,"settings":{"headers":{"Safra-Bot-ID":"{{safraBotId}}","User-Agent":"Fiddler","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusClientData","responseBodyVariable":"responseClientData"},"conditions":[]},{"$id":"0721a989-53d8-4191-94ef-840d2aa17dc8","$typeOfContent":"","type":"ExecuteScript","$title":"segmentCode","$invalid":false,"settings":{"function":"run","source":"function run(responseClientData) {\n  responseClientData = JSON.parse(responseClientData);\n  const segmentCode = responseClientData.data.codigoSegmento;\n  return String(segmentCode).padStart(4, \"0\");\n}","inputVariables":["responseClientData"],"outputVariable":"segmentCode","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusClientData"}]},{"$id":"ca373739-5116-4242-a632-095e4a7b91b0","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusClientData}} | {{responseClientData}} | {{contact.identity}}"},"conditions":[]},{"$id":"127be61e-bc3e-4aed-8df4-94aa32267b88","$typeOfContent":"","type":"ExecuteScript","$title":"dadosCliente","$invalid":false,"settings":{"function":"run","source":"const run = (response, listaContas, agency, account) => {\n\tconst { agencia, conta, documento } = JSON.parse(response).data\n\tconst { codigoCliente } = JSON.parse(listaContas).data[0]\n\treturn {\n\t\tagencia: String(agency),\n\t\tconta: String(account),\n\t\tdocumento,\n\t\tcodCliente: codigoCliente\n\t}\n}","inputVariables":["responseClientData","responseAccountLists","agency","account"],"outputVariable":"dadosCliente","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusClientData"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-07138d35-e1a8-4712-afd6-de7f76278104","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-90b3b612-3b9f-4ec9-8945-68ae24ae45eb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b7d767dd-84d9-49e4-8dfc-a7bcd7032aaf","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-dbf571ac-478f-4203-bba1-df79722e1ef2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"d9359361-57c8-4d39-a392-69b769f419d6","root":false,"$title":"[API] IDENTIFICACAO DADOS CLIENTE","$position":{"top":"2695.43px","left":"676.429px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","textColor":"#ffffff"}},"b34040c5-af17-45f9-b86b-80c66c404a50":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d9d0be3e-336c-4ce7-a1a5-ebaa2a5d4a73","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","typeOfStateId":"state","$connId":"con_48","$id":"50bab68f-c748-4c64-a027-abe878317bfa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a97ceb66-d503-4a4d-ac59-797dab99f865","$typeOfContent":"","type":"SetVariable","$title":"env","$invalid":false,"settings":{"variable":"env","value":"{{config.env}}"},"conditions":[]},{"$id":"f6129fee-2112-4b3b-b3a1-cc903713a865","$typeOfContent":"","type":"ExecuteScript","$title":"envSettings","$invalid":false,"settings":{"function":"run","source":"function run(env) {\n  const envSettings = {\n    \"PRD\": {\n      tokenURL: \"https://sts-api.safra.com.br/api/oauth/token\",\n      phoneIndentificationURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais\",\n      accountListsURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas\",\n      customerDataIndentificationURL:\n        \"https://api.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/dados-cadastrais\",\n      managerCharterizationURL:\n        \"https://api.safra.com.br/chat-assistente/contas-pessoa-fisica/v1/gerentes\",\n    },\n    \"HML\": {\n      tokenURL: \"https://sts-api-hml.safra.com.br/api/oauth/token\",\n      phoneIndentificationURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-referencia-clientes/assistente-virtual/v1/dados-cadastrais\",\n      accountListsURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/contas\",\n      customerDataIndentificationURL:\n        \"https://api-hml.safra.com.br/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/dados-cadastrais\",\n      managerCharterizationURL:\n        \"https://api-hml.safra.com.br/chat-assistente/contas-pessoa-fisica/v1/gerentes\",\n    },\n  };\n\n  return envSettings[env];\n}","inputVariables":["env"],"outputVariable":"envSettings","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c43b25be-a10a-4b17-8108-7f9a284fdcfe","$typeOfContent":"","type":"SetVariable","$title":"safraBotId","$invalid":false,"settings":{"variable":"safraBotId","value":"safraprodgerdigpf"},"conditions":[]},{"$id":"6967121f-40d4-44de-bc64-f7f22fb7f800","$typeOfContent":"","type":"SetVariable","$title":"clientSecret","$invalid":false,"settings":{"variable":"clientSecret","value":"{{config.clientSecret}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3add2fc9-71b1-4b63-a43e-a45f30df11ec","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7abf6480-17f4-4b2a-8253-ed1fbddecc46","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-46f76fe4-1d39-48b5-8ce7-214eba2d2a5b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"b34040c5-af17-45f9-b86b-80c66c404a50","root":false,"$title":"[ENVIRONMENT SETTINGS]","$position":{"top":"416px","left":"645.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1a0c612-23cf-4cdd-90d0-488577ad654c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b394ca77-7b57-463c-8c25-e9bb2a03ef24","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"738f3f08-3ecb-42a6-9e34-b0c98d43a841","typeOfStateId":"state","$connId":"con_53","$id":"b4b10ac1-b973-423d-b3a6-b77039c0cfe2","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"customerFound"}],"$invalid":false},{"stateId":"facfc3e9-b838-42a8-b4f6-db9d1c11556b","typeOfStateId":"state","$connId":"con_58","$id":"4968e28b-4e1e-45ca-b965-a921eaa2089c","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"customerFound"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3e4944cf-9e69-4408-ab72-0f2d583e4126","$typeOfContent":"","type":"ExecuteScript","$title":"customerFound","$invalid":false,"settings":{"function":"run","source":"function run(statusTelIdent) {\n  const apiStatusRegExp = new RegExp(\"^2[0-9]{2}$\");\n  return apiStatusRegExp.test(statusTelIdent);\n}","inputVariables":["statusTelIdent"],"outputVariable":"customerFound","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusTelIdent"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5ff596a0-4c65-4152-891b-ae74e5df57a9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"a1a0c612-23cf-4cdd-90d0-488577ad654c","root":false,"$title":"[LO] Cliente encontrado?","$position":{"top":"882px","left":"646.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"738f3f08-3ecb-42a6-9e34-b0c98d43a841":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8317d8de-fce1-491c-b3c1-1f760e630ce1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8325d14c-c78f-4a7a-9c20-9ac10444761d","typeOfStateId":"state","$connId":"con_63","$id":"234f497e-b747-48ee-af7d-4431f62ef022","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"738f3f08-3ecb-42a6-9e34-b0c98d43a841","root":false,"$title":"[LO] Cliente Identificado (Sim)","$position":{"top":"997px","left":"443.111px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"facfc3e9-b838-42a8-b4f6-db9d1c11556b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9a4806c2-7579-4fa3-b2af-d0a768164525","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"872e291f-f7e3-47e4-bf53-a2fdc8d416b2","typeOfStateId":"state","$connId":"con_68","$id":"b4a56403-94c9-4136-a471-2ee30354da6a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"facfc3e9-b838-42a8-b4f6-db9d1c11556b","root":false,"$title":"[LO] Cliente Identificado (Não)","$position":{"top":"997px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c695219-8026-443c-a4f1-68132d1b4803":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c6611948-44ea-4e09-ab41-06901d7eeceb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7b86a601-9a6a-4460-9dee-a4fbe9026a3f","typeOfStateId":"state","$connId":"con_73","$id":"b3ad993d-6609-48be-8f5a-ab161f1dd560","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0f13b448-9c11-4d2b-b070-13a7d1bfb2d5","$typeOfContent":"","type":"ExecuteScript","$title":"userChannel","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  const DEFAULT_CHANNEL = \"other\";\n  const GOOGLE_CHANNEL = \"gbm\";\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n\n  const WHATSAPP_IDENTIFIER = \"wa.gw.msging.net\";\n  const BLIPCHAT_IDENTIFIER = \"0mn.io\";\n  const GOOGLE_IDENTIFIER = \"businessmessages.gw.msging.net\";\n  const FACEBOOK_IDENTIFIER = \"messenger.gw.msging.net\";\n  const INSTAGRAM_IDENTIFIER = \"instagram.gw.msging.net\";\n\n  const CHANNEL_INDEX = 1;\n  const contactChannelIdentifier = contactIdentity.split(\"@\")[CHANNEL_INDEX];\n\n  switch (contactChannelIdentifier) {\n    case WHATSAPP_IDENTIFIER:\n      return WHATSAPP_CHANNEL;\n\n    case BLIPCHAT_IDENTIFIER:\n      return BLIPCHAT_CHANNEL;\n\n    case FACEBOOK_IDENTIFIER:\n      return FACEBOOK_CHANNEL;\n\n    case INSTAGRAM_IDENTIFIER:\n      return INSTAGRAM_CHANNEL;\n\n    case GOOGLE_IDENTIFIER:\n      return GOOGLE_CHANNEL;\n\n    default:\n      return DEFAULT_CHANNEL;\n  }\n}","inputVariables":["contact.identity"],"outputVariable":"userChannel","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0b3d078-ffcd-47ab-90bd-1e3be8a69ddb","$typeOfContent":"","type":"ExecuteScript","$title":"bold","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const GOOGLE_CHANNEL = \"gbm\";\n\n  switch (userChannel) {\n    case WHATSAPP_CHANNEL:\n      return {\n        open: \"*\",\n        close: \"*\",\n      };\n    case BLIPCHAT_CHANNEL:\n    case GOOGLE_CHANNEL:\n      return {\n        open: \"<b>\",\n        close: \"</b>\",\n      };\n    case FACEBOOK_CHANNEL:\n    case INSTAGRAM_CHANNEL:\n      return {\n        open: \"\",\n        close: \"\",\n      };\n  }\n\n  return {\n    open: \"<b>\",\n    close: \"</b>\",\n  };\n}","inputVariables":["userChannel"],"outputVariable":"bold","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"01def259-21f1-4de1-861e-0ef38b05e835","$typeOfContent":"","type":"ExecuteScript","$title":"italic","$invalid":false,"settings":{"function":"run","source":"function run(userChannel) {\n  const WHATSAPP_CHANNEL = \"whatsapp\";\n  const BLIPCHAT_CHANNEL = \"blipchat\";\n  const FACEBOOK_CHANNEL = \"facebook\";\n  const INSTAGRAM_CHANNEL = \"instagram\";\n  const GOOGLE_CHANNEL = \"gbm\";\n\n  switch (userChannel) {\n    case WHATSAPP_CHANNEL:\n      return {\n        open: \"_\",\n        close: \"_\",\n      };\n    case BLIPCHAT_CHANNEL:\n    case GOOGLE_CHANNEL:\n      return {\n        open: \"<i>\",\n        close: \"</i>\",\n      };\n    case FACEBOOK_CHANNEL:\n    case INSTAGRAM_CHANNEL:\n      return {\n        open: \"\",\n        close: \"\",\n      };\n  }\n\n  return {\n    open: \"\",\n    close: \"\",\n  };\n}","inputVariables":["userChannel"],"outputVariable":"italic","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b5a3b0c-9a60-4e21-acb4-c9e3162cffbe","$typeOfContent":"","type":"ExecuteScript","$title":"platform","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  // const contactDomain = contactIdentity.split(\"@\")[1];\n\n  // switch (contactDomain) {\n  //   case \"wa.gw.msging.net\":\n  //   case \"tunnel.msging.net\":\n  //     return \"Whatsapp\";\n  //   case \"telegram.gw.msging.net\":\n  //     return \"Telegram\";\n  //   case \"messenger.gw.msging.net\":\n  //     return \"Messenger\";\n  //   case \"instagram.gw.msging.net\":\n  //     return \"Instagram\";\n  //   case \"0mn.io\":\n  //     return \"Blipchat\";\n  //   case \"mailgun.gw.msging.net\":\n  //     return \"email\";\n  //   case \"businessmessages.gw.msging.net\":\n  //     return \"gbm\";\n  // }\n\n  return \"Whatsapp\";\n}","inputVariables":["contact.identity"],"outputVariable":"platform","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3de4c1e-9544-4918-a0fe-97688e173d7c","$typeOfContent":"","type":"ExecuteScript","$title":"phoneNumber","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  const phoneNumber = contactIdentity.split(\"@\")[0];\n  const onlyNumbers = phoneNumber.replace(/\\D/g, \"\");\n  if (onlyNumbers.length < 12) return \"cannot get\";\n\n  const DDI = onlyNumbers.substring(0, 2);\n  const DDD = onlyNumbers.substring(2, 4);\n  const phone = onlyNumbers.substring(4);\n\n  return JSON.stringify({\n    DDI,\n    DDD,\n    phone,\n  });\n}","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e20a44e4-8639-4bb9-9ecd-cb49ddef1150","$typeOfContent":"","type":"MergeContact","$title":"contact.phoneNumber","$invalid":false,"settings":{"extras":{},"phoneNumber":"{{phoneNumber@DDI}}{{phoneNumber@DDD}}{{phoneNumber@phone}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"phoneNumber"}]},{"$id":"9335d785-07f6-44aa-8ff6-9a66f014e9cd","$typeOfContent":"","type":"ExecuteScript","$title":"metadata","$invalid":false,"settings":{"function":"run","source":"function run(inputMessage) {\n  const inputMessageFormatted = JSON.parse(inputMessage);\n  const metadata = inputMessageFormatted.metadata;\n\n  if (metadata && metadata[\"#wa.referral.headline\"]) {\n    return JSON.stringify({\n      headline: metadata[\"#wa.referral.headline\"],\n      body: metadata[\"#wa.referral.body\"],\n      source_type: metadata[\"#wa.referral.source_type\"],\n      source_id: metadata[\"#wa.referral.source_id\"],\n      source_url: metadata[\"#wa.referral.source_url\"],\n      media_id: metadata[\"#wa.referral.image.id\"],\n    });\n  }\n\n  return JSON.stringify(inputMessageFormatted);\n}","inputVariables":["input.message"],"outputVariable":"metadata","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"input.message"}]},{"$id":"f11014e4-8f03-4991-90b2-e339ff1aa09d","$typeOfContent":"","type":"SetVariable","$title":"empty userInput","$invalid":false,"settings":{"variable":"userInput"},"conditions":[]},{"$id":"d1a0a4f6-d0b7-4b5d-b7a4-7df60fe147af","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"3df757f2-32c4-4c3c-a370-2bfb60b1a241","$typeOfContent":"","type":"ExecuteScript","$title":"MOCK phoneNumber FOR DEVELOPERS NUMBERS","$invalid":false,"settings":{"function":"run","source":"function run(contactIdentity) {\n  return JSON.stringify({\n    \"DDI\": \"55\",\n    \"DDD\": \"11\",\n    \"phone\": \"997565504\"\n  });\n}\n //SCRIPT SÓ RODA QUANDO O CONTACT.IDENTITY CONTEM O NUMERO DE UM DOS DESENVOLVEDORES\n //TELEFONE DO LUCAS: 973806326\n //TELEFONE DA KELLY:  986025835\n //TELEFONE MARIA GABRIELA: 997565504\n //MASSA COM COMPROVANTES: 974078114\n //DANIEL: 976694871","inputVariables":["contact.identity"],"outputVariable":"phoneNumber","LocalTimeZoneEnabled":false},"conditions":[{"values":["5531975705747","5511971704940"],"source":"context","comparison":"contains","variable":"contact.identity"}]}],"$leavingCustomActions":[{"$id":"ac978481-72d5-44b6-acc5-5fb9ef9e488d","$typeOfContent":"","type":"SetVariable","$title":"bo","$invalid":false,"settings":{"variable":"bo","value":"{{bold@open}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bold"}]},{"$id":"89b05175-e6cd-43b6-8c13-6c8d3d309e4b","$typeOfContent":"","type":"SetVariable","$title":"bc","$invalid":false,"settings":{"variable":"bc","value":"{{bold@close}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"bold"}]},{"$id":"1d40e2b8-77e6-4880-91d0-93ca640f84cd","$typeOfContent":"","type":"SetVariable","$title":"io","$invalid":false,"settings":{"variable":"io","value":"{{italic@open}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"italic"}]},{"$id":"1efde720-8139-463f-9a67-a7feb93860aa","$typeOfContent":"","type":"SetVariable","$title":"ic","$invalid":false,"settings":{"variable":"ic","value":"{{italic@close}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"italic"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0d49a626-f3b4-4509-aae9-c5286b7b5b8f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-19346663-fbd2-4d7d-9b54-052d9c25575a","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-3e1d7525-0b8c-4640-975e-b0fc7b4595c3","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"8c695219-8026-443c-a4f1-68132d1b4803","root":false,"$title":"[REQUIREMENTS]","$position":{"top":"118px","left":"645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0cf9f29a-0472-46df-ae36-20e3f79508e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"10c26107-6c39-44b5-a9b5-af21214d8d4d","typeOfStateId":"state","$connId":"con_78","$id":"087a9992-01a5-4a3f-92f3-f1579763dfcd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"815bfea0-f1dd-46f3-b45b-a731de22dde7","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@accountListsURL}}"},"conditions":[]},{"$id":"cd429517-43d6-4ce6-a85a-46287b79862f","$typeOfContent":"","type":"ExecuteScript","$title":"params","$invalid":false,"settings":{"function":"run","source":"function run(documentBase, cpf) {\n  let base = documentBase;\n  if (!documentBase) base = cpf.slice(0, -2);\n\n  return JSON.stringify({\n    baseDocumento: base,\n    tipoPessoa: \"PF\",\n  });\n}","inputVariables":["documentBase","cpf"],"outputVariable":"params","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"query","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n  params = JSON.parse(params);\n  let query = \"\";\n\n  Object.entries(params).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    query += `${key}=${encodedValue}`;\n    if (!isLastIteration) query += \"&\";\n  });\n\n  return `?${query}`;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text\n    .split(\"\")\n    .map((char) => escapeCodes[char] || char)\n    .join(\"\");\n}","inputVariables":["params"],"outputVariable":"query","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"LISTA QUANTIDADE DE CONTAS","$invalid":false,"settings":{"headers":{"Safra-Bot-ID":"{{safraBotId}}","User-Agent":"Fiddler","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{url}}{{query}}","responseStatusVariable":"statusAccountLists","responseBodyVariable":"responseAccountLists"},"conditions":[]},{"$id":"0d4c790d-315d-4b56-adcc-c8ba5c70f750","$typeOfContent":"","type":"ExecuteScript","$title":"customerAccounts","$invalid":false,"settings":{"function":"run","source":"function run(responseAccountLists) {\n  responseAccountLists = JSON.parse(responseAccountLists);\n  return JSON.stringify({\n    accounts: responseAccountLists.data,\n  });\n}","inputVariables":["responseAccountLists"],"outputVariable":"customerAccounts","LocalTimeZoneEnabled":false},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusAccountLists"}]},{"$id":"33f1197e-1a77-40d5-831b-b56281517358","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusAccountLists}} | {{responseAccountLists}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"10c26107-6c39-44b5-a9b5-af21214d8d4d","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-301c6cc5-1598-40df-9726-1a3370fa5825","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-50c000d8-287b-4e4d-9fe7-a91e9c65c34f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-74d62abe-5024-4c78-907f-39b33d033421","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9e7e29fa-15c2-4c81-9cae-2c1eb1a88311","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0cf9f29a-0472-46df-ae36-20e3f79508e9","root":false,"$title":"[API] LISTA QUANTIDADE DE CONTAS","$position":{"top":"1821.11px","left":"472.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7"}},"10c26107-6c39-44b5-a9b5-af21214d8d4d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72c4be29-d90a-430d-afc8-207359c9cb81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e91577bf-4ecd-48fa-8812-4c4e61629844","typeOfStateId":"state","$connId":"con_83","$id":"09497a59-7458-44e0-8340-131003b789fa","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveAnyAccount"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c88e3926-4b1f-4ee6-84b6-297d5668ff4d","$typeOfContent":"","type":"ExecuteScript","$title":"haveAnyAccount","$invalid":false,"settings":{"function":"run","source":"function run(statusAccountLists, customerAccounts) {\n  const httpStatusOkRegExp = /^2[0-9]{2}$/;\n  if (!httpStatusOkRegExp.test(statusAccountLists)) return false;\n\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.data;\n\n  return accounts.length ? true : false;\n}","inputVariables":["statusAccountLists","responseAccountLists"],"outputVariable":"haveAnyAccount","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5c5654e8-a9ee-4a1e-a141-b9842a6a099e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"10c26107-6c39-44b5-a9b5-af21214d8d4d","root":false,"$title":"[LO] Possui conta?","$position":{"top":"1982.33px","left":"471.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7f67c95-a085-461a-8ce6-4165162dd1f3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","typeOfStateId":"state","$connId":"con_88","$id":"1adf25db-e068-4174-ba57-c671704395e4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8d8ee891-ba5a-464b-b091-8dc80b2fd474","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{envSettings@tokenURL}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"bbc6c427-f3b9-4e05-af44-26702beb6928","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9a77952-71d6-4c4d-8326-c756ed596950","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4f029412-03f6-44ad-b347-2d5d211255fd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9bc43d7a-5b6c-4e8d-8cd9-78aaa3b7a600","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f0497c7e-4a34-4328-ad10-2f13539d45d2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"f7f67c95-a085-461a-8ce6-4165162dd1f3","root":false,"$title":"[API] TOKEN","$position":{"top":"1703px","left":"471.778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","commentsIdList":[]}},"e91577bf-4ecd-48fa-8812-4c4e61629844":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c300c442-1478-4053-a9d7-187127182ed0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","typeOfStateId":"state","$connId":"con_93","$id":"8dc06ce1-8e2e-49a7-99e4-df60ac69c379","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e91577bf-4ecd-48fa-8812-4c4e61629844","root":false,"$title":"[LO] Sim","$position":{"top":"2105px","left":"471px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0a31548-ebcb-457e-b9c2-1e31eedffb91","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","typeOfStateId":"state","$connId":"con_98","$id":"de585554-613d-4b35-9fc1-5a00107c5353","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea","root":false,"$title":"[LO] Não","$position":{"top":"2304.29px","left":"675.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0db8c9b1-f826-4ee2-a7cd-877dc177d168":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"72c4be29-d90a-430d-afc8-207359c9cb81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"003aacd8-b430-48a3-bdb5-086e06563962","typeOfStateId":"state","$connId":"con_103","$id":"81769a02-af8e-42c3-a9e3-cad5c2865780","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveManyAccounts"},{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}],"$invalid":false},{"stateId":"69e850bd-0b58-416d-b7c4-ccbcb5bbd5ea","typeOfStateId":"state","$connId":"con_108","$id":"ded8fb00-ecc6-4caf-a79f-aff0fc2cdd4d","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"haveManyAccounts"}],"$invalid":false},{"stateId":"c7fc7784-b1cd-42e6-8ffd-21c98867bb74","typeOfStateId":"state","$connId":"con_113","$id":"b1a329c7-afcf-4a50-9ec0-2f785f32b1b4","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"haveManyAccounts"},{"values":["true"],"source":"context","comparison":"equals","variable":"isAccountInCache"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c88e3926-4b1f-4ee6-84b6-297d5668ff4d","$typeOfContent":"","type":"ExecuteScript","$title":"haveManyAccounts","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n\n  return accounts.length > 1 ? true : false;\n}","inputVariables":["customerAccounts"],"outputVariable":"haveManyAccounts","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8662626-26ec-45fd-86a1-0dacc170f661","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (agencia = false, conta = false) => {\n\ttry {\n\t\tif (conta && agencia) {\n\t\t\treturn true\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contact.extras.conta","contact.extras.agencia"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"haveManyAccounts"}]},{"$id":"d310d719-7838-45cc-951d-9fada7c086fe","$typeOfContent":"","type":"SetVariable","$title":"CLEAR intencaoIdentificada IF intent is alterar conta","$invalid":false,"settings":{"variable":"intencaoIdentificada"},"conditions":[{"values":["alterar conta"],"source":"context","comparison":"equals","variable":"intencaoIdentificada@intent"}]},{"$id":"c52a7af5-315d-41db-8d64-0a230806a680","$typeOfContent":"","type":"SetVariable","$title":"clienteJaSaudado","$invalid":false,"settings":{"variable":"clienteJaSaudado","value":"Sim"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a73280fa-21a5-4d06-a33a-d5157cc160b7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b9006ad2-d4f7-46de-b6a3-c7e8e088d0d8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"0db8c9b1-f826-4ee2-a7cd-877dc177d168","root":false,"$title":"[LO] Possui mais de uma conta?","$position":{"top":"2197px","left":"470px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"003aacd8-b430-48a3-bdb5-086e06563962":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c300c442-1478-4053-a9d7-187127182ed0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"37df718d-571b-48d2-9714-a47329aa9326","typeOfStateId":"state","$connId":"con_118","$id":"bb0cfdd2-d138-47dd-9949-a3927b6861fb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"37df718d-571b-48d2-9714-a47329aa9326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"003aacd8-b430-48a3-bdb5-086e06563962","root":false,"$title":"[LO] Sim","$position":{"top":"2288.25px","left":"275px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"37df718d-571b-48d2-9714-a47329aa9326":{"$contentActions":[{"action":{"$id":"0fa91206-ef77-451f-ae7b-c56698f2e7dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"85afe670-761a-477a-bb50-eb5f11a1ff18","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"85afe670-761a-477a-bb50-eb5f11a1ff18","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e6637913-93db-4c07-a987-c826ff2c9c3e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9defc467-85f2-44a3-8568-e6b86ae67815","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae","typeOfStateId":"state","$connId":"con_123","$id":"6344b6d6-c7ea-4652-bc6b-af68d35875db","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"processedInput@input"}],"$invalid":false},{"stateId":"1d2549f7-5406-4598-b022-9bf845a798db","typeOfStateId":"state","$connId":"con_128","$id":"6da8b9eb-64f3-48a5-a699-72c973375f78","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"processedInput@isValid"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c53b1b07-4d91-4560-a8ea-98e09ac8fdff","$typeOfContent":"","type":"TrackEvent","$title":"Exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta exibicao conta exibicaoia","action":"Exibicao"},"conditions":[]},{"$id":"2efc1bb6-60d6-4f0f-abf5-014323c6f466","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, customerAccounts) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n\n    customerAccounts = JSON.parse(customerAccounts);\n\n    const accounts = customerAccounts.accounts;\n    const text = `Escolha qual a conta você quer\nseguir com o atendimento.`;\n    let isButton = false;\n    let isList = true;\n    const description = [];\n    const options = [];\n    accounts.forEach((account, index) => {\n        options.push(`Conta: ${account.numeroConta}`);\n    });\n   accounts.forEach((account, index) => {\n        description.push(`AG: ${account.numeroAgencia}`);\n    });\n\n    options.push(\"Encerrar atendimento\");\n\n    if(options.length>10){\n        platform = \"blipchat\";\n    }\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher conta',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n  return words.join(\" \");\n}","inputVariables":["bold","platform","customerAccounts"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"acff923d-9176-4d25-b9bd-dd0e113f68e6","$typeOfContent":"","type":"SetVariable","$title":"typeError","$invalid":false,"settings":{"variable":"typeError","value":"menuDinamico"},"conditions":[]}],"$leavingCustomActions":[{"$id":"79af0c70-9064-4eaa-a266-8f272349299f","$typeOfContent":"","type":"ExecuteScript","$title":"processedInput","$invalid":false,"settings":{"function":"run","source":"function run(input, inputType, customerAccounts) {\n  const error = JSON.stringify({\n    status: \"input inválido\",\n    input: input ? input : \"usuário inativo\",\n    isValid: false,\n    type: \"menuDinamico\",\n  });\n\n  if (inputType !== \"text/plain\") return error;\n\n  customerAccounts = JSON.parse(customerAccounts);\n  input = input.trim();\n\n  // A opção e o número da opção são incluidos automaticamente na regexp\n  const menuOptions = {\n    \"Encerrar atendimento\": [\"encerrar\", \"sair\"],\n  };\n  const options = [\"Encerrar atendimento\"];\n  const accounts = customerAccounts.accounts;\n  const charLimit = 24;\n\n  accounts.forEach((account) => {\n    const textOption = `Conta: ${account.numeroConta}`;\n\n    if (textOption.length < charLimit) {\n      menuOptions[account.numeroConta] = [textOption];\n    } else {\n      menuOptions[account.numeroConta] = [];\n    }\n\n    options.push(account.numeroConta);\n  });\n\n  const matches = options.find((option, index) => {\n    let regexp = `^${option}$|`;\n    menuOptions[option].forEach((validationString) => {\n      validationString = validationString.replace(/^\\^|\\$$/g, \"\");\n      regexp += `^${validationString}$|`;\n    });\n    regexp += `^${index}$`;\n\n    return input.match(new RegExp(regexp, \"gim\"));\n  });\n\n  return matches\n    ? JSON.stringify({\n        status: \"input válido\",\n        input: matches,\n        isValid: true,\n        type: \"menuDinamico\",\n      })\n    : error;\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["input.content","input.type","customerAccounts"],"outputVariable":"processedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"11511b15-bdce-4aa5-a99b-523b1f98a4d6","$typeOfContent":"","type":"ExecuteScript","$title":"agency","$invalid":false,"settings":{"function":"run","source":"function run(processedInput, customerAccounts) {\n  processedInput = JSON.parse(processedInput);\n  customerAccounts = JSON.parse(customerAccounts);\n\n  const accounts = customerAccounts.accounts;\n  const selectedAccound = processedInput.input;\n  const accountFound = accounts.find(\n    (account) => account.numeroConta === selectedAccound\n  );\n\n  return accountFound ? accountFound.numeroAgencia : \"not found\";\n}","inputVariables":["processedInput","customerAccounts"],"outputVariable":"agency","LocalTimeZoneEnabled":false},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"},{"values":["Encerrar atendimento"],"source":"context","comparison":"notEquals","variable":"processedInput@input"}]},{"$id":"857b547e-87b1-4a39-a012-96dd49fc26d3","$typeOfContent":"","type":"SetVariable","$title":"account","$invalid":false,"settings":{"variable":"account","value":"{{processedInput@input}}"},"conditions":[{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"},{"values":["Encerrar atendimento"],"source":"context","comparison":"notEquals","variable":"processedInput@input"}]},{"$id":"0644ed59-b204-4e28-a1c1-91133c3c33d1","$typeOfContent":"","type":"TrackEvent","$title":"Selecao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta selecao","action":"{{processedInput@input}} | {{processedInput@status}}"},"conditions":[{"values":[],"source":"input","variable":"processedInput","comparison":"exists"},{"values":["true"],"source":"context","comparison":"equals","variable":"processedInput@isValid"}]},{"$id":"4f354dac-e0d9-4a62-9752-915bade6ef24","$typeOfContent":"","type":"TrackEvent","$title":"Inesperado","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"selecionar conta inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["false"],"source":"context","comparison":"equals","variable":"processedInput@isValid"}]},{"$id":"1f9c424a-92c9-4be8-8d38-edb8dd299b65","$typeOfContent":"","type":"SetVariable","$title":"maisDeUmaConta","$invalid":false,"settings":{"variable":"maisDeUmaConta","value":"true"},"conditions":[]},{"$id":"2b24506d-1dba-4d6d-8737-7a3d65f893d0","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"agencia":"{{agency}}","conta":"{{account}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-97e56621-1cd3-4e7d-badc-88da2233368e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-674da1c2-d9f6-43f9-a957-52b9563f3960","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-245e5e6c-626d-4a03-8192-c377c57b8574","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-54d96193-8565-4592-bad2-487a0783394d","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-990cb9ac-5d24-4556-b05d-9a28c9043589","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-a8babb31-8a9b-4e20-91fd-a63cad50bdff","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"37df718d-571b-48d2-9714-a47329aa9326","root":false,"$title":"[S.0.0.4][MENU] Conta","$position":{"top":"2453px","left":"274.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90b0263c-c584-4e22-bc60-3b6dbad63034","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d9359361-57c8-4d39-a392-69b769f419d6","typeOfStateId":"state","$connId":"con_133","$id":"c40ec843-2bc1-4f3f-84b4-dc5f01399803","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47fb19ae-97b8-45a5-a9a9-55f1a3b05733","$typeOfContent":"","type":"SetVariable","$title":"url","$invalid":false,"settings":{"variable":"url","value":"{{envSettings@tokenURL}}"},"conditions":[]},{"$id":"684f9fa6-bea1-4daf-bc93-fed5d3234f14","$typeOfContent":"","type":"ExecuteScript","$title":"body","$invalid":false,"settings":{"function":"run","source":"function run(clientSecret) {\n  return JSON.stringify({\n    client_id: \"BLIP\",\n    grant_type: \"client_credentials\",\n    client_secret: clientSecret,\n  });\n}","inputVariables":["clientSecret"],"outputVariable":"body","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d6bf45c-855e-4b68-a4d0-35e5e7cd1267","$typeOfContent":"","type":"ExecuteScript","$title":"encodedBody","$invalid":false,"settings":{"function":"run","source":"function run(body) {\n  body = JSON.parse(body);\n  let URLEncoded = \"\";\n\n  Object.entries(body).forEach((pair, index, array) => {\n    const key = pair[0];\n    const value = pair[1];\n    const lastIndex = array.length - 1;\n    const isLastIteration = index === lastIndex;\n    const encodedValue = replaceChars(value);\n\n    URLEncoded += `${key}=${encodedValue}`;\n    if (!isLastIteration) URLEncoded += \"&\";\n  });\n\n  return URLEncoded;\n}\n\nfunction replaceChars(text) {\n  const escapeCodes = {\n    \" \": \"%20\",\n    \"!\": \"%21\",\n    '\"': \"%22\",\n    \"#\": \"%23\",\n    \"$\": \"%24\",\n    \"%\": \"%25\",\n    \"&\": \"%26\",\n    \"'\": \"%27\",\n    \"(\": \"%28\",\n    \")\": \"%29\",\n    \"*\": \"%2A\",\n    \"+\": \"%2B\",\n    \",\": \"%2C\",\n    \"-\": \"%2D\",\n    \".\": \"%2E\",\n    \"/\": \"%2F\",\n    \":\": \"%3A\",\n    \";\": \"%3B\",\n    \"<\": \"%3C\",\n    \"=\": \"%3D\",\n    \">\": \"%3E\",\n    \"?\": \"%3F\",\n    \"@\": \"%40\",\n    \"[\": \"%5B\",\n    \"\\\\\": \"%5C\",\n    \"]\": \"%5D\",\n    \"^\": \"%5E\",\n    \"_\": \"%5F\",\n    \"`\": \"%60\",\n    \"{\": \"%7B\",\n    \"|\": \"%7C\",\n    \"}\": \"%7D\",\n    \"~\": \"%7E\",\n  };\n\n  return text.split('').map(char => escapeCodes[char] || char).join('');\n}\n","inputVariables":["body"],"outputVariable":"encodedBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32b98f83-07e7-471d-aa90-7b0f12b023dd","$typeOfContent":"","type":"ProcessHttp","$title":"TOKEN","$invalid":false,"settings":{"headers":{"User-Agent":"Fiddler","Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"{{encodedBody}}","uri":"{{envSettings@tokenURL}}","responseStatusVariable":"statusToken","responseBodyVariable":"responseToken"},"conditions":[]},{"$id":"b5c1c95e-cdef-4b18-9001-a1f071d0b811","$typeOfContent":"","type":"SetVariable","$title":"token","$invalid":false,"settings":{"variable":"token","value":"{{responseToken@access_token}}"},"conditions":[{"values":["^2[0-9]{2}$"],"source":"context","comparison":"matches","variable":"statusToken"}]},{"$id":"566db329-3250-4b47-95c8-8ab581164fe8","$typeOfContent":"","type":"TrackEvent","$title":"api","$invalid":false,"settings":{"extras":{},"category":"api","action":"{{moment@date}} | {{moment@time}} | {{url}} | {{body}} | {{statusToken}} | {{responseToken}} | {{contact.identity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"0cf9f29a-0472-46df-ae36-20e3f79508e9","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5612ccf7-ffaf-4c45-b529-5e80e85c6021","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a484193d-c9fc-40e4-ac51-7d944ad988de","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b1db9d03-d1c7-4828-a12f-87ffcaf49633","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-4369ac72-5f02-4072-bbcf-ac3c22220e96","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","root":false,"$title":"[API] TOKEN","$position":{"top":"2564.57px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#673ab7","commentsIdList":[]}},"1d2549f7-5406-4598-b022-9bf845a798db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cf8d0062-29c3-482a-92e3-955fef4240e9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1d2549f7-5406-4598-b022-9bf845a798db","root":false,"$title":"[GO TO] Identificação dados cliente","$position":{"top":"2666.75px","left":"384.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5f7ad7cf-be36-4a51-8011-147230ec120a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","typeOfStateId":"state","$connId":"con_138","$id":"204b8e6c-10f7-437c-a97e-0cf4a716a503","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8cbc2047-3951-48c5-a1ee-ea9832f3d3c1","$typeOfContent":"","type":"ExecuteScript","$title":"agency","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].numeroAgencia;\n}","inputVariables":["customerAccounts"],"outputVariable":"agency","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8cd07d53-d3cb-4d50-aa0c-9732952df248","$typeOfContent":"","type":"ExecuteScript","$title":"account","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].numeroConta;\n}\n","inputVariables":["customerAccounts"],"outputVariable":"account","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"faf56847-8a41-466e-a185-650f2dfc6f07","$typeOfContent":"","type":"ExecuteScript","$title":"codCliente","$invalid":false,"settings":{"function":"run","source":"function run(customerAccounts) {\n  customerAccounts = JSON.parse(customerAccounts);\n  const accounts = customerAccounts.accounts;\n  return accounts[0].codigoCliente;\n}\n","inputVariables":["customerAccounts"],"outputVariable":"codCliente","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9d4a3dc5-2859-46d4-8fe5-161f5ee85edc","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7f7a2417-c33a-419c-92d1-3f7b26b4ed4f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"20ac7bc8-bf10-4c8a-82eb-a87cf114aaac","root":false,"$title":"[LO] Agencia/Conta","$position":{"top":"2414px","left":"675.571px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b86a601-9a6a-4460-9dee-a4fbe9026a3f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7731b29d-79e9-408d-868f-e704945aac88","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","typeOfStateId":"state","$connId":"con_143","$id":"8f5902c7-74fb-49c9-aae9-1bb487d7b61d","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"shouldIgnoreManager"}],"$invalid":false},{"stateId":"b34040c5-af17-45f9-b86b-80c66c404a50","typeOfStateId":"state","$connId":"con_148","$id":"c9227554-6f6b-433a-9868-25e15aaacdbc","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"shouldIgnoreManager"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"41e52afb-7158-41a2-8167-e96252b8b449","$typeOfContent":"","type":"ExecuteScript","$title":"ignoredManagersList","$invalid":false,"settings":{"function":"run","source":"function run() {\n  return JSON.stringify([\n    {\n      name: \"Larrissa Marques\",\n      phoneNumber: \"11913529137\",\n    },\n    {\n      nome: \"Ana Paula A Gregório\",\n      phoneNumber: \"11970818618\",\n    },\n    {\n      nome: \"Erica Fernanda Ribeiro Silva\",\n      phoneNumber: \"11976900666\",\n    },\n    {\n      nome: \"Maria Gabriela F P de Oliveira\",\n      phoneNumber: \"11965982891\",\n    },\n    {\n      nome: \"Ana Paula Vicente S de Souza\",\n      phoneNumber: \"21973875675\",\n    },\n  ]);\n}\n","inputVariables":[],"outputVariable":"ignoredManagersList","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f6c27603-d33b-4ada-8a89-7bd7c66a3598","$typeOfContent":"","type":"ExecuteScript","$title":"shouldIgnoreManager","$invalid":false,"settings":{"function":"run","source":"function run(ignoredManagersList, packsConfig) {\n  ignoredManagersList = JSON.parse(ignoredManagersList);\n  packsConfig = JSON.parse(packsConfig);\n\n  const routerPhone = packsConfig[\"PhoneNumber\"];\n  const managerFound = ignoredManagersList.find(\n    (manager) => manager.phoneNumber === routerPhone\n  );\n\n  return Boolean(managerFound);\n}","inputVariables":["ignoredManagersList","resource.packs.configuration"],"outputVariable":"shouldIgnoreManager","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"ignoredManagersList"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9e03bfed-7180-483f-b624-275e4acb4752","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7b86a601-9a6a-4460-9dee-a4fbe9026a3f","root":false,"$title":"[LO] Ignorar gerente?","$position":{"top":"256px","left":"646px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94ba7949-9cc9-457e-a542-2f3a8d76ee33":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e06cb4b8-6e15-429c-9968-2e276c9a053a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"267px","left":"441px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eec29ed0-812d-42fa-afd3-58e0dc4a5326":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a9b1a875-3cef-422b-9657-4ff83624d57b","$typeOfContent":"","type":"SetVariable","$title":"CLEAR intencaoIdentificada","$invalid":false,"settings":{"variable":"intencaoIdentificada"},"conditions":[]},{"$id":"e540f160-e433-4017-b5e4-c4f34ea10973","$typeOfContent":"","type":"SetVariable","$title":"clienteJaSaudado","$invalid":false,"settings":{"variable":"clienteJaSaudado","value":"Não"},"conditions":[]},{"$id":"d7632d3b-4d1d-42d2-9324-6cc94ff840db","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"6cfcebf8-195e-4f33-9b59-7a1ac6adf108","$typeOfContent":"","type":"SetVariable","$title":"empty isAccountInCache","$invalid":false,"settings":{"variable":"isAccountInCache","value":"false"},"conditions":[]},{"$id":"24b8b67c-d2db-4b9e-ad88-93429a9cad0f","$typeOfContent":"","type":"SetVariable","$title":"empty responseTelIdent","$invalid":false,"settings":{"variable":"responseTelIdent"},"conditions":[]},{"$id":"d79fe647-efd3-4b84-a87d-c744e57754f3","$typeOfContent":"","type":"SetVariable","$title":"CLEAR responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"27a61707-69c2-4bf5-8e0d-23c5113b3d5e","$typeOfContent":"","type":"ExecuteScript","$title":"skpRedirectContent","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, inputType, serviceName, parentServiceName) {\n  return {\n        \"origin\": \"PreEnd\",\n        \"flow\": \"finalizacao\",\n        \"input\": {\n            \"content\": inputContent,\n            \"type\": inputType\n        } \n    };\n};","inputVariables":["input.content","input.type","config.serviceName","config.parentServiceName"],"outputVariable":"skpRedirectContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9e2830e3-5e5c-46a2-8307-27c5bfa29347","$typeOfContent":"","type":"Redirect","$title":"Redirect \"skpParentServiceName\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{skpRedirectContent}}"},"address":"{{config.parentServiceName}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-02166157-c9c1-45e0-b338-30916b00e4dc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fe38ee33-d31e-40cd-bfb0-4511c0496f80","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1b45a18b-3aa1-4170-a906-4fa105c7b825","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","root":false,"$title":"[Redirect] Employee Finalização","$position":{"top":"227px","left":"1276px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e65ae042-2867-4005-9f6f-c24781ded992":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"27a61707-69c2-4bf5-8e0d-23c5113b3d5e","$typeOfContent":"","type":"ExecuteScript","$title":"skpRedirectContent","$invalid":false,"settings":{"function":"run","source":"function run(inputContent, inputType, serviceName, parentServiceName) {\n  return {\n        \"origin\": serviceName,\n        \"flow\": parentServiceName,\n        \"input\": {\n            \"content\": inputContent,\n            \"type\": inputType\n        } \n    };\n};","inputVariables":["input.content","input.type","config.serviceName","config.parentServiceName"],"outputVariable":"skpRedirectContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9e2830e3-5e5c-46a2-8307-27c5bfa29347","$typeOfContent":"","type":"Redirect","$title":"Redirect \"skpParentServiceName\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{skpRedirectContent}}"},"address":"{{config.parentServiceName}}"},"conditions":[]},{"$id":"3e857d5a-7821-4c4c-8e95-0e6b88b9a035","$typeOfContent":"","type":"SetVariable","$title":"clienteJaSaudado","$invalid":false,"settings":{"variable":"clienteJaSaudado","value":"Não"},"conditions":[]},{"$id":"83b2986e-6afb-4bd0-a59e-ba8d8283698a","$typeOfContent":"","type":"SetVariable","$title":"empty responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]},{"$id":"0609853b-4599-4f55-a803-29e4d9130334","$typeOfContent":"","type":"SetVariable","$title":"empty isAccountInCache","$invalid":false,"settings":{"variable":"isAccountInCache"},"conditions":[]},{"$id":"e38542c4-439b-40b5-95ec-ae4846beda1d","$typeOfContent":"","type":"SetVariable","$title":"empty responseTelIdent","$invalid":false,"settings":{"variable":"responseTelIdent"},"conditions":[]},{"$id":"62052518-5176-40fd-91bf-46cc80e91c7a","$typeOfContent":"","type":"ExecuteScript","$title":"isAccountInCache","$invalid":false,"settings":{"function":"run","source":"const run = (intent) => {\n\ttry {\n\t\treturn false;\n\t}\n\tcatch(e){\n\t\treturn false;\n\t}\n}","inputVariables":["intencaoIdentificada"],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0dd5d6ac-7a49-4964-abe6-b35b9e35cf89","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f6bacaa5-45f2-48ba-ae65-8917dbe359c5","label":"Redirect","background":"#1EA1FF","canChangeBackground":false},{"id":"blip-tag-9037d207-88bc-44a2-b59e-a69f24887c4e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"e65ae042-2867-4005-9f6f-c24781ded992","root":false,"$title":"[Redirect] Employee Transbordo","$position":{"top":"60px","left":"1277px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0de8ccf2-e51f-47a2-81ac-b4d3ebcb2dcf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3e66c9d2-3520-4a01-806c-c8e2f5bc50ae","root":false,"$title":"[GO TO] Employee Finalização","$position":{"top":"2664.5px","left":"166.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4f2f8bca-5b12-450f-ab5a-cdfa022d2359":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"74f92265-ef2b-4c15-ab2e-f764d8b5320a","typeOfStateId":"state","$connId":"con_153","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","typeOfStateId":"state","$connId":"con_158","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"b7adc970-3748-4b05-b3cf-c62fbf818ad0","typeOfStateId":"state","$connId":"con_163","$id":"919866b3-ce6d-4004-8857-cd7817271d2a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run () {\n    return 'client_id=BLIP&grant_type=client_credentials&client_secret=5312b6d5-acb8-4165-9458-ef445876473e';\n}","inputVariables":[],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"https://sts-api.safra.com.br/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"https://api.safra.com.br/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{dadosCliente@documento}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\tconst cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoesAtivo\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn 0\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5a8a18cc-8c3b-4de6-9557-1f3e677b7aa4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b9795dbb-0b2d-4d30-83a6-240c98bc06d5","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","root":false,"$title":"[S.1.0.0] possui cartao?","$position":{"top":"1007px","left":"2273.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a7b4b5e0-118a-4a24-abe7-921da96f44bf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a81c2652-6c5c-4be0-899c-06b296aa5703","typeOfStateId":"state","$connId":"con_168","$id":"093a2a6a-e179-4910-b8b9-9bd05b76f497","conditions":[{"source":"context","comparison":"equals","values":["422"],"variable":"statusSenha"}],"$invalid":false},{"stateId":"22a29581-50cc-4866-b9c7-25f8b0d7e6b4","typeOfStateId":"state","$connId":"con_173","$id":"aea53c73-dca2-48d0-b913-5c6c249af32d","conditions":[{"source":"context","comparison":"equals","values":["senha transacional"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"ca9d3934-31b7-4812-b8d8-213d1cd6fecd","typeOfStateId":"state","$connId":"con_178","$id":"27d20aa2-d394-41fa-884c-cc329b14c857","conditions":[{"source":"context","comparison":"equals","values":["senha do cartao"],"variable":"intencaoIdentificada@intent"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"79abb350-68d3-43d9-b4b0-59bbc5517197","$typeOfContent":"","type":"ProcessHttp","$title":"responseSenha","$invalid":false,"settings":{"headers":{"amc-aplicacao":"IBJ","Content-Type":"application/json","Authorization":"Bearer {{token}}"},"method":"POST","body":"{\n  \"documento\": \"{{dadosCliente@documento}}\",\n  \"numeroCartao\": \"{{finalCartao}}\"\n}","uri":"https://api.safra.com.br/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/senhas/reemitir","responseStatusVariable":"statusSenha","responseBodyVariable":"responseSenha"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a5842ae7-d2cd-4683-8dc4-c486ddb51dc3","$typeOfContent":"","type":"MergeContact","$title":"set erro api","$invalid":false,"settings":{"extras":{"erro":"{{bodySenha}}"}},"conditions":[{"values":["204"],"source":"context","comparison":"notEquals","variable":"statusSenha"}]},{"$id":"e9351d9a-c19b-47df-9443-1547aeabc29f","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document, bodySenha) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha}  | ${bodySenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document","bodySenha"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0b79c298-5844-4aae-b9e5-cc0a612278dc","$typeOfContent":"","type":"TrackEvent","$title":"API senha","$invalid":false,"settings":{"extras":{},"category":"API senha","action":"{{tracking}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1dba44e-4380-480f-99c1-209df7dd80a4","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-31114a24-3240-4c0c-9470-da783661b3df","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-f5e3c221-4865-4e9a-9d6e-2cd02fb4e5ac","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-354f2e4a-d0ca-4572-b8fd-80ad4baf51d2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96","root":false,"$title":"[S.2.0.0] senha","$position":{"top":"1376px","left":"2274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"74f92265-ef2b-4c15-ab2e-f764d8b5320a":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","typeOfStateId":"state","$connId":"con_183","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Vi que você tem mais de um cartão do Safra.\nEscolhe o cartão que precisa da senha ou me manda os 4 últimos números do cartão que eu consulto aqui.`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3ff63297-8230-41de-bd99-c36c6d5dcefb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c8175148-cf35-43ab-9602-8c8c6886f80e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-91dd5e85-e412-43c0-a17a-1217998e23f2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"74f92265-ef2b-4c15-ab2e-f764d8b5320a","root":false,"$title":"[S.1.0.1]+ 1 cartao","$position":{"top":"1117px","left":"2493px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"67b3f9c5-06bd-405e-9a0a-dbab2e5fee96","typeOfStateId":"state","$connId":"con_188","$id":"5561f97b-bfe5-4b0f-b9ac-f4b159fc4eb3","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\t\t\t\n\t\t}\n\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-12897c01-8daf-482c-a096-b7fc063765e6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"1f4f5d03-1a7c-4e33-bfb5-a3985284b3a8","root":false,"$title":"[S.1.0.2]dados cartao","$position":{"top":"1222px","left":"2274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ca9d3934-31b7-4812-b8d8-213d1cd6fecd":{"$contentActions":[{"action":{"$id":"b8d0d200-3e8d-4711-ba17-4cc6de4292dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"09e2d8d0-db23-4f84-995f-58ea428a1e88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"09e2d8d0-db23-4f84-995f-58ea428a1e88","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7c5205c9-8ed6-41af-8a8c-12e39e0d87ce","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ddf27379-63a2-4bc7-a152-55d4a3f6f77b","type":"text/plain","content":"{{mensagem}}","metadata":{}},"$cardContent":{"document":{"id":"ddf27379-63a2-4bc7-a152-55d4a3f6f77b","type":"text/plain","content":"{{mensagem}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"43b855ee-f3b3-402f-884c-7ce60445fe21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a00cbee5-4a86-4f8d-b43c-66d9a5dde93e","$typeOfContent":"","type":"ExecuteScript","$title":"mensagem","$invalid":false,"settings":{"function":"run","source":"const run = (finalCartao, qtdCartoes) => {\n\n\tif(qtdCartoes === 'um')\treturn `Claro, enviei no seu e-mail o PDF com a senha do seu cartão final ${finalCartao}`\n\treturn 'Ótimo, enviei no seu e-mail o PDF com a senha do seu cartão.'\n}","inputVariables":["finalCartao","qtdCartoes"],"outputVariable":"mensagem","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d89a51ae-df92-4b23-8b9c-b09ea8f297ee","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f9b1d6ad-aa77-465a-afca-85c01ebd3846","$typeOfContent":"","type":"TrackEvent","$title":"senha cartao exibicao","$invalid":false,"settings":{"extras":{},"category":"senha cartao exibicao","action":"{{tracking}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b4bbf10c-84f4-43a8-884e-fc9ed0c18f2a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9777e712-c059-41e5-b1e6-281ab584d016","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-95f6a2c3-08f7-4f32-b9c2-2345ec168c1e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ca9d3934-31b7-4812-b8d8-213d1cd6fecd","root":false,"$title":"[S.2.0.2] mensagem senha cartao","$position":{"top":"1447px","left":"2048px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"22a29581-50cc-4866-b9c7-25f8b0d7e6b4":{"$contentActions":[{"action":{"$id":"b083eaf8-e6a2-4b7f-ab59-d4ecde3805a7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"50751650-15b1-43e9-9823-5878673510e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"50751650-15b1-43e9-9823-5878673510e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0ee42534-2af6-4263-ab9f-6ee39887a558","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3f69fa75-2105-479f-bdea-58de2a427d01","type":"text/plain","content":"Claro, enviei um PDF no seu e-mail com sua senha transacional.","metadata":{}},"$cardContent":{"document":{"id":"3f69fa75-2105-479f-bdea-58de2a427d01","type":"text/plain","content":"Claro, enviei um PDF no seu e-mail com sua senha transacional."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b7f03bea-65b7-4a1f-bbac-dd6de383f925","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c4798faf-f2c7-4e99-b78a-f29819f07560","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = (contact, statusSenha, document) => {\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${statusSenha} | ${document}`\n}","inputVariables":["contact.identity","statusSenha","document"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"daa65377-5402-4a4b-82ef-5a665e31c999","$typeOfContent":"","type":"TrackEvent","$title":"senha transacional exibicao","$invalid":false,"settings":{"extras":{},"category":"senha transacional exibicao","action":"{{tracking}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"tracking"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ca785db6-e557-4fdc-aa66-5c6a759b2d58","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-71c821a0-eb3e-4c55-a0dd-01f199531a04","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e59399a5-eb78-4b0d-a30c-4107029e58df","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"22a29581-50cc-4866-b9c7-25f8b0d7e6b4","root":false,"$title":"[S.2.0.1] mensagem senha transacional","$position":{"top":"1480.29px","left":"2501.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"257f1171-0297-4b48-8a1c-89a7959b201f":{"$contentActions":[{"action":{"$id":"5c4cc545-a9dc-42d8-8f97-5053697ab697","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed1b3173-87d9-412b-a602-0f703bee9fb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"{{mensagemOla}}","metadata":{}},"$cardContent":{"document":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"{{mensagemOla}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f38dcdda-ffa8-484d-984b-ed99704f4332","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"f5d1137b-79a1-4a8f-ac78-edd355372dbf","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemOla","$invalid":false,"settings":{"function":"run","source":"const run = (nome, maisDeUmaConta = false, clienteJaSaudado) => {\n\ttry {\n\t\tconst nomePequeno = nome.toLowerCase()\n\t\tnome = nomePequeno.replace(/^./, nomePequeno[0].toUpperCase()) //primeira letra maiuscula\n\t\tconst frases = ['Como posso te ajudar', 'Em que posso te ajudar', 'No que posso te ajudar', 'Como posso ajudar']\n\n\t\tconst index = Math.floor(Math.random() * 10 % 2)\n\t\tconst hora = new Date().getHours()\n\n\t\tlet greeting;\n\t\tif (hora >= 5 && hora < 12) {\n\t\t\tgreeting = 'bom dia'\n\t\t} else if (hora >= 12 && hora < 18) {\n\t\t\tgreeting = \"boa tarde\"\n\t\t} else if (hora >= 18 || hora < 5) {\n\t\t\tgreeting = 'boa noite'\n\t\t}\n\n\t\tif (clienteJaSaudado == \"Sim\") {\n\t\t\treturn `${frases[index]}?`\n\t\t}\n\t\treturn `Olá ${nome}, ${greeting}.\n\t\t\n${frases[index]}?`\n\t}\n\tcatch (err) {\n\t\treturn `Olá ${nome}.`\n\t}\n\n}","inputVariables":["nome","maisDeUmaConta","clienteJaSaudado"],"outputVariable":"mensagemOla","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"2dd3df38-de36-409d-b6fd-47bea1a355fc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intentBody\"","$invalid":false,"settings":{"function":"run","source":"function run(inputContent) {\n\ttry {\n\t\tconst userInput = JSON.parse(inputContent).input.content\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": userInput\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\t\"id\": \"{{random.guid}}\",\n\t\t\t\"to\": \"postmaster@ai.msging.net\",\n\t\t\t\"method\": \"set\",\n\t\t\t\"uri\": \"/analysis\",\n\t\t\t\"type\": \"application/vnd.iris.ai.analysis-request+json\",\n\t\t\t\"resource\": {\n\t\t\t\t\"text\": inputContent\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["input.content"],"outputVariable":"intentBody","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c0445b5-715e-45f2-93c9-1d5a72390576","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"intentResponse\" using \"POST\"","$invalid":false,"settings":{"headers":{"Authorization":"{{config.commandsKey}}","Content-Type":"application/json"},"method":"POST","body":"{{intentBody}}","uri":"{{config.commandsUrl}}","responseStatusVariable":"intentStatus","responseBodyVariable":"IntentResponse"},"conditions":[]},{"$id":"4ec9da18-6ece-492e-b21c-0b5819b0de4c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(intent, accuracy) {\n\ttry {\n\t\tinput = JSON.parse(intent).resource.text;\n\t\treturn {\n\t\t\tinput: input,\n\t\t\tintent: findIntention(intent, accuracy)\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nfunction findIntention(intent, accuracy) {\n\ttry {\n\t\tintent = JSON.parse(intent).resource.intentions\n\t\tindentifiedIntent = intent.filter(({ score }) => score > Number(accuracy))\n\t\tif (indentifiedIntent.length > 0) {\n\t\t\treturn indentifiedIntent[0].name;\n\t\t}\n\t\treturn null\n\t} catch (err) {\n\t\treturn null\n\t}\n}","inputVariables":["intentResponse","config.accuracy"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5758f1d9-7fc7-48a5-a81a-680f1fb6d5aa","$typeOfContent":"","type":"ExecuteScript","$title":"tracking intencao","$invalid":false,"settings":{"function":"run","source":"const run = (contact, intent) => {\n\ttry {\n\t\tconst intencao = JSON.parse(intent)\n\t\tconst dataRaw = new Date()\n\t\tdataRaw.setHours(new Date().getHours() - 3)\n\t\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\t\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\t\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\n\t\tconst telefone = contact.split(\"@\")[0]\n\t\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"34442060-d0c5-45e3-bd27-e356282d763f","$typeOfContent":"","type":"TrackEvent","$title":"intencao em que posso ajudar","$invalid":false,"settings":{"extras":{},"category":"intencao em que posso ajudar","action":"{{tracking}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"tracking"}]},{"$id":"306c4acf-4607-4069-b820-8519c1e5a770","$typeOfContent":"","type":"TrackEvent","$title":"intencao api result","$invalid":false,"settings":{"extras":{},"action":"{{intentBody}} | {{IntentStatus}} | {{intentResponse}}","category":"intencao api result"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b8d9503b-6bda-45de-9a8d-f8438c868486","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-92a9c007-d83e-4edd-a239-3a05fde22657","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b0dbd575-ad19-4a95-91b1-6448f67851f0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d5ae4d4c-97ba-41f3-b47a-b0ed70240713","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-08548f22-8d60-4490-be86-442e44251472","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"257f1171-0297-4b48-8a1c-89a7959b201f","root":false,"$title":"Em que posso ajudar?","$position":{"top":"1290px","left":"223px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c7fc7784-b1cd-42e6-8ffd-21c98867bb74":{"$contentActions":[{"action":{"$id":"0e16bcbd-29d5-419f-a0dd-3c9f78351cca","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"50ba1b1b-41fb-4ba4-874e-c895c0d0827d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"50ba1b1b-41fb-4ba4-874e-c895c0d0827d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"76d70635-744e-4e57-b69d-32982dbad6f5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"42e08227-0189-47be-ac76-7b38f10d9f1d","type":"text/plain","content":"Neste momento você está sendo atendido através da conta\n \n<b>Agência</b>: {{contact.extras.agencia}}\n<b>Conta</b>: {{contact.extras.conta}}\n \nSe precisar trocar, é só me falar que altero pra você.","metadata":{}},"$cardContent":{"document":{"id":"42e08227-0189-47be-ac76-7b38f10d9f1d","type":"text/plain","content":"Neste momento você está sendo atendido através da conta\n \n<b>Agência</b>: {{contact.extras.agencia}}\n<b>Conta</b>: {{contact.extras.conta}}\n \nSe precisar trocar, é só me falar que altero pra você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"57d8d937-48f6-4da8-8af0-d8500d92de51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bef6a3e2-6355-4e98-88cd-4887e0a27752","$typeOfContent":"","type":"SetVariable","$title":"agency","$invalid":false,"settings":{"variable":"agency","value":"{{contact.extras.agencia}}"},"conditions":[]},{"$id":"8a9eb21b-68b6-493b-ba49-ba68fd304f4c","$typeOfContent":"","type":"SetVariable","$title":"agency","$invalid":false,"settings":{"variable":"account","value":"{{contact.extras.conta}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d9359361-57c8-4d39-a392-69b769f419d6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-30a6c91c-39d3-4333-8c9e-85a351b96244","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-50ee9c24-f1a5-47bb-a598-a77e466dea5f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c7fc7784-b1cd-42e6-8ffd-21c98867bb74","root":false,"$title":"isAccountInCache","$position":{"top":"2170.86px","left":"680.286px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","typeOfStateId":"state","$connId":"con_193","$id":"5f7c2538-32ae-46ac-a15a-ee1797bf7ce9","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"OSADesligado"}],"$invalid":false},{"stateId":"4f2f8bca-5b12-450f-ab5a-cdfa022d2359","typeOfStateId":"state","$connId":"con_198","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_SENHA_TRANSACIONAL\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c9798f6c-0c07-4e7c-be25-7562213d5e6f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2b53759f-64fb-4c5a-b7f8-ddf38770b0fa","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a19b5f97-051a-4125-85f4-d7a657ba9771","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"822px","left":"2273.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"19eb9819-6e40-4264-afa8-46d3ae5e3782":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"61ec3822-3b20-4fa7-b27d-520fc240a63f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f7f67c95-a085-461a-8ce6-4165162dd1f3","typeOfStateId":"state","$connId":"con_203","$id":"4867cbd2-e8d4-44c9-9348-f8162515acaf","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"19eb9819-6e40-4264-afa8-46d3ae5e3782","root":false,"$title":"Conta","$position":{"top":"1603px","left":"472.444px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8325d14c-c78f-4a7a-9c20-9ac10444761d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"403b443c-70ab-4f60-a8b2-2cf0086b9215","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9","typeOfStateId":"state","$connId":"con_208","$id":"183d046b-378c-4c0e-88c5-66840154c224","conditions":[{"source":"context","comparison":"contains","values":["senha do cartao","senha transacional","fatura do cartao","extrato","posicao investimentos","status de entrega","aviso viagem","envio comprovante"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"257f1171-0297-4b48-8a1c-89a7959b201f","typeOfStateId":"state","$connId":"con_213","$id":"002749c3-9935-40dc-b600-a7a4a5bf7a2d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"8325d14c-c78f-4a7a-9c20-9ac10444761d","root":false,"$title":"[LO] Define Redirect","$position":{"top":"1141px","left":"443.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9":{"$contentActions":[{"action":{"$id":"7416321b-1d5f-4354-9229-6d1ee5fa578c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0bb4c5e2-36db-42bf-94d3-fb760e983b3c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0bb4c5e2-36db-42bf-94d3-fb760e983b3c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b2399964-e106-46ed-8b89-457844098298","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a4d3db4c-b293-4419-8026-cb01da55f9ee","type":"text/plain","content":"{{mensagemOla}}","metadata":{}},"$cardContent":{"document":{"id":"a4d3db4c-b293-4419-8026-cb01da55f9ee","type":"text/plain","content":"{{mensagemOla}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e8971cf5-3890-4f91-9c01-b8df71c79f0c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","typeOfStateId":"state","$connId":"con_218","$id":"65694a40-7410-4ca8-8307-aebebd049444","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e7ac2ad4-3089-4b35-9ef3-c7c8adba97cb","$typeOfContent":"","type":"ExecuteScript","$title":"mensagemOla","$invalid":false,"settings":{"function":"run","source":"const run = (nome, maisDeUmaConta = false, clienteJaSaudado) => {\n\ttry {\n\t\tconst nomePequeno = nome.toLowerCase()\n\t\tnome = nomePequeno.replace(/^./, nomePequeno[0].toUpperCase()) //primeira letra maiuscula\n\t\tconst index = Math.floor(Math.random() * 10 % 2)\n\t\tconst hora = new Date().getHours()\n\n\t\tlet greeting;\n\t\tif (hora >= 5 && hora < 12) {\n\t\t\tgreeting = 'bom dia'\n\t\t} else if (hora >= 12 && hora < 18) {\n\t\t\tgreeting = \"boa tarde\"\n\t\t} else if (hora >= 18 || hora < 5) {\n\t\t\tgreeting = 'boa noite'\n\t\t}\n\n\t\treturn `Olá ${nome}, ${greeting}.`\n\t}\n\tcatch (err) {\n\t\treturn `Olá ${nome}.`\n\t}\n\n}","inputVariables":["nome","maisDeUmaConta","clienteJaSaudado"],"outputVariable":"mensagemOla","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94f0d218-33bc-4943-965f-bfb4f0205121","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3fba5be6-aa3d-4063-8805-6fe917fbdd7b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2ba65929-df6e-43d8-81e9-0d9613b07965","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f8b5c73a-23bf-4bdd-bd1e-62b6db9a0dc9","root":false,"$title":"[LO] Intencao Especifica","$position":{"top":"1290.33px","left":"724px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"94f0d218-33bc-4943-965f-bfb4f0205121":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1f0e49ad-194d-43f3-a53c-1059fd49c0d6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"94f0d218-33bc-4943-965f-bfb4f0205121","root":false,"$title":"[GO TO] Conta","$position":{"top":"1492px","left":"726px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6409c653-f585-4dc3-8039-4c7453131a4f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3f370aae-e3cb-483c-978b-5f988b90e0d1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c789b4b6-f614-4658-98bd-3dc0a2ba0f48","typeOfStateId":"state","$connId":"con_223","$id":"68771426-1c14-4bc3-b4d3-e082091ee9a7","conditions":[{"source":"context","comparison":"contains","values":["senha do cartao","senha transacional"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"55270663-c4fc-4407-8ac5-e859e7d9d5f0","typeOfStateId":"state","$connId":"con_228","$id":"1d0f5912-779c-41a7-baed-913f4d034e11","conditions":[{"source":"context","comparison":"equals","values":["fatura do cartao"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"127757c2-0404-4ee1-887c-6b60d71a3a77","typeOfStateId":"state","$connId":"con_233","$id":"acbc2748-5086-4db3-9dbc-4d76da94722a","conditions":[{"source":"context","comparison":"equals","values":["posicao investimentos"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"1376549f-3a8a-4f11-869e-1960f295a5ef","typeOfStateId":"state","$connId":"con_238","$id":"bf740b6f-5c27-4084-81b8-3e1d2157309d","conditions":[{"source":"context","comparison":"equals","values":["extrato"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8","typeOfStateId":"state","$connId":"con_243","$id":"b6aaddcb-0742-4ff2-864d-3ddb169e4cc4","conditions":[{"source":"context","comparison":"equals","values":["alterar conta"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"d64a1b9a-d7fb-4a53-884a-d34085a5601b","typeOfStateId":"state","$connId":"con_248","$id":"0c6dd484-3e36-4278-85a3-db4773e191e7","conditions":[{"source":"context","comparison":"equals","values":["status de entrega"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"3cf5c53e-355f-4c57-a1e3-2b98a6fada21","typeOfStateId":"state","$connId":"con_253","$id":"728b1374-96b4-4a6e-a09a-7dbed312ba48","conditions":[{"source":"context","comparison":"equals","values":["aviso viagem"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"648f7f6e-b881-4233-96b6-9d6aebf84298","typeOfStateId":"state","$connId":"con_258","$id":"c0a5db99-51b2-49c0-ab57-65ed489e701c","conditions":[{"source":"context","comparison":"equals","values":["envio comprovante"],"variable":"intencaoIdentificada@intent"}],"$invalid":false},{"stateId":"cdd34564-0396-44f2-a37d-978173c3889d","typeOfStateId":"state","$connId":"con_263","$id":"9a025280-50e8-43fc-b683-0f24f665aed5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6409c653-f585-4dc3-8039-4c7453131a4f","root":false,"$title":"[LO] Redirect to Intent","$position":{"top":"2892px","left":"676px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c789b4b6-f614-4658-98bd-3dc0a2ba0f48":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"29db6934-db3e-4ec2-aa38-63e03e5e28f8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7f659926-dc88-4644-8b7a-f565172719dd","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c789b4b6-f614-4658-98bd-3dc0a2ba0f48","root":false,"$title":"[GO TO] Senha","$position":{"top":"3077.67px","left":"676.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7f659926-dc88-4644-8b7a-f565172719dd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4db89b2f-6610-4fef-a60d-397cfa0acb20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2cecbf3c-9c97-4dd4-9148-2f00250a1ec3","typeOfStateId":"state","$connId":"con_268","$id":"89d71240-6f55-4031-97de-0d19c5402a93","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"7f659926-dc88-4644-8b7a-f565172719dd","root":false,"$title":"[Inicio] Senha","$position":{"top":"672.571px","left":"2273.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"872e291f-f7e3-47e4-bf53-a2fdc8d416b2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cb24993-c716-4d70-bc9a-b0b5059007d3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"872e291f-f7e3-47e4-bf53-a2fdc8d416b2","root":false,"$title":"[GO TO] Employee Transbordo","$position":{"top":"1137px","left":"965px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0901ef90-046a-400a-af6a-448451b6d2cd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ee0d26f9-2fdb-401c-89ce-332b25d2d280","typeOfStateId":"state","$connId":"con_273","$id":"bb2d1ef5-fd17-426f-95b8-9e7fd78f63cf","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ae186038-de48-45ff-bcc3-12ef5883d325","$typeOfContent":"","type":"ExecuteScript","$title":"CLEAR isAccountInCache","$invalid":false,"settings":{"function":"run","source":"function run() {\n\treturn false;\n}","inputVariables":[],"outputVariable":"isAccountInCache","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3b81df9-3de1-4dad-ad5b-b33afa397e3a","$typeOfContent":"","type":"SetVariable","$title":"CLEAR agencia","$invalid":false,"settings":{"variable":"agencia"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"50997dc8-f861-4233-800c-7120f2f9c0b2","$typeOfContent":"","type":"SetVariable","$title":"CLEAR conta","$invalid":false,"settings":{"variable":"conta"},"conditions":[{"values":["false"],"source":"context","comparison":"equals","variable":"isAccountInCache"}]},{"$id":"e04e4f0e-5c29-4c3f-a5c1-9e9766b2e068","$typeOfContent":"","type":"MergeContact","$title":"CLEAR conta/agencia","$invalid":false,"settings":{"extras":{"conta":"{{conta}}","agencia":"{{agencia}}"}},"conditions":[{"values":["false"],"source":"context","variable":"isAccountInCache","comparison":"equals"}]},{"$id":"9ca8a87d-6e74-4b39-b2b3-bfcf3d78b738","$typeOfContent":"","type":"SetVariable","$title":"CLEAR responseClientData","$invalid":false,"settings":{"variable":"responseClientData"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-86d1a8b2-23a5-4353-812e-bba2b874361e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-98d386d5-b11b-43d3-9c31-440ec64c002d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9f3fd014-c779-43b8-b334-26106d9cf144","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"64dc75ae-da8b-44b6-9c0f-5ea767c99bc8","root":false,"$title":"[SET] Conta","$position":{"top":"3090.33px","left":"1236.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a81c2652-6c5c-4be0-899c-06b296aa5703":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b0581502-33d7-44e9-a2b8-ec69dc729fe0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"a81c2652-6c5c-4be0-899c-06b296aa5703","root":false,"$title":"[GO TO] employee transbordo","$position":{"top":"1527px","left":"2273px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a4d00d38-2ac4-4881-8808-879f3ce6b708":{"$contentActions":[{"action":{"$id":"5c4cc545-a9dc-42d8-8f97-5053697ab697","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1cbcc9ae-83c0-47dd-bf38-16f05ffe24dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ed1b3173-87d9-412b-a602-0f703bee9fb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"Posso te ajudar em algo mais?","metadata":{}},"$cardContent":{"document":{"id":"f2356478-9719-440a-8ec5-75710eef6e9a","type":"text/plain","content":"Posso te ajudar em algo mais?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"f38dcdda-ffa8-484d-984b-ed99704f4332","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3f739f15-0056-45e3-89b4-29d2ae4d3efa","typeOfStateId":"state","$connId":"con_278","$id":"d3cec968-0120-4586-8aad-7f0289dd777c","conditions":[{"source":"context","comparison":"contains","values":["Negation"],"variable":"SmallTalksIdentified"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4e1c5171-6212-4fc3-998e-6fe98f62cfee","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"intencaoIdentificada\"","$invalid":false,"settings":{"function":"run","source":"function run(input, intent) {\n\ttry {\n\t\treturn {\n\t\t\tinput,\n\t\t\tintent\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content","input.intent.name"],"outputVariable":"intencaoIdentificada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5e790807-8af2-4707-8bcf-189cddaaa279","$typeOfContent":"","type":"ExecuteScript","$title":"tracking","$invalid":false,"settings":{"function":"run","source":"const run = ( contact, intent) => {\n\tconst intencao = JSON.parse(intent)\n\tconst dataRaw = new Date()\n\tdataRaw.setHours(new Date().getHours() - 3)\n\tconst data = dataRaw.toISOString().split(\"T\")[0]\n\tconst hora = dataRaw.toISOString().split(\"T\")[1].split('.')[0]\n\n\tconst intencaoIdentificada = intencao.intent ? intencao.intent : \"nao identificada\"\n\t\n\tconst telefone = contact.split(\"@\")[0]\n\treturn `${telefone} | ${data} | ${hora} | ${intencao.input} | ${intencaoIdentificada}`\n}","inputVariables":["contact.identity","intencaoIdentificada"],"outputVariable":"tracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4602aedf-7f28-42c4-ac41-dfde63fada53","$typeOfContent":"","type":"TrackEvent","$title":"intencao te ajudo em algo mais","$invalid":false,"settings":{"extras":{},"category":"intencao Te ajudo em algo mais","action":"{{tracking}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"tracking"}]},{"$id":"0f119d00-08fc-4fb6-8de9-6794cc8861cd","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"ac347e98-44d3-42fd-ab3e-5ca00b54e487","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-deb01c36-331c-4037-9441-ec508ad7072d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-70c0cfdb-a36c-424c-979e-0a48adb861d1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ce4f8e8c-906e-4d62-a36f-40a70744e942","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-d795ff3a-c7c7-4671-b463-be9cff131963","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-19623b1f-aa96-4fe9-9fef-062cb22a616d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a4d00d38-2ac4-4881-8808-879f3ce6b708","root":false,"$title":"Te ajudo em algo mais","$position":{"top":"1112px","left":"1582px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a35fa267-f2b7-4298-83d9-b0924114e971":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"85a9c4c8-745d-4f90-84fb-0d7054fe9048","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"871d7bbd-2b33-4a84-b028-b6e692ed9510","typeOfStateId":"state","$connId":"con_283","$id":"0799e07e-6c68-4d66-93db-731882a29c75","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["extratoDataInvalida"],"source":"context","comparison":"equals","variable":"dataExtractor@error"},{"values":["871d7bbd-2b33-4a84-b028-b6e692ed9510"],"source":"context","comparison":"notEquals","variable":"state.previous.id"}],"$invalid":false},{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","typeOfStateId":"state","$connId":"con_288","$id":"684758e1-01af-41cd-a10c-8e71515ff988","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1e6bd2c1-66d3-490f-9fd8-414b7ab0c81b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"8e5c42e8-afdc-47ed-a38d-9f0ce3f6b929","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, statePreviousId, smalltalks) {\n  try {\n    if (smalltalks && smalltalks.includes(\"Confirmation\") && statePreviousId === '871d7bbd-2b33-4a84-b028-b6e692ed9510') {\n      const currentDate = new Date();\n      const endDate = currentDate;\n      const startDate = new Date(currentDate.getTime() - 30 * 24 * 60 * 60 * 1000);\n      return `${formatDate(startDate)}|${formatDate(endDate)}`;\n    }\n\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n        return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n\n      return `${formatDate(startDate)}|${formatDate(endDate)}`; // Retorna as datas \n    } else {\n      return { error: 'extratoDataInvalida' };\n    }\n\n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","state.previous.id","bodySmallTalks"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b49e58c-0e49-46dd-8ada-a72a82f2fb15","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dataExtractor@error\"","$invalid":false,"settings":{"variable":"exceptionType","value":"{{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]}],"$leavingCustomActions":[{"$id":"a324f2ac-e7dd-462b-8481-9c7e796c3d12","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input inesperado\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input inesperado","action":"{{state.previous.name}} | {{dataExtractor@error}} | {{input.content}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"03afa7a9-af25-4854-909f-4ef6560f9698","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato error\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato error","action":"{{state.previous.name}} | {{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"08e90e47-63cf-48ed-98e7-c6907d863acb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input","action":"{{state.previous.name}} | {{input.content}} | {{dataExtractor}}"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5c0d9812-0677-4600-8855-280f0b8eba60","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-89edb003-dbc7-431f-961c-2f0cf44ca79d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6404ddb7-97f6-4dda-a085-e9f678af078a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"a35fa267-f2b7-4298-83d9-b0924114e971","root":false,"$title":"[E.1.0.0][SET] Valida input do usuario","$position":{"top":"790.75px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"871d7bbd-2b33-4a84-b028-b6e692ed9510":{"$contentActions":[{"action":{"$id":"c2e2aa97-b7f7-4109-aa5e-b5f8ff075ebb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31a774e3-1d14-4de6-bf94-f2e868f9f018","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 30 dias mesmo?","metadata":{}},"$cardContent":{"document":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 30 dias mesmo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c3010671-a4a8-40a4-bba4-45ecfb8bf0dc","type":"text/plain","textContent":"Entrada do usuário","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","typeOfStateId":"state","$connId":"con_293","$id":"7d932bee-eec1-4f19-af13-fb5eab80f880","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c42adbc3-7434-4ba0-bdce-f7172bacdf40","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"80470ebb-39d0-45da-ba8c-56644d38f3e5","$typeOfContent":"","type":"SetVariable","$title":"CLEAR bodySmallTalks","$invalid":false,"settings":{"variable":"bodySmallTalks"},"conditions":[]}],"$leavingCustomActions":[{"$id":"69e4094c-6b73-4d36-9f82-de14b9701e33","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"24eb1e8d-1c43-4ecb-ba40-cf5e09bf3d1e","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"cb116792-f53d-4b60-9840-c6b840b70078","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ba5a42a-69d3-4c5d-9461-5a7a76e74516","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, statePreviousId, smalltalks) {\n  try {\n    if (smalltalks && smalltalks.includes(\"Confirmation\")) {\n      const currentDate = new Date();\n      const endDate = currentDate;\n      const startDate = new Date(currentDate.getTime() - 30 * 24 * 60 * 60 * 1000);\n      return `${formatDate(startDate)}|${formatDate(endDate)}`;\n    }\n\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n        return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n\n      return `${formatDate(startDate)}|${formatDate(endDate)}`; // Retorna as datas \n    } else {\n      return { error: 'extratoDataInvalida' };\n    }\n\n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","state.previous.id","bodySmallTalks"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"36ce20f0-8b53-43c9-aab8-5b7029a5099d","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dataExtractor@error\"","$invalid":false,"settings":{"variable":"exceptionType","value":"{{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3f309d8f-3806-46a6-a9d3-bd3abdd43bf0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-90451bab-cd89-4700-9b45-c21c3d4cc5bd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7cbc0eba-a6fb-4643-b21d-9a16ac438976","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-83fad7c4-84b2-4483-a5aa-99debbd6e380","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-415875e9-0666-4648-ab13-96c293d24ca1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-7febd5e1-50cb-4833-b455-2156e9fd215f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"871d7bbd-2b33-4a84-b028-b6e692ed9510","root":false,"$title":"[E.2.0.0][MSG][INPUT] Pergunta periodo","$position":{"top":"860.714px","left":"3566.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"84742bd8-cf3a-42eb-9872-710107fa5f1c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"704f8e0c-512c-44bd-8610-570d27ba2318","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"116ba504-bb26-46fe-a74c-b5c69bf357b1","typeOfStateId":"state","$connId":"con_298","$id":"680ab48e-6724-42a4-b347-c8f6bb2b2a94","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e4399cb-56e8-4301-bb19-311701963b5f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"320e7bbc-121f-4624-96c5-11e42d9203c0","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" to \"\"","$invalid":false,"settings":{"variable":"SmallTalksIdentified"},"conditions":[]},{"$id":"1bfb6c91-f57e-4f41-b361-9308f05634fe","$typeOfContent":"","type":"ExecuteScript","$title":"msgHomologacao","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(x) {\n\treturn `[Homologação]\n\tEstamos enviando o extrato do seguinte período identificado:\n\t ${x}`\n}\n","inputVariables":["dataExtractor"],"outputVariable":"msgHomologacao","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fcef3ed4-c7a1-468f-8a3b-16280209c163","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5ddf871c-797d-473d-ada9-0856de8ca992","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c5e6daab-b078-4ce0-ab6a-e2b85e0cf775","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"84742bd8-cf3a-42eb-9872-710107fa5f1c","root":false,"$title":"[E.3.0.0][SET] Periodo identificado","$position":{"top":"977px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"116ba504-bb26-46fe-a74c-b5c69bf357b1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4f2d3b75-84c0-45a8-b360-7f2c6d54c651","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"76e66b96-c6e8-466c-86f4-f626d201cf17","typeOfStateId":"state","$connId":"con_303","$id":"d037e357-9421-4aa6-a28d-0f713698a796","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"dentroDosTrintaDias"},{"values":["200","202"],"source":"context","comparison":"equals","variable":"statusEnvioExtrato"}],"$invalid":false},{"stateId":"d71495a0-6203-423b-aace-67e3f4df6e8d","typeOfStateId":"state","$connId":"con_308","$id":"ab69c031-b50f-4452-afb5-55f5ee35a4a2","conditions":[{"source":"context","comparison":"equals","values":["200","202"],"variable":"statusEnvioExtrato"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b123ae2f-d64e-4d7e-9f0a-deaf7bfcbbf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"15145df0-8255-4969-be2e-3815b8cbe69b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyExtrato\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, dataExtractor) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tlet data = dataExtractor.split('|');\n\t\treturn {\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"dataInicial\": data[0],\n\t\t\t\"dataFinal\": data[1],\n\t\t\t\"limite\": \"100\",\n\t\t\t\"pagina\": \"1\"\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","dataExtractor"],"outputVariable":"bodyExtrato","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b99e86a4-7aa9-45a0-ace8-0a0313f88277","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioExtrato","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/extratos/notificar","responseStatusVariable":"statusEnvioExtrato","responseBodyVariable":"responseEnvioExtrato","body":"{{bodyExtrato}}"},"conditions":[]},{"$id":"9faa9ff1-b545-4baf-a1ae-d75b5278dbd9","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusEnvioExtrato"}]}],"$leavingCustomActions":[{"$id":"15f80a3c-18f8-4740-bfc5-bda768be8b26","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dentroDosTrintaDias\"","$invalid":false,"settings":{"function":"run","source":"function run(dateRange) {\n  const dates = dateRange.split('|');\n  const startDate = new Date(dates[0]);\n  const endDate = new Date(dates[1]);\n\n  const today = new Date();\n  const thirtyDaysAgo = new Date(today);\n  thirtyDaysAgo.setDate(today.getDate() - 30);\n\n  return startDate >= thirtyDaysAgo && endDate <= today;\n}","inputVariables":["dataExtractor"],"outputVariable":"dentroDosTrintaDias","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d87361df-765c-44d5-9a3a-ccd76bef6011","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f0205a7d-053b-415d-8e43-4b6de1447e92","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-955f4f8e-a9e5-4c50-9b47-6e5f7672d5ee","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-3912b1f4-fba8-4d55-a98d-2c57f825492b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"116ba504-bb26-46fe-a74c-b5c69bf357b1","root":false,"$title":"[E.4.0.0][HTTP] Chamada API extrato","$position":{"top":"1228px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d71495a0-6203-423b-aace-67e3f4df6e8d":{"$contentActions":[{"action":{"$id":"29bed67c-944d-44ae-879f-ddc9e2b59535","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1be677b9-0ba2-4253-8195-0c2df8f53386","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1be677b9-0ba2-4253-8195-0c2df8f53386","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"46cc202b-1b1f-4d35-ba89-0a4374bd464b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e6d6973b-27a7-47ad-ab69-49cd141b72b3","type":"text/plain","content":"Vou te mandar o extrato no seu email.","metadata":{}},"$cardContent":{"document":{"id":"e6d6973b-27a7-47ad-ab69-49cd141b72b3","type":"text/plain","content":"Vou te mandar o extrato no seu email."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac9e2a78-d133-4eb0-9e06-3edb448dab26","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"feacc199-138a-4b53-97c5-4df7b2f4c4a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"6000"},"metadata":{}},"$cardContent":{"document":{"id":"feacc199-138a-4b53-97c5-4df7b2f4c4a1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"6000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"17b054b5-dee7-4578-b44d-10efb424d5af","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2cab5dac-8e04-4681-b3dd-eb0d9190f2a2","type":"text/plain","content":"Pronto, já enviei pra você.","metadata":{}},"$cardContent":{"document":{"id":"2cab5dac-8e04-4681-b3dd-eb0d9190f2a2","type":"text/plain","content":"Pronto, já enviei pra você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39e7ffb0-588b-41df-a249-cdc91ff8dcb5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","typeOfStateId":"state","$connId":"con_313","$id":"35de290e-abe4-40d8-a726-7132d31e8e42","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3278d444-f319-4c66-bec9-756745c09af5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-03d73309-f3fb-4e23-aa10-0b100ffbc633","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-89bf545b-537c-4dfe-9842-dff981c29b9f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d71495a0-6203-423b-aace-67e3f4df6e8d","root":false,"$title":"[E.5.1.0][MSG] Extrato periodo superior a 30 dias","$position":{"top":"1413px","left":"3521px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"76e66b96-c6e8-466c-86f4-f626d201cf17":{"$contentActions":[{"action":{"$id":"afb67201-0ee5-440d-9044-1db7ce8a730d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ab33e144-dd1a-494c-8d29-e2286c26cec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ab33e144-dd1a-494c-8d29-e2286c26cec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8211c06a-a0d3-4b14-91d6-0fe471315a05","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c0b76e85-85bf-48ec-949c-e3369a685a77","type":"text/plain","content":"Pronto, mandei no seu e-mail o extrato de conta corrente.","metadata":{}},"$cardContent":{"document":{"id":"c0b76e85-85bf-48ec-949c-e3369a685a77","type":"text/plain","content":"Pronto, mandei no seu e-mail o extrato de conta corrente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"68ac32a9-f842-40b9-a31d-ecdd4319d48b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","typeOfStateId":"state","$connId":"con_318","$id":"13504498-eb7a-48b7-9020-3a0397e0be89","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"177d52fa-e9af-4381-a06a-a327c6c4720c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d7b51ff7-6299-4ee0-a9c3-2c0567396dc3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5da08856-bb1f-49d8-9187-4f9d00f9421c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"76e66b96-c6e8-466c-86f4-f626d201cf17","root":false,"$title":"[E.5.0.0][MSG] Extrato dos ultimos 30 dias","$position":{"top":"1425px","left":"3082px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55a7184f-25ce-4f2d-a9e5-99adb4b54b43":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5822295d-51e6-42a6-ae0e-28bb39a46558","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d5a63910-77b8-414a-97ea-21e82114edd9","typeOfStateId":"state","$connId":"con_323","$id":"fdbe7338-e666-4cb1-9301-1cdb5e300ffa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"feca63b9-ee12-4878-824a-3d9bd6d5bc7c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fc9f9943-c3ef-4337-b7c6-7971ad951166","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"55a7184f-25ce-4f2d-a9e5-99adb4b54b43","root":false,"$title":"[E.6.0.0] Finalização jornada extrato","$position":{"top":"1689px","left":"3305px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c606331c-9875-44ec-bdb4-da4571c9dd01","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5aba1012-65f4-4562-9aa9-419d0b772741","typeOfStateId":"state","$connId":"con_328","$id":"a78c027b-40db-464b-8ffc-659e1ed74f06","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a","root":false,"$title":"[Inicio] Extrato","$position":{"top":"496px","left":"3294.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0fb18c4b-3d1a-4905-b922-197db4f5d1c8":{"$contentActions":[{"action":{"$id":"232e975d-726f-4a57-bda5-a2bced451599","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d6e3eae9-acca-4410-9841-862c3e5d5819","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d6e3eae9-acca-4410-9841-862c3e5d5819","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d6594ec-3e50-446a-91f3-0e1dee0e70c5","$typeOfContent":"text","type":"SendMessage","settings":{"id":"be7a0115-d4a9-4a28-ad1a-fccb560179d6","type":"text/plain","content":"Eu só consigo te mandar o extrato de até dois anos.","metadata":{}},"$cardContent":{"document":{"id":"be7a0115-d4a9-4a28-ad1a-fccb560179d6","type":"text/plain","content":"Eu só consigo te mandar o extrato de até dois anos."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"13edf47f-db94-4720-9248-40abcb638142","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6e74e30b-8e31-43d5-bf54-7d89eed6c0d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6e74e30b-8e31-43d5-bf54-7d89eed6c0d1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"020184c4-1b78-4cf8-a7d5-da43e481d5f6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"27347564-ac1d-4483-988a-2c1a2c169e53","type":"text/plain","content":"Eu posso te enviar de algum outro período dentro de 2 anos.\nPode ser?","metadata":{}},"$cardContent":{"document":{"id":"27347564-ac1d-4483-988a-2c1a2c169e53","type":"text/plain","content":"Eu posso te enviar de algum outro período dentro de 2 anos.\nPode ser?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"cede0f5a-5453-45c2-a4fd-e95e478bdd14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d656533c-7bf1-4c99-9309-c499e37ac1b4","typeOfStateId":"state","$connId":"con_333","$id":"39c07ed9-150c-4b78-af02-e1122d9f5c35","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"},{"values":["Confirmation"],"source":"context","comparison":"contains","variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"36276848-e740-4865-8e94-708187eaf9f4","typeOfStateId":"state","$connId":"con_338","$id":"2dcbac91-64d2-4ccb-9f32-e2004343929e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5635f770-a2b5-4769-98bf-0688c27a73b1","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"\"","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]}],"$leavingCustomActions":[{"$id":"beb72ee9-e004-40ba-acb1-7cc8deaefe3e","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"09f3494b-a751-4e29-99a2-7e61d5fc7608","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e22ff38c-8ab9-4617-820e-3462c58fbe8b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, smalltalks, statePreviousId) {\n  try {\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${day}/${month}/${year}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n          return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n          return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n      \n      // Removendo a validação de 90 dias\n      return `${formatDate(startDate)} - ${formatDate(endDate)}`; // Retorna as datas sem validação\n  } else {\n    return { error: 'extratoDataInvalida' };\n  }\n  \n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","SmallTalksIdentified","state.previous.id"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3fe1fa9d-e114-455c-a428-49e039096674","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6328f8e8-f2ac-4709-9c43-b2fb27b4612e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-87e7eba9-acf4-47ce-8306-38a11a0901e7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9acd9ee0-86c7-49f7-8297-79d381464808","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-53a52726-c273-4e57-bf88-6f148818a20c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6342436f-24f8-40c6-830b-afcf98e61e90","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-26e5d501-20de-4c95-b4c2-85f3b26094aa","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"0fb18c4b-3d1a-4905-b922-197db4f5d1c8","root":false,"$title":"[Exceção][Extrato] Periodo superior a 2 anos","$position":{"top":"153px","left":"1780px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36276848-e740-4865-8e94-708187eaf9f4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a4d4d95-25b1-454f-9cdc-ef3b0b29b04f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"84742bd8-cf3a-42eb-9872-710107fa5f1c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"36276848-e740-4865-8e94-708187eaf9f4","root":false,"$title":"[GO TO] [E.3.0.0][SET] Periodo identificado","$position":{"top":"210.333px","left":"2029px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d656533c-7bf1-4c99-9309-c499e37ac1b4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"15c780e0-24f8-44e7-9144-6c6dba1df205","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"871d7bbd-2b33-4a84-b028-b6e692ed9510","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d656533c-7bf1-4c99-9309-c499e37ac1b4","root":false,"$title":"[GO TO][E.2.0.0] Pergunta periodo","$position":{"top":"361px","left":"2023px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d5a63910-77b8-414a-97ea-21e82114edd9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5b5edd6a-0a08-4d8f-b469-30a5f7be519c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d5a63910-77b8-414a-97ea-21e82114edd9","root":false,"$title":"[GO TO] Te ajudo em algo mais","$position":{"top":"1891px","left":"3305px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e92decba-2f27-4b5b-a0ec-c761214c6811":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5064a085-443c-419b-b25e-b6ffa7059ce0","typeOfStateId":"state","$connId":"con_343","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"e92decba-2f27-4b5b-a0ec-c761214c6811","root":false,"$title":"[Inicio] Posicao Investimento","$position":{"top":"272px","left":"4310px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"15a79232-ef1a-4238-9477-382cae383baf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76052a9b-f55c-4fd6-8ac8-da0510909330","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00","typeOfStateId":"state","$connId":"con_348","$id":"cb9cb40d-af26-4aeb-86d0-2dd147eb7fd5","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"email"}],"$invalid":false},{"stateId":"5215041d-b5f5-49eb-895c-0648cc1546a1","typeOfStateId":"state","$connId":"con_353","$id":"d6317b53-b402-4aa0-af65-27b8293d6b92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"036556d2-9bbe-4d55-9702-aacf808a6c86","$typeOfContent":"","type":"SetVariable","$title":"Set \"PossuiEmails\"","$invalid":false,"settings":{"variable":"PossuiEmails","value":"{{contact.email}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7de69c4a-7c7d-4591-aef5-46f3dc70309c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"15a79232-ef1a-4238-9477-382cae383baf","root":false,"$title":"[PI.2.0.0][SET] Tem Email?","$position":{"top":"939px","left":"4307.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3c80ea3-9508-44e7-9d24-73fcd3780435","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba","typeOfStateId":"state","$connId":"con_358","$id":"a12de166-4304-4415-baa9-e63cee99fca5","conditions":[{"source":"context","comparison":"equals","values":["200","202","204"],"variable":"statusEnvioPosicaoInvestimento"}],"$invalid":false},{"stateId":"36730683-8874-4b01-af50-a78da194c2d1","typeOfStateId":"state","$connId":"con_363","$id":"58fdd2cd-584c-4153-98f9-9daa8fdaf332","conditions":[{"source":"context","comparison":"equals","values":["404"],"variable":"statusEnvioPosicaoInvestimento"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9b407411-0fbf-4259-9828-5dad272400f9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"79be6e3e-488c-4887-abc0-340af9124931","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusEnvioEmailInvestimento"}]},{"$id":"dce5fa17-2588-4453-af45-f3754ce37c50","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyPosicaoInvestimento\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, segmentCode, customerName) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\treturn {\n\t\t\t\"nome\": customerName,\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"segmento\": segmentCode\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","segmentCode","customerName"],"outputVariable":"bodyPosicaoInvestimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4d7fed09-e1f7-4511-b113-b441d4062ab7","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioPosicaoInvestimento","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/gerenciamento-investimentos/posicao-investimentos/assistente-virtual/v1/posicoes-investimentos/relatorios/enviar","responseStatusVariable":"statusEnvioPosicaoInvestimento","responseBodyVariable":"responseEnvioPosicaoInvestimento","body":"{{bodyPosicaoInvestimento}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-109f49fe-d47d-43e5-b5aa-33049919d3e5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-16351e15-0a13-4de7-9602-5cb4da6c9e71","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1512ad27-6c60-4f95-a101-bad7727ffba7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3e888276-6616-417f-b27b-2bc2b5bda4b7","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"d7c2a6b7-caa0-4e2c-9be1-a32c7a4f2c00","root":false,"$title":"[PI.3.0.0][HTTP] Cockpit Envio Email","$position":{"top":"1097px","left":"4308px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba":{"$contentActions":[{"action":{"$id":"3ffa3499-b5f6-4813-ac8f-229e2a32e38a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"540fd19b-d231-4461-894a-9f85e590148e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"540fd19b-d231-4461-894a-9f85e590148e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"dab25d29-83a8-4221-92fd-2f4ca5b23c37","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ee27f1c8-b8f9-4886-af69-c45e6bb7d862","type":"text/plain","content":"Enviei o PDF com essas informações no seu e-mail. Dá uma olhada lá, que te mandei agora.","metadata":{}},"$cardContent":{"document":{"id":"ee27f1c8-b8f9-4886-af69-c45e6bb7d862","type":"text/plain","content":"Enviei o PDF com essas informações no seu e-mail. Dá uma olhada lá, que te mandei agora."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"541d072d-0f81-462f-9dbf-461e52f1869d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","typeOfStateId":"state","$connId":"con_368","$id":"26541ff9-3045-4160-94e1-2e42afefb080","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"acd10bdc-5e59-477b-a444-9874bb17576a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-20105b1c-d141-441f-9019-9c0e63896195","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bf55bfa1-7efa-43db-949a-74b231f62852","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9f5296de-f7e7-41ea-bcc6-cda372dfe9ba","root":false,"$title":"[PI.3.0.1][MSG] Email Enviado","$position":{"top":"1317px","left":"4118px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62aec317-124c-4a6f-8eb5-347b96526b10":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"62aec317-124c-4a6f-8eb5-347b96526b10","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"1093px","left":"4545px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"721152e9-4da1-4e8f-889c-f7edd710a8d5","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708"},"isAiGenerated":false,"$tags":[],"id":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","root":false,"$title":"[GO TO] Finalizacao","$position":{"top":"1478.5px","left":"4302.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"c6b1d835-f571-4c7a-975d-6e088158bc68":{"$contentActions":[{"action":{"$id":"953d30c2-836a-4e4f-8caa-f643dcef106f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"321c788b-6b3b-4b10-a4d9-03c491e0a9cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"321c788b-6b3b-4b10-a4d9-03c491e0a9cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0487808c-5f3b-4b84-b18c-5bf249875e03","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6f73761f-5d9e-4471-b3de-a683244cdd2e","type":"text/plain","content":"No momento, estamos enfrentando instabilidade em nosso sistema.","metadata":{}},"$cardContent":{"document":{"id":"6f73761f-5d9e-4471-b3de-a683244cdd2e","type":"text/plain","content":"No momento, estamos enfrentando instabilidade em nosso sistema."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"42212050-83b1-4709-b2c0-f3f04d64a522","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"526ec006-18a4-4ce8-94aa-4f740d45526b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"526ec006-18a4-4ce8-94aa-4f740d45526b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0d8eaaa6-12ce-433f-bae8-475e764f1ae6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ea1f141b-f598-4b23-8fcf-f7c5863150ed","type":"text/plain","content":"Você pode tentar novamente mais tarde, vou te transferir em contato com seu gerente.","metadata":{}},"$cardContent":{"document":{"id":"ea1f141b-f598-4b23-8fcf-f7c5863150ed","type":"text/plain","content":"Você pode tentar novamente mais tarde, vou te transferir em contato com seu gerente."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"480d7b51-2ec1-4aa9-bbec-0f3d5e9d269f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"e65ae042-2867-4005-9f6f-c24781ded992"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f7623834-cbfe-4744-9abc-75d8dce4f520","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c6b1d835-f571-4c7a-975d-6e088158bc68","root":false,"$title":"[Exceção][API] Erro de API (generico)","$position":{"top":"327px","left":"1781px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"469e36b0-7e94-4c65-8b9e-4cab91f23487":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"451ffe67-c4d9-46d1-a6fe-516a8358f445","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e566e5e8-7dab-4252-8c8c-fd6e994b3d92","typeOfStateId":"state","$connId":"con_373","$id":"53fef6b0-defd-43a9-86ce-13620426a4b7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"469e36b0-7e94-4c65-8b9e-4cab91f23487","root":false,"$title":"[Inicio] Fatura do cartão","$position":{"top":"476px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"55270663-c4fc-4407-8ac5-e859e7d9d5f0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"801a3e0f-86fa-456d-81ef-605719df9032","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"469e36b0-7e94-4c65-8b9e-4cab91f23487","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"55270663-c4fc-4407-8ac5-e859e7d9d5f0","root":false,"$title":"[GO TO] Fatura do cartao","$position":{"top":"3076.67px","left":"480.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b056c54-8b78-47f7-a632-a5c1e959642f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d1bca5c2-5488-439f-82e8-608821b7f9ff","typeOfStateId":"state","$connId":"con_378","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3688cb85-f2ae-4c26-baf0-1822644c1820","typeOfStateId":"state","$connId":"con_383","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"bd552257-7201-4ce6-abf3-fc2d61dc4c75","typeOfStateId":"state","$connId":"con_388","$id":"bc48ea37-4d95-41b5-b713-f1317e571aec","conditions":[{"source":"context","comparison":"equals","values":["zero"],"variable":"qtdCartoes"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\t// const cartoesAtivo = cartoes.filter(cartao => cartao.situacao === \"A\" || cartao.situacao === \"P\")\n\t\treturn cartoes.filter(cartao => cartao.funcao !== 'D' && Number(cartao.valorLimite) > 0 && cartao.titular == true)\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\tif(qtdCartoes == 0){\n\t\t\treturn 'zero'\n\t\t}\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"a2a360be-2aa9-460d-8da9-64c717044182","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusDadosCartao}} | {{bodyDadosCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6bbef97c-8c9d-4741-9603-028a9832f4d2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0144be7e-0581-4a12-a05e-4c86462b54ad","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-0dae0e00-cb57-4d08-9120-0de6edc8f325","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4b056c54-8b78-47f7-a632-a5c1e959642f","root":false,"$title":"[FC.1.0.0] possui cartao?","$position":{"top":"790.765px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d1bca5c2-5488-439f-82e8-608821b7f9ff":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3688cb85-f2ae-4c26-baf0-1822644c1820","typeOfStateId":"state","$connId":"con_393","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n      platform = 'blipchat';\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `Notei que você tem mais de um cartão.\nDe qual você precisa da fatura?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        options.push(`${cartao.nomePortador.split(' ')[0]} - Final ${cartao.numero}`);\n    });\n   cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0,6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        description.push(`${cartaoInfo[0].nomeComercial}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n  let words = text.split(\" \");\n\n  words = words.map(\n    (word) =>\n      word.length &&\n      `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n  );\n\n  return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"62544c3d-12b0-4d22-9ed5-33000a9a8f28","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1c2bed80-bb51-4757-ae4e-e90c667013eb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-50b5fb13-d43e-4f26-ab88-96ef98f33ab4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b0597046-4f63-45c3-a530-e1c2a94f9344","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b8d29ec8-3408-4a31-b63a-2d4ae8ec6554","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"d1bca5c2-5488-439f-82e8-608821b7f9ff","root":false,"$title":"[FC.1.0.1] + 1 cartao","$position":{"top":"886px","left":"6015px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e566e5e8-7dab-4252-8c8c-fd6e994b3d92":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4b056c54-8b78-47f7-a632-a5c1e959642f","typeOfStateId":"state","$connId":"con_398","$id":"1363c31e-c9dd-4e99-9070-50ed442caec6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"4b056c54-8b78-47f7-a632-a5c1e959642f","typeOfStateId":"state","$connId":"con_403","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"17352244-c34b-44ff-a559-ffda621952ba","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"0a9d3079-e348-4c6c-9bc7-428f6e0b3333","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e71dd334-4838-41df-affc-bf88fca6f53b","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"1b108629-49d4-40f9-9aa7-fbb79b3474fa","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_FATURA_CARTAO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"088bf1e0-a005-4875-9ca8-4f36d0a3c8a3","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c779e54e-1343-400a-9ea8-c4fac4c0f108","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8ccf8188-7fc3-4e37-a2dc-60bfde4ea9c0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1f4514c7-9012-44ff-9db6-9b5e50ca86ad","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"e566e5e8-7dab-4252-8c8c-fd6e994b3d92","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"614px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3688cb85-f2ae-4c26-baf0-1822644c1820":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"144e0deb-79c9-41b2-bff3-47c22a4af2de","typeOfStateId":"state","$connId":"con_408","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6b2f2d43-66e8-4099-989b-20eedff16f3a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6673bc10-0a2e-41ff-9ac9-d34aada02772","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-223c4f77-6709-498f-b0ae-ef78bf078901","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3688cb85-f2ae-4c26-baf0-1822644c1820","root":false,"$title":"[FC.1.0.3] dados cartao","$position":{"top":"975px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"144e0deb-79c9-41b2-bff3-47c22a4af2de":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0fb360e7-1896-439a-b583-1c0e36cce25a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","typeOfStateId":"state","$connId":"con_413","$id":"225bb4e1-4530-4aa0-b0ad-bedaa597fee0","conditions":[{"source":"context","comparison":"equals","values":["erro"],"variable":"faturasFechada"}],"$invalid":false},{"stateId":"45680e8a-4388-4d90-a3f1-f4d6c08701cd","typeOfStateId":"state","$connId":"con_418","$id":"30b3da72-e4c4-4f0b-8a48-f21f4fa1c2e9","conditions":[{"source":"context","comparison":"equals","values":["nao existe faturas fechada"],"variable":"faturasFechada"}],"$invalid":false},{"stateId":"80599c19-a325-43df-83d3-ea28215148be","typeOfStateId":"state","$connId":"con_423","$id":"f665beb3-a11e-4b58-bba0-f768e6b7dd7f","conditions":[{"source":"context","comparison":"notEquals","values":["nao existe faturas fechada"],"variable":"faturasFechada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9b85f98f-ec30-434c-87cf-1bf3d6a9a0e5","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6f17324f-3f33-4eb9-b2ab-a72f3e602e5a","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b6fdb7e-4c3e-4e01-97ce-c614b16d9b8a","$typeOfContent":"","type":"ProcessHttp","$title":"GET Fatura \"responseFatura\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"{{random.guid}}","Safra-Aplicacao":"CHT","Authorization":"Bearer {{token}}","Safra-Bot-ID":"skillautenticacao"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes/{{finalCartao}}/faturas?view=RESUMOS","responseStatusVariable":"statusFatura","responseBodyVariable":"responseFatura"},"conditions":[]},{"$id":"bf56aaa1-fb47-4ae7-992e-43cb5ec17046","$typeOfContent":"","type":"ExecuteScript","$title":"faturasFechada","$invalid":false,"settings":{"function":"run","source":"const run = (faturas) => {\n\ttry {\n\t\tfaturas = JSON.parse(faturas).data.faturas\n        const seisMesesAtras = new Date(new Date().setMonth(new Date().getMonth() - 6))\n\t\tconst faturasFechada = faturas.filter(fatura => fatura.status == \"Fechado\" && new Date(fatura.dataVencimento) >= seisMesesAtras)\n\t\tif (faturasFechada.length == 0) return 'nao existe faturas fechada'\n\t\treturn faturasFechada.map(fatura => {\n\t\t\tfatura.valor = formatValue(fatura.valor)\n\t\t\treturn fatura\n\t\t})\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}\n\nfunction formatValue(valor) {\n\treturn `${\n\t\tparseFloat(valor)\n\t\t\t.toFixed(2)\n\t\t\t.replace(\".\", \",\")\n\t\t\t.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")}`;\n}","inputVariables":["responseFatura"],"outputVariable":"faturasFechada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"26d10741-7014-4f81-a98d-68dde4652890","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"087498d5-aad6-4668-8a43-edc1135740ae","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusFatura}} | {{responseFatura}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-131fb84f-b773-4062-83c5-7da6712ec4cd","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-00c2e5dc-9bac-4ed8-9d7d-9539c28f0c6c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b00de35c-98ce-4775-8e20-94c13ac11427","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"144e0deb-79c9-41b2-bff3-47c22a4af2de","root":false,"$title":"[FC.2.0.0] possui fatura?","$position":{"top":"1160px","left":"5773px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"45680e8a-4388-4d90-a3f1-f4d6c08701cd":{"$contentActions":[{"action":{"$id":"5e147fde-6a29-4758-82e1-93ec825b157c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2c8ce3f9-c264-4de6-a3ac-a57ee7118188","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2c8ce3f9-c264-4de6-a3ac-a57ee7118188","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"277d0e7c-c947-466b-af33-5a9ee04092ba","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d68780e3-5431-40cd-b656-57b28fc585f1","type":"text/plain","content":"O seu cartão com final *{{finalCartao}}* não tem faturas fechadas. Assim que a sua fatura fechar, você vai conseguir ver as informações aqui.","metadata":{}},"$cardContent":{"document":{"id":"d68780e3-5431-40cd-b656-57b28fc585f1","type":"text/plain","content":"O seu cartão com final *{{finalCartao}}* não tem faturas fechadas. Assim que a sua fatura fechar, você vai conseguir ver as informações aqui."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"135e3ef2-d7db-4b3c-ac40-5c2dd381d677","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2217518e-2b6e-41f2-b4d6-e32d34f691e0","typeOfStateId":"state","$connId":"con_428","$id":"46a1a658-395b-458e-8833-0de30ffbb914","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"cb9daaf9-00f4-44d3-b12c-f3ffa46e6487","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b708b4d7-5166-4bf0-8192-dd1df982b78e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fa8a293e-37b7-430b-a0c4-37fc52251dbd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"45680e8a-4388-4d90-a3f1-f4d6c08701cd","root":false,"$title":"[FC.2.0.1] não possui fatura fechada","$position":{"top":"1148.67px","left":"5999.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"80599c19-a325-43df-83d3-ea28215148be":{"$contentActions":[{"action":{"$id":"11b1f560-1596-4c04-8c44-b59517b3ecf5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ee612725-185c-4810-824b-37e99ff764ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ee612725-185c-4810-824b-37e99ff764ad","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c90a002a-60b7-4da5-8ba6-e035539be126","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}\n"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c1deb80f-d9db-400e-9040-a19a687c2002","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3ebdf2d9-61e7-4334-b280-06466b167329","typeOfStateId":"state","$connId":"con_433","$id":"b6fdd9d4-4419-4e03-a78c-da2501297363","conditions":[{"source":"context","comparison":"notEquals","values":["erro"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"48d58e13-cf0b-4933-a032-c57dcbb714da","$typeOfContent":"","type":"ExecuteScript","$title":"Build Menu","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, faturas) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\")\n        platform = 'blipchat';\n    \n    faturas = JSON.parse(faturas)\n\n    const meses = {\n        \"01\": \"Janeiro\",\n        \"02\": \"Fevereiro\",\n        \"03\": \"Março\",\n        \"04\": \"Abril\",\n        \"05\": \"Maio\",\n        \"06\": \"Junho\",\n        \"07\": \"Julho\",\n        \"08\": \"Agosto\",\n        \"09\": \"Setembro\",\n        \"10\": \"Outubro\",\n        \"11\": \"Novembro\",\n        \"12\": \"Dezembro\"\n    }\n\n    const text = `Você quer acessar a fatura de qual mês?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    faturas.forEach((fatura, index) => {\n        const mes = fatura.dataVencimento.split(\"-\")[1]\n        const mesExtenso = meses[mes]\n        options.push(`${mesExtenso} - R$ ${fatura.valor}`);\n    });\n    faturas.forEach((fatura, index) => {\n        const data = fatura.dataVencimento.split(\"-\")\n        const dia = data[2]\n        const mes = data[1]\n        const ano = data[0]\n        description.push(`Vencimento - ${dia}/${mes}/${ano}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n    let words = text.split(\" \");\n\n    words = words.map(\n        (word) =>\n            word.length &&\n            `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n    );\n\n    return words.join(\" \");\n}","inputVariables":["bold","platform","faturasFechada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3411f1d-a156-4140-a5ef-21fe40832e3b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"08b2f556-9a69-4019-b10b-16e5587c9d02","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (faturas, input) => {\n\ttry {\n\t\tfaturas = JSON.parse(faturas)\n\t\tinput = JSON.parse(input)\n\t\tconst indexFatura = input.metadata[\"#wa.interactive.list.id\"] - 1;\n\t\tconst faturaEscolhida = faturas[indexFatura]\n\t\tif (faturaEscolhida) {\n\t\t\treturn faturaEscolhida\n\t\t}\n\t\treturn \"erro\"\n\t} catch (err) {\n\t\treturn \"erro\"\n\t}\n}","inputVariables":["faturasFechada","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1a4f5526-dd09-4327-9135-86f941aae5a9","$typeOfContent":"","type":"ExecuteScript","$title":"dataVencimento","$invalid":false,"settings":{"function":"run","source":"const run = (userInput) => {\n\ttry {\n\t\tuserInput = JSON.parse(userInput)\n\n\t\treturn userInput.dataVencimento\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["userInput"],"outputVariable":"dataVencimento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f5019cb-ac7c-48ce-88a7-d52057f681dd","$typeOfContent":"","type":"ExecuteScript","$title":"mesFatura","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n\treturn input.split('-')[0]\n}","inputVariables":["input.content"],"outputVariable":"mesFatura","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9422368-072a-4003-80a8-c36042de2890","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-96439768-e53b-4a7b-92df-8231e6a5b831","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-52885ab0-8612-4453-8fa9-fefdc1b165db","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-23fe484a-0c2a-40b2-b2c7-abc2eb996585","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"80599c19-a325-43df-83d3-ea28215148be","root":false,"$title":"[FC.2.0.2] menu selecao de fatura","$position":{"top":"1299px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2e88b5e4-f472-4ace-a610-20adec4364f4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","root":false,"$title":"[GO TO] transbordo employee","$position":{"top":"1280px","left":"5481px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3ebdf2d9-61e7-4334-b280-06466b167329":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"47048efa-3fc8-477e-bb3b-25d37c711e1e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e70e2e4-54e8-4272-bf41-56419b681b7e","typeOfStateId":"state","$connId":"con_438","$id":"cdaa5fc2-a0ed-4cf0-8826-e869a8be14ed","conditions":[{"source":"context","comparison":"contains","values":["200","202","204"],"variable":"statusPDF"}],"$invalid":false},{"stateId":"9158bebc-53e8-4ff5-9953-0c2baa5bb7ee","typeOfStateId":"state","$connId":"con_443","$id":"71ee4b6f-3d5e-4d2f-a275-5a12cb5d437a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0b5e9fbc-6151-4992-b24e-551155e1a2ff","$typeOfContent":"","type":"ProcessHttp","$title":"POST send PDF \"responsePDF\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"5d6a5c8a-e5a5-486d-835a-6dd13ac241bd","Safra-Aplicacao":"CHT","Safra-Bot-ID":"skillautenticacao","Content-Type":"application/json","Authorization":"Bearer {{token}}"},"method":"POST","body":"{\n  \"tipoPessoa\": \"F\",\n  \"documento\": \"{{document}}\",\n  \"numeroCartao\": \"{{finalCartao}}\",\n  \"dataVencimento\": \"{{dataVencimento}}\",\n  \"agencia\": \"{{agency}}\",\n  \"conta\": \"{{account}}\"\n}","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/faturas/enviar","responseStatusVariable":"statusPDF","responseBodyVariable":"responsePDF"},"conditions":[]},{"$id":"d5013813-9608-4790-af1e-0e7abe0181cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9becfc47-bf33-42eb-ab81-8d81b02e6751","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a4ae9a59-668e-4c85-b7c1-51499c1f094c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"3ebdf2d9-61e7-4334-b280-06466b167329","root":false,"$title":"[FC.2.0.3][HTTP] envia pdf","$position":{"top":"1443px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e70e2e4-54e8-4272-bf41-56419b681b7e":{"$contentActions":[{"action":{"$id":"674a9397-12c2-413b-98f7-ef616a568cfe","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7d7a9e15-fa7e-4501-8448-bb382e07aa95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7d7a9e15-fa7e-4501-8448-bb382e07aa95","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"26c903a9-190b-4a52-b6a5-64981ed2d92d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f86a0d95-f15a-43a6-bf66-9fd00a2e194f","type":"text/plain","content":"Acabei de enviar no seu e-mail o PDF da fatura fechada de {{mesFatura}}","metadata":{}},"$cardContent":{"document":{"id":"f86a0d95-f15a-43a6-bf66-9fd00a2e194f","type":"text/plain","content":"Acabei de enviar no seu e-mail o PDF da fatura fechada de {{mesFatura}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"5881d756-8534-4084-9875-e1f6c63de59f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c9ab8a87-8c98-4058-88df-2f6fa26200b3","typeOfStateId":"state","$connId":"con_448","$id":"5bb0d7b6-8f35-4aad-9812-a94817b0f748","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"50a7c80c-6045-49a4-9e64-0be1eb0d6996","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3f179c7f-6b88-4f99-b59d-b69533fc3773","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-097196b0-5eb0-4670-97f9-8de28af7bac5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e70e2e4-54e8-4272-bf41-56419b681b7e","root":false,"$title":"[FC.2.0.4][MSG] envio email","$position":{"top":"1577px","left":"5771px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c9ab8a87-8c98-4058-88df-2f6fa26200b3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"799558ff-6be8-422c-a251-c0045bf39e1f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c9ab8a87-8c98-4058-88df-2f6fa26200b3","root":false,"$title":"[GO TO] Algo Mais","$position":{"top":"1718px","left":"5772px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0abed19b-40e3-454c-bed3-c97f190fd32a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7d4600a3-efdf-4eda-932e-b183cef0a4cf","type":"text/plain","textContent":"Entrada do usuário","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5cd53ec9-66e0-4e7f-923b-f0072f05053c","$typeOfContent":"","type":"ExecuteScript","$title":"bodycartao","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn {\n    \"data\": [\n        {\n            \"nomePortador\": \"LUCAS LOPES\",\n            \"descricao\": \"CARTAO SAFRA VISA\",\n            \"funcao\": \"C\",\n            \"numero\": \"8015\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": true,\n            \"codigoSegmento\": \"0\",\n            \"dataEmbossamento\": \"2022-09-12\",\n            \"status\": \" \",\n            \"codigoTipo\": \"0270\",\n            \"codigoCorTipo\": \"00\",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \"M\",\n            \"diaCiclo\": \"26\",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 17400,\n            \"numeroConta\": \"4732700050728007\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 17400,\n            \"idProcessadora\": \"00000000\",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \" \"\n        },\n        {\n            \"nomePortador\": \"LUCAS LOPES\",\n            \"descricao\": \"CARTAO BANCARIO SAFRA VISA ELECTRON\",\n            \"funcao\": \"D\",\n            \"numero\": \"6119\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": true,\n            \"codigoSegmento\": \"0\",\n            \"dataEmbossamento\": \"2023-10-24\",\n            \"status\": \" \",\n            \"codigoTipo\": \"0018\",\n            \"codigoCorTipo\": \"18\",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \"M\",\n            \"diaCiclo\": \"00\",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 0,\n            \"numeroConta\": \"4790180490326002\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 0,\n            \"idProcessadora\": \"00000000\",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \" \"\n        },\n        {\n            \"nomePortador\": \"CAMILA PORTO LOPES\",\n            \"descricao\": \"CARTAO SAFRA VISA\",\n            \"funcao\": \"C\",\n            \"numero\": \"8049\",\n            \"situacao\": \"A\",\n            \"bandeira\": \"V\",\n            \"titular\": false,\n            \"codigoSegmento\": \" \",\n            \"dataEmbossamento\": \" \",\n            \"status\": \" \",\n            \"codigoTipo\": \"0270\",\n            \"codigoCorTipo\": \" \",\n            \"motivoCancelamento\": \" \",\n            \"sexoPortador\": \" \",\n            \"diaCiclo\": \" \",\n            \"debitoAutomatico\": false,\n            \"valorLimite\": 17400,\n            \"numeroConta\": \"4732700050728007\",\n            \"codigoExibicao\": \"1\",\n            \"valorLimitePreAprovado\": 0,\n            \"idProcessadora\": \" \",\n            \"ofertaCartao\": false,\n            \"ordemExibicao\": 0,\n            \"cpfAdicional\": \"43699400875\"\n        }\n    ]\n}\n}\n\nvar obj = {\n    \"data\": {\n        \"numeroCartao\": \"3010\",\n        \"valorLimiteTotal\": 7500,\n        \"valorLimiteDisponivel\": 7319,\n        \"valorLimiteUtilizado\": 181,\n        \"limiteAutomatico\": true,\n        \"faturas\": [\n            {\n                \"dataVencimento\": \"2024-11-26\",\n                \"valor\": 180.81,\n                \"status\": \"Aberta\",\n                \"sequencia\": \"00\"\n            },\n            {\n                \"dataVencimento\": \"2024-10-26\",\n                \"valor\": 215.77,\n                \"status\": \"Fechado\",\n                \"sequencia\": \"01\"\n            },\n            {\n                \"dataVencimento\": \"2024-09-26\",\n                \"valor\": 341.73,\n                \"status\": \"Fechado\",\n                \"sequencia\": \"02\"\n            },\n            {\n                \"dataVencimento\": \"2024-08-26\",\n                \"valor\": 140.64,\n                \"status\": \"Fechado\",\n                \"sequencia\": \"03\"\n            }\n        ]\n    }\n}","inputVariables":[],"outputVariable":"bodycartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8c5031e3-be72-4445-9552-dda221b2dedd","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn [\n    {\n        \"nomePortador\": \"LUCAS LOPES\",\n        \"descricao\": \"CARTAO SAFRA VISA\",\n        \"funcao\": \"C\",\n        \"numero\": \"8015\",\n        \"situacao\": \"A\",\n        \"bandeira\": \"V\",\n        \"titular\": true,\n        \"codigoSegmento\": \"0\",\n        \"dataEmbossamento\": \"2022-09-12\",\n        \"status\": \" \",\n        \"codigoTipo\": \"0270\",\n        \"codigoCorTipo\": \"00\",\n        \"motivoCancelamento\": \" \",\n        \"sexoPortador\": \"M\",\n        \"diaCiclo\": \"26\",\n        \"debitoAutomatico\": false,\n        \"valorLimite\": 17400,\n        \"numeroConta\": \"4732700050728007\",\n        \"codigoExibicao\": \"1\",\n        \"valorLimitePreAprovado\": 17400,\n        \"idProcessadora\": \"00000000\",\n        \"ofertaCartao\": false,\n        \"ordemExibicao\": 0,\n        \"cpfAdicional\": \" \"\n    }\n]\n}","inputVariables":[],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ddd93942-3184-493c-a953-416276885684","$typeOfContent":"","type":"ExecuteScript","$title":"MESSA DO FLOW","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(inputVariable1, inputVariable2) {\n\treturn {\n    \"type\": \"text/plain\",\n    \"content\": \"Sent\",\n    \"id\": \"wamid.HBgMNTUzMTc1NzA1NzQ3FQIAEhgUM0FENEJEMTAzRjk3OTdGNjFCQTcA\",\n    \"from\": \"b21081ce-d810-4532-83df-e2cb263aad0b@tunnel.msging.net\",\n    \"to\": \"skillautenticacao@msging.net\",\n    \"metadata\": {\n        \"#wa.timestamp\": \"1730752157\",\n        \"#wa.context.from\": \"551126509914\",\n        \"#wa.context.id\": \"wamid.HBgMNTUzMTc1NzA1NzQ3FQIAERgSRDlFMUIyQTI5OTFFQUQyQkMwAA==\",\n        \"#wa.context.group_id\": null,\n        \"#wa.forwarded\": null,\n        \"#wa.frequently_forwarded\": null,\n        \"#wa.interactive.nfm_reply.json_response\": \"{\\\"dataFim\\\":\\\"2025-11-04\\\",\\\"continente\\\":\\\"Europa\\\",\\\"flow_token\\\":\\\"a35e4ce8-476a-4fda-a725-5930bd44e929\\\",\\\"dataInicio\\\":\\\"2024-11-04\\\"}\",\n        \"traceparent\": \"00-2fe2f501110b32c14d685d5a8b5879a5-52ded3c4a5306f2a-01\",\n        \"#inReplyToId\": \"wamid.HBgMNTUzMTc1NzA1NzQ3FQIAERgSRDlFMUIyQTI5OTFFQUQyQkMwAA==\",\n        \"#messageReferenceInternalID\": \"0f8c0c13-6f4a-4845-bbbd-c2ca4005e71f\",\n        \"#uniqueId\": \"175c18df-8b60-4fb8-a0ac-9b726e570a50\",\n        \"#date_processed\": \"1730752158220\",\n        \"date_created\": \"1730752158162\",\n        \"#tunnel.owner\": \"router060924yinthpksk0mi9wm7u@msging.net\",\n        \"#tunnel.originator\": \"5531975705747@wa.gw.msging.net\",\n        \"#tunnel.originalFrom\": \"router060924yinthpksk0mi9wm7u@msging.net/msging-application-router-hosting-enterprise-797cd44d95-phj4q\",\n        \"#tunnel.originalTo\": \"skillautenticacao%40msging.net@tunnel.msging.net/5531975705747%40wa.gw.msging.net\",\n        \"#replyContent\": \"{\\\"replied\\\":{\\\"type\\\":\\\"text/plain\\\",\\\"value\\\":\\\"Sent\\\"},\\\"inReplyTo\\\":{\\\"id\\\":\\\"f37a78c6-0659-4d8d-8683-d66b97191461\\\",\\\"type\\\":\\\"application/json\\\",\\\"value\\\":{\\\"recipient_type\\\":\\\"individual\\\",\\\"messaging_product\\\":\\\"whatsapp\\\",\\\"type\\\":\\\"interactive\\\",\\\"interactive\\\":{\\\"type\\\":\\\"flow\\\",\\\"body\\\":{\\\"text\\\":\\\"Preciso de algumas informações da sua viagem. \\\\nÉ só tocar no botão abaixo.\\\"},\\\"action\\\":{\\\"name\\\":\\\"flow\\\",\\\"parameters\\\":{\\\"mode\\\":\\\"draft\\\",\\\"flow_message_version\\\":\\\"3\\\",\\\"flow_token\\\":\\\"a35e4ce8-476a-4fda-a725-5930bd44e929\\\",\\\"flow_id\\\":\\\"1169605027966468\\\",\\\"flow_cta\\\":\\\"Adicionar informações\\\",\\\"flow_action\\\":\\\"navigate\\\",\\\"flow_action_payload\\\":{\\\"screen\\\":\\\"INCLUIR_APENAS_UM_CARTAO\\\",\\\"data\\\":{\\\"textoCartaoUnico\\\":\\\"💳 Vou usar na viagem o cartão final: 7116\\\",\\\"dataInicioMinDate\\\":\\\"2024-11-04\\\",\\\"dataFimMinDate\\\":\\\"2025-11-04\\\"}}}}}},\\\"direction\\\":\\\"sent\\\"}}\"\n    }\n}\n}","inputVariables":[],"outputVariable":"res","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a29777eb-f017-4dbb-8c55-78e3c99c2ae6","$typeOfContent":"","type":"ExecuteScript","$title":"MOCK CCL (FOR DEVELOPERS NUMBERS ONLY)","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run() {\n\treturn {\n\t\t\"data\": {\n\t\t\t\"tipoPessoa\": \"F\",\n\t\t\t\"baseDocumento\": \"651208730\",\n\t\t\t\"digitosVerificadoresDocumento\": \"57\",\n\t\t\t\"filialCnpj\": \"0000\",\n\t\t\t\"codigo\": \"000058232\",\n\t\t\t\"nome\": \"MOCKFLUXOBLIP NO FLUXO\",\n\t\t\t\"nomeExterno\": \"MOCKFLUXOBLIP NO FLUXO\",\n\t\t\t\"nomeReduzidoCartao\": \"\",\n\t\t\t\"nomeMae\": \"FARIDE CATTAN\",\n\t\t\t\"email\": \"LUCASLOPES@SAFRA.COM.BR\",\n\t\t\t\"endereco\": {\n\t\t\t\t\"logradouro\": \"R CDOR ARAUJO\",\n\t\t\t\t\"numero\": \"143\",\n\t\t\t\t\"complemento\": \"SL 111 112\",\n\t\t\t\t\"bairro\": \"CENTRO\",\n\t\t\t\t\"cidade\": \"CURITIBA\",\n\t\t\t\t\"estado\": \"PR\",\n\t\t\t\t\"cep\": \"80420900\",\n\t\t\t\t\"pais\": \"BRASIL\",\n\t\t\t\t\"correspondencia\": \"R CDOR ARAUJO 143 SL 111 112\"\n\t\t\t},\n\t\t\t\"numeroTelefone\": {\n\t\t\t\t\"ddi\": \"0000\",\n\t\t\t\t\"ddd\": \"0029\",\n\t\t\t\t\"numero\": \"099376395\",\n\t\t\t\t\"ramal\": \"0000\"\n\t\t\t},\n\t\t\t\"numeroCelular\": {\n\t\t\t\t\"ddd\": \"0011\",\n\t\t\t\t\"numero\": \"973806326\"\n\t\t\t},\n\t\t\t\"documento\": {\n\t\t\t\t\"codigoTipo\": \"0001\",\n\t\t\t\t\"numero\": \"65120873057\",\n\t\t\t\t\"dataExpedicao\": \"2001-05-21\",\n\t\t\t\t\"orgaoExpedidor\": \"SSP   \"\n\t\t\t},\n\t\t\t\"codigoCampanhaAdesao\": \"005\",\n\t\t\t\"descricaoCampanhaAdesao\": \"PDD/CRELI\",\n\t\t\t\"dataInclusao\": \"1994-02-20\",\n\t\t\t\"dataAlteracao\": \"2022-04-04\",\n\t\t\t\"usuarioAlteracao\": \"PRODAT2 \",\n\t\t\t\"codigoStatus\": \"0001\",\n\t\t\t\"descricaoStatus\": \"CLIENTE PENDENTE DE APROVACAO\",\n\t\t\t\"codigoSituacao\": \" \",\n\t\t\t\"descricaoSituacao\": \"CLIENTE PENDENTE DE APROVACAO\",\n\t\t\t\"indicadorResidentePais\": true,\n\t\t\t\"indicadorEstrangeiro\": false,\n\t\t\t\"codigoSituacaoReceitaFederal\": \"ATI\",\n\t\t\t\"dataPesquisaReceitaFederal\": \"2022-10-13\",\n\t\t\t\"nomeFantasia\": \"                    \",\n\t\t\t\"dataNascimento\": \"1940-05-13\",\n\t\t\t\"sexo\": \"F\",\n\t\t\t\"renda\": 3762.05\n\t\t}\n\t}\n}\n\nlet dadosLucas = {\n    \"data\": {\n        \"tipoPessoa\": \"F\",\n        \"baseDocumento\": \"107506738\",\n        \"digitosVerificadoresDocumento\": \"34\",\n        \"filialCnpj\": \"0000\",\n        \"codigo\": \"000043153\",\n        \"nome\": \"JANETE CATTAN SAYEG\",\n        \"nomeExterno\": \"JANETE CATTAN SAYEG\",\n        \"nomeReduzidoCartao\": \"\",\n        \"nomeMae\": \"FARIDE CATTAN\",\n        \"email\": \"LUCASLOPES@SAFRA.COM.BR\",\n        \"endereco\": {\n            \"logradouro\": \"R CDOR ARAUJO\",\n            \"numero\": \"143\",\n            \"complemento\": \"SL 111 112\",\n            \"bairro\": \"CENTRO\",\n            \"cidade\": \"CURITIBA\",\n            \"estado\": \"PR\",\n            \"cep\": \"80420900\",\n            \"pais\": \"BRASIL\",\n            \"correspondencia\": \"R CDOR ARAUJO 143 SL 111 112\"\n        },\n        \"numeroTelefone\": {\n            \"ddi\": \"0000\",\n            \"ddd\": \"0029\",\n            \"numero\": \"099376395\",\n            \"ramal\": \"0000\"\n        },\n        \"numeroCelular\": {\n            \"ddd\": \"0011\",\n            \"numero\": \"973806326\"\n        },\n        \"documento\": {\n            \"codigoTipo\": \"0001\",\n            \"numero\": \"34275678\",\n            \"dataExpedicao\": \"2001-05-21\",\n            \"orgaoExpedidor\": \"SSP   \"\n        },\n        \"codigoCampanhaAdesao\": \"005\",\n        \"descricaoCampanhaAdesao\": \"PDD/CRELI\",\n        \"dataInclusao\": \"1994-02-20\",\n        \"dataAlteracao\": \"2022-04-04\",\n        \"usuarioAlteracao\": \"PRODAT2 \",\n        \"codigoStatus\": \"0001\",\n        \"descricaoStatus\": \"CLIENTE PENDENTE DE APROVACAO\",\n        \"codigoSituacao\": \" \",\n        \"descricaoSituacao\": \"CLIENTE PENDENTE DE APROVACAO\",\n        \"indicadorResidentePais\": true,\n        \"indicadorEstrangeiro\": false,\n        \"codigoSituacaoReceitaFederal\": \"ATI\",\n        \"dataPesquisaReceitaFederal\": \"2022-10-13\",\n        \"nomeFantasia\": \"                    \",\n        \"dataNascimento\": \"1940-05-13\",\n        \"sexo\": \"F\",\n        \"renda\": 3762.05\n    }\n}","inputVariables":[],"outputVariable":"responseTelIdent","LocalTimeZoneEnabled":false},"conditions":[{"values":["5531975705747"],"source":"context","comparison":"contains","variable":"contact.identity"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c9c5f116-ba73-4a7d-a2f1-28a23e570008","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"0abed19b-40e3-454c-bed3-c97f190fd32a","root":false,"$title":"19.11 15H","$position":{"top":"121px","left":"442px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"commentsIdList":["6d0f89c4-1a0f-40dc-ad21-629081da0e65"]}},"127757c2-0404-4ee1-887c-6b60d71a3a77":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0d31d7ba-ad81-4fbf-b835-8342e8f8f93e","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e92decba-2f27-4b5b-a0ec-c761214c6811","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"127757c2-0404-4ee1-887c-6b60d71a3a77","root":false,"$title":"[GO TO] Pos Invest","$position":{"top":"3081.33px","left":"866px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1376549f-3a8a-4f11-869e-1960f295a5ef":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6968e527-191a-4e18-a2d4-29bb29a4d1b8","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2d885fd9-7dbf-47e0-b08a-9a85d15d5d9a","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1376549f-3a8a-4f11-869e-1960f295a5ef","root":false,"$title":"[GO TO] Extrato","$position":{"top":"3086.67px","left":"1051.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5064a085-443c-419b-b25e-b6ffa7059ce0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","typeOfStateId":"state","$connId":"con_453","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","typeOfStateId":"state","$connId":"con_458","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_POSICAO_INVESTIMENTOS\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a05bf992-cec5-475a-86ea-e9cf01039f01","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-57c5009b-71e8-4017-9ffd-47facd77e321","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-93945edd-ff81-4a81-a8d6-4d474d1e1653","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5064a085-443c-419b-b25e-b6ffa7059ce0","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"419px","left":"4308.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer que eu envie um documento com a posição atual dos seus investimentos?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b6390f47-bc7b-4c7a-9d19-4218a060ca2e","typeOfStateId":"state","$connId":"con_463","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-34b6aab3-fc37-4bea-bd29-8aae3bd5c183","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-022a1098-a6bc-4994-ba94-d1a41031541d","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-018cfbfb-b0fb-4c91-a892-fd6459d995ea","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d1bb5d6e-926a-4a69-b0b0-dc22273e3e8b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6a99a387-8e28-4c10-8f5f-cc76c6ca3d51","root":false,"$title":"[PI.1.0.0][MSG] Inicio Posicao Investimento","$position":{"top":"579px","left":"4308.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5aba1012-65f4-4562-9aa9-419d0b772741":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_468","$id":"ac43fe69-3261-440c-b31c-b0487bbf3412","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"a35fa267-f2b7-4298-83d9-b0924114e971","typeOfStateId":"state","$connId":"con_473","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_EXTRATO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ff763fae-5618-4ec7-be1f-805eced6be10","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ab41b3d8-ddff-4373-9d62-d24f11542ba7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8868acfe-0650-4004-8f39-9cc6c15fe72a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"5aba1012-65f4-4562-9aa9-419d0b772741","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"615px","left":"3294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"36730683-8874-4b01-af50-a78da194c2d1":{"$contentActions":[{"action":{"$id":"e10d710c-6594-4765-934f-318f3b430de7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1e96f9d6-a837-4f98-a24c-1f8ce4b090ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1e96f9d6-a837-4f98-a24c-1f8ce4b090ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"791c5e88-1c1c-46bd-b39a-32c6db5612c0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a20261cc-8e37-41aa-bcf9-45e4702d018d","type":"text/plain","content":"Não consegui encontrar nenhum histórico de posição de investimento.","metadata":{}},"$cardContent":{"document":{"id":"a20261cc-8e37-41aa-bcf9-45e4702d018d","type":"text/plain","content":"Não consegui encontrar nenhum histórico de posição de investimento."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"99a60ed7-9825-4e76-8c67-4495e4c58979","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40031b2e-8dc1-4e09-8e1f-b1e813ef5c6e","typeOfStateId":"state","$connId":"con_478","$id":"fe88d63f-39a3-4b38-8086-c26256ee2bff","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"fa916ccc-3cb7-453e-a856-9438ed25754e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-559dd47b-229d-4e75-a4a1-0cfbdc94fb10","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ac335113-e2a3-40f7-b8aa-4c144cf1187f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"36730683-8874-4b01-af50-a78da194c2d1","root":false,"$title":"[PI.3.1.3][MSG] Não Encontrou","$position":{"top":"1322px","left":"4490.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3f739f15-0056-45e3-89b4-29d2ae4d3efa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2f815a99-f5ce-4b32-88b8-ffbb00e96f20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3f739f15-0056-45e3-89b4-29d2ae4d3efa","root":false,"$title":"[GO TO]Employee Finalizacao","$position":{"top":"1279.33px","left":"1581px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b6390f47-bc7b-4c7a-9d19-4218a060ca2e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"15a79232-ef1a-4238-9477-382cae383baf","typeOfStateId":"state","$connId":"con_483","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b6ca16d6-f0e6-4ae6-904d-1ba236e2dd91","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd1f59e3-6920-4db3-8b8c-115ac292ae4b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ad183457-8440-4a58-9af0-11e7a62b8e57","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-2abb50a2-d5f3-4ae3-830e-298384095c6e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dc8889ed-358b-43a7-a93f-608e172448f5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b6390f47-bc7b-4c7a-9d19-4218a060ca2e","root":false,"$title":"[PI.1.0.0][INPUT] Inicio Posicao Investimento","$position":{"top":"761.5px","left":"4308.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5215041d-b5f5-49eb-895c-0648cc1546a1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76052a9b-f55c-4fd6-8ac8-da0510909330","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62aec317-124c-4a6f-8eb5-347b96526b10","typeOfStateId":"state","$connId":"con_488","$id":"d6317b53-b402-4aa0-af65-27b8293d6b92","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9491f50b-ca70-4363-8536-39a65005c827","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-20231455-a98b-491a-83d7-3099861151f2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5215041d-b5f5-49eb-895c-0648cc1546a1","root":false,"$title":"[PI.2.0.1]Não Possui Email","$position":{"top":"939px","left":"4545px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2217518e-2b6e-41f2-b4d6-e32d34f691e0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"428fa2de-56e5-430c-a2ce-ae1bf665af89","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2217518e-2b6e-41f2-b4d6-e32d34f691e0","root":false,"$title":"[GO TO] Te ajudo em algo mais ","$position":{"top":"1326px","left":"5999px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cdd34564-0396-44f2-a37d-978173c3889d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5bdb5b0d-6df3-4f4a-a41b-fd66aaa0f6d2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"257f1171-0297-4b48-8a1c-89a7959b201f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"cdd34564-0396-44f2-a37d-978173c3889d","root":false,"$title":"[GO TO] Em que posso ajudar? ","$position":{"top":"3079.67px","left":"287px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"329bc5fc-e554-4d1f-865b-1a858c603a5b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8a9602b1-d07e-43c2-9161-3649457eab05","typeOfStateId":"state","$connId":"con_493","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"329bc5fc-e554-4d1f-865b-1a858c603a5b","root":false,"$title":"[Inicio] Status de entrega (Tracking cartão)","$position":{"top":"481.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8a9602b1-d07e-43c2-9161-3649457eab05":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","typeOfStateId":"state","$connId":"con_498","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","typeOfStateId":"state","$connId":"con_503","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"CONSULTA_RASTREIO_CARTAO\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-538775d3-05ca-461f-ab5c-8e7baec55e40","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7d2dc00e-5cdb-4782-9f0c-b0de9278497b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-edc4a5fd-c2eb-4be2-9922-ec89f04a0a57","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"8a9602b1-d07e-43c2-9161-3649457eab05","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"669.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer acompanhar o status de entrega do cartão, certo?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você quer acompanhar o status de entrega do cartão, certo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a69b80a8-332b-4300-b3f4-728077b1e9e8","typeOfStateId":"state","$connId":"con_508","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"358c4d79-4df5-4017-ae25-c47880069f49","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} smalltalk\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} smalltalk","action":"{{input.content}} | {{SmallTalksIdentified}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5f4df5cb-a492-491c-a784-4d86d8e6d18e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-01bac2e4-0ae6-4df5-b273-b7465dc72f2c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-00e735ee-bdf4-4b12-a512-0409091a8ced","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-81253b9c-fff6-4f14-b3ec-8bab249e3d6c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6cc31866-9a48-45f5-8558-e02805dbfe84","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"eda8cf87-d9d9-4fb2-9871-1ed6b22e5a80","root":false,"$title":"[TC.1.0.0] Inicio Status Entrega Cartão","$position":{"top":"870.667px","left":"6778.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a69b80a8-332b-4300-b3f4-728077b1e9e8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2a9eb715-b6b9-44e9-97b3-e07e68158a77","typeOfStateId":"state","$connId":"con_513","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","typeOfStateId":"state","$connId":"con_518","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","typeOfStateId":"state","$connId":"con_523","$id":"cf47ca1d-f27f-44c8-ad64-3b14336dbd8a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4f03222c-f367-4c2c-b32e-04057918a290","$typeOfContent":"","type":"SetVariable","$title":"CLEAR qtdCartoes","$invalid":false,"settings":{"variable":"qtdCartoes"},"conditions":[]},{"$id":"ce913fdb-a682-48fc-a49d-d64da00eae80","$typeOfContent":"","type":"SetVariable","$title":"CLEAR cartoes","$invalid":false,"settings":{"variable":"cartoes"},"conditions":[]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"bbed172e-7f70-445d-9e02-a8280133b5fe","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\treturn cartoes.filter(cartao => cartao.situacao == 'P' || cartao.situacao == 'I')\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"5c4ec296-5e8f-4038-b038-9b923916cce3","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\tif(qtdCartoes == 0){\n\t\t\treturn 'zero'\n\t\t}\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"85861d9d-bb03-4c24-9c67-5424fe9e5cfb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusDadosCartao}} | {{bodyDadosCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd73d8e3-63e2-4a9a-b840-cb99249fe380","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f8531e3c-b725-4eb2-8edf-332f7293ed0d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-be063dbd-7e33-4d34-866f-3900d6b66240","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c0753c1a-e1fb-4382-8656-4097036c05e1","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"a69b80a8-332b-4300-b3f4-728077b1e9e8","root":false,"$title":"[TC.2.0.0] possui cartao?","$position":{"top":"1115px","left":"6778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2a9eb715-b6b9-44e9-97b3-e07e68158a77":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","typeOfStateId":"state","$connId":"con_528","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"891af007-b02b-499d-8e00-2110df18e241","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, bin) => {\n\ttry {\n\t\tlet { header, body, action } = menu(cartoes, bin);\n\t\treturn buildWhatsApp(header, body, action);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nconst buildWhatsApp = (header, body, action) => {\n\treturn {\n\t\t'type': 'application/json',\n\t\t'content': {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": header,\n\t\t\t\t\"body\": body,\n\t\t\t\t\"action\": action\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst menu = (cartoes, bin) => {\n\tbin = JSON.parse(bin)\n\tcartoes = JSON.parse(cartoes);\n\tlet options = [];\n\tlet description = []\n\tlet objOpcoes = [];\n\tcartoes.forEach((cartao, index) => {\n\t\tconst cartaoBin = cartao.numeroConta.substr(0, 6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n\t\tcartao.titular = cartao.titular ? \"Titular\" : \"Adicional\"\n\t\tobjOpcoes.push({\n\t\t\t\"id\": `${cartao.numero}`,\n\t\t\t\"title\": `${cartaoInfo[0].nomeComercial.substring(0, 24)}`,\n\t\t\t\"description\": `${cartao.nomePortador.split(' ')[0]} - ${cartao.titular} - Final ${cartao.numero}`\n\t\t})\n\t});\n\n\tlet textMenu = \"De qual cartão você quer ver o andamento da entrega?\"\n\treturn {\n\t\t\"body\": {\n\t\t\t\"text\": textMenu\n\t\t},\n\t\t\"action\": {\n\t\t\t\"button\": \"Escolher cartão\",\n\t\t\t\"sections\": [\n\t\t\t\t{\n\t\t\t\t\t\"rows\": objOpcoes\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n};","inputVariables":["cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3dee8925-bfa3-4088-b9ac-b42a1cb6711a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tconst jsonData = JSON.parse(input);\n\tinput = jsonData.metadata['#wa.interactive.list.id'];\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bf180ec7-8e85-4261-aae4-3991b2ba1ac8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2cb85042-b89f-4207-8900-4aac81adb69c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7af49510-4e2a-46cc-a2e1-71d9d51e7cfc","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6cb60ffa-5bca-4e15-b774-3430f52d5dae","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"2a9eb715-b6b9-44e9-97b3-e07e68158a77","root":false,"$title":"[TC.2.0.1] + 1 cartao","$position":{"top":"1256px","left":"6992.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1f4c4ef1-3207-4427-b309-8b8737f683db","typeOfStateId":"state","$connId":"con_533","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"815d152c-844b-4d3f-bb12-26b7453fb53d","$typeOfContent":"","type":"ExecuteScript","$title":"dadosCartao","$invalid":false,"settings":{"function":"run","source":"function run(cartoes, finalCartao, bin) {\n\ttry {\n\t\tlet data = JSON.parse(cartoes);\n\t\tbin = JSON.parse(bin);\n\t\tlet filteredData = data.filter(card => card.numero == finalCartao);\n\t\tfilteredData = filteredData.map(card => {\n\t\t\tswitch (card.funcao) {\n\t\t\t\tcase 'M':\n\t\t\t\t\tcard.funcao = 'débito e crédito';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tcard.funcao = 'débito';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'C':\n\t\t\t\t\tcard.funcao = 'crédito';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn card;\n\t\t});\n\n\t\tlet cartao = filteredData[0];\n\t\tlet cartaoBin = cartao.numeroConta.substr(0, 6)\n\t\tlet cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n\t\tcartao.descricao = `${cartaoInfo[0].nomeComercial}`;\n\t\treturn cartao;\n\n\t}\n\tcatch (error) {\n\t\treturn error.message;\n\t}\n}\n","inputVariables":["cartoes","finalCartao","resource.binNomesCartao"],"outputVariable":"dadosCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1259dd8a-a07b-4d3e-8329-7677e6986260","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3dba43e6-4789-4a70-9be8-11d43819438f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d45d2fb1-ede4-4372-b3f3-dd65407e64ff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"d7b2257e-b0e6-4fd7-80e4-2d9fd8339f79","root":false,"$title":"[TC.2.0.3] dados cartao","$position":{"top":"1337px","left":"6778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1f4c4ef1-3207-4427-b309-8b8737f683db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6a31ac9-d06c-4b92-a222-6828bdee783f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"f6d9f432-19f6-49f1-b611-9337a4410be1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ba80368d-d7c9-4705-ad98-dbbc1b490083","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"ba80368d-d7c9-4705-ad98-dbbc1b490083","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"3310b47e-0e8a-4aa2-9a40-835963200ff9","typeOfStateId":"state","$connId":"con_538","$id":"b88f49cd-b5ee-4710-864a-0527e80298de","conditions":[{"source":"context","comparison":"equals","values":["I"],"variable":"dadosCartao@situacao"}],"$invalid":false},{"stateId":"3310b47e-0e8a-4aa2-9a40-835963200ff9","typeOfStateId":"state","$connId":"con_543","$id":"34d05073-ad3d-4e49-8f9d-bcb16671cebd","conditions":[{"source":"context","comparison":"equals","values":["95"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"f59664df-7729-4589-81fb-7c048d04fb27","typeOfStateId":"state","$connId":"con_548","$id":"4197b936-bdad-4c22-ba6a-c97eb2ede938","conditions":[{"source":"context","comparison":"equals","values":["96"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"5716fc03-71b2-4648-a278-7f638cf06567","typeOfStateId":"state","$connId":"con_553","$id":"b364a870-e2e0-4132-a7e4-a56d03b8ea07","conditions":[{"source":"context","comparison":"equals","values":["98"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"ce332aaf-0e6e-4a29-9b7a-c2bae4f25909","typeOfStateId":"state","$connId":"con_558","$id":"809feec5-6d9c-4e9b-9c8d-f23001e62647","conditions":[{"source":"context","comparison":"equals","values":["91"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"7241083e-dc56-44e1-87ba-041f6c7b305b","typeOfStateId":"state","$connId":"con_563","$id":"00f41fd6-10e5-4df6-b293-cccb28c58bb0","conditions":[{"source":"context","comparison":"equals","values":["92"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"7cb8bd6b-f7b5-49c9-ad64-8696249dcf0f","typeOfStateId":"state","$connId":"con_568","$id":"a9efa47b-e705-4050-93bc-9d8eec16bc1d","conditions":[{"source":"context","comparison":"equals","values":["97","90","89"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"5d4d5550-6eed-4b47-838d-eee09a11e45d","typeOfStateId":"state","$connId":"con_573","$id":"c64fab22-0a52-4418-bfe5-04d520cc5c73","conditions":[{"source":"context","comparison":"equals","values":["93"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"5b6a08e9-04f6-41c0-b5e0-09c686d90de4","typeOfStateId":"state","$connId":"con_578","$id":"93f9918f-bcd9-45aa-b9e9-b9abe8c29e32","conditions":[{"source":"context","comparison":"equals","values":["94"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"83674938-6816-4e1a-a74b-3b7b5c7f6492","typeOfStateId":"state","$connId":"con_583","$id":"41c63b94-0b34-4865-961a-1f7139dc5222","conditions":[{"source":"context","comparison":"equals","values":["99"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"3db6d61b-3876-42ab-8dc8-9f9de25a369e","typeOfStateId":"state","$connId":"con_588","$id":"9d3985ec-886f-41ad-8a15-2635e5001dec","conditions":[{"source":"context","comparison":"equals","values":["88"],"variable":"ultimoCodigoRastreio"}],"$invalid":false},{"stateId":"821770d1-280a-41c6-9846-1e004ad37f12","typeOfStateId":"state","$connId":"con_593","$id":"23abef87-c881-42c4-a721-57478b43fd7d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c0fdf284-b11c-4a9d-8a89-94bc59c1cc91","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n//PRD: 5312b6d5-acb8-4165-9458-ef445876473e\n//HML: ee1f5004-2400-4ab1-9af7-d9168d517204\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9fe83c7a-a9a6-417c-9b3d-ab726c11859b","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"f99def29-777b-4d31-9423-50499e73c6ba","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80c455ba-c02a-432d-ab3d-8237ff30be4a","$typeOfContent":"","type":"ProcessHttp","$title":"dados rastreio cartao \"bodyRastreioCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes/{{finalCartao}}?view=RASTREIO","responseStatusVariable":"statusRastreioCartao","responseBodyVariable":"bodyRastreioCartao"},"conditions":[]},{"$id":"84baccad-0c9f-4f44-b0cb-24105a86424f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ultimoCodigoRastreio\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(response) {\n\ttry {\n\t\tresponse = JSON.parse(response);\n\t\tconst ultimoCodigoStatus = response.data.rastreio.slice(-1)[0].codigoStatus;\n\t\treturn ultimoCodigoStatus;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyRastreioCartao"],"outputVariable":"ultimoCodigoRastreio","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bf62e6f0-4809-497a-9f0a-bd4c7f587307","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"529cd89c-6e07-46a1-9b9a-17f0a907f92e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusRastreioCartao}} | {{bodyRastreioCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-255974a3-d59c-4a8c-a20b-d4e9e29bf701","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d0ede127-463a-4654-a112-bdcf4b326e2f","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-7412c0d2-230a-43a9-b8e4-89f82e384735","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d1c217d9-23d9-4113-8cd6-0e231fa7363f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1f4c4ef1-3207-4427-b309-8b8737f683db","root":false,"$title":"[TC.3.0.0] Valida Status do Cartao","$position":{"top":"1521px","left":"6778px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"7cc5da1b-6fd5-4896-a7f8-b8f2353fcc44","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"1122px","left":"6993px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"3310b47e-0e8a-4aa2-9a40-835963200ff9":{"$contentActions":[{"action":{"$id":"c77ac296-bf20-407c-a354-9c8b92903126","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"036d8206-fa6f-493b-8e2f-e7ac8b3daccc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"036d8206-fa6f-493b-8e2f-e7ac8b3daccc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"131d768a-2ac6-4e97-8880-952763e5bbc3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"37e4d64f-6937-45c5-9f93-fb76c849a32e","type":"text/plain","content":"Já recebemos o seu pedido do cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final <b>{{dadosCartao@numero}}</b>. Em breve, ele vai ser emitido.","metadata":{}},"$cardContent":{"document":{"id":"37e4d64f-6937-45c5-9f93-fb76c849a32e","type":"text/plain","content":"Já recebemos o seu pedido do cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final <b>{{dadosCartao@numero}}</b>. Em breve, ele vai ser emitido."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"2c62e1f2-a4e9-4659-a2e2-7aa213321322","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1ebc7453-6c14-4182-8054-a581e400c711","typeOfStateId":"state","$connId":"con_598","$id":"fc301a55-4e16-4923-b389-fa278009a9b2","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","typeOfStateId":"state","$connId":"con_603","$id":"2e0c5f59-be42-4d22-a240-eae921e7f6c0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9655b546-ca1c-4d6f-a44a-7e91dc76541a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-481c0170-1a57-4bf0-9c69-f46017916a83","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c13742c0-69c0-4d6d-9179-ebc9bd6ac363","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3310b47e-0e8a-4aa2-9a40-835963200ff9","root":false,"$title":"[TC.3.1.0] 95 - Solicitado","$position":{"top":"1881.5px","left":"6233px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f59664df-7729-4589-81fb-7c048d04fb27":{"$contentActions":[{"action":{"$id":"b45805f6-723e-4a7e-8a01-e71b09dac19d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"929b727a-49cb-4401-bcd2-65dbb66a9ec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"929b727a-49cb-4401-bcd2-65dbb66a9ec2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a045f929-0270-4539-8d70-bc5065d6c74d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2e33f7af-92a7-4e60-9734-06fbb59000f4","type":"text/plain","content":"O seu cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final\n<b>{{dadosCartao@numero}}</b>, já foi emitido. Em breve, ele vai chegar até você.","metadata":{}},"$cardContent":{"document":{"id":"2e33f7af-92a7-4e60-9734-06fbb59000f4","type":"text/plain","content":"O seu cartão <b>{{dadosCartao@descricao}}</b> na função de <b>{{dadosCartao@funcao}}</b> com final\n<b>{{dadosCartao@numero}}</b>, já foi emitido. Em breve, ele vai chegar até você."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d0168f74-25b5-4793-84e6-9992f82c6067","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1ebc7453-6c14-4182-8054-a581e400c711","typeOfStateId":"state","$connId":"con_608","$id":"d66cbe54-ead2-4c02-9be1-c7d4592d1cc3","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","typeOfStateId":"state","$connId":"con_613","$id":"3d939de6-d44d-4fb7-90a3-04623940e3ed","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"7de3132f-f35d-4187-882a-16beec8476d8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-40da8466-81b5-4d1e-a461-d6bc3529f156","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-85dc53ff-9bcf-4c88-8a3f-346a32531647","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f59664df-7729-4589-81fb-7c048d04fb27","root":false,"$title":"[TC.3.2.0] 96 - Em Producao","$position":{"top":"1895px","left":"6457px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5716fc03-71b2-4648-a278-7f638cf06567":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_618","$id":"a73c3432-fcf3-4bd5-8096-21500a3cce90","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_a_caminho\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3219cbb-440a-4dfd-919a-a16fa549aac0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-929f4908-75d9-4e30-bfad-fa9f2a884b88","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b76ab2f0-a4a2-489f-9695-2b636393f8ef","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8fa193d5-edda-40d6-a89c-a2ba24b2f065","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5716fc03-71b2-4648-a278-7f638cf06567","root":false,"$title":"[TC.3.3.0] 98 - Em Entrega","$position":{"top":"1892px","left":"6650px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"821770d1-280a-41c6-9846-1e004ad37f12":{"$contentActions":[{"action":{"$id":"aa794c34-d8fd-411a-94dd-3d3d36c2202b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b104476c-dd56-4da0-b273-b1d827bf981d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b104476c-dd56-4da0-b273-b1d827bf981d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"84a34a20-cbe8-4d3b-803d-254a16095455","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3b3c9d16-86bc-4c04-86a1-c068f906221d","type":"text/plain","content":"Não estou conseguindo encontrar o status de entrega do cartão, aguarde um momento..","metadata":{}},"$cardContent":{"document":{"id":"3b3c9d16-86bc-4c04-86a1-c068f906221d","type":"text/plain","content":"Não estou conseguindo encontrar o status de entrega do cartão, aguarde um momento.."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1cd4c973-93ae-4ef1-afc5-8d5cb0cfa14b","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1c968f8d-406e-4642-a20a-9b0c0975cd0a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-15bad6e8-3679-483f-a94d-6fa3ff924552","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-891ffed1-fad4-40ef-9921-147cc97e3de4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"821770d1-280a-41c6-9846-1e004ad37f12","root":false,"$title":"[TC.3.0.1] Status não encontrado","$position":{"top":"1922px","left":"8171.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3c5e78b8-d507-439e-a6b7-247f8e239fdd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"94a1a7d4-e542-40ad-b433-dc10d272a236","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","root":false,"$title":"[GO TO] Te ajudo em algo mais?","$position":{"top":"2251px","left":"6457.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1ebc7453-6c14-4182-8054-a581e400c711":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"84b08aa5-6fba-451c-9023-849fe9fdf128","typeOfStateId":"state","$connId":"con_623","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ver outro cartão\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Você quer ver o andamento de entrega de algum outro cartão que listei?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ea57eaf7-90d0-4a79-9e81-5d4af41adb9d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d66bfc01-d269-4a82-be13-6ff4eacaafd1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8c140d3f-ca59-4e58-90b2-93a576780dfc","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"1ebc7453-6c14-4182-8054-a581e400c711","root":false,"$title":"[TC.3.1.1] Mais de um cartão","$position":{"top":"2097.86px","left":"6262px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"84b08aa5-6fba-451c-9023-849fe9fdf128":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3c5e78b8-d507-439e-a6b7-247f8e239fdd","typeOfStateId":"state","$connId":"con_628","$id":"a3c52f71-5933-4c0b-b4cb-cc845826a08a","conditions":[{"source":"context","comparison":"equals","values":["Finalizar"],"variable":"userInput"}],"$invalid":false},{"stateId":"c3a0caea-2e69-4d42-8122-c06b7bf5efdf","typeOfStateId":"state","$connId":"con_633","$id":"89912912-cdb2-4721-8d86-dea3b33bde0b","conditions":[{"source":"context","comparison":"equals","values":["Ver outro cartão"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-17cd3e61-26ac-49fb-8976-ae67694f1448","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f74e615-a19c-4b9b-b5e9-66bf65e3d70c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d13326cd-d38e-4595-a606-aad499a7bf05","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cf1914f4-0945-487a-9cc2-2a613d155bd5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"84b08aa5-6fba-451c-9023-849fe9fdf128","root":false,"$title":"[TC.3.1.1] [INPUT] Mais de um cartão","$position":{"top":"2337.14px","left":"6233.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c3a0caea-2e69-4d42-8122-c06b7bf5efdf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6756a285-a76a-48f1-8928-12ed7e3d03ad","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a69b80a8-332b-4300-b3f4-728077b1e9e8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"c3a0caea-2e69-4d42-8122-c06b7bf5efdf","root":false,"$title":"[GO TO] [TC.2.0.0] possui cartao?","$position":{"top":"2507.14px","left":"6233.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ce332aaf-0e6e-4a29-9b7a-c2bae4f25909":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_638","$id":"f8478bd9-b009-4f64-9d10-cd6e95eaeb36","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"\nfunction run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_primeira_tentativa\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12a08ccc-82c0-4313-90a7-6588fefe1f50","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8ebaedce-d5f1-4415-af6f-e3de76f1432f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3457011d-4f36-4773-9ccf-96b8519b9522","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-91bc8f88-faf4-4d64-94a3-1a0dd50cfc7a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ce332aaf-0e6e-4a29-9b7a-c2bae4f25909","root":false,"$title":"[TC.3.4.0] 91 - Tentativa de Entrega 1","$position":{"top":"1891px","left":"6838px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7241083e-dc56-44e1-87ba-041f6c7b305b":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_643","$id":"d827a289-c6c8-4baf-aac9-56d7d3b33af4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"\nfunction run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_segunda_tentativa\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f48091a0-7e88-4acb-8e45-2973df4a81c6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-407d1c25-874c-4cbc-930e-e5b71051eaf5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1840ea7c-cca9-4367-8168-72e039a176cf","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3e82ecdc-83a0-4ece-bebc-809c008f3b01","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7241083e-dc56-44e1-87ba-041f6c7b305b","root":false,"$title":"[TC.3.5.0] 92 - Tentativa de Entrega 2","$position":{"top":"1895px","left":"7022px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7cb8bd6b-f7b5-49c9-ad64-8696249dcf0f":{"$contentActions":[{"action":{"$id":"9d843aaa-a578-4649-8ade-a99beef20208","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19da7867-e218-402a-a0cf-4d53cbe0f186","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"843734d4-a49b-451e-b6e0-c1f9fd736816","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f607a095-d284-45e8-9b2e-79683abe5d69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_648","$id":"c7c63bb7-c8f2-4320-a647-62d652c1b17f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e6d34d72-3684-417d-8a6a-11773df812f1","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"\nfunction run(dadosCartao) {\n    dadosCartao = JSON.parse(dadosCartao);\n    const template_name = \"facilitaai_rastreio_cartao_foi_entregue\";\n    return {\n        \"type\": \"template\", \"template\":\n            {\n                \"name\": template_name,\n                \"language\":\n                    {\n                        \"policy\": \"deterministic\",\n                        \"code\": \"pt_BR\"\n                    },\n                \"components\": [\n                    {\n                        \"type\": \"body\",\n                        \"parameters\": [\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.descricao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.funcao\n                            },\n                            {\n                                \"type\": \"text\",\n                                \"text\": dadosCartao.numero\n                            }\n                        ]\n                    }\n                ]\n            }\n    }\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b0e93dc5-d434-49db-a8c2-576fd502a459","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7416f78a-fd96-4677-8335-5779dc0e5cbd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b5d042b8-b8e4-4e83-aadf-78da820871b7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1b17e46b-4d21-4a6a-a00e-f19b5a17fe87","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"7cb8bd6b-f7b5-49c9-ad64-8696249dcf0f","root":false,"$title":"[TC.3.6.0] 97-90-89 - Entregue","$position":{"top":"1899px","left":"7210px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d4d5550-6eed-4b47-838d-eee09a11e45d":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_653","$id":"6560169d-7fdc-4285-b5a8-532d4ee21d4f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Fizemos a última tentativa de entrega do seu cartão *${dadosCartao.descricao}* na\nfunçao de *${dadosCartao.funcao}* com final *${dadosCartao.numero}*, mas nao tinha ninguém no endereço.\n\nVocê quer continuar por aqui ou posso finalizar o atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4e2e3e18-551a-47a1-97a8-29f1b1a82b8b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-226493b2-c03d-4ae0-b424-ca1a79576727","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-93816ef7-2ee2-4544-81ea-9cc20fa38534","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5d4d5550-6eed-4b47-838d-eee09a11e45d","root":false,"$title":"[TC.3.7.0] 93 - Tentativa de Entrega 3","$position":{"top":"1904px","left":"7393px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5b6a08e9-04f6-41c0-b5e0-09c686d90de4":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_658","$id":"c64e3f7d-b976-4c06-972e-a7c9ee74f89b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Fizemos uma tentativa de entrega do seu cartao *${dadosCartao.descricao}* na função de\n*${dadosCartao.funcao}* com final *${dadosCartao.numero}*, mas nao conseguimos. Vou precisar revisar o seu endereço\nde entrega.\n\nVoce quer continuar por aqui ou posso finalizar seu atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e6c1255a-c52a-48a8-89ef-b8911dbf27c2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6a2862d0-598e-4943-b8ce-82a79fc11ed9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1741b024-8ad8-4526-bfdb-4c3e5fbd6e93","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5b6a08e9-04f6-41c0-b5e0-09c686d90de4","root":false,"$title":"[TC.3.8.0] 94 - Revisar endereco entrega","$position":{"top":"1909px","left":"7587.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"83674938-6816-4e1a-a74b-3b7b5c7f6492":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_663","$id":"cb7266a2-3630-473e-a515-75404e2dcee2","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Não conseguimos entregar seu cartão *${dadosCartao.descricao}* na função de *${dadosCartao.funcao}* com final\n*${dadosCartao.numero}*. Preciso analisar melhor essa situação.\n\nVocê quer continuar por aqui ou posso finalizar seu atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f0eb6ffe-6d30-401f-bf92-348412669af6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c0307bb2-9e8f-4e4d-bb04-66bfb5d64a77","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-aab5d904-7c3d-4fbc-9f2d-354fb31a7e91","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"83674938-6816-4e1a-a74b-3b7b5c7f6492","root":false,"$title":"[TC.3.9.0] 99 - Não entregue","$position":{"top":"1916.67px","left":"7787.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3db6d61b-3876-42ab-8dc8-9f9de25a369e":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","typeOfStateId":"state","$connId":"con_668","$id":"ddf20f6c-90f6-4c5c-8b25-86cf90174b6c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCartao) {\n\ttry {\n\t\tdadosCartao = JSON.parse(dadosCartao);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Continuar por aqui\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Finalizar\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `O seu cartão *${dadosCartao.descricao}* na função de *${dadosCartao.funcao}* com final *${dadosCartao.numero}* não foi\nentregue. Preciso analisar melhor essa situação.\n\nVocê quer continuar por aqui ou posso finalizar seu atendimento?`; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-411f7018-db9d-4fd9-9452-e286d7ae49c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-53a633d6-3368-4458-9f6c-f74b4d129988","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8b0bb56a-a7f2-4379-9afe-ce20ac6317be","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3db6d61b-3876-42ab-8dc8-9f9de25a369e","root":false,"$title":"[TC.3.10.0] 88 - Extraviado","$position":{"top":"1918.33px","left":"7973px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"670c9a1f-3128-491e-bc7c-c2ddf2041f4e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a0243a75-a5ef-42bd-a8b4-ee82b0c5e2db","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ba3da958-10db-4e8c-8254-3b9c4914569e","typeOfStateId":"state","$connId":"con_673","$id":"01f47c2e-d39e-447d-8f65-33400411dc1a","conditions":[{"source":"context","comparison":"equals","values":["Continuar por aqui"],"variable":"userInput"}],"$invalid":false},{"stateId":"f9104304-1199-4675-8374-430655df0b48","typeOfStateId":"state","$connId":"con_678","$id":"1f63ac2d-d655-46c8-8f5d-0a08680045dd","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9ccf4ca5-113c-4170-8048-1e0b3dea35f4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"eba384e3-b60f-4779-8ca1-f7d3205821c3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n    try {\n        if (!inputUsuario) return 'inatividade'\n\n        const options = {\n            \"^((1|primeir[oa]|finalizar))$\": \"Finalizar\",\n            \"^((2|segund[ao]|continuar por aqui))$\": \"Continuar por aqui\"\n        }\n\n        inputUsuario = inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")\n\n        for (let regex in options) {\n            if (new RegExp(regex, 'i').test(inputUsuario)) {\n                return options[regex]\n            }\n        }\n        return 'input inesperado'\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b2c7235e-ef98-42f6-a0b3-e7d1cb893a29","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0ef145cc-4154-454c-85f5-716713028be0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-68ef5b47-fcf0-4f0c-8cee-13ce6f2a6d85","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4bd8ad4c-73f5-4326-a870-fc3177a9d3d7","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"670c9a1f-3128-491e-bc7c-c2ddf2041f4e","root":false,"$title":"[TC.4.0.0] Validacao Resposta","$position":{"top":"2210px","left":"7328.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ba3da958-10db-4e8c-8254-3b9c4914569e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"36dbb166-7d5f-4bd2-b415-4dab659ef9ba","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ba3da958-10db-4e8c-8254-3b9c4914569e","root":false,"$title":"[GO TO] Employee Transbordo ","$position":{"top":"2436.5px","left":"7136.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f9104304-1199-4675-8374-430655df0b48":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"db70079b-dafc-486c-8911-756528b4e9bf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eec29ed0-812d-42fa-afd3-58e0dc4a5326","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"f9104304-1199-4675-8374-430655df0b48","root":false,"$title":"[GO TO] Employee Finalização   ","$position":{"top":"2444.5px","left":"7533.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d64a1b9a-d7fb-4a53-884a-d34085a5601b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2360104b-898e-457f-918e-ef0244429365","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"329bc5fc-e554-4d1f-865b-1a858c603a5b","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"d64a1b9a-d7fb-4a53-884a-d34085a5601b","root":false,"$title":"[GO TO] Status de entrega","$position":{"top":"3092.67px","left":"1418px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"16b6d1b6-a332-48b5-8e88-ded1c07dd2ac":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bff410bd-26ae-4a36-b5ee-bd2801f00e0d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"69627292-9be3-442f-bddd-17001453148c","typeOfStateId":"state","$connId":"con_683","$id":"e42c7ff5-7a12-4c6d-8f2e-200af4283965","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"responseClientData"}],"$invalid":false},{"stateId":"544ad214-f67e-4d1a-87dd-cbb80aad7818","typeOfStateId":"state","$connId":"con_688","$id":"178510eb-0a78-473c-a3da-c017700cdb9d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"16b6d1b6-a332-48b5-8e88-ded1c07dd2ac","root":false,"$title":"[SET] Has Client Data?","$position":{"top":"410px","left":"1509px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bd552257-7201-4ce6-abf3-fc2d61dc4c75":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17f13d18-9b07-419e-80b7-7b049032d9f9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"bd552257-7201-4ce6-abf3-fc2d61dc4c75","root":false,"$title":"[GO TO] Employee Transbordo  ","$position":{"top":"854.286px","left":"5519.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b7adc970-3748-4b05-b3cf-c62fbf818ad0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5658247a-4281-4202-9398-cd9ea00fa09e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"b7adc970-3748-4b05-b3cf-c62fbf818ad0","root":false,"$title":"[GO TO] Employ Transbordo","$position":{"top":"1123px","left":"2037px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"544ad214-f67e-4d1a-87dd-cbb80aad7818":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bff410bd-26ae-4a36-b5ee-bd2801f00e0d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"6409c653-f585-4dc3-8039-4c7453131a4f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"544ad214-f67e-4d1a-87dd-cbb80aad7818","root":false,"$title":"[GO TO] Redirect to identified intent","$position":{"top":"657px","left":"1616px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"69627292-9be3-442f-bddd-17001453148c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2f46d9d6-2a7c-425c-983b-1208b07ef841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"69627292-9be3-442f-bddd-17001453148c","root":false,"$title":"[GO TO] Conta ","$position":{"top":"676px","left":"1408px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ae979c58-a10d-420a-b6d6-f5f281d1bf1f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b0433935-ef9c-4d62-bdc5-66f1741a3eaf","typeOfStateId":"state","$connId":"con_693","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"ae979c58-a10d-420a-b6d6-f5f281d1bf1f","root":false,"$title":"[Inicio] Aviso Viagem","$position":{"top":"414px","left":"9111.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b0433935-ef9c-4d62-bdc5-66f1741a3eaf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"88515150-19e1-4255-94bc-f58d6250c8f3","typeOfStateId":"state","$connId":"con_698","$id":"329098ae-7188-49e3-870c-fa70d0380ee6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"88515150-19e1-4255-94bc-f58d6250c8f3","typeOfStateId":"state","$connId":"con_703","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"AVISO_VIAGEM\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-55f1743a-f53f-427d-ad08-a060f138116e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-212bd193-b709-43a8-adbb-7e5d4e960e65","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b98ab105-2b42-4aa2-826e-11237bef80cf","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"b0433935-ef9c-4d62-bdc5-66f1741a3eaf","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"565.571px","left":"9110.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ba6f5dd-2292-4918-b0e7-4a1e3b77b9d2":{"$contentActions":[{"action":{"$id":"25f1adf8-d5c4-45e1-bd08-a4e64eb7f40e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d7892ac2-be44-45cf-8d61-b6cb88c54508","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d84ad8f4-fc02-4e0f-82fb-ea82195094d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você precisa cadastrar um aviso viagem no seu cartão, certo?","metadata":{}},"$cardContent":{"document":{"id":"6c3837fa-392c-488b-9211-dda43461358d","type":"text/plain","content":"Entendi, você precisa cadastrar um aviso viagem no seu cartão, certo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b2b8598-e2d7-429a-b9cb-6a5604c6d49f","type":"text/plain","textContent":"User input","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"24995eac-f915-4c60-9fca-4b9e99631ff8","typeOfStateId":"state","$connId":"con_708","$id":"ac35cb7e-187b-4c4b-a78e-706ec206fc9f","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"78143bf8-48e6-465b-93fd-ea639c4430a6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"5a1c2ce6-b664-4b86-a980-731c63aa8395","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"2105531f-c060-48b4-b6b9-f8251467a3be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"358c4d79-4df5-4017-ae25-c47880069f49","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} smalltalk\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} smalltalk","action":"{{input.content}} | {{SmallTalksIdentified}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3eda6555-7a50-4918-9f64-d5a7aed5d1dd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-af7b4b49-18db-48b7-a85a-43e0e32d9f33","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5afa64d4-f1e1-4ea1-89fe-045d8d41dd4d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-28e2f94f-2c6e-4cc0-b35c-87984d0b66a6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-9d161524-0ed7-4af8-8256-1ddadcd593cd","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7ba6f5dd-2292-4918-b0e7-4a1e3b77b9d2","root":false,"$title":"[AV.1.0.0] Inicio Aviso Viagem","$position":{"top":"898.25px","left":"9110.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a070efc9-e0c4-4508-8f2a-6476a787a9a9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28e37fe9-391f-4e4b-9c87-38b651423fcf","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33"},"isAiGenerated":false,"$tags":[],"id":"a070efc9-e0c4-4508-8f2a-6476a787a9a9","root":false,"$title":"[GO TO] Falar com gerente","$position":{"top":"1143px","left":"9377px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"44f608c5-d9ec-4058-b209-fab297dff74e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"717d991b-2645-487b-ae3b-e268194ba414","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9b7c8806-deae-4779-98a6-5368e6e353c3","typeOfStateId":"state","$connId":"con_713","$id":"5f44cd02-f596-4858-a973-ab69671cf650","conditions":[{"source":"context","comparison":"equals","values":["1","1.0"],"variable":"qtdAvisoViagem"}],"$invalid":false},{"stateId":"b8ea9439-9fe6-49e8-b321-a072d4d2def7","typeOfStateId":"state","$connId":"con_718","$id":"ecf160a0-0fac-4474-9ccb-a1e8bb2a8d9e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"04f1f8b3-058c-473b-870b-f2c9fede2881","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name}  num viagens\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} num viagens","action":"{{qtdAvisoViagem}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"qtdAvisoViagem"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c846ea50-c9db-4010-956d-2354be21a445","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"44f608c5-d9ec-4058-b209-fab297dff74e","root":false,"$title":"[AV.3.0.1][SET] Possui Aviso de Viagem","$position":{"top":"1586px","left":"8838.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3cf5c53e-355f-4c57-a1e3-2b98a6fada21":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8b31b04f-dbde-4566-879a-c678bc650891","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ae979c58-a10d-420a-b6d6-f5f281d1bf1f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3cf5c53e-355f-4c57-a1e3-2b98a6fada21","root":false,"$title":"[GO TO] Aviso Viagem","$position":{"top":"3096.67px","left":"1600.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ee0d26f9-2fdb-401c-89ce-332b25d2d280":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0901ef90-046a-400a-af6a-448451b6d2cd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"19eb9819-6e40-4264-afa8-46d3ae5e3782","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ee0d26f9-2fdb-401c-89ce-332b25d2d280","root":false,"$title":"[GO TO] Conta","$position":{"top":"3237px","left":"1235.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"24995eac-f915-4c60-9fca-4b9e99631ff8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"105b0fd7-0d57-4623-91ec-50a4c140fa76","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"411850d7-7a3b-4fd3-86bb-83b64a0d311f","typeOfStateId":"state","$connId":"con_723","$id":"629c92ba-99f3-4537-afe6-e0e503c83367","conditions":[{"source":"context","comparison":"equals","values":["mais de um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"eda29cd2-7329-4fa8-afee-7d27467b64b0","typeOfStateId":"state","$connId":"con_728","$id":"b83055b5-b000-4494-823d-e18fb3899b41","conditions":[{"source":"context","comparison":"equals","values":["um"],"variable":"qtdCartoes"}],"$invalid":false},{"stateId":"a070efc9-e0c4-4508-8f2a-6476a787a9a9","typeOfStateId":"state","$connId":"con_733","$id":"3996ecf6-715a-41ab-8b5f-d8a04e898695","conditions":[{"source":"context","comparison":"equals","values":["zero"],"variable":"qtdCartoes"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4f03222c-f367-4c2c-b32e-04057918a290","$typeOfContent":"","type":"SetVariable","$title":"CLEAR qtdCartoes","$invalid":false,"settings":{"variable":"qtdCartoes"},"conditions":[]},{"$id":"ce913fdb-a682-48fc-a49d-d64da00eae80","$typeOfContent":"","type":"SetVariable","$title":"CLEAR cartoes","$invalid":false,"settings":{"variable":"cartoes"},"conditions":[]},{"$id":"d655a3be-d54f-43ad-9f45-a7f6e8189cc5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"78f31013-f453-4a9d-afb0-ad2c8f6eace7","$typeOfContent":"","type":"ExecuteScript","$title":"Encodingurl","$invalid":false,"settings":{"function":"run","source":"function run (secret) {\n    return `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`;\n}\n\n","inputVariables":["config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"80ad53f5-e5f2-4144-a624-52891b94530d","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - TOKEN","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"6add9f5c-54ef-4cd1-8c1f-55e31229d8d8","$typeOfContent":"","type":"ExecuteScript","$title":"JS - PEGA ACCESS TOKEN","$invalid":false,"settings":{"function":"run","source":"\tfunction run(token) {\n\n const {access_token} = JSON.parse(token);\n    return access_token;\n}","inputVariables":["bodyToken"],"outputVariable":"token","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"87486e17-cc9a-4462-ae0e-66583849a88c","$typeOfContent":"","type":"ProcessHttp","$title":"dados cartao \"bodyDadosCartao\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"3f55dd2d-2b35-43a1-b019-a37d3ec938ca","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes?agencia={{agency}}&codigoCliente={{dadosCliente@codCliente}}&conta={{account}}","responseStatusVariable":"statusDadosCartao","responseBodyVariable":"bodyDadosCartao"},"conditions":[]},{"$id":"4d1f3241-1f43-44af-a769-2da25b2009a0","$typeOfContent":"","type":"ExecuteScript","$title":"cartoes","$invalid":false,"settings":{"function":"run","source":"const run = (body) => {\n\ttry {\n\t\tconst cartoes = JSON.parse(body).data;\n\t\treturn cartoes.filter(cartao =>  cartao.situacao == 'A' && cartao.funcao !== 'D')\n\t\t//return cartoes.filter(cartao => cartao.situacao == 'A')\n\t} catch (err) {\n\t\treturn []\n\t}\n}","inputVariables":["bodyDadosCartao"],"outputVariable":"cartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusDadosCartao"}]},{"$id":"d9a908bb-4992-4036-86ff-cb49901b5c1d","$typeOfContent":"","type":"ExecuteScript","$title":"qtdCartoes","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tconst qtdCartoes = cartoes.length\n\t\tif(qtdCartoes == 0){\n\t\t\treturn 'zero'\n\t\t}\n\t\treturn qtdCartoes == 1 ? 'um' : 'mais de um'\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["cartoes"],"outputVariable":"qtdCartoes","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cartoes"}]},{"$id":"85861d9d-bb03-4c24-9c67-5424fe9e5cfb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api","action":"{{contact.identity}} | {{statusDadosCartao}} | {{bodyDadosCartao}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"62aec317-124c-4a6f-8eb5-347b96526b10","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1034f2b3-c705-4f12-91b2-e2eeb760862c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-206bf057-19ed-4548-9b1d-b2d01db34147","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6f6bd195-6b64-45c5-863b-33e66eaad723","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8f1a4421-7ba6-42d0-a8bf-6c4c613c5842","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"24995eac-f915-4c60-9fca-4b9e99631ff8","root":false,"$title":"[AV.2.0.0] possui cartao?","$position":{"top":"1057px","left":"9109.89px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"411850d7-7a3b-4fd3-86bb-83b64a0d311f":{"$contentActions":[{"action":{"$id":"da9663d7-183b-4f02-9ee8-16d26e7cddc9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c36dba42-dbf9-4a0a-9a7c-d317c85f2f98","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c99398e-249f-490e-b8b3-72e1f1c36bec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"41390c65-db38-4dbd-90c6-41299f7c8e16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"eda29cd2-7329-4fa8-afee-7d27467b64b0","typeOfStateId":"state","$connId":"con_738","$id":"a25de5f4-c6d1-4747-9049-a152ce3d0576","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a7d14ba-449c-4cee-bb61-1f2c446357c7","$typeOfContent":"","type":"ExecuteScript","$title":"OLD","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(bold, platform, cartoes, bin) {\n    platform = platform.toLowerCase();\n    if (platform === \"instagram\" || platform === \"telegram\" || platform === \"messenger\") {\n        platform = 'blipchat';\n    }\n    bin = JSON.parse(bin)\n    cartoes = JSON.parse(cartoes);\n    const text = `De qual cartão você quer ver o andamento da entrega?`;\n    const options = [];\n    const isButton = false;\n    const isList = true;\n    const description = []\n    cartoes.forEach((cartao, index) => {\n        const cartaoBin = cartao.numeroConta.substr(0, 6)\n        const cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n        options.push(`${cartaoInfo[0].nomeComercial}`);\n\n    });\n    cartoes.forEach((cartao, index) => {\n        cartao.titular = cartao.titular ? \"Titular\" : \"Adicional\"\n        description.push(`${cartao.nomePortador.split(' ')[0]} - ${cartao.titular} - Final ${cartao.numero}`);\n    });\n\n    const menuSettings = {\n        text,\n        \"header\": '',\n        \"body\": text,\n        \"footer\": '',\n        \"button\": 'Escolher Cartão',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        options,\n        \"values\": options,\n        \"description\": description,\n        \"menuScope\": {\n            \"whatsappButton\": isButton,\n            \"whatsappList\": isList,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": isButton,\n            \"blipchatMenu\": isList,\n            \"defaultText\": false,\n            platform,\n            \"boldValue\": bold,\n        },\n    };\n\n    return getMenuForPlatform(menuSettings);\n}\n\nfunction capitalizeText(text) {\n    let words = text.split(\" \");\n\n    words = words.map(\n        (word) =>\n            word.length &&\n            `${word.charAt(0).toUpperCase()}${word.slice(1).toLowerCase()}`\n    );\n\n    return words.join(\" \");\n}","inputVariables":["bold","platform","cartoes","resource.binNomesCartao"],"outputVariable":"OLD","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"891af007-b02b-499d-8e00-2110df18e241","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, bin) => {\n\ttry {\n\t\tlet { header, body, action } = menu(cartoes, bin);\n\t\treturn buildWhatsApp(header, body, action);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\nconst buildWhatsApp = (header, body, action) => {\n\treturn {\n\t\t'type': 'application/json',\n\t\t'content': {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": header,\n\t\t\t\t\"body\": body,\n\t\t\t\t\"action\": action\n\t\t\t}\n\t\t}\n\t}\n}\n\nconst menu = (cartoes, bin) => {\n\tbin = JSON.parse(bin)\n\tcartoes = JSON.parse(cartoes);\n\tlet options = [];\n\tlet description = []\n\tlet objOpcoes = [];\n\tcartoes.forEach((cartao, index) => {\n\t\tconst cartaoBin = cartao.numeroConta.substr(0, 6)\n\t\tconst cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n\t\tcartao.titular = cartao.titular ? \"Titular\" : \"Adicional\"\n\t\tobjOpcoes.push({\n\t\t\t\"id\": `${cartao.numero}`,\n\t\t\t\"title\": `${cartaoInfo[0].nomeComercial.substring(0, 24)}`,\n\t\t\t\"description\": `${cartao.nomePortador.split(' ')[0]} - ${cartao.titular} - Final ${cartao.numero}`\n\t\t})\n\t});\n\n\tlet textMenu = \"Qual cartão você quer cadastrar o aviso viagem?\"\n\treturn {\n\t\t\"body\": {\n\t\t\t\"text\": textMenu\n\t\t},\n\t\t\"action\": {\n\t\t\t\"button\": \"Escolher cartão\",\n\t\t\t\"sections\": [\n\t\t\t\t{\n\t\t\t\t\t\"rows\": objOpcoes\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n};","inputVariables":["cartoes","resource.binNomesCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3dee8925-bfa3-4088-b9ac-b42a1cb6711a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"46956b66-305f-409f-b4f4-ea4a2c3802d9","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input) => {\n\tconst jsonData = JSON.parse(input);\n\tinput = jsonData.metadata['#wa.interactive.list.id'];\n\tcartoes = JSON.parse(cartoes)\n\tconst regex = /\\b\\d{4}\\b/\n\tconst numeroCartao = input.match(regex)\n\tconst encontrouCartao = cartoes.find(cartao => cartao.numero == numeroCartao) || 'input inesperado'\n\treturn encontrouCartao.numero\n}","inputVariables":["cartoes","input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2d9c9097-5205-4d82-bc91-dc2dc4fcd38b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-217a71cd-d409-4877-b473-6a98b7a61d8c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-56aed0d8-d4a4-4b0a-83b0-91807d6f8af8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-af25fb38-8d29-4674-aba8-dd183a779d12","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"411850d7-7a3b-4fd3-86bb-83b64a0d311f","root":false,"$title":"[AV.2.0.1] + 1 cartao","$position":{"top":"1155.89px","left":"8870px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eda29cd2-7329-4fa8-afee-7d27467b64b0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b36ec5f6-88a4-439d-a9fd-72935821efab","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"77783a4c-9ce2-4bb9-a3eb-2eed9c5ee15a","typeOfStateId":"state","$connId":"con_743","$id":"cfe5b8ba-e472-4fb7-ab15-ed35c6134934","conditions":[{"source":"context","comparison":"notEquals","values":["erro finalCartao"],"variable":"finalCartao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"08421fb8-070f-41fc-89ba-a879f99fe222","$typeOfContent":"","type":"ExecuteScript","$title":"finalCartao","$invalid":false,"settings":{"function":"run","source":"const run = (cartoes, input = false) => {\n\ttry {\n\t\tcartoes = JSON.parse(cartoes)\n\t\tif (cartoes.length == 1) {\n\t\t\treturn cartoes[0].numero\n\t\t}\n\t\tif (!!input) {\n\t\t\treturn cartoes.find(cartao => cartao.numero == input).numero\n\t\t}\n\t\treturn cartoes[0].numero\n\n\t} catch (err) {\n\t\treturn 'erro finalCartao'\n\t}\n}","inputVariables":["cartoes","userInput"],"outputVariable":"finalCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"815d152c-844b-4d3f-bb12-26b7453fb53d","$typeOfContent":"","type":"ExecuteScript","$title":"dadosCartao","$invalid":false,"settings":{"function":"run","source":"function run(cartoes, finalCartao, bin) {\n\ttry {\n\t\tlet data = JSON.parse(cartoes);\n\t\tbin = JSON.parse(bin);\n\t\tlet filteredData = data.filter(card => card.numero == finalCartao);\n\t\tfilteredData = filteredData.map(card => {\n\t\t\tswitch (card.funcao) {\n\t\t\t\tcase 'M':\n\t\t\t\t\tcard.funcao = 'débito e crédito';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'D':\n\t\t\t\t\tcard.funcao = 'débito';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'C':\n\t\t\t\t\tcard.funcao = 'crédito';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn card;\n\t\t});\n\n\t\tlet cartao = filteredData[0];\n\t\tlet cartaoBin = cartao.numeroConta.substr(0, 6)\n\t\tlet cartaoInfo = bin.filter(x => x.binFidelity == cartaoBin)\n\t\tcartao.descricao = `${cartaoInfo[0].nomeComercial}`;\n\t\treturn cartao;\n\n\t}\n\tcatch (error) {\n\t\treturn error.message;\n\t}\n}\n","inputVariables":["cartoes","finalCartao","resource.binNomesCartao"],"outputVariable":"dadosCartao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1259dd8a-a07b-4d3e-8329-7677e6986260","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-662aa362-67af-4f86-9e19-2e1fa76085a9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-867c6bf8-2ac4-4b44-8426-37cc7629ff28","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"eda29cd2-7329-4fa8-afee-7d27467b64b0","root":false,"$title":"[AV.2.0.3] dados cartao","$position":{"top":"1266px","left":"9110.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"77783a4c-9ce2-4bb9-a3eb-2eed9c5ee15a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f86b64e9-93e9-4130-acd3-6e75f73f3f6d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"44f608c5-d9ec-4058-b209-fab297dff74e","typeOfStateId":"state","$connId":"con_748","$id":"27e8e823-30a3-4579-9f78-f100974d6557","conditions":[{"source":"context","comparison":"equals","values":["200","201","202","204"],"variable":"status1"},{"values":["1"],"source":"context","comparison":"greaterThanOrEquals","variable":"qtdAvisoViagem"}],"$invalid":false},{"stateId":"3c74a6bb-7d46-4a46-a2bf-d5d3136772f6","typeOfStateId":"state","$connId":"con_753","$id":"2b7b3020-fe67-469b-8d83-bb349b5eb519","conditions":[{"source":"context","comparison":"equals","values":["200","201","202","204"],"variable":"status1"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6369c43c-4e60-4eac-a556-a856227a0a77","$typeOfContent":"","type":"SetVariable","$title":"CLEAR body1","$invalid":false,"settings":{"variable":"body1"},"conditions":[]},{"$id":"d6293142-e076-4a16-9d35-7591fc043187","$typeOfContent":"","type":"SetVariable","$title":"CLEAR status1","$invalid":false,"settings":{"variable":"status1"},"conditions":[]},{"$id":"dd74c400-274a-47c2-9974-800a6a2c73ec","$typeOfContent":"","type":"ProcessHttp","$title":"avisoViagem  \"body1\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"GET","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/clientes/{{document}}/cartoes/{{finalCartao}}/avisos-viagens","responseStatusVariable":"status1","responseBodyVariable":"body1"},"conditions":[]},{"$id":"424e2ae7-4763-4c4d-8cff-d549c97eb669","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api logs","$invalid":false,"settings":{"extras":{},"action":"{{contact.identity}} | {{status1}} | {{body1}}","category":"{{state.name}} api logs"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b324302f-57bd-4c5b-b360-9aaed2df9a06","$typeOfContent":"","type":"SetVariable","$title":"CLEAR qtdAvisoViagem","$invalid":false,"settings":{"variable":"qtdAvisoViagem"},"conditions":[]},{"$id":"76023feb-2377-4e95-8883-42831beb6382","$typeOfContent":"","type":"ExecuteScript","$title":"qtdAvisoViagem","$invalid":false,"settings":{"function":"run","source":"\nfunction run(body1) {\n\ttry {\n\t\tbody1 = JSON.parse(body1).data;\n\n\t\treturn body1.length;\n\t}\n\tcatch (e) {\n\t\treturn 0;\n\t}\n}","inputVariables":["body1"],"outputVariable":"qtdAvisoViagem","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9c71cfd8-ef30-4f8c-a090-e4327616d863","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3069befa-5d42-48de-a193-1e1c3106dec4","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-e7cfb745-e69c-4f27-aef9-9c0bbde7f432","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c4d8819b-0695-4640-bf4f-0fa8f16538be","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"77783a4c-9ce2-4bb9-a3eb-2eed9c5ee15a","root":false,"$title":"[AV.3.0.0][HTTP]Possui Aviso Viagem?","$position":{"top":"1435px","left":"9110px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3c74a6bb-7d46-4a46-a2bf-d5d3136772f6":{"$contentActions":[{"action":{"$id":"3968c3e6-0b99-4d7c-87a8-83284bc5b8a2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"47dc70db-ad05-4ab9-8d0b-223894fef5cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"47dc70db-ad05-4ab9-8d0b-223894fef5cf","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"47a71fa7-aad1-48bd-b99b-be9f72f51852","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"12ab4962-54aa-4df9-90a5-f54d58e92eec","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"947bd984-070d-4a9a-ae7c-cb09ffa221a1","typeOfStateId":"state","$connId":"con_758","$id":"b86b63e4-ecfa-4f18-b0be-23147fb41411","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"33f16f88-c02f-4c0e-affb-47fb1d50765d","$typeOfContent":"","type":"ExecuteScript","$title":"Monta conteúdo dinâmico","$invalid":false,"settings":{"function":"run","source":"function run(finalCartao, flowToken) {\n  let textoCartaoUnico = `💳 Vou usar na viagem o cartão final: ${finalCartao}`\n  const hoje = new Date();\n  const dataFormatada = hoje.toISOString().split('T')[0];\n\n  let data = {\n    \"textoCartaoUnico\": textoCartaoUnico,\n    \"dataInicioMinDate\": dataFormatada,\n    \"dataFimMinDate\": dataFormatada\n  }\n\n  let conteudoDinamico = {\n    \"recipient_type\": \"individual\",\n    \"messaging_product\": \"whatsapp\",\n    \"type\": \"interactive\",\n    \"interactive\": {\n      \"type\": \"flow\",\n      \"body\": {\n        \"text\": \"Preciso de algumas informações da sua viagem. \\nÉ só tocar no botão abaixo.\"\n      },\n      \"action\": {\n        \"name\": \"flow\",\n        \"parameters\": {\n          \"flow_message_version\": \"3\",\n          \"flow_token\": flowToken,\n          \"flow_id\": \"1169605027966468\",\n          \"flow_cta\": \"Adicionar informações\",\n          \"flow_action\": \"navigate\",\n          \"flow_action_payload\": {\n            \"screen\": \"INCLUIR_APENAS_UM_CARTAO\",\n            \"data\": data\n          }\n        }\n      }\n    }\n  }\n  return conteudoDinamico;\n}","inputVariables":["finalCartao","random.guid"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a93f7175-188d-406b-9f2d-bd7c13b77a6b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"2687b5a2-7eb0-4943-9a6b-d607a91a905f","$typeOfContent":"","type":"ExecuteScript","$title":"Extrai opção do menu escolhida","$invalid":false,"settings":{"function":"run","source":"function run(inputMessage) {\n    try {\n        const opcaoEscolhida = JSON.parse(inputMessage).metadata[\"#wa.interactive.list.id\"];\n        return inputMessage;\n    } catch (error) {\n        return \"Infelizmente não consegui capturar as infomações... 😢\";\n    }\n}\n\n","inputVariables":["input.message"],"outputVariable":"opcaoEscolhida","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8e96f612-3e37-45d8-9d6d-0c2188d0e407","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bf2a0ff5-0b96-4b96-9eea-10601a339ffc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-935ed77a-033e-41de-8724-60b25e5b12d0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3c74a6bb-7d46-4a46-a2bf-d5d3136772f6","root":false,"$title":"[AV.4.0.0][MSG] cadastrar nova viagem","$position":{"top":"1696.5px","left":"9535px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9b7c8806-deae-4779-98a6-5368e6e353c3":{"$contentActions":[{"action":{"$id":"f4825548-d391-422f-b72c-0c5749f0e8c6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9c02fa65-8bbe-43b9-b291-72e504dfdfc8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9c02fa65-8bbe-43b9-b291-72e504dfdfc8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e0df0339-23b7-440d-a75d-d2b72b1071ba","$typeOfContent":"text","type":"SendMessage","settings":{"id":"02f7d5dd-915b-4e84-bee2-e6bfe8cb4215","type":"text/plain","content":"{{msgViagem}}","metadata":{}},"$cardContent":{"document":{"id":"02f7d5dd-915b-4e84-bee2-e6bfe8cb4215","type":"text/plain","content":"{{msgViagem}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"48dd05b5-d205-466f-9698-18ab8d69e98c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d8256fb6-1352-4501-8403-ba7195d9001e","typeOfStateId":"state","$connId":"con_763","$id":"70aa736f-660b-4de2-9b36-fca3f051c9af","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6587baaa-8bf2-4b47-ac1d-0c9746845927","$typeOfContent":"","type":"ExecuteScript","$title":"dadosViagem","$invalid":false,"settings":{"function":"run","source":"\nfunction run(body1) {\n\ttry {\n\t\tbody1 = JSON.parse(body1).data;\n\t\treturn body1[0];\n\t}\n\tcatch (err) {\n\t\treturn err.message;\n\t}\n\n}","inputVariables":["body1"],"outputVariable":"dadosViagem","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c63309a3-8d05-4267-9ffe-0f0a536549d7","$typeOfContent":"","type":"ExecuteScript","$title":"msgViagem","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n    const [ano, mes, dia] = dataStr.split(\"-\");\n    return `${dia}/${mes}/${ano}`;\n}\n\nfunction run(dadosViagem, finalCartao) {\n    try {\n        dadosViagem = JSON.parse(dadosViagem);\n        return `Vi que este foi o último aviso viagem que você cadastrou.\n\n*${dadosViagem.nomeContinente}*\nFinal do cartão: *${finalCartao}*\n*${formatarData(dadosViagem.dataInicio)}* a *${formatarData(dadosViagem.dataFim)}*`\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["dadosViagem","finalCartao"],"outputVariable":"msgViagem","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fcfbb518-37f3-42c1-8177-ac4713fd06e1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8d8c5f3c-8fd4-4161-88f4-24e873ecdb29","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-53b5a238-2809-4ad5-8737-87f3538977fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0444fc1e-44fb-419a-a67d-f64b51b473ce","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9b7c8806-deae-4779-98a6-5368e6e353c3","root":false,"$title":"[AV.3.1.0][MSG] uma viagem","$position":{"top":"1788px","left":"8688.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d8256fb6-1352-4501-8403-ba7195d9001e":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"407dc4af-81b3-48b6-8539-afd03e45cff5","typeOfStateId":"state","$connId":"con_768","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Alterar viagem\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Excluir\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Fazer novo cadastro\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Você gostaria de alterar a viagem, excluir ou cadastrar um novo aviso?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4c6e4ea4-bb2f-4c9c-830b-c85f98ab0503","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-998a6e6b-d50e-46e0-a09d-4e73b35e07a4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4c54686b-97c8-4c7b-a4bf-5f4dc17f5633","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d8256fb6-1352-4501-8403-ba7195d9001e","root":false,"$title":"[AV.3.1.1][MSG] alteracao da viagem","$position":{"top":"1930px","left":"8689px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"407dc4af-81b3-48b6-8539-afd03e45cff5":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62f7cee3-13bb-41fc-bac3-dde5f9096c80","typeOfStateId":"state","$connId":"con_773","$id":"7a89c7fe-cad2-42a4-ac89-f44d09c95e17","conditions":[{"source":"context","comparison":"equals","values":["Fazer novo cadastro"],"variable":"userInput"}],"$invalid":false},{"stateId":"af320c49-148a-4a94-acd0-7e97b9bb7b53","typeOfStateId":"state","$connId":"con_778","$id":"b18cc2d7-1808-4f06-92b9-faf593c6c267","conditions":[{"source":"context","comparison":"equals","values":["Excluir"],"variable":"userInput"}],"$invalid":false},{"stateId":"ad5c2b82-3c5c-44bd-9340-c759b03e83ea","typeOfStateId":"state","$connId":"con_783","$id":"f41a7184-686c-4268-9406-8c5aac776403","conditions":[{"source":"context","comparison":"equals","values":["Alterar viagem"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"31b576b5-a7db-4c58-97fd-e77bf25dc592","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b3eacd92-438e-4495-afe2-ad908e3f1e9f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ada7b053-51bf-46a2-a95e-41202d6853c9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d369178f-3863-40ef-83c0-f6ac59a1b9e6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b51422b4-39d2-443a-92c3-a3894fb212fe","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"407dc4af-81b3-48b6-8539-afd03e45cff5","root":false,"$title":"[AV.3.1.1][INPUT] alteracao da viagem","$position":{"top":"2098.57px","left":"8689px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62f7cee3-13bb-41fc-bac3-dde5f9096c80":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6ffae76f-41ba-4a32-a9f6-dd3c8782bd71","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3c74a6bb-7d46-4a46-a2bf-d5d3136772f6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"62f7cee3-13bb-41fc-bac3-dde5f9096c80","root":false,"$title":"[GO TO] [MSG] cadastrar nova viagem","$position":{"top":"2298px","left":"8307px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ad5c2b82-3c5c-44bd-9340-c759b03e83ea":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"76b3af5a-24f7-4df0-aa74-2a0327e5f2ac","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62f7cee3-13bb-41fc-bac3-dde5f9096c80","typeOfStateId":"state","$connId":"con_788","$id":"0907f305-ed77-4ccd-8973-b6877a5dd946","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"922f5e94-4a94-4cfc-97be-5f91d8e6a86c","$typeOfContent":"","type":"SetVariable","$title":"Set \"alteracaoViagem\"","$invalid":false,"settings":{"variable":"alteracaoViagem","value":"Sim"},"conditions":[]},{"$id":"2d7449c4-c276-42aa-81de-d1840efe8103","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4bf386a7-7aa2-48a1-90f0-592e977634f8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e364b5d3-565d-49c3-bd51-8d65604b3e01","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"ad5c2b82-3c5c-44bd-9340-c759b03e83ea","root":false,"$title":"[AV.3.1.2][SET] Alterar viagem","$position":{"top":"2298px","left":"8688.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b8ea9439-9fe6-49e8-b321-a072d4d2def7":{"$contentActions":[{"action":{"$id":"d8e25b49-af9d-42cb-9189-a7d020ab0974","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"},"metadata":{}},"$cardContent":{"document":{"id":"aef0497e-1f1a-4a8a-9016-783119f70769","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"1500"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6eab91e1-a8d9-4f36-877e-bd3049512919","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bfb301d0-af00-478a-bd77-9c75da24cec8","typeOfStateId":"state","$connId":"con_793","$id":"f6b5a2f4-95b2-4b95-a158-703dc53dc4eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3aa9d290-4cc4-4607-a662-a0366eb1b3d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"83de69ad-cc6d-4f42-8b73-e78b4a5e5528","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n    const [ano, mes, dia] = dataStr.split(\"-\");\n    return `${dia}/${mes}/${ano}`;\n}\n\n// Texto a ser apresentado no body no componente de lista\nconst text = `Vi que estes foram os últimos avisos de viagem que você cadastrou.\n\nAo escolher um deles, te ajudo a alterar, excluir ou, se preferir, cadastrar um novo aviso viagem.`\n// Texto do titulo do botão\nconst buttonTitle = 'Ver opções'\n/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = []\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n\tif (posicao > menuOptions.length) {\n\t\tposicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n\t}\n\tif (menuOptions.find(option => option.id == posicao)) {\n\t\tquantidadeItens = menuOptions.length\n\t\tfor (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n\t\t\tmenuOptions[i].id = (i + 2).toString()\n\t\t}\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72) || ''\n\t\t})\n\t} else {\n\t\tmenuOptions.push({\n\t\t\tid: posicao.toString(),\n\t\t\ttitle: title.slice(0, 24),\n\t\t\tdescription: description.slice(0, 72)\n\t\t})\n\t}\n\tmenuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n\t// Parametro de busca é o title ou description da opção que deseja atualizar\n\tconst opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tmenuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n\tmenuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao);\n\n\tif (!opcao) {\n\t\treturn;\n\t}\n\n\tconst hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n\tif (hasPermission) {\n\t\treturn;\n\t}\n\n\tconst index = menuOptions.indexOf(opcao);\n\tif (index > -1) {\n\t\tmenuOptions.splice(index, 1);\n\t}\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions.splice(index, 1)\n}\n\nfunction removeDescricaoDoBotao({ tituloDoBotao, parteASerRemovida, listaPermissoes, permissaoNecessaria }) {\n\tif (listaPermissoes.includes(permissaoNecessaria)) {\n\t\treturn\n\t}\n\tconst opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n\tif (!opcao) {\n\t\treturn\n\t}\n\tconst index = menuOptions.indexOf(opcao)\n\tmenuOptions[index].description = menuOptions[index].description.replace(parteASerRemovida, '')\n}\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(body1, finalCartao) {\n\ttry {\n\t\tbody1 = JSON.parse(body1).data;\n\n\t\tbody1.slice(0, 9).forEach((item, index) => {\n\t\t\tconst title = item.nomeContinente;\n\t\t\tconst description = `Final do cartão ${finalCartao} - ${formatarData(item.dataInicio)} a ${formatarData(item.dataFim)}`;\n\t\t\tadicionaOpcaoNoMenu({ posicao: index, title: title, description: description });\n\t\t});\n\t\tadicionaOpcaoNoMenu({ posicao: 10, title: \"Fazer novo cadastro\", description: \"Cadastre um novo aviso viagem\" });\n\n\t\t// Fim regras de negocio \n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": text\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": buttonTitle,\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": menuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\terror: err.message,\n\t\t\texceptionType: 'reiniciarFluxo',\n\t\t\tdynamicContent: {\n\t\t\t\t\"type\": \"text\",\n\t\t\t\t\"text\": {\n\t\t\t\t\t\"body\": \"Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}","inputVariables":["body1","finalCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12d17c26-02d6-4b25-b6ba-aefbc1b7a22d","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"d45b7520-a5d6-472f-bca9-4b71a0406b88","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"5170536a-29da-42f7-8e55-c189b5af2326","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fc82b250-a239-43a6-8801-14f40efb03f1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-10917357-3ea7-418c-baa7-d20d81d67bce","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f3e89c2b-e574-4b45-8da2-1b07a83a0773","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-52514ebf-bf27-4819-b541-824fd75bcd38","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b8ea9439-9fe6-49e8-b321-a072d4d2def7","root":false,"$title":"[AV.3.2.0][MSG] +1 viagens","$position":{"top":"1831px","left":"9191px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bfb301d0-af00-478a-bd77-9c75da24cec8":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e642829d-fc0c-4fab-9c37-06c2fb79977b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"typeOfStateId":"state","$id":"2efb9fef-dbd1-4a80-be38-694a9d7c3af8","conditions":[{"source":"context","comparison":"equals","values":["Fazer novo cadastro"],"variable":"userInput"}],"$invalid":false,"stateId":"3c74a6bb-7d46-4a46-a2bf-d5d3136772f6","$connId":"con_798"},{"stateId":"d8256fb6-1352-4501-8403-ba7195d9001e","typeOfStateId":"state","$connId":"con_803","$id":"90793991-f317-4bcd-a537-c10fdd246b32","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"51d19a07-e8b9-404d-b5e0-899e4c3bec7c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"172bdd8d-2409-4bc2-8335-09884e2ecb33","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n\nfunction run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"086fb209-4a39-4610-819e-2143b2e56d94","$typeOfContent":"","type":"ExecuteScript","$title":"dadosViagem","$invalid":false,"settings":{"function":"run","source":"\nfunction run(body1, userInput) {\n\ttry {\n\t\tbody1 = JSON.parse(body1).data;\n\t\tlet resultado = body1.find(item => item.nomeContinente == userInput);\n\t\treturn resultado;\n\t}\n\tcatch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":["body1","userInput"],"outputVariable":"dadosViagem","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f082125-b0fd-4f51-9297-74bfc4b4c961","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"6ddbeb43-12a4-4c85-8f4a-04db84d94e8d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1a34c594-828c-4676-9fe4-86a5646f75c7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3d731c68-0cd8-4eaf-a7e5-5a4d0c424aa5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7548c9d1-b093-4564-9068-ef54c1f35dbf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-2a4f6237-694a-47b8-af43-ce288e7f110f","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bfb301d0-af00-478a-bd77-9c75da24cec8","root":false,"$title":"[AV.3.2.0][INPUT] +1 viagens","$position":{"top":"1985.5px","left":"9191px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"947bd984-070d-4a9a-ae7c-cb09ffa221a1":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"ecc621d1-83e4-4dd8-85b3-fb3572477931","type":"text/plain","textContent":"User input","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5d7000e8-4ad5-487e-a6c4-4a9cee1e0022","typeOfStateId":"state","$connId":"con_808","$id":"9434264d-6539-4918-980a-387478b00117","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b17404ea-b22f-4af3-950d-801f6be50465","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"21340c7e-9499-4114-a6bc-bdaa6b4cc34b","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(input) {\n\ttry {\n\t\tinput = JSON.parse(input);\n\t\tconst jsonResponse = input.metadata[\"#wa.interactive.nfm_reply.json_response\"];\n\t\tconst formattedResponse = JSON.parse(jsonResponse);\n\t\treturn formattedResponse;\n\t} catch (error) {\n\t\treturn \"input inesperado\";\n\t}\n}","inputVariables":["input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"236ec20e-47cc-4d9f-a58d-d6a605c57054","$typeOfContent":"","type":"ExecuteScript","$title":"novaViagem","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n\ttry {\n\t\tinput = JSON.parse(input);\n\t\treturn input;\n\t} catch (error) {\n\t\treturn error.message;\n\t}\n}","inputVariables":["userInput"],"outputVariable":"novaViagem","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"900f18a9-e36d-4556-90f0-335fa4438921","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d8d57301-2566-4f08-b0ca-a849e4ddf411","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a4f916ad-bcfb-4aaa-ac41-57fe97021011","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0af98b83-1ea5-4503-9dcb-0b133e641d39","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"947bd984-070d-4a9a-ae7c-cb09ffa221a1","root":false,"$title":"[AV.4.0.0][INPUT] cadastrar nova viagem","$position":{"top":"1880.33px","left":"9533.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"af320c49-148a-4a94-acd0-7e97b9bb7b53":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bd935658-13e5-4181-ac61-f516355b50f4","typeOfStateId":"state","$connId":"con_813","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n    const [ano, mes, dia] = dataStr.split(\"-\");\n    return `${dia}/${mes}/${ano}`;\n}\n\nfunction run(dadosViagem, finalCartao) {\n\ttry {\n\t\tdadosViagem = JSON.parse(dadosViagem);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Alterar viagem\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Fazer novo cadastro\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Você gostaria de excluir o aviso que foi cadastrado para essa viagem?\n\n*${dadosViagem.nomeContinente}*\nFinal do cartão: *${finalCartao}*\n*${formatarData(dadosViagem.dataInicio)}* a *${formatarData(dadosViagem.dataFim)}*`\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["dadosViagem","finalCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1d3baa6a-01f0-41a2-8493-5cae9139061f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dc6f64c4-ff06-42c2-9d64-fdf5ebbd91cc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-52a5ce2e-5692-48e0-85cb-8b7f332c43f2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"af320c49-148a-4a94-acd0-7e97b9bb7b53","root":false,"$title":"[AV.3.3.0][MSG] Excluir viagem","$position":{"top":"2269px","left":"8997px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bd935658-13e5-4181-ac61-f516355b50f4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62f7cee3-13bb-41fc-bac3-dde5f9096c80","typeOfStateId":"state","$connId":"con_818","$id":"9c845735-19c2-447b-9d14-b70f691f6b96","conditions":[{"source":"context","comparison":"equals","values":["Fazer novo cadastro"],"variable":"userInput"}],"$invalid":false},{"stateId":"ad5c2b82-3c5c-44bd-9340-c759b03e83ea","typeOfStateId":"state","$connId":"con_823","$id":"4381e926-27e9-471f-8dab-2c15aab0ba36","conditions":[{"source":"context","comparison":"equals","values":["Alterar viagem"],"variable":"userInput"}],"$invalid":false},{"stateId":"506d0b47-b6a7-4a9c-917d-b47ee718e09e","typeOfStateId":"state","$connId":"con_828","$id":"fec85e6f-fc9b-4c2e-b7cb-0c027ad20f62","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c190a6a8-e19a-47db-b8d1-ab272a927ae9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bffb1130-3e61-4fc3-8c84-9d219c12c8fc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-563f2045-49d2-473d-9dca-31c31552089d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-44fdd3cf-f9cd-4dfd-9608-302af9e759f2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"bd935658-13e5-4181-ac61-f516355b50f4","root":false,"$title":"[AV.3.3.0][INPUT] Excluir viagem","$position":{"top":"2617.33px","left":"8867px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"506d0b47-b6a7-4a9c-917d-b47ee718e09e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c53fa27e-85e5-4f90-912e-a22bdf73b7d6","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d1995144-d09d-46a1-b945-019d449ad389","typeOfStateId":"state","$connId":"con_833","$id":"0da54def-5415-420f-a677-8ea44b93e937","conditions":[{"source":"context","comparison":"contains","values":["200","201","202","204"],"variable":"statusExcluirViagem"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ccc45a18-5d15-4ef5-8ffd-3b31bb9fca24","$typeOfContent":"","type":"SetVariable","$title":"CLEAR statusExcluirViagem","$invalid":false,"settings":{"variable":"statusExcluirViagem"},"conditions":[]},{"$id":"4d03be19-f321-4f16-bb51-923d08a08586","$typeOfContent":"","type":"SetVariable","$title":"CLEAR bodyExcluirViagem","$invalid":false,"settings":{"variable":"bodyExcluirViagem"},"conditions":[]},{"$id":"07e7f3d8-5957-452c-ae4d-74353c25a2a6","$typeOfContent":"","type":"ProcessHttp","$title":"excluir aviso Viagem  \"bodyExcluirViagem\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"PATCH","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/avisos-viagens/{{dadosViagem@idAvisoViagem}}","responseStatusVariable":"statusExcluirViagem","responseBodyVariable":"bodyExcluirViagem","body":"{\n    \"nomeContinente\": \"{{dadosViagem@nomeContinente}}\",\n    \"documento\": \"{{document}}\",\n    \"dataInclusao\": \"{{dadosViagem@dataInclusao}}\",\n    \"acao\": \"cancelar\"\n}"},"conditions":[]},{"$id":"58362d87-177b-40db-9137-5d207e9799ab","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api logs","$invalid":false,"settings":{"extras":{},"action":"{{contact.identity}} | {{statusExcluirViagem}} | {{bodyExcluirViagem}}","category":"{{state.name}} api logs"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9f1b88c9-7e88-4243-9542-dbce24b655b4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d63634c5-250a-4965-8803-5f77ada4b583","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-60279f38-655e-43fd-8d57-6a0362266c6c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"506d0b47-b6a7-4a9c-917d-b47ee718e09e","root":false,"$title":"[AV.5.0.0][HTTP] Excluir aviso viagem","$position":{"top":"2813px","left":"8867.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d1995144-d09d-46a1-b945-019d449ad389":{"$contentActions":[{"action":{"$id":"9ab5e25b-3555-449e-a96e-bdb422ea5954","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4fcf771c-1429-49e0-82ea-1057bd1a98c9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4fcf771c-1429-49e0-82ea-1057bd1a98c9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ddd78ac0-b01d-48f6-9709-b258b3c100e9","$typeOfContent":"text","type":"SendMessage","settings":{"id":"efe610e3-fbb8-41d3-be6a-f1ec5b9ae314","type":"text/plain","content":"Pronto, acabei de excluir o aviso viagem.","metadata":{}},"$cardContent":{"document":{"id":"efe610e3-fbb8-41d3-be6a-f1ec5b9ae314","type":"text/plain","content":"Pronto, acabei de excluir o aviso viagem."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f8ad53b6-e170-4d46-8b1e-d9bbcd32b2b2","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e95d6fa2-067f-45e1-bc57-4f6ad38abbc1","typeOfStateId":"state","$connId":"con_838","$id":"5adbd4b7-8e24-45d9-96bc-5436842934a0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a26b8825-a907-4ae0-9731-bb0c45d1a345","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b54f1c51-2cda-400d-b6b6-4fe813c0a6fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-221deab3-74b3-42ab-840c-b06d138c55ef","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d1995144-d09d-46a1-b945-019d449ad389","root":false,"$title":"[AV.5.1.0][MSG] Excluido com sucesso","$position":{"top":"2990.67px","left":"8866.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e95d6fa2-067f-45e1-bc57-4f6ad38abbc1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d4b7954c-eb1b-4c28-8949-30bc89f3a913","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e95d6fa2-067f-45e1-bc57-4f6ad38abbc1","root":false,"$title":"[GO TO] Ajudo em algo mais?","$position":{"top":"3152px","left":"8866px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5d7000e8-4ad5-487e-a6c4-4a9cee1e0022":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a203c3ce-b141-45d2-aa99-72fce4d0271b","typeOfStateId":"state","$connId":"con_843","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n    const [ano, mes, dia] = dataStr.split(\"-\");\n    return `${dia}/${mes}/${ano}`;\n}\n\nfunction run(aviso, finalCartao) {\n\ttry {\n\t\taviso = JSON.parse(aviso);\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Corrigir\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = `Só confirmando, o aviso viagem será cadastrado no cartão final *${finalCartao}*.\n\n*${formatarData(aviso.dataInicio)}* a *${formatarData(aviso.dataFim)}* com destino à *${aviso.continente}*.\n\nPosso seguir com essas informações?`\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\n","inputVariables":["novaViagem","finalCartao"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d6381061-0e7b-40fc-b0d4-33b849c1d444","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5b50fa88-de4e-4fa6-a896-6337dbb9d852","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7d4ac201-4d0b-421e-93bb-7ef1ac402a71","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5d7000e8-4ad5-487e-a6c4-4a9cee1e0022","root":false,"$title":"[AV.4.1.0][MSG] Confirmar viagem","$position":{"top":"2055px","left":"9534px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a203c3ce-b141-45d2-aa99-72fce4d0271b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"697104f7-187b-49fe-bfa7-3a19c84c2c42","typeOfStateId":"state","$connId":"con_848","$id":"f8caa5b8-58e1-4db6-a9f3-1be4333a6c7d","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"285e4873-e8db-4879-8d30-d27e96edaa5a","typeOfStateId":"state","$connId":"con_853","$id":"b1c46897-9e02-4b63-aa4c-62f60da4dafe","conditions":[{"source":"context","comparison":"equals","values":["Corrigir"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"c9b543bd-2816-41d5-b13b-2b9f0c2e8922","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f05b96ab-3860-4b71-bf8a-366327ce0c9c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f2921d91-bc9c-4d57-be22-a62c5ef181be","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ec18dce6-810f-4f73-9505-a2a93520f33f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7fa7bde5-9d19-4834-9af1-e7870197ceee","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a203c3ce-b141-45d2-aa99-72fce4d0271b","root":false,"$title":"[AV.4.1.0][INPUT] Confirmar viagem","$position":{"top":"2235.75px","left":"9534px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"697104f7-187b-49fe-bfa7-3a19c84c2c42":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de175e3d-5fd6-45f0-b3e1-1a986b68dbb5","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bf0c44c8-0153-4e41-a00e-36d87e510cec","typeOfStateId":"state","$connId":"con_858","$id":"5b887de2-97d9-4fd7-adf6-6e09f68635a8","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"viagemExiste"}],"$invalid":false},{"stateId":"ba646e9b-a223-443d-8b78-426ebf82395d","typeOfStateId":"state","$connId":"con_863","$id":"bea697c5-3e56-4c40-8d95-c63b54054578","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"5a2e6a28-80fc-488b-8a09-554f107f96d9","$typeOfContent":"","type":"ExecuteScript","$title":"viagemExiste","$invalid":false,"settings":{"function":"run","source":"\nfunction run(body1, userInput) {\n\ttry {\n\t\tbody1 = JSON.parse(body1).data;\n\t\tlet resultado = body1.find(item => item.nomeContinente == userInput.continente && item.dataInicio == userInput.dataInicio && item.dataFim == userInput.dataFim);\n\t\tif (resultado) {\n\t\t\treturn resultado\n\t\t}\n\t\treturn false\n\t}\n\tcatch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["body1","userInput"],"outputVariable":"viagemExiste","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f30702fb-de72-4444-87ff-031691138903","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"35d2b39c-b0d4-48c2-bd9b-8d7a770b8f55","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} existe\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} existe","action":"{{viagemExiste}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"viagemExiste"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-86dd16a2-0cd6-4092-8aed-bf06433eb244","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b3d2de68-b27a-48af-91ca-87f0227017d9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"697104f7-187b-49fe-bfa7-3a19c84c2c42","root":false,"$title":"[AV.4.2.0][SET] Viagem já existe?","$position":{"top":"2428.14px","left":"9534.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"285e4873-e8db-4879-8d30-d27e96edaa5a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"1f0268d9-c06e-4928-bebb-9c84fde57bbb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3c74a6bb-7d46-4a46-a2bf-d5d3136772f6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"285e4873-e8db-4879-8d30-d27e96edaa5a","root":false,"$title":"[GO TO] cadastrar nova viagem ","$position":{"top":"2306.14px","left":"9773.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bf0c44c8-0153-4e41-a00e-36d87e510cec":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ce6ca3d-f9ed-4248-9208-2e79f4e79c29","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2632f134-f180-4112-82d6-016aebc18d58","typeOfStateId":"state","$connId":"con_868","$id":"0af6a7ca-7046-4496-9e56-aaeb97586772","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"alteracaoViagem"}],"$invalid":false},{"stateId":"4cc50182-25ca-464a-b81b-c974e706ad7a","typeOfStateId":"state","$connId":"con_873","$id":"703043c4-68da-4890-8ff6-98885d160e7b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f17521f0-a1ee-42d4-ac50-8034130157f0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"50e61d78-f150-4cbc-9a66-01b458ec0834","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} alteracao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} alteracao","action":"alteracaoViagem"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-837151a6-90c6-433d-80eb-14c2688cd04c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"bf0c44c8-0153-4e41-a00e-36d87e510cec","root":false,"$title":"[AV.4.3.0][SET] É Alteracao de viagem?","$position":{"top":"2620px","left":"9399px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ba646e9b-a223-443d-8b78-426ebf82395d":{"$contentActions":[{"action":{"$id":"5bc23d17-f30c-4a3f-bdbd-59b3f1e14d86","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"82f80158-15e7-4c89-8ad7-fa29545a92d6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"82f80158-15e7-4c89-8ad7-fa29545a92d6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ae939166-4bd6-4136-861e-29a1bd25498e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f13b4406-1074-46dc-bb35-af00c0cd0e84","type":"text/plain","content":"Vi que você já cadastrou um aviso viagem para essa data.\n","metadata":{}},"$cardContent":{"document":{"id":"f13b4406-1074-46dc-bb35-af00c0cd0e84","type":"text/plain","content":"Vi que você já cadastrou um aviso viagem para essa data.\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"05f5dff6-1fac-4317-a4ee-eb1c474a1c06","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e885f5b9-e972-46e5-b206-778ed14367ba","typeOfStateId":"state","$connId":"con_878","$id":"0db8dbe8-f83d-4f02-9f90-d5db65bb3dd3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b5449feb-8aaf-4532-aef5-7520bcac202c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-87a80e64-821f-4694-9e79-97fc0c396f2e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-84f3398b-b794-411d-bac4-05f4afac2a00","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ba646e9b-a223-443d-8b78-426ebf82395d","root":false,"$title":"[AV.4.4.0][MSG]Viagem já existe na data","$position":{"top":"2654.25px","left":"9846.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e885f5b9-e972-46e5-b206-778ed14367ba":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"62b02d83-586d-414c-8215-dbe6fff50bc1","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d8256fb6-1352-4501-8403-ba7195d9001e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e885f5b9-e972-46e5-b206-778ed14367ba","root":false,"$title":"[GO TO] alteracao da viagem   ","$position":{"top":"2819.25px","left":"9846.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2632f134-f180-4112-82d6-016aebc18d58":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c53fa27e-85e5-4f90-912e-a22bdf73b7d6","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4cc50182-25ca-464a-b81b-c974e706ad7a","typeOfStateId":"state","$connId":"con_883","$id":"0da54def-5415-420f-a677-8ea44b93e937","conditions":[{"source":"context","comparison":"contains","values":["200","201","202","204"],"variable":"statusExcluirViagem"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"638e3369-2f1c-42ed-8186-44731cb8073d","$typeOfContent":"","type":"SetVariable","$title":"CLEAR bodyExcluirViagem","$invalid":false,"settings":{"variable":"bodyExcluirViagem"},"conditions":[]},{"$id":"ba61b21b-51fc-46bc-8670-56d1ad37f0d4","$typeOfContent":"","type":"SetVariable","$title":"CLEAR statusExcluirViagem","$invalid":false,"settings":{"variable":"statusExcluirViagem"},"conditions":[]},{"$id":"07e7f3d8-5957-452c-ae4d-74353c25a2a6","$typeOfContent":"","type":"ProcessHttp","$title":"excluir aviso Viagem  \"bodyExcluirViagem\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"PATCH","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/avisos-viagens/{{dadosViagem@idAvisoViagem}}","responseStatusVariable":"statusExcluirViagem","responseBodyVariable":"bodyExcluirViagem","body":"{\n    \"nomeContinente\": \"{{dadosViagem@nomeContinente}}\",\n    \"documento\": \"{{document}}\",\n    \"dataInclusao\": \"{{dadosViagem@dataInclusao}}\",\n    \"acao\": \"cancelar\"\n}"},"conditions":[]},{"$id":"833749a1-6e65-477c-8d8f-61f288030763","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api logs","$invalid":false,"settings":{"extras":{},"action":"{{contact.identity}} | {{statusExcluirViagem}} | {{bodyExcluirViagem}}","category":"{{state.name}} api logs"},"conditions":[]},{"$id":"c749423c-1e97-4905-afb2-6ea576dc13d3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8fd84c6e-6d27-4174-aa54-2bcfeccb7df7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-cd7d14a6-7e13-4538-b879-d41fa54fc176","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-461adc1a-21ba-4c1a-a878-41548a613307","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"2632f134-f180-4112-82d6-016aebc18d58","root":false,"$title":"[AV.6.0.0][HTTP] Excluir aviso viagem antigo","$position":{"top":"2900.75px","left":"9243.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4cc50182-25ca-464a-b81b-c974e706ad7a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c53fa27e-85e5-4f90-912e-a22bdf73b7d6","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e03f933a-51a5-4100-982f-5a538a21dc47","typeOfStateId":"state","$connId":"con_888","$id":"c7bdbcfd-e9ab-45bb-8c83-3ae471867bd6","conditions":[{"source":"context","comparison":"contains","values":["200","201","202","204"],"variable":"statusCriarViagem"}],"$invalid":false},{"stateId":"b11691d4-da8b-42fd-b719-70c277b76dec","typeOfStateId":"state","$connId":"con_893","$id":"74907870-5338-40fb-8e9d-7462c34607c6","conditions":[{"source":"context","comparison":"equals","values":["422"],"variable":"statusCriarViagem"},{"values":["Já existe um aviso viagem"],"source":"context","comparison":"contains","variable":"bodyCriarViagem@code"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4a0c6ed7-6feb-4a73-8eb6-121b9aff93a7","$typeOfContent":"","type":"SetVariable","$title":"CLEAR statusCriarViagem","$invalid":false,"settings":{"variable":"statusCriarViagem"},"conditions":[]},{"$id":"b5117c07-0b92-4fe8-a398-764f307baa1f","$typeOfContent":"","type":"SetVariable","$title":"CLEAR bodyCriarViagem","$invalid":false,"settings":{"variable":"bodyCriarViagem"},"conditions":[]},{"$id":"07e7f3d8-5957-452c-ae4d-74353c25a2a6","$typeOfContent":"","type":"ProcessHttp","$title":"criar aviso Viagem  \"bodyCriarViagem\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/cartoes/dados-cartoes-creditos-clientes/assistente-virtual/v1/avisos-viagens","responseStatusVariable":"statusCriarViagem","responseBodyVariable":"bodyCriarViagem","body":"{\n    \"numeroCartao\": \"{{finalCartao}}\",\n    \"nomeContinente\": \"{{novaViagem@continente}}\",\n    \"dataInicio\": \"{{novaViagem@dataInicio}}\",\n    \"dataFim\":  \"{{novaViagem@dataFim}}\",\n    \"documento\": \"{{document}}\",\n    \"nomePortador\": \"{{customerName}}\"\n}"},"conditions":[]},{"$id":"deccb11e-ef9a-4324-b193-5c8807b95b0c","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api logs","$invalid":false,"settings":{"extras":{},"action":"{{contact.identity}} | {{statusCriarViagem}} | {{bodyCriarViagem}}","category":"{{state.name}} api logs"},"conditions":[]},{"$id":"567c428f-3ff5-46f8-9475-8de5a96a6fe4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-40fe14aa-e1f6-4c37-abe7-81395c309e96","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-321d2a93-2ce8-4437-a693-f0cbaaa6c12c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c139dc58-5adb-4753-ad13-b51377982b6b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4cc50182-25ca-464a-b81b-c974e706ad7a","root":false,"$title":"[AV.6.1.0][HTTP] Cadastrar nova viagem","$position":{"top":"2901px","left":"9561px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e03f933a-51a5-4100-982f-5a538a21dc47":{"$contentActions":[{"action":{"$id":"5ed195e9-d76a-4e42-b797-c09acf750ea6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"34358468-86ca-41b5-a48e-ad717bc205ca","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"34358468-86ca-41b5-a48e-ad717bc205ca","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3177793c-70c0-4c28-a812-a52e64e530d2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"1810af7f-f041-4a9c-b643-cf27de053712","type":"text/plain","content":"Pronto, já cadastrei o aviso viagem.\n\nLembre-se: as compras realizadas neste cartao devem ser feitas em moedas estrangeiras,\ncompras em reais não serão aprovadas.\n\n","metadata":{}},"$cardContent":{"document":{"id":"1810af7f-f041-4a9c-b643-cf27de053712","type":"text/plain","content":"Pronto, já cadastrei o aviso viagem.\n\nLembre-se: as compras realizadas neste cartao devem ser feitas em moedas estrangeiras,\ncompras em reais não serão aprovadas.\n\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"085db519-cff0-4493-bcd0-40215ba84ec0","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"37a56e9f-60e3-4ea5-99a3-b2bb4580c5fb","typeOfStateId":"state","$connId":"con_898","$id":"0db76979-f133-4539-bd02-10d4f0c11e62","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ab19ef72-0f04-4cf9-985c-dd18842afba5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7d0cb469-4d90-443b-bf61-a81471ffce27","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bed6f790-34b4-4c2d-a377-3c18ac2dad1a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e03f933a-51a5-4100-982f-5a538a21dc47","root":false,"$title":"[AV.6.2.0][MSG] sucesso aviso viagem criado","$position":{"top":"3068px","left":"9561px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"37a56e9f-60e3-4ea5-99a3-b2bb4580c5fb":{"$contentActions":[{"action":{"$id":"8f864442-e356-4983-bb5b-7f3b708a3576","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"eebdc261-1c1d-4ffe-9054-62230c4577e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"eebdc261-1c1d-4ffe-9054-62230c4577e9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"023476db-3751-439b-8cb0-edf76e809217","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"133a39b8-faba-481d-9790-946f27590d51","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"87fd84d7-a595-4817-8bd5-cec8879ebd14","typeOfStateId":"state","$connId":"con_903","$id":"0ccc7fba-223b-471a-80af-59688572f360","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"80adbdde-97bb-4013-a3eb-1b73ed50076c","$typeOfContent":"","type":"ExecuteScript","$title":"dynamicContent","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"texto do corpo do conteúdo interativo\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"x\",\n        \"url\": \"x\"\n      }\n    }\n  }\n}\n\nfunction run() {\n  try {\n    dynamicContent.interactive.body.text = `Você gostaria de ter mais segurança e tranquilidade durante sua viagem?\n\nToque no botão abaixo para conhecer o seguro viagem.`\n    dynamicContent.interactive.action.parameters.display_text = `Saber mais`\n    dynamicContent.interactive.action.parameters.url = `https://www.safra.com.br/servicos/pessoa-fisica/seguros.htm`\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"93fba05e-b04a-4127-a332-13ec4f441a55","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a6993df7-6914-4d7a-b8ee-41274b553ca0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ee11bef5-1976-4c0e-8710-2a15ee8c8ae8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1278bd73-589a-45a7-8c8d-5e7aa4f49873","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"37a56e9f-60e3-4ea5-99a3-b2bb4580c5fb","root":false,"$title":"[AV.6.3.0][MSG] propaganda app","$position":{"top":"3255px","left":"9562px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"87fd84d7-a595-4817-8bd5-cec8879ebd14":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2713b8f7-2ecd-4337-8c2b-a5f17ac93f9c","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"87fd84d7-a595-4817-8bd5-cec8879ebd14","root":false,"$title":"[GO TO] ajuda em algo mais?","$position":{"top":"3458px","left":"9562px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"88515150-19e1-4255-94bc-f58d6250c8f3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d21daf6a-42cf-4149-8fff-1fd26663e67f","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7ba6f5dd-2292-4918-b0e7-4a1e3b77b9d2","typeOfStateId":"state","$connId":"con_908","$id":"9c83f75c-668e-40d4-8624-6044d0d0254e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b4f557e0-3c46-452a-b9e5-a860103931cf","$typeOfContent":"","type":"SetVariable","$title":"CLEAR alteracaoViagem","$invalid":false,"settings":{"variable":"alteracaoViagem","value":""},"conditions":[]},{"$id":"4722039e-da43-4c65-bfec-d934f54462a8","$typeOfContent":"","type":"SetVariable","$title":"CLEAR novaViagem","$invalid":false,"settings":{"variable":"novaViagem","value":""},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d233474c-9482-4403-870c-9466faad6e2c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"88515150-19e1-4255-94bc-f58d6250c8f3","root":false,"$title":"[SET] Limpa todas variaveis chaves","$position":{"top":"731px","left":"9111px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b11691d4-da8b-42fd-b719-70c277b76dec":{"$contentActions":[{"action":{"$id":"5bc23d17-f30c-4a3f-bdbd-59b3f1e14d86","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"82f80158-15e7-4c89-8ad7-fa29545a92d6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"82f80158-15e7-4c89-8ad7-fa29545a92d6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ae939166-4bd6-4136-861e-29a1bd25498e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f13b4406-1074-46dc-bb35-af00c0cd0e84","type":"text/plain","content":"Vi que você já cadastrou um aviso viagem para essa data.","metadata":{}},"$cardContent":{"document":{"id":"f13b4406-1074-46dc-bb35-af00c0cd0e84","type":"text/plain","content":"Vi que você já cadastrou um aviso viagem para essa data."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"05f5dff6-1fac-4317-a4ee-eb1c474a1c06","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e885f5b9-e972-46e5-b206-778ed14367ba","typeOfStateId":"state","$connId":"con_913","$id":"0db8dbe8-f83d-4f02-9f90-d5db65bb3dd3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6e8185d1-cc70-47ba-a3a6-cfd6be00422d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-082cef07-42df-4737-b54a-7e1683713647","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f9120f48-4bcb-42fb-b26a-7699aaab60cd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b11691d4-da8b-42fd-b719-70c277b76dec","root":false,"$title":"[AV.4.4.1][MSG]Viagem já existe no periodo","$position":{"top":"2955px","left":"9845.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b3f2013b-235f-4233-832a-e0674c616674":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4db89b2f-6610-4fef-a60d-397cfa0acb20","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","typeOfStateId":"state","$connId":"con_918","$id":"89d71240-6f55-4031-97de-0d19c5402a93","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"b3f2013b-235f-4233-832a-e0674c616674","root":false,"$title":"[Inicio] Ajudo em algo mais?","$position":{"top":"967px","left":"1582px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"854db96d-80e9-4a05-888c-c1fbd8e67ba1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c606331c-9875-44ec-bdb4-da4571c9dd01","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8c0ff684-598d-47b9-8204-9512a1aeb9e0","typeOfStateId":"state","$connId":"con_923","$id":"a78c027b-40db-464b-8ffc-659e1ed74f06","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"854db96d-80e9-4a05-888c-c1fbd8e67ba1","root":false,"$title":"[Inicio] Envio comprovante","$position":{"top":"611px","left":"10352px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c0ff684-598d-47b9-8204-9512a1aeb9e0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"54fae3fa-ae12-476c-99e4-18601c9a09c8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"63b16dc7-c525-419f-b365-707e8787a800","typeOfStateId":"state","$connId":"con_928","$id":"ac43fe69-3261-440c-b31c-b0487bbf3412","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"config.OSADesligado"}],"$invalid":false},{"stateId":"63b16dc7-c525-419f-b365-707e8787a800","typeOfStateId":"state","$connId":"con_933","$id":"f36f66c9-b4bb-47e7-8ff4-818754f6c5ae","conditions":[{"source":"context","comparison":"equals","values":["APROVAR"],"variable":"authResponse@data.acao"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0ed4b1dc-7069-460a-9a53-dae10519de22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"9bd38869-79e8-4e2b-aa67-4ef778a15c93","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79e88a01-0329-40a4-a71b-99f407eb34f9","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"87e8fbab-0ded-4c37-876e-a65fd7c82cf9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyAuth\"","$invalid":false,"settings":{"function":"run","source":"function run( identity, contas, clientData) {\n\ttry {\n\t\tconst { codigoCliente } = JSON.parse(contas).accounts[0]\n\t\tconst { nomeCliente } = JSON.parse(clientData).data\n\t\treturn {\n\t\t\t\"transacao\": \"ENVIO_COMPROVANTE\",\n\t\t\t\"cliente\": {\n\t\t\t\t\"numeroCelular\": identity.split('@')[0],\n\t\t\t\t// \"numeroCelular\": '5511954124433',\n\t\t\t\t\"cpf\": codigoCliente,\n\t\t\t\t// \"cpf\": \"000000285\",\n\t\t\t\t\"nome\": nomeCliente\n\t\t\t\t// \"nome\": \"EMANUEL SILVA\"\n\t\t\t},\n\t\t\t\"bot\": {}\n\t\t}\n\t} catch (err) {\n\t\treturn false\n\t}\n}\n","inputVariables":["contact.identity","customerAccounts","responseClientData"],"outputVariable":"bodyAuth","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aa680bbe-15a0-47b9-ad4a-609ff1474279","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"Bearer {{bodyToken@access_token}}","Safra-Correlation-ID":"{{random.guid}}","Content-Type":"application/json"},"method":"POST","uri":"{{config.baseURL}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authStatus","responseBodyVariable":"authResponse","body":"{{bodyAuth}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"c5187674-7a06-4fa9-86b2-3b28e7eee5a4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato","action":"extrato | {{state.name}} | {{authStatus}} | {{authResponse@data.acao}}"},"conditions":[]},{"$id":"c9971b31-adb1-4a90-ac34-d2236f36a6ec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"api autenticacao extrato resumo\"","$invalid":false,"settings":{"extras":{},"category":"api autenticacao extrato resumo","action":"{{state.name}} | {{contact.identity}} | {{bodyAuth}} | {{authStatus}} | {{authResponse}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"94ba7949-9cc9-457e-a542-2f3a8d76ee33","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-08cf98e1-50e2-43b5-b641-56a091913e67","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6777f32f-45fa-4130-a13b-7b8783a4c768","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0cfddc0c-7ff6-4c20-b887-19755fccbe9a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"8c0ff684-598d-47b9-8204-9512a1aeb9e0","root":false,"$title":"[HTTP] Autenticação OSA","$position":{"top":"793px","left":"10351px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8cf3a933-2468-40b1-80e7-2adbddcb8c6c":{"$contentActions":[{"action":{"$id":"c2e2aa97-b7f7-4109-aa5e-b5f8ff075ebb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4d12f446-d63a-4c9c-8bd5-b2af1809a3a3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31a774e3-1d14-4de6-bf94-f2e868f9f018","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 90 dias mesmo?","metadata":{}},"$cardContent":{"document":{"id":"e61f666f-8acf-4b5e-8d09-6fda3d44d0c8","type":"text/plain","content":"Você precisa de algum período específico ou posso te mandar dos últimos 90 dias mesmo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"c3010671-a4a8-40a4-bba4-45ecfb8bf0dc","type":"text/plain","textContent":"Entrada do usuário","content":"User input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"fc320b0d-42e4-4971-adb7-4cc57898ea06","typeOfStateId":"state","$connId":"con_938","$id":"7d932bee-eec1-4f19-af13-fb5eab80f880","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"c42adbc3-7434-4ba0-bdce-f7172bacdf40","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"e76430f7-cb8b-4478-9bcb-6a05067eb541","$typeOfContent":"","type":"SetVariable","$title":"CLEAR bodySmallTalks","$invalid":false,"settings":{"variable":"bodySmallTalks"},"conditions":[]}],"$leavingCustomActions":[{"$id":"0712b494-8a61-4a94-80ab-209d809772f0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"c7061a97-06e9-4fd0-8100-10fdf9125a23","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"995488b5-5f08-4fb8-955f-99bd494b8e7d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"77b7583c-b68c-497b-ae55-63100f6eb90a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, statePreviousId, smalltalks) {\n  try {\n    if (smalltalks && smalltalks.includes(\"Confirmation\")) {\n      const currentDate = new Date();\n      const endDate = currentDate;\n      const startDate = new Date(currentDate.getTime() - 90 * 24 * 60 * 60 * 1000);\n      return `${formatDate(startDate)}|${formatDate(endDate)}`;\n    }\n\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n        return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n\n      return `${formatDate(startDate)}|${formatDate(endDate)}`; // Retorna as datas \n    } else {\n      return { error: 'extratoDataInvalida' };\n    }\n\n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","state.previous.id","bodySmallTalks"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7983a498-f155-4bb5-b2e7-1ff4319ca416","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dataExtractor@error\"","$invalid":false,"settings":{"variable":"exceptionType","value":"{{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1917ddbf-b021-4f67-93a0-7d77bc0bc4c4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d60570d8-a194-44f4-8133-637912ab87bc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9c7e87dd-1bde-4b0b-b4e0-e6616bd3d543","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-257b3787-9a98-4c2f-a9f7-0e9da975ab90","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-233a51e6-84d6-47d4-b663-19489f88d129","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-b8b79923-14a7-4798-a66e-7d8c71bfaa81","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"8cf3a933-2468-40b1-80e7-2adbddcb8c6c","root":false,"$title":"[EC.2.0.0][MSG][INPUT] Pergunta periodo","$position":{"top":"1005px","left":"10768px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"63b16dc7-c525-419f-b365-707e8787a800":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"85a9c4c8-745d-4f90-84fb-0d7054fe9048","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8cf3a933-2468-40b1-80e7-2adbddcb8c6c","typeOfStateId":"state","$connId":"con_943","$id":"0799e07e-6c68-4d66-93db-731882a29c75","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["extratoDataInvalida"],"source":"context","comparison":"equals","variable":"dataExtractor@error"},{"values":["871d7bbd-2b33-4a84-b028-b6e692ed9510"],"source":"context","comparison":"notEquals","variable":"state.previous.id"}],"$invalid":false},{"stateId":"fc320b0d-42e4-4971-adb7-4cc57898ea06","typeOfStateId":"state","$connId":"con_948","$id":"684758e1-01af-41cd-a10c-8e71515ff988","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1e6bd2c1-66d3-490f-9fd8-414b7ab0c81b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"exibicao"},"conditions":[]},{"$id":"8e5c42e8-afdc-47ed-a38d-9f0ce3f6b929","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataExtractor\"","$invalid":false,"settings":{"function":"run","source":"function run(input, statePreviousId, smalltalks) {\n  try {\n    if (smalltalks && smalltalks.includes(\"Confirmation\") && statePreviousId === '8cf3a933-2468-40b1-80e7-2adbddcb8c6c') {\n      const currentDate = new Date();\n      const endDate = currentDate;\n      const startDate = new Date(currentDate.getTime() - 90 * 24 * 60 * 60 * 1000);\n      return `${formatDate(startDate)}|${formatDate(endDate)}`;\n    }\n\n    const months = {\n      janeiro: '01', fevereiro: '02', março: '03', abril: '04', maio: '05', junho: '06',\n      julho: '07', agosto: '08', setembro: '09', outubro: '10', novembro: '11', dezembro: '12',\n      jan: '01', fev: '02', mar: '03', abr: '04', mai: '05', jun: '06', jul: '07', ago: '08',\n      set: '09', out: '10', nov: '11', dez: '12'\n    };\n    const monthsRegex = '(janeiro|jan|fevereiro|fev|março|mar|abril|abr|maio|mai|junho|jun|julho|jul|agosto|ago|setembro|set|outubro|out|novembro|nov|dezembro|dez)';\n    const numbersInWords = {\n      um: 1, dois: 2, três: 3, quatro: 4, cinco: 5, seis: 6, sete: 7, oito: 8, nove: 9,\n      dez: 10, onze: 11, doze: 12, treze: 13, quatorze: 14, quinze: 15, dezesseis: 16, dezessete: 17,\n      dezoito: 18, dezenove: 19, vinte: 20, \"vinte e um\": 21, \"vinte e dois\": 22, \"vinte e três\": 23,\n      \"vinte e quatro\": 24, \"vinte e cinco\": 25, \"vinte e seis\": 26, \"vinte e sete\": 27, \"vinte e oito\": 28,\n      \"vinte e nove\": 29, trinta: 30, \"trinta e um\": 31, \"trinta e dois\": 32, \"trinta e três\": 33,\n      \"trinta e quatro\": 34, \"trinta e cinco\": 35, \"trinta e seis\": 36, \"trinta e sete\": 37,\n      \"trinta e oito\": 38, \"trinta e nove\": 39, quarenta: 40, \"quarenta e um\": 41, \"quarenta e dois\": 42,\n      \"quarenta e três\": 43, \"quarenta e quatro\": 44, \"quarenta e cinco\": 45, \"quarenta e seis\": 46,\n      \"quarenta e sete\": 47, \"quarenta e oito\": 48, \"quarenta e nove\": 49, cinquenta: 50,\n      \"cinquenta e um\": 51, \"cinquenta e dois\": 52, \"cinquenta e três\": 53, \"cinquenta e quatro\": 54,\n      \"cinquenta e cinco\": 55, \"cinquenta e seis\": 56, \"cinquenta e sete\": 57, \"cinquenta e oito\": 58,\n      \"cinquenta e nove\": 59, sessenta: 60, \"sessenta e um\": 61, \"sessenta e dois\": 62,\n      \"sessenta e três\": 63, \"sessenta e quatro\": 64, \"sessenta e cinco\": 65, \"sessenta e seis\": 66,\n      \"sessenta e sete\": 67, \"sessenta e oito\": 68, \"sessenta e nove\": 69, setenta: 70, \"setenta e um\": 71,\n      \"setenta e dois\": 72, \"setenta e três\": 73, \"setenta e quatro\": 74, \"setenta e cinco\": 75,\n      \"setenta e seis\": 76, \"setenta e sete\": 77, \"setenta e oito\": 78, \"setenta e nove\": 79, oitenta: 80,\n      \"oitenta e um\": 81, \"oitenta e dois\": 82, \"oitenta e três\": 83, \"oitenta e quatro\": 84,\n      \"oitenta e cinco\": 85, \"oitenta e seis\": 86, \"oitenta e sete\": 87, \"oitenta e oito\": 88,\n      \"oitenta e nove\": 89, noventa: 90\n    };\n\n\n    const currentDate = new Date();\n    const currentMonth = currentDate.getMonth();\n    const currentYear = currentDate.getFullYear();\n    const ninetyDaysInMillis = 90 * 24 * 60 * 60 * 1000;\n\n    function parseDate(dateStr) {\n      let [day, month, year] = dateStr.split('/');\n      day = day.padStart(2, '0');\n      month = month.padStart(2, '0');\n      year = year ? (year.length === 2 ? '20' + year : year) : currentDate.getFullYear();\n      return new Date(year, month - 1, day);\n    }\n\n    function formatDate(date) {\n      const day = String(date.getDate()).padStart(2, '0');\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const year = date.getFullYear();\n      return `${year}-${month}-${day}`;\n    }\n\n    function getMonthNumber(monthName) {\n      return months[monthName.toLowerCase()];\n    }\n\n    function getNumberFromWords(word) {\n      return numbersInWords[word.toLowerCase()];\n    }\n\n    function extractDates(text) {\n      text = text.toLowerCase();\n\n      // Verifica ultimos X dias\n      let match = text.match(/[uú]ltimos (\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica ultimos X dias por extenso\n      match = text.match(new RegExp(`últimos (${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos de meses por extenso\n      match = text.match(new RegExp(`de (${monthsRegex}) (at[eé]|a) (${monthsRegex})`, 'i'));\n      if (match) {\n        const startMonth = getMonthNumber(match[1]);\n        const endMonth = getMonthNumber(match[5]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${startMonth}/${year}`);\n        const endDate = new Date(year, parseInt(endMonth, 10), 0);\n        return [startDate, endDate];\n      }\n\n      // Verifica frases com mês por extenso\n      match = text.match(new RegExp('de (' + monthsRegex + ')', 'i'));\n      if (match) {\n        const month = getMonthNumber(match[1]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`01/${month}/${year}`);\n        const endDate = new Date(year, parseInt(month, 10), 0);\n        if (currentDate.getMonth() + 1 === parseInt(month, 10)) {\n          // Se o mês solicitado é o mês atual\n          return [startDate, currentDate];\n        }\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"do dia D de M até o dia D de M\"\n      match = text.match(/do dia (\\d{1,2}) de (${monthsRegex}) (?:ao|até) (?:o|a) dia (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[3].padStart(2, '0');\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[4]);\n        const year = currentDate.getFullYear();\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato \"dia D até dia D\"\n      match = text.match(/(\\d{1,2}) de (${monthsRegex}) (at[eé]|a) (\\d{1,2}) de (${monthsRegex})/i);\n      if (match) {\n        let startDay = match[1].padStart(2, '0');\n        let endDay = match[4].padStart(2, '0'); // Corrigido para usar match[4]\n        const startMonth = getMonthNumber(match[2]);\n        const endMonth = getMonthNumber(match[5]); // Corrigido para usar match[5]\n        const year = currentDate.getFullYear(); // Mantenha o ano atual\n        const startDate = parseDate(`${startDay}/${startMonth}/${year}`);\n        const endDate = parseDate(`${endDay}/${endMonth}/${year}`);\n        return [startDate, endDate];\n      }\n\n      // Verifica intervalos no formato DD/MM até DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}) (at[eé]|a) (\\d{1,2}\\/\\d{1,2})/i);\n      if (match) {\n        const year = currentDate.getFullYear();\n        return [parseDate(`${match[1]}/${year}`), parseDate(`${match[3]}/${year}`)];\n      }\n\n      // Verifica intervalos no formato MM/AAAA até MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{4}) (at[eé]|a) (\\d{1,2}\\/\\d{4})/i);\n      if (match) {\n        const [endMonth, endYear] = match[3].split('/');\n        const endDate = new Date(endYear, endMonth, 0); // O dia 0 do próximo mês é o último dia do mês anterior\n        const lastDay = endDate.getDate();\n\n        return [parseDate(`01/${match[1]}`), parseDate(`${lastDay}/${match[3]}`)];\n      }\n\n      // Verifica data no formato \"dia D\"\n      match = text.match(/dia (\\d{1,2})/i);\n      if (match) {\n        const day = match[1].padStart(2, '0');\n        const month = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const year = currentDate.getFullYear();\n        return [parseDate(`${day}/${month}/${year}`)];\n      }\n\n      // Verifica último mês ou mês passado\n      match = text.match(/([úu]ltimo|m[eê]s) passad(o)/i);\n      if (match) {\n        const lastMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);\n        const lastMonthEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);\n        return [lastMonthStartDate, lastMonthEndDate];\n      }\n\n      // Verifica \"dessa semana\" ou \"essa semana\"\n      match = text.match(/(dessa semana|essa semana)/i);\n      if (match) {\n        const weekStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() + 1);\n        return [weekStartDate, currentDate];\n      }\n\n      // Verifica semana passada\n      match = text.match(/semana passada/i);\n      if (match) {\n        const lastWeekEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const lastWeekStartDate = new Date(lastWeekEndDate.getFullYear(), lastWeekEndDate.getMonth(), lastWeekEndDate.getDate() - 6);\n        return [lastWeekStartDate, lastWeekEndDate];\n      }\n\n      // Verifica semana retrasada\n      match = text.match(/semana retrasada/i);\n      if (match) {\n        const twoWeeksAgoEndDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay() - 7);\n        const twoWeeksAgoStartDate = new Date(twoWeeksAgoEndDate.getFullYear(), twoWeeksAgoEndDate.getMonth(), twoWeeksAgoEndDate.getDate() - 6);\n        return [twoWeeksAgoStartDate, twoWeeksAgoEndDate];\n      }\n\n      // Verifica deste mês\n      match = text.match(/[d]?esse m[eê]s|m[eê]s atual/i);\n      if (match) {\n        const thisMonthStartDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        return [thisMonthStartDate, currentDate];\n      }\n\n      // Verifica último trimestre ou trimestre passado\n      match = text.match(/([úu]ltim(a|o)|trimestre) (passad(a|o)|trimestre)/i);\n      if (match) {\n        const currentQuarter = Math.floor(currentMonth / 3) + 1;\n        let lastQuarter, lastQuarterYear;\n        if (currentQuarter === 1) {\n          lastQuarter = 4;\n          lastQuarterYear = currentYear - 1;\n        } else {\n          lastQuarter = currentQuarter - 1;\n          lastQuarterYear = currentYear;\n        }\n        const startMonthX = (lastQuarter - 1) * 3;\n        const endMonthX = startMonthX + 2;\n        const lastQuarterStartDate = new Date(lastQuarterYear, startMonthX, 1);\n        const lastQuarterEndDate = new Date(lastQuarterYear, endMonthX + 1, 0);\n        return [lastQuarterStartDate, lastQuarterEndDate];\n      }\n\n      // Verifica último bimestre ou bimestre passado\n      match = text.match(/([úu]ltim(a|o)|bimestre) (passad(a|o)|bimestre)/i);\n      if (match) {\n        const currentBimester = Math.floor(currentMonth / 2) + 1;\n        let lastBimester, lastBimesterYear;\n        if (currentBimester === 1) {\n          lastBimester = 6;\n          lastBimesterYear = currentYear - 1;\n        } else {\n          lastBimester = currentBimester - 1;\n          lastBimesterYear = currentYear;\n        }\n        const startMonth = (lastBimester - 1) * 2;\n        const endMonth = startMonth + 1;\n        const lastBimesterStartDate = new Date(lastBimesterYear, startMonth, 1);\n        const lastBimesterEndDate = new Date(lastBimesterYear, endMonth + 1, 0);\n        return [lastBimesterStartDate, lastBimesterEndDate];\n      }\n\n      // Verifica X dias\n      match = text.match(/(\\d{1,4}) dias/i);\n      if (match) {\n        const numberOfDays = parseInt(match[1], 10);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica X dias por extenso\n      match = text.match(new RegExp(`(${Object.keys(numbersInWords).join('|')}) dias`, 'i'));\n      if (match) {\n        const numberOfDays = getNumberFromWords(match[1]);\n        const endDate = currentDate;\n        const startDate = new Date(endDate.getTime() - numberOfDays * 24 * 60 * 60 * 1000);\n        return ([startDate, endDate]);\n      }\n\n      // Verifica hoje\n      match = text.match(/de hoje|(hoje)/i);\n      if (match) {\n        return [currentDate, currentDate];\n      }\n\n      // Verifica ontem\n      match = text.match(/de ontem|(ontem)/i);\n      if (match) {\n        let yesterday = new Date();\n        yesterday.setDate(yesterday.getDate() - 1);\n        return [yesterday, yesterday];\n      }\n\n      // Verifica datas no formato DD/MM/AAAA\n      match = text.match(/(\\d{1,2}\\/\\d{1,2}\\/\\d{2,4})/g);\n      if (match) return match.map(date => parseDate(date));\n\n      // Verifica datas no formato DD/MM\n      match = text.match(/(\\d{1,2}\\/\\d{1,2})/g);\n      if (match) {\n        return match.map(dateStr => parseDate(`${dateStr}/${currentDate.getFullYear()}`));\n      }\n\n      return [];\n    }\n\n    const dates = extractDates(input);\n\n    if (dates.length === 1) {\n      const startDate = dates[0];\n      const endDate = new Date();\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > endDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      return formatDate(dates[0]);\n    } else if (dates.length === 2) {\n      const actualDate = new Date();\n      const startDate = dates[0];\n      const endDate = dates[1];\n      const diffInMillis = endDate - startDate;\n      if (diffInMillis < 0 || startDate > actualDate || endDate > actualDate) {\n        return { error: 'extratoLancamentoFuturo' };\n      }\n      const twoYearsAgo = new Date(actualDate.getFullYear() - 2, actualDate.getMonth(), actualDate.getDate());\n      if (startDate < twoYearsAgo) {\n        return { error: 'extratoMaisAntigoQueDoisAnos' }; // Adicione uma mensagem de erro apropriada\n      }\n\n      return `${formatDate(startDate)}|${formatDate(endDate)}`; // Retorna as datas \n    } else {\n      return { error: 'extratoDataInvalida' };\n    }\n\n  } catch (err) {\n    return { error: 'extratoDataInvalida' };\n  }\n}","inputVariables":["input.content","state.previous.id","bodySmallTalks"],"outputVariable":"dataExtractor","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2b49e58c-0e49-46dd-8ada-a72a82f2fb15","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dataExtractor@error\"","$invalid":false,"settings":{"variable":"exceptionType","value":"{{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]}],"$leavingCustomActions":[{"$id":"a324f2ac-e7dd-462b-8481-9c7e796c3d12","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input inesperado\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input inesperado","action":"{{state.previous.name}} | {{dataExtractor@error}} | {{input.content}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"03afa7a9-af25-4854-909f-4ef6560f9698","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato error\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato error","action":"{{state.previous.name}} | {{dataExtractor@error}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dataExtractor@error"}]},{"$id":"08e90e47-63cf-48ed-98e7-c6907d863acb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"periodo extrato input\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"periodo extrato input","action":"{{state.previous.name}} | {{input.content}} | {{dataExtractor}}"},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"dataExtractor@error"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4c0302af-acc8-400c-a7e4-f2fe68baf07e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a5593dbf-876d-482f-9550-415502d659f9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-be5e495b-a63f-461c-947b-36c5fb51a35a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"63b16dc7-c525-419f-b365-707e8787a800","root":false,"$title":"[EC.1.0.0][SET] Valida input do usuario","$position":{"top":"979.75px","left":"10351.2px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fc320b0d-42e4-4971-adb7-4cc57898ea06":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"704f8e0c-512c-44bd-8610-570d27ba2318","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fcb725b3-472a-478e-9cb3-643f18040723","typeOfStateId":"state","$connId":"con_953","$id":"a1ade0b6-a887-49dc-82fe-e89c3c5416c0","conditions":[{"source":"context","comparison":"contains","values":["false"],"variable":"dentroDos180Dias"}],"$invalid":false},{"stateId":"e6a9e411-8342-451d-9947-1e258ad94404","typeOfStateId":"state","$connId":"con_958","$id":"63a2149e-7554-4cd9-a33e-e07e769593d2","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0e4399cb-56e8-4301-bb19-311701963b5f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"320e7bbc-121f-4624-96c5-11e42d9203c0","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" to \"\"","$invalid":false,"settings":{"variable":"SmallTalksIdentified"},"conditions":[]},{"$id":"1bfb6c91-f57e-4f41-b361-9308f05634fe","$typeOfContent":"","type":"ExecuteScript","$title":"msgHomologacao","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(x) {\n\treturn `[Homologação]\n\tEstamos enviando o extrato do seguinte período identificado:\n\t ${x}`\n}\n","inputVariables":["dataExtractor"],"outputVariable":"msgHomologacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"520774eb-0f99-43d8-ac62-76bfd2e9978c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dentroDos180Dias\"","$invalid":false,"settings":{"function":"run","source":"function run(dateRange) {\n  const dates = dateRange.split('|');\n  const startDate = new Date(dates[0]);\n  const endDate = new Date(dates[1]);\n\n  const today = new Date();\n  const oneHundredEightyDaysAgo = new Date(today);\n  oneHundredEightyDaysAgo.setDate(today.getDate() - 181); \n\n  return startDate >= oneHundredEightyDaysAgo && endDate <= today;\n}","inputVariables":["dataExtractor"],"outputVariable":"dentroDos180Dias","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dceb63d7-16ca-4a3d-b282-de81827dfe6f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d6d873cf-d41c-421c-afd2-059078d99b16","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-26cccc9a-4b28-4069-841c-c2a5e1204a55","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fc320b0d-42e4-4971-adb7-4cc57898ea06","root":false,"$title":"[EC.3.0.0][SET] Periodo identificado","$position":{"top":"1178.25px","left":"10351.2px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e6a9e411-8342-451d-9947-1e258ad94404":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4f2d3b75-84c0-45a8-b360-7f2c6d54c651","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0e34cb7-410a-40f1-9d9c-7e29783fbd63","typeOfStateId":"state","$connId":"con_963","$id":"2bba09b5-94b0-403b-8436-806769f86778","conditions":[{"source":"context","comparison":"contains","values":["Sim"],"variable":"config.flowsEnvioDeComprovante"},{"values":["10"],"source":"context","comparison":"greaterThanOrEquals","variable":"listaDeComprovantes@dataLength"}],"$invalid":false},{"stateId":"3fc13892-bba9-44ac-9d3d-b1937bbcd397","typeOfStateId":"state","$connId":"con_968","$id":"ef2c4775-afea-4210-a92f-5b35d88eceff","conditions":[{"source":"context","comparison":"equals","values":["1","1.0"],"variable":"listaDeComprovantes@dataLength"}],"$invalid":false},{"stateId":"ac2c1231-bdb1-48ac-a61e-56fa5ff2ea94","typeOfStateId":"state","$connId":"con_973","$id":"10c0dc06-4d26-4fcd-b656-fd603f06b356","conditions":[{"values":["2"],"source":"context","comparison":"greaterThanOrEquals","variable":"listaDeComprovantes@dataLength"}],"$invalid":false},{"stateId":"844f5330-b6e2-4423-9933-74a4a1bb1f0d","typeOfStateId":"state","$connId":"con_978","$id":"296a5836-a231-4170-9fdc-3786fd6a76d5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"57664d0d-915a-462f-ab07-29f524523746","$typeOfContent":"","type":"SetVariable","$title":"CLEAR listaDeComprovantes","$invalid":false,"settings":{"variable":"listaDeComprovantes"},"conditions":[]},{"$id":"b123ae2f-d64e-4d7e-9f0a-deaf7bfcbbf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]},{"$id":"15145df0-8255-4969-be2e-3815b8cbe69b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyComprovanteTRF\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, dataExtractor) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tlet data = dataExtractor.split('|');\n\t\treturn {\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"dataInicial\": data[0],\n\t\t\t\"dataFinal\": data[1],\n\t\t\t\"tipoOperacao\": \"TRF\"\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","dataExtractor"],"outputVariable":"bodyComprovanteTRF","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"63677e51-31be-49e1-8f06-33be3292371a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyComprovanteDOC\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, dataExtractor) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tlet data = dataExtractor.split('|');\n\t\treturn {\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"dataInicial\": data[0],\n\t\t\t\"dataFinal\": data[1],\n\t\t\t\"tipoOperacao\": \"DOC\"\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","dataExtractor"],"outputVariable":"bodyComprovanteDOC","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b99e86a4-7aa9-45a0-ace8-0a0313f88277","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioCompranteTRF","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/consultar","responseStatusVariable":"statusEnvioCompranteTRF","responseBodyVariable":"responseEnvioCompranteTRF","body":"{{bodyComprovanteTRF}}"},"conditions":[]},{"$id":"3d813222-9f23-48c7-b3dc-cbb27ad6fc86","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioCompranteDOC","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/consultar","responseStatusVariable":"statusEnvioCompranteDOC","responseBodyVariable":"responseEnvioCompranteDOC","body":"{{bodyComprovanteDOC}}"},"conditions":[]},{"$id":"c2531b53-c43a-44c9-89f7-eb42e2006017","$typeOfContent":"","type":"SetVariable","$title":"Set \"indexComprovante\"","$invalid":false,"settings":{"variable":"indexComprovante","value":"1"},"conditions":[]},{"$id":"d583e8c9-0522-425f-ad69-0af068d7a685","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api resumo","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api resumo","action":"{{contact.identity}} | {{bodyComprovanteTRF}} | {{statusEnvioCompranteTRF}} | {{responseEnvioCompranteTRF}}"},"conditions":[]},{"$id":"833eee43-5e7b-4bfe-9e08-03fd81e4b835","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api resumo 2","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api resumo 2","action":"{{contact.identity}} | {{bodyComprovanteDOC}} | {{statusEnvioCompranteDOC}} | {{responseEnvioCompranteDOC}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"7beac4f5-e86e-4179-9ea7-34cbcf6f1e3b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"listaDeComprovantes\"","$invalid":false,"settings":{"function":"run","source":"function run(jsonStr1, jsonStr2) {\n\ttry {\n\t\t// Inicializa os objetos como vazios caso as strings estejam nulas ou inválidas\n\t\tlet obj1 = jsonStr1 ? JSON.parse(jsonStr1) : { data: [] };\n\t\tlet obj2 = jsonStr2 ? JSON.parse(jsonStr2) : { data: [] };\n\n\t\t// Inicializa um array para consolidar os dados dos dois objetos\n\t\tlet dadosUnificados = [\n\t\t\t...(obj1.data || []), // Se obj1.data for undefined, usa um array vazio\n\t\t\t...(obj2.data || [])  // Se obj2.data for undefined, usa um array vazio\n\t\t];\n\n\t\t// Remove duplicatas com base em operacao.numero\n\t\tlet numerosVistos = new Set();\n\t\tdadosUnificados = dadosUnificados.filter(item => {\n\t\t\tlet numeroOperacao = item.operacao.numero;\n\t\t\tif (numeroOperacao && !numerosVistos.has(numeroOperacao)) {\n\t\t\t\tnumerosVistos.add(numeroOperacao);\n\t\t\t\treturn true; // Mantém este item\n\t\t\t}\n\t\t\treturn false; // Remove duplicatas\n\t\t});\n\n\t\t// Retorna o objeto unificado com a contagem de elementos\n\t\treturn {\n\t\t\tdata: dadosUnificados,\n\t\t\tdataLength: dadosUnificados.length\n\t\t};\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["responseEnvioCompranteDOC","responseEnvioCompranteTRF"],"outputVariable":"listaDeComprovantes","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"844f5330-b6e2-4423-9933-74a4a1bb1f0d","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6ba06065-fb7a-49a8-801b-8cda4cc5ed46","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6f277c08-b58b-43e2-95fe-afcb98e6cb95","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-91f8c18a-fe5c-49f5-83cc-934c32cb6633","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2134fb7d-c443-452a-af46-4fbf93938527","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"e6a9e411-8342-451d-9947-1e258ad94404","root":false,"$title":"[EV.4.0.0][HTTP] Chamada API Get Comprovante","$position":{"top":"1378.57px","left":"10351px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3fc13892-bba9-44ac-9d3d-b1937bbcd397":{"$contentActions":[{"action":{"$id":"1766028f-ece8-431f-b8f3-2ea5de459f13","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"146155b9-0f91-4c14-a261-fa7b0bccaaf5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"146155b9-0f91-4c14-a261-fa7b0bccaaf5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"be43c5f3-7303-49a0-b0f3-ac99ffa3115b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"82baf613-1784-4c6f-b3a3-b0294c67b20e","type":"text/plain","content":"{{msgComprovante}}","metadata":{}},"$cardContent":{"document":{"id":"82baf613-1784-4c6f-b3a3-b0294c67b20e","type":"text/plain","content":"{{msgComprovante}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"32110f2b-3ec7-461b-93df-d0f715c93de9","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b395a6e3-c1e9-455a-93fd-647d233cb476","typeOfStateId":"state","$connId":"con_983","$id":"0bc867fc-b854-476c-8d17-0d1642e9184d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"40899bb5-5608-412d-800f-1f72c8491732","$typeOfContent":"","type":"ExecuteScript","$title":"msgComprovante","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n    const [ano, mes, dia] = dataStr.split(\"-\");\n    return `${dia}/${mes}/${ano}`;\n}\nfunction formatarNomeTransferencia(dataStr) {\n    if(dataStr == \"DOC\"){\n        return \"DOC/TED\"\n    }\n   return \"Tranferência\"\n}\nfunction formatarValor(number) {\n    return number\n        .toFixed(2) // Garantir que sempre tenha 2 casas decimais\n        .replace('.', ',') // Substituir ponto por vírgula\n        .replace(/(\\d)(?=(\\d{3})+(?=\\D))/g, '$1.'); // Adicionar separador de milhar\n}\n\nfunction run(listaDeComprovantes) {\n    try {\n        listaDeComprovantes = JSON.parse(listaDeComprovantes).data;\n        return `Vi que você tem esse comprovante.\n\n*${formatarNomeTransferencia(listaDeComprovantes[0].operacao.tipo)}*\n${formatarData(listaDeComprovantes[0].data)} - R$ ${formatarValor(listaDeComprovantes[0].valor)}\n`\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["listaDeComprovantes"],"outputVariable":"msgViagem","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9c2dc576-c83b-4978-9330-85816e1ee19e","$typeOfContent":"","type":"ExecuteScript","$title":"comprovanteSelecionado","$invalid":false,"settings":{"function":"run","source":"function run(dataArray) {\n\ttry {\n\t\tdataArray = JSON.parse(dataArray);\n\t\tconst operacoes = dataArray.data.map(item => ({\n\t\t\ttipo: item.operacao.tipo,\n\t\t\tnumero: item.operacao.numero,\n\t\t\tdata: item.data\n\t\t}));\n\t\treturn operacoes[0];\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["listaDeComprovantes"],"outputVariable":"comprovanteSelecionado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9fdc9a8b-0b72-4a2a-aeea-2658f60ca31f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8a36c444-00e7-4850-9582-7a428ed05bf5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f8d9419c-fefd-4aa2-aa7c-3f9edea00389","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3a2e8da8-e626-47d2-a29c-cb8a35e5af32","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3fc13892-bba9-44ac-9d3d-b1937bbcd397","root":false,"$title":"[EV.4.0.1] Um comprovante","$position":{"top":"1541.57px","left":"9903.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"844f5330-b6e2-4423-9933-74a4a1bb1f0d":{"$contentActions":[{"action":{"$id":"b7f1e04a-ac0b-4704-8272-22ba4af31e7e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"15ffd3b9-a1ca-456b-8c7e-c12e3877c6f0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"15ffd3b9-a1ca-456b-8c7e-c12e3877c6f0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"28e7329f-2e8c-4408-81f4-c236a9ff0069","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f8e5b77a-ad0c-4c72-8458-8dccac4f5ebc","type":"text/plain","content":"Vi que você não tem comprovantes desse período.","metadata":{}},"$cardContent":{"document":{"id":"f8e5b77a-ad0c-4c72-8458-8dccac4f5ebc","type":"text/plain","content":"Vi que você não tem comprovantes desse período."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8a8b266a-0a4a-4b6b-a3a5-29e6338fc1eb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9af4853b-37c2-4c91-a6cb-a021b54be076","typeOfStateId":"state","$connId":"con_988","$id":"c42cc770-4ffb-46fe-96ef-a86b88b7a49c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d5f6b39-6324-422c-abf6-e1414c21b85e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-19d7709c-d460-4c3a-a69d-a301ca81085b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-64713d87-0199-430d-bb19-9daa396a9e6c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"844f5330-b6e2-4423-9933-74a4a1bb1f0d","root":false,"$title":"Nenhum Comprovante","$position":{"top":"1398.14px","left":"10767.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9af4853b-37c2-4c91-a6cb-a021b54be076":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a67a5c64-e78b-4470-8f0e-b93dbcf29572","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9af4853b-37c2-4c91-a6cb-a021b54be076","root":false,"$title":"[GO TO] Te ajudo em algo mais? ","$position":{"top":"1459.14px","left":"10987px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ac2c1231-bdb1-48ac-a61e-56fa5ff2ea94":{"$contentActions":[{"action":{"$id":"73a18264-e9dc-4e0e-a8d7-e3894342f7e6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f52a1ef-d722-480f-84f9-65bd969cb4bd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f52a1ef-d722-480f-84f9-65bd969cb4bd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fbad4e2a-5df6-4e0f-82b5-98ad5732fc08","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{dynamicContent@type}}","rawContent":"{{dynamicContent@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8a8b266a-0a4a-4b6b-a3a5-29e6338fc1eb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9b1b522c-39d7-434f-a706-1f75494adcdc","typeOfStateId":"state","$connId":"con_993","$id":"85099a67-ecee-4207-832e-27a0f287cef1","conditions":[{"source":"context","comparison":"equals","values":["Todos"],"variable":"userInput"}],"$invalid":false},{"stateId":"ac2c1231-bdb1-48ac-a61e-56fa5ff2ea94","typeOfStateId":"state","$connId":"con_998","$id":"9be62299-d41f-411c-9bee-8b2d37106145","conditions":[{"source":"context","comparison":"equals","values":["VerMais","Ver Mais"],"variable":"userInput"}],"$invalid":false},{"stateId":"ae04a1eb-ec6e-4cd1-aff5-be426c865032","typeOfStateId":"state","$connId":"con_1003","$id":"0070e66c-ae23-435f-b9cc-6d4a452ed81f","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9e559f72-fa22-4686-b48c-e83e198676fc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n    const [ano, mes, dia] = dataStr.split(\"-\");\n    return `${dia}/${mes}/${ano}`;\n}\nfunction formatarNomeTransferencia(dataStr) {\n    if (dataStr == \"DOC\") {\n        return \"DOC/TED\"\n    }\n    return \"Transferência\"\n}\nfunction formatarValor(number) {\n    return number\n        .toFixed(2) // Garantir que sempre tenha 2 casas decimais\n        .replace('.', ',') // Substituir ponto por vírgula\n        .replace(/(\\d)(?=(\\d{3})+(?=\\D))/g, '$1.'); // Adicionar separador de milhar\n}\n\nconst run = (dataArray, index) => {\n    try {\n        let { header, body, action } = menu(dataArray, index);\n        return buildWhatsApp(header, body, action);\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n\nconst buildWhatsApp = (header, body, action) => {\n    return {\n        'type': 'application/json',\n        'content': {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": header,\n                \"body\": body,\n                \"action\": action\n            }\n        }\n    }\n}\n\nconst menu = (dataArray, index) => {\n    const itemsPerPage = 9;\n    dataArray = JSON.parse(dataArray).data;\n    dataArray.sort((a, b) => new Date(b.data) - new Date(a.data));\n    let startIndex = (index - 1) * itemsPerPage;\n    let endIndex = index * itemsPerPage;\n    let paginatedItems = dataArray.slice(startIndex, endIndex);\n\n    let objOpcoes = paginatedItems.map(data => ({\n        \"id\": `${data.operacao.numero}`,\n        \"title\": formatarNomeTransferencia(data.operacao.tipo),\n        \"description\": `${formatarData(data.data)} - R$ ${formatarValor(data.valor)}`\n    }));\n    if (endIndex < dataArray.length) {\n        objOpcoes.push({\n            \"id\": \"VerMais\",\n            \"title\": \"Ver mais\",\n            \"description\": \"Ver mais comprovantes do período\"\n        });\n    }\n    let textMenu = `De qual comprovante você precisa?\\n\\nÉ só tocar no botão abaixo que te mostro.`;\n    if (index > 1) {\n        let textMenu = `Aqui estão mais comprovantes:\\n\\nSe você quiser ver os comprovantes anteriores, basta selecionar no menu anterior.`;\n    }\n\n\n    return {\n        \"body\": {\n            \"text\": textMenu\n        },\n        \"action\": {\n            \"button\": \"Ver comprovantes\",\n            \"sections\": [\n                {\n                    \"rows\": objOpcoes\n                }\n            ]\n        }\n    };\n};","inputVariables":["listaDeComprovantes","indexComprovante"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"371ef0e2-fc00-4337-92cf-0773f8ce1627","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d7b61f13-22b1-4dce-b601-01b5392b93a8","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"const run = (listaDeComprovantes, input,inputcontent) => {\n\ttry {\n\t\tconst jsonData = JSON.parse(input);\n\t\tconst numero = jsonData.metadata['#wa.interactive.list.id']; // Extrair o número a ser buscado\n\t\t\n\t\t//Paginação\n\t\tif (numero.toLowerCase().includes(\"vermais\") || inputcontent.toLowerCase().includes(\"ver mais\")) {\n\t\t\treturn \"Ver Mais\";\n\t\t}\n\n\t\tlistaDeComprovantes = JSON.parse(listaDeComprovantes);\n\t\t// Busca no array data usando o número de operação\n\t\tconst comprovanteEncontrado = listaDeComprovantes.data.find(item => item.operacao.numero === numero);\n\n\t\t// Retorna o comprovante ou uma mensagem caso não seja encontrado\n\t\treturn comprovanteEncontrado.operacao.numero || 'input inesperado';\n\t}\n\tcatch (e) {\n\t\treturn \"input inesperado\"\n\t}\n\n}","inputVariables":["listaDeComprovantes","input.message","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c8ec5999-294a-458e-a585-4b1d94fe6c6f","$typeOfContent":"","type":"ExecuteScript","$title":"indexComprovante ++","$invalid":false,"settings":{"function":"run","source":"function run(indexComprovante) {\n\ttry {\n\t\tlet newIndex = Number(indexComprovante) + 1;\n\t\treturn newIndex;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["indexComprovante"],"outputVariable":"indexComprovante","LocalTimeZoneEnabled":false},"conditions":[{"values":["Ver mais","VerMais"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d9ebded4-6b04-453c-b9ee-4fdfa5947a2c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-279a618b-3044-4718-bd2a-8baf82c232ff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7d98017e-6db1-4ffb-8da6-47ffc661bab7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-1ee38d69-f035-4033-bd5d-d7587b0a55ac","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"ac2c1231-bdb1-48ac-a61e-56fa5ff2ea94","root":false,"$title":"[EV.4.2.0]Mais de um comprovante","$position":{"top":"1605px","left":"10322px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9b1b522c-39d7-434f-a706-1f75494adcdc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0762ec4b-fb2e-4293-adb0-690a43ee0deb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"053082c2-9024-4d1c-a4a1-14129be5faa0","typeOfStateId":"state","$connId":"con_1008","$id":"9c066444-7e93-4a8b-85fc-2bd398435bf5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b7da349f-6612-49bd-b06b-596d5b624928","$typeOfContent":"","type":"ExecuteScript","$title":"todosComprovantes","$invalid":false,"settings":{"function":"run","source":"function run(originalArray, dadosCliente) {\n\ttry {\n\t\toriginalArray = JSON.parse(originalArray);\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tlet formatedArray = {};\n\t\toriginalArray.data.forEach((item, index) => {\n\t\t\tformatedArray[index + 1] = {\n\t\t\t\tagencia: dadosCliente.agencia,\n\t\t\t\tconta: dadosCliente.conta,\n\t\t\t\tcodigoCliente: dadosCliente.codCliente,\n\t\t\t\toperacao: {\n\t\t\t\t\ttipo: item.operacao.tipo,\n\t\t\t\t\tnumero: item.operacao.numero,\n\t\t\t\t\tdata: item.data\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t\treturn formatedArray;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["listaDeComprovantes","dadosCliente"],"outputVariable":"todosComprovantes","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6b57f904-ce11-4d68-bcd6-9e16f9c49880","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-83ecabb3-7d33-4ee0-8592-4857478ba5a8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dcb0b78f-44f6-42db-9d60-23261d4db697","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"9b1b522c-39d7-434f-a706-1f75494adcdc","root":false,"$title":"[EV.4.4.0][SET] Enviar Todos","$position":{"top":"1813.57px","left":"10534.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ae04a1eb-ec6e-4cd1-aff5-be426c865032":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8a222ced-97ed-4246-9b1f-9ed44032db82","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b395a6e3-c1e9-455a-93fd-647d233cb476","typeOfStateId":"state","$connId":"con_1013","$id":"9387a2b8-7888-4d5f-995c-76344d73144e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"968d305b-477c-449a-aa3a-35439bb384e4","$typeOfContent":"","type":"ExecuteScript","$title":"comprovanteSelecionado","$invalid":false,"settings":{"function":"run","source":"function run(dataArray, userInput) {\n\ttry {\n\t\tlet selecao = userInput;\n\t\tdataArray = JSON.parse(dataArray);\n\t\tconst operacoes = dataArray.data\n\t\t\t.filter(item => item.operacao.numero == selecao)\n\t\t\t.map(item => ({\n\t\t\t\ttipo: item.operacao.tipo,\n\t\t\t\tnumero: item.operacao.numero,\n\t\t\t\tdata: item.data\n\t\t\t}));\n\n\t\treturn operacoes[0] || 'input inesperado';\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["listaDeComprovantes","userInput"],"outputVariable":"comprovanteSelecionado","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a6f0861f-bdd9-400e-98ea-d560519eef50","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-06d76e35-a3a9-4619-8681-4ef203e5a856","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-87201bdd-d63d-4dab-ac09-0591cc859a9a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"ae04a1eb-ec6e-4cd1-aff5-be426c865032","root":false,"$title":"[EV.4.3.0][SET] Enviar Especifico","$position":{"top":"1823.29px","left":"10269.4px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b395a6e3-c1e9-455a-93fd-647d233cb476":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"590f7299-1ff5-4f85-b7e4-d17ddd72cf63","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"64c7bd2a-1b50-441c-b403-c216d8a6f467","typeOfStateId":"state","$connId":"con_1018","$id":"7ceccc5f-2814-413a-b563-4d98df7d83d5","conditions":[{"source":"context","comparison":"contains","values":["200","201","202","204"],"variable":"statusEnvioComprante"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"910d8463-b638-4178-88ad-f056ed89f2de","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"bodyEnviarComprovante\"","$invalid":false,"settings":{"function":"run","source":"function run(dadosCliente, comprovanteSelecionado) {\n\ttry {\n\t\tdadosCliente = JSON.parse(dadosCliente);\n\t\tcomprovanteSelecionado = JSON.parse(comprovanteSelecionado);\n\t\treturn {\n\t\t\t\"agencia\": dadosCliente.agencia,\n\t\t\t\"conta\": dadosCliente.conta,\n\t\t\t\"codigoCliente\": dadosCliente.codCliente,\n\t\t\t\"operacao\": comprovanteSelecionado\n\t\t}\n\t} catch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["dadosCliente","comprovanteSelecionado"],"outputVariable":"bodyEnviarComprovante","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"46f948e9-8c6c-4be1-87db-856845d8e9ea","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"statusEnvioComprante","responseBodyVariable":"responseEnvioComprante","body":"{{bodyEnviarComprovante}}"},"conditions":[]},{"$id":"4a38e58f-85dd-4120-89d9-f8f02b9e8bd5","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} api logs","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} api logs","action":"{{bodyEnviarComprovante}} | {{contact.identity}} | {{statusEnvioComprante}} {{bodyEnvioComprante}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e65ae042-2867-4005-9f6f-c24781ded992","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-88ecfe4f-e079-4472-88c0-412bf9790877","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-73989c66-7db4-4593-8a68-b9f794c953d9","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5269f161-941a-4cae-b466-7519d0f7c028","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"b395a6e3-c1e9-455a-93fd-647d233cb476","root":false,"$title":"[EV.5.0.0][HTTTP] Enviar Comprovante Email Cockpit","$position":{"top":"1988px","left":"10060px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fcb725b3-472a-478e-9cb3-643f18040723":{"$contentActions":[{"action":{"$id":"fb9b254e-6510-496e-9fe8-6373edd2ed20","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"94f01159-a9b1-42c0-a89b-13e7320e255b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"94f01159-a9b1-42c0-a89b-13e7320e255b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"73730897-ee70-4f3a-8c40-ed8c83fad0d8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0babcf29-e9d2-45fd-aeba-a1c51be72242","type":"text/plain","content":"Eu so consigo te mandar o comprovante de até 180 dias.\n\n\nPosso te enviar de algum outro período dentro de até 180 dias.\n\nPode ser?","metadata":{}},"$cardContent":{"document":{"id":"0babcf29-e9d2-45fd-aeba-a1c51be72242","type":"text/plain","content":"Eu so consigo te mandar o comprovante de até 180 dias.\n\n\nPosso te enviar de algum outro período dentro de até 180 dias.\n\nPode ser?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2f3aa863-7284-41d8-8110-abdb38800c69","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8cf3a933-2468-40b1-80e7-2adbddcb8c6c","typeOfStateId":"state","$connId":"con_1023","$id":"e87b3afa-1947-4747-8ed9-1de664e09748","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"32835d15-1e4f-44b6-a548-2b07f826fe37","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} user input\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} user input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"e4433678-2a9f-4451-8a60-57ec0562be70","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"c47d8aa2-1393-46b3-b55c-a4d37ed52ce3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn false;\n\t}\n\tcatch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-19f8c46d-8265-4e98-a731-1ef84f30e439","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-809a4c77-9966-42ac-9a39-be31d54392bd","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-f06e4b6d-e686-45a6-94b8-beab5dd3b9cf","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f37e0390-357a-4e7a-bc2c-80b7fbef0d7a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-8788c9a0-5530-4c20-803c-6c5052597cb9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"fcb725b3-472a-478e-9cb3-643f18040723","root":false,"$title":"[MSG] Superior a 180 dias","$position":{"top":"1215px","left":"10767.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64c7bd2a-1b50-441c-b403-c216d8a6f467":{"$contentActions":[{"action":{"$id":"c88b72d7-0cfd-45da-83e1-b3794b499c47","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bcf37ac1-3670-4cd9-a3c7-788f193a3ee7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bcf37ac1-3670-4cd9-a3c7-788f193a3ee7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"bf473b48-13c5-4ac8-b823-3d357ccd0085","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bb347a13-2c53-42d8-b390-f4b087528866","type":"text/plain","content":"Acabei de enviar no seu e-mail.","metadata":{}},"$cardContent":{"document":{"id":"bb347a13-2c53-42d8-b390-f4b087528866","type":"text/plain","content":"Acabei de enviar no seu e-mail."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"33ba9c3c-0e6f-4dc1-8c4f-3fa221a9c8f4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9bf1b219-f2f1-4893-a31a-5e78df992ddc","typeOfStateId":"state","$connId":"con_1028","$id":"740bd761-531b-48d4-bb1f-6d6604524780","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dd50cd2d-ce35-46b7-8389-cb2133486074","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3d55487b-24f7-4059-a559-d139142d5b39","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3c5b87b0-a216-42e8-a726-49eeb3313189","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"64c7bd2a-1b50-441c-b403-c216d8a6f467","root":false,"$title":"[EV.5.0.1][MSG] Enviado com sucesso","$position":{"top":"2179.43px","left":"10060.3px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9bf1b219-f2f1-4893-a31a-5e78df992ddc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"25232ec2-cd6f-40a6-8915-7a94beadc051","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a4d00d38-2ac4-4881-8808-879f3ce6b708","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9bf1b219-f2f1-4893-a31a-5e78df992ddc","root":false,"$title":"[GO TO] Te ajudo em algo mais?  ","$position":{"top":"2348px","left":"10060px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"053082c2-9024-4d1c-a4a1-14129be5faa0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"590f7299-1ff5-4f85-b7e4-d17ddd72cf63","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"64c7bd2a-1b50-441c-b403-c216d8a6f467","typeOfStateId":"state","$connId":"con_1033","$id":"7ceccc5f-2814-413a-b563-4d98df7d83d5","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"statusEnvioComprante"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"46f948e9-8c6c-4be1-87db-856845d8e9ea","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 1responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"statusEnvioComprante","responseBodyVariable":"responseEnvioComprante","body":"{{todosComprovantes@1}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@1"}]},{"$id":"92f07666-5a23-4909-ba60-ca9c4f1cb179","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 2responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"2statusEnvioComprante","responseBodyVariable":"2responseEnvioComprante","body":"{{todosComprovantes@2}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@2"}]},{"$id":"99ef0d38-c2ee-4b30-95a4-c2c18108eb0a","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 3responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"3statusEnvioComprante","responseBodyVariable":"3responseEnvioComprante","body":"{{todosComprovantes@3}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@3"}]},{"$id":"7b4ee7fa-b63b-4ee8-ab3e-fb79a720d5df","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 4responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"4statusEnvioComprante","responseBodyVariable":"4responseEnvioComprante","body":"{{todosComprovantes@4}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@4"}]},{"$id":"650c316b-17d1-428c-a33f-1b6da019f765","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 5responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"5statusEnvioComprante","responseBodyVariable":"5responseEnvioComprante","body":"{{todosComprovantes@5}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@5"}]},{"$id":"daaab717-bcd9-4e52-bcc5-23c07a12dad2","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 6responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"6statusEnvioComprante","responseBodyVariable":"6responseEnvioComprante","body":"{{todosComprovantes@6}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@6"}]},{"$id":"c2ce21a9-0bb2-4d5c-9dba-73509a9feba0","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 7responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"7statusEnvioComprante","responseBodyVariable":"7responseEnvioComprante","body":"{{todosComprovantes@7}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@7"}]},{"$id":"4b297aae-4dc5-4c19-b174-9555abb07136","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 8responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"8statusEnvioComprante","responseBodyVariable":"8responseEnvioComprante","body":"{{todosComprovantes@1}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@8"}]},{"$id":"c2e61a38-4ff5-4084-ab99-b7ffaaeaf900","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 9responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"9statusEnvioComprante","responseBodyVariable":"9responseEnvioComprante","body":"{{todosComprovantes@9}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@9"}]},{"$id":"0fcfdf02-b9f0-4346-8901-ff79225139ed","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 10responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"10statusEnvioComprante","responseBodyVariable":"10responseEnvioComprante","body":"{{todosComprovantes@10}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@10"}]},{"$id":"f70a54f9-7b45-4fe7-8d1d-425ab5f6c2ea","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 11responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"11statusEnvioComprante","responseBodyVariable":"11responseEnvioComprante","body":"{{todosComprovantes@11}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@11"}]},{"$id":"88dd3c61-2d2b-44f3-bf19-a78bde1c7e1e","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 12responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"12statusEnvioComprante","responseBodyVariable":"12responseEnvioComprante","body":"{{todosComprovantes@12}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@12"}]},{"$id":"ae3de7be-3aef-43cd-92de-cffbaba8f165","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 13responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"13statusEnvioComprante","responseBodyVariable":"13responseEnvioComprante","body":"{{todosComprovantes@13}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@13"}]},{"$id":"2182f238-8368-4179-8f8f-9047828aa5d2","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 14responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"14statusEnvioComprante","responseBodyVariable":"14responseEnvioComprante","body":"{{todosComprovantes@14}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@14"}]},{"$id":"985e4401-f336-49f8-af00-6609efb09bac","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 15responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"15statusEnvioComprante","responseBodyVariable":"15responseEnvioComprante","body":"{{todosComprovantes@15}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@15"}]}],"$leavingCustomActions":[{"$id":"f67fac6d-961f-4e19-ab45-38abd7833940","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 16responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"16statusEnvioComprante","responseBodyVariable":"16responseEnvioComprante","body":"{{todosComprovantes@16}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@16"}]},{"$id":"b343b2f0-c685-4568-8bc5-02527ecac9e5","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 17responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"17statusEnvioComprante","responseBodyVariable":"17responseEnvioComprante","body":"{{todosComprovantes@17}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@17"}]},{"$id":"b81c08bd-7530-407c-b89f-e84086185e40","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 18responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"18statusEnvioComprante","responseBodyVariable":"18responseEnvioComprante","body":"{{todosComprovantes@18}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@18"}]},{"$id":"1a07dfbc-3fb4-492b-9967-8e5c61dc18a2","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 19responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"19statusEnvioComprante","responseBodyVariable":"19responseEnvioComprante","body":"{{todosComprovantes@19}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@19"}]},{"$id":"b1705a8a-5124-4cdb-9b30-f063fce55028","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 20responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"20statusEnvioComprante","responseBodyVariable":"20responseEnvioComprante","body":"{{todosComprovantes@20}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@20"}]},{"$id":"24ae752a-792f-47ac-a99a-bbb0e0304dfb","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 21responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"21statusEnvioComprante","responseBodyVariable":"21responseEnvioComprante","body":"{{todosComprovantes@21}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@21"}]},{"$id":"059517f7-e4f2-4816-9278-cef1613f6840","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 22responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"22statusEnvioComprante","responseBodyVariable":"22responseEnvioComprante","body":"{{todosComprovantes@22}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@22"}]},{"$id":"bbed9ddc-5ebe-4a00-a5ab-b5507bae26a1","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 23responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"23statusEnvioComprante","responseBodyVariable":"23responseEnvioComprante","body":"{{todosComprovantes@23}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@23"}]},{"$id":"f466d75d-cf05-4a86-b99b-1baa342a954a","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 24responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"24statusEnvioComprante","responseBodyVariable":"24responseEnvioComprante","body":"{{todosComprovantes@24}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@24"}]},{"$id":"b971a979-52e1-4506-b577-03734ab788ba","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 25responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"25statusEnvioComprante","responseBodyVariable":"25responseEnvioComprante","body":"{{todosComprovantes@25}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@25"}]},{"$id":"ed747945-f194-46c5-b772-30ec66168063","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 26responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"26statusEnvioComprante","responseBodyVariable":"26responseEnvioComprante","body":"{{todosComprovantes@26}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@26"}]},{"$id":"cbd23f0c-bdd5-4df1-b14c-4027076fdf6a","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 27responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"27statusEnvioComprante","responseBodyVariable":"27responseEnvioComprante","body":"{{todosComprovantes@27}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@27"}]},{"$id":"da984695-33bf-4118-8d8b-4c50f607bfde","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 28responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"28statusEnvioComprante","responseBodyVariable":"28responseEnvioComprante","body":"{{todosComprovantes@28}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@28"}]},{"$id":"879a34fa-665f-478a-a91d-04047b65f054","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 29responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"29statusEnvioComprante","responseBodyVariable":"29responseEnvioComprante","body":"{{todosComprovantes@29}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@29"}]},{"$id":"457d065c-5b66-4303-97d7-16a2fb9d4514","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP - 30responseEnvioComprante","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Safra-Correlation-ID":"{{random.guid}}","Authorization":"Bearer {{token}}"},"method":"POST","uri":"{{config.baseURL}}/operacoes-execucoes/pagamentos/comprovantes/assistente-virtual/v1/comprovantes/enviar","responseStatusVariable":"30statusEnvioComprante","responseBodyVariable":"30responseEnvioComprante","body":"{{todosComprovantes@30}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"todosComprovantes@30"}]},{"$id":"0df8f212-22c9-475a-81d9-e8c39f4da461","$typeOfContent":"","type":"TrackEvent","$title":"{state.name} status","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} status","action":"1: {{statusEnvioComprovante}} | 2: {{2statusEnvioComprovante}} | 3: {{3statusEnvioComprovante}} | 4: {{4statusEnvioComprovante}} | 5: {{5statusEnvioComprovante}} | 6: {{6statusEnvioComprovante}} | 7: {{7statusEnvioComprovante}} | 8: {{8statusEnvioComprovante}} | 9: {{9statusEnvioComprovante}} | 10: {{10statusEnvioComprovante}} | 11: {{11statusEnvioComprovante}} | 12: {{12statusEnvioComprovante}} | 13: {{13statusEnvioComprovante}} | 14: {{14statusEnvioComprovante}} | 15: {{15statusEnvioComprovante}} | 16: {{16statusEnvioComprovante}} | 17: {{17statusEnvioComprovante}} | 18: {{18statusEnvioComprovante}} | 19: {{19statusEnvioComprovante}} | 20: {{20statusEnvioComprovante}} | 21: {{21statusEnvioComprovante}} | 22: {{22statusEnvioComprovante}} | 23: {{23statusEnvioComprovante}} | 24: {{24statusEnvioComprovante}} | 25: {{25statusEnvioComprovante}} | 26: {{26statusEnvioComprovante}} | 27: {{27statusEnvioComprovante}} | 28: {{28statusEnvioComprovante}} | 29: {{29statusEnvioComprovante}} | 30: {{30statusEnvioComprovante}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3ec48a5d-2899-40bb-b48b-0c4f6a75fb6e","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-3208914a-53ac-40b3-b9bb-cf63cf61fad9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"053082c2-9024-4d1c-a4a1-14129be5faa0","root":false,"$title":"[EV.4.9.0][HTTTP] E. Todos Comprovants (Paliativo)","$position":{"top":"2002.43px","left":"10536px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"commentsIdList":["f9d37de0-f22b-4c0e-9b6f-314aede2be83"]}},"648f7f6e-b881-4233-96b6-9d6aebf84298":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fac7b9cf-522b-4af6-9136-9ee5588dd645","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"854db96d-80e9-4a05-888c-c1fbd8e67ba1","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"648f7f6e-b881-4233-96b6-9d6aebf84298","root":false,"$title":"[GO TO] Envio de comprovante","$position":{"top":"3092.71px","left":"1791.43px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e0e34cb7-410a-40f1-9d9c-7e29783fbd63":{"$contentActions":[{"action":{"$id":"73a18264-e9dc-4e0e-a8d7-e3894342f7e6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f52a1ef-d722-480f-84f9-65bd969cb4bd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f52a1ef-d722-480f-84f9-65bd969cb4bd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fbad4e2a-5df6-4e0f-82b5-98ad5732fc08","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"8a8b266a-0a4a-4b6b-a3a5-29e6338fc1eb","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9b1b522c-39d7-434f-a706-1f75494adcdc","typeOfStateId":"state","$connId":"con_1038","$id":"85099a67-ecee-4207-832e-27a0f287cef1","conditions":[{"source":"context","comparison":"contains","values":["todos"],"variable":"userInput"}],"$invalid":false},{"stateId":"ae04a1eb-ec6e-4cd1-aff5-be426c865032","typeOfStateId":"state","$connId":"con_1043","$id":"0070e66c-ae23-435f-b9cc-6d4a452ed81f","conditions":[{"source":"context","comparison":"notEquals","values":["Input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"faa9cf96-b348-42a4-ab96-67507ea18c76","$typeOfContent":"","type":"ExecuteScript","$title":"Monta conteúdo dinâmico","$invalid":false,"settings":{"function":"run","source":"function formatarData(dataStr) {\n  const [ano, mes, dia] = dataStr.split(\"-\");\n  return `${dia}/${mes}/${ano}`;\n}\nfunction formatarNomeTransferencia(dataStr) {\n  if (dataStr == \"DOC\") {\n    return \"DOC/TED\"\n  }\n  return \"Tranferência\"\n}\nfunction formatarValor(number) {\n  return number\n    .toFixed(2) // Garantir que sempre tenha 2 casas decimais\n    .replace('.', ',') // Substituir ponto por vírgula\n    .replace(/(\\d)(?=(\\d{3})+(?=\\D))/g, '$1.'); // Adicionar separador de milhar\n}\n\nfunction run(flowToken, dataArray) {\n  dataArray = JSON.parse(dataArray).data;\n  let objOpcoes = [];\n  dataArray.slice(0, 30).forEach((data, index) => {\n    objOpcoes.push({\n      \"id\": `${data.operacao.numero}`,\n      \"title\": `Tipo: ${formatarNomeTransferencia(data.operacao.tipo)} ➖ Data: ${formatarData(data.data)} ➖ Valor: R$ ${formatarValor(data.valor)}`,\n    })\n  });\n\n  let data = {\n    \"dataSourceComprovantes\": objOpcoes\n  }\n\n  let conteudoDinamico = {\n    \"recipient_type\": \"individual\",\n    \"messaging_product\": \"whatsapp\",\n    \"type\": \"interactive\",\n    \"interactive\": {\n      \"type\": \"flow\",\n      \"body\": {\n        \"text\": \"De qual comprovante você precisa?\\n\\nÉ só tocar no botão abaixo que te mostro.\"\n      },\n      \"action\": {\n        \"name\": \"flow\",\n        \"parameters\": {\n          \"flow_message_version\": \"3\",\n          \"flow_token\": flowToken,\n          \"flow_id\": \"1221428179156903\",\n          \"flow_cta\": \"Ver comprovante\",\n          \"flow_action\": \"navigate\",\n          \"flow_action_payload\": {\n            \"screen\": \"SELECIONAR_COMPROVANTE\",\n            \"data\": data\n          }\n        }\n      }\n    }\n  }\n  return conteudoDinamico;\n}","inputVariables":["random.guid","listaDeComprovantes"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c377c201-5723-4e2b-b1bc-21adeef0b1a5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"bbd6664e-46d4-4b36-bce0-342ced42ae50","$typeOfContent":"","type":"ExecuteScript","$title":"userInput","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(input) {\n\ttry {\n\t\tinput = JSON.parse(input);\n\t\tconst jsonResponse = input.metadata[\"#wa.interactive.nfm_reply.json_response\"];\n\t\tconst formattedResponse = JSON.parse(jsonResponse);\n\t\tif (formattedResponse.comprovate) {\n\t\t\treturn formattedResponse.comprovate;\n\t\t}\n\t\tif (formattedResponse.todos) {\n\t\t\treturn \"Todos\"\n\t\t}\n\t} catch (error) {\n\t\treturn \"input inesperado\";\n\t}\n}","inputVariables":["input.message"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5c2cf915-c45a-4b8f-9774-f180655d3869","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d3e15f11-92b0-4406-981a-1da6fd1ff8fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-aef959d1-fb3a-4025-92c0-3529d5e72cd3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-223b0741-66c0-48b0-80d3-170bacaa9fd7","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e0e34cb7-410a-40f1-9d9c-7e29783fbd63","root":false,"$title":"[EV.4.2.0][Flows] Mais de nove comprovante","$position":{"top":"1624.43px","left":"10838.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:useTunnelOwnerContext":"true","builder:#localTimeZone":"E. South America Standard Time","builder:minimumIntentScore":"0.41","builder:stateTrack":"false","serviceName":"PreMain","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/skillautenticacao","env":"PRD","parentServiceName":"Main","urlToken":"https://sts-api.safra.com.br","grantType":"client_credentials","clientId":"BLIP","baseURL":"https://api.safra.com.br","urlCHT":"https://api.safra.com.br","clientSecretHML":"ee1f5004-2400-4ab1-9af7-d9168d517204","clientSecretPRD":"5312b6d5-acb8-4165-9458-ef445876473e","clientSecret":"5312b6d5-acb8-4165-9458-ef445876473e","OSADesligado":"Não","commandsKey":"Key c2tpbGxhdXRlbnRpY2FjYW86QkJiODVuVzgwQkRTR1Y3dzUwamc=","commandsUrl":"https://safra2.http.msging.net/commands","accuracy":"0.60","flowsEnvioDeComprovante":"Não"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}