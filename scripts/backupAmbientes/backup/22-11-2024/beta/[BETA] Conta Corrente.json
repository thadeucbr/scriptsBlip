{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d2712b4e-c844-4435-ba60-8364a32b3206","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"85d915aa-f1ca-4e54-9c06-04e60015756d","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"daa2d803-2548-400e-8782-47ecaec9aca1","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"b5bef41d-16bb-4ea1-b8dc-ec17b6adc914","$connId":"con_3","$invalid":false,"typeOfStateId":"state"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d7fcee91-11e0-4d0e-ba7e-5de93425b312","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"78bdc058-ee64-454a-a1bc-caeb50bba482","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b50345e3-e7bc-4965-89e2-ab5fa25c706c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f4c15977-220d-4864-be95-c9fd33bf498e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bbdcdb62-7b3e-46b9-91e9-3fe34f9be685","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"568.333px","left":"879px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b687933a-994c-4382-8051-601710a0e8ea","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"928e1999-3310-4c4f-a25a-c051922b9862","typeOfStateId":"state","$connId":"con_8","$id":"d40c89b5-2225-49b2-b2f8-02689607aa97","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"74c0977e-fc70-432d-8f10-ae862389b161","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]},{"$id":"bda24a54-7cdc-41e9-a4da-bab2abdc8f8d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"928e1999-3310-4c4f-a25a-c051922b9862","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c9848870-13bf-4512-942a-593ccf696ed6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"131px","left":"395px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"928e1999-3310-4c4f-a25a-c051922b9862":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-e73421de-0de6-41ab-b741-2a23c41635cc","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"928e1999-3310-4c4f-a25a-c051922b9862","root":false,"$title":"[Redirect] To cascata","$position":{"top":"277px","left":"395px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"37f23f86-2009-43f1-b7a5-f50093c784f0":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:950"},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:951"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:952"}],"$conditionOutputs":[{"stateId":"a07fefdc-a4a7-46b4-a70c-997da7fc4a50","typeOfStateId":"state","$connId":"con_13","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:973"},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType","$$hashKey":"object:974"}],"$invalid":false,"$$hashKey":"object:959"}],"$enteringCustomActions":[{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n    {\n        \"id\": \"1\",\n        \"title\": \"Solicitar cartão\",\n        \"description\": \"\"\n    },\n    {\n        \"id\": \"2\",\n        \"title\": \"Desbloquear cartão\",\n        \"description\": \"\"\n    },\n    {\n        \"id\": \"3\",\n        \"title\": \"Esqueci minha senha\",\n        \"description\": \"\"\n    },\n    {\n        \"id\": \"4\",\n        \"title\": \"Perda / Roubo do cartão\",\n        \"description\": \"\"\n    }\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n    if (posicao > menuOptions.length) {\n        posicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n    }\n    if (menuOptions.find(option => option.id == posicao)) {\n        quantidadeItens = menuOptions.length\n        for (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n            menuOptions[i].id = (i + 2).toString()\n        }\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72) || ''\n        })\n    } else {\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72)\n        })\n    }\n    menuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n    // Parametro de busca é o title ou description da opção que deseja atualizar\n    const opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n    if (!opcao) {\n        return\n    }\n    menuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n    menuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (permissoes.includes(permissoesNecessarias)) {\n        return\n    }\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada) {\n    try {\n        // const { ec, cpfAppKey } = JSON.parse(contaSelecionada)\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Ótimo, o que você precisa sobre cartão?`\n                },\n                \"action\": {\n                    \"button\": \"Ver opções\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": menuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return {\n            error: err.message,\n            exceptionType: 'reiniciarFluxo',\n            dynamicContent: {\n                \"type\": \"text/plain\",\n                \"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n            }\n        }\n    }\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9939be58-b396-4717-91e2-e015c3962bea","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"cartao\"","$invalid":false,"settings":{"variable":"assunto","value":"cartao"},"conditions":[]},{"$id":"013c3960-472e-43f9-b677-8d65dc7788d9","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"05eae7b9-9e82-41f1-8e13-40313c123174","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"f896e70f-b1a0-4b21-af25-8b99681584df","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0d8748bb-cdfa-44d1-adcd-c3d79b2bd1b3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0f6aac5f-945d-434a-b78c-1cf5c834de8d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-450194ba-2523-486f-a141-a7c6e16d5008","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-23f8d0c9-94c2-457c-9750-2653eefadea8","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"37f23f86-2009-43f1-b7a5-f50093c784f0","root":false,"$title":"[CC.2.0.0][MSG] Menu Cartão","$position":{"top":"976px","left":"4038px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a07fefdc-a4a7-46b4-a70c-997da7fc4a50":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false,"$$hashKey":"object:1195"}],"$conditionOutputs":[{"stateId":"6b8f6f86-4687-4aae-8f02-213d2f828855","typeOfStateId":"state","$connId":"con_18","$id":"e8be7cc6-973b-48ff-8c76-0895d9f02f60","conditions":[{"values":["Solicitar cartão"],"source":"context","comparison":"equals","variable":"userInput","$$hashKey":"object:1220"}],"$invalid":false,"$$hashKey":"object:1198"},{"stateId":"43b6539b-743b-4c0d-9757-e06efdc0c93c","typeOfStateId":"state","$connId":"con_23","$id":"3a698ba9-dbc0-4af4-92d9-da97658b278a","conditions":[{"values":["Desbloquear cartão"],"source":"context","comparison":"equals","variable":"userInput","$$hashKey":"object:1238"}],"$invalid":false,"$$hashKey":"object:1199"},{"stateId":"2696021a-72b5-48d5-9cdc-2a0adf4f3694","typeOfStateId":"state","$connId":"con_28","$id":"a38796a2-7c28-4a48-8b05-a2a85dd2d426","conditions":[{"source":"context","comparison":"equals","values":["Esqueci minha senha"],"variable":"userInput","$$hashKey":"object:1256"}],"$invalid":false,"$$hashKey":"object:1200"},{"stateId":"ff996689-492a-4ef6-be45-04f589b26826","typeOfStateId":"state","$connId":"con_33","$id":"7a8950b2-1000-436c-a9bd-a66470e77e96","conditions":[{"source":"context","comparison":"equals","values":["Perda / Roubo do cartão"],"variable":"userInput","$$hashKey":"object:1272"}],"$invalid":false,"$$hashKey":"object:1201"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6c723285-f162-4a38-a3b9-0ef1d44dec10","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6db078c9-9e20-4862-bf07-efa92e76990b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ed57d3a8-923c-44db-8f99-defea2a37ae9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-827fbc3c-020a-4d37-a868-32d4b1d3824d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a07fefdc-a4a7-46b4-a70c-997da7fc4a50","root":false,"$title":"[CC.2.0.0][INPUT] Menu Cartão","$position":{"top":"1227.73px","left":"4037.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1e3206de-707e-4dac-9749-9f24d53110c0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e5c624a6-f303-463a-95fb-919bd3fcd8a6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","typeOfStateId":"state","$connId":"con_38","$id":"57d5cbb0-d9f8-4f7a-8df5-47377a4499ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"96259fcd-3464-4280-b312-2918dcb9eab0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f68b337b-5cc5-481f-ac90-553ed013113f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"1e3206de-707e-4dac-9749-9f24d53110c0","root":false,"$title":"[CC.5.0.0] Gravame","$position":{"top":"402px","left":"1645px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5ea0cac6-c5fd-49f9-9423-54d0e660adae":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aef70d64-6ae4-40b1-a0ac-dec9257d6088","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","typeOfStateId":"state","$connId":"con_43","$id":"b57a7b3c-d562-42fb-9c97-012fce49bd62","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a43ad079-d700-4bd5-a427-1853d43b65a2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0e965078-b309-4175-9cb4-1f2ae60d81d8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5ea0cac6-c5fd-49f9-9423-54d0e660adae","root":false,"$title":"[CC.6.0.0] Renegociação","$position":{"top":"399px","left":"1870px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"25991251-b486-423e-8a43-49f1c17ecef6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:2422"}],"$conditionOutputs":[{"stateId":"9c3f4364-a0d8-424f-a8e6-915919ed0b39","typeOfStateId":"state","$connId":"con_48","$id":"53fa7443-3506-4fc7-9037-9b8b918c538a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente","$$hashKey":"object:2442"}],"$invalid":false,"$$hashKey":"object:2424"},{"stateId":"68876e1c-788d-4d7a-aab5-97aa61b99e40","typeOfStateId":"state","$connId":"con_53","$id":"d27ba48e-206a-413a-929a-6dd9e3d07d5e","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2456"}],"$invalid":false,"$$hashKey":"object:2425"}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","root":false,"$title":"[CC.0.1.0][LOGIC] Cliente carterizado?","$position":{"top":"1381px","left":"2770px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68876e1c-788d-4d7a-aab5-97aa61b99e40":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1983"},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:1984"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1985"}],"$conditionOutputs":[{"stateId":"3bb2455c-ce43-434c-8634-702d5f52e7f9","typeOfStateId":"state","$connId":"con_58","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2006"}],"$invalid":false,"$$hashKey":"object:1992"}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ver o menu inicial\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Ver o menu anterior\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Como posso te ajudar agora? \";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-27b3f0eb-9258-4c2c-a00b-5c7f3a6fcb69","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-99bd39ef-93cc-48a8-a206-f9f510d58438","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6a13322e-1c39-4efc-bdba-7ff34df10d37","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"68876e1c-788d-4d7a-aab5-97aa61b99e40","root":false,"$title":"[CC.0.1.1][MSG] Não carterizado","$position":{"top":"1614px","left":"2470px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3bb2455c-ce43-434c-8634-702d5f52e7f9":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false,"$$hashKey":"object:2823"}],"$conditionOutputs":[{"stateId":"54748e92-f46d-4008-98ec-cc44c13f3dfa","typeOfStateId":"state","$connId":"con_63","$id":"5b6a68fb-a757-4d50-82b3-e3e706af4472","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2846"},{"values":["Ver o menu inicial"],"source":"context","comparison":"equals","variable":"userInput","$$hashKey":"object:2847"}],"$invalid":false,"$$hashKey":"object:2826"},{"stateId":"7000cb42-9ab4-4a40-907f-6223dec9d8e9","typeOfStateId":"state","$connId":"con_68","$id":"6b7cebb9-b04a-47ef-b4c8-3b2df72b4d91","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:2871"},{"values":["Encerrar"],"source":"context","comparison":"contains","variable":"userInput","$$hashKey":"object:2872"}],"$invalid":false,"$$hashKey":"object:2827"},{"stateId":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","typeOfStateId":"state","$connId":"con_73","$id":"3f1fdf9e-7e65-4504-b674-86fda189442a","conditions":[{"source":"context","comparison":"equals","values":["Ver o menu anterior"],"variable":"userInput","$$hashKey":"object:2894"}],"$invalid":false,"$$hashKey":"object:2828"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-37b31ef6-1223-4bba-8adc-1c96d4003871","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-13c72723-f0cd-4514-892b-3557e7cbfae7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d8ae1946-2e7f-48b5-9aad-f8ed19da5a1e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c399b094-36c3-48cc-800e-78bd1114f1c9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3bb2455c-ce43-434c-8634-702d5f52e7f9","root":false,"$title":"[CC.0.1.2][INPUT] Não carterizado","$position":{"top":"1998.73px","left":"2469.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f88bbdeb-3963-49e0-a355-edc20350bbfd":{"$contentActions":[{"action":{"$id":"12db0ffc-93c9-476c-8478-b5a23056ae2a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a83d4ce-9b8b-4b7f-a176-98da9bd87f3a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"Vou te pedir para fazer o seguinte: \n\n1° No <b>Internet Banking</b>, clique na aba <b>investimentos.</b>\n\n2° Selecione a opção <b>aplicar.</b>\n\n3° Escolha o produto em que deseja investir.\n\n4° Insira o valor que deseja aplicar.","metadata":{}},"$cardContent":{"document":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"Vou te pedir para fazer o seguinte: \n\n1° No <b>Internet Banking</b>, clique na aba <b>investimentos.</b>\n\n2° Selecione a opção <b>aplicar.</b>\n\n3° Escolha o produto em que deseja investir.\n\n4° Insira o valor que deseja aplicar."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39351547-5e06-4476-9bba-e388055e7490","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","typeOfStateId":"state","$connId":"con_78","$id":"a867f8ac-5bfb-4464-8bc1-33da2edfe211","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b56b0242-c8bd-4a60-b82b-35b4606209d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"6bbae6ea-d663-4567-944f-af69d6891287","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"investimentos\"","$invalid":false,"settings":{"variable":"assunto","value":"investimentos"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3d05b57f-b872-4f5e-b21b-4b1aeffa7ca5","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5b8b8f09-6254-437a-abcd-195d9642d961","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5300c0ae-dfe6-4296-8de6-5b98e2b45a03","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f88bbdeb-3963-49e0-a355-edc20350bbfd","root":false,"$title":"[CC.3.0.0] Investimentos","$position":{"top":"1002.33px","left":"2978.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e36dcaa0-0665-4b22-ae98-3e8605d7e557":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3633"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '30e39880-1d2a-439a-a0ed-1e7210966286',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b589bb14-42d1-4a36-bbf7-48ebe61cb7be","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-316b1fe7-a9bf-4b61-9b21-af6c82fbfa9b","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","root":false,"$title":"[Redirect] To Main (Menu inicial)","$position":{"top":"116px","left":"1164px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"facc5123-47f0-4255-a30f-a6b87e18176e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: '2e47b9c6-7eae-40b5-98ff-7230819d1574',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ed624d83-f3de-4b8c-99c4-de9f4608fb2a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f3d33d2d-88fb-419f-9c05-46a24228313f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"facc5123-47f0-4255-a30f-a6b87e18176e","root":false,"$title":"[Redirect] To  Finalizacao (Finalizar)","$position":{"top":"104.462px","left":"1363.18px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"54748e92-f46d-4008-98ec-cc44c13f3dfa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9897798e-a2d5-4ad1-ad60-913074bbb68f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3061"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"54748e92-f46d-4008-98ec-cc44c13f3dfa","root":false,"$title":"[GO TO] Menu inicial","$position":{"top":"2692px","left":"2438.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7000cb42-9ab4-4a40-907f-6223dec9d8e9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8c23e11a-719d-4fb6-bb66-a8a49c12e47b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3347"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"facc5123-47f0-4255-a30f-a6b87e18176e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7000cb42-9ab4-4a40-907f-6223dec9d8e9","root":false,"$title":"[GO TO] Encerrar","$position":{"top":"2140.57px","left":"2690px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9c3f4364-a0d8-424f-a8e6-915919ed0b39":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1760"},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false,"$$hashKey":"object:1761"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1762"}],"$conditionOutputs":[{"stateId":"4381c1f3-6264-42ac-bbca-f606701b2539","typeOfStateId":"state","$connId":"con_83","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1783"}],"$invalid":false,"$$hashKey":"object:1769"}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"type\": \"reply\",\n\t\t\t// \t\"reply\": {\n\t\t\t// \t\t\"id\": \"3\",\n\t\t\t// \t\t\"title\": \"\"\n\t\t\t// \t}\n\t\t\t// }\n\t\t];\n\t\tconst bodyText = \"Consegui te ajudar?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ad0ca8d5-c886-4078-9792-24d635c5bd1d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-42b4e558-3cfd-4797-8dac-6d030814f00b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4b6881e2-b680-47c0-aaa9-730101ffe3bd","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9c3f4364-a0d8-424f-a8e6-915919ed0b39","root":false,"$title":"[CC.0.1.3][MSG] Carterizado","$position":{"top":"1608.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4381c1f3-6264-42ac-bbca-f606701b2539":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"5a3d7e47-334e-48c0-a6a7-869f9678a954","typeOfStateId":"state","$connId":"con_88","$id":"c2532493-9855-4a8c-900d-2331b6ebe72f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Sim"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"656962f1-1814-43ee-9f4d-872a42f2f951","typeOfStateId":"state","$connId":"con_93","$id":"09f888d4-aa81-4aee-b0a0-e7cf316129ee","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Não"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1ff85c19-2f4e-48ab-955a-1ee9004b0ad1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-914e794d-8f34-4290-ae6f-b8b924a51fe0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e9683f7c-4d85-4233-9587-60822bc72559","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a0c31715-226f-4a86-aa63-75434cf4b9ed","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4381c1f3-6264-42ac-bbca-f606701b2539","root":false,"$title":"[CC.0.1.4][INPUT] Carterizado","$position":{"top":"1831.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"820d335f-0c95-466f-9009-35cac24c6ea4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7f1c3b82-a3cb-47b3-9d71-b9a7fec5b349","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-61572db1-3466-4fe3-8be4-6933fcbd2fcf","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"820d335f-0c95-466f-9009-35cac24c6ea4","root":false,"$title":"[Redirect] To  Finalizacao (Welcome)","$position":{"top":"104.436px","left":"1558.9px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5a3d7e47-334e-48c0-a6a7-869f9678a954":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c81febe-8e1d-4241-b039-d258c2effee4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"5a3d7e47-334e-48c0-a6a7-869f9678a954","root":false,"$title":"[GO TO] Finalização","$position":{"top":"1842.73px","left":"3379.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cf24777b-0dc4-44b9-969f-a9c1c4e552fc":{"$contentActions":[{"action":{"$id":"b0f53b7f-d115-49d1-b8ab-03542936ca58","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7aff57fb-5682-48b3-b5cf-74888b089efb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1b6af780-e7f1-4fbe-8f4a-3481e581e6bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1475eaee-7b62-434c-a6a2-9ec49debf18c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de","typeOfStateId":"state","$connId":"con_98","$id":"b9ff35a7-e3f0-430a-9736-dbe6df9fda37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3b88274c-e1e3-4b7c-b62c-cb355e1a84e4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(cpfAppKey, ec) {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Menu Principal\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Menu Anterior\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Falar com gerente\",\n\t\t\t\t\"description\": \"\"\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"id\": \"4\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"5\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"6\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"7\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"8\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"9\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// },\n\t\t\t// {\n\t\t\t// \t\"id\": \"10\",\n\t\t\t// \t\"title\": \"\",\n\t\t\t// \t\"description\": \"\"\n\t\t\t// }\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Certo, como podemos te ajudar?` // <---- Body\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Assuntos\", // <---- Titulo do botão\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["cpfAppKey","selectedEc"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f51d111-5dfe-4c05-b21b-610f9213816e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-29e62843-a5c7-4369-bed0-80ac22d5ae3c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cef63f57-bb8c-4393-9bad-e1b4d20ba7b8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-18635800-eb90-455e-8bda-7672253feeb3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cf24777b-0dc4-44b9-969f-a9c1c4e552fc","root":false,"$title":"[CC.0.1.6][MSG] Como podemos ajudar? (emp1)","$position":{"top":"2359.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"9704c4d2-d981-4c16-bdb7-ab2f6e57e0a0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"54748e92-f46d-4008-98ec-cc44c13f3dfa","typeOfStateId":"state","$connId":"con_103","$id":"9ce4999f-6b8b-4435-8cb9-fdf34c26823c","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Menu Principal"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"26f12b75-a1eb-4779-9d15-f525f0e30960","typeOfStateId":"state","$connId":"con_108","$id":"4d9465dd-2dad-401f-8b69-540bf76f98f1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Falar com gerente"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","typeOfStateId":"state","$connId":"con_113","$id":"723501c5-b56d-4ee0-acda-31abc58be6af","conditions":[{"source":"context","comparison":"equals","values":["Menu Anterior"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"98d8f680-0f33-40ef-ae64-e0eb576da038","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"27541523-9db3-45bb-925a-f96e659c35d3","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"a88a9c41-3781-40c5-87d8-85cc4984829c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"5f38ca73-16b6-465d-904a-fb43a3c9c385","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2b0a9343-61ce-4720-9e3e-b0b51c69ec3e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3d8255f0-8c31-4d68-84c0-b9c4fad7e7aa","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c22e29d3-6d49-4b66-b5ae-4e097c1ba740","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-63d33c34-518a-4f7c-a2d4-f907453f0e59","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7ec5eb0b-06f0-4ed0-9aa5-ede058ce49de","root":false,"$title":"[CC.0.1.7][INPUT] Como podemos ajudar? (emp1)","$position":{"top":"2644.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"656962f1-1814-43ee-9f4d-872a42f2f951":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"307f84bd-662a-49b4-9bf1-3772df28581b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cf24777b-0dc4-44b9-969f-a9c1c4e552fc","typeOfStateId":"state","$connId":"con_118","$id":"7fc1000d-17c9-4b3b-ad57-d6cb906bbbf7","conditions":[{"source":"context","comparison":"equals","values":["emp1"],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"26f12b75-a1eb-4779-9d15-f525f0e30960","typeOfStateId":"state","$connId":"con_123","$id":"563aed27-41a6-4834-aaab-88bb3328f8b4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"656962f1-1814-43ee-9f4d-872a42f2f951","root":false,"$title":"[CC.0.1.5][LOGIC] Seguimento emp1?","$position":{"top":"2094.73px","left":"3058.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2361b9db-e18e-45de-afea-a50626686dd8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-381dd42b-239d-43b2-bd38-f913989478b5","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-73694b91-df3a-4f96-b653-fb3a3ec3af3d","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"2361b9db-e18e-45de-afea-a50626686dd8","root":false,"$title":"[Redirect] to Atendimento Humano (Welcome)","$position":{"top":"103.333px","left":"1763.41px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"26f12b75-a1eb-4779-9d15-f525f0e30960":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7c0e9eab-35ee-46fd-971e-279328455fd3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"26f12b75-a1eb-4779-9d15-f525f0e30960","root":false,"$title":"[GO TO] Atendimento Humano","$position":{"top":"2369.73px","left":"3407.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c1af60de-05a9-4466-8c99-b2ddb36a220a":{"$contentActions":[{"action":{"$id":"12db0ffc-93c9-476c-8478-b5a23056ae2a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b9005957-0096-4268-8099-ab9a435f9133","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6a83d4ce-9b8b-4b7f-a176-98da9bd87f3a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"Você pode solicitar o talão de cheque pelo <b>Internet Banking</b>, da seguinte forma:\n\n1° Clique na aba <b>contas.</b>\n\n2° Em <b>outros serviços</b>, escolha a opção <b>talões de cheque.</b>\n\n3° Vá em <b>solicitar novo talão</b> e selecione a quantidade.\n\n4° Para concluir a solicitação, informe sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"8361de3c-8dd3-4a9b-a0cf-cefb99170829","type":"text/plain","content":"Você pode solicitar o talão de cheque pelo <b>Internet Banking</b>, da seguinte forma:\n\n1° Clique na aba <b>contas.</b>\n\n2° Em <b>outros serviços</b>, escolha a opção <b>talões de cheque.</b>\n\n3° Vá em <b>solicitar novo talão</b> e selecione a quantidade.\n\n4° Para concluir a solicitação, informe sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"39351547-5e06-4476-9bba-e388055e7490","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","typeOfStateId":"state","$connId":"con_128","$id":"a98427bd-b99a-4f7f-9d9c-7270f826dea3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b56b0242-c8bd-4a60-b82b-35b4606209d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"20c9ca88-e691-4b02-8343-0f9b5d3febf0","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"cheque empresas\"","$invalid":false,"settings":{"variable":"assunto","value":"talão de cheque"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8f7cb898-4eb9-47e5-bab1-c316fe3f99b4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-dcfafdb2-04a7-416e-863e-8d413f7af15f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0c1bee29-db88-4478-bbbf-cb94c8c78ad7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c1af60de-05a9-4466-8c99-b2ddb36a220a","root":false,"$title":"[CC.1.0.0] Cheque Empresas","$position":{"top":"1002.67px","left":"2564px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6b8f6f86-4687-4aae-8f02-213d2f828855":{"$contentActions":[{"action":{"$id":"51821bf3-acc6-4765-91dd-e2a65ad9ccb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"96eeca3d-c830-4bb2-a9ae-c105803c9a7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"96eeca3d-c830-4bb2-a9ae-c105803c9a7c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1442"},{"action":{"$id":"42783a71-9979-4f5a-9d36-6b5556f21d60","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b0364a9a-9a7a-4a0d-ad0d-cc77d61e9242","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões</b>, clique em <b>solicitar cartão.</b>\n\n2° Preencha os dados da sua empresa conforme solicitado e clique em <b>próximo.</b>\n\n3° Confirme os dados para emissão do cartão.\n\n4° Para concluir a solicitação, informe senha e token.","metadata":{}},"$cardContent":{"document":{"id":"b0364a9a-9a7a-4a0d-ad0d-cc77d61e9242","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões</b>, clique em <b>solicitar cartão.</b>\n\n2° Preencha os dados da sua empresa conforme solicitado e clique em <b>próximo.</b>\n\n3° Confirme os dados para emissão do cartão.\n\n4° Para concluir a solicitação, informe senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:1443"},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1444"}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_133","$id":"b2fbd9fa-0ab3-4ae4-9e12-59be5dfc5e1a","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:1464"}],"$invalid":false,"$$hashKey":"object:1450"}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b419500e-906c-40ad-bc47-9152b8ba7836","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-db72f685-fbda-4d25-86e4-df1ecc984571","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6b8f6f86-4687-4aae-8f02-213d2f828855","root":false,"$title":"[CC.2.1.0] Solicitar Cartão","$position":{"top":"1558px","left":"3629px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"43b6539b-743b-4c0d-9757-e06efdc0c93c":{"$contentActions":[{"action":{"$id":"e858e3c3-538c-486e-ab69-155c88c269ec","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fa221bab-108a-4c42-956b-7f10c3d14105","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"fa221bab-108a-4c42-956b-7f10c3d14105","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"59d38d95-4f9f-417f-93f7-9065c5deec40","$typeOfContent":"text","type":"SendMessage","settings":{"id":"44ca71e0-7968-48e0-a111-39b70b92fdf6","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões</b>, clique em <b>desbloquear</b>.\n\n2° Preencha os dados da sua empresa conforme solicitado.\n\n3° Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"44ca71e0-7968-48e0-a111-39b70b92fdf6","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões</b>, clique em <b>desbloquear</b>.\n\n2° Preencha os dados da sua empresa conforme solicitado.\n\n3° Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_138","$id":"0b5529ad-8da0-40c7-bfdf-e3dab5141a2c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a7db514d-95d4-481a-a606-c99c957c0370","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-955d6099-04b5-4349-a7a9-651eb7143264","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"43b6539b-743b-4c0d-9757-e06efdc0c93c","root":false,"$title":"[CC.2.2.0] Desbloquear Cartão","$position":{"top":"1534px","left":"3947px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2696021a-72b5-48d5-9cdc-2a0adf4f3694":{"$contentActions":[{"action":{"$id":"ae49ed10-5b7e-460c-a94c-ca305dafe899","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cf2cb7a3-1ef9-4e94-b377-5dcf3a294436","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cf2cb7a3-1ef9-4e94-b377-5dcf3a294436","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e0e7d666-e684-404b-b2db-cb577e18d248","$typeOfContent":"text","type":"SendMessage","settings":{"id":"41fc34e4-fd5f-4071-92f2-5556c8237987","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões - meus cartões</b>, clique em <b>reenviar senha.</b>\n\n2° Preencha os dados da sua empresa conforme solicitado.\n\n3° Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"41fc34e4-fd5f-4071-92f2-5556c8237987","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões - meus cartões</b>, clique em <b>reenviar senha.</b>\n\n2° Preencha os dados da sua empresa conforme solicitado.\n\n3° Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_143","$id":"84aec40c-6656-429b-8860-98b6b8a3b04d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-45b5f0e9-dec4-494c-b833-74eabaeb7090","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2db86fdb-dc39-49ba-8580-6daa27b79456","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"2696021a-72b5-48d5-9cdc-2a0adf4f3694","root":false,"$title":"[CC.2.3.0] Esqueci minha senha","$position":{"top":"1552px","left":"4146px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ff996689-492a-4ef6-be45-04f589b26826":{"$contentActions":[{"action":{"$id":"55189105-a1a2-46e2-aa4e-7ad69b69c3ff","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f6b63e11-c6c6-4a92-9190-b03b5e0d0895","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f6b63e11-c6c6-4a92-9190-b03b5e0d0895","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31863de9-8e0d-4554-8700-7281b1f891e3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"ae0bb8a9-01f8-4f70-a0fc-31c19742e414","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões</b> clique em <b>bloquear por perda ou roubo.</b>\n\n2° Preencha os dados da sua empresa conforme solicitado.\n\n3° Valide as informações com sua senha e token.","metadata":{}},"$cardContent":{"document":{"id":"ae0bb8a9-01f8-4f70-a0fc-31c19742e414","type":"text/plain","content":"1° No <b>Internet Banking</b>, na aba <b>cartões</b> clique em <b>bloquear por perda ou roubo.</b>\n\n2° Preencha os dados da sua empresa conforme solicitado.\n\n3° Valide as informações com sua senha e token."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b208f7e5-98b6-42dd-bfba-5e9736bef608","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","typeOfStateId":"state","$connId":"con_148","$id":"db6298e6-ffd2-4a54-856a-a7cea9f0a125","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"598d57a2-a9fb-45c4-8691-c13e233c73ed","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e8ed8002-6bbb-4716-9f98-a1d1cb5a0d01","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0db1c103-26a4-4689-b1e6-459c526a7b28","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ff996689-492a-4ef6-be45-04f589b26826","root":false,"$title":"[CC.2.4.0] Perda / Roubo","$position":{"top":"1552px","left":"4465px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d60ffb9f-33a0-4701-a858-f54405c2ee81","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1616"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e0ec9e3f-16ce-4426-9c75-1ca7774b6d1e","root":false,"$title":"[GO TO][LOGIC] Cliente carterizado?","$position":{"top":"2183px","left":"4046px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b420cdc-30d4-4876-bf68-61b4346c4c71":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"69c9b513-1751-4b8d-af46-0aa6cdea618f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b8d09f05-088c-4b3e-8348-9c4e88a92b1d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, assunto) {\n\tconst destination = {\n\t\t'talão de cheque': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'investimentos': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'cartao': {\n\t\t\tbotDestination: `Bot Main${env || \"\"}`.trim(),\n\t\t\tstateDestination: '621b7935-89f3-450d-87b1-6caf539d5ec7'\n\t\t},\n\t\t'pacotes contratados': {\n\t\t\tbotDestination: `contacorrente${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'daa2d803-2548-400e-8782-47ecaec9aca1'\n\t\t}\n\t}\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\tconst destinationBot = destination[assunto]\n\t\tif (!destinationBot) {\n\t\t\tthrow new Error('invalid destination')\n\t\t}\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\t...destinationBot,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: 'contacorrente',\n\t\t\tstateOrigin: '[Redirect] Menu anterior',\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","assunto"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"960947c0-f767-41ea-b824-266e2ef32438","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bedfd32d-57a4-4a93-95f6-56e850eac143","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a12db5a1-9713-4c89-b423-888739eb9f70","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"4b420cdc-30d4-4876-bf68-61b4346c4c71","root":false,"$title":"[Redirect] Menu anterior","$position":{"top":"107.429px","left":"1979.86px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3e98bc47-4a22-4b16-af0d-88bc0278ba99":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5a10577b-e395-449a-a34d-65c909230084","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3204"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"4b420cdc-30d4-4876-bf68-61b4346c4c71","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3e98bc47-4a22-4b16-af0d-88bc0278ba99","root":false,"$title":"[GO TO] Redirect menu anterior","$position":{"top":"2390.73px","left":"2693.76px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b9ad166b-910b-43a2-b6e1-7e3ae4171339":{"$contentActions":[{"action":{"$id":"ab3727b3-39b8-4962-90d8-c5b264a1108c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d04cc133-7777-4400-90e4-42a50bb0692c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d04cc133-7777-4400-90e4-42a50bb0692c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c2b356aa-8c67-4900-9083-b7aa1c9885ba","$typeOfContent":"text","type":"SendMessage","settings":{"id":"68579775-9ee8-4260-9e48-4b6a97383099","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso.","metadata":{}},"$cardContent":{"document":{"id":"68579775-9ee8-4260-9e48-4b6a97383099","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f15eb474-f67b-44ba-b09f-8901a2490810","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"dd50398e-90ff-4bcb-b1ce-68f2571a065f","typeOfStateId":"state","$connId":"con_153","$id":"d5b7d14a-6b65-48fb-aefa-f31136985ce8","conditions":[{"source":"context","comparison":"equals","values":["{\"data\":[]}","\"data\":[]"],"variable":"bodyPacote"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88","typeOfStateId":"state","$connId":"con_158","$id":"e1ac8cc3-52c1-4d1a-be67-6fd3b9f38c9e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"37ec7dfd-0559-44cb-8fbd-864473169354","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyPacote\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/pacotes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}}","responseStatusVariable":"statusPacote","responseBodyVariable":"bodyPacote"},"conditions":[]},{"$id":"0eff983e-2b89-4f18-a2b4-ddd15b097a68","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"adf5cb3a-0689-4967-bac4-2ac0c7ce5593","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"9046536b-e0ac-4946-9e63-91309a1cb772","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"59bca2b9-5c2f-49fc-8e78-284216e7dd01","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusPacote"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2bf48e28-6482-45b8-9e9b-ace23f7f19fb","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/pacotes?agencia={{contaSelecionada@agencia}}&conta={{contaSelecionada@conta}} | GET| {{statusPacote}} | {{bodyPacote}}"},"conditions":[]},{"$id":"463083e3-7ab4-4637-8471-538c1c2c8c95","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"statusPacote"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusPacote"}]},{"$id":"1b0708ad-1571-4577-bdd1-67b08c09f027","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-81ea1b41-abf5-4635-9f43-87fa2ad4779b","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-4215ef54-9872-4221-a8fb-2e11ab4bebfe","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5b301769-4aae-4a0e-be34-de86bd729e27","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-bc30c031-b370-4fdf-8935-708043bc0f4c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"b9ad166b-910b-43a2-b6e1-7e3ae4171339","root":false,"$title":"[TC.8.0.0][HTTP] API Pacotes","$position":{"top":"1349px","left":"5547px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dd50398e-90ff-4bcb-b1ce-68f2571a065f":{"$contentActions":[{"action":{"$id":"830dc22e-05b5-4846-ad0a-b0942056e6da","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b23bbad8-f440-4e04-afee-76696df30d2e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b23bbad8-f440-4e04-afee-76696df30d2e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2a4a5ec3-f094-4baf-b0c5-eff6930c982d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d55fc062-6b49-49a7-9d2c-f80fbe4cca96","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você não possui pacotes de serviço cadastrados. ","metadata":{}},"$cardContent":{"document":{"id":"d55fc062-6b49-49a7-9d2c-f80fbe4cca96","type":"text/plain","content":"{{contaSelecionada@primeiroNome}}, você não possui pacotes de serviço cadastrados. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"aa7f4cb0-ab7d-41d9-a97b-933d665cdfa3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ab0adeac-f86e-442b-a933-60fa68af47ee","typeOfStateId":"state","$connId":"con_163","$id":"d12b034e-b2bb-4e95-a547-1e2a64e1e5bc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"462ef3b3-6e21-4ccb-9511-71e7027054f4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-97beb5f1-5e7e-4248-a672-ba537a06c30b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b4e00a7c-6b4d-4496-94c3-7950bc971d51","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"dd50398e-90ff-4bcb-b1ce-68f2571a065f","root":false,"$title":"[TC.8.1.0][MSG] Não possui pacotes","$position":{"top":"1542.67px","left":"5896px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88":{"$contentActions":[{"action":{"$id":"43fce40b-0ef3-4893-ae77-565f1b3aa02b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c1519c0c-33f5-46e0-b0e3-198a9a7a6c4a","type":"text/plain","content":"{{pacote}}","metadata":{}},"$cardContent":{"document":{"id":"c1519c0c-33f5-46e0-b0e3-198a9a7a6c4a","type":"text/plain","content":"{{pacote}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fac17be3-0201-4328-b945-debc0327d360","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9b168af3-065a-4ea3-b277-61fb23ef1d7f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b168af3-065a-4ea3-b277-61fb23ef1d7f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0d7ad388-3ac7-4cdc-948b-1ae362d68905","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ab0adeac-f86e-442b-a933-60fa68af47ee","typeOfStateId":"state","$connId":"con_168","$id":"1618012f-9044-4cef-a73d-c91603287b9d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e1050974-d7c4-460a-9e94-b1973ab21086","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"pacote\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyPacote) {\n  try {\n    let jsonData = JSON.parse(bodyPacote)\n    // Extrair valores\n    let primeiroItem = jsonData.data[0];\n    let nome = primeiroItem.nome;\n    let valor = primeiroItem.valor;\n\n    // Convertendo o número para uma string\n    let valorString = valor.toString();\n\n    // Substituindo ponto por vírgula\n    let valorFormatado = valorString.replace('.', ',');\n\n    // Formatando como moeda\n    valorFormatado = valorFormatado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });\n\n    // Verificando se há ponto e vírgula na formatação\n    if (valorFormatado.indexOf('.') !== -1 && valorFormatado.indexOf(',') !== -1) {\n      let splitVirgula = valorFormatado.split(',');\n      let decimais = splitVirgula[1] + '00';\n      valor = splitVirgula[0] + ',' + decimais.substring(0, 2);\n    } else if (valorFormatado.indexOf('.') !== -1) {\n      valor = valorFormatado + ',00';\n    } else if (valorFormatado.indexOf(',') !== -1) {\n      let splitVirgula = valorFormatado.split(',');\n      let decimais = splitVirgula[1] + '00';\n      let milhar = splitVirgula[0].replace(/\\D/g, '');\n      milhar = milhar.replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\n      valor = milhar + ',' + decimais.substring(0, 2);\n    } else {\n      let milhar = valorFormatado.replace(/\\D/g, '');\n      milhar = milhar.replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.');\n      valor = milhar + ',00';\n    }\n    return (`Este é o seu pacote de serviços contratado:\\n\\*Pacote*: ${nome}\\n\\n*Valor*: R$${valor}`);\n\n  }\n  catch (e) {\n    return e.message;\n  }\n}","inputVariables":["bodyPacote"],"LocalTimeZoneEnabled":false,"outputVariable":"pacote"},"conditions":[]},{"$id":"51f9e661-fd2c-4120-9f56-2d984ef79796","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-356a03ee-cbd9-466e-abb0-2e78380e4f9f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c2d5da71-4a04-416a-bedd-e831770d6e52","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-20da72f1-cba4-47fa-9bef-1e9716529b85","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f7e2b91b-47c7-4363-89e2-d3ffc57f9e88","root":false,"$title":"[TC.8.2.0][MSG] Possui pacotes","$position":{"top":"1547.67px","left":"5271px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ab0adeac-f86e-442b-a933-60fa68af47ee":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"7d3b7196-f824-4926-88ec-84fdd31f45d0","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"68f61a0e-414c-4d79-bc30-3ea7af7d4ee2"},"isAiGenerated":false,"$tags":[],"id":"ab0adeac-f86e-442b-a933-60fa68af47ee","root":false,"$title":"[GO TO] CC.0.1.0 Conseguimos te Ajudar?","$position":{"top":"1746.67px","left":"5567px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"708a01ab-973e-404f-8e0f-fe4a312b5100":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'b9ad166b-910b-43a2-b6e1-7e3ae4171339',//Pacotes\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8d0589a8-da34-418d-9fba-0b43cc5cf5db","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4a26519b-b9a9-4fcb-a7b5-4a15213c2cc9","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"708a01ab-973e-404f-8e0f-fe4a312b5100","root":false,"$title":"[Redirect] To \"Autenticacao\"","$position":{"top":"1189.67px","left":"5544px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"191a2f33-c58e-4a64-9e66-af23348bcbad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"82e40acc-3cb3-40d0-b3a7-774e66b700ae","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"708a01ab-973e-404f-8e0f-fe4a312b5100","typeOfStateId":"state","$connId":"con_173","$id":"d633e8bd-66b3-454e-8f1e-c7926a8dc9ad","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"808f528e-491c-4eab-858c-de25eb8f5968","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"a76fdd71-3815-49e1-9488-9b78c0421c0d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"8005fea5-86ab-4074-a264-a0b889c2443a","$typeOfContent":"","type":"SetVariable","$title":"Set \"assunto\" to \"pacotes contratados\"","$invalid":false,"settings":{"variable":"assunto","value":"pacotes contratados"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d0b0aa71-c914-4fb1-b8da-a3068733914d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fb7db4f6-fa41-46c3-836b-38df281a5795","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"191a2f33-c58e-4a64-9e66-af23348bcbad","root":false,"$title":"[CC.3.0.0][SET] Consultar Pacotes Contratados","$position":{"top":"973px","left":"5544px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"90e85c65-51a7-434b-ab81-66179515bfb0":{"$contentActions":[{"action":{"$id":"cf269952-69f1-4e3a-a719-2dacea8ce1db","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3534d883-1029-4986-86fe-fc6b3664b5df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3534d883-1029-4986-86fe-fc6b3664b5df","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c99aa7d0-b931-496d-adc5-8859c884c4cd","$typeOfContent":"text","type":"SendMessage","settings":{"id":"01b05f2e-e56d-4f9b-9405-444a40ce7947","type":"text/plain","content":"Estamos trabalhando para desenvolver novos serviços PIX aqui no WhatsApp.","metadata":{}},"$cardContent":{"document":{"id":"01b05f2e-e56d-4f9b-9405-444a40ce7947","type":"text/plain","content":"Estamos trabalhando para desenvolver novos serviços PIX aqui no WhatsApp."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac7d748f-20ff-43fe-966d-a1026ac98b51","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c0745c4c-b3a8-40f2-8d01-c95c368a3251","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c0745c4c-b3a8-40f2-8d01-c95c368a3251","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ba0598fa-98ff-4690-9f2b-bbf4d700f152","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7baa52e7-932d-4998-8d69-860fdd2d4021","type":"text/plain","content":"Para realizar um PIX ou consultar informações sobre PIX, acesse o seu aplicativo Safra Empresas.","metadata":{}},"$cardContent":{"document":{"id":"7baa52e7-932d-4998-8d69-860fdd2d4021","type":"text/plain","content":"Para realizar um PIX ou consultar informações sobre PIX, acesse o seu aplicativo Safra Empresas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"81325db7-f765-4b53-bcdd-14cc8c26b916","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"368ed6d2-36d7-4631-a0b5-982523a88008","typeOfStateId":"state","$connId":"con_178","$id":"5ed9727a-60bc-4b66-8e34-7d55155a8473","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"671ffa19-a2b9-4441-a59d-ff28a9bb7b9d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b4939075-011f-4a5f-8637-a247b5f177b9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e00cdeaa-1dc5-49e2-b1e6-51e16e5da275","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"90e85c65-51a7-434b-ab81-66179515bfb0","root":false,"$title":"[M.5.3.2][MSG] Pix","$position":{"top":"1523px","left":"173px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"daa2d803-2548-400e-8782-47ecaec9aca1":{"$contentActions":[{"action":{"$id":"998bf25a-9982-432c-b62a-1c125857e622","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"95c802c6-6729-4c74-92b0-b1de93863467","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"95c802c6-6729-4c74-92b0-b1de93863467","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b527eddf-73c5-4cfb-9aa3-cd04c107fef9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b1f60af7-aebd-467b-a946-6b29986b4841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"60c69fbc-f2d3-4175-8164-766775c3249b","typeOfStateId":"state","$connId":"con_183","$id":"e669d4be-d6e6-4a30-b620-e4990713d4c8","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4d543e27-b1fb-4836-b8de-df0eb2b8deb1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"59eadda3-8d6c-4fe4-a235-b4f45bc3e030","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"podeSeguirExtrato\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(identity, telefonesComAcessoExtrato) {\n\ttry {\n\t\tconst telefone = identity.split('@')[0]\n\t\treturn telefonesComAcessoExtrato.includes(telefone)\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["contact.identity","resource.telefonesComAcessoExtrato"],"outputVariable":"podeSeguirExtrato","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"990f94c3-a8fd-4e88-aed2-14630fea3f3c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n    {\n        \"id\": \"2\",\n        \"title\": \"Fazer Pix\",\n        \"description\": \"Realize um pix\"\n    },\n    {\n        \"id\": \"6\",\n        \"title\": \"Falar sobre conta\",\n        \"description\": \"\"\n    },\n    {\n        \"id\": \"10\",\n        \"title\": \"Pacotes contratados\",\n        \"description\": \"\"\n    },\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n    if (posicao > menuOptions.length) {\n        posicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n    }\n    if (menuOptions.find(option => option.id == posicao)) {\n        quantidadeItens = menuOptions.length\n        for (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n            menuOptions[i].id = (i + 2).toString()\n        }\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72) || ''\n        })\n    } else {\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72)\n        })\n    }\n    menuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n    // Parametro de busca é o title ou description da opção que deseja atualizar\n    const opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n    if (!opcao) {\n        return\n    }\n    menuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n    menuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao);\n\n    if (!opcao) {\n        return;\n    }\n\n    const hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n    if (hasPermission) {\n        return;\n    }\n\n    const index = menuOptions.indexOf(opcao);\n    if (index > -1) {\n        menuOptions.splice(index, 1);\n    }\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\nfunction removeDescricaoDoBotao({ tituloDoBotao, parteASerRemovida, listaPermissoes, permissaoNecessaria }) {\n    if (listaPermissoes.includes(permissaoNecessaria)) {\n        return\n    }\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions[index].description = menuOptions[index].description.replace(parteASerRemovida, '')\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada, podeSeguirExtrato) {\n    try {\n        const { cpfAppKey, permissoes } = JSON.parse(contaSelecionada)\n\n        if (cpfAppKey != 'false') {\n            atualizaOpcaoMenu({ parametroDeBusca: 'Fazer Pix', title: 'Fazer Pix', description: 'Realize um pix' })\n            adicionaOpcaoNoMenu({ posicao: 1, title: 'Extratos', description: 'Acesse o extrato Safrapay e da conta corrente' })\n            adicionaOpcaoNoMenu({ posicao: 3, title: 'Pagar Contas', description: 'Pagar boleto com código de barras' })\n            adicionaOpcaoNoMenu({ posicao: 4, title: 'Antecipar saldo', description: 'Antecipação automática, Antecipação eventual' })\n\n            verificaPermissao({ permissoes, tituloDoBotao: 'Fazer Pix', permissoesNecessarias: ['transferenciaPix'] })\n        } else {\n            if (podeSeguirExtrato == 'true') {\n                adicionaOpcaoNoMenu({ posicao: 1, title: 'Extrato', description: 'Baixe o PDF' })\n            }\n        }\n        verificaPermissao({ permissoes, tituloDoBotao: 'Pagar contas', permissoesNecessarias: ['transferencias'] })\n        verificaPermissao({ permissoes, tituloDoBotao: 'Antecipar saldo', permissoesNecessarias: ['solicitarAntecipAuto', 'novoExtratoSafrapay'] })\n        verificaPermissao({ permissoes, tituloDoBotao: 'Pacotes Contratados', permissoesNecessarias: ['pacotesDeServicos'] })\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Do que você precisa da conta corrente?`\n                },\n                \"action\": {\n                    \"button\": \"Ver opções\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": menuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return {\n            error: err.message,\n            exceptionType: 'reiniciarFluxo',\n            dynamicContent: {\n                \"type\": \"text/plain\",\n                \"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n            }\n        }\n    }\n}","inputVariables":["contaSelecionada","podeSeguirExtrato"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"00229a5d-613e-46be-b48c-45a4bfb43866","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"754be84f-fd97-4316-9e21-385ae1b0756c","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"c57f37d3-d5e8-4f7a-ab60-be105b159220","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"c9a4add7-60f0-4b08-b8dd-4172302560b3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selecaoMenuAnterior\"","$invalid":false,"settings":{"function":"run","source":"function run(stateId, serviceName) {\n\ttry {\n\t\treturn {\n\t\t\tstateId,\n\t\t\tserviceName\n\t\t}\n\t} catch (er) {\n\t\treturn {\n\t\t\tstateId: 'welcome',\n\t\t\tserviceName: 'Bot Main'\n\t\t}\n\t}\n}","inputVariables":["state.id","config.serviceName"],"outputVariable":"selecaoMenuAnterior","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-faadd229-ccaf-4efd-b4f7-8eceae458bae","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-018e08c8-dec9-4b3f-8de4-d877c562bba9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1af2dc81-5792-456f-834c-59a0118283f4","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-367df097-5065-4d52-acfe-8f760c2e14a7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"daa2d803-2548-400e-8782-47ecaec9aca1","root":false,"$title":"[M.5.3.0][MSG]Menu Conta Corrente","$position":{"top":"756px","left":"879px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a508df2f-7177-4554-959b-2b62037f453b":{"$contentActions":[{"action":{"$id":"14269fd1-7655-4b19-a045-fa3067d3015f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a3364784-a601-4871-a9fa-618b11893f02","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a3364784-a601-4871-a9fa-618b11893f02","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"556e595b-a097-49cf-adbe-46b9baee6d51","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c8493b22-3f92-4fea-bc07-bfc816531526","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c4ce4b44-ad19-4b1c-882d-e6dcba0d96cc","typeOfStateId":"state","$connId":"con_188","$id":"dcb210ed-585c-41cd-a29f-4d24c2514f00","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"73a7b0f9-e131-42f8-bb6d-2a9919438905","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const headerText = \"Certo, de Safrapay qual seria o extrato?\";\nconst buttons = [\n\t{\n\t\t\"type\": \"reply\",\n\t\t\"reply\": {\n\t\t\t\"id\": \"1\",\n\t\t\t\"title\": \"Extrato vendas\"\n\t\t}\n\t},\n\t{\n\t\t\"type\": \"reply\",\n\t\t\"reply\": {\n\t\t\t\"id\": \"2\",\n\t\t\t\"title\": \"Extrato recebimentos\"\n\t\t}\n\t},\n\t{\n\t\t\"type\": \"reply\",\n\t\t\"reply\": {\n\t\t\t\"id\": \"3\",\n\t\t\t\"title\": \"Extrato conta\"\n\t\t}\n\t}\n];\n\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n\tconst opcao = buttons.find(option => option.reply.title === tituloDoBotao);\n\n\tif (!opcao) {\n\t\treturn;\n\t}\n\n\tconst hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n\tif (hasPermission) {\n\t\treturn;\n\t}\n\n\tconst index = buttons.indexOf(opcao);\n\tif (index > -1) {\n\t\tbuttons.splice(index, 1);\n\t}\n}\n\nfunction run() {\n\ttry {\n\t\tconst { permissoes } = JSON.parse(contaSelecionada)\n\t\tverificaPermissao({ tituloDoBotao: \"Extrato vendas\", permissoes, permissoesNecessarias: [\"extratoSafrapayDaMaquina\"] })\n\t\tverificaPermissao({ tituloDoBotao: \"Extrato recebimentos\", permissoes, permissoesNecessarias: [\"extratoSafrapayDaMaquina\"] })\n\t\tverificaPermissao({ tituloDoBotao: \"Extrato conta\", permissoes, permissoesNecessarias: [\"extratoDeContaCorrente\"] })\n\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"394dbdae-8215-421e-8740-b5f2751fb96d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d3698094-6602-4849-8349-6440633b6553","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-69a67eca-3876-430e-914b-20f56ac7396d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a3bd84b0-2f94-4593-834f-329ed88f0d26","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a508df2f-7177-4554-959b-2b62037f453b","root":false,"$title":"[M.5.3.1][MSG] Menu Extratos","$position":{"top":"1749px","left":"1766px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c4ce4b44-ad19-4b1c-882d-e6dcba0d96cc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c8493b22-3f92-4fea-bc07-bfc816531526","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"48bd2fab-30a5-46c8-8a6b-cf482187a66e","typeOfStateId":"state","$connId":"con_193","$id":"8bb8a775-d818-43a5-b6d4-040eeec42d02","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extrato recebimentos"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"c9666009-688a-4b7f-913b-e16f3ec2ca36","typeOfStateId":"state","$connId":"con_198","$id":"f0dc54ab-626f-4f25-9fcc-c1af5ea6abbc","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extrato vendas"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"03573ae8-ef6e-49cc-9b6d-34a535eabaaa","typeOfStateId":"state","$connId":"con_203","$id":"3ba2e9e8-f188-4b76-b7ec-33fbbfd7ee6b","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"Extrato conta"},{"values":["Extrato conta"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"4ab1250d-0dbf-4502-8bc0-7faf7015593d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0340deaf-2276-4944-bfd7-717887492ab0","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"adeac3a1-b03b-47fc-9fe1-56c5c61a4e86","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"e1d21ac2-5478-48cb-8b5e-f0bcae880a16","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3baf4463-2da2-4344-a1c8-bc5065481816","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-607ead6b-1207-4344-8c7b-afcbc1f4443c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-431ed345-bf90-4136-99c9-1757d7bcf4bb","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d84f6cff-7137-472d-a3a2-1aa8f654c590","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c4ce4b44-ad19-4b1c-882d-e6dcba0d96cc","root":false,"$title":"[M.5.3.1][INPUT] Valida seleção menu extratos","$position":{"top":"2079px","left":"1765.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59a335c5-fd79-4508-9842-66f735f3b382":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'c7d220bd-2237-49f4-88ec-14c555bf202c',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"71e66d5e-ddc0-48d4-930d-8630f59d2205","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a44a1fae-2ceb-4540-a8a9-8f1d73c07a8d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-84cd7a4c-d05a-49a9-8532-04d3bdd3a178","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"59a335c5-fd79-4508-9842-66f735f3b382","root":false,"$title":"[Redirect] to Autenticacao (Falar sobre conta)","$position":{"top":"94.1429px","left":"2386.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"60c69fbc-f2d3-4175-8164-766775c3249b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b1f60af7-aebd-467b-a946-6b29986b4841","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"db349365-2175-49fc-a826-958a03cb328d","typeOfStateId":"state","$connId":"con_208","$id":"9bc73c11-40c1-4967-ab07-0f5a9858d11f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Pacotes contratados"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"e8ac1b1d-15a5-46d5-8d1f-38cefba34a72","typeOfStateId":"state","$connId":"con_213","$id":"8eb0d09a-04f2-4c6c-9cb3-250c151fb3ba","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Falar sobre conta"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"91017043-1b92-4e8b-b4ae-2251ba97d6fd","typeOfStateId":"state","$connId":"con_218","$id":"d4800ec3-88fb-4edd-9d7f-82dedc1e5a5d","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a1c7d772-7946-4ba2-8ba2-e8120693b090","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c0b70a3-1ed1-4504-9ce4-1ee108036509","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"9caee4bd-4029-4442-b993-b0555e5ba454","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"102f100e-d00a-4542-9c14-217ff0690c2e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ffd90b76-a85c-4401-8cdd-53897f39019a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Main {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b41f19c4-af80-427c-aeb5-9b0ff66d42e1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b29bc552-6130-4867-990c-4f54e2356b4a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-519188ab-def7-499c-a28b-de586c915091","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-566da5b2-e571-4af9-aea3-ee8bed20c9c3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"60c69fbc-f2d3-4175-8164-766775c3249b","root":false,"$title":"[M.5.3.0][INPUT]Valida seleção menu conta corrente","$position":{"top":"974.333px","left":"878.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"91017043-1b92-4e8b-b4ae-2251ba97d6fd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"eab113f2-57fe-43f0-b9ad-40b61f6656de","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7275c15b-cc6d-42f6-bcb7-91c3ca435575","typeOfStateId":"state","$connId":"con_223","$id":"f1c93554-b4c6-4b45-ab6a-e90d33ca0b0e","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"cpfAppKey"},{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}],"$invalid":false},{"stateId":"a8d74877-19ab-4da1-ae50-32f1279e40e7","typeOfStateId":"state","$connId":"con_228","$id":"5ab394cc-ad10-4b13-8cf9-c5165da490fb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4acc409b-2219-418e-8e72-fd1c5c108e13","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b8c84882-ac72-4c9e-8fda-ad1c581f60ef","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{{state.name}} dados validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados validacao","action":"{{cpfAppKey}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-73b1b7b7-b22b-4ce5-8cb2-5f91442a1bbd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"91017043-1b92-4e8b-b4ae-2251ba97d6fd","root":false,"$title":"[CC.0.0.0] Verifica cpfAppKey","$position":{"top":"1511px","left":"850px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7275c15b-cc6d-42f6-bcb7-91c3ca435575":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b214e61f-2c8e-443b-9b8d-615eed52b120","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"53c8ce46-276b-4fd6-992b-d177b1f32dc0","typeOfStateId":"state","$connId":"con_233","$id":"69f79666-7c19-4b53-bf4e-375b6b9e04cb","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extratos"],"source":"context","comparison":"equals","variable":"userInput"},{"values":["true"],"source":"context","comparison":"equals","variable":"podeSeguirExtrato"}],"$invalid":false},{"stateId":"7b5b24dc-973f-464b-a87b-dea8bd3c5c2e","typeOfStateId":"state","$connId":"con_238","$id":"855b6bee-e37b-424c-b95e-69ff8a70953e","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Fazer Pix"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"f2e39bfe-b733-427b-b970-8b754d8cb015","typeOfStateId":"state","$connId":"con_243","$id":"04696d6f-6ba3-46fe-947e-7c594b9888c1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Pagar Contas"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"18f4fc50-145f-41f6-af5e-3636d923f160","typeOfStateId":"state","$connId":"con_248","$id":"014b9ac5-60ce-47dc-b8b7-f8180524b2fe","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Antecipar saldo"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"a508df2f-7177-4554-959b-2b62037f453b","typeOfStateId":"state","$connId":"con_253","$id":"cc260adc-cc9c-48f1-8251-0b9c35b9c094","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Extratos"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"63403e40-c821-4688-a201-255360fcebb1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"de972ec9-71cb-476d-8ea5-bcc7304c97e0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{{state.name}} dados validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados validacao","action":"{{userInput}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"},{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9a6ee569-e676-44e6-ae7d-8e044d97a96f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"7275c15b-cc6d-42f6-bcb7-91c3ca435575","root":false,"$title":"[CC.0.0.1] Rotas com cpfAppKey","$position":{"top":"1791px","left":"878.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8d74877-19ab-4da1-ae50-32f1279e40e7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0142587f-cabe-4f27-b821-cf94d9306f4e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90e85c65-51a7-434b-ab81-66179515bfb0","typeOfStateId":"state","$connId":"con_258","$id":"57429a29-f653-42f6-bd57-0b6b7652738a","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Fazer Pix"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"a122a8b3-b7d0-49bb-8d3b-73b5e22d2625","typeOfStateId":"state","$connId":"con_263","$id":"b7531d52-27e6-4db4-8744-d16e860fa5b2","conditions":[{"source":"context","comparison":"equals","values":["Extrato"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e24a0468-e455-4781-bdbe-b997d8c45b08","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"52f24b94-2173-4095-9cc3-f57c9b4ee10c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{{state.name}} dados validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} dados validacao","action":"{{userInput}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"cpfAppKey"},{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"daa2d803-2548-400e-8782-47ecaec9aca1","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1d24c40-0db2-4d0d-8713-9c009b54322b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"a8d74877-19ab-4da1-ae50-32f1279e40e7","root":false,"$title":"[CC.0.0.2] Rotas sem cpfAppKey","$position":{"top":"1510.57px","left":"589.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"db349365-2175-49fc-a826-958a03cb328d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"24f2e6a7-274a-4f6f-98da-d087324d8a16","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"191a2f33-c58e-4a64-9e66-af23348bcbad","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"db349365-2175-49fc-a826-958a03cb328d","root":false,"$title":"[GO TO][CC.3.0.0] Pacotes Contratados","$position":{"top":"997px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5731d56-35b1-4087-80f0-08109fb6f5a6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de0209ba-cc78-4ccc-a44d-8ebb5b84cd0a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"462596bd-3e1f-480a-85b5-4c2e948e4109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `WhatsApp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: 'atendente',//Refatorar\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d020a3f2-daee-4595-b129-c1d5f7d88fd6","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f0ed7df6-a610-436c-baeb-a5a8de12d2f9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-424f96ba-a886-40df-a95c-574ddbde9571","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"a5731d56-35b1-4087-80f0-08109fb6f5a6","root":false,"$title":"[Redirect] WhatsApp PJ (atendente)","$position":{"top":"96.5385px","left":"2194.64px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"48bd2fab-30a5-46c8-8a6b-cf482187a66e":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","typeOfStateId":"state","$connId":"con_268","$id":"bc15e77d-d70f-4984-ac9a-975fc1df296e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9166dc8d-1b3c-4b22-a2e8-eb27c196f0cf","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"26e44d85-531d-464c-9c40-96f270867cfc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Ótimo, toque no botão abaixo que te levo para ver o *extrato de recebimentos* no *Safrapay online.*\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Extrato recebimentos\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/extrato-recebimento/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/extrato-recebimento/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-dca07211-0cb3-492a-b91a-99df3606410e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0ab759a9-d709-42a5-bcdb-f063754674da","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"48bd2fab-30a5-46c8-8a6b-cf482187a66e","root":false,"$title":"[M.5.3.3][MSG]Extrato Safrapay","$position":{"top":"2362.29px","left":"1766px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"c9666009-688a-4b7f-913b-e16f3ec2ca36":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","typeOfStateId":"state","$connId":"con_273","$id":"59f3d197-5acc-4b16-9104-3ef83fbe9d37","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"07e19e66-78a0-4d5d-864a-a9908347690d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"0c4cfa96-b257-49e3-8ebc-ae3433b1ee32","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Ótimo, toque no botão abaixo que te levo para ver o *extrato de vendas* no *Safrapay online.*\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Extrato vendas\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/extrato-vendas/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/extrato-vendas/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-cbdc4706-85e4-49d5-b52c-1f4f758e5752","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5ba00d3a-ee2a-47c5-bb14-80d4657d8f12","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"c9666009-688a-4b7f-913b-e16f3ec2ca36","root":false,"$title":"[M.5.3.4][MSG]Extrato Safrapay vendas","$position":{"top":"2369.33px","left":"2139.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"03573ae8-ef6e-49cc-9b6d-34a535eabaaa":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","typeOfStateId":"state","$connId":"con_278","$id":"313aa96d-cf9e-4204-bb23-c8d99c5d0ce8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"99787a1a-1e8d-4885-af87-d29ecd338b04","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"7cf44291-1035-4e0c-9c6a-8f63646c67ed","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Ótimo, toque no botão abaixo que te levo para ver o *extrato da conta* no *Safrapay online.*\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Extrato conta\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/extrato-cc/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/extrato-cc/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-c2b9e2c7-ec71-418f-a01e-5e25fab0e17f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-87cbb10f-5a29-4cb7-8d33-1f35a153036e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"03573ae8-ef6e-49cc-9b6d-34a535eabaaa","root":false,"$title":"[M.5.3.2][MSG]Extrato Conta Corrente","$position":{"top":"2374.75px","left":"1404px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"45cffe4e-e04f-49f3-b27e-ce0eadc35436":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"027aa854-8dd8-400c-94bb-a6951c58bd52","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"45cffe4e-e04f-49f3-b27e-ce0eadc35436","root":false,"$title":"[GO TO] Finalização (Welcome)","$position":{"top":"2630px","left":"1765.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7b5b24dc-973f-464b-a87b-dea8bd3c5c2e":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"a216f05b-87bd-4a4e-824f-582bb99bfec4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"5de51383-d174-4bda-ac3e-71ac67c53fe0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","typeOfStateId":"state","$connId":"con_283","$id":"9b9f4325-e39d-4664-b220-368162caa5fe","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"de853304-eb70-4b2e-84d6-5082eef89860","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"ea3cff73-4daa-4e02-9c19-803865e4056d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o <b>Safrapay online</b> para fazer um  pix utilizando seu saldo disponível.\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Fazer PIX\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/pix/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/pix/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"$tags":[{"id":"blip-tag-97635a3c-689c-44d7-841b-0e0f4df491fd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-216a192c-48d6-4c71-87b5-1ca44601bc80","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"7b5b24dc-973f-464b-a87b-dea8bd3c5c2e","root":false,"$title":"[CC.7.0.0] PIX","$position":{"top":"2101.29px","left":"492.857px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"18f4fc50-145f-41f6-af5e-3636d923f160":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"62d9d1e3-c20d-4892-a49d-420de31d72bb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9e35073d-8b55-4f1e-83e9-f4f42b8b1d00","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"9e35073d-8b55-4f1e-83e9-f4f42b8b1d00","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","typeOfStateId":"state","$connId":"con_288","$id":"fb9dd6b2-d3e6-4566-9370-a1fff249bc52","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ba3a0fd4-b9ed-43ed-9260-5460905c45ae","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"f372e95e-d115-44c6-bb6d-119a71ddfe7f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Para *fazer a antecipação do saldo*, é só acessar o botão a seguir e finalizar a solicitação no *Safrapay online*\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Antecipar saldo\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/antecipacao/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/antecipacao/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"$tags":[{"id":"blip-tag-123cd017-10dc-43c4-bafa-b52f811a683c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fa557481-4b08-4d7c-9b84-41e8233d71bb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"18f4fc50-145f-41f6-af5e-3636d923f160","root":false,"$title":"[CC.8.0.0] Antecipação","$position":{"top":"2081.86px","left":"1268.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f2e39bfe-b733-427b-b970-8b754d8cb015":{"$contentActions":[{"action":{"$id":"16628216-ced6-407d-8fb5-5379ec8bdf8f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"9d58d8a0-e9e9-4e79-b20f-0cc26ae1c934","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"bdaa8f7f-c102-438b-a854-f30d066576c4","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ced6b99a-0272-44f6-b820-a7ac5ee5f75a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"ced6b99a-0272-44f6-b820-a7ac5ee5f75a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"3000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","typeOfStateId":"state","$connId":"con_293","$id":"de86e889-849c-4d8f-8d34-777d74c65d87","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"62cff1b1-b53c-4079-ba80-049b7d515d58","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"1e280cf4-b96a-48c8-b5a0-bda8e2c7622d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"cta_url\",\n    \"body\": {\n      \"text\": \"Acesse o *Safrapay online* e pague seus *boletos* utilizando seu saldo disponível\"\n    },\n    \"action\": {\n      \"name\": \"cta_url\",\n      \"parameters\": {\n        \"display_text\": \"Fazer pagamento\",\n        \"url\": \"\"\n      }\n    }\n  }\n}\nfunction run(botName, cpfAppKey) {\n  try {\n    const env = botName.split('@')[0]\n    if (env === 'prodspdcontacorrente') {\n      dynamicContent.interactive.action.parameters.url = `https://static.safra.com.br/apl-web-bts/pagamentos/${cpfAppKey}`\n      return dynamicContent\n    } else {\n      dynamicContent.interactive.action.parameters.url = `https://spa-sp2-ti.safrapay.com.br/apl-web-bts/pagamentos/%7B%7B1%7D%7D${cpfAppKey}`\n      return dynamicContent\n    }\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["application.identifier","cpfAppKey"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"$tags":[{"id":"blip-tag-291721d4-4815-4661-851a-9b02b1f1a1ef","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ac8737f0-220f-472e-a0bd-f31dc58c1029","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"f2e39bfe-b733-427b-b970-8b754d8cb015","root":false,"$title":"[CC.9.0.0] Pagar Contas","$position":{"top":"2090px","left":"878.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"62119161-7c61-4e4a-a21b-78049c914a07","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ae6d4caf-e8ae-4ad3-97db-19d4ac0b4341","root":false,"$title":"[GO TO] Finalização (Welcome)","$position":{"top":"2463px","left":"879.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2c702d71-9c63-4c5c-b79d-947b11c75dde":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0b534eff-eff6-4c03-be5a-43d436775051","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2361b9db-e18e-45de-afea-a50626686dd8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2c702d71-9c63-4c5c-b79d-947b11c75dde","root":false,"$title":"[GO TO] Redirect to Atendimento Humano (Welcome)","$position":{"top":"986.111px","left":"1956.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8ac1b1d-15a5-46d5-8d1f-38cefba34a72":{"$contentActions":[{"action":{"$id":"67d9c249-d067-41cb-a9c1-2d4c1133a419","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d978de54-9a42-4b98-b544-04d5de173283","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d978de54-9a42-4b98-b544-04d5de173283","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"19834d15-95a1-4c9b-91f1-a8659ca386cb","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7cf7f343-727e-46f9-8bac-5c64511b06bd","type":"text/plain","content":"Certo, você deseja <b>Falar sobre conta.</b> Por gentileza, especifique em poucas palavras o que deseja saber sobre esse assunto. Por exemplo: <b>Não consigo acessar minha conta</b>","metadata":{}},"$cardContent":{"document":{"id":"7cf7f343-727e-46f9-8bac-5c64511b06bd","type":"text/plain","content":"Certo, você deseja <b>Falar sobre conta.</b> Por gentileza, especifique em poucas palavras o que deseja saber sobre esse assunto. Por exemplo: <b>Não consigo acessar minha conta</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"14e88ea2-fdd6-47b0-a2dc-5b4e3ae1373a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"61205158-c541-4094-af98-bc743d0be801","typeOfStateId":"state","$connId":"con_298","$id":"f4a617ea-ae9c-4b4a-9242-e43e89b2b1a9","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ac70df46-9593-4322-bfb3-3af4a829d1f3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ebb1b40e-8ead-4485-b947-564ad9b67f87","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-43871337-0783-4c69-a1df-9d011714363e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e8ac1b1d-15a5-46d5-8d1f-38cefba34a72","root":false,"$title":"[CC.10.0.0] Falar sobre conta - Pergunta assunto","$position":{"top":"985.925px","left":"1154.92px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"61205158-c541-4094-af98-bc743d0be801":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0046d93c-3edb-4994-9c0f-4e9d8d14e7de","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2c702d71-9c63-4c5c-b79d-947b11c75dde","typeOfStateId":"state","$connId":"con_303","$id":"879b7bdb-174f-4593-a938-838d4111a285","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["true"],"source":"context","comparison":"notEquals","variable":"podeSeguirIntencao@allowed"}],"$invalid":false},{"stateId":"75abb192-5f2c-47f8-bf31-1e5ba4ff66ce","typeOfStateId":"state","$connId":"con_308","$id":"5bcdd263-4026-4d85-84b1-20eebe856df6","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["true"],"source":"context","comparison":"equals","variable":"podeSeguirIntencao@allowed"},{"values":[],"source":"context","comparison":"notExists","variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"b56b180f-7947-46d6-b4e1-9de1469f0fa2","typeOfStateId":"state","$connId":"con_313","$id":"f672e89d-23d7-4535-b76e-8fecb981bc5f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":[],"source":"context","comparison":"exists","variable":"contaSelecionada@segmentoGerente"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e0f5107e-c049-4265-8d61-6f60a6b1b11a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Main {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} validação","action":"{{userInput}} | {{input.intent.name}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0d878e10-f07c-4185-816c-40d183006ba4","$typeOfContent":"","type":"SetVariable","$title":"Set \"falarSobre\" to \"{input.content}\"","$invalid":false,"settings":{"variable":"falarSobre","value":"{{input.content}}"},"conditions":[]},{"$id":"9bfe0e9c-a1f3-49ae-85e6-c306bd5ea17b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"podeSeguirIntencao\"","$invalid":false,"settings":{"function":"run","source":"function checkVariables(contaSelecionada, selectedEc) {\n  try {\n    let variables = []\n    if (contaSelecionada) {\n      contaSelecionada = JSON.parse(contaSelecionada)\n      const keyContaSelecionada = Object.keys(contaSelecionada)\n      keyContaSelecionada.forEach((key) => {\n        if (contaSelecionada[key]) {\n          return variables.push(key)\n        }\n      })\n    }\n    if (selectedEc) {\n      selectedEc = JSON.parse(selectedEc)\n      const keySelectedEc = Object.keys(selectedEc)\n      keySelectedEc.forEach((key) => {\n        if (selectedEc[key]) {\n          return variables.push(key)\n        }\n      })\n    }\n    return variables\n  } catch (err) {\n    return []\n  }\n}\n\nfunction run(intencaoIdentificada, contaSelecionada, selectedEc, intentDestination) {\n  try {\n    const intent = JSON.parse(intentDestination).find(intent => intent.intent.toLowerCase() === intencaoIdentificada.toLowerCase())\n    const userContext = {\n      variables: checkVariables(contaSelecionada, selectedEc),\n      destinationBlock: '',\n      allowed: false,\n      auth: false\n    }\n    if (intent) {\n      if (intent.requirements.length === 0 || intent.requirements[0] === '') {\n        userContext.allowed = true;\n        userContext.destinationBlock = intent.destinationBlock;\n        userContext.destinationBot = intent.destinationBot\n      } else {\n        userContext.allowed = intent.requirements.every(requirement => userContext.variables.includes(requirement));\n        if (userContext.allowed) {\n          userContext.destinationBlock = intent.destinationBlock;\n          userContext.destinationBot = intent.destinationBot\n          userContext.auth = intent.auth\n        }\n      }\n    }\n    return userContext\n  } catch (err) {\n    return {\n      allowed: false,\n      destinationBlock: '',\n      error: err.message\n    }\n  }\n}\n","inputVariables":["input.intent.name","contaSelecionada","selectedEc","resource.intentDestination"],"outputVariable":"podeSeguirIntencao","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d1a6508d-0b47-4002-a6cb-c117c2d778da","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9f2caca1-f1b6-4fe1-98c7-317381cc7769","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fa66e1cb-8286-4b63-ae8d-eebb075423e9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-333a8a06-f0c8-42e1-9540-bf1e91dfc8ca","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"61205158-c541-4094-af98-bc743d0be801","root":false,"$title":"[CC.10.0.0][INPUT] Pergunta assunto","$position":{"top":"986px","left":"1413px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b56b180f-7947-46d6-b4e1-9de1469f0fa2":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"96de67f2-c8e0-44a0-a8c8-8727d70acdc1","typeOfStateId":"state","$connId":"con_318","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ir para assunto\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"type\": \"reply\",\n\t\t\t// \t\"reply\": {\n\t\t\t// \t\t\"id\": \"3\",\n\t\t\t// \t\t\"title\": \"\"\n\t\t\t// \t}\n\t\t\t// }\n\t\t];\n\t\tconst bodyText = `Certo, sobre esse assunto podemos ajudar você por aqui!\n\nComo deseja seguir?`\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2ae22387-bf07-4d09-bcf2-de17d0b09304","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6621b89b-db57-4b33-8f25-72ef00e4fb99","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c230d9f3-02df-4988-9711-1ad7702d587e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b56b180f-7947-46d6-b4e1-9de1469f0fa2","root":false,"$title":"[CC.10.1.0][MSG] Assusto existe no bot","$position":{"top":"1435px","left":"1548px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"96de67f2-c8e0-44a0-a8c8-8727d70acdc1":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75abb192-5f2c-47f8-bf31-1e5ba4ff66ce","typeOfStateId":"state","$connId":"con_323","$id":"8d46bd66-275a-4be5-b79a-a0c94d0ffdfb","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Ir para assunto"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"2c702d71-9c63-4c5c-b79d-947b11c75dde","typeOfStateId":"state","$connId":"con_328","$id":"bf580ead-4b91-4d14-8170-d85f0d2317a8","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0eb2a5de-f59a-4db1-9fb4-63ad68e382f7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0f1db913-ef14-4698-b032-59a06eb67f99","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7ef2240a-1241-4ce8-897e-ba5e785c506c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c8031b33-40e3-4b3c-834a-3d912126188d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"96de67f2-c8e0-44a0-a8c8-8727d70acdc1","root":false,"$title":"[CC.10.1.0][INPUT] Assunto existe no bot","$position":{"top":"1410.44px","left":"1956.22px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75abb192-5f2c-47f8-bf31-1e5ba4ff66ce":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env, falarSobre) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'ccd08df4-3bc4-4e38-807c-bd181e0eb0cf',\n\t\t\tlastInput: falarSobre,\n\t\t\tintent: falarSobre\n\t\t}\n\t} catch (error) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: error.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env","falarSobre"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4cfdf876-2ee4-4d05-9c5e-417efccf8da4","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e4833c95-5372-428d-9b39-8f3a4d051174","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"75abb192-5f2c-47f8-bf31-1e5ba4ff66ce","root":false,"$title":"[Redirect] Cascata Validar Intenção","$position":{"top":"1197.22px","left":"1659.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b9a7f027-209a-4d73-ab4d-aa0086d480dc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'ed2a5fb2-da6f-4961-b14d-e302fa57b991',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9bda15dd-2e8a-48ab-876b-6b6e270b2703","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-85641f0c-8409-415e-a71a-2862f9155f91","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"b9a7f027-209a-4d73-ab4d-aa0086d480dc","root":false,"$title":"[Redirect] to Finalizacao (F.4.0.0)","$position":{"top":"104.429px","left":"973.143px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"368ed6d2-36d7-4631-a0b5-982523a88008":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d3f33e59-2d1a-4743-8950-eab3409746a4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"40be20b8-777e-4426-8b10-5784fd180f18","typeOfStateId":"state","$connId":"con_333","$id":"ae3a7fbe-5e71-4316-9247-84e350d010e1","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contaSelecionada@segmentoGerente"}],"$invalid":false},{"stateId":"9654bbae-376f-439f-a7bd-5ce83c1939d4","typeOfStateId":"state","$connId":"con_338","$id":"3d82801a-bc18-492c-9c28-43985cb1a389","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1745a276-38a7-490b-a01d-9ae2a7722a87","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"7bf85e68-666b-477b-8282-b3bbdb0b8a3f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} dados\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} dados","action":"{{contact.identity}} | {{state.previous.name}} | {{contaSelecionada@segmentoGerente}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2ae62d14-e9a5-4d63-baba-62c3d683f372","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"368ed6d2-36d7-4631-a0b5-982523a88008","root":false,"$title":"[SET] Valida Carteirização","$position":{"top":"1691px","left":"173px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"40be20b8-777e-4426-8b10-5784fd180f18":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"845c49d1-02c2-4b51-b338-04c3bf582335","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"b9a7f027-209a-4d73-ab4d-aa0086d480dc"},"isAiGenerated":false,"$tags":[],"id":"40be20b8-777e-4426-8b10-5784fd180f18","root":false,"$title":"[GO TO] Redirect F.4.0.0 Finalização","$position":{"top":"1953px","left":"82px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"9654bbae-376f-439f-a7bd-5ce83c1939d4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d558b48c-877c-41c8-a585-da2d3573e6d4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"820d335f-0c95-466f-9009-35cac24c6ea4"},"isAiGenerated":false,"$tags":[],"id":"9654bbae-376f-439f-a7bd-5ce83c1939d4","root":false,"$title":"[GO TO] Redirect Finalização F.0.0.0","$position":{"top":"1960px","left":"290px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"e0092495-e95a-44a8-afe3-0c150eda196d":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f7cbe846-506f-4b96-98ef-51172aa1ba95","typeOfStateId":"state","$connId":"con_343","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]},{"$id":"d0378df3-2848-4e61-b4b3-6abc7a26d4eb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n    {\n        \"id\": \"1\",\n        \"title\": \"7 dias\",\n        \"description\": \"Extrato de conta dos últimos 7 dias\"\n    },\n    {\n        \"id\": \"2\",\n        \"title\": \"15 dias\",\n        \"description\": \"Extrato de conta dos últimos 15 dias\"\n    },\n    {\n        \"id\": \"3\",\n        \"title\": \"30 dias\",\n        \"description\": \"Extrato de conta dos últimos 30 dias\"\n    },\n    {\n        \"id\": \"4\",\n        \"title\": \"90 dias\",\n        \"description\": \"Extrato de conta dos últimos 90 dias\"\n    },\n    {\n        \"id\": \"5\",\n        \"title\": \"Outro período\",\n        \"description\": \"Digite um período específico\"\n    }\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n    if (posicao > menuOptions.length) {\n        posicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n    }\n    if (menuOptions.find(option => option.id == posicao)) {\n        quantidadeItens = menuOptions.length\n        for (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n            menuOptions[i].id = (i + 2).toString()\n        }\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72) || ''\n        })\n    } else {\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72)\n        })\n    }\n    menuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n    // Parametro de busca é o title ou description da opção que deseja atualizar\n    const opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n    if (!opcao) {\n        return\n    }\n    menuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n    menuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (permissoes.includes(permissoesNecessarias)) {\n        return\n    }\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada) {\n    try {\n        // const { ec, cpfAppKey } = JSON.parse(contaSelecionada)\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Certo, você deseja falar sobre extrato. Toque no botão abaixo e informe o período desejado.`\n                },\n                \"action\": {\n                    \"button\": \"Selecionar período\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": menuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return {\n            error: err.message,\n            exceptionType: 'reiniciarFluxo',\n            dynamicContent: {\n                \"type\": \"text/plain\",\n                \"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n            }\n        }\n    }\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e378b643-f23f-4962-b8d1-70ca592c8636","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a35c9b1f-2576-4104-8735-83b424f57d87","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9854b966-fa9d-4b9a-b820-e641ef3a4299","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e0092495-e95a-44a8-afe3-0c150eda196d","root":false,"$title":"[CC.11.0.0][MSG] Extrato","$position":{"top":"827px","left":"6938px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f7cbe846-506f-4b96-98ef-51172aa1ba95":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0b757b14-be1e-4c6e-9d1d-e5a7c3202a74","typeOfStateId":"state","$connId":"con_348","$id":"51684b23-25d2-4f0f-9818-22175a35a9e1","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Outro período"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"818ab070-a8a7-401b-96d5-257ada229e37","typeOfStateId":"state","$connId":"con_353","$id":"aa2880e7-84ad-4604-84a4-e85f4f2dd34a","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["Outro período"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"b24a8436-c821-406f-99fc-eccd0ef3974e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ec193fd1-15ab-4e51-85e3-d13fe2df684b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"ce85249b-9f72-46fd-ad56-0ba477a65112","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" (identifica datas)","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n\ttry {\n\t\tconst today = new Date()\n\t\tconst days = parseInt(userInput.replace('dias', ''))\n\t\tconst pastDate = new Date(today)\n\t\tpastDate.setDate(today.getDate() - days)\n\t\tif (!pastDate) return 'input inesperado'\n\t\treturn `${today.toISOString().split('T')[0]} - ${pastDate.toISOString().split('T')[0]}`\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["userInput"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["Outro período"],"source":"context","comparison":"notEquals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1a10143e-3494-47b6-8126-4bed921a907c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-321cd106-3e7a-4c9d-a6d7-51086c8238cf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-74633387-0800-460e-bdd6-d5779acfd972","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5df792f6-1b30-4a25-ae54-684b89c4af48","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f7cbe846-506f-4b96-98ef-51172aa1ba95","root":false,"$title":"[CC.11.0.0][INPUT] Extrato","$position":{"top":"1116px","left":"6938px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"818ab070-a8a7-401b-96d5-257ada229e37":{"$contentActions":[{"action":{"$id":"2685f99b-41f6-446d-bf0f-456c93b8a4dc","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"99e40507-cb5f-4a9a-9479-a631d45228ff","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"99e40507-cb5f-4a9a-9479-a631d45228ff","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"91d3d278-c824-4cb1-8487-6436fcbb930a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b5db7b52-2a9b-44db-a5f9-9e0e0e276572","type":"text/plain","content":"Aguarde só um instante,\nestou <b>consultando o seu extrato.</b>","metadata":{}},"$cardContent":{"document":{"id":"b5db7b52-2a9b-44db-a5f9-9e0e0e276572","type":"text/plain","content":"Aguarde só um instante,\nestou <b>consultando o seu extrato.</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"152920c5-cdf2-4570-93ab-a897ade46262","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e352b9af-0cf7-4745-81da-e6a99da6da34","typeOfStateId":"state","$connId":"con_358","$id":"f5b417d1-584b-4027-95b1-7b15a8aecc93","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd047624-b2ce-4d0d-be4e-f044c70a298c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e1e732b7-aa58-4993-a566-0015c8c10994","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-796f59d3-4fcd-4221-ad56-3bbf91ad3471","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"818ab070-a8a7-401b-96d5-257ada229e37","root":false,"$title":"[CC.11.1.0][MSG] Mensagem pré chamada API","$position":{"top":"1326px","left":"6669px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e352b9af-0cf7-4745-81da-e6a99da6da34":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2b36e462-9f8e-44ae-9b35-40b6e45ae3d8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"bfbcfcbf-2c9f-4daa-b850-b45b35aab397","typeOfStateId":"state","$connId":"con_363","$id":"79a2cdc0-e476-4f2e-ab9d-4bcae18f4a22","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"extratoStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d9335b92-9188-41ff-b292-c260ed11c2fc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"urlParams\"","$invalid":false,"settings":{"function":"run","source":"function run(data, contaSelecionada) {\n\ttry {\n\t\tconst { agencia, conta } = JSON.parse(contaSelecionada)\n\n\t\tconst dataInicial = data.split(' - ')[1]\n\t\tconst dataFinal = data.split(' - ')[0]\n\n\t\tconst [anoInicial, mesInicial, diaInicial] = dataInicial.split('-')\n\t\tconst [anoFinal, mesFinal, diaFinal] = dataFinal.split('-')\n\n\t\treturn `agencia=${agencia}&conta=${conta}&dataInicial=${diaInicial}-${mesInicial}-${anoInicial}&dataFinal=${diaFinal}-${mesFinal}-${anoFinal}&limite=100&pagina=1`\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["userInput","contaSelecionada"],"outputVariable":"urlParams","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1641187d-dffe-4de2-b858-21637643b8f1","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"extratoResponse\" using \"GET\"","$invalid":false,"settings":{"headers":{"Safra-Correlation-ID":"1","Authorization":"Bearer {{bodyToken@access_token}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/clientes/dados-contas-clientes/assistente-virtual/v1/extratos?{{urlParams}}","responseStatusVariable":"extratoStatus","responseBodyVariable":"extratoResponse"},"conditions":[]}],"$leavingCustomActions":[{"$id":"e5583421-aa1e-43bd-864c-2e653122e29e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"const dynamicContent = {\n  \"recipient_type\": \"individual\",\n  \"type\": \"document\",\n  \"document\": {\n    \"link\": \"<MEDIA_URL>\", // REQUIRED - URL of image asset on your public server. For better performance, we recommend that you upload your media asset instead.\n    // \"caption\": \"<DOCUMENT_CAPTION>\", // OPTIONAL - Document caption text.\n    \"filename\": \"<DOCUMENT_FILENAME>\" // OPTIONAL - Document filename, with extension. The WhatsApp client will use an appropriate file type icon based on the extension.\n  }\n}\nfunction run(extratoResponse, dataExtractor) {\n  try {\n    const [inicial, final] = dataExtractor.split(' - ')\n    const [anoInicial, mesInicial, diaInicial] = inicial.split('-')\n    const [anoFinal, mesFinal, diaFinal] = final.split('-')\n    const periodo = `extrato_de_${diaFinal}-${mesFinal}-${anoFinal}_a_${diaInicial}-${mesInicial}-${anoInicial}.pdf`\n    const { data } = JSON.parse(extratoResponse)\n    if (!data.urlDocumento) {\n      return false\n    }\n    dynamicContent.document.link = data.urlDocumento\n    // dynamicContent.document.caption = 'teste'\n    dynamicContent.document.filename = periodo\n    return dynamicContent\n  } catch (err) {\n    return false\n  }\n}","inputVariables":["extratoResponse","userInput"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"446995f4-daf5-4e83-8461-5371549619fc","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApiExtrato\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApiExtrato"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"extratoStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7357c59f-9acc-451b-80ff-065a1beec27b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8d7a9f57-c0a9-46bd-aa81-d290089388ed","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-159e7741-e49e-4a92-a2ff-0f7d16e74f35","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"e352b9af-0cf7-4745-81da-e6a99da6da34","root":false,"$title":"[CC.11.1.1][HTTP] Consulta de extrato","$position":{"top":"1603px","left":"6669px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0b757b14-be1e-4c6e-9d1d-e5a7c3202a74":{"$contentActions":[{"action":{"$id":"10891ae7-a3c5-4559-91de-2329b7e86634","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"096778c8-9769-40b8-ad59-c6b55a9a7113","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"096778c8-9769-40b8-ad59-c6b55a9a7113","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f6e4e240-bd99-40d7-abe8-9737dd6b0bfd","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d8280938-1390-44b9-822a-5bf25e75e0e8","type":"text/plain","content":"Informe o período desejado\ncomo no <b>exemplo: 60 dias.</b>\n\n<b>Lembre-se:</b> por aqui, é possível consultar extratos\nem um período de até 90 dias.","metadata":{}},"$cardContent":{"document":{"id":"d8280938-1390-44b9-822a-5bf25e75e0e8","type":"text/plain","content":"Informe o período desejado\ncomo no <b>exemplo: 60 dias.</b>\n\n<b>Lembre-se:</b> por aqui, é possível consultar extratos\nem um período de até 90 dias."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"221def7f-a159-4213-8d2f-3eb39c998919","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e17e3fb8-8993-402f-bedc-5bb6076ca0df","typeOfStateId":"state","$connId":"con_368","$id":"444b3c53-6e94-4d83-a0cb-cf34d79cfb53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-658c9ad6-56e1-4c51-bd30-13c2c3e821de","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0b757b14-be1e-4c6e-9d1d-e5a7c3202a74","root":false,"$title":"[CC.11.2.0][MSG] Outro período","$position":{"top":"1116px","left":"7260px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e17e3fb8-8993-402f-bedc-5bb6076ca0df":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"cebca0ff-38af-4f01-8805-3fc667dc045a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"818ab070-a8a7-401b-96d5-257ada229e37","typeOfStateId":"state","$connId":"con_373","$id":"11e98a1a-0105-4038-b627-754571c34f60","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"facd15b8-536a-4a97-b9ce-7277025a8d51","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n\ttry {\n\t\tconst userInputLimpo = parseInt(userInput.replace(/[^0-9]/g, ''))\n\t\tif (userInputLimpo < 0) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tif (userInputLimpo > 90) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\t\tif (isNaN(userInputLimpo)) {\n\t\t\treturn 'input inesperado'\n\t\t}\n\n\t\tconst today = new Date()\n\t\tconst days = userInputLimpo\n\t\tconst pastDate = new Date(today)\n\t\tpastDate.setDate(today.getDate() - days)\n\t\tif (!pastDate) return 'input inesperado'\n\t\treturn `${today.toISOString().split('T')[0]} - ${pastDate.toISOString().split('T')[0]}`\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79cc97cf-01dd-49a6-a92b-9cbf81f54a16","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exceptionType\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n    try {\n        const userInputLimpo = parseInt(userInput.replace(/[^0-9]/g, ''))\n        if (userInputLimpo > 90) {\n            return 'extratoSuperiorNoventaDias'\n        }\n        return 'periodoInvalido'\n    } catch (err) {\n        return 'periodoInvalido'\n    }\n}","inputVariables":["input.content"],"outputVariable":"exceptionType","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2eb82464-efa3-4173-8fc1-c52ece19b83e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5d1a68c5-9129-4d93-bd79-cbf291760494","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e17e3fb8-8993-402f-bedc-5bb6076ca0df","root":false,"$title":"[CC.11.2.1][INPUT] Outro período","$position":{"top":"1326px","left":"7260px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bfbcfcbf-2c9f-4daa-b850-b45b35aab397":{"$contentActions":[{"action":{"$id":"66a889b1-7c7d-4aac-a30e-d151b99cba6c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19193635-5ea6-42a7-adc3-91dd1b694fc2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19193635-5ea6-42a7-adc3-91dd1b694fc2","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"db686289-c01e-42f2-93e5-a3238662e52b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3166ef49-31b4-423a-8f87-35032384e7ec","type":"text/plain","content":"Aqui está o <b>extrato</b>.\nPara acessar, toque no PDF abaixo:","metadata":{}},"$cardContent":{"document":{"id":"3166ef49-31b4-423a-8f87-35032384e7ec","type":"text/plain","content":"Aqui está o <b>extrato</b>.\nPara acessar, toque no PDF abaixo:"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"8e1d538a-5933-4a4a-9036-4d7aa04ada65","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false},{"action":{"$id":"e27d4fd5-b954-491b-b7a9-df6e540863bf","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6f24a5a4-69b8-457c-8f86-8610cd0f2de8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"6f24a5a4-69b8-457c-8f86-8610cd0f2de8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"946fe345-d259-4f54-919d-8b7a7f2bf459","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"action":{"$id":"85e7d928-208f-44dd-8a28-e19467055cc0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4f1139ca-98d6-4c18-97a6-4dffdd3a4c9a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"4f1139ca-98d6-4c18-97a6-4dffdd3a4c9a","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cb5f26b9-1f3c-4540-a3be-e81565c40b1e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"41aa641d-4615-4e69-8b44-e1fbca52f367","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"41aa641d-4615-4e69-8b44-e1fbca52f367","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b1255251-6e45-4c79-b385-ae5e1e697655","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a994c423-ff7c-4171-8077-b463b183c2d8","type":"text/plain","content":"<i>Se o documento estiver sem informações, pode ser que não tenha ocorrido movimentação financeira no período mencionado.</i>","metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"a994c423-ff7c-4171-8077-b463b183c2d8","type":"text/plain","content":"<i>Se o documento estiver sem informações, pode ser que não tenha ocorrido movimentação financeira no período mencionado.</i>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"2c5c2f70-9694-4072-ab61-178de98fb3b6","typeOfStateId":"state","$connId":"con_378","$id":"8b699d11-cd91-4663-b904-7c3f8a25aea1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d4811975-da06-4518-8964-ab7a6ee4680a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}"},"category":"{{state.name}} exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e36dcaa0-0665-4b22-ae98-3e8605d7e557","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ccb2ef5d-0709-4c85-bddc-694271fd7678","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0fd9c767-6e69-4bbb-a404-b67c15b34a5b","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bfbcfcbf-2c9f-4daa-b850-b45b35aab397","root":false,"$title":"[CC.11.3.0][MSG] Exibição extrato","$position":{"top":"1844px","left":"6669px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cb55e628-b24e-4617-9887-b9138da76f47":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"050ec783-abaa-46c0-8caa-2891ef3de285","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7361d0ea-1e69-4530-bc84-d47b36bdb32e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"cb55e628-b24e-4617-9887-b9138da76f47","root":false,"$title":"[GO TO][Redirect] To \"Autenticacao\" (extrato)","$position":{"top":"1364px","left":"1275px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2c5c2f70-9694-4072-ab61-178de98fb3b6":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"dc03e71d-832a-47c9-9731-165326543089","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"2c5c2f70-9694-4072-ab61-178de98fb3b6","root":false,"$title":"[GO TO][Redirect] To  Finalizacao (Welcome)","$position":{"top":"2047px","left":"6669px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"53c8ce46-276b-4fd6-992b-d177b1f32dc0":{"$contentActions":[{"action":{"$id":"28bfb96c-79c5-4ac8-8778-25de14ba63a5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"5f48b832-32a4-499f-a070-903c9fe311d8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e5c1b0e-b89e-4dfc-a2fa-6c5782b88fbe","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"d1e925f2-97db-4bfb-8cc0-1af8068b39c4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"f0bb9cff-3544-4018-9526-9d944b98b1f6","typeOfStateId":"state","$connId":"con_383","$id":"89e71d43-8dd4-4b6c-bc09-b59a2eef1d05","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc8763c-9079-49b1-9277-2d26f7b42da5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Safrapay\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Conta corrente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t// {\n\t\t\t// \t\"type\": \"reply\",\n\t\t\t// \t\"reply\": {\n\t\t\t// \t\t\"id\": \"3\",\n\t\t\t// \t\t\"title\": \"\"\n\t\t\t// \t}\n\t\t\t// }\n\t\t];\n\t\tconst bodyText = \"De qual extrato você precisa?\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"75a90e52-db9b-4311-9a75-10d05621c2cb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibicao\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibicao","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3013586a-e725-49cb-8dec-1cd2b2e35b17","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0ac77be8-f019-447e-8722-aafbe3af39d4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-76e6c28b-ba47-4c73-9f6c-7097bd157588","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"53c8ce46-276b-4fd6-992b-d177b1f32dc0","root":false,"$title":"[CC.12.0.0][MSG] Extratos","$position":{"top":"1598px","left":"1063px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f0bb9cff-3544-4018-9526-9d944b98b1f6":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"35a5d357-4677-4157-8c8d-788ce02a2023","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"cb55e628-b24e-4617-9887-b9138da76f47","typeOfStateId":"state","$connId":"con_388","$id":"84f5d822-4231-4deb-aaf1-f8748512647f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["Conta corrente"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"a508df2f-7177-4554-959b-2b62037f453b","typeOfStateId":"state","$connId":"con_393","$id":"2562255b-4f3b-4f6c-85b9-19f5b84bce11","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"694cf924-2ae1-4c02-b720-442cff7b2677","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a52535a0-fcb9-4753-8d42-2c341f99e952","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d47e9f4a-5fa9-4684-bdff-e2d6d1cd4c2f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"0e756d2f-a657-43f2-b54f-af799513e0e7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7ff22cc1-594d-4358-8a8e-230a92db1023","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-67eeb4ce-065f-4aea-a077-93d70fdd3793","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f1150455-510d-4443-9d87-ca3e0cf7abd3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-95dd387b-2d93-4f4b-9d48-8233579164e3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f0bb9cff-3544-4018-9526-9d944b98b1f6","root":false,"$title":"[CC.12.0.0][INPUT] Extratos","$position":{"top":"1598px","left":"1275px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a122a8b3-b7d0-49bb-8d3b-73b5e22d2625":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"050ec783-abaa-46c0-8caa-2891ef3de285","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"7361d0ea-1e69-4530-bc84-d47b36bdb32e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"a122a8b3-b7d0-49bb-8d3b-73b5e22d2625","root":false,"$title":"[Redirect] To \"Autenticacao\" (extrato)","$position":{"top":"1319px","left":"589px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7361d0ea-1e69-4530-bc84-d47b36bdb32e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: 'e0092495-e95a-44a8-afe3-0c150eda196d',//Pacotes\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"extratos"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3742f4ae-b402-4ae4-bc86-fcb433f6eeee","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-83a6864d-42c3-46e7-b691-611b54ba0ce7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"7361d0ea-1e69-4530-bc84-d47b36bdb32e","root":false,"$title":"[Redirect] To \"Autenticacao\" (extrato)","$position":{"top":"616px","left":"6939px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"contacorrente","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/betaspdcontacorrente","clientId":"BLIP","grantType":"client_credentials","urlCHT":"https://api-hml.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"3ee1972a-b1f7-4d87-bf9f-b758ae910c5a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    const state = JSON.parse(voltarState)\n    try {\n        if (!voltarState) {\n            const state = {}\n            state[botOrigin] = [blockId]\n            return state\n        }\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}