{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"414803ce-4551-4128-b58b-504ac5dc20ef","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:10101"}],"$conditionOutputs":[{"stateId":"welcome","typeOfStateId":"state","$connId":"con_23","$id":"74937f5d-c069-49e6-9402-ce94db8e34cc","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:10114"},{"values":["^(?!.*erro\\|).*"],"source":"context","comparison":"matches","variable":"authBotErrorLog","$$hashKey":"object:10115"}],"$invalid":false,"$$hashKey":"object:10104"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"0e3a51b2-5282-447f-963f-09add7365911","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"authBotConfig\"","$invalid":false,"settings":{"function":"run","source":"function run(...config) {\n\ttry {\n\t\tconst [urlCHTBeta, urlCHTProd, urlTokenBeta, urlTokenProd, tokenSecretBeta, tokenSecretProd, env, contactIdentity, stateName] = config;\n\t\tif (env === 'beta') {\n\t\t\treturn {\n\t\t\t\tbaseUrl: urlCHTBeta,\n\t\t\t\ttokenUrl: urlTokenBeta,\n\t\t\t\tsecret: tokenSecretBeta\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tbaseUrl: urlCHTProd,\n\t\t\ttokenUrl: urlTokenProd,\n\t\t\tsecret: tokenSecretProd\n\t\t}\n\t} catch (err) {\n\t\t return `erro|{{state.name}}|botConfig|{{contact.identity}}|${err.message}`\n\t}\n}","inputVariables":["config.urlCHTBeta","config.urlCHTProd","config.urlTokenBeta","config.urlTokenProd","config.tokenSecretBeta","config.tokenSecretProd","config.env","contact.identity","state.name"],"outputVariable":"authBotConfig","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f673bbfe-0dca-452d-900d-09282217f267","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingAuthBotUrlToken\"","$invalid":false,"settings":{"function":"run","source":"function run(stateName, contactIdentity, botConfig) {\n    try {\n        const { secret } = JSON.parse(botConfig)\n        const URL = `client_id=BLIP&grant_type=client_credentials&client_secret=${secret}`\n        return URL;\n    } catch (err) {\n        return `erro|${stateName}|encodingUrlToken|${contactIdentity}|${err.message}`\n    }\n}","inputVariables":["state.name","contact.identity","authBotConfig"],"outputVariable":"encodingAuthBotUrlToken","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1b52029f-c561-479f-908f-4fe79fe83b07","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authBotToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingAuthBotUrlToken}}","uri":"{{authBotConfig@tokenUrl}}","responseStatusVariable":"authBotStatusToken","responseBodyVariable":"authBotResponseToken"},"conditions":[]},{"$id":"a572d414-d96c-4fb5-bf60-f3ec0ea42b72","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"authBotToken\"","$invalid":false,"settings":{"function":"run","source":"function run(authBotResponseToken, contactIdentity, stateName) {\n\ttry {\n\t\tconst { access_token, token_type } = JSON.parse(authBotResponseToken)\n\t\treturn `${token_type} ${access_token}`\n\t} catch (err) {\n\t\treturn `erro|${stateName}|authBotToken|${contactIdentity}|${err.message}`\n\t}\n}","inputVariables":["authBotResponseToken","contact.identity","state.name"],"outputVariable":"authBotToken","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5f6cc85d-b651-4595-a0e4-f780d3d6d4e0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"authBotErrorLog\"","$invalid":false,"settings":{"function":"run","source":"function run(...logs) {\n\ttry {\n\t\tconst errorsFound = logs.filter(variables => variables.includes('error'))\n\t\tif (errorsFound.length === 0) {\n\t\t\treturn false\n\t\t}\n\t\treturn errorsFound\n\t} catch (err) {\n\t\treturn `erro|exception|${err.message}`\n\t}\n}","inputVariables":["authBotConfig","encodingAuthBotUrlToken","authBotToken"],"outputVariable":"authBotErrorLog","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-da43c70c-3630-4639-acbb-b6711be7a4d9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d0a2ad36-e9e9-4229-944f-f8ea6caf3666","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-a5477787-945c-401f-b555-e1781776517c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"210px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a8d5af2-a566-4dc4-b2dd-fab7805d39f4","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"68fff3b9-437b-40e7-a5bc-a0acb3d106af","typeOfStateId":"state","$connId":"con_633","$id":"676496e3-2abc-4598-8c7e-d20a1343a2ef","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"fallback","$title":"Exceções","$position":{"top":"141px","left":"669px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"13ba3eee-48ca-43ab-9cfb-a418c795692e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:1020"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"49adfd66-2b21-4083-a155-5d1a33cac424","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"authBotResponseMFA\" using \"POST\"","$invalid":false,"settings":{"headers":{"Safra-Aplicacao":"CHT","Authorization":"{{authBotToken}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"POST","body":"{{authBotPayload@payloadMfa}}","uri":"{{authBotConfig@baseUrl}}/vendas-servicos/multicanal/autorizacoes-transacoes/assistente-virtual/v1/transacoes","responseStatusVariable":"authBotStatusMFA","responseBodyVariable":"authBotResponseMFA"},"conditions":[]}],"$leavingCustomActions":[{"$id":"fb044312-3390-4646-9afe-ccdd3c4e029d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"authBotErrorLog\"","$invalid":false,"settings":{"function":"run","source":"function run(...logs) {\n\ttry {\n\t\tconst errorsFound = logs.filter(variables => variables.includes('error'))\n\t\tif (errorsFound.length === 0) {\n\t\t\treturn false\n\t\t}\n\t\treturn errorsFound\n\t} catch (err) {\n\t\treturn `erro|exception|${err.message}`\n\t}\n}","inputVariables":["authBotConfig","encodingAuthBotUrlToken","authBotToken"],"outputVariable":"authBotErrorLog","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-510660dd-d5dc-4acb-8acb-9a1d05010bfa","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-c5dadbeb-2a04-436d-bb95-42a436dd1079","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"welcome","$title":"[A.0.0.0] Verifica tipo de autenticação","$position":{"top":"362px","left":"1367px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"68fff3b9-437b-40e7-a5bc-a0acb3d106af":{"$contentActions":[{"action":{"$id":"bfbbb5e6-89a1-4a33-8e16-7bb5b7e3c54c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9069aebf-9754-4b58-8a31-aedc38f8985f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9069aebf-9754-4b58-8a31-aedc38f8985f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:13629"},{"action":{"$id":"190a1845-c42c-49b1-a937-584951a4f605","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cebbcfbe-1ae1-49c3-907d-78d67e0ac6b8","type":"text/plain","content":"{{authBotErrorLog}}","metadata":{}},"$cardContent":{"document":{"id":"cebbcfbe-1ae1-49c3-907d-78d67e0ac6b8","type":"text/plain","content":"{{authBotErrorLog}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false,"$$hashKey":"object:13630"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"551ad7c0-cd9f-4b6a-b236-30c9f360ab75","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:13631"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b6b1b102-73ca-4fe9-bec1-86a058fb1567","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"authBotErrorLog\"","$invalid":false,"settings":{"function":"run","source":"function run(...logs) {\n\ttry {\n\t\treturn `error|{{state.name}}|{{contact.identity}}`\n\t\tconst errorsFound = logs.filter(variables => variables.includes('error'))\n\t\tif (errorsFound.length === 0) {\n\t\t\treturn false\n\t\t}\n\t\treturn errorsFound\n\t} catch (err) {\n\t\treturn `erro|exception|${err.message}`\n\t}\n}","inputVariables":["authBotConfig","encodingAuthBotUrlToken","authBotToken"],"outputVariable":"authBotErrorLog","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-29cfd5ca-a718-4445-a72d-89ed1f0fe15f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ff8d749f-30b8-45a1-813c-e6b46cc4a797","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"68fff3b9-437b-40e7-a5bc-a0acb3d106af","root":false,"$title":"Novo bloco","$position":{"top":"276px","left":"670px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","serviceName":"autenticacao","env":"beta","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/devspdautenticacao2","urlCHTBeta":"https://api-hml.safra.com.br","urlCHTProd":"https://api.safra.com.br","urlTokenBeta":"https://sts-api-hml.safra.com.br","urlTokenProd":"p","tokenSecretBeta":"ee1f5004-2400-4ab1-9af7-d9168d517204","tokenSecretProd":"tp1"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}