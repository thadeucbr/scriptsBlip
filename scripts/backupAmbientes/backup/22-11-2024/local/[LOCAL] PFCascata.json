{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"69cbe533-65de-408a-9611-ce0b70b5077e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:6806"}],"$conditionOutputs":[{"stateId":"504dc27f-262d-4650-a001-ddfbf4c93598","typeOfStateId":"state","$connId":"con_3","$id":"567badfa-8e14-4832-82e4-674ecdee389f","conditions":[{"source":"context","comparison":"equals","values":["inatividade"],"variable":"state@lastInput","$$hashKey":"object:6830"}],"$invalid":false,"$$hashKey":"object:6809"},{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"570f1179-ac3e-4eb0-b85c-1925dc3322da","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId","$$hashKey":"object:6849"}],"$invalid":false,"$$hashKey":"object:6810"},{"stateId":"a7bf2705-a70f-4011-80c1-a8848804297b","typeOfStateId":"state","$connId":"con_171","$id":"3bcd3c83-7096-4b87-8315-93deb7b15a32","conditions":[{"source":"context","comparison":"equals","values":["443b3cfd-efc8-4c50-bca0-b3b0bededdf8"],"$$hashKey":"object:6880","variable":"state.previous.id"}],"$invalid":false,"$$hashKey":"object:6812"},{"stateId":"8a85a65c-b3b5-46af-ae85-3f9e25093880","$connId":"con_8","$id":"25ddee3d-e913-4979-b3d1-fb31cb136c54","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:6868"}],"$invalid":false,"$$hashKey":"object:6811"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"eabf60bc-f6aa-41c4-9b75-ac7770899f61","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"errorCounter\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(counter, state) {\n\ttry {\n\t\tconst parsedState = JSON.parse(state)\n\t\tif (!counter) {\n\t\t\treturn {\n\t\t\t\tcounter: 1,\n\t\t\t\tlastErrorState: parsedState.stateOrigin\n\t\t\t}\n\t\t}\n\t\tconst parsedCounter = JSON.parse(counter)\n\t\tif (parsedCounter.lastErrorState == parsedState.stateOrigin) {\n\t\t\tparsedCounter.counter++\n\t\t\treturn parsedCounter\n\t\t}\n\t\treturn {\n\t\t\tcounter: 1,\n\t\t\tlastErrorState: parsedState.stateOrigin\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tcounter: 1,\n\t\t\tlastErrorState: \"\",\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["errorCounter","state"],"outputVariable":"errorCounter","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"001b3365-cad0-47b1-ae20-c814467616de","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c31b3de0-af46-4338-9c98-f4c3517c489b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Cascata origem\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata origem","action":"{{state@botOrigin}}|{{state@stateNameOrigin}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"state@botOrigin"}]},{"$id":"39e8b5d7-db4d-44eb-8ffd-82f52eb903fd","$typeOfContent":"","type":"TrackEvent","$title":"Track \"cascata inputs inesperados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"cascata inputs inesperados","action":"{{contact.identity}} | {{state@stateNameOrigin}} | {{state@lastInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"state@intent"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-de6d7bb1-83bc-42fd-a20d-b819aeac65c2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-99b27d06-05ec-4ced-a660-4f6d6713bd20","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-547e1124-25e5-4700-a8c0-268f17a109d5","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$position":{"top":"12px","left":"2169px"},"$title":"Início da Skill de Cascata de Validações","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9aacf0d-1a7b-4907-8c0e-62a8fa0d0777","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:6082"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8cbb51a1-fb61-46da-8f0c-eb10cd445422","type":"SetVariable","$title":"Define service | Exceção","$invalid":false,"settings":{"variable":"service","value":"Exceção"},"conditions":[]},{"$id":"86771cdd-fc26-4fdc-8234-c77de90f72a4","$typeOfContent":"","type":"TrackEvent","$title":"Cascata regex global validacao","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata regex global validacao","action":"Nao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"367e0115-44b8-4103-821a-fcf9f2f4d43f","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-3d6af962-0dbd-4674-8a6a-c3152e4ece27","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ecd9b7c5-639e-43c2-bb40-c394a4d59457","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"fallback","$position":{"top":"11px","left":"2529px"},"$title":"Exceções da Skill de Cascata de Validações","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5290ae6c-fa56-45ef-b20b-48b4598219da":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"57184874-a6c1-4af8-bd51-450d1571b0bd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d63e64cb-adbe-466a-804e-6c4a0737fd06","$connId":"con_13","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"hasEmoji"}],"$invalid":false,"$id":"2b7c3dad-b44d-4a15-b96a-404da7ca1eb1"},{"stateId":"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c","$connId":"con_18","$id":"fcd0a596-adfd-4599-b717-94ccd27cb232","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Define hasEmoji","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    const emojisPattern = /\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]/gmi;\n\n    return input.match(emojisPattern) ? \"Sim\" : \"Nao\";\n};","inputVariables":["input.content"],"outputVariable":"hasEmoji","LocalTimeZoneEnabled":false},"conditions":[]},{"type":"TrackEvent","$title":"Contem emoji validacao | {hasEmoji}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Contem emoji validacao","action":"{{hasEmoji}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"hasEmoji"}]},{"$id":"51033df0-6b65-402f-8bf9-bc8ac8ab8095","$typeOfContent":"","type":"SetVariable","$title":"Define emojiCleanedInput | {input.content}","$invalid":false,"settings":{"variable":"emojiCleanedInput","value":"{{input.content}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-580a5741-8dc9-40a3-9f64-c3ec9f295a04","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f5b3bf20-d6d6-46f5-bdbb-19ea50fed024","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a353e92e-56fd-4e55-9739-8e2f5cf587bc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"5290ae6c-fa56-45ef-b20b-48b4598219da","root":false,"$title":"V.1.0.1 | Contém emoji?","$position":{"top":"410px","left":"1761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d63e64cb-adbe-466a-804e-6c4a0737fd06":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"290a883d-b2d3-4b4d-97a7-aa73093a4ce8","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","$connId":"con_23","$id":"9ff2624c-bf88-44f4-8e21-3d3d85d8b42d","conditions":[{"source":"context","comparison":"equals","values":["Nao"],"variable":"isEmojiOnly"}],"$invalid":false}],"$enteringCustomActions":[{"type":"ExecuteScript","$title":"Remove emoji from user input | emojiCleanedInput","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    var regex = /(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\u0023-\\u0039]\\ufe0f?\\u20e3|\\u3299|\\u3297|\\u303d|\\u3030|\\u24c2|\\ud83c[\\udd70-\\udd71]|\\ud83c[\\udd7e-\\udd7f]|\\ud83c\\udd8e|\\ud83c[\\udd91-\\udd9a]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\ude01-\\ude02]|\\ud83c\\ude1a|\\ud83c\\ude2f|\\ud83c[\\ude32-\\ude3a]|\\ud83c[\\ude50-\\ude51]|\\u203c|\\u2049|[\\u25aa-\\u25ab]|\\u25b6|\\u25c0|[\\u25fb-\\u25fe]|\\u00a9|\\u00ae|\\u2122|\\u2139|\\ud83c\\udc04|[\\u2600-\\u26FF]|\\u2b05|\\u2b06|\\u2b07|\\u2b1b|\\u2b1c|\\u2b50|\\u2b55|\\u231a|\\u231b|\\u2328|\\u23cf|[\\u23e9-\\u23f3]|[\\u23f8-\\u23fa]|\\ud83c\\udccf|\\u2934|\\u2935|[\\u2190-\\u21ff])/gim;\n \n    return input.replace(regex, \"\"); \n};","inputVariables":["input.content"],"outputVariable":"emojiCleanedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"aadf8bc9-d179-464f-8c28-1f01306a5210","type":"ExecuteScript","$title":"Define if is only emoji | isEmojiOnly","$invalid":false,"settings":{"function":"run","source":"const run = (input) => {\n    return input.length < 1 ? 'Sim' : 'Nao';\n}","inputVariables":["emojiCleanedInput"],"outputVariable":"isEmojiOnly","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"1cd93245-206e-4ed3-9ada-26c2cfee32a9","type":"TrackEvent","$title":"Apenas emoji validacao | {isEmojiOnly}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{isEmojiOnly}}","category":"Apenas emoji validacao"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"isEmojiOnly"}]},{"$id":"2aee7595-7e7f-49f0-b1a5-14c9b229e611","$typeOfContent":"","type":"SetVariable","$title":"Define exceptionType | E.4.0.5 IF isEmojiOnly EQUALS Sim","$invalid":false,"settings":{"variable":"exceptionTypeMedia","value":"EX.5.0.5"},"conditions":[{"source":"context","comparison":"equals","variable":"isEmojiOnly","values":["Sim"]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-392b52ce-8c7b-43c7-9ef0-eb725a038414","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d89aff54-5b7f-41fa-a46a-f625bf733362","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-020e9171-3167-4ee6-bab7-c9f279b2b87d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"d63e64cb-adbe-466a-804e-6c4a0737fd06","root":false,"$title":"V.1.0.2 | É só emoji?","$position":{"top":"770.5px","left":"1536.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2eb427b6-88d1-4e5a-b2be-124b3487ec7c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a839d7cf-7485-4d9b-9f83-e3d874025ead","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:5320"}],"$conditionOutputs":[{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","typeOfStateId":"state","$connId":"con_28","$id":"1e14fa1d-a169-4b7d-bb0d-fa313f5d3828","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:5336"}],"$invalid":false,"$$hashKey":"object:5322"}],"$enteringCustomActions":[{"$id":"2728d3ba-6366-4dd8-8f7e-cc22ba63abc9","$typeOfContent":"","type":"SetVariable","$title":"Set keyword to \"input inesperado\"","$invalid":false,"settings":{"variable":"keyword","value":"input inesperado"},"conditions":[]}],"$leavingCustomActions":[{"type":"TrackEvent","$title":"Palavra chave validacao | Sim IF keyword DIFFERENT Input inesperado","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave validacao","action":"Sim"},"conditions":[{"source":"context","comparison":"notEquals","variable":"keyword","values":["Input inesperado"]}]},{"type":"TrackEvent","$title":"Palavra chave validacao | Nao IF keyword EQUALS Input inesperado","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave validacao","action":"Nao"},"conditions":[{"source":"context","comparison":"equals","variable":"keyword","values":["Input inesperado"]}]},{"$id":"8552bd91-650e-4a79-b56a-ef9e679c6127","$typeOfContent":"","type":"TrackEvent","$title":"Palavra chave input | {input.content}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave input","action":"{{input.content}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"a91e45ee-ec03-4577-b5c2-57a78945bedd","$typeOfContent":"","type":"TrackEvent","$title":"Palavra chave origem | {lastBot} | {origin}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Palavra chave origem","action":"{{lastBot}} | {{origin}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-2578863b-cb57-4e0f-94a5-a0ebaf67b32b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a142de92-4a66-41ec-adc0-7dd456817e7b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","root":false,"$title":"V.1.0.3 | É palavra-chave?","$position":{"top":"827.5px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eab7fb29-aab4-4fe3-9863-aaf7d566f195":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","typeOfStateId":"state","$connId":"con_33","$id":"7fa891ab-e624-49b4-be83-f1535cd57f92","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"keyword"},{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"keyword"}],"$invalid":false},{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","typeOfStateId":"state","$connId":"con_38","$id":"419b74c4-1d02-43c1-9c25-be867a76d625","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"eab7fb29-aab4-4fe3-9863-aaf7d566f195","root":false,"$title":"Redireciona ao Serviço","$position":{"top":"1118px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0496e4a3-cdab-41fc-bf34-58bd4531ca5c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"44d0ba64-4d21-4ecb-9b10-eedc04cfa0dd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5290ae6c-fa56-45ef-b20b-48b4598219da","$connId":"con_43","$id":"32fb3a30-902c-4325-a2b7-35aea1cb0a93","conditions":[{"source":"context","comparison":"equals","values":["Nao"],"variable":"isInputNotText"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"03e45ef7-8977-4ebe-9ad7-83f5c19f6b0e","$typeOfContent":"","type":"ExecuteScript","$title":"Set input type | inputType","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        if (input.includes('latitude') && input.includes('longitude')) {\n            return 'location';\n        } else if (input.includes('phoneNumber') || input.includes('cellPhoneNumber')) {\n            return 'contact';\n        } else if (input.includes('type')) {\n            input = JSON.parse(input.replace(/\\\\/g, ''));\n            return input.type;\n        }\n        return 'text/plain';\n    } catch (err) {\n        return 'text/plain'\n    }\n}","inputVariables":["input.content"],"outputVariable":"inputType","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2484ff78-34a8-41c9-9548-5d5395ae1418","$typeOfContent":"","type":"ExecuteScript","$title":"Set is input not text | isInputNotText","$invalid":false,"settings":{"function":"run","source":"const run = (inputType) => {\n    return inputType != 'text/plain' ? 'Sim' : 'Nao';\n}","inputVariables":["inputType"],"outputVariable":"isInputNotText","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4c371dc2-e978-4582-bf07-7532d6e5e3c2","$typeOfContent":"","type":"TrackEvent","$title":"Contem midia validacao | {isInputNotText}","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Contem midia validacao","action":"{{isInputNotText}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"isInputNotText"}]},{"$id":"6f4c8fcb-a8a9-4085-bcf9-f88252322c30","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"exceptionTypeMedia\"","$invalid":false,"settings":{"function":"run","source":"const run = (inputCVType) => {\n    try {\n        const match = matchKey(MEDIA_TYPES, inputCVType);\n        return MEDIA_TYPES[match] || MEDIA_TYPES[\"default\"];\n\n    } catch (e) {\n        return MEDIA_TYPES['default']\n    }\n}\n\nconst MEDIA_TYPES = {\n    \"audio\": \"EX.5.0.0\",\n    \"image\": \"EX.5.0.1\",\n    \"sticker\": \"EX.5.0.1\",\n    \"video\": \"EX.5.0.2\",\n    \"location\": \"EX.5.0.3\",\n    \"file\": \"EX.5.0.4\",\n    \"pdf\": \"EX.5.0.4\",\n    \"emoji\": \"EX.5.0.5\",\n    \"contact\": \"EX.5.0.6\",\n    default: \"E.3.5.0\"\n};\n\n//string extension \"contains\".\nObject.defineProperty(String.prototype, \"contains\", {\n    value: function contains(str) {\n        return this.indexOf(str) > -1;\n    },\n    writable: true,\n    configurable: true\n});\n\nconst matchKey = (options, input) => {\n    return Object.keys(options).find(key => (\n        input.contains(key)\n    ));\n}\n","inputVariables":["inputType"],"outputVariable":"exceptionTypeMedia","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"isInputNotText"}]},{"$id":"4cbab52f-c979-49ca-979b-e66aa1c15714","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"function ValidarConteudo(inputOriginType) {\n    const starts = [\n        \"application/\",\n        \"audio/\",\n        \"video/\",\n        \"image/\",\n        \"link\",\n        \"location\",\n        \"contact\",\n        \"application/zip\"\n    ];\n    const result = starts.find(item => inputOriginType.startsWith(item));\n    return result ? result : 'Não encontrado';\n}\nfunction run(inputContent, inputType) {\n    try {\n        let input = ValidarConteudo(inputType);\n        if (input == 'Não encontrado') {\n            if (inputContent.includes(\"type\")) {\n                return JSON.parse(inputContent.replace(/\\\\/g, '')).type;\n            }\n            else if (inputContent.includes(\"http\")) {\n                return \"link/\";\n            } else if (inputContent.includes(\"latitude\") && inputContent.includes(\"longitude\")) {\n                return \"location\";\n            } else if (inputContent.includes(\"phoneNumber\") || inputContent.includes(\"cellPhoneNumber\")) {\n                return \"contact\";\n            }\n        }\n        return inputContent;\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"teste123","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-1a799fc7-ef54-47e6-8025-baf563a592ac","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-42d69977-0ab4-443a-91ee-361f0b6e75d6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0496e4a3-cdab-41fc-bf34-58bd4531ca5c","root":false,"$title":"V.1.0.0 | É uma imagem, um áudio, local. ou arq.?","$position":{"top":"399.25px","left":"2169px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d572c06a-8476-4635-8b8b-daae47879d31","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:5496"}],"$conditionOutputs":[{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","typeOfStateId":"state","$connId":"con_53","$id":"32f49376-122a-44ac-ae96-f604b65d2f0f","conditions":[{"source":"intent","comparison":"notExists","values":[],"$$hashKey":"object:5518"}],"$invalid":false,"$$hashKey":"object:5498"},{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","typeOfStateId":"state","$connId":"con_176","$id":"c57c43b5-7760-4c8c-be88-b92bfdb8009c","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:5544"}],"$invalid":false,"$$hashKey":"object:5500"}],"$enteringCustomActions":[{"$id":"26ef6a24-b0b2-44c0-a81f-1071c320ad59","$typeOfContent":"","type":"TrackEvent","$title":"Track \"cascata intencao identificada\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"cascata intencao identificada","action":"{{contact.identity}} | {{input.intent.name}}"},"conditions":[{"values":[],"source":"intent","comparison":"exists"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2eb427b6-88d1-4e5a-b2be-124b3487ec7c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0d6dddd3-0cc0-4b19-a25d-d198d756b149","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f","root":false,"$title":"V.1.1.0 | Intenção identificada?","$position":{"top":"428px","left":"1097px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"443b3cfd-efc8-4c50-bca0-b3b0bededdf8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"49da7094-6b9f-4b0c-bfcc-bc716811cce6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:6231"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"7e0b64fc-5563-46f3-87c0-387fdf7c5ab5","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Cascata redirecionamento servico dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata redirecionamento servico dados","action":"{{contact.identity}} | {{state}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"a0b45bc0-32c3-4331-91a9-71ea03584574","type":"Redirect","$title":"Redirect to service palavra chave","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-67dbd67b-7f37-49f4-a42d-55b86739eb56","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-36ead6c7-d2a9-4889-9433-9a0f9e5cece7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","root":false,"$title":"[Redirect] Redirecionar para serviço","$position":{"top":"1341px","left":"814px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#ff0202"}},"61c0e618-6db5-47ae-b2a0-5e6df1d366de":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f28b96d0-7d8c-40c7-9fe5-efae76ffb89a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"75397f2c-0d54-4553-b3d3-cc09b358e42c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Cascata redirecionamento exceptions\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata redirecionamento exceptions","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"52882c4a-3404-417c-a945-44c405ccc3a2","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"exceptionEnv\"","$invalid":false,"settings":{"function":"run","source":"function run(env) {\n\ttry {\n\t\tvar ex = `exception ${env || \"\"}`.trim();\n\t\treturn ex;\n\t}\n\tcatch (err) {\n\t\treturn 'exception';\n\t}\n}","inputVariables":["config.env"],"outputVariable":"exceptionEnv","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"efc4ca6e-2b50-4722-a54d-5a7d31ed2f91","type":"Redirect","$title":"Redirect to service input inesperado","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{input.content}}"},"address":"{{exceptionEnv}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-710c0729-b529-4db2-9b5a-f043d56a19d0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c45a4b0d-5bda-4416-b95a-1d51e5e69a57","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-63b39154-8741-4a17-b9bf-a206e2df5a80","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","root":false,"$title":"[Redirect] Exceptions","$position":{"top":"1365.67px","left":"1351.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fb0000"}},"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"39b81d3e-b518-4385-9178-139df59b8215","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fdc1e734-c8c0-4668-9940-8ea76047b2b7","typeOfStateId":"state","$connId":"con_63","$id":"5de924ca-d1e9-4783-974c-33043c80894a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"bodySmallTalks@analysis.cursed"},{"values":["true"],"source":"context","comparison":"equals","variable":"bodySmallTalks@analysis.cursed"}],"$invalid":false},{"stateId":"367e0115-44b8-4103-821a-fcf9f2f4d43f","typeOfStateId":"state","$connId":"con_68","$id":"7020393d-45bf-4308-b26c-72aa7a1267b7","conditions":[{"source":"context","comparison":"contains","values":["GoodBye"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"93e78941-dd62-4af0-b53c-b83215639b35","typeOfStateId":"state","$connId":"con_73","$id":"d2e6cca9-bc84-4fa9-a135-fd339703660d","conditions":[{"source":"context","comparison":"contains","values":["Greeting"],"variable":"SmallTalksIdentified"},{"values":["75a862d1-751c-441d-917f-9d77aaf4b369"],"source":"context","comparison":"notEquals","variable":"state@stateOrigin"}],"$invalid":false},{"stateId":"4764eb28-9106-4135-ac2d-c15a1a9f8558","typeOfStateId":"state","$connId":"con_78","$id":"23322d8d-17fd-4014-a34a-42ec31331135","conditions":[{"source":"context","comparison":"contains","values":["Confirmation"],"variable":"SmallTalksIdentified"}],"$invalid":false},{"stateId":"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f","typeOfStateId":"state","$connId":"con_83","$id":"b5159fe7-a16b-4c6c-bbe4-8ba0aca48a3a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a920be0e-7cfc-4675-b1da-d3b2a77e2988","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodySmallTlaks\" using \"GET\"","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://smalltalksapi.cs.blip.ai/api/v3/analysis?text={{input.content}}&checkDate=false&infoLevel=3","responseStatusVariable":"statusSmallTalks","responseBodyVariable":"bodySmallTalks"},"conditions":[{"values":[],"source":"input","comparison":"exists"}]},{"$id":"dfc66fc2-3967-480c-a7db-c698133a43d2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"SmallTalksIdentified\"","$invalid":false,"settings":{"function":"run","source":"function run(bodySmallTalks) {\n\ttry {\n\t\tlet data = JSON.parse(bodySmallTalks);\n\t\tif (data && data.analysis && data.analysis.matches) {\n\t\t\treturn data.analysis.matches.map(match => match.smallTalk);\n\t\t}\n\t\treturn [];\n\t}\n\tcatch (err) {\n\t\treturn [];\n\t}\n}","inputVariables":["bodySmallTalks"],"outputVariable":"SmallTalksIdentified","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"da3b8096-cc8d-4b14-a5b0-d9c90c155c2f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fa6009db-c756-444c-9ad9-6bfc7f8a922c","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-90fae7f4-abb0-44ce-9527-79dff5c86618","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"d9cb703b-a2b6-4cdd-88b3-caaef0bedf9c","root":false,"$title":"Verifica SmallTalks","$position":{"top":"422px","left":"1457px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fdc1e734-c8c0-4668-9940-8ea76047b2b7":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a6aafc1c-d7e2-4159-bd25-aa81a7f50923","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3334"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1084127e-2b59-440a-836b-172ab322617c","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"ofensa\"","$invalid":false,"settings":{"variable":"exceptionType","value":"ofensa"},"conditions":[]},{"$id":"4e0a5112-b6da-43a7-8bc0-7a2d255b9371","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" CLEAR","$invalid":false,"settings":{"variable":"SmallTalksIdentified","value":"-"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-43c7ef77-572b-4c56-b45a-df31f2d41be8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"fdc1e734-c8c0-4668-9940-8ea76047b2b7","root":false,"$title":"[GO TO][SET] Exceptions (Ofensa)","$position":{"top":"16px","left":"1264px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8a85a65c-b3b5-46af-ae85-3f9e25093880":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"88a5941c-fc50-4f9e-b5bf-197f7a70078e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:7818"}],"$conditionOutputs":[{"stateId":"5198f9f6-914a-4757-9118-be1fdb35430f","typeOfStateId":"state","$connId":"con_88","$id":"3f26cd44-5e5e-4ba0-b301-cd393f57acee","conditions":[{"source":"context","comparison":"equals","values":["unauthorized"],"variable":"apiStatus","$$hashKey":"object:7840"}],"$invalid":false,"$$hashKey":"object:7820"},{"stateId":"4595bd74-84f9-41de-a46e-c35cb2200532","typeOfStateId":"state","$connId":"con_93","$id":"1fdba152-b6ca-4ec3-a384-57142d3f1af0","conditions":[{"source":"context","comparison":"notEquals","values":["ok"],"variable":"apiStatus","$$hashKey":"object:7858"},{"values":["false"],"source":"context","comparison":"notEquals","variable":"apiStatus","$$hashKey":"object:7859"},{"values":[],"source":"context","comparison":"exists","variable":"apiStatus","$$hashKey":"object:7860"}],"$invalid":false,"$$hashKey":"object:7821"},{"stateId":"0496e4a3-cdab-41fc-bf34-58bd4531ca5c","typeOfStateId":"state","$connId":"con_98","$id":"1533ba85-4405-445b-89df-ff75c7a528ec","conditions":[{"source":"input","comparison":"exists","values":[],"$$hashKey":"object:7894"}],"$invalid":false,"$$hashKey":"object:7822"}],"$enteringCustomActions":[{"$id":"a1c5ba05-81c8-452e-a57a-466e1a384525","$typeOfContent":"","type":"TrackEvent","$title":"Track \"cascata erros de api\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"cascata erros de api","action":"{{contact.identity}} | {{state@stateNameOrigin}} | {{apiStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"apiStatus"},{"values":["ok"],"source":"context","comparison":"notEquals","variable":"apiStatus"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e8bcc348-3208-4942-811b-bfbb02e4b1c7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"8a85a65c-b3b5-46af-ae85-3f9e25093880","root":false,"$title":"Valida erro de API","$position":{"top":"201px","left":"2169px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5198f9f6-914a-4757-9118-be1fdb35430f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"989438af-f9e0-4a7d-9daa-7c88fc36247f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4595bd74-84f9-41de-a46e-c35cb2200532","typeOfStateId":"state","$connId":"con_103","$id":"5871f2c4-e957-48c3-a6c1-7750c5828019","conditions":[{"source":"context","comparison":"notEquals","values":["200"],"variable":"statusToken"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e2e67c0b-054a-42b6-bf7a-381465fd0c67","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"encodingUrl\"","$invalid":false,"settings":{"function":"run","source":"function run(clientId, grantType, clientSecret) {\n\n    const URL = `client_id=${clientId}&grant_type=${grantType}&client_secret=${clientSecret}`\n    return URL;\n\n}","inputVariables":["config.clientId","config.grantType","config.clientSecret"],"outputVariable":"encodingUrl","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c3d7f736-690d-467f-be86-7144ea39c9dd","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyToken\" using \"POST\"","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded","accept":"*/*","Connection":"keep-alive","User-Agent":"Fiddler"},"method":"POST","body":"{{encodingUrl}}","uri":"{{config.urlToken}}/api/oauth/token","responseStatusVariable":"statusToken","responseBodyVariable":"bodyToken"},"conditions":[]},{"$id":"549c7138-3a48-492d-acc2-aca8ee8f38dd","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Cascata erro de api\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata erro de api","action":"Token"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d57df537-ec69-4b4c-ad86-59a2f4f9620b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(state, stateOrigin, env, lastInput, intent) {\n\ttry {\n\t\tconst parsedState = JSON.parse(state)\n\t\treturn {\n\t\t\tbotDestination: parsedState.botOrigin,\n\t\t\tbotOrigin: 'cascata',\n\t\t\tstateDestination: parsedState.stateOrigin,\n\t\t\tstateOrigin,\n\t\t\tlastInput,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\tconst parsedState = JSON.parse(state)\n\t\treturn {\n\t\t\tbotOrigin: 'cascata',\n\t\t\tstateOrigin,\n\t\t\tbotDestination: `$Bot Main ${env || ''}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state","state.id","config.env","input.content","userInput"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0ac7a175-75c7-4789-8d83-ae49cd76b72d","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusToken"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e1f622eb-634f-436c-911f-b69e5d5f25bd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-820f9640-4f06-4027-b65e-6d72ed242d97","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-7a744359-0a73-4b64-ae20-fcf1b8a625a3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-100a901a-0167-44b4-b0c3-66a590f52a93","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5198f9f6-914a-4757-9118-be1fdb35430f","root":false,"$title":"Gera novo token","$position":{"top":"371px","left":"2528px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4595bd74-84f9-41de-a46e-c35cb2200532":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"09654982-c4c3-46e1-9a20-0b90a8411204","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"95825e4b-a3a9-43a7-9c55-5e1494230187","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"eb0e1af7-2c66-4c0c-85d5-4c77472a1462","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Cascata erro de api\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Cascata erro de api","action":"Erro"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"61c0e618-6db5-47ae-b2a0-5e6df1d366de","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6434a053-fe54-433e-8c36-2c261d7a2490","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c2844fcc-38fb-45ed-9d95-ee5fa7a9b2b7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"4595bd74-84f9-41de-a46e-c35cb2200532","root":false,"$title":"Erro de api","$position":{"top":"184px","left":"2528px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"367e0115-44b8-4103-821a-fcf9f2f4d43f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cba9f0d5-0bdb-40d3-9a7b-6f7761026e2d","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3485"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"477bc956-8e0a-49e4-858b-5617e457f163","$typeOfContent":"","type":"TrackEvent","$title":"Sair exibicao","$invalid":false,"settings":{"extras":{},"category":"Sair exibicao","action":"Exibicao"},"conditions":[]},{"$id":"51720ba4-9787-4f74-b178-1fe28872e166","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName,\n\t\t\tbotDestination:  'Principal',\n\t\t\tstateDestination: 'eddeb205-5810-40e9-9d0d-69b714415542',//Finalização\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent: intent  || lastInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tbotDestination:  'Principal',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"54092227-9c26-4421-9b49-977e4f6fe41d","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" CLEAR","$invalid":false,"settings":{"variable":"SmallTalksIdentified","value":"-"},"conditions":[]},{"$id":"d31e12df-67a6-419d-a352-9b35734cedb8","$typeOfContent":"","type":"SetVariable","$title":"Set \"intencaoIdentificada\" CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada","value":"-"},"conditions":[]},{"$id":"87b230fb-77a0-402f-905f-6e58d38479aa","$typeOfContent":"","type":"SetVariable","$title":"Set \"SaudacaoJaFoiFeita\" CLEAR","$invalid":false,"settings":{"variable":"SaudacaoJaFoiFeita","value":"-"},"conditions":[]},{"$id":"61d81c0a-2ef7-48ce-977d-d4a70bf02a71","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" CLEAR","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]},{"$id":"2b40bc7a-5eaa-4438-9d73-9e0ae477b2d5","$typeOfContent":"","type":"SetVariable","$title":"Set \"errorCounter\" CLEAR","$invalid":false,"settings":{"variable":"errorCounter"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cf75e40c-cf8b-4545-bbc3-c8c7f319e72a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3c6e4014-4c1c-4dda-959d-8311f8905940","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b91612be-d84a-400a-bb71-3af5ec4898fc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"367e0115-44b8-4103-821a-fcf9f2f4d43f","root":false,"$title":"[GO TO][SET] Finalizacao (Goodbye)","$position":{"top":"14px","left":"1457px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"93e78941-dd62-4af0-b53c-b83215639b35":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b9095abd-7796-4b40-9b6a-f587756790bd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3699"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5097d83a-5165-4d5f-895b-a462cebe25fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName,\n\t\t\tbotDestination:  'Principal',\n\t\t\tstateDestination: '9d1c3cfd-5b20-4bb9-892e-53e4b340117d',//Saudacao\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent: intent  || lastInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tbotDestination:  'Principal',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32904b3c-ccd6-4a20-9f37-9cee20fca567","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" CLEAR","$invalid":false,"settings":{"variable":"SmallTalksIdentified","value":"-"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2d1bd088-4793-4447-a236-8548279e8b10","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1675b421-307d-482b-8df8-24c3d5d16f22","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"93e78941-dd62-4af0-b53c-b83215639b35","root":false,"$title":"[GO TO][SET] Principal (Greating)","$position":{"top":"15px","left":"1648px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4764eb28-9106-4135-ac2d-c15a1a9f8558":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b9095abd-7796-4b40-9b6a-f587756790bd","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3135"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"5097d83a-5165-4d5f-895b-a462cebe25fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName,\n\t\t\tbotDestination: 'Principal',\n\t\t\tstateDestination: 'ebc39789-37c0-4716-a46b-02150dcd40a7',//Saudacao\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent: intent  || lastInput\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tbotDestination:  'Principal',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"32904b3c-ccd6-4a20-9f37-9cee20fca567","$typeOfContent":"","type":"SetVariable","$title":"Set \"SmallTalksIdentified\" CLEAR","$invalid":false,"settings":{"variable":"SmallTalksIdentified","value":"-"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"443b3cfd-efc8-4c50-bca0-b3b0bededdf8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-58d06ec4-8a85-4dcf-91d2-7ccf2b766f7b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4225afad-b24a-4cda-bb38-d4a26ac5d760","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"4764eb28-9106-4135-ac2d-c15a1a9f8558","root":false,"$title":"[GO TO][SET] Principal (Confirmation)","$position":{"top":"134px","left":"1034px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"504dc27f-262d-4650-a001-ddfbf4c93598":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"9c12ff94-c7c6-41ad-b941-174a09e4263a","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3898"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a52d4ce4-7516-4c9e-8c08-77964df10e51","$typeOfContent":"","type":"SetVariable","$title":"Set \"state\" CLEAR","$invalid":false,"settings":{"variable":"state"},"conditions":[]},{"$id":"d41ccef1-49a1-4bc0-95d7-954594591237","$typeOfContent":"","type":"MergeContact","$title":"Set \"CPF\" CLEAR","$invalid":false,"settings":{"extras":{"cpf":"-"}},"conditions":[]},{"$id":"478e9f01-8a7b-41c8-b384-258f9ecb0be5","$typeOfContent":"","type":"SetVariable","$title":"Set errorCounter CLEAR","$invalid":false,"settings":{"variable":"errorCounter"},"conditions":[]},{"$id":"48fe2f82-a1ad-41a6-820c-ebb48981a673","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionType CLEAR","$invalid":false,"settings":{"variable":"exceptionType"},"conditions":[]},{"$id":"a2df9967-712d-4367-94a5-f51ad07810ab","$typeOfContent":"","type":"SetVariable","$title":"Set exceptionTypeMedia CLEAR","$invalid":false,"settings":{"variable":"exceptionTypeMedia"},"conditions":[]},{"$id":"e79b7c7a-0ac4-48c9-9da8-ab7f801bedc6","$typeOfContent":"","type":"SetVariable","$title":"Set intencaoIdentificada CLEAR","$invalid":false,"settings":{"variable":"intencaoIdentificada"},"conditions":[]},{"$id":"86bb56e8-df6f-43c8-9a04-e8bc5f995fb1","$typeOfContent":"","type":"SetVariable","$title":"Set \"contas\" CLEAR","$invalid":false,"settings":{"variable":"contas","value":"false"},"conditions":[]},{"$id":"90f47fd1-5cf2-4416-856b-db82f1d63bbd","$typeOfContent":"","type":"SetVariable","$title":"Set \"qtdcontas\" CLEAR","$invalid":false,"settings":{"variable":"qtdcontas"},"conditions":[]},{"$id":"69fc05e4-616e-4fc9-94db-760ee023c280","$typeOfContent":"","type":"TrackEvent","$title":"Inatividade dados","$invalid":false,"settings":{"extras":{},"category":"inatividade dados","action":"{{contact.idenitty}} - {{input.content}} - {{state}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"31b65eed-0541-46b3-84a2-0129c2dc4664","$typeOfContent":"","type":"Redirect","$title":"Redirect to  'Principal',","$invalid":false,"settings":{"address":"Principal"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fb12da8d-89f1-400e-a81d-fbdad5dfb0bd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fd867436-16b9-48f0-b2ed-e5b9643b5eaa","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-c157a09f-4694-478a-b376-b64d3a2625f1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-faaadf95-ba35-48f6-b60c-619da19f7315","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"504dc27f-262d-4650-a001-ddfbf4c93598","root":false,"$title":"[Redirect] To Principal (Inatividade)","$position":{"top":"15px","left":"1914px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a7bf2705-a70f-4011-80c1-a8848804297b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"171fa449-16e7-4348-9383-0df24c5935ef","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:7800"}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0eef02c3-e512-4222-b557-3cb277a1bed3","$typeOfContent":"","type":"TrackEvent","$title":"Loop dados","$invalid":false,"settings":{"extras":{},"category":"Loop dados","action":"{{contact.identity}} - {{calendar.datetime}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"367e0115-44b8-4103-821a-fcf9f2f4d43f","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4f09ef76-1588-4427-a6d8-2c04c658a3b2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"a7bf2705-a70f-4011-80c1-a8848804297b","root":false,"$title":"[GO TO] Finaliza Loop","$position":{"top":"182px","left":"1916px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"false","builder:#localTimeZone":"E. South America Standard Time"},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}