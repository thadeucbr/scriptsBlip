{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"5411fbe0-034c-43b1-b7ca-875eeb2d3037","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"d0614c9a-d900-4226-8861-4f98cf8f9f5a","conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"blockDestinationId"}],"$invalid":false},{"stateId":"c165ec7d-c1dd-43fa-8cb0-facf567689b8","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"7d8fc905-331d-431c-bf44-9d4acb367815","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"708c4f89-8669-45b0-8509-7eeaa871ef9f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"37321bf8-0e7d-470d-968a-59681c18f640","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4d9b281c-4c03-4a43-8bc3-2d4025467aa3","$typeOfContent":"","type":"SetVariable","$title":"Definir variável","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-41b9b929-643e-4dfe-a131-98924bd9b3b7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-048af5a3-98e1-4d31-b73a-66a8f707744d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-56d7571f-6858-4149-845b-6a9bd4fa7f86","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-65e9e2af-f04a-4b41-915e-4c90d43e66d1","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"398px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"16b76ac0-0b7b-4cc7-b08f-734f14211c35","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"c213efed-ef4f-428e-a007-1bfab601d137","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[{"$id":"d579f0be-f77a-4125-a795-dbd07cbfc0e6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: 'cascata',\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"error","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-956562d1-56da-4516-b086-9af1d4c1966e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"145px","left":"714px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"aff15d5d-1d32-4603-8a24-23c689e82d9f","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"0daf7077-0424-4321-a919-50b1bf44411a","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-d40a33be-8c5f-4ebb-a191-9c153c165135","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"error","$title":"[Redirect] cascata","$position":{"top":"311px","left":"714px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c8cfe224-4cd0-4ed5-b8a3-670826decce3":{"$contentActions":[{"action":{"$id":"ff94b42a-fa24-495e-947b-bc9d66ef0f70","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c88a45f6-4c5e-49bb-b476-1b8638da9343","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c88a45f6-4c5e-49bb-b476-1b8638da9343","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"68bb81c7-e8eb-4fd9-a397-89bfda35aaa5","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f1f6fd23-1872-4ac0-a46d-fee5940d3f93","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"abf2515c-aca2-41c3-96fd-a5a38f174a1d","typeOfStateId":"state","$connId":"con_13","$id":"61194c24-c9d4-449c-8b35-1cb820b1b9f2","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"07ce4c3b-9ead-4f5b-9e29-6cf7cb07b925","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"6765d9ce-ebf0-4715-ab9a-53e26afdc548","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Receber ajuda\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Não encontrei nenhuma ordem de serviço.\\n\\nVocê pode escolher informar o número ou posso te direcionar para quem pode te ajudar.\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1039d87c-9b1e-4348-ae82-13ceb0a930ba","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a2dfeee2-c71b-4356-ac6c-4e04947c1c1a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4289c377-cd8a-4047-a169-fba6faccedb6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c8cfe224-4cd0-4ed5-b8a3-670826decce3","root":false,"$title":"[OS.2.0.1] Sem ordens de serviço","$position":{"top":"1085px","left":"1092px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"01384329-fe1a-4363-9269-8506cb22a57b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c8cfe224-4cd0-4ed5-b8a3-670826decce3","typeOfStateId":"state","$connId":"con_18","$id":"c9d4c510-5dfe-466a-9d67-8fd0c88d8d18","conditions":[{"source":"context","comparison":"lessThan","values":["1"],"variable":"ordensDeServico@quantidade"}],"$invalid":false},{"stateId":"13044285-94b8-4147-be1a-69b7d822a20c","typeOfStateId":"state","$connId":"con_23","$id":"c2de64fe-676e-404c-bb5b-9e947fda2738","conditions":[{"source":"context","comparison":"greaterThan","values":["1"],"variable":"ordensDeServico@quantidade"}],"$invalid":false},{"stateId":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","typeOfStateId":"state","$connId":"con_28","$id":"0288bedd-821b-4ce2-b1b8-7a08f8009d75","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"ordemSelecionada"}],"$invalid":false},{"stateId":"13044285-94b8-4147-be1a-69b7d822a20c","typeOfStateId":"state","$connId":"con_33","$id":"2a402962-4fb4-4fbd-933e-f28bd848a85a","conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"ordensDeServico@error"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0712f016-6292-4ee0-83b4-0642cbdca179","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyOrdernsDeServicos\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/vendas-servicos/vendas/tracking-credenciadoras/v1/ordens-servicos?documento={{contaSelecionada@doc}}","responseStatusVariable":"statusOrdensDeServicos","responseBodyVariable":"bodyOrdensDeServicos"},"conditions":[]},{"$id":"b644474d-1e2c-4e96-9c5b-a3e08df1ee18","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordensDeServico\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyOrdensDeServico) {\n\ttry {\n\t\tconst { data } = JSON.parse(bodyOrdensDeServico)\n\t\tconst ordens = JSON.stringify({\n\t\t\tordens: data.detalhe,\n\t\t\tquantidade: data.detalhe.length\n\t\t})\n\t\treturn ordens\n\t} catch (err) {\n\t\treturn {\n\t\t\tordens: [],\n\t\t\terror: err.message,\n\t\t\tquantidade: 0\n\t\t}\n\t}\n}","inputVariables":["bodyOrdensDeServicos"],"outputVariable":"ordensDeServico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"13a6f5ab-f968-4ee4-8e37-de760d87214e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"1b97622e-0a7f-47a3-9edb-9c8f6f24e5f5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordemSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ordens) {\n\ttry {\n\t\tconst { ordens, quantidade } = JSON.parse(ordens)\n\t\tif (quantidade == 1) {\n\t\treturn ordens[0]\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["ordensDeServico"],"outputVariable":"ordemSelecionada","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b333cbfd-01aa-488e-8855-de68c3aa6570","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-7cfb06fc-93dc-4a88-ae3f-8703b445ff0d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9ca3ae62-f654-4ac4-af0b-0dd3df45ca04","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db","root":false,"$title":"[OS.2.0.0] Consultar Ordens de Serviço","$position":{"top":"1073px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3fc1e4ae-ec02-4487-af4b-935157cee4a0":{"$contentActions":[{"action":{"$id":"010ae5a3-588d-4a11-923f-e5d560424143","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"dc64190e-f031-418b-b2ba-62d8ec0ea06f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dc64190e-f031-418b-b2ba-62d8ec0ea06f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cea809d1-8425-420e-bcc1-933524ca5f17","$typeOfContent":"text","type":"SendMessage","settings":{"id":"885d5f85-5fd0-49b1-885d-4fcae615fe6a","type":"text/plain","content":"Identifiquei sua ordem de serviço, vou te mostrar o status.","metadata":{}},"$cardContent":{"document":{"id":"885d5f85-5fd0-49b1-885d-4fcae615fe6a","type":"text/plain","content":"Identifiquei sua ordem de serviço, vou te mostrar o status."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7cc16948-8367-4416-ad37-578c8726e6b5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"24efe6bf-a419-4865-8f78-ffa115030afe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"24efe6bf-a419-4865-8f78-ffa115030afe","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f0536076-d120-439d-8376-f2bc8247f9f6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f6551f22-407b-4429-8230-5ccd5e8a8605","type":"text/plain","content":"{{msgOrdemDeServico}}","metadata":{}},"$cardContent":{"document":{"id":"f6551f22-407b-4429-8230-5ccd5e8a8605","type":"text/plain","content":"{{msgOrdemDeServico}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"045f315b-96e7-4306-b361-9ee01cd3603e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"d20bdbe8-2ab9-441c-b88b-c057938a742a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOrdemDeServico\"","$invalid":false,"settings":{"function":"run","source":"function parseDateTime(date) {\n\ttry {\n\t\tconst [ano, mes, dia] = date.split('T')[0].split('-')\n\t\tconst [hora, minuto] = date.split('T')[1].split(':')\n\t\treturn `${dia}/${mes}/${ano}`\n\t} catch (err) {\n\t\treturn date\n\t}\n}\n\nconst statusDict = {\n\t1: '*Status*: ⚠️ Em andamento',\n\t2: '*Status*: ✔ Concluída',\n\t3: '*Status*: ❌ Cancelada',\n\t4: '*Status*: ❌ Cancelada'\n}\nfunction run(ordemSelecionada) {\n\ttry {\n\t\tconst { numero, status, dataAbertura, dataFechamento } = JSON.parse(ordemSelecionada)\n\t\tlet msg = `${statusDict[status] || statusDict['4']}\\n\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}`\n\n\t\tif (status == 3 && dataFechamento) {\n\t\t\tmsg += `\\n*Cancelada em*: ${parseDateTime(dataFechamento)}`\n\t\t}\n\t\tif (status != 1 && dataFechamento) {\n\t\t\tmsg += `\\n*Cancelada em*: ${parseDateTime(dataFechamento)}`\n\t\t}\n\t\treturn msg\n\t} catch (err) {\n\t\treturn `Ops, algo deu errado!`\n\t}\n}","inputVariables":["ordemSelecionada"],"outputVariable":"msgOrdemDeServico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5c242c11-53aa-4536-bb7a-1ed180dc4085","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-5e0349cf-9495-41c8-b6f7-b6bdfd724435","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-63df008b-43bf-4d33-b49a-76f0e331346d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1c93a825-1c0c-46da-90dd-0dd4941aa2b1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","root":false,"$title":"[OS.2.1.1] Exibir ordem de serviço","$position":{"top":"1084px","left":"1616px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8dfeba9-bad4-435d-ab4a-f95e575eddfa":{"$contentActions":[{"action":{"$id":"f0d853a2-3722-4621-a960-85f10bf68a92","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b986d835-6a06-497d-9b92-2efe05e4d93b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b986d835-6a06-497d-9b92-2efe05e4d93b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"05ea6ab2-057d-4ba1-95a9-dccf45e750e8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f3415afa-6d75-4cf0-a055-7c7fd63b2b80","type":"text/plain","content":"Qual o número da ordem de serviço?","metadata":{}},"$cardContent":{"document":{"id":"f3415afa-6d75-4cf0-a055-7c7fd63b2b80","type":"text/plain","content":"Qual o número da ordem de serviço?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7020d498-7d0e-4fa2-b2a9-87a0b9932502","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5b54c9b7-5aba-4b41-b696-0437605aa6c2","typeOfStateId":"state","$connId":"con_38","$id":"f1521bfd-b1b5-4f70-8eae-0cd3ad631495","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0076522b-bd01-49e1-bca4-cda1990847c3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1bb00887-1a6a-4b4c-921d-b8be5a0de0e1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-340509b4-9cea-4202-98f4-343089a717e9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","root":false,"$title":"[OS.2.3.0] Solicita numero da ordem de serviço","$position":{"top":"1671px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"13044285-94b8-4147-be1a-69b7d822a20c":{"$contentActions":[{"action":{"$id":"9f68fa8c-be1c-45c6-a3b7-3f2679e00352","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a530f78b-49ec-47b1-a384-1632b33d5273","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a530f78b-49ec-47b1-a384-1632b33d5273","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9c026000-0a6c-4ca9-a0e1-a77b0435ccb6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"dc4514e3-d0f6-425e-9434-70a0782a0ccc","type":"text/plain","content":"Identifiquei {{ordensDeServico@quantidade}} ordens de serviço.","metadata":{}},"$cardContent":{"document":{"id":"dc4514e3-d0f6-425e-9434-70a0782a0ccc","type":"text/plain","content":"Identifiquei {{ordensDeServico@quantidade}} ordens de serviço."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5920c12f-007f-49fa-b210-9f02851930a9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b5570e59-5004-4b76-950f-5cbcace7e49d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b5570e59-5004-4b76-950f-5cbcace7e49d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9ca77c0e-5d8f-4659-9424-be926aa368c3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"0d7bd4dc-b564-41aa-959b-1fc3d7497948","type":"text/plain","content":"{{msgOrdensDeServico}}","metadata":{}},"$cardContent":{"document":{"id":"0d7bd4dc-b564-41aa-959b-1fc3d7497948","type":"text/plain","content":"{{msgOrdensDeServico}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6540ad3e-2edb-4317-b8e9-c2075bfa804a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"94b82f9c-11b0-4bb2-94ab-6d07c68eb8be","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"94b82f9c-11b0-4bb2-94ab-6d07c68eb8be","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c4770493-1de9-4e4f-8c59-8b4d449b3ada","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b5462fcc-0ec9-4bde-9c18-bc9ecdcaa809","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"80abcb78-a29d-41d9-aacc-09c023ed74ee","typeOfStateId":"state","$connId":"con_43","$id":"8a65b97e-2941-4d5f-9b1b-1317598b4703","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d8b77aed-2f38-4e06-a481-6d8452e866b2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"59e0290e-b625-44bd-b35b-29359ebd31c4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"msgOrdensDeServico\"","$invalid":false,"settings":{"function":"run","source":"function parseDateTime(date) {\n\ttry {\n\t\tconst [ano, mes, dia] = date.split('T')[0].split('-')\n\t\t// const [hora, minuto] = date.split('T')[1].split(':')\n\t\treturn `${dia}/${mes}/${ano}`\n\t} catch (err) {\n\t\treturn date\n\t}\n}\n\nfunction montaMensagem({ numero, status, dataAbertura, dataFechamento }) {\n\tif (status == 1) {\n\t\treturn `*Status*: ⚠️ Em andamento\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}`\n\t} else if (status == 2) {\n\t\tif (dataFechamento) {\n\t\t\treturn `*Status*: ✔ Concluída\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}\\n*Concluída em*: ${parseDateTime(dataFechamento)}`\n\t\t}\n\t\treturn `*Status*: ✔ Concluída\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}`\n\t} else if (status == 3) {\n\t\tif (dataFechamento) {\n\t\t\treturn `*Status*: ❌ Cancelada\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}\\n*Cancelada em*: ${parseDateTime(dataFechamento)}`\n\t\t}\n\t\treturn `*Status*: ❌ Cancelada\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}`\n\t} else {\n\t\tif (dataFechamento) {\n\t\t\treturn `*Status*: ❌ Cancelada\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}\\n*Cancelada em*: ${parseDateTime(dataFechamento)}`\n\t\t}\n\t\treturn `*Status*: ❌ Cancelada\\n*Ordem de serviço*: ${numero}\\n*Aberta em*: ${parseDateTime(dataAbertura)}`\n\t}\n}\nfunction run(ordensDeServico) {\n\ttry {\n\t\tconst { ordens } = JSON.parse(ordensDeServico)\n\t\tlet msg = ordens.map(ordem => montaMensagem(ordem))\n\t\tmsg = msg.join('\\n\\n')\n\t\treturn msg\n\t} catch (err) {\n\t\treturn err.message\n\t}\n}","inputVariables":["ordensDeServico","contaSelecionada"],"outputVariable":"msgOrdensDeServico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d319a7c4-ed0f-4f81-ad0d-45e915fb83dd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Informar número\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Receber ajuda\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst bodyText = \"Se não encontrou a ordem de serviço desejada nesta lista, você pode informar o número, ou posso te direcionar para alguém que possa ajudar.\"; // <---- Body\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": bodyText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"13044285-94b8-4147-be1a-69b7d822a20c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ed0f7734-aa3d-4c35-a091-3f035fb99f09","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b48dffdb-ee77-4bfc-a26a-30c7d804d44c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-82d0e28d-bf63-456e-bf32-4e37275c2b70","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"13044285-94b8-4147-be1a-69b7d822a20c","root":false,"$title":"[OS.2.1.0] Exibe ordens de serivço","$position":{"top":"1272px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"80abcb78-a29d-41d9-aacc-09c023ed74ee":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b5462fcc-0ec9-4bde-9c18-bc9ecdcaa809","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","typeOfStateId":"state","$connId":"con_48","$id":"92e610b6-2e7b-4afa-8af5-eb2166f80a42","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"4e26789e-dcf6-493a-a93b-eb5548301018","typeOfStateId":"state","$connId":"con_53","$id":"553901d4-b3ac-49b4-83bd-c65582296cf8","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"72ccced4-9f56-4083-b9f1-0ed488f5314d","typeOfStateId":"state","$connId":"con_58","$id":"dec2f9be-1320-484c-9676-fd4bba6fbe9d","conditions":[{"source":"context","comparison":"equals","values":["Receber ajuda"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ad81e52f-4f52-47ea-b1a2-ff52ad97ded2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d0e56d5-9b17-4971-96c3-30a70ce2a3f1","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"e3f73cac-c3f2-40a0-9c6e-f1497c489316","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f9917e2d-e0a2-4851-bf1b-e71e596abb6d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-1bd69567-cafa-41e4-8718-5f84d41172ac","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5553b050-a68b-4a5c-9aed-8d014aba0e29","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7ee78e30-9f99-485c-bd8f-1f65c49d96a0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-13b9dafe-38a7-491b-b21a-4fab3859cbb2","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"80abcb78-a29d-41d9-aacc-09c023ed74ee","root":false,"$title":"[OS.2.1.0][INPUT] O que deseja fazer?","$position":{"top":"1440px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5b54c9b7-5aba-4b41-b696-0437605aa6c2":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"83779d45-ddd1-4a54-928e-02e33faa16bf","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"47ae7cfb-365d-4484-a1e2-83eede1e2980","typeOfStateId":"state","$connId":"con_63","$id":"48141d28-2e99-4dce-9207-4b13f47e3c2a","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"b0de2c29-10b3-4df1-9a84-ee102f5c9ff3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function checkInputType(input) {\n    if (input.includes('latitude') && input.includes('longitude')) {\n        return 'location';\n    } else if (input.includes('phoneNumber') || input.includes('cellPhoneNumber')) {\n        return 'contact';\n    } else if (input.includes('type')) {\n        input = JSON.parse(input);\n        return input.type;\n    }\n\n    return 'text/plain';\n}\n\nfunction run(message) {\n    try {\n            \t\tif (!message) {\n\t\t\treturn 'inatividade'\n\t\t}\n        const inputType = checkInputType(message)\n        if (inputType !== 'text/plain' || isNaN(message)) {\n            return 'input inesperado'\n        }\n        return message\n    } catch (err) {\n        return err.message\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a509855e-2f1a-46ce-9754-2270e2c05f22","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"04388c63-8217-4225-861e-a42fea4d8756","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"37d09a5e-47c7-4fd5-975b-190bb52ec7ab","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"osinvalida\"","$invalid":false,"settings":{"variable":"exceptionType","value":"osinvalida"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3b2727b8-c909-4c90-9470-dd0c2fab720e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5a85cb34-74e9-4684-bad9-a46ac7bab55e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-618de65c-96b3-4260-ba6f-01e402e2acbf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3d12cfdc-22c5-4cdd-a0f7-8fbb216f5185","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"5b54c9b7-5aba-4b41-b696-0437605aa6c2","root":false,"$title":"[OS.2.3.0] Valida numero digitado","$position":{"top":"1919px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"47ae7cfb-365d-4484-a1e2-83eede1e2980":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"28f4f6ba-6cb4-43ba-8bff-77d86f6420f6","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7e355c61-75b8-4493-a5f3-12aba597f4b3","typeOfStateId":"state","$connId":"con_68","$id":"cdcece4a-99e7-4032-a5a1-40e886bf9e2a","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"ordemSelecionada"}],"$invalid":false},{"stateId":"a8969fc6-4d34-43b6-895f-bfc5e97286a7","typeOfStateId":"state","$connId":"con_73","$id":"c8939d3b-4d81-4b54-b280-e4daeb8443fb","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"ordemSelecionada"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"090f7b10-83d8-4389-bcdb-f9305226f489","$typeOfContent":"","type":"ProcessHttp","$title":"Process \"bodyOrdernsDeServicos\" using \"GET\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/vendas-servicos/vendas/tracking-credenciadoras/v1/ordens-servicos/{{userInput}}","responseStatusVariable":"statusOrdensDeServicos","responseBodyVariable":"bodyOrdensDeServicos"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"421ecd7e-ad51-44d5-b10c-31cb38a9047c","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordensDeServico\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyOrdensDeServico) {\n\ttry {\n\t\tconst { data } = JSON.parse(bodyOrdensDeServico)\n\t\treturn {\n\t\t\tordens: data.detalhe,\n\t\t\tquantidade: data.detalhe.length\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tordens: [],\n\t\t\terror: err.message,\n\t\t\tquantidade: 0\n\t\t}\n\t}\n}","inputVariables":["bodyOrdensDeServicos"],"outputVariable":"ordensDeServico","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"fa20cf58-d597-44f0-8865-bb13a5ddbcdd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"ordemSelecionada\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(ordens) {\n\ttry {\n\t\tconst { ordens, quantidade } = JSON.parse(ordens)\n\t\tif (quantidade == 1) {\n\t\treturn ordens[0]\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["ordensDeServico"],"outputVariable":"ordemSelecionada","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f3ce7ae9-a95a-4016-9901-513ecf8fd5aa","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-6267f603-5be9-40b4-8693-2f3710f6282f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"47ae7cfb-365d-4484-a1e2-83eede1e2980","root":false,"$title":"[OS.2.4.0] Consulta OS pelo número","$position":{"top":"2098px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7e355c61-75b8-4493-a5f3-12aba597f4b3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fb95e6bb-652b-4613-8efb-189d3ed093b4","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3fc1e4ae-ec02-4487-af4b-935157cee4a0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7e355c61-75b8-4493-a5f3-12aba597f4b3","root":false,"$title":"T -> [OS.2.1.1] Exibir ordem de serviço","$position":{"top":"2109px","left":"1595px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a8969fc6-4d34-43b6-895f-bfc5e97286a7":{"$contentActions":[{"action":{"$id":"bd0405b7-6cf9-4b9a-863c-ccc083f357ae","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"776705a2-3958-4e06-877f-8c6384ce2bbd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"776705a2-3958-4e06-877f-8c6384ce2bbd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3e21768b-8e63-4712-b752-6c718f463167","$typeOfContent":"text","type":"SendMessage","settings":{"id":"afad0cd7-1388-4815-93f0-d9279b09e4d4","type":"text/plain","content":"Não consegui encontrar uma ordem de serviço com esse número: *{{userInput}}*","metadata":{}},"$cardContent":{"document":{"id":"afad0cd7-1388-4815-93f0-d9279b09e4d4","type":"text/plain","content":"Não consegui encontrar uma ordem de serviço com esse número: *{{userInput}}*"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"93eee8ba-8b90-4162-b43e-5f9088eb32ef","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c9bc1cc0-ef2b-408a-b99b-3edc06a03778","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c9bc1cc0-ef2b-408a-b99b-3edc06a03778","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"06a02668-1ebf-44c0-825e-30d893c892bb","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"002ef0e6-8b0e-441b-a666-c6c1d0f0db2c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a3526248-5e5a-4772-a3a1-ba6fc20bc45f","typeOfStateId":"state","$connId":"con_78","$id":"d37ec527-4cba-47c7-bdb1-6999bc271381","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"83d9a029-0532-4232-8641-b4d20b6e2a6b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(params) {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\t\tconst headerText = \"Quer tentar novamente?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d2af8822-0892-4960-8b28-053d67f40436","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"SPD ORdem de servico {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-198abbf7-55f8-4ec6-b3f1-c184bec7770f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-b2408b4d-5bc7-4ba8-9e63-92580534f75a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-54ae0b52-6288-464a-bd6a-6b6c734badbe","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a8969fc6-4d34-43b6-895f-bfc5e97286a7","root":false,"$title":"[OS.2.4.1] OS Não encontrada","$position":{"top":"2300px","left":"1361px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a3526248-5e5a-4772-a3a1-ba6fc20bc45f":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c338c673-c741-46b0-b544-e2898fd082d9","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","typeOfStateId":"state","$connId":"con_83","$id":"d0abb0b0-871b-4272-b2e3-219fb6b99c20","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"83aab034-b5d7-4f25-8c39-dbf330e6550a","typeOfStateId":"state","$connId":"con_88","$id":"a168f4fa-3148-4b14-bd11-d3fe352185f0","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a2d3e65e-580d-4bbb-bee2-210dfac0a796","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(inputUsuario) {\n  const invalidInputMessage = \"input inesperado\";\n  try {\n        \t\tif (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n    const regexDictionary = {\n      \"si[mn]|tem|sei\": \"Sim\",\n      \"n[aã]o|n[aã]o tenho\": \"Não\"\n    };\n\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, \"i\").test(inputUsuario.toLowerCase())) {\n        return regexDictionary[regex];\n      }\n    }\n    return invalidInputMessage;\n  } catch (err) {\n    return invalidInputMessage;\n  }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3b4f751c-54fa-4a9a-b7dc-d572c3d20494","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"38a3109d-241a-46b1-912e-09f4ede97eb8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]},{"$id":"0055521b-4631-47c1-839c-38926c4c65d3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a9ac6aea-41b4-419e-8369-8911d0dd85e0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-89cc3f61-9277-465e-a521-8dba7f5326c6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-59465802-7689-4095-bb8d-3e6c6c81a234","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-aded7ef2-4bf3-48a8-8c81-65bfd8ba0087","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a3526248-5e5a-4772-a3a1-ba6fc20bc45f","root":false,"$title":"[OS.2.4.1] Valida input OS Não encontrada","$position":{"top":"1984px","left":"1005px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ffd9b720-683d-4d20-b51b-5e24ef2059b0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8114a3c9-e406-40d8-afe3-ee7ce4894c17","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"3609e45c-d5c1-4815-8b62-a12eb02fc4f2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || ''}`.trim(),\n\t\t\tstateDestination: 'onboarding',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"19eaac42-0b42-463b-b999-2cf455941e7a","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-79a8236f-03bd-4561-8103-28079d5f54c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-19b84c7f-60b5-40e3-8130-8ffa9f873be7","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","root":false,"$title":"[Redirect] Finalização","$position":{"top":"387px","left":"1649px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"83aab034-b5d7-4f25-8c39-dbf330e6550a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"58d1de0f-9e5e-4d4d-9e94-b97846ab1128","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"83aab034-b5d7-4f25-8c39-dbf330e6550a","root":false,"$title":"[GO TO] Finalização","$position":{"top":"2006px","left":"761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"72ccced4-9f56-4083-b9f1-0ed488f5314d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8a64f795-3112-45e9-bd19-040df7b4777a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5dfa874c-5afe-4442-ac73-1cf5c40087e0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"72ccced4-9f56-4083-b9f1-0ed488f5314d","root":false,"$title":"[GO TO] Atendimento Humano","$position":{"top":"1440px","left":"1576px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4e26789e-dcf6-493a-a93b-eb5548301018":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4b21c630-382b-4dee-80bc-ad9476718ee1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"4e26789e-dcf6-493a-a93b-eb5548301018","root":false,"$title":"[GO TO] Finalização","$position":{"top":"1451px","left":"1139px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5dfa874c-5afe-4442-ac73-1cf5c40087e0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"53ecccb3-e087-49da-8667-d20438985d9a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"8d3a9912-951d-4bfc-ac47-2a281fc57f02","$typeOfContent":"","type":"SetVariable","$title":"Set \"atendimento\" to \"humano\"","$invalid":false,"settings":{"variable":"atendimento","value":"humano"},"conditions":[]},{"$id":"b0e87449-cedc-4403-99b9-f0a312c926bd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Whatsapp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: \"atendente\",\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a70cb04f-0d4c-47b7-8093-5e2df5401351","$typeOfContent":"","type":"SetVariable","$title":"Set \"msg\" to \"\"","$invalid":false,"settings":{"variable":"msg"},"conditions":[]}],"$leavingCustomActions":[{"$id":"899b0fcf-a95a-42db-ab36-2b708dd3f4c9","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"atendente"},"address":"WhatsApp PJ"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-77da204a-f0a8-4db0-bfba-ff51c822eb0e","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1bc01702-df30-4a21-b58b-2c1b3c6b733a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-fd29e23a-9fd8-402d-83d1-d9f45df0ce18","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5dfa874c-5afe-4442-ac73-1cf5c40087e0","root":false,"$title":"[Redirect] to WhatsApp PJ (atendente)","$position":{"top":"386px","left":"1845px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7ab2e934-8ff0-43a1-b369-2f4e1d5a9ce4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4b21c630-382b-4dee-80bc-ad9476718ee1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ffd9b720-683d-4d20-b51b-5e24ef2059b0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7ab2e934-8ff0-43a1-b369-2f4e1d5a9ce4","root":false,"$title":"[GO TO] Finalização","$position":{"top":"1097px","left":"570px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"abf2515c-aca2-41c3-96fd-a5a38f174a1d":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b5462fcc-0ec9-4bde-9c18-bc9ecdcaa809","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"031fe166-03b3-4025-9096-e72380b5c821","typeOfStateId":"state","$connId":"con_93","$id":"92e610b6-2e7b-4afa-8af5-eb2166f80a42","conditions":[{"source":"context","comparison":"equals","values":["Informar número"],"variable":"userInput"}],"$invalid":false},{"stateId":"7ab2e934-8ff0-43a1-b369-2f4e1d5a9ce4","typeOfStateId":"state","$connId":"con_98","$id":"553901d4-b3ac-49b4-83bd-c65582296cf8","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"815f8ab8-4482-4d99-a577-d71086f59a99","typeOfStateId":"state","$connId":"con_103","$id":"dec2f9be-1320-484c-9676-fd4bba6fbe9d","conditions":[{"source":"context","comparison":"equals","values":["Receber ajuda"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ad81e52f-4f52-47ea-b1a2-ff52ad97ded2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase()})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"5d0e56d5-9b17-4971-96c3-30a70ce2a3f1","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"e3f73cac-c3f2-40a0-9c6e-f1497c489316","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f9917e2d-e0a2-4851-bf1b-e71e596abb6d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Maquina Safrapay {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{},"category":"SPD Ordem de servico {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-609570bf-cb8c-4213-ac54-068ff8584af7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-02513517-0bbc-4b49-b036-b71a07e2cbd9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-15266384-6223-4829-84ad-bf4c6eeb806f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-eeb5214d-2783-42dd-bcda-e99b3e42b478","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"abf2515c-aca2-41c3-96fd-a5a38f174a1d","root":false,"$title":"[OS.2.1.0] Seleciona ordem de serviço","$position":{"top":"1074px","left":"811px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"815f8ab8-4482-4d99-a577-d71086f59a99":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8a64f795-3112-45e9-bd19-040df7b4777a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5dfa874c-5afe-4442-ac73-1cf5c40087e0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"815f8ab8-4482-4d99-a577-d71086f59a99","root":false,"$title":"[GO TO] Atendimento Humano","$position":{"top":"867px","left":"811px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"031fe166-03b3-4025-9096-e72380b5c821":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0f182202-b9ef-4d81-91ef-f20ab9da341d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e8dfeba9-bad4-435d-ab4a-f95e575eddfa","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"031fe166-03b3-4025-9096-e72380b5c821","root":false,"$title":"[GO TO][OS.2.3.0] Solicita numero da ordem","$position":{"top":"1284px","left":"811px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c165ec7d-c1dd-43fa-8cb0-facf567689b8":{"$contentActions":[{"action":{"$id":"3f87bda8-f8f6-4dd1-bb14-d4d45a34b326","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"b7c8fbd6-2646-4c4d-940b-baaa2aabb564","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b7c8fbd6-2646-4c4d-940b-baaa2aabb564","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4b781fed-1b2f-4ede-a027-ea640875ed27","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b4190e62-0411-4bf5-9bdc-4c4b3ffb93e1","type":"text/plain","content":"Aguarde só um momento, estou consultando as informações disso.","metadata":{}},"$cardContent":{"document":{"id":"b4190e62-0411-4bf5-9bdc-4c4b3ffb93e1","type":"text/plain","content":"Aguarde só um momento, estou consultando as informações disso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"826eebc0-5c19-4067-9030-b50d65db86f0","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fb46f9fc-1dfe-45f8-a9c6-09bfd80f21db","typeOfStateId":"state","$connId":"con_108","$id":"c6bb96ee-88fa-431d-8176-290906d11cb6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"951835eb-cf4a-495c-8ebe-ec6411effe9f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f8e7adb9-4a22-43bc-a57a-9df03c75d950","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-71236623-d63b-4de9-82aa-1282d37de71a","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c165ec7d-c1dd-43fa-8cb0-facf567689b8","$title":"[OS.1.0.0] Aguarde verificando OSs","$position":{"top":"632.75px","left":"1361.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false}},"configuration":{"builder:minimumIntentScore":"0.5","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","urlCHT":"https://api.safra.com.br","serviceName":"Bot OS","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/prodspdordemdeservico","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a9c61922-e070-489d-a5a4-7aae9c197025","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"currentDate\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return getFormatDate();\n}\n\nfunction getFormatDate() {\n    const dataAtual = new Date();\n\n    const getDay = String(dataAtual.getDate()).padStart(2, '0');\n    const getMonth = String(dataAtual.getMonth() + 1).padStart(2, '0');\n    const getYear = dataAtual.getFullYear();\n    const getHour = String(dataAtual.getHours()).padStart(2, '0');\n    const getMinutes = String(dataAtual.getMinutes()).padStart(2, '0');\n    const getSeconds = String(dataAtual.getSeconds()).padStart(2, '0');\n\n    return `${getDay}/${getMonth}/${getYear}`;\n}","inputVariables":[],"outputVariable":"currentDate","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fc800b6c-83b4-4945-88bc-622e95112822","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    if (!voltarState) {\n        const state = {}\n        state[botOrigin] = [blockId]\n        return state\n    }\n    const state = JSON.parse(voltarState)\n    try {\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}