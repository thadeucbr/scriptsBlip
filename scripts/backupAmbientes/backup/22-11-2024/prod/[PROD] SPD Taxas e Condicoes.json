{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"f9dd120e-024a-4544-9c88-aad781313623","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"d7411888-b223-44ea-8adc-853b2be5fb0c","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"variable":"blockDestinationId"}],"$invalid":false},{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","typeOfStateId":"state","$connId":"con_3","$id":"11a69cb0-0fe0-411d-b7e4-51b72e5b8773","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f6399094-beb7-4ea2-bf71-b205614f1e97","$typeOfContent":"","type":"TrackEvent","$title":"Track \"inicio\"","$invalid":false,"settings":{"extras":{"identity":"{{contact.identity}}","idSessao":"{{idSessao}}"},"category":"inicio","action":"{{config.serviceName}} | {{state@botOrigin}} | {{state@stateNameOrigin}} | {{input.content}} | {{input.intent.name}}"},"conditions":[]},{"$id":"9ed83b55-8fac-4c5d-9645-3ce28ed48497","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-fc092403-7a0f-4718-924a-db418dfbc753","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-fc26cb14-4a05-44e8-91c8-ebaa913ec4b1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3d435969-f3b3-406a-87ba-9e9abd6aeb1e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"36.3333px","left":"2065.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"127c233a-774d-4815-8878-b660a8e1b3d8","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"85c901f2-e8b4-49ca-97d4-e1becccc4cb1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$id":"b4906de6-3af7-45cd-bd5e-54da2289f776","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[{"$id":"76756741-01db-49f7-ad13-77eb651a785f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(previousBlockId, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"85c901f2-e8b4-49ca-97d4-e1becccc4cb1","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-0c8ee1ed-a6d1-4b6f-88b0-866e38a792f9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"34px","left":"164px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cac63fde-6671-4aa1-9a67-efc2f5336711":{"$contentActions":[{"action":{"$id":"c734b402-a8b0-48d6-9369-725cb2e0d253","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1ce316fe-7ef2-41c4-bd8b-c351d1efaa91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1ce316fe-7ef2-41c4-bd8b-c351d1efaa91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c950ebe6-2eda-4dc9-9689-cab38a8519d7","$typeOfContent":"text","type":"SendMessage","settings":{"id":"1b940d87-d1af-4e95-95a0-21f66f1ca84a","type":"text/plain","content":"Aguarde um momento, já vou trazer as informações que você precisa.","metadata":{}},"$cardContent":{"document":{"id":"1b940d87-d1af-4e95-95a0-21f66f1ca84a","type":"text/plain","content":"Aguarde um momento, já vou trazer as informações que você precisa."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5645aa88-959e-46a7-af25-0e32ed445e49","typeOfStateId":"state","$connId":"con_13","$id":"57625472-6942-43b7-acc1-422abf536dd2","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"843538a9-4bef-42ca-a144-c76e2b05ee32","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Chamada de API\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"consulta taxas de atencipação do plano"},"conditions":[]},{"$id":"c45d2e0a-7d32-4772-8af0-7c606fe99dec","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao","responseStatusVariable":"taxaStatus","responseBodyVariable":"taxaBody"},"conditions":[]},{"$id":"de2dcb68-36d9-48c4-af84-490eecc196f9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAntecipacao\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.data\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaBody"],"outputVariable":"taxaAntecipacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"451cdee4-8a05-4b1b-b64c-9915dcc9eb08","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaModalidade\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.modalidade\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaModalidade","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4fcf44d8-cbf7-40bd-896e-c3ee01fe7e87","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"7559934d-6b50-40d3-9c5e-bb655e4d6b42","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"0a25a707-f003-40f4-ad08-b823b44fe0b0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"20628ae1-990a-44f7-a151-94d2dc78234a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["taxaStatus","taxaVendasStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"91439709-3345-4d6e-b6da-4e7f0dcb2769","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao | GET| {{taxaStatus}} | {{taxaBody}}"},"conditions":[]},{"$id":"9fb5d64b-0764-4ec8-b2aa-74da6451d200","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}} | GET| {{taxaVendasStatus}} | {{taxaVendasBody}}"},"conditions":[]},{"$id":"4e860673-c5be-418b-81d2-075028d99c04","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]},{"$id":"0630a015-50b5-4297-af7e-42da64a7a338","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaStatus"}]},{"$id":"b4379c51-ff45-48c6-b1f4-68ebbeac3ba0","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"taxaStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6ec38e33-6484-4606-b987-66c66e38e6f7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-91ac443f-b8d6-49b7-9fba-0b4dd3bc92af","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-953ac6c9-8ad6-4f27-b19f-993a251bedd9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0aeb01ed-2ea8-4e2e-83d5-27823b019896","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-98a2ff60-729e-450f-a073-5367c8e40cb1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"cac63fde-6671-4aa1-9a67-efc2f5336711","root":false,"$title":"[TC.3.0.0][HTTP] API Taxas de Antecipação","$position":{"top":"449px","left":"4251px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"24ee326c-2f65-4cf1-944e-2b178eaf2a82":{"$contentActions":[{"action":{"$id":"c76a0a02-1229-4980-9920-9c1dffef2d16","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"99fcb020-7c6a-43ae-83e8-324eb9abf130","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"99fcb020-7c6a-43ae-83e8-324eb9abf130","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cad0ec5d-5a2a-429a-8098-4c8425cc4818","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d7aab4e7-9406-4c52-aab6-daddb2702902","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso.","metadata":{}},"$cardContent":{"document":{"id":"d7aab4e7-9406-4c52-aab6-daddb2702902","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"43c00179-3b1f-4151-8ce4-bcf39135d351","typeOfStateId":"state","$connId":"con_18","$id":"6a892357-ff17-49e1-8a17-f998df2d1183","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-dec9bcd9-c418-46eb-862f-19dae2f514c7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"24ee326c-2f65-4cf1-944e-2b178eaf2a82","root":false,"$title":"[TC.4.0.0][MSG] Só um instante","$position":{"top":"277px","left":"1156px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4a101355-7808-4bb7-a96d-7053a966074a":{"$contentActions":[{"action":{"$id":"a51c440f-fd82-43ac-a075-a550415491bd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bd41aa9d-1106-4a64-9fc7-e2a1e2c857a8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bd41aa9d-1106-4a64-9fc7-e2a1e2c857a8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d57d6be3-650a-490a-b582-a234e99ebea4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"d8693c48-fc0c-4907-a608-ab06499796af","type":"text/plain","content":"Já vou te ajudar com isso. Para que eu possa entender melhor a situação e encaminhar para análise, preciso fazer algumas perguntas.","metadata":{}},"$cardContent":{"document":{"id":"d8693c48-fc0c-4907-a608-ab06499796af","type":"text/plain","content":"Já vou te ajudar com isso. Para que eu possa entender melhor a situação e encaminhar para análise, preciso fazer algumas perguntas."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"926c7202-1e44-49de-962a-349238c2cba8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4e2a9b99-e0af-42b7-baed-11cbbaa7369c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4e2a9b99-e0af-42b7-baed-11cbbaa7369c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"55a10321-ecb4-4ab7-a368-b65761bea3b8","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"722bd745-fd0f-4ade-9937-852d7db9e165","typeOfStateId":"state","$connId":"con_23","$id":"69ef53aa-1708-4fbb-91cb-a8d04011ba17","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6288fd61-64e2-4e1d-9dcb-569b499aea7a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Valor divergente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Cobrança duplicada\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Outros motivos\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Qual foi o motivo da cobrança indevida? \";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"be3510e5-7f5f-49aa-bcd5-35df5694c9e6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"4d426545-1d43-4f3a-984a-f0f255b4ea5d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]}],"$leavingCustomActions":[{"$id":"dc186f16-cee1-48e0-afb4-90d8615f9955","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-c7db5745-4591-4ec0-9e4f-16d099b872e2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-eb1f25e9-7dbb-48cc-8626-735793576cda","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0b06be5d-6038-417d-9fcf-a2d7c4a26e93","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ccef8307-b66f-4cc9-9759-453e6a8ca602","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4a101355-7808-4bb7-a96d-7053a966074a","root":false,"$title":"[TC.7.0.0][MSG] Questionar uma cobrança","$position":{"top":"399px","left":"3266.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e912e94c-247f-4ad6-abec-f42562d981a0":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"fbfbbf55-3fd8-42df-9c52-1fa32ab0d86e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"82358327-d2c4-40da-a143-48cc6a090bad","typeOfStateId":"state","$connId":"con_28","$contentId":"8702cb7b-c61e-4284-b4e1-f75632e772f3","$id":"1c793d1b-4d9c-4025-90cd-698b39ed0f37","conditions":[{"source":"context","comparison":"equals","values":["Vendas Online","Vendas Físicas"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"11d3e430-a83a-412f-9a45-b815c8d231c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"8d005c35-9919-4762-a56a-1808f568758b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario, salesPaymentType) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"venda f[ií]sica\": \"Venda Física\",\n      \"venda online|venda digital\": \"Venda Online\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e8b4d028-59bf-48d1-be68-5eb55bfbb0f9","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxModality\" with \"userInput\"","$invalid":false,"settings":{"value":"{{userInput}}","variable":"taxModality"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"639ae723-4c8f-4537-8c9c-15eafc103843","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"cc45bca6-a1e5-4bfb-80eb-37f50fb5bb08","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"63331023-2b40-48de-bf0a-7d63973d6574","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Vendas Online","Vendas Físicas"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-cbf3d6a5-15fd-479b-a0da-b3a86464f1fc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-73df9f33-a038-4f6c-8a4a-c4cafe70b91f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-784f588e-935e-4c79-9e3b-e561d81f3b8c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9518c8c4-2818-4dad-a9a3-3ac00f40c812","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"e912e94c-247f-4ad6-abec-f42562d981a0","root":false,"$title":"[TC.2.0.2][INPUT] Modalidade de venda","$position":{"top":"1330.21px","left":"294px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4dfbe4df-5b62-4c68-9130-ab7ccec1756b":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06094d8f-981b-4ac3-a526-af631e3f4600","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"313d8fd3-b86e-48a6-91d5-803adf2aa7d6","typeOfStateId":"state","$connId":"con_33","$contentId":"0e9a72e1-c51b-497a-8f60-ae80a6000813","$id":"65252d08-2925-4a46-9e47-b8a888193b6b","conditions":[{"source":"context","comparison":"equals","values":["Visa","Elo","Amex","Master","Hiper"],"variable":"userInput"},{"values":[],"source":"context","comparison":"exists","variable":"taxasExibir@taxaDebitoAvistaEcommerce"}],"$invalid":false},{"stateId":"82358327-d2c4-40da-a143-48cc6a090bad","typeOfStateId":"state","$connId":"con_38","$id":"a42a1689-c4ea-4e9f-a5b8-6355014714a9","conditions":[{"source":"context","comparison":"equals","values":["Elo","Amex","Hiper","Master","Visa"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"05482743-ecc7-4eae-96d3-ee4227e6527a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a2f27600-bc34-4e24-acca-19c4613242ea","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxModality\" to \"Vendas Físicas\" if taxaDebitoAvistaEcommerce NOT EXIST","$invalid":false,"settings":{"variable":"taxModality","value":"Vendas Físicas"},"conditions":[]}],"$leavingCustomActions":[{"$id":"22544a01-53d2-4dcb-aced-ddb4bb463c2e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"Master\": \"Master\",\n      \"Visa\": \"Visa\",\n      \"Elo\": \"Elo\",\n      \"Amex\": \"Amex\",\n      \"Hiper\": \"Hiper\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c054b662-39ca-4707-92a1-404817bd887a","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"55c74ed8-2695-46aa-ac96-1cf27d4caa33","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxCardFlag\" with \"userInput\"","$invalid":false,"settings":{"value":"{{userInput}}","variable":"taxCardFlag"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ba43bc26-d89c-4d11-bda1-82dc51e510b9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxasExibir\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaVendasBody, bandeira) {\n\ttry {\n\t\tbandeira.toLowerCase();\n\t\tbandeira = bandeira.replace('master', 'MSTC').replace('visa', 'VISA').replace('hiper', 'HIPC').replace('elo', 'ELOC').replace('amex', 'AMXC');\n\t\ttaxaVendasBody = JSON.parse(taxaVendasBody);\n\t\ttaxaVendasBody = taxaVendasBody.data\n\t\ttaxaVendasBody = taxaVendasBody.filter(taxaVendasBody => (taxaVendasBody.codigoBandeira == bandeira))\n\t\ttaxaVendasBody = taxaVendasBody[0]\n\t\treturn JSON.stringify(taxaVendasBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaVendasBody","taxCardFlag"],"outputVariable":"taxasExibir","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"867b8492-1a86-4037-8bbd-4460a5c70194","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"89766afe-5cc2-4c7b-8525-7611f9729cf9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Master","Visa","Elo","Amex","Hiper"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-ed4f59ec-e17e-4d58-91e0-5a800c533e65","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b7886e3a-36b2-4249-8326-76d737770c59","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a462ef5f-25be-402e-9d42-79a72c1e1bc0","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a1c37c57-5e51-4254-883c-0beb512b4377","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"4dfbe4df-5b62-4c68-9130-ab7ccec1756b","root":false,"$title":"[TC.2.0.1][INPUT] Selecao Bandeiras","$position":{"top":"839px","left":"322px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"82358327-d2c4-40da-a143-48cc6a090bad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e49b1f29-6b97-4331-a5e9-db2cad2b0715","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0f2ef715-e474-48e3-9642-ca975864c269","typeOfStateId":"state","$connId":"con_43","$id":"41318e27-1eba-4c23-952a-ce44edbcefe7","conditions":[{"source":"context","comparison":"equals","values":["Vendas Online"],"variable":"taxModality"},{"values":["Amex","Hiper"],"source":"context","comparison":"equals","variable":"taxCardFlag"}],"$invalid":false},{"stateId":"98c7523a-b7d2-49ab-bab8-c47926549497","typeOfStateId":"state","$connId":"con_48","$id":"77b3b24c-ec41-4614-85e9-ac4cfb7c2744","conditions":[{"source":"context","comparison":"equals","values":["Vendas Físicas"],"variable":"taxModality"},{"values":["Amex","Hiper"],"source":"context","comparison":"equals","variable":"taxCardFlag"}],"$invalid":false},{"stateId":"f518ebdc-b60f-4359-9584-38c43f13952d","typeOfStateId":"state","$connId":"con_53","$id":"ff7a7dd4-e58b-4b6e-bd9a-a6f7225748a6","conditions":[{"source":"context","comparison":"equals","values":["Vendas Online"],"variable":"taxModality"}],"$invalid":false},{"stateId":"e383d0a7-ef06-403b-9293-485753c8ceb0","typeOfStateId":"state","$connId":"con_58","$id":"4fef2789-2bfd-48cc-b907-f23ac2a31716","conditions":[{"source":"context","comparison":"equals","values":["Vendas Físicas"],"variable":"taxModality"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"3095bc08-c646-4fcc-92c0-4c74df9052fc","$typeOfContent":"","type":"ExecuteScript","$title":"taxasExibir","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(taxaVendasBody, modalidade, bandeira) {\n\n\ttry {\n\n\n\t\tbandeira = bandeira.replace('Master', 'MSTC').replace('Visa', 'VISA').replace('Hiper', 'HIPC').replace('Elo', 'ELOC').replace('Amex', 'AMXC');\n\t\ttaxaVendasBody = JSON.parse(taxaVendasBody);\n\t\ttaxaVendasBody = taxaVendasBody.data\n\t\ttaxaVendasBody = taxaVendasBody.filter(taxaVendasBody => (taxaVendasBody.codigoBandeira == bandeira))\n\t\ttaxaVendasBody = taxaVendasBody[0]\n\n\n\t\tfunction formatarTaxa(taxa) {\n\t\t\treturn parseFloat(taxa).toFixed(2).toString().replace('.', ',');\n\t\t}\n\n\t\t// Formatar as taxas no objeto\n\t\ttaxaVendasBody.taxaDebitoAvista = formatarTaxa(taxaVendasBody.taxaDebitoAvista);\n\t\ttaxaVendasBody.taxaDebitoAvistaEcommerce = formatarTaxa(taxaVendasBody.taxaDebitoAvistaEcommerce);\n\t\ttaxaVendasBody.taxaDebitoPf = formatarTaxa(taxaVendasBody.taxaDebitoPf);\n\t\ttaxaVendasBody.taxaDebitoPfEcommerce = formatarTaxa(taxaVendasBody.taxaDebitoPfEcommerce);\n\t\ttaxaVendasBody.taxaCreditoAVista = formatarTaxa(taxaVendasBody.taxaCreditoAVista);\n\t\ttaxaVendasBody.taxaCreditoAVistaEcommerce = formatarTaxa(taxaVendasBody.taxaCreditoAVistaEcommerce);\n\t\ttaxaVendasBody.taxaCreditoParcLojista2a6 = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista2a6);\n\t\ttaxaVendasBody.taxaCreditoParcLojista2a6Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista2a6Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParcLojista7a12 = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista7a12);\n\t\ttaxaVendasBody.taxaCreditoParcLojista7a12Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParcLojista7a12Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParcEmissor = formatarTaxa(taxaVendasBody.taxaCreditoParcEmissor);\n\t\ttaxaVendasBody.taxaCreditoParcEmissorEcommerce = formatarTaxa(taxaVendasBody.taxaCreditoParcEmissorEcommerce);\n\t\ttaxaVendasBody.taxaCreditoParc2 = formatarTaxa(taxaVendasBody.taxaCreditoParc2);\n\t\ttaxaVendasBody.taxaCreditoParc2Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc2Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc3 = formatarTaxa(taxaVendasBody.taxaCreditoParc3);\n\t\ttaxaVendasBody.taxaCreditoParc3Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc3Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc4 = formatarTaxa(taxaVendasBody.taxaCreditoParc4);\n\t\ttaxaVendasBody.taxaCreditoParc4Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc4Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc5 = formatarTaxa(taxaVendasBody.taxaCreditoParc5);\n\t\ttaxaVendasBody.taxaCreditoParc5Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc5Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc6 = formatarTaxa(taxaVendasBody.taxaCreditoParc6);\n\t\ttaxaVendasBody.taxaCreditoParc6Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc6Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc7 = formatarTaxa(taxaVendasBody.taxaCreditoParc7);\n\t\ttaxaVendasBody.taxaCreditoParc7Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc7Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc8 = formatarTaxa(taxaVendasBody.taxaCreditoParc8);\n\t\ttaxaVendasBody.taxaCreditoParc8Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc8Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc9 = formatarTaxa(taxaVendasBody.taxaCreditoParc9);\n\t\ttaxaVendasBody.taxaCreditoParc9Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc9Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc10 = formatarTaxa(taxaVendasBody.taxaCreditoParc10);\n\t\ttaxaVendasBody.taxaCreditoParc10Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc10Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc11 = formatarTaxa(taxaVendasBody.taxaCreditoParc11);\n\t\ttaxaVendasBody.taxaCreditoParc11Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc11Ecommerce);\n\t\ttaxaVendasBody.taxaCreditoParc12 = formatarTaxa(taxaVendasBody.taxaCreditoParc12);\n\t\ttaxaVendasBody.taxaCreditoParc12Ecommerce = formatarTaxa(taxaVendasBody.taxaCreditoParc12Ecommerce);\n\n\n\t\treturn JSON.stringify(taxaVendasBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaVendasBody","taxModality","taxCardFlag"],"outputVariable":"taxasExibir","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a802b057-33f7-4a54-bad9-e22e7e336276","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} validacao\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validacao","action":"{{taxModality}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxModality"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-eb13fb8e-d2d0-496f-be5c-d8557448d8ab","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-aab69507-ec64-48e3-aa7c-b3658012d518","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"82358327-d2c4-40da-a143-48cc6a090bad","root":false,"$title":"[TC.2.0.2][SET] \"taxasExibir\"","$position":{"top":"1765.75px","left":"323px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"64033608-d1fe-4704-aebe-31662a651f61":{"$contentActions":[{"action":{"$id":"36baba7b-a8d0-4106-b820-6e6a8bd18365","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"18e6a934-a151-4bb7-872d-8887f80bac91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"18e6a934-a151-4bb7-872d-8887f80bac91","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d6c68d38-7014-4fc3-bfdc-8c1441d50bae","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b6679cd5-e998-4a2e-8a3e-ed2446fb073c","type":"text/plain","content":"Digite em poucas palavras o motivo da sua solicitação.","metadata":{}},"$cardContent":{"document":{"id":"b6679cd5-e998-4a2e-8a3e-ed2446fb073c","type":"text/plain","content":"Digite em poucas palavras o motivo da sua solicitação."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ea0411d0-285d-4394-bb28-7e700f3871d5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"faf5caf6-e19a-42eb-9d38-2e4e58acae88","typeOfStateId":"state","$connId":"con_63","$id":"60af1b1b-1cdc-4a88-bc52-d8f5e762df02","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"6138dcc7-8d28-4836-9fec-7bd712c70b86","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"49787b51-0156-44fc-8565-77b607d79509","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-a848c5d0-0e9f-4fe6-91b2-3e4bd6ccc835","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-46a54084-3002-4322-91f0-9568b7dcf9f7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"64033608-d1fe-4704-aebe-31662a651f61","root":false,"$title":"[TC.7.0.1][MSG] Outro Motivo","$position":{"top":"877.714px","left":"3546.71px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"83910691-760e-4cc7-b210-e3aa8c707efa":{"$contentActions":[{"action":{"$id":"b6502dd7-688f-4c38-ad87-7ae5cbdf9939","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"2ff17d64-5871-485c-b2ec-ef3fc8c27323","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"2ff17d64-5871-485c-b2ec-ef3fc8c27323","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"db9f433e-7884-4e29-a9a7-0755cfe8c739","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3576eedf-1d52-44fa-8018-41112a232738","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3468fd40-a03c-45dc-b438-f0066d5aee17","typeOfStateId":"state","$connId":"con_68","$id":"ea739db2-e6e6-48f2-8263-c98a9af09947","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"667c6ac4-bb04-4eaf-a048-20bc29f734f2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(salesType) {\n    try {\n        let buttons = [\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"1\",\n                    \"title\": \"Alugada\"\n                }\n            },\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"2\",\n                    \"title\": \"Comprada\"\n                }\n            }\n        ];\n\n        const headerText = \"Vi que você tem máquinas habilitadas nas modalidades alugada e comprada.\\n\\nQual delas você quer consultar?\";\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"button\",\n                \"body\": {\n                    \"text\": headerText,\n                },\n                \"action\": {\n                    buttons\n                }\n            }\n        };\n    } catch (err) {\n        return false;\n    }\n}","inputVariables":["salesType"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0f98036-5458-49f0-b352-322f3681552e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-fb1d749d-7ebf-4e63-bea6-bdfa8925f707","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7beea997-b610-475f-a396-d13c0664f243","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-629be835-a7bf-451f-a893-7f0ac9a2e32f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"83910691-760e-4cc7-b210-e3aa8c707efa","root":false,"$title":"[TC.4.3.0][MSG] Alugada ou Comprada","$position":{"top":"682px","left":"1185px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5":{"$contentActions":[{"action":{"$id":"a7559ef9-604b-4b61-bb44-80a554f17f2b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"3ff29f1b-1be6-412b-ab1c-5883b8f4f7b4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"3ff29f1b-1be6-412b-ab1c-5883b8f4f7b4","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6da4ea77-f424-47c6-86dd-b2a533224d46","$typeOfContent":"text","type":"SendMessage","settings":{"id":"29f8529d-076c-4c21-8e18-809d6b00838b","type":"text/plain","content":"{{mensagemMaquinaAlugada}}","metadata":{}},"$cardContent":{"document":{"id":"29f8529d-076c-4c21-8e18-809d6b00838b","type":"text/plain","content":"{{mensagemMaquinaAlugada}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0c472da-c63a-4870-9520-42afef193343","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"df93c738-b6f9-4397-b7d0-e675bb78c31a","typeOfStateId":"state","$connId":"con_73","$id":"dd243811-9c3f-4f57-8174-e2a5ef65144f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"743e198d-4686-487b-881b-25d8d49d3ece","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Consulta Máquinas e traz alugadas."},"conditions":[]},{"$id":"b4375fd5-30ea-4508-9cb1-8c0f6b52aa4d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroLogico\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, numeroSerie) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\t\tlet numeroLogico = consultMaquina[0].numeroLogico\n\t\treturn numeroLogico;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["consultMaquina","numeroSerie"],"outputVariable":"numeroLogico","LocalTimeZoneEnabled":false},"conditions":[{"values":["1"],"source":"context","comparison":"notEquals","variable":"sizeMaquinas"}]},{"$id":"f945c26c-3927-4b58-ab32-2952c7ff388f","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyAlugueis\" (alugueis)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/alugueis?tipoFiltro=EC&valorFiltro={{selectedEc@codigoEc}}","responseStatusVariable":"statusAlugueis","responseBodyVariable":"bodyAlugueis"},"conditions":[]},{"$id":"ef93b2bc-a02a-4af5-973c-5c458110dede","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyApolice\" (apolices)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/vendas-servicos/vendas/seguros/assistente-virtual/v1/clientes/{{contaSelecionada@doc}}/apolices?codigoProduto=7105","responseStatusVariable":"statusApolice","responseBodyVariable":"bodyApolice"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusAlugueis"}]},{"$id":"ccc207e0-7789-4e3f-acd3-bf663d6f6534","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyFaturamentoAnual\" (Faturamento Anual)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/faturamentos?codigoEstabelecimentoComercial={{selectedEc@codigoEc}}&view=Anual","responseStatusVariable":"statusFaturamentoAnual","responseBodyVariable":"bodyFaturamentoAnual"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusAlugueis"}]},{"$id":"9bd06132-6d83-48c5-b4a0-2e51b97ecf41","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyFaturamentoMensal\" (Faturamento Mensal)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/faturamentos?codigoEstabelecimentoComercial={{selectedEc@codigoEc}}&view=Mensal","responseStatusVariable":"statusFaturamentoMensal","responseBodyVariable":"bodyFaturamentoMensal"},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusAlugueis"}]},{"$id":"3e2d9fbf-e178-4d07-bfcb-f232e7753a58","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"nomeTipoEquipamento\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(numeroSerie, consultMaquina, tipoMaquina) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\t\tlet codigoTipoEquipamento = consultMaquina[0].codigoTipoEquipamento\n\t\tcodigoTipoEquipamento = codigoTipoEquipamento.toString()\n\t\tif (consultMaquina == \"C\") {\n\t\t\tif (codigoTipoEquipamento == 1 || codigoTipoEquipamento == 5) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t\t} else if (codigoTipoEquipamento == 2) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t\t} else if (codigoTipoEquipamento == 3) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t\t} else {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t\t}\n\t\t} else {\n\t\t\tif (codigoTipoEquipamento == 15) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t\t} else if (codigoTipoEquipamento == 5) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t\t} else if (codigoTipoEquipamento == 1) {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t\t} else {\n\t\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t\t}\n\t\t}\n\t\treturn codigoTipoEquipamento;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["numeroSerie","consultMaquina","tipoMaquina"],"outputVariable":"nomeTipoEquipamento","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":true},{"$id":"81a93fda-a400-4250-abe2-9795c97ee2a3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"descricaoStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyApolice) {\n\ttry {\n\t\tlet bodyApolice = JSON.parse(bodyApolice);\n\t\tlet descricaoStatus = bodyApolice.data[0].descricaoStatus\n\t\treturn descricaoStatus\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["bodyApolice"],"outputVariable":"descricaoStatus","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"statusApolice"}],"continueOnError":true},{"$id":"3f09cd4c-bd14-4a30-8ceb-a0fd50182141","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"mensagemMaquinaAlugada\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyApolice, bodyAlugueis, bodyFaturamentoMensal, bodyFaturamentoAnual, numeroSerie, numeroLogico, consultMaquina) {\n    try {\n        mensagem = 'Confira as informações da sua máquina.\\n\\n'\n        bodyAlugueis = JSON.parse(bodyAlugueis);\n        bodyApolice = JSON.parse(bodyApolice);\n        consultMaquina = JSON.parse(consultMaquina);\n        bodyFaturamentoMensal = JSON.parse(bodyFaturamentoMensal);\n        bodyFaturamentoAnual = JSON.parse(bodyFaturamentoAnual);\n\n        const formartValue = (valor) => {\n            return `R$ ${\n                parseFloat(valor)\n                    .toFixed(2)\n                    .replace(\".\", \",\")\n                    .replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\")}`;\n        }\n        if (consultMaquina.data) {\n            consultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie === numeroSerie))\n            mensagem += `<b>{{nomeTipoEquipamento}}</b>\\n\\n<b>Número de série</b>\\n ${numeroSerie}\\n\\n`\n        }\n        if (bodyAlugueis.data.length > 0) {\n            bodyAlugueis = bodyAlugueis.data.filter(bodyAlugueis => (bodyAlugueis.numeroSerie === numeroSerie))\n            mensagem += `<b>Aluguel contratual:</b>\\n${formartValue(bodyAlugueis[0].valorTabela)}/ Mês \\n\\n<b>Último valor pago:</b>\\n${formartValue(bodyAlugueis[0].valorPago)}\\n\\n`\n        }\n        if (bodyApolice.data) {\n            bodyApolice = bodyApolice.data.filter(bodyApolice => (bodyApolice.numeroSerie === numeroSerie))\n            if (bodyApolice.descricaoStatus === 'Vigente') {\n                mensagem += `<b>Seguro:</b>\\nR$9,90/ Mês\\n\\n`\n            }\n        }\n        if (bodyFaturamentoMensal.data) {\n            if (bodyFaturamentoMensal.data.length > 0) {\n                bodyFaturamentoMensal = bodyFaturamentoMensal.data.filter(bodyFaturamentoMensal => (bodyFaturamentoMensal.numeroLogico === numeroLogico))\n                if (bodyFaturamentoMensal.length > 0) {\n                    mensagem += `<b>Valor realizado até agora:</b>\\nMensal - ${formartValue(bodyFaturamentoMensal[0].vopRealizado)} \\n\\n`\n                }\n            }\n        }\n        if (bodyFaturamentoAnual.data) {\n            if (bodyFaturamentoAnual.data.length > 0) {\n                bodyFaturamentoAnual = bodyFaturamentoAnual.data.filter(bodyFaturamentoAnual => (bodyFaturamentoAnual.numeroLogico === numeroLogico))\n                if (bodyFaturamentoAnual.length > 0) {\n                    mensagem += `Anual - ${formartValue(bodyFaturamentoAnual[0].valorVop)}`\n                }\n            }\n        }\n        return mensagem\n\n    }\n    catch (e) {\n        return e.message;\n    }\n}","inputVariables":["bodyApolice","bodyAlugueis","bodyFaturamentoMensal","bodyFaturamentoAnual","numeroSerie","numeroLogico","consultMaquina"],"outputVariable":"mensagemMaquinaAlugada","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"331d0cfe-8f21-4e6b-87ea-bd016f72fca6","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"a165671c-1bc6-43c1-8c62-d50531a04443","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"773fb672-7ef9-4df9-8e90-7fea3e31c9e0","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{statusAlugueis}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusAlugueis"}]},{"$id":"e51f1266-ddf0-4ee0-bb32-27cd18cd0f5a","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status 2","action":"{{statusApolice}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusApolice"}]},{"$id":"0ab29457-7b41-4896-9e3b-e7c99792296e","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status 3","action":"{{statusFaturamentoAnual}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusFaturamentoAnual"}]},{"$id":"f1b9ae80-d4d3-441e-9dc8-35273e3e2f1b","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status 4","action":"{{statusFaturamentoMensal}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusFaturamentoMensal"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-9495bbb8-999a-4f8f-aaa2-d67d6649715f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f6a95bd1-ac63-4a87-98ed-068b455a363d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f7303800-4221-49fd-8617-82fe452e7e52","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5482bf34-4e2c-4603-b92a-954fd80b2de1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-16828658-a5de-430a-bb14-bfd46bf42e28","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","root":false,"$title":"[TC.4.5.0][HTTP][SET] Alugada","$position":{"top":"2083px","left":"1154.78px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"df93c738-b6f9-4397-b7d0-e675bb78c31a":{"$contentActions":[{"action":{"$id":"a71e0bce-a782-46b5-bf01-04c73b606c6f","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"709715e4-9064-427f-88d0-49e875601b97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"709715e4-9064-427f-88d0-49e875601b97","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c998f964-8494-4c94-bc53-3393584d5e54","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"73db3d78-b7a6-40d2-aed0-09ed45b00c7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a987eb86-a520-4671-9e28-bcc98388eff4","typeOfStateId":"state","$connId":"con_78","$id":"5a504020-bbcf-44d3-8358-f38efe497ed6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"e89a9dc1-f632-4dda-8ae2-a187c0eda3fe","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"a3c64b9c-7dbb-4838-bf79-71c6dbd8f1dc","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada);\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Fazer nova consulta\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tbuttons = buttons.filter((reply) => reply.reply.title !== 'Falar com gerente');\n\t\t}\n\t\t\n\t\tconst headerText = \"O que você gostaria de fazer agora?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"873bff77-5942-43cf-b93e-c243b97775c1","$typeOfContent":"","type":"TrackEvent","$title":"Track validação","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{input.content}}"},"conditions":[{"values":["Fazer outra consulta","Encerrar"],"source":"input","comparison":"equals"}]},{"$id":"9a451ad2-91d5-434e-9fc7-77d891eabd8f","$typeOfContent":"","type":"TrackEvent","$title":"Track input inesperado","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["Fazer outra consulta","Encerrar"],"source":"input","comparison":"notEquals"},{"values":[],"source":"input","comparison":"exists"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-c36a20e2-bbb3-4494-9256-4f212a209958","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ca7bcf2e-4472-416b-8777-32b10eaa645a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a983421f-1f9b-4b66-9382-3e35055d65fe","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"df93c738-b6f9-4397-b7d0-e675bb78c31a","root":false,"$title":"[TC.4.6.0][MSG] Como deseja prosseguir?","$position":{"top":"2349px","left":"1126px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f518ebdc-b60f-4359-9584-38c43f13952d":{"$contentActions":[{"action":{"$id":"feffda65-3602-4e61-a33a-839541a40181","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d0c6c048-645a-485d-a7f5-63204f56b32b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d0c6c048-645a-485d-a7f5-63204f56b32b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9b5268cd-48c4-409a-b8e4-5f37da13553e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"15f53958-ac77-4e36-9983-706561f74175","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. ","metadata":{}},"$cardContent":{"document":{"id":"15f53958-ac77-4e36-9983-706561f74175","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"778d041a-aed1-4440-9b45-f0f691cf4ee6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4df37b47-c05d-4694-9b73-7d0527269b0f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"<b>Taxas de Venda</b>            \n\n<b>Débito</b> {{taxasExibir@taxaDebitoAvistaEcommerce}}%\n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x {{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%","metadata":{}},"$cardContent":{"document":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"<b>Taxas de Venda</b>            \n\n<b>Débito</b> {{taxasExibir@taxaDebitoAvistaEcommerce}}%\n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x {{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_83","$id":"8d328538-b312-4a47-b244-c1009e93ed53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ec98b5c3-6785-4cc0-a384-c4c54cd055ce","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-f764c162-77c5-4ae0-aa50-706ccc0a7205","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c010e249-d2b1-476b-b38f-ca022c066421","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f518ebdc-b60f-4359-9584-38c43f13952d","root":false,"$title":"[TC.2.0.3][MSG] Vendas Online","$position":{"top":"2022px","left":"124px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c4fec3d1-c20d-43de-9160-8a93f67989eb":{"$contentActions":[{"action":{"$id":"234d16b5-f24b-4c54-bb81-c2a73d4821b1","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"19266a5f-50c2-4b23-9c9f-5adbffe97645","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"19266a5f-50c2-4b23-9c9f-5adbffe97645","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"e14960a5-1269-411a-b489-8a028db4a3a8","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2c3fb294-2616-4c3a-a763-1d1d381f1b50","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso.","metadata":{}},"$cardContent":{"document":{"id":"2c3fb294-2616-4c3a-a763-1d1d381f1b50","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"59d0589a-4bfe-427b-bcc3-37affdafab98","typeOfStateId":"state","$connId":"con_88","$id":"618ddfc5-3861-4bf8-bf0f-09716a47ed2f","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"693eb286-efb9-4895-b0d2-d77d894e4443","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"3e62b2c0-5f18-409b-82d0-b81a3ee02b6e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"6bcc8da9-ce73-46fa-947f-50b3dd663fa4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"f4c24d20-fdd8-4afe-8266-b83f3dcc5888","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["taxaVendasStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85fe279f-9a05-46d8-8b5c-c4e79a96cbb5","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}} | GET| {{taxaVendasStatus}} | {{taxaVendasBody}}"},"conditions":[]},{"$id":"bbf3d93d-9faa-4977-9a02-d287aac7d515","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Chamada de API\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"taxas de venda"},"conditions":[]},{"$id":"b5362a53-b40b-40de-b865-f325d90dc509","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"b7371748-92dd-4639-8549-7383e1f4d07a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]},{"$id":"7d26ddfe-5dbd-4fd7-bf01-45fede77a626","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"taxaVendasStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-07d9cd86-f57d-4310-8987-d1cac056b524","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-05f9bdf8-0db7-4965-9c55-744b297d7d3d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-79460576-05bc-4687-9fd8-27e08da3d3c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e7cfa638-bfa8-41be-8468-ce773ba0a5e7","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c5423495-d2dd-4951-b596-aa40b41c0e73","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c4fec3d1-c20d-43de-9160-8a93f67989eb","root":false,"$title":"[TC.2.0.0][HTTP] API Taxas de Venda","$position":{"top":"418px","left":"323px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e383d0a7-ef06-403b-9293-485753c8ceb0":{"$contentActions":[{"action":{"$id":"0ce58280-ad89-4a03-b687-e4cf3f52cec9","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"274a2143-53a1-4599-9c21-3e2cee304eae","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"274a2143-53a1-4599-9c21-3e2cee304eae","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7f01e282-535b-4f52-a68b-807c02424815","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f769e6ea-39c7-4400-a45e-3c39319eb581","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. ","metadata":{}},"$cardContent":{"document":{"id":"f769e6ea-39c7-4400-a45e-3c39319eb581","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a8268dd6-051b-4645-be9c-6d892c9de125","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ee0f713e-1ae3-4702-a494-79e02c4d66b2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"<b>Taxas de Venda</b>              \n\n<b>Débito</b> {{taxasExibir@taxaDebitoAvista}}%\n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVista}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%","metadata":{}},"$cardContent":{"document":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"<b>Taxas de Venda</b>              \n\n<b>Débito</b> {{taxasExibir@taxaDebitoAvista}}%\n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVista}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_93","$id":"2b19bb33-2cc7-40d2-929f-3a0129508c75","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b0aee7cc-d081-4b06-8483-6fe6978a463c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-144822d3-ef89-45c5-8035-a87c32eba625","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-62dbfaf8-4f82-4207-9cff-865b69f897d0","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e383d0a7-ef06-403b-9293-485753c8ceb0","root":false,"$title":"[TC.2.0.4][MSG] Vendas Físicas","$position":{"top":"2016px","left":"512px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b8de541a-4234-4125-9502-46ade2ce536a":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0f933b67-ad42-44b2-bcfd-df79cd621cb1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"9262b032-7ea2-45d2-b782-2649ddad61b9","typeOfStateId":"state","$connId":"con_98","$id":"686eaa78-4b81-443f-88e2-a0818ad41a76","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false},{"stateId":"4668cb14-a953-4cd6-a7c6-23dc18b0b548","typeOfStateId":"state","$connId":"con_103","$id":"def5478f-e050-4b82-be34-8769215f2dd6","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"e87ccb23-260e-4848-9c4d-86856a602879","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4a07e14c-4fff-4c1e-99e0-aba5811f4fa7","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"82cbc05c-b485-4cbd-b6cf-22003b02f606","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"da4c1bc5-231c-4d5d-9a14-8f6da7cb821e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b0758c5f-60cc-4e36-9d09-12332759940b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-099bcf0c-3314-4017-9a12-495b43868712","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bf20663c-ed5b-4c7b-ba88-3b69803fc916","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-885ef84e-1983-4841-a95f-c7cdaec0a769","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b8de541a-4234-4125-9502-46ade2ce536a","root":false,"$title":"[TC.2.2.1][INPUT] Consultar Taxas","$position":{"top":"3225.7px","left":"349.435px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5645aa88-959e-46a7-af25-0e32ed445e49":{"$contentActions":[{"action":{"$id":"7dc6c119-7d10-4d3b-b6a6-ea3e5a8433e7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cdd809de-7203-4b20-81da-23a4f30cf05d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cdd809de-7203-4b20-81da-23a4f30cf05d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"97a00499-b5cf-430e-a016-5ffb5474ff9f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7a8e5044-1ad8-4261-b4d8-2bb8d6bb06c4","type":"text/plain","content":"Identifiquei as taxas de antecipação do seu plano.\n\n<b>Crédito à vista</b>: {{taxaAnteAuto@taxaAVista}}%\n\n<b>Crédito parcelado</b>:{{taxaAnteAuto@taxaParcelado}}%\n\n <b>Taxa Link de Pagamento</b>: R$ 0,90 por transação + MDR E-commerce","metadata":{}},"$cardContent":{"document":{"id":"7a8e5044-1ad8-4261-b4d8-2bb8d6bb06c4","type":"text/plain","content":"Identifiquei as taxas de antecipação do seu plano.\n\n<b>Crédito à vista</b>: {{taxaAnteAuto@taxaAVista}}%\n\n<b>Crédito parcelado</b>:{{taxaAnteAuto@taxaParcelado}}%\n\n <b>Taxa Link de Pagamento</b>: R$ 0,90 por transação + MDR E-commerce"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"134f75db-4f3c-4658-91e9-26e165171534","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"368ed6d2-36d7-4631-a0b5-982523a88008","typeOfStateId":"state","$connId":"con_108","$id":"915085d6-f45c-432e-9da4-b2aa72db323a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ac61989a-4ee1-47fc-bfed-17ffe2bd31e1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAnteAuto\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.automatica\n\t\ttaxaBody.taxaAVista = parseFloat(taxaBody.taxaAVista).toFixed(2).toString().replace('.', ',')\n\t\ttaxaBody.taxaParcelado = parseFloat(taxaBody.taxaParcelado).toFixed(2).toString().replace('.', ',')\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaAnteAuto","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"4a99a272-e297-495d-b3a5-3e10d0eeff74","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2c48f634-ab4d-49bb-b8a2-b5e8ad4c3616","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0e0d0c2e-0100-4c67-b037-0abd02fc1c70","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4fcd1dae-d413-4b31-84a6-d52d353dac11","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"5645aa88-959e-46a7-af25-0e32ed445e49","root":false,"$title":"[TC.3.1.0][MSG] Exibe Taxas de Antecipação","$position":{"top":"668.667px","left":"4250.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6159148f-ca32-497c-a843-838a5bc20b0e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"e6e9700d-c3f2-487e-a7db-d5bd68c88280","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"ba86d697-73e1-47ee-9a6a-0c58a46a207b","typeOfStateId":"state","$connId":"con_113","$contentId":"6936603a-fa1f-4d47-be1b-68d6e7924e62","$id":"b872a097-7b98-44b8-a3d6-f9790c7a3217","conditions":[{"source":"context","comparison":"equals","values":["Falar com gerente"],"variable":"userInput"}],"$invalid":false},{"stateId":"103227ab-c79b-4daa-8667-77e2b8c3c5ff","typeOfStateId":"state","$connId":"con_118","$contentId":"6936603a-fa1f-4d47-be1b-68d6e7924e62","$id":"85006734-a60f-4298-b5bf-a2ad964e01fb","conditions":[{"source":"context","comparison":"equals","values":["Ver taxas"],"variable":"userInput"}],"$invalid":false},{"stateId":"4b3dce83-c8a0-4de5-af41-e32f491ea7e2","typeOfStateId":"state","$connId":"con_123","$id":"177742e2-aec2-4369-9149-91c461edf041","conditions":[{"source":"context","comparison":"equals","values":["Encerrar  atendimento"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"2632b4b5-eb86-4f68-9841-f35b5581a73e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"55b0637c-cd7c-4bda-ae00-0c782a849a39","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"dda0d594-7c05-4f4b-aa7c-d3b2160c4d54","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"a8298872-dd92-4fba-86ce-1bf343943c9a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-6cddd245-e10e-4495-8846-1b11a648985f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3752d619-a7e6-4eec-94d7-e9f0c4af1b2d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6eba8963-4dad-497a-85be-d6d74fa2b0c2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7059bce6-816c-4550-a196-ce2f7892dff3","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"6159148f-ca32-497c-a843-838a5bc20b0e","root":false,"$title":"[TC.2.2.2][INPUT] Taxa atual","$position":{"top":"3236px","left":"908px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a65258c3-241a-4ab6-94b7-d3b0cfdb7ccd":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c950fde0-4616-49b2-9f39-a0ba859beab4","typeOfStateId":"state","$connId":"con_128","$id":"22905db9-e90e-43ff-8696-1c5190ea55bf","conditions":[{"source":"context","comparison":"equals","values":["SEM ARV","\"SEM ARV\""],"variable":"taxaModalidade"}],"$invalid":false},{"stateId":"c07b1d82-9004-40cc-a93c-f0cabb17f9a7","typeOfStateId":"state","$connId":"con_133","$id":"57625472-6942-43b7-acc1-422abf536dd2","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"taxaModalidade"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd4ca2d9-b36e-40a4-9cae-085b4e5e085a","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"consulta taxas de atencipação do plano"},"conditions":[]},{"$id":"e448899d-10fa-4137-81e9-3cf6f9cd8551","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaBody\" (taxa)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao","responseStatusVariable":"taxaStatus","responseBodyVariable":"taxaBody"},"conditions":[]},{"$id":"695557b3-8de1-433c-9df5-df9491e5b200","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAntecipacao\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.data\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaBody"],"outputVariable":"taxaAntecipacao","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"taxaStatus"}]},{"$id":"8a14a865-fe46-4720-a100-febd2918a05f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaModalidade\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.modalidade\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaModalidade","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"taxaStatus"}]},{"$id":"33134da2-5316-46f3-b06b-23738c3b2e35","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"d567bfc0-f86e-4dea-b20e-af94875bb1bc","$typeOfContent":"","type":"SetVariable","$title":"menuTaxaAntecipacao","$invalid":false,"settings":{"variable":"menuTaxaAntecipacao","value":"true"},"conditions":[]},{"$id":"8c64ff42-a17e-4704-b6db-f97d8a4fb8c6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"928746a8-2536-43c8-8978-eeeafd5edd6e","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]},{"$id":"fcc265ea-5b13-4088-aeeb-cd4b162e7049","$typeOfContent":"","type":"TrackEvent","$title":"Track api status","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} api status","action":"{{taxaStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-02fc6641-8358-41a2-a721-46b356e10d8f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d0d3dabd-4124-42cb-9f94-22d6238b0f37","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-9e874dc9-f7fe-40eb-874d-352aaff7b541","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4b25a9bf-2917-42bb-81a8-f9ac76969260","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"a65258c3-241a-4ab6-94b7-d3b0cfdb7ccd","root":false,"$title":"[TC.2.2.0][HTTP] API Taxas de Antecipação","$position":{"top":"2724px","left":"617px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"17828cf7-5217-4cf1-bf9e-1393e96afaac":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0b3f2fd0-0767-43e5-bf5c-0e68bd381735","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"ba86d697-73e1-47ee-9a6a-0c58a46a207b","typeOfStateId":"state","$connId":"con_138","$id":"bce4a201-43c2-46d5-a792-7893d09d71cc","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"9262b032-7ea2-45d2-b782-2649ddad61b9","typeOfStateId":"state","$connId":"con_143","$id":"74ac6ea0-7c09-48fe-8bf7-6e64f8221dcd","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"64b2db99-147a-41df-817a-5cec535467fb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const validInputMessage = \"Input inesperado\"\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    const regexDictionary = {\n      \"n[ãa]o|naum\": \"Não\",\n      \"sim|sin\": \"Sim\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return validInputMessage\n  } catch (err) {\n    return validInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f3e7f55-532a-433c-804c-b2f0a140fc4f","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"10a069a8-1962-4edc-9831-5baf203f2394","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f50f4e4c-8aa0-4bf2-bc9e-646575d0c32b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Sim","Não"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b6d2d4e5-bc26-4bf1-9e14-d04a29204141","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9c045bd7-2dcf-4fd9-96c3-e4b91a2e6171","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-6b8f9526-7e4c-4139-ae37-b3fc7afb46e4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-161d2883-cbc1-4023-83e4-5070aaa4b0ff","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"17828cf7-5217-4cf1-bf9e-1393e96afaac","root":false,"$title":"[TC.2.2.3][INPUT] Questionar Transferência","$position":{"top":"3747px","left":"910.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"91dec6e6-2e08-462d-8d81-d38d2b223594":{"$contentActions":[{"action":{"$id":"77678ce4-5f24-41ab-a5bb-bdd17949303c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"496ea2fc-5246-46bc-8882-e5aaa127878c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"496ea2fc-5246-46bc-8882-e5aaa127878c","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"31506983-8559-4821-8ff0-f0fdac0e7081","$typeOfContent":"text","type":"SendMessage","settings":{"id":"26f8f16e-4d7b-4792-a5dd-4a57798b5c9b","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso.","metadata":{}},"$cardContent":{"document":{"id":"26f8f16e-4d7b-4792-a5dd-4a57798b5c9b","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e96a7ac0-b61c-4db5-b006-4b9ec1d43c9a","typeOfStateId":"state","$connId":"con_148","$id":"d55ad3ed-f8b1-496b-b01c-4626b5519d0f","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8c0c47e-5523-4797-9ecc-d54fd05c5ffb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"Chamada de API\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Taxas Pix na Safrapay"},"conditions":[]},{"$id":"51d27bb6-6296-448f-83c5-4c56956afcaf","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao","responseStatusVariable":"taxaStatus","responseBodyVariable":"taxaBody"},"conditions":[]},{"$id":"655d3ace-6fdf-47f9-88ab-1c1e20225d72","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"taxaVendasBody\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/taxas?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"taxaVendasStatus","responseBodyVariable":"taxaVendasBody"},"conditions":[]},{"$id":"0bb1646a-58f7-4462-b151-836fa1321f44","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaAntecipacao\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.data\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaBody"],"outputVariable":"taxaAntecipacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b125adeb-dd51-469f-9335-87b42cc55bc3","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxaModalidade\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaBody) {\n\ttry {\n\t\tlet taxaBody = JSON.parse(taxaBody);\n\t\ttaxaBody = taxaBody.modalidade\n\t\treturn JSON.stringify(taxaBody);\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaAntecipacao"],"outputVariable":"taxaModalidade","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d7dc8fb7-e88e-4e40-aa94-2b861bae5b36","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxasPix\"","$invalid":false,"settings":{"function":"run","source":"function run(taxaVendas) {\n\ttry {\n\t\tlet taxaVendasBody = JSON.parse(taxaVendas);\n\t\ttaxaVendasBody = taxaVendasBody.data\n\t\ttaxaVendasBody = taxaVendasBody.filter(taxaVendasBody => (taxaVendasBody.codigoBandeira == 'PIXD'))\n\t\ttaxaVendasBody = taxaVendasBody[0].taxaDebitoAvista\n\t\ttaxaVendasBody = taxaVendasBody.toString().replace('.', ',')\n\t\treturn taxaVendasBody;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["taxaVendasBody"],"outputVariable":"taxasPix","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cace4b24-5176-4307-bf21-1db7facd0354","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"924517fe-de28-4398-b2e3-34de003926fa","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"015b1797-d138-4e20-861b-3d8152e2ab4b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"99a26cbb-1a56-403c-8e2e-97a911b7e8bd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["taxaStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ed7164d8-3098-4735-8ec4-809f69e71bfd","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/operacoes-execucoes/servicos-consumidores/antecipacoes-recebiveis/assistente-virtual/v1/estabelecimentos/{{selectedEc@codigoEc}}?view=taxas-antecipacao | GET| {{taxaStatus}} | {{taxaBody}}"},"conditions":[]},{"$id":"619e4264-e83d-4d96-8d57-9a2e3bc2e259","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"7a574f99-a10e-4be6-9f64-43f77c2979e6","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{taxaStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaStatus"}]},{"$id":"5a39e403-d6b9-466f-a28b-592ead62783d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status 2","action":"{{taxaVendasStatus}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"taxaVendasStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-5ff7d5d8-aa0a-486b-81c3-13d621a4a0b9","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-57062812-308d-4a15-8d8e-00adb0ac52fd","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-85b1756a-0f8b-49d9-b252-e8bb2f09840b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-910e5371-7dd6-45b6-a12a-230f3a0defd2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-edb7f2d8-a5d0-4884-b677-3c9e2df6a5ef","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"91dec6e6-2e08-462d-8d81-d38d2b223594","root":false,"$title":"[TC.5.0.0][HTTP] API Taxas Pix na SafraPay","$position":{"top":"449px","left":"4506px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"49787b51-0156-44fc-8565-77b607d79509":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"37286ef7-791d-4af5-938f-fd2600482e21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a93d6907-ae20-48eb-afeb-42de5c3bc9ba","typeOfStateId":"state","$connId":"con_153","$id":"1a57abde-00c0-4694-aad8-3bec7368dbe7","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"18eb9e2c-4309-4ebc-81ee-6eecba46c7a3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"ebf8e269-e204-4873-a66f-b1157e4c5094","$typeOfContent":"","type":"SetVariable","$title":"Set \"motivoProtocolo\" to \"questionarUmaCobranca\"","$invalid":false,"settings":{"variable":"motivoProtocolo","value":"questionarUmaCobranca"},"conditions":[]},{"$id":"d46ba7ea-d135-4cb2-9695-f43fc214c06e","type":"ExecuteScript","$title":"Process \"payloadProtocolo\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(contaSelecionada) {\n    try {\n        const { doc, codigoSegmento } = JSON.parse(contaSelecionada)\n        const payload = JSON.stringify({\n            origemDesc: \"CLIENTE\",\n            idSegmento: parseInt(codigoSegmento),\n            CpfCnpj: doc,\n            canalDesc: \"WHATSAPP\",\n            statusDesc: 'ABERTO',\n            usuarioInclusao: 'USR_SPD'\n        })\n        return payload;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\n","inputVariables":["contaSelecionada"],"outputVariable":"payloadProtocolo","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"70cd3530-a826-4b84-9381-0f299c51e143","type":"ProcessHttp","$title":"HTTP POST \"bodyProtocoloBpm\" (Cria Protocolo no Front)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","Content-Type":"application/json","User-Agent":"Fiddler","Safra-Correlation-ID":"{{random.guid}}"},"method":"POST","body":"{{payloadProtocolo}}","uri":"{{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos","responseStatusVariable":"statusProtocoloBpm","responseBodyVariable":"bodyProtocoloBpm"},"conditions":[]},{"$id":"df5da49c-4330-4f1e-902f-115da63bca8a","type":"ExecuteScript","$title":"Process \"idProtocoloBpm\" (Pega Id do protocolo BPM)","$invalid":false,"settings":{"function":"run","source":"function run(protocolo) {\n    try {\n        const protocoloId = JSON.parse(protocolo);\n        return protocoloId.data.id;\n    }\n    catch (err) {\n        return \"Falha ao abrir protocolo, tente novamente em alguns instantes.\"\n    }\n}\n","inputVariables":["bodyProtocoloBpm"],"outputVariable":"idProtocoloBpm","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"dd7ad50b-8d3d-4de6-b79e-0589d7bbb546","type":"ExecuteScript","$title":"Process \"descricacaoProtocolo\"","$invalid":false,"settings":{"function":"run","source":"function run(idProtocolo, idSubMotivo, motivoQuestionamentoCobranca, origemCobranca, localVisualizacaoCobranca, dataCobranca, valorCobranca, contaSelecionada, identity) {\n    try {\n        const { doc } = JSON.parse(contaSelecionada);\n        let phone = identity.split('@')[0];\n        const observacaoSolucaoAtendimento = `Criação automática WhatsApp PJ CPF/CNPJ: ${doc} | Telefone: ${phone} | Origem da cobrança: ${origemCobranca} | Local de visualização: ${localVisualizacaoCobranca} | Data da cobrança: ${dataCobranca} | Valor da cobrança: ${valorCobranca} | Motivo do questionamento: ${motivoQuestionamentoCobranca}`\n        return observacaoSolucaoAtendimento;\n    }\n    catch (e) {\n        return e.message;\n    }\n}\n","inputVariables":["idProtocoloBpm","idSubMotivo","motivoQuestionamentoCobranca","origemCobranca","localVisualizacaoCobranca","dataCobranca","valorCobranca","contaSelecionada","contact.identity"],"outputVariable":"descricacaoProtocolo","LocalTimeZoneEnabled":false},"conditions":[{"source":"context","comparison":"equals","variable":"statusProtocoloBpm","values":["200"]}]},{"$id":"1e6f0754-21fd-4a65-8ecf-d9945632b0e7","type":"ExecuteScript","$title":"Process \"payloadOcorrencia\" (Gera payload ocorrencia)","$invalid":false,"settings":{"function":"run","source":"function run(body, routerId, motivo, description) {\n    try {\n        const { tipoId, motivoId, subMotivoId } = JSON.parse(body)[routerId][motivo];\n        const newBody = {\n            tipoId,\n            motivoId,\n            subMotivoId,\n            statusProcessamentoDesc: 'ABERTO',\n            usuarioInclusao: 'USR_SPD',\n            observacaoSolucaoAtendimento: description || '',\n            origem: 'CLIENTE',\n        }\n        return newBody\n    } catch (err) {\n        return false\n    }\n}","inputVariables":["resource.taxionomiaProtocolos","tunnel.owner","motivoProtocolo","descricacaoProtocolo"],"outputVariable":"payloadOcorrencia","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fa02da61-b215-4245-b6e4-9797d84c4640","type":"ProcessHttp","$title":"HTTP POST \"bodyOcorrencia\" (Cria nova ocorrencia)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"POST","body":"{{payloadOcorrencia}}","uri":"{{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos/{{idProtocoloBpm}}/ocorrencias","responseStatusVariable":"statusOcorrencia","responseBodyVariable":"bodyOcorrencia"},"conditions":[]},{"$id":"1a912343-f4cf-4034-9475-d65e6eb985c4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusOcorrencia","statusProtocoloBpm"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"9c568522-7ba7-443a-85ed-3614007b6b97","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[{"values":["200"],"source":"context","comparison":"notEquals","variable":"statusOcorrencia"}]},{"$id":"c23312f4-f674-4998-acbe-1c5b77ce59e8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{apiStatus}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"apiStatus"}]},{"$id":"a079121b-0d85-4eb2-aea4-41eb9f3c20c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api resumo\" (POST) (PROTOCOLO)","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos | {{payloadProtocolo}} | {{statusProtocoloBpm}} | {{bodyProtocoloBpm}}","category":"{{state.name}} api resumo"},"conditions":[]},{"$id":"580ed6dc-82b4-4367-a2a3-a05c5676a816","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api resumo\" (POST) (OCORRENCIA)","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/protocolos/v1/protocolos/{{idProtocoloBpm}}/ocorrencias | {{payloadOcorrencia}} | {{statusOcorrencia}} | {{bodyOcorrencia}}","category":"{{state.name}} api resumo 2"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-bcba6842-0c1c-4b9b-b26b-4655090f86b2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-89c7ee7f-4025-4ab3-812b-6db093bec5bf","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d6942ffa-07ce-43cd-a190-ab7d29350fb3","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3db0f8e8-5066-474c-8702-1dd32e25c3ae","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false}],"id":"49787b51-0156-44fc-8565-77b607d79509","root":false,"$title":"[TC.7.4.0][HTTP] API Protocolo","$position":{"top":"2891px","left":"3067.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"46f819c5-9a97-4c4c-9a09-e363d6736ae1":{"$contentActions":[{"action":{"$id":"63f14278-b91e-4558-9eed-ed6d7a2eb3bb","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"83d18b92-19f5-42ec-ae50-e0da12377812","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"83d18b92-19f5-42ec-ae50-e0da12377812","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2789570d-4fd6-40c0-9611-cc39778c9f02","$typeOfContent":"text","type":"SendMessage","settings":{"id":"9d5499f9-da1f-4602-ab14-28cb51b8680c","type":"text/plain","content":"Qual é o número de série?\n\nDigite <b>998</b> na sua maquininha para encontrar o número e, em seguida informe aqui.","metadata":{}},"$cardContent":{"document":{"id":"9d5499f9-da1f-4602-ab14-28cb51b8680c","type":"text/plain","content":"Qual é o número de série?\n\nDigite <b>998</b> na sua maquininha para encontrar o número e, em seguida informe aqui."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"dfd199b8-ed5e-44e2-b226-65990f659223","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"62786aa5-df6a-4069-9147-36ff1377b02c","typeOfStateId":"state","$connId":"con_158","$id":"4dd0c988-12da-4474-ae18-e5c5a8fa6be7","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"96b77a4f-874d-4f45-b466-86bd372dc95b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-821003bc-0636-48c8-a455-33e5049c90c4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-76fa76c7-bbc4-46ae-9e07-d29b9de7feb1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"46f819c5-9a97-4c4c-9a09-e363d6736ae1","root":false,"$title":"[TC.4.2.0][MSG] Numero de Série (Maquina> 10)","$position":{"top":"1194.67px","left":"927px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e96a7ac0-b61c-4db5-b006-4b9ec1d43c9a":{"$contentActions":[{"action":{"$id":"91f67286-a6fc-44ed-b6ff-fbbc4dec3fba","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cb85523e-a36c-412e-8acd-b9aca5fb8964","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cb85523e-a36c-412e-8acd-b9aca5fb8964","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"72c99e6f-417b-48a3-bb12-298e5af4da98","$typeOfContent":"text","type":"SendMessage","settings":{"id":"b5a12336-17ff-46c5-8543-da6d4a2df365","type":"text/plain","content":"Sua taxa é de {{taxasPix}}% por venda realizada através de QR Code PIX na maquininha e link de pagamento","metadata":{}},"$cardContent":{"document":{"id":"b5a12336-17ff-46c5-8543-da6d4a2df365","type":"text/plain","content":"Sua taxa é de {{taxasPix}}% por venda realizada através de QR Code PIX na maquininha e link de pagamento"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a99a7d66-b761-4ad6-b03b-8a30b7f3fcca","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"368ed6d2-36d7-4631-a0b5-982523a88008","typeOfStateId":"state","$connId":"con_163","$id":"e129461f-b351-42cb-9ec3-954e34d3f701","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ea6d1af7-f481-4e9c-8c48-cb3937f7b9a0","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c7eb533c-b37f-4499-9463-05e86410f815","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2b12d9f4-0223-4909-99e1-7f64bcf79c1e","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e96a7ac0-b61c-4db5-b006-4b9ec1d43c9a","root":false,"$title":"[TC.5.1.0][MSG] Exibir Taxas Pix na SafraPay","$position":{"top":"682px","left":"4506px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0e6bc8ca-977f-40d6-9ccf-23d15a44268b":{"$contentActions":[{"action":{"$id":"5f6b87a3-3944-4115-bc8e-f78cc3186984","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7e0aa8c5-c7e2-465c-adad-5f65ab2a9b85","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7e0aa8c5-c7e2-465c-adad-5f65ab2a9b85","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a167b679-ba67-479e-80f7-b1b7fccce5ff","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cde791f3-9c29-44ec-a661-3110b752a236","type":"text/plain","content":"Confira as informações da sua máquina.\n\n<b>{{nomeTipoEquipamento}}</b>\n\n<b>N° de série:</b>\n{{numeroserie}}\n\n<b>Comprada em:</b>\n{{dataInstalacao}}\n","metadata":{}},"$cardContent":{"document":{"id":"cde791f3-9c29-44ec-a661-3110b752a236","type":"text/plain","content":"Confira as informações da sua máquina.\n\n<b>{{nomeTipoEquipamento}}</b>\n\n<b>N° de série:</b>\n{{numeroserie}}\n\n<b>Comprada em:</b>\n{{dataInstalacao}}\n"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f0c472da-c63a-4870-9520-42afef193343","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"df93c738-b6f9-4397-b7d0-e675bb78c31a","typeOfStateId":"state","$connId":"con_168","$id":"1593e51d-6927-4b74-b690-c37b1d5d1995","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"93340493-deb2-4640-810a-bf5562534f58","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Consulta Máquinas e traz compradas."},"conditions":[]},{"$id":"b4375fd5-30ea-4508-9cb1-8c0f6b52aa4d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroLogico\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(consultMaquina, numeroSerie) {\n\tlet consultMaquina = JSON.parse(consultMaquina);\n\tconsultMaquina = consultMaquina.data.filter( consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\tlet numeroLogico = consultMaquina[0].numeroLogico\n\treturn numeroLogico; \n}\n\n","inputVariables":["consultMaquina","numeroSerie"],"outputVariable":"numeroLogico","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3e2d9fbf-e178-4d07-bfcb-f232e7753a58","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"nomeTipoEquipamento\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(numeroSerie, consultMaquina, tipoMaquina) {\n\tlet consultMaquina = JSON.parse(consultMaquina);\n\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\tlet codigoTipoEquipamento = consultMaquina[0].codigoTipoEquipamento\n\tcodigoTipoEquipamento = codigoTipoEquipamento.toString()\n\tif (consultMaquina == \"C\") {\n\t\tif (codigoTipoEquipamento == 1 || codigoTipoEquipamento == 5) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t} else if (codigoTipoEquipamento == 2) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t} else if (codigoTipoEquipamento == 3) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t} else {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t}\n\t} else {\n\t\tif (codigoTipoEquipamento == 15) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Mini'\n\t\t} else if (codigoTipoEquipamento == 5) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Slim'\n\t\t} else if (codigoTipoEquipamento == 1) {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Pro'\n\t\t} else {\n\t\t\tcodigoTipoEquipamento = 'SafraPay Smart'\n\t\t}\n\t}\n\treturn codigoTipoEquipamento;\n}\n\n","inputVariables":["numeroSerie","consultMaquina","tipoMaquina"],"outputVariable":"nomeTipoEquipamento","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"151e23a0-7abf-48e2-a272-1471fc338f46","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dataInstalacao\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(consultMaquina, numeroSerie) {\n\tlet consultMaquina = JSON.parse(consultMaquina);\n\tconsultMaquina = consultMaquina.data.filter(consultMaquina => (consultMaquina.numeroSerie == numeroSerie))\n\tlet dataInstalacao = consultMaquina[0].dataInstalacao\n\n\n\t// Criando um objeto Date com a data fornecida\n\tconst dataObj = new Date(dataInstalacao);\n\n\t// Obtendo os componentes da data\n\tconst dia = String(dataObj.getDate()).padStart(2, '0');\n\tconst mes = String(dataObj.getMonth() + 1).padStart(2, '0'); // Os meses começam do zero, então somamos 1\n\tconst ano = dataObj.getFullYear();\n\n\t// Criando a string no formato desejado: DD/MM/YYYY\n\tconst dataFormatada = `${dia}/${mes}/${ano}`;\n\n\n\treturn dataFormatada;\n}\n\n","inputVariables":["consultMaquina","numeroSerie"],"outputVariable":"dataInstalacao","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85fd4b6a-c3fb-4d4c-b576-978af3f1de83","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"df93c738-b6f9-4397-b7d0-e675bb78c31a","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-36672bf5-0c57-4716-aa38-bbfce860359b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0f9ed64d-b02a-4892-80a5-2e43c58d0ecd","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8ed3a68d-a07a-4714-9b3a-d60394e38791","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","root":false,"$title":"[TC.4.5.1][MSG][SET] Comprada","$position":{"top":"1696px","left":"1114px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"bb74c3c9-73bc-4030-ae90-62acb134db5e":{"$contentActions":[{"action":{"$id":"97dd9187-fee3-4a51-8ce1-f30c52e74098","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0501d701-210e-4b5d-afcd-3ca0d770bbdb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0501d701-210e-4b5d-afcd-3ca0d770bbdb","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"91bfb221-581d-409a-8d4d-002d9b077ccc","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e69e16b4-16ee-473d-a011-60f82eb75eaf","type":"text/plain","content":"Encontrei aqui algumas máquinas. Qual delas você quer consultar? \n\nÉ só digitar o número da opção, exemplo: <b>1</b>.","metadata":{}},"$cardContent":{"document":{"id":"e69e16b4-16ee-473d-a011-60f82eb75eaf","type":"text/plain","content":"Encontrei aqui algumas máquinas. Qual delas você quer consultar? \n\nÉ só digitar o número da opção, exemplo: <b>1</b>."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"cf8612be-9289-42f4-87c1-91cc95bc07b2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6ffeca96-9efe-41fb-bb2f-eebc9d113d05","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{}},"$cardContent":{"document":{"id":"6ffeca96-9efe-41fb-bb2f-eebc9d113d05","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5cd2d31f-56e0-46fb-82e2-ec919b529fe4","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"text/plain","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f72881e8-f826-4b73-bc74-af0c6c5c0994","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8e0fcca7-a496-4ef1-a91b-2549e02cacfc","typeOfStateId":"state","$connId":"con_173","$id":"50f092bc-48ac-4223-81df-ccc2f3632da4","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"09b07a4f-c428-4128-b9cb-b8d9a45b0aa9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, tipoMaquina, modalidadeMaquina) {\n  try {\n\n    let consultMaquina = JSON.parse(consultMaquina);\n    consultMaquina = consultMaquina.data\n    let modalidadeMaquina = modalidadeMaquina.replace('Comprada', 'V')\n    var aux = '';\n    var count = 1;\n    if (modalidadeMaquina == 'V') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n    } else if (modalidadeMaquina != '') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n    }\n    consultMaquina.forEach(function (element) {\n      aux = aux.concat(\n        '<b>',\n        count,\n        '</b>',\n        ' - ',\n        'Número de série: ',\n        element.numeroSerie,\n        '\\n'\n      );\n      count++;\n    });\n\n    return aux;\n\n  }\n  catch (e) {\n    return e.message;\n  }\n\n}","inputVariables":["consultMaquina","tipoMaquina","modalidadeMaquina"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"372031cc-e467-405f-8c6c-fa19f48b6882","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sizeMaquinas\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, tipoMaquina, modalidadeMaquina) {\n  try {\n    let consultMaquina = JSON.parse(consultMaquina);\n    consultMaquina = consultMaquina.data\n    let modalidadeMaquina = modalidadeMaquina.replace('Comprada', 'V')\n    if (modalidadeMaquina == 'V') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n    } else if (modalidadeMaquina != '') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n    }\n\n    consultMaquina = consultMaquina.length\n    return consultMaquina\n  }\n  catch (e) {\n    return e.message;\n  }\n\n}","inputVariables":["consultMaquina","tipoMaquina","modalidadeMaquina"],"outputVariable":"sizeMaquinas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e789ac4a-274b-445a-9127-c69d64f88ed3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-00d71af6-bc10-4881-9617-ab1397feec75","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e94f3d06-f66e-4e19-95ff-33d60ef2e495","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1e7bb505-c20d-4155-a03b-98590fbf3a52","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bb74c3c9-73bc-4030-ae90-62acb134db5e","root":false,"$title":"[TC.4.4.0][MSG] Lista número S (Maquina< = 10)","$position":{"top":"1177px","left":"1521px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0f2ef715-e474-48e3-9642-ca975864c269":{"$contentActions":[{"action":{"$id":"5294280d-07d2-42ae-90ff-90f3dbaeb109","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8964c377-14ba-45be-8ae8-1fcb4702e8dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8964c377-14ba-45be-8ae8-1fcb4702e8dd","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"482b23f0-8236-4e5f-8eee-15753e98995d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"46e61ce3-25b9-467c-878d-e4ed4b4d2ac9","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. ","metadata":{}},"$cardContent":{"document":{"id":"46e61ce3-25b9-467c-878d-e4ed4b4d2ac9","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"778d041a-aed1-4440-9b45-f0f691cf4ee6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"fdf01824-3e78-47c0-9ff6-a1cc7374b189","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4df37b47-c05d-4694-9b73-7d0527269b0f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"<b>Taxas de Venda</b>                \n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x R${{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%","metadata":{}},"$cardContent":{"document":{"id":"368339fd-ff04-4381-88eb-10c104782801","type":"text/plain","content":"<b>Taxas de Venda</b>                \n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVistaEcommerce}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2Ecommerce}}%\n3x {{taxasExibir@taxaCreditoParc3Ecommerce}}%\n4x {{taxasExibir@taxaCreditoParc4Ecommerce}}%\n5x {{taxasExibir@taxaCreditoParc5Ecommerce}}%\n6x {{taxasExibir@taxaCreditoParc6Ecommerce}}%\n7x R${{taxasExibir@taxaCreditoParc7Ecommerce}}%\n8x {{taxasExibir@taxaCreditoParc8Ecommerce}}%\n9x {{taxasExibir@taxaCreditoParc9Ecommerce}}%\n10x {{taxasExibir@taxaCreditoParc10Ecommerce}}%\n11x {{taxasExibir@taxaCreditoParc11Ecommerce}}%\n12x {{taxasExibir@taxaCreditoParc12Ecommerce}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_178","$id":"d9f34647-5a72-4f73-833b-68361b143449","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"d50f971d-da7c-4c16-a789-c0bab627922e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-fcee469e-841c-442f-a5a5-0f6f120823e4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-00b2df13-f6eb-48f8-abd6-7de166e4aae5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"0f2ef715-e474-48e3-9642-ca975864c269","root":false,"$title":"Vendas Online - Amex e Hiper","$position":{"top":"2175px","left":"0px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"98c7523a-b7d2-49ab-bab8-c47926549497":{"$contentActions":[{"action":{"$id":"1422c9cd-20e9-43f8-a1cf-23213f562b0d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8f070433-fa9b-452c-80d7-c6bc09e47861","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8f070433-fa9b-452c-80d7-c6bc09e47861","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3a600043-9737-40a2-9ee5-75c4e433eb3e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"35572106-1712-407f-af0e-37e4f6eac4cc","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. ","metadata":{}},"$cardContent":{"document":{"id":"35572106-1712-407f-af0e-37e4f6eac4cc","type":"text/plain","content":"Identifiquei as taxas administrativas da bandeira {{taxCardFlag}}. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a8268dd6-051b-4645-be9c-6d892c9de125","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"},"metadata":{}},"$cardContent":{"document":{"id":"464e7155-32b8-4d20-99b5-a36cdc87e0d3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":"2000"}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ee0f713e-1ae3-4702-a494-79e02c4d66b2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"<b>Taxas de Venda</b>                \n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVista}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%","metadata":{}},"$cardContent":{"document":{"id":"bda2880e-1fb3-4256-bc1b-a378648f5ae4","type":"text/plain","content":"<b>Taxas de Venda</b>                \n\n<b>Crédito à vista</b> {{taxasExibir@taxaCreditoAVista}}%\n\n<b>Crédito parcelado</b>\n2x {{taxasExibir@taxaCreditoParc2}}%\n3x {{taxasExibir@taxaCreditoParc3}}%\n4x {{taxasExibir@taxaCreditoParc4}}%\n5x {{taxasExibir@taxaCreditoParc5}}%\n6x {{taxasExibir@taxaCreditoParc6}}%\n7x {{taxasExibir@taxaCreditoParc7}}%\n8x {{taxasExibir@taxaCreditoParc8}}%\n9x {{taxasExibir@taxaCreditoParc9}}%\n10x {{taxasExibir@taxaCreditoParc10}}%\n11x {{taxasExibir@taxaCreditoParc11}}%\n12x {{taxasExibir@taxaCreditoParc12}}%"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"d75d80be-8d8a-4598-91c3-378a699d59c1","typeOfStateId":"state","$connId":"con_183","$id":"f3ab5963-fad2-418e-b947-47b833541ed8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bd42b150-f365-444e-9f64-23b6d0d63000","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b7c5ce49-c354-4941-a128-f0f544fe3f0e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-59c8b642-d9c4-4175-b0c7-eb10e090c0b5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"98c7523a-b7d2-49ab-bab8-c47926549497","root":false,"$title":"Vendas Físicas - Amex e Hiper","$position":{"top":"2170px","left":"655px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"45ec8433-22a9-4498-8005-c3c52f7ce6bc":{"$contentActions":[{"action":{"$id":"b9fbbd09-86d7-4431-91f6-f7ac91644065","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ffee8e57-be55-4cc0-a112-feeb18c79b94","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ffee8e57-be55-4cc0-a112-feeb18c79b94","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6c0ee702-0049-4c0f-8017-a208c77d55ff","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b2ec0d82-b63d-40d7-aa6d-f5c8e49957a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"aece7772-1087-427c-9eb8-891be0b4a004","typeOfStateId":"state","$connId":"con_188","$id":"fbf59a0a-786f-42d6-bc61-d5bcf1913893","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b278a3b6-9248-46f6-b834-4ff244862109","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(salesType) {\n    try {\n        let buttons = [\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"1\",\n                    \"title\": \"Sim\"\n                }\n            },\n            {\n                \"type\": \"reply\",\n                \"reply\": {\n                    \"id\": \"2\",\n                    \"title\": \"Não\"\n                }\n            }\n        ];\n\n        const headerText = \"Vi que você ainda não tem máquina contratada.\\n\\nPosso te transferir para quem pode explicar sobre a contratação? \";\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"button\",\n                \"body\": {\n                    \"text\": headerText,\n                },\n                \"action\": {\n                    buttons\n                }\n            }\n        };\n    } catch (err) {\n        return false;\n    }\n}","inputVariables":["salesType"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c94dadc4-743e-44d7-ba34-264ff584ae59","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fafcc588-30c1-48f7-8b41-1dadd1eb991e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-384d1c37-f8ea-43b0-a5e2-e2dd30c8696d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-15bd1672-fd3f-4a72-b656-a51b41bf8033","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"45ec8433-22a9-4498-8005-c3c52f7ce6bc","root":false,"$title":"[TC.4.1.0][MSG] Sem máquinas","$position":{"top":"458px","left":"1761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ad3f23f8-0c79-4faf-8b19-06ad242f99d2":{"$contentActions":[{"action":{"$id":"e12d0d06-7509-418b-ac2f-84b356d4761a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"45f88241-67f6-49d1-af07-cce31df1729b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"45f88241-67f6-49d1-af07-cce31df1729b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"abac8db9-1511-4535-8d38-924e4159ae3c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"22627ad7-b029-4ce0-b056-669aa0056b4b","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso.","metadata":{}},"$cardContent":{"document":{"id":"22627ad7-b029-4ce0-b056-669aa0056b4b","type":"text/plain","content":"Só um instante, já te mostro as informações sobre isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a1463090-6db0-47f5-9840-36d1cd830c25","typeOfStateId":"state","$connId":"con_193","$id":"1c096d11-bece-4380-87e1-6a9548f52b86","conditions":[{"source":"context","comparison":"equals","values":["ok"],"variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bd714c8c-2ff9-4cc7-8429-5a3961c6fd4f","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyDomicilio\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/chat-assistente/safra-pay/v1/domicilios?idEstabelecimento={{selectedEc@codigoEc}}","responseStatusVariable":"statusDomicilio","responseBodyVariable":"bodyDomicilio"},"conditions":[]},{"$id":"dce0b682-29b3-4bd4-a5d2-0281e0e92aa6","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"bodyGeraldomicilio\"","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/vendas-servicos/vendas/prospeccoes-clientes/assistente-virtual/v1/domicilios-bancarios","responseStatusVariable":"statusGeraldomicilio","responseBodyVariable":"bodyGeraldomicilio"},"conditions":[{"values":["false"],"source":"context","comparison":"notEquals","variable":"config.domicilio"}]},{"$id":"33be0c9d-2737-4c6c-a42d-d9c1ff34656a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"53b45fe0-db24-41a8-9470-635a2852e6ed","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"tamanhoRetornoDomicilio\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(bodyDomicilio, bodyGeraldomicilio) {\n\ttry {\n\t\tbodyDomicilio = JSON.parse(bodyDomicilio);\n\t\tbodyGeraldomicilio = JSON.parse(bodyGeraldomicilio);\n\n\t\treturn {\n\t\t\t\"bodyDomicilio\": bodyDomicilio.data.length,\n\t\t\t\"bodyGeraldomicilio\": bodyGeraldomicilio.data.length,\n\t\t}\n\t}\n\tcatch (err) {\n\t\treturn {\n\t\t\t\"bodyDomicilio\": \"Erro\",\n\t\t\t\"bodyGeraldomicilio\": \"Erro\",\n\t\t\t\"Erro\":err.message\n\t\t}\n\t}\n}","inputVariables":["bodyDomicilio","bodyGeraldomicilio"],"outputVariable":"tamanhoRetornoDomicilio","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2715a04e-9d5b-44b1-ae72-982c20084006","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {{state.name}} tamanho array dados\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} tamanho array dados","action":"{{tamanhoRetornoDomicilio@bodyDomicilio}} | {{tamanhoRetornoDomicilio@bodyGeraldomicilio}} | {{tamanhoRetornoDomicilio@Erro}}"},"conditions":[]},{"$id":"798c3702-aeb0-47cb-92a5-6865bc4b579a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"b62f77b8-2628-4ec8-857f-d64e28419885","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"10ee88aa-626f-4d5b-bc04-d3bf795476b6","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["statusDomicilio","statusGeraldomicilio"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b0911b30-94ae-4a59-a3ae-94dc325eb5b8","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/chat-assistente/safra-pay/v1/domicilios?idEstabelecimento={{selectedEc@codigoEc}} | GET| {{statusDomicilio}} | {{bodyDomicilio}}"},"conditions":[]},{"$id":"ad84723e-b120-4601-a4c6-377e9c4b4fec","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo 2","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/vendas-servicos/vendas/prospeccoes-clientes/assistente-virtual/v1/domicilios-bancarios | GET| {{statusGeraldomicilio}} | {{bodyGeraldomicilio}}"},"conditions":[]},{"$id":"f6b63ed4-3911-440c-82b2-25701f49df7a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status","action":"{{statusDomicilio}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusDomicilio"}]},{"$id":"07b10c3c-dcd8-4862-b79f-cb7792976922","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} api status 2\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api status 2","action":"{{statusGeraldomicilio}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"statusGeraldomicilio"}]},{"$id":"5ca2da8a-8e49-43ae-8267-d150c25d2ff9","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"084765e8-1ee7-459e-9a3d-a356e6e09ad9","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-80ac3445-3c99-4c37-bb6f-f77eccdec94a","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-44becbc0-8478-472f-9c83-ae665791a9ba","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d9cd755e-8da6-4de2-8bc8-3fd486e3c31b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8b4d4a2c-e232-4415-ad1f-253d4332c34a","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-0a51700d-72f9-4f7b-97ef-49eac8acdbf1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"ad3f23f8-0c79-4faf-8b19-06ad242f99d2","root":false,"$title":"[TC.6.0.0][HTTP] API Domicilio bancario","$position":{"top":"400px","left":"2282px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c27acb8-d48a-43b9-a815-6af6e6f03405":{"$contentActions":[{"action":{"$id":"88aed0a0-43d2-4d36-910a-4e7bdbf49a67","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"0c4678d4-3738-41c2-bbe6-f0ac75df96f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"0c4678d4-3738-41c2-bbe6-f0ac75df96f9","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"6c6dd78c-ae47-4b08-8fd6-aaef38f45cd3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"99051f01-5b28-4243-b392-538a42c6038e","type":"text/plain","content":"Veja onde serão creditados os pagamentos feitos com a bandeira <b>{{taxCardFlag}}</b>.\n\n<b>Crédito</b>\n\nBanco: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}","metadata":{}},"$cardContent":{"document":{"id":"99051f01-5b28-4243-b392-538a42c6038e","type":"text/plain","content":"Veja onde serão creditados os pagamentos feitos com a bandeira <b>{{taxCardFlag}}</b>.\n\n<b>Crédito</b>\n\nBanco: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75e170b4-92d5-40c1-a211-a754270514c6","typeOfStateId":"state","$connId":"con_198","$id":"d974cc08-c322-44c8-9734-52dd8029267f","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"40cc6e05-124c-4839-836b-43aa75b01b0b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4b0eb8d5-3ef3-4316-9faf-32741faa9ec2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-6f763f19-1626-4933-aa89-d6b583fbb2ab","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"8c27acb8-d48a-43b9-a815-6af6e6f03405","root":false,"$title":"[TC.6.1.1][MSG] Exibir Taxas Crédito","$position":{"top":"1129.89px","left":"1902px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b5f695eb-d85d-45fd-bb2e-20d377d958dd":{"$contentActions":[{"action":{"$id":"5730f73d-45aa-4c87-97f2-941c88f20bd2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"cf427407-3a18-4775-9216-7a99336c2fb1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"cf427407-3a18-4775-9216-7a99336c2fb1","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"128a4e69-277c-42fa-8f65-8b34ee83fedb","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cce9f01a-6302-412a-93bb-f8454dd65f7d","type":"text/plain","content":"Veja onde serão creditados os pagamentos feitos com a bandeira <b>{{taxCardFlag}}</b>.\n\n<b>Débito</b>    \n  \nBanco: {{domicilioDados@nomeBanco1}}\nAgência:{{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                             \n                              \n<b>Crédito</b>                  \n\nBanco: {{domicilioDados@nomeBanco2}}\nAgência: {{domicilioDados@codigoAgencia2}}\nConta Corrente: {{domicilioDados@contaCorrente2}}-{{domicilioDados@codigoDigito2}}","metadata":{}},"$cardContent":{"document":{"id":"cce9f01a-6302-412a-93bb-f8454dd65f7d","type":"text/plain","content":"Veja onde serão creditados os pagamentos feitos com a bandeira <b>{{taxCardFlag}}</b>.\n\n<b>Débito</b>    \n  \nBanco: {{domicilioDados@nomeBanco1}}\nAgência:{{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                             \n                              \n<b>Crédito</b>                  \n\nBanco: {{domicilioDados@nomeBanco2}}\nAgência: {{domicilioDados@codigoAgencia2}}\nConta Corrente: {{domicilioDados@contaCorrente2}}-{{domicilioDados@codigoDigito2}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75e170b4-92d5-40c1-a211-a754270514c6","typeOfStateId":"state","$connId":"con_203","$id":"4685050e-7ceb-4328-b86b-ce847ec7e554","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4a7b6160-d93c-4dd3-a1ae-939c73e192df","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0850dbb2-fde3-42f6-bf1d-1fe9fab92820","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-62532d35-98e7-4191-9d6b-6463f5d82e6d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b5f695eb-d85d-45fd-bb2e-20d377d958dd","root":false,"$title":"[TC.6.1.2][MSG] Exibir Taxas Ambos","$position":{"top":"1144px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"871d092b-90c5-4e0e-afbb-023cdb94f094":{"$contentActions":[{"action":{"$id":"80173726-3262-4bce-b360-68ff43d9679c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"44954c06-7e1e-406f-830d-0da8009da4e0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"44954c06-7e1e-406f-830d-0da8009da4e0","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a4ea41e0-2f99-451d-9229-379b6925902c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e1958806-9dd6-49e1-85df-da631bf238c2","type":"text/plain","content":"Veja onde serão creditados os pagamentos feitos com a bandeira <b>{{taxCardFlag}}</b>.\n\n<b>Débito</b>                    \n\nBanco: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                            ","metadata":{}},"$cardContent":{"document":{"id":"e1958806-9dd6-49e1-85df-da631bf238c2","type":"text/plain","content":"Veja onde serão creditados os pagamentos feitos com a bandeira <b>{{taxCardFlag}}</b>.\n\n<b>Débito</b>                    \n\nBanco: {{domicilioDados@nomeBanco1}}\nAgência: {{domicilioDados@codigoAgencia1}}\nConta Corrente: {{domicilioDados@contaCorrente1}}-{{domicilioDados@codigoDigito1}}                                                            "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"75e170b4-92d5-40c1-a211-a754270514c6","typeOfStateId":"state","$connId":"con_208","$id":"114ac98b-129e-4455-8e12-350a3d43074c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"a7ce9db9-c492-49b5-906b-a4156915a769","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ad1e6769-6b72-48d8-acbb-76f9edde594e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-abfb9823-706e-460d-924c-ff9cc762a893","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"871d092b-90c5-4e0e-afbb-023cdb94f094","root":false,"$title":"[TC.6.1.3][MSG] Exibir Taxas Débito","$position":{"top":"1143.33px","left":"2638.56px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a9a96de6-7c5c-4625-8765-bd797a7e9c86":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"49787b51-0156-44fc-8565-77b607d79509","typeOfStateId":"state","$connId":"con_213","$id":"ed4b98d3-d6f8-4e76-9b69-fbeb08e72afd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c95438ca-ada8-4352-bc3d-48620479c866","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n    const invalidInputMessage = 'input inesperado';\n    try {\n        if (!inputUsuario) {\n            return 'inatividade';\n        }\n\n        let regex = /^(\\d{1,3}(\\.\\d{3})*|\\d+)(\\,\\d{1,2})?$/gmi;\n        let validInput = new RegExp(regex).test(inputUsuario);\n\n        if (validInput) {\n            return inputUsuario;\n        }\n        return invalidInputMessage;\n    } catch (err) {\n        return invalidInputMessage;\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"34019300-5d25-4ff2-98f8-b9d25d503ee0","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"valor\"","$invalid":false,"settings":{"variable":"exceptionType","value":"valor"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"8c3ab915-52f6-45d0-92ab-22c7133e3745","$typeOfContent":"","type":"SetVariable","$title":"Set \"valorCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"valorCobranca","value":"R$ {{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"99b1e8ad-0086-4a95-9fc8-bd03e20d5b10","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ce9800c9-f24b-454e-ba84-51c52e751181","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-cbe045ec-d12a-4005-9b54-d762d13b5d03","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-25b10f1a-2044-4a58-a1ff-90958a85d922","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1f2525a5-c83c-4084-8701-3978e978ce22","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-8bb17e4d-0d73-4f4f-834c-ed12e680e9d9","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a9a96de6-7c5c-4625-8765-bd797a7e9c86","root":false,"$title":"[TC.7.3.0][INPUT] Solicita valor da cobrança","$position":{"top":"2661px","left":"3068.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f676f5a4-86d1-4e05-a2b8-485b8dd91725":{"$contentActions":[{"action":{"$id":"5506b830-1b9b-4ca6-89fa-06039b587e70","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d73b6cc2-9e25-4b12-97af-7d6d54a53677","$typeOfContent":"text","type":"SendMessage","settings":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Agora, informe a data da compra, como neste exemplo:\n{{currentDate}}","metadata":{}},"$cardContent":{"document":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Agora, informe a data da compra, como neste exemplo:\n{{currentDate}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7bf80e9d-79e9-4578-acba-c963f814037e","typeOfStateId":"state","$connId":"con_218","$id":"07dead61-4794-4857-95f0-1beaaa14e586","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8f6bbd3f-4073-4bf6-9597-ad195981452b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-49b96ca5-8681-4612-b0e6-b89bbe99ec91","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1a94a269-6bac-46e1-b8d4-c3693a0d640f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f676f5a4-86d1-4e05-a2b8-485b8dd91725","root":false,"$title":"[TC.7.2.0][MSG] Solicita data da cobrança","$position":{"top":"1950.5px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"bbc18d76-6b5d-4a90-ad31-fcabb1586308":{"$contentActions":[{"action":{"$id":"7a84390c-d7bf-45b1-af5d-460041b6dd5a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"97cc80c5-b47b-4c1a-9d46-d05db5123273","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"97cc80c5-b47b-4c1a-9d46-d05db5123273","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"250e83be-d97c-4677-a1ab-6f7bc5fc71ec","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9cb5ee14-0641-4154-91a2-384720f31f85","typeOfStateId":"state","$connId":"con_223","$id":"288ee9a9-16a3-41fa-baf3-b580beaf0acd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"531aa867-6ced-4d5d-b2b7-a3f702c3ebdd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Aluguel\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"MDR\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"ARV\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Qual é a origem da cobrança?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a3fac0be-f389-4dc0-a30d-1fd3ddac1a97","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3dd955db-e436-4299-958a-422c29160013","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-dff248b9-99ce-4783-9c5f-1b99ef5689e2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f8ebd691-932c-46af-9635-e59fe85aa83c","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","root":false,"$title":"[TC.7.0.2][MSG] Origem da cobrança","$position":{"top":"887.571px","left":"3069px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e695d17c-2f37-44ac-9508-6986fb99b351":{"$contentActions":[{"action":{"$id":"c48e492f-0ae6-45b7-a511-cd0a79ec93ee","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ae8b5e52-a561-44e5-98d8-7c1c17f15ec8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ae8b5e52-a561-44e5-98d8-7c1c17f15ec8","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4d4404d0-777a-45ec-8b2a-10fb6c28cd88","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1d4c3b8a-0f56-437e-beec-2c5ba9efea28","typeOfStateId":"state","$connId":"con_228","$id":"98a6a3d9-9e3c-4464-ad66-768762d5fd76","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"905868b1-3dad-4266-a028-e8e981a0afc4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Conta Corrente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Agenda\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Certo, onde visualizou a cobrança?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b29a7541-0d10-4801-b01d-b444f13744fb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-34a3c6e0-cd85-44cf-876e-a0a9b4aa8983","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e444d830-0933-47ce-b246-c9e9a5098d03","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5a43944b-db5c-4642-a8ab-b5349f4fac49","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e695d17c-2f37-44ac-9508-6986fb99b351","root":false,"$title":"[TC.7.1.0][MSG] Onde visualizou a cobrança","$position":{"top":"1410px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"85c901f2-e8b4-49ca-97d4-e1becccc4cb1":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"cede0f5a-5453-45c2-a4fd-e95e478bdd14","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c7eb5b06-ca45-4d7e-be53-b9e17da7fd6d","type":"Redirect","$title":"Redirect to {service} sending {state@lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f3ee8298-43f5-4c77-bd25-2051cb240748","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"85c901f2-e8b4-49ca-97d4-e1becccc4cb1","root":false,"$title":"[Redirect] To cascata","$position":{"top":"21.6667px","left":"462.333px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"59d0589a-4bfe-427b-bcc3-37affdafab98":{"$contentActions":[{"action":{"$id":"7b152004-8a47-4677-b19b-7ef84b9c72c4","$typeOfContent":"text","type":"SendMessage","settings":{"id":"bcdbce09-279f-438b-b1bd-b5d41903e9b5","type":"text/plain","content":"A taxa administrativa (MDR) é cobrada sobre as transações realizadas de forma física (em uma máquina de cartão) ou de forma online (link de pagamento) tanto no crédito quanto no débito.","metadata":{}},"$cardContent":{"document":{"id":"bcdbce09-279f-438b-b1bd-b5d41903e9b5","type":"text/plain","content":"A taxa administrativa (MDR) é cobrada sobre as transações realizadas de forma física (em uma máquina de cartão) ou de forma online (link de pagamento) tanto no crédito quanto no débito."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1cb8a46a-308e-4c07-8d8a-f0476c022498","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d82acf75-4b40-4e5c-a926-6e507dac5f6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d82acf75-4b40-4e5c-a926-6e507dac5f6b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"86f79972-a169-4480-babb-4261f1b5a4f4","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"action":{"$id":"4d8a8eab-bedf-4943-8b9d-cc66c82d45c2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9b17c3aa-f9c2-4025-95d3-d4be61e16f01","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9b17c3aa-f9c2-4025-95d3-d4be61e16f01","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b38e7f6a-5a97-4966-ba49-f9b7915d436e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"4dfbe4df-5b62-4c68-9130-ab7ccec1756b","typeOfStateId":"state","$connId":"con_233","$id":"ece7e9ed-eee5-4361-abdc-46680eebb110","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"43c3a7b6-6035-4c73-b26a-1dece10ecbee","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tlet defaultMenuOptions = [\n\t\t\t{\n\t\t\t\t\"id\": \"1\",\n\t\t\t\t\"title\": \"Master\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"2\",\n\t\t\t\t\"title\": \"Visa\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"3\",\n\t\t\t\t\"title\": \"Elo\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"4\",\n\t\t\t\t\"title\": \"Amex\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"id\": \"5\",\n\t\t\t\t\"title\": \"Hiper\"\n\t\t\t}\n\t\t]\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"list\",\n\t\t\t\t\"header\": {\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"\"\n\t\t\t\t},\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": `Posso te mostrar as taxas administrativas da máquina que você usa.\n\nDe qual bandeira você quer ver? `\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\t\"button\": \"Selecionar bandeira\",\n\t\t\t\t\t\"sections\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"title\": \"\",\n\t\t\t\t\t\t\t\"rows\": defaultMenuOptions\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (err) {\n\t\treturn err.message;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"99120e14-d345-44e3-baf8-0e6d1e8d7d6d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2ac088be-4bd4-4283-a37d-724682344a26","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-cff08781-e467-41f0-9e51-5088af9a06dc","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1e105a7d-6db1-445d-a439-f9a1bf5909f6","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"59d0589a-4bfe-427b-bcc3-37affdafab98","root":false,"$title":"[TC.2.0.1] [MSG] Selecao Bandeira","$position":{"top":"631px","left":"322px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"313d8fd3-b86e-48a6-91d5-803adf2aa7d6":{"$contentActions":[{"action":{"$id":"b00b58af-c4a0-4b88-acc6-bfd375877d98","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"87cd5126-0e6d-401b-8e15-fc57f4b1139f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3541272-a652-4112-9a0f-665d23c0136e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e912e94c-247f-4ad6-abec-f42562d981a0","typeOfStateId":"state","$connId":"con_238","$id":"2dd516a5-7698-42c9-9e4b-a732f67c3279","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc6afd4-c708-460d-842d-5021f952c686","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Vendas Online\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Vendas Física\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Você tem duas modalidades de vendas habilitadas.\\n\\nQual você quer consultar?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a9e89828-78fd-4d85-9b99-0e6f16e11dc7","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f608f5cf-d18c-4e77-9df3-b3ef1f302e52","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-2b4f3aa9-af30-47bf-92b1-ea440181993b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-33e732d5-66c1-4438-b3a2-62c9130c23b3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"313d8fd3-b86e-48a6-91d5-803adf2aa7d6","root":false,"$title":"[TC.2.0.2][MSG] Modalidade de venda","$position":{"top":"1090.43px","left":"293.357px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d75d80be-8d8a-4598-91c3-378a699d59c1":{"$contentActions":[{"action":{"$id":"63ffff3b-b00e-46a0-bdef-4647bb008ae0","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"303cfc97-f485-485d-b20c-26afb9569905","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"303cfc97-f485-485d-b20c-26afb9569905","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5a9fe635-ca3b-454d-a94c-d284431b325e","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f45b6fd7-48d0-4900-a660-0a1d2a5afa4b","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"21b3d22d-2312-4cff-a73c-ae1b6746e33e","typeOfStateId":"state","$connId":"con_243","$id":"76dbdd35-3211-4aad-ac6d-633aa12b1051","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"47aab5e5-83a4-43a0-bb83-13da9057c8b0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = \"Você quer ver as taxas de outra bandeira?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fecb3166-b76a-4d3f-83d2-9f1e5bc14837","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-63b1cd75-1e38-4144-be2f-16904f6e85dc","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9051425a-d737-4246-bb1b-19dc7e5182b7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7199876d-537b-48aa-b370-19a91ce884f1","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"d75d80be-8d8a-4598-91c3-378a699d59c1","root":false,"$title":"[TC.2.1.0][MSG] Selecionar outra bandeira","$position":{"top":"2222.24px","left":"317.121px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"21b3d22d-2312-4cff-a73c-ae1b6746e33e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c12d2d8f-bda5-4363-a9eb-46662315b7ee","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e8951280-a57e-494d-851d-140dbca41a1e","typeOfStateId":"state","$connId":"con_248","$id":"fc8a046a-31c9-431c-9b8b-97fefe95b232","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"a65258c3-241a-4ab6-94b7-d3b0cfdb7ccd","typeOfStateId":"state","$connId":"con_253","$id":"be379e42-cdaa-4cda-b698-77abfd0d3439","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f3f13f29-3b2b-445d-a0fb-b7b74579cd8a","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const validInputMessage = \"Input inesperado\"\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    const regexDictionary = {\n      \"n[ãa]o|naum\": \"Não\",\n      \"sim|sin\": \"Sim\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return validInputMessage\n  } catch (err) {\n    return validInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e475018a-0819-41ec-9389-84a2334b2919","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"c46b65a2-9c94-4ee2-ae4e-a973b40a5618","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"3fa94059-5bc1-4a18-a151-3fe461a3d034","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-8c886087-47cd-45c9-b8cb-d69d95bb1d2b","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7e78144f-f91f-40f6-b37f-3873162c12e1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-da4ccf00-d70f-4fbb-867f-c886f3590f24","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-1a396ac9-72a8-4828-8582-60c8a150061b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"21b3d22d-2312-4cff-a73c-ae1b6746e33e","root":false,"$title":"[TC.2.1.0][INPUT] Selecionar outra bandeira","$position":{"top":"2493.29px","left":"317.071px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8951280-a57e-494d-851d-140dbca41a1e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a7108ccd-d976-4326-8820-7ccb9966b66e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"59d0589a-4bfe-427b-bcc3-37affdafab98","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e8951280-a57e-494d-851d-140dbca41a1e","root":false,"$title":"[GO TO] TC.2.0.1 Selecao Bandeira","$position":{"top":"2708.13px","left":"34.913px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9262b032-7ea2-45d2-b782-2649ddad61b9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"582ae6c9-728b-49d6-afb5-8af40ffe3320","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"9262b032-7ea2-45d2-b782-2649ddad61b9","root":false,"$title":"[GO GO] Redirect to Finalizacao","$position":{"top":"4001px","left":"484px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c07b1d82-9004-40cc-a93c-f0cabb17f9a7":{"$contentActions":[{"action":{"$id":"cb570a41-fc3b-4cbc-90be-16858e4c3eb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8bbd06a9-445f-4628-9901-cdf7a46d11a9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ddc5af8f-9630-479a-8623-8b37698ab647","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b8de541a-4234-4125-9502-46ade2ce536a","typeOfStateId":"state","$connId":"con_258","$id":"032ea9f2-4db4-4fd4-8520-500616ef7b9a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bc28845d-702b-47ec-91a2-ae6432e7b336","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada);\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t},\n\t\t];\n\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tbuttons = buttons.filter((reply) => reply.reply.title !== 'Falar com gerente');\n\t\t}\n\n\t\tconst headerText = \"Você pode contratar a antecipação automática e receber suas vendas na hora, ou em até um dia. \\n\\nGostaria de aproveitar e contratar? \";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c914f7a1-0280-46c0-9ddd-7171ddfa515a","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-857f909a-74d1-4d0f-a7df-87cd30117415","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-3cfda73b-4c10-4e56-a90f-404b0d4d402c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0fc369ef-6637-4db9-b230-d6fecb7e09c9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c07b1d82-9004-40cc-a93c-f0cabb17f9a7","root":false,"$title":"[TC.2.2.1][MSG] Consultar Taxas","$position":{"top":"2918.35px","left":"349.435px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c950fde0-4616-49b2-9f39-a0ba859beab4":{"$contentActions":[{"action":{"$id":"cb570a41-fc3b-4cbc-90be-16858e4c3eb5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"bebac43a-3e93-4b95-95e4-a2ab2acb3046","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"8bbd06a9-445f-4628-9901-cdf7a46d11a9","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ddc5af8f-9630-479a-8623-8b37698ab647","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"6159148f-ca32-497c-a843-838a5bc20b0e","typeOfStateId":"state","$connId":"con_263","$id":"7ede612e-ed6f-4c1d-88c6-f9d9e142e389","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"bc28845d-702b-47ec-91a2-ae6432e7b336","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ver taxas\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = `Por aqui, também posso te mostrar as *taxas de antecipação*. \n\nO que você gostaria de fazer?`;\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"7c7a590f-a499-432a-8137-85bc594d397d","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a4e0d687-c2a0-47db-89c7-9889d6995e93","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ae10b8ff-291e-49ca-a8d5-46ed3033e1d8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-83772a32-7ecd-4d19-ab44-b02330908511","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c950fde0-4616-49b2-9f39-a0ba859beab4","root":false,"$title":"[TC.2.2.2][MSG] Taxa atual","$position":{"top":"2930px","left":"908px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ba86d697-73e1-47ee-9a6a-0c58a46a207b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"07d40eca-e745-4092-bc11-bf6444a7a197","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ba86d697-73e1-47ee-9a6a-0c58a46a207b","root":false,"$title":"[GO TO] Redirect Atendimento Humano","$position":{"top":"3489px","left":"555px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e1923532-1bfa-4ab5-8de3-6eba5248bfa6":{"$contentActions":[{"action":{"$id":"2e9a6cda-a31d-442e-80cb-22546f176fcf","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6b9efbfa-cbfc-4a4c-a973-38023c32e235","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6b9efbfa-cbfc-4a4c-a973-38023c32e235","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a63fd407-f2dc-4b78-bc77-b5f5a72f1d6f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"efe77ef5-87d2-444e-9b46-bca0e9c012ca","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"17828cf7-5217-4cf1-bf9e-1393e96afaac","typeOfStateId":"state","$connId":"con_268","$id":"ee82c8ec-1c5e-40b1-88c7-a0586afd0ec0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"f2a2f1cf-22af-4e91-84c3-5ff5677f11ef","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n\ttry {\n\t\tconst buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Sim\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Não\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tconst headerText = `Gostaria de falar com um de nossos atendentes e conhecer mais?`;\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":[],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2c6c4e3e-7ba4-4a20-93c2-a40a67e3bfbb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-bc6d878f-365a-49fa-8e33-8d93e6be8a3f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0e8fd327-2d9e-4884-a7c0-4235be4da15d","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5354fee6-af1f-42ef-8fdf-b4dc36fba63d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"e1923532-1bfa-4ab5-8de3-6eba5248bfa6","root":false,"$title":"[TC.2.2.3][MSG] Questionar Transferência","$position":{"top":"3747px","left":"1172px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a1463090-6db0-47f5-9840-36d1cd830c25":{"$contentActions":[{"action":{"$id":"83e94468-aa05-4776-ad63-5972bf36598e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"150cd459-36ad-41eb-a7fc-e6c9d20e5d5b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"150cd459-36ad-41eb-a7fc-e6c9d20e5d5b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c45f0565-6dbc-40bf-977a-551769a50d76","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c13070f5-3f89-4975-90ec-c628e04a66ce","typeOfStateId":"state","$connId":"con_273","$id":"45492c8e-9956-43e8-ad06-63a1a6bc42be","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8622daec-b61a-4065-924a-263f45fe99d5","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyDomicilio) {\n  try {\n    // Mapeamento de correção de texto para bandeiras\n    const correcaoTexto = {\n      \"ELO \": \"Elo\",\n      \"MCRD\": \"Master\",\n      \"VISA\": \"Visa\",\n      \"AMEX\": \"Amex\",\n      \"HIPR\": \"Hiper\"\n    };\n\n    // Filtrar os dados conforme as condições\n    let bodyDomicilio = JSON.parse(bodyDomicilio)\n    let bandeirasFiltradas = {};\n    bodyDomicilio.data.forEach(item => {\n      if (correcaoTexto[item.codigoBandeira] && (item.codigoProduto === '01' || item.codigoProduto === '02')) {\n        bandeirasFiltradas[item.codigoBandeira] = correcaoTexto[item.codigoBandeira];\n      }\n    });\n\n    // Preencher o menu com as bandeiras filtradas\n    let defaultMenuOptions = [];\n    for (const key in bandeirasFiltradas) {\n      defaultMenuOptions.push({\n        \"id\": key,\n        \"title\": bandeirasFiltradas[key]\n      });\n    }\n\n    return {\n      \"recipient_type\": \"individual\",\n      \"type\": \"interactive\",\n      \"interactive\": {\n        \"type\": \"list\",\n        \"header\": {\n          \"type\": \"text\",\n          \"text\": \"\"\n        },\n        \"body\": {\n          \"text\": `Posso te mostrar em qual conta suas vendas serão creditadas.\n\nQual seria a bandeira? `\n        },\n        \"action\": {\n          \"button\": \"Ver opções\",\n          \"sections\": [\n            {\n              \"title\": \"\",\n              \"rows\": defaultMenuOptions\n            }\n          ]\n        }\n      }\n    }\n  } catch (err) {\n    return err.message;\n  }\n}","inputVariables":["bodyDomicilio"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"fd74f320-ccff-43b5-b472-f83f33f25dec","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-fd8c2b1f-a65f-4956-a061-10be8723de73","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-1d37857f-33ff-40d9-825e-28a1aa38fef4","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4acf4127-3324-4935-8ca3-1c559f9a7f47","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a1463090-6db0-47f5-9840-36d1cd830c25","root":false,"$title":"[TC.6.1.0][MSG] Selecionar bandeira","$position":{"top":"636px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c13070f5-3f89-4975-90ec-c628e04a66ce":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"7aebb419-33f3-45b5-b419-e07f22807255","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"b5f695eb-d85d-45fd-bb2e-20d377d958dd","typeOfStateId":"state","$connId":"con_278","$id":"12e772c0-ad73-43a7-b064-1ee63332a2ac","conditions":[{"source":"context","comparison":"equals","values":["Ambos"],"variable":"domicilioDados@codigoProduto"},{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"8c27acb8-d48a-43b9-a815-6af6e6f03405","typeOfStateId":"state","$connId":"con_283","$id":"28f12109-2549-4963-a5b5-3a420c79f59c","conditions":[{"source":"context","comparison":"equals","values":["Crédito"],"variable":"domicilioDados@codigoProduto"},{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"871d092b-90c5-4e0e-afbb-023cdb94f094","typeOfStateId":"state","$connId":"con_288","$id":"7e85cde1-1409-4caf-bb85-559af437d35c","conditions":[{"source":"context","comparison":"equals","values":["Débito"],"variable":"domicilioDados@codigoProduto"},{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"25dc5f69-8be6-4e53-928a-b8a814402c0d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"Master\": \"Master\",\n      \"Visa\": \"Visa\",\n      \"Elo\": \"Elo\",\n      \"Amex\": \"Amex\",\n      \"Hiper\": \"Hiper\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e53ed1eb-46d7-4aed-b17f-4021e8926240","$typeOfContent":"","type":"SetVariable","$title":"Set \"taxCardFlag\"","$invalid":false,"settings":{"variable":"taxCardFlag","value":"{{userInput}}"},"conditions":[]},{"$id":"704405c6-b4b7-4cf7-9b10-e8e0290a06df","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"c5e8a7ff-b292-4479-a667-d6589d6fb73f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"domicilioDados\"","$invalid":false,"settings":{"function":"run","source":"function run(bodyDomicilio, bodyGeralDomicilio, bandeira) {\n    try {\n        const bodyDomicilioObj = JSON.parse(bodyDomicilio);\n        const bodyGeralDomicilioObj = JSON.parse(bodyGeralDomicilio);\n        let codigoBandeira = bandeira.toUpperCase();\n        codigoBandeira = codigoBandeira.replace('MASTER', 'MCRD').replace('VISA', 'VISA').replace('HIPER', 'HIPR').replace('ELO', 'ELO').replace('AMEX', 'AMEX');\n\n        const getDomicilioDataPorBandeira = (codigoBandeira, propriedade) => {\n            const filteredData = bodyDomicilioObj.data.filter(item =>\n                item.codigoBandeira.trim() == codigoBandeira.trim() &&\n                (item.codigoProduto == \"01\" || item.codigoProduto == \"02\")\n            );\n\n            return filteredData.map(item => {\n                if (propriedade == 'banco') {\n                    return item.domicilio[propriedade].replace(/^0+/, '').padStart(3, '0') || null;\n                }\n                if (propriedade == 'codigoProduto') {\n                    return item[propriedade] || 'null';\n                }\n                return item.domicilio[propriedade] || 'null';\n            });\n        }\n        const getNomeBancoPorCodigo = (codigoBanco) => {\n            return codigoBanco.map(codigo => {\n                const banco = bodyGeralDomicilioObj.data.find(item => item.codigo === codigo);\n                return banco ? banco.nome : null;\n            });\n        }\n\n        let domicilioDados = {};\n        const codigoProduto = getDomicilioDataPorBandeira(codigoBandeira, 'codigoProduto');\n        const codigosBanco = getDomicilioDataPorBandeira(codigoBandeira, 'banco');\n        const codigosAgencia = getDomicilioDataPorBandeira(codigoBandeira, 'agencia');\n        const codigosContaCorrente = getDomicilioDataPorBandeira(codigoBandeira, 'contaCorrente');\n        const codigosDigito = getDomicilioDataPorBandeira(codigoBandeira, 'digitoContaCorrente');\n        const nomesBanco = getNomeBancoPorCodigo(codigosBanco);\n\n        for (let i = 0; i < codigosBanco.length; i++) {\n            domicilioDados[`codigoBanco${i + 1}`] = codigosBanco[i];\n        }\n        for (let i = 0; i < codigosAgencia.length; i++) {\n            domicilioDados[`codigoAgencia${i + 1}`] = codigosAgencia[i].replace(/^0+/, '');\n        }\n        for (let i = 0; i < codigosDigito.length; i++) {\n            domicilioDados[`codigoDigito${i + 1}`] = codigosDigito[i];\n        }\n        for (let i = 0; i < nomesBanco.length; i++) {\n            domicilioDados[`nomeBanco${i + 1}`] = nomesBanco[i];\n        }\n        for (let i = 0; i < codigosContaCorrente.length; i++) {\n            domicilioDados[`contaCorrente${i + 1}`] = codigosContaCorrente[i].replace(/^0+/, '');\n        }\n        if (codigoProduto.includes(\"01\") && codigoProduto.includes(\"02\")) {\n            domicilioDados.codigoProduto = \"Ambos\";\n        }\n        else if (codigoProduto.includes(\"02\")) {\n            domicilioDados.codigoProduto = \"Crédito\";\n        } else if (codigoProduto.includes(\"01\")) {\n            domicilioDados.codigoProduto = \"Débito\";\n        }\n        return domicilioDados;\n\n    } catch (err) {\n        return err.message;\n    }\n}","inputVariables":["bodyDomicilio","bodyGeralDomicilio","taxCardFlag"],"outputVariable":"domicilioDados","LocalTimeZoneEnabled":false},"conditions":[{"values":["Visa","Master","Elo","Hiper","Amex"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"05a8fce7-4994-4940-a879-29def9504887","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"43cc4036-13c4-4808-9326-a488da59d88b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f3b955d6-814d-4ee7-b4fe-9661bb780f87","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ff364979-6b44-4c07-ac11-9a7c59b8f939","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fab4d5ec-f5df-4389-b270-b321d808a257","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0e4433d6-3f04-4615-807e-1d545fd240c7","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"c13070f5-3f89-4975-90ec-c628e04a66ce","root":false,"$title":"[TC.6.1.0][INPUT] Selecionar bandeira","$position":{"top":"860px","left":"2282.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"75e170b4-92d5-40c1-a211-a754270514c6":{"$contentActions":[{"action":{"$id":"b00b58af-c4a0-4b88-acc6-bfd375877d98","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"77493d5b-9a1e-4064-ad0b-8a832afdf10d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"87cd5126-0e6d-401b-8e15-fc57f4b1139f","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3541272-a652-4112-9a0f-665d23c0136e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"006286b7-e8d7-4b83-9872-ad9d389e8b86","typeOfStateId":"state","$connId":"con_293","$id":"c09edcfb-0f9f-4f6a-8645-bf6d48a01006","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"efc6afd4-c708-460d-842d-5021f952c686","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"function run(contaSelecionada, tamanhoRetornoDomicilio) {\n\ttry {\n\t\tconst parsedContaSelecionada = JSON.parse(contaSelecionada);\n\t\tconst { bodyDomicilio } = JSON.parse(tamanhoRetornoDomicilio)\n\t\tlet buttons = [\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"1\",\n\t\t\t\t\t\"title\": \"Ver o menu incial\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"2\",\n\t\t\t\t\t\"title\": \"Falar com gerente\"\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"type\": \"reply\",\n\t\t\t\t\"reply\": {\n\t\t\t\t\t\"id\": \"3\",\n\t\t\t\t\t\"title\": \"Encerrar atendimento\"\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\tif (!parsedContaSelecionada.segmentoGerente) {\n\t\t\tbuttons = buttons.filter((reply) => reply.reply.title !== 'Falar com gerente');\n\t\t}\n\t\tif (bodyDomicilio > 1) {\n\t\t\tbuttons[0].reply.title = 'Ver outra bandeira'\n\t\t}\n\n\t\tconst headerText = \"Como deseja prosseguir?\";\n\t\treturn {\n\t\t\t\"recipient_type\": \"individual\",\n\t\t\t\"type\": \"interactive\",\n\t\t\t\"interactive\": {\n\t\t\t\t\"type\": \"button\",\n\t\t\t\t\"body\": {\n\t\t\t\t\t\"text\": headerText,\n\t\t\t\t},\n\t\t\t\t\"action\": {\n\t\t\t\t\tbuttons\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t} catch (err) {\n\t\treturn false;\n\t}\n}","inputVariables":["contaSelecionada","tamanhoRetornoDomicilio"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"0f33f515-fb87-4d9e-a1dd-91d3b3e1883f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-f99dea68-72a6-4c2c-a661-1b3a19765d24","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6ef04eff-07c0-4c29-be37-a7e6911892c8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-326234d0-41ab-4c9a-be42-c008ad4769d3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"75e170b4-92d5-40c1-a211-a754270514c6","root":false,"$title":"[TC.6.2.0][MSG] Prosseguir","$position":{"top":"1406.33px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"006286b7-e8d7-4b83-9872-ad9d389e8b86":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"06094d8f-981b-4ac3-a526-af631e3f4600","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"1bd26f72-4287-4f83-9213-ca282c18ab23","typeOfStateId":"state","$connId":"con_298","$id":"208d9650-9890-4f86-940a-353bc6ce531e","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"dc6146ef-b6d2-4944-bc07-4b32c8467bd9","typeOfStateId":"state","$connId":"con_303","$id":"5a064d2e-f3b8-4cf7-a334-512f56c018c9","conditions":[{"source":"context","comparison":"equals","values":["Ver outra bandeira"],"variable":"userInput"}],"$invalid":false},{"stateId":"7399f98b-a0d4-4892-901c-bb662285e254","typeOfStateId":"state","$connId":"con_308","$id":"5cf516a8-7b11-4ebc-9a2e-4bd74da495d3","conditions":[{"source":"context","comparison":"equals","values":["Falar com gerente"],"variable":"userInput"}],"$invalid":false},{"stateId":"c1345065-0a66-4d0e-886b-b7f53b6a74e4","typeOfStateId":"state","$connId":"con_313","$id":"7a0b45ce-8f54-43af-91e0-a6adcb1e1b5d","conditions":[{"source":"context","comparison":"equals","values":["Ver o menu incial"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"22544a01-53d2-4dcb-aced-ddb4bb463c2e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"c054b662-39ca-4707-92a1-404817bd887a","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"b5d2c7d5-7c3b-4597-b21a-a1584163b867","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"765886d2-9abd-4add-8e03-45e58b1d809b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Master","Visa","Elo","Amex","Hiper"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-4e8ffccc-fa6c-448f-8661-b5fe8fbf24a7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ab89ec0c-452d-4b2e-9cd5-3b1bf0dd8807","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-288a4588-b6ea-4f3c-9ac8-6fc81f08b074","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-09532c8e-0238-4381-a6e8-73489bedfb1b","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"006286b7-e8d7-4b83-9872-ad9d389e8b86","root":false,"$title":"[TC.6.2.0][INPUT] Prosseguir","$position":{"top":"1583.33px","left":"2283px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"1bd26f72-4287-4f83-9213-ca282c18ab23":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d646fbe5-ed8c-4f61-a3c0-d14fa2ff76e1","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"1bd26f72-4287-4f83-9213-ca282c18ab23","root":false,"$title":"[GO TO] Finalizacao","$position":{"top":"1947px","left":"2086.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"dc6146ef-b6d2-4944-bc07-4b32c8467bd9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e87965d8-8d76-4dd6-82df-338546e2c5eb","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"a1463090-6db0-47f5-9840-36d1cd830c25","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"dc6146ef-b6d2-4944-bc07-4b32c8467bd9","root":false,"$title":"[GO TO] TC.6.1.0 Selecionar bandeira","$position":{"top":"1929px","left":"2431px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"722bd745-fd0f-4ade-9937-852d7db9e165":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","typeOfStateId":"state","$connId":"con_318","$contentId":"b881df70-82f9-4f96-9e69-716b162fdb40","$id":"4f7480d3-8048-4b59-8455-ae5aedfbaef7","conditions":[{"source":"context","comparison":"equals","values":["Valor divergente"],"variable":"userInput"}],"$invalid":false},{"stateId":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","typeOfStateId":"state","$connId":"con_323","$contentId":"b881df70-82f9-4f96-9e69-716b162fdb40","$id":"2f99ccf7-df36-441d-ad0e-b5c793e89914","conditions":[{"source":"context","comparison":"equals","values":["Cobrança duplicada"],"variable":"userInput"}],"$invalid":false},{"stateId":"64033608-d1fe-4704-aebe-31662a651f61","typeOfStateId":"state","$connId":"con_328","$contentId":"b881df70-82f9-4f96-9e69-716b162fdb40","$id":"9a712681-4fac-4d7f-baa0-34fb7863e1fe","conditions":[{"source":"context","comparison":"equals","values":["Outros motivos"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"9409a2fd-7527-45fe-b569-22becbc867b8","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    let regexDictionary = {\n      \"valor divergente|valor\": \"Valor divergente\",\n      \"cobran[cç]a duplicada\": \"Cobrança duplicada\",\n      \"outros motivos|outros\": \"Outros motivos\"\n    }\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex]\n      }\n    }\n    return invalidInputMessage\n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"a0c0d83b-9bdb-4ebb-a5f2-300e12409057","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"b02e9c56-1603-4244-b2c6-792c3cedaa2e","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"b8c2902e-5b08-4ffd-880b-0e14b21ee87f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Valor divergente","Cobrança duplicada","Outros motivos"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e6da1c3d-7900-4e3d-9c17-8696a3aa8858","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a16d332a-b605-4d1d-a567-1753d585037f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-244fb421-800b-44df-9b0c-ac8383801962","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5a323075-0f92-4f6a-82f3-ae7c369f9467","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"722bd745-fd0f-4ade-9937-852d7db9e165","root":false,"$title":"[TC.7.0.0][INPUT] Questionar uma cobrança","$position":{"top":"673px","left":"3265.75px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"faf5caf6-e19a-42eb-9d38-2e4e58acae88":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"ea0411d0-285d-4394-bb28-7e700f3871d5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"bbc18d76-6b5d-4a90-ad31-fcabb1586308","typeOfStateId":"state","$connId":"con_333","$id":"b6242e51-095a-495f-bd48-1457612f253e","conditions":[{"source":"context","comparison":"notEquals","values":["inatividade"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"1e5a0305-f860-43b3-92ca-5ab64de4c1de","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado'\n  try {\n    if (!inputUsuario) {\n      return 'inatividade'\n    }\n    return inputUsuario\n    \n  } catch (err) {\n    return invalidInputMessage\n  }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"01f6aa41-2411-41e1-a1e4-5364dbde0813","$typeOfContent":"","type":"SetVariable","$title":"Set \"motivoChamado\" with userInput","$invalid":false,"settings":{"variable":"motivoChamado","value":"{{userInput}}"},"conditions":[]},{"$id":"0a63dbc9-395d-471a-a600-19d9db12e4f3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"f5613662-6e68-459f-b205-cedc2e836b52","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-d60bea26-b8b7-4074-93c1-c2893b51b959","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6dbb46b4-bbfb-409d-b221-f10aa42c7849","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4563dcb7-9e95-40df-8871-75bafd8c046b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4bc41ea2-363d-4eaf-9f84-f201dbf6c85a","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"faf5caf6-e19a-42eb-9d38-2e4e58acae88","root":false,"$title":"[TC.7.0.1][INPUT] Outro Motivo","$position":{"top":"1088px","left":"3547px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"9cb5ee14-0641-4154-91a2-384720f31f85":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e695d17c-2f37-44ac-9508-6986fb99b351","typeOfStateId":"state","$connId":"con_338","$id":"288ee9a9-16a3-41fa-baf3-b580beaf0acd","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bda34732-837d-43e2-ab6a-c26cfa80004d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tconst invalidInputMessage = 'input inesperado';\n\ttry {\n\t\tif (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst regexDictionary = {\n\t\t\t\"^aluguel$\": \"Aluguel\",\n\t\t\t\"^mdr$\": \"MDR\",\n\t\t\t\"^arv$\": \"ARV\"\n\t\t};\n\t\tfor (let regex in regexDictionary) {\n\t\t\tif (new RegExp(regex, 'i').test(inputUsuario)) {\n\t\t\t\treturn regexDictionary[regex];\n\t\t\t}\n\t\t}\n\t\treturn invalidInputMessage;\n\t} catch (err) {\n\t\treturn invalidInputMessage;\n\t}\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"452cb59f-11b3-49e9-b5cf-da9096835ee5","$typeOfContent":"","type":"SetVariable","$title":"Set \"origemCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"origemCobranca","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"6d2aaf40-ad2d-40a8-b4f5-7dca201fa403","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"275c4181-9284-4540-a618-de6d28fbefb4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"987328df-bfa7-4ef7-b39b-c5e03ac0aa7b","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Aluguel","MDR","ARV"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-62f4d949-f572-4998-bca2-7df03fdc34af","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7be7ead1-3a4a-43ab-a890-1efdef3bfbd6","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f1afe4cc-de09-40b0-a3f0-b2400f6ed918","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-39ce76fe-9aee-4d7c-a599-ed32c9c6fc5e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"9cb5ee14-0641-4154-91a2-384720f31f85","root":false,"$title":"[TC.7.0.2][INPUT] Origem da cobrança","$position":{"top":"1118.57px","left":"3069.29px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1d4c3b8a-0f56-437e-beec-2c5ba9efea28":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"59491125-e819-46e7-80c4-a3cb59697a47","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"f676f5a4-86d1-4e05-a2b8-485b8dd91725","typeOfStateId":"state","$connId":"con_343","$id":"98a6a3d9-9e3c-4464-ad66-768762d5fd76","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"bda34732-837d-43e2-ab6a-c26cfa80004d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n  const invalidInputMessage = 'input inesperado';\n  try {\n    if (!inputUsuario) {\n\t\t\treturn 'inatividade'\n\t\t}\n    const regexDictionary = {\n      \"^c[oó]nt[aá]\\\\s*c[oó]rr[eé]nt[eé]$\": \"Conta corrente\",\n      \"^ag[eé]nd[aá]$\": \"Agenda\"\n    };\n    for (let regex in regexDictionary) {\n      if (new RegExp(regex, 'i').test(inputUsuario)) {\n        return regexDictionary[regex];\n      }\n    }\n    return invalidInputMessage;\n  } catch (err) {\n    return invalidInputMessage;\n  }\n}\n","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"b77f2239-5e1d-4756-a5ab-f2aa237643d7","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"ce4db9f6-5647-4644-8abc-b0119d9e0493","$typeOfContent":"","type":"SetVariable","$title":"Set \"localVisualizacaoCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"localVisualizacaoCobranca","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"ce585957-fc6f-481c-a6b9-9b6331f4c0d9","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ac17e99c-87e2-4b0b-9811-e16136d70cc1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Conta Corrente","Agenda"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e621ec9a-f945-455a-9243-5038abd4b333","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-f5365b0d-bcf6-47d2-be52-a982d9d019dd","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c8768f08-94ff-44f5-b5a7-eb946691c78f","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-318e213b-6536-48f0-b8d2-efa416dc0293","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1d4c3b8a-0f56-437e-beec-2c5ba9efea28","root":false,"$title":"[TC.7.1.0][INPUT] Onde visualizou a cobrança","$position":{"top":"1685.57px","left":"3067.57px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7bf80e9d-79e9-4578-acba-c963f814037e":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"604db07f-4e0d-4909-aaef-d23754b5bc65","typeOfStateId":"state","$connId":"con_348","$id":"ef04e652-526a-411f-9385-a603df4c7b38","conditions":[{"source":"context","comparison":"notEquals","values":["input inesperado"],"variable":"userInput"},{"values":["inatividade"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c95438ca-ada8-4352-bc3d-48620479c866","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(data) {\n\ttry {\n\t\tif (!data) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tconst regex = /^(\\d{2})[\\/\\-]?(\\d{2})[\\/\\-]?(\\d{4})$/;\n\t\tif (!regex.test(data)) return 'input inesperado';\n\n\t\tlet dia = parseInt(data.substring(0, 2));\n\t\tlet mes = parseInt(data.substring(3, 5));\n\t\tlet ano = parseInt(data.substring(6, 10));\n\n\t\tif (dia < 1 || dia > 31) return 'input inesperado';\n\t\tif (mes < 1 || mes > 12) return 'input inesperado';\n\t\tif ((mes == 4 || mes == 6 || mes == 9 || mes == 11) && dia == 31) return 'input inesperado';\n\t\tif (mes == 2) {\n\t\t\tconst bissexto = (ano % 4 == 0 && (ano % 100 != 0 || ano % 400 == 0));\n\t\t\tif (dia > 29 || (dia == 29 && !bissexto)) return 'input inesperado';\n\t\t}\n\t\treturn dia.toString().padStart(2, '0') + '/' + mes.toString().padStart(2, '0') + '/' + ano;\n\t} catch (err) {\n\t\treturn 'input inesperado'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f7d7e70b-45f0-457f-89e9-82943b64c561","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"data\"","$invalid":false,"settings":{"variable":"exceptionType","value":"data"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"ccce0800-0113-4088-b71c-3aae12d436d0","$typeOfContent":"","type":"SetVariable","$title":"Set \"dataCobranca\" to \"{userInput}\"","$invalid":false,"settings":{"variable":"dataCobranca","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"d4776bf5-4b99-494e-a76c-049a18cd868f","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"734a31ab-a5a0-41df-8fcb-fe7031f3c55c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-791d927e-349c-4dc7-9f10-136e8e84949f","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-4614c751-add4-4c5f-81e4-63966605f4d5","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-4b658df0-c1a1-4354-8530-b794c4ff6771","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-850d8f39-4496-4785-abf6-068edde7b8e8","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7bf80e9d-79e9-4578-acba-c963f814037e","root":false,"$title":"[TC.7.2.0][INPUT] Solicita data da cobrança","$position":{"top":"2152px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"604db07f-4e0d-4909-aaef-d23754b5bc65":{"$contentActions":[{"action":{"$id":"5506b830-1b9b-4ca6-89fa-06039b587e70","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"4fdd0aaa-a27c-46b7-9b7f-2c9a90c3bef6","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"d73b6cc2-9e25-4b12-97af-7d6d54a53677","$typeOfContent":"text","type":"SendMessage","settings":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Por fim, informe o valor exato da cobrança, <b>como neste exemplo</b>: 3.500,00.","metadata":{}},"$cardContent":{"document":{"id":"756fb519-1456-4184-ae4d-116c43fafb54","type":"text/plain","content":"Por fim, informe o valor exato da cobrança, <b>como neste exemplo</b>: 3.500,00."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"cea78e8d-1507-414e-bf38-32e9e970fc57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a9a96de6-7c5c-4625-8765-bd797a7e9c86","typeOfStateId":"state","$connId":"con_353","$id":"73a052ad-a897-4086-af37-45c8bf7a56e3","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0f2b4506-1c0f-4e4a-a601-60a727e4d1ac","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4fe60eeb-dd81-41e2-8905-b8b2e938ff9b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7f1d77fe-4b7e-47db-9aab-a0c34a54ddaa","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"604db07f-4e0d-4909-aaef-d23754b5bc65","root":false,"$title":"[TC.7.3.0][MSG] Solicita valor da cobrança","$position":{"top":"2407.33px","left":"3068px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a93d6907-ae20-48eb-afeb-42de5c3bc9ba":{"$contentActions":[{"action":{"$id":"289f49df-035c-409b-b964-e77f22a2e773","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d535b8e5-e90f-468c-a07b-49e1714c77b5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d535b8e5-e90f-468c-a07b-49e1714c77b5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ac23b5d8-55c8-4e45-8cb9-7c5f919d8aa0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f8431b5c-018b-46fe-a5ae-d5ca83a2b909","type":"text/plain","content":"Obrigado por responder. Já enviei o seu pedido para  revisão.\n\nO protocolo deste atendimento é o {{idProtocoloBpm}}\n\nO prazo para análise é de até <b>4 dias úteis.</b>","metadata":{}},"$cardContent":{"document":{"id":"f8431b5c-018b-46fe-a5ae-d5ca83a2b909","type":"text/plain","content":"Obrigado por responder. Já enviei o seu pedido para  revisão.\n\nO protocolo deste atendimento é o {{idProtocoloBpm}}\n\nO prazo para análise é de até <b>4 dias úteis.</b>"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"37286ef7-791d-4af5-938f-fd2600482e21","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ce357aaf-62ad-433e-8e14-0695d22dd8c9","typeOfStateId":"state","$connId":"con_358","$id":"c5e218ce-0c5f-4d2a-b638-93dcb76cd382","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b6e6bd79-16cf-4654-b664-5d125d392d49","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-0c85614f-59c8-4aff-800d-e237c2028656","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4d96b3a7-7df5-4b1e-a1b0-0a276bfd4ddf","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a93d6907-ae20-48eb-afeb-42de5c3bc9ba","root":false,"$title":"[TC.7.5.0][MSG] Protocolo Criado","$position":{"top":"3097.67px","left":"3066.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"ce357aaf-62ad-433e-8e14-0695d22dd8c9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"667f8c27-83a8-46b6-a0d6-22f1f3aaf496","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"ce357aaf-62ad-433e-8e14-0695d22dd8c9","root":false,"$title":"[GO TO] Finalizacao ","$position":{"top":"3297.67px","left":"3067.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"aece7772-1087-427c-9eb8-891be0b4a004":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"b2ec0d82-b63d-40d7-aa6d-f5c8e49957a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"3eb16c87-6c3e-411d-b7ef-b9e49c13d2df","typeOfStateId":"state","$connId":"con_363","$id":"3db349a2-b3ca-4eec-b3f9-a644abf8841d","conditions":[{"source":"context","comparison":"equals","values":["Sim"],"variable":"userInput"}],"$invalid":false},{"stateId":"e40040f5-edd2-4063-b02c-b6d2d2490b53","typeOfStateId":"state","$connId":"con_368","$id":"e4631e8c-6545-4e15-aeb3-951eea10d7f0","conditions":[{"source":"context","comparison":"equals","values":["Não"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"7f43624c-b91c-4c93-af22-e9716ed292f1","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n  \n  function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { buttons } = JSON.parse(dynamicContent).interactive.action\n        buttons.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n            regexDictionary[key] = button.reply.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n  }","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"41261742-2361-4d4e-b1b3-066bb20246bb","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"47d922f8-1468-4475-a997-0eff3ac2f8cc","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"resolutividade\"","$invalid":false,"settings":{"variable":"pesquisa","value":"resolutividade"},"conditions":[]},{"$id":"7a818d3d-00c5-4aa1-b3dd-54cc5e6c2966","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"24a1bb27-405d-41eb-8989-88e0a045d857","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a957ce0c-5691-4dea-bd17-5ba692bf056e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-bcb0a993-b651-495b-9863-8622cad33b1c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-f1a343a6-5a79-4efe-8ca4-50b4acc39283","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5128bb84-f3b5-4003-8b20-50f57554b900","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"aece7772-1087-427c-9eb8-891be0b4a004","root":false,"$title":"[TC.4.1.0][INPUT] Sem máquinas","$position":{"top":"656px","left":"1761px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"62786aa5-df6a-4069-9147-36ff1377b02c":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"dfd199b8-ed5e-44e2-b226-65990f659223","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_373","$id":"85090cee-f4fc-479b-aac1-028aef06464b","conditions":[{"source":"context","comparison":"equals","values":["Aluguel","Alugada"],"variable":"modalidadeMaquina"},{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_378","$id":"edb80c29-d63b-4d76-8371-02ea5457feac","conditions":[{"source":"context","comparison":"equals","values":["Comprada","Compra"],"variable":"modalidadeMaquina"},{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"5bf2a0db-0d48-4d71-8e84-d22c890f3b21","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n    try {\n        if (!userInput) {\n            return 'inatividade'\n        }\n        const alphanumericRegex = /^\\w+$/;\n        if (alphanumericRegex.test(userInput)) {\n            return \"Valido\"\n        }\n        return \"Input inesperado\"\n    }\n    catch (e) {\n        return \"Input inesperado\";\n    }\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"811c5e0e-585b-4b14-b865-b5c64a1564e9","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"numeroSerie\"","$invalid":false,"settings":{"variable":"exceptionType","value":"numeroSerie"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"fb1a70e8-f34e-4dfa-b57c-716e389d29eb","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroSerie\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(userInput) {\n\ttry {\n\t\tuserInput = userInput.toString();\n\t\treturn `${userInput}`\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["input.content"],"outputVariable":"numeroSerie","LocalTimeZoneEnabled":false},"conditions":[{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"3916ceef-75b5-4956-8bd4-11a107c43e60","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"291f6c32-bbc4-4531-b3f3-38add7613d92","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3618431d-a573-4430-88c8-b6215a3aa079","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-a2b3c85f-f024-441c-b4a8-2955e23d546f","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-c9f25a08-bf54-441c-ae3a-748f226bd1ff","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-5053acfd-7cb1-455c-b2f0-7e66f79cd021","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"62786aa5-df6a-4069-9147-36ff1377b02c","root":false,"$title":"[TC.4.2.0][INPUT] Numero de Série","$position":{"top":"1462px","left":"927px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3468fd40-a03c-45dc-b438-f0066d5aee17":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"3576eedf-1d52-44fa-8018-41112a232738","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_383","$id":"490794ee-f656-48f1-8b54-03aa40ebe9ae","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["Alugada"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_388","$id":"958376d9-52a0-4f92-a0c0-d9e20f895648","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["Comprada"],"source":"context","comparison":"equals","variable":"userInput"}],"$invalid":false},{"stateId":"bb74c3c9-73bc-4030-ae90-62acb134db5e","typeOfStateId":"state","$connId":"con_393","$id":"5c557a36-cee0-437b-8115-4716988b35a1","conditions":[{"source":"context","comparison":"lessThanOrEquals","values":["10"],"variable":"sizeMaquinas"},{"values":["Aluguel","Comprada"],"source":"context","variable":"userInput","comparison":"equals"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d20490b5-904a-4416-a731-06ac23f66cca","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n  \n  function run(inputUsuario, dynamicContent) {\n    const posicoes = {\n        \"1\": \"primeir[oa]|u[mn]\",\n        \"2\": \"segund[ao]|do[ie]s\",\n        \"3\": \"terceir[ao]|tr[eê]s\"\n    }\n    try {\n        if (!inputUsuario) return 'inatividade'\n        const regexDictionary = {}\n        const { buttons } = JSON.parse(dynamicContent).interactive.action\n        buttons.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n            regexDictionary[key] = button.reply.title\n        })\n        for (let regex in regexDictionary) {\n            if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n                return regexDictionary[regex]\n            }\n        }\n        return 'input inesperado'\n    } catch (err) {\n        return 'input inesperado'\n    }\n  }","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"40e65a97-519f-4ef8-b4db-25c479101d3b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"9ef7b366-4cbf-4bbb-8790-e8a8befc0e8e","$typeOfContent":"","type":"SetVariable","$title":"Set \"modalidadeMaquina\"","$invalid":false,"settings":{"variable":"modalidadeMaquina","value":"{{userInput}}"},"conditions":[{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"74f7c8ea-d813-4e50-a691-98c71491c048","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sizeMaquinas\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, modalidadeMaquina) {\n  try {\n    let consultMaquina = JSON.parse(consultMaquina);\n    consultMaquina = consultMaquina.data\n    let modalidadeMaquina = modalidadeMaquina.replace('Comprada', 'V')\n    if (modalidadeMaquina == 'V') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n    } else if (modalidadeMaquina != '') {\n      consultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n    }\n    consultMaquina = consultMaquina.length\n    return consultMaquina\n  }\n  catch (e) {\n    return e.message;\n  }\n}","inputVariables":["consultMaquina","modalidadeMaquina"],"outputVariable":"sizeMaquinas","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"6baaa566-b9aa-4df4-b7d0-046529d05cd4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"bd0b215d-8c11-43ae-a726-c8bd1f911fbc","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Aluguel","Comprada"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-2fdb20d1-4085-4757-9ba5-f0a3455803e7","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-7dda9f01-3668-484e-9678-9dc7a0f3545c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-07f6b5ef-34aa-465e-9c63-331ae4ac9987","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9ad575f4-7ae4-4238-9ebc-801fad7dd12e","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"3468fd40-a03c-45dc-b438-f0066d5aee17","root":false,"$title":"[TC.4.3.0][INPUT] Alugada ou Comprada","$position":{"top":"988px","left":"1185px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"8e0fcca7-a496-4ef1-a91b-2549e02cacfc":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"f72881e8-f826-4b73-bc74-af0c6c5c0994","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_398","$id":"d7fb1924-201b-4e29-8f70-6e777f865a04","conditions":[{"values":["Valido"],"source":"context","comparison":"equals","variable":"userInput"},{"values":["Comprada"],"source":"context","comparison":"equals","variable":"modalidadeMaquina"}],"$invalid":false},{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_403","$id":"d38a6001-fe63-41df-bb96-bb9051d71203","conditions":[{"source":"context","comparison":"equals","values":["Valido"],"variable":"userInput"},{"values":["Aluguel","Alugada"],"source":"context","comparison":"equals","variable":"modalidadeMaquina"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"597789dd-9eee-4107-8355-8ea81ea0edb0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"\nfunction run(sizeMaquinas, userInput) {\n\ttry {\n\t\tif (!userInput) {\n\t\t\treturn 'inatividade'\n\t\t}\n\t\tlet selecao = parseInt(userInput)\n\t\tsizeMaquinas = parseInt(sizeMaquinas)\n\t\tif (selecao > sizeMaquinas) {\n\t\t\treturn \"Input inesperado\";\n\t\t}\n\t\tconst numericRegex = /^[1-9]+$/;\n\t\tif (numericRegex.test(userInput)) {\n\t\t\treturn \"Valido\"\n\t\t}\n\t\treturn \"Input inesperado\"\n\t}\n\tcatch (e) {\n\t\treturn \"Input inesperado\";\n\t}\n\n}","inputVariables":["sizeMaquinas","input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"95509247-703a-4126-a125-02246fc47f23","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"listaNumerica\"","$invalid":false,"settings":{"variable":"exceptionType","value":"listaNumerica"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"d1510921-7c4a-43c5-91ca-2295f39701b4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroSerie\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina, modalidadeMaquina, index) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina).data;\n\t\tif (modalidadeMaquina == 'Comprada') {\n\t\t\tconsultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'V')\n\t\t} else if (modalidadeMaquina != '') {\n\t\t\tconsultMaquina = consultMaquina.filter((modalidade) => modalidade.modalidade == 'A' || modalidade.modalidade == 'C')\n\t\t}\n\t\tlet numeroSerie = consultMaquina[index - 1].numeroSerie\n\t\treturn numeroSerie;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["consultMaquina","modalidadeMaquina","input.content"],"outputVariable":"numeroSerie","LocalTimeZoneEnabled":false},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"36f7b9e5-515e-4fd7-b7a3-1340b551f8eb","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"005b381c-b2a3-4491-827c-64597b4084c4","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-56de6a2a-8f83-4e9d-8c46-12193117f190","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e41ce384-8fee-42b6-b01f-5bc8e5da8756","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-e8f5372f-9571-4c1b-89d6-631ff8456a77","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-0ebd2a6a-4c2f-4ab5-af25-44d18bdc7578","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"8e0fcca7-a496-4ef1-a91b-2549e02cacfc","root":false,"$title":"[TC.4.4.0][INPUT] Lista número série","$position":{"top":"1858.75px","left":"1521px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e40040f5-edd2-4063-b02c-b6d2d2490b53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"efda90b4-9f46-480a-bb50-99aaa9fab7d3","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"e40040f5-edd2-4063-b02c-b6d2d2490b53","root":false,"$title":"[GO TO] Finalizacao   ","$position":{"top":"863px","left":"1861px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3eb16c87-6c3e-411d-b7ef-b9e49c13d2df":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"229f22dc-d3ef-4637-b03c-34bbe1bf1dcd","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5724999e-4ebb-443e-8b1d-4c15ef40251e","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"3eb16c87-6c3e-411d-b7ef-b9e49c13d2df","root":false,"$title":"[GO TO] Redirect WhatsApp PJ (atendente)","$position":{"top":"850px","left":"1663px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a987eb86-a520-4671-9e28-bcc98388eff4":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"73db3d78-b7a6-40d2-aed0-09ed45b00c7d","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"6509358e-b1fb-45d3-977c-cbf4b94cc5c4","typeOfStateId":"state","$connId":"con_408","$id":"e69b0346-b308-4615-abd4-6552913f322f","conditions":[{"source":"context","comparison":"equals","values":["Fazer nova consulta"],"variable":"userInput"}],"$invalid":false},{"stateId":"78b67e8d-1f89-44d8-955b-04e979597b42","typeOfStateId":"state","$connId":"con_413","$id":"9f7d87fe-79f3-4360-a478-690ad42d6183","conditions":[{"source":"context","comparison":"equals","values":["Encerrar atendimento"],"variable":"userInput"}],"$invalid":false},{"stateId":"963357f4-8de8-458d-afe0-50c1236f9d40","typeOfStateId":"state","$connId":"con_418","$id":"c8df77c9-a728-4c6f-bfdd-4e0270c0e481","conditions":[{"source":"context","comparison":"equals","values":["Falar com gerente"],"variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"dd68f93e-519d-433f-8787-edc0883dd5c8","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]}],"$leavingCustomActions":[{"$id":"61002fc4-da61-4953-b74d-595b0722758e","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction botao(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { buttons } = JSON.parse(dynamicContent).interactive.action\n      buttons.forEach((button, index) => {\n          const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.reply.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.reply.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction lista(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}\n\nfunction run(inputUsuario, dynamicContent) {\n  try {\n    if(!inputUsuario) {\n      return 'inatividade'\n    }\n    if (JSON.parse(dynamicContent).interactive.type === 'button') {\n        return botao(inputUsuario, dynamicContent)\n    } else {\n        return lista(inputUsuario, dynamicContent)\n    }\n  } catch (err) {\n    return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"bd2f427e-8424-4eed-b643-112de920d73f","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"quickReply\"","$invalid":false,"settings":{"variable":"exceptionType","value":"quickReply"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"298d04e9-0948-499c-abdd-9965c3c463af","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"39d726e0-bba1-4817-a15c-9f20d340a7a3","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":["Fazer outra consulta","Encerrar"],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-e198a5f9-d3fd-4e69-8b60-f16bb9abeee6","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-ec7dee64-c7f9-4d83-af04-3d424382f346","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d212fe08-5475-425f-9283-f05eec2cbf1d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-19f7d66b-0711-4bc3-9fa5-42a66e3f1f58","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a987eb86-a520-4671-9e28-bcc98388eff4","root":false,"$title":"[TC.4.6.0][INPUT] Como deseja prosseguir?","$position":{"top":"2578.5px","left":"1125.5px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"6509358e-b1fb-45d3-977c-cbf4b94cc5c4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c476535-bee3-4b71-acf9-506ce9c3db95","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"24ee326c-2f65-4cf1-944e-2b178eaf2a82","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"6509358e-b1fb-45d3-977c-cbf4b94cc5c4","root":false,"$title":"[GO TO] TC.4.0.0 Nova Consulta","$position":{"top":"2470px","left":"1436px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"78b67e8d-1f89-44d8-955b-04e979597b42":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17e3ccf6-6750-4341-81e5-fdbce4945d37","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"78b67e8d-1f89-44d8-955b-04e979597b42","root":false,"$title":"[GO TO] Finalizacao    ","$position":{"top":"2732px","left":"1430px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"820d335f-0c95-466f-9009-35cac24c6ea4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-69d162cc-8e4f-4452-b9f9-c80a0d8693ca","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-5f586412-a90b-47ee-8316-7a74eb9b3f59","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"820d335f-0c95-466f-9009-35cac24c6ea4","root":false,"$title":"[Redirect] To Finalizacao (Welcome)","$position":{"top":"0px","left":"957px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5724999e-4ebb-443e-8b1d-4c15ef40251e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"53ecccb3-e087-49da-8667-d20438985d9a","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b0e87449-cedc-4403-99b9-f0a312c926bd","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Whatsapp PJ ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: \"atendente\",\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockId,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\terror: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"899b0fcf-a95a-42db-ab36-2b708dd3f4c9","$typeOfContent":"","type":"Redirect","$title":"Redirect to {service} sending \"atendente\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"atendente"},"address":"WhatsApp PJ"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e30f5616-7fac-47fe-a7d6-f83d0cd0762a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-c592cc73-c82c-4bb6-93cb-227311f3bb18","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"5724999e-4ebb-443e-8b1d-4c15ef40251e","root":false,"$title":"[Redirect] To WhatsApp PJ (atendente)","$position":{"top":"0px","left":"1166px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"a5ddf643-13c0-4a81-a174-e1aa9dd86873":{"$contentActions":[{"action":{"$id":"66dcccdd-84cf-418f-921d-62b42de562cd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"351051cd-4798-413e-a702-ef0e2978bc81","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"351051cd-4798-413e-a702-ef0e2978bc81","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"7712099a-1707-4bb2-ae75-112db962bb0d","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"application/json","rawContent":"{{dynamicContent}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"a893a955-6a21-4015-bd79-42b681faa3ce","typeOfStateId":"state","$connId":"con_423","$id":"a8589e38-4f1d-411c-96c1-79f84e25bbd0","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["dynamicContent"],"source":"context","comparison":"notEquals","variable":"exceptionType"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"97385bad-2724-4c43-8eda-2f52b32381f2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e condições {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e condições {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"c0af04a5-2b02-4fd8-9642-603e586aa13f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"dynamicContent\"","$invalid":false,"settings":{"function":"run","source":"/**\n * @typedef {Object} MenuOption\n * @property {string} id - ID da opção do menu\n * @property {string} title - Título da opção do menu\n * @property {string} description - Descrição da opção do menu\n */\n\n/**\n * Adicione as opções que devem ser exibidas por padrão para todos os usuários. \n * O id deve ser igual a posição do menu que será exibido o botão. Ex: { id: 1 } para o primeiro item da lista.\n * @type {MenuOption[]}\n */\nconst menuOptions = [\n    {\n        \"id\": \"6\",\n        \"title\": \"Questionar cobrança\",\n        \"description\": \"Abrir um protocolo referente a cobranças\"\n    }\n]\n\n/**\n * @typedef {Object} MenuOption\n * @property {number} posicao - Posição que o botão deve ser inserido no menu\n * @property {string} title - Título do botão\n * @property {string} description - Descrição do botão\n */\n/**\n * @summary Essa função adiciona uma opção (botão) no menu de acordo com a posição informada e reordena todos os botões.\n * @param {MenuOption} option - Objeto contendo a posição, título e descrição do botão\n * @example adicionaOpcaoNoMenu({ posicao: 2, title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction adicionaOpcaoNoMenu({ posicao, title, description }) {\n    if (posicao > menuOptions.length) {\n        posicao = Number(menuOptions[menuOptions.length - 1].id) + 1\n    }\n    if (menuOptions.find(option => option.id == posicao)) {\n        quantidadeItens = menuOptions.length\n        for (let i = Number(posicao - 1); i < quantidadeItens; i++) {\n            menuOptions[i].id = (i + 2).toString()\n        }\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72) || ''\n        })\n    } else {\n        menuOptions.push({\n            id: posicao.toString(),\n            title: title.slice(0, 24),\n            description: description.slice(0, 72)\n        })\n    }\n    menuOptions.sort((a, b) => a.id - b.id)\n}\n\n/**\n * @typedef {Object} MenuOptionUpdate\n * @property {string} parametroDeBusca - Título ou descrição da opção que deseja atualizar\n * @property {string} title - Novo título do botão\n * @property {string} description - Nova descrição do botão\n */\n\n/**\n * @summary Essa função atualiza o título e descrição de uma opção (botão) do menu.\n * @param {MenuOptionUpdate} option - Objeto contendo o título ou descrição da opção que deseja atualizar, novo título e nova descrição do botão\n * @example atualizaOpcaoMenu({ parametroDeBusca: 'Conta Corrente', title: 'Conta Corrente', description: 'Extratos, Fazer pix, Antecipar saldo, Falar sobre conta, entre outros.' })\n */\nfunction atualizaOpcaoMenu({ parametroDeBusca, title, description }) {\n    // Parametro de busca é o title ou description da opção que deseja atualizar\n    const opcao = menuOptions.find(option => option.title === parametroDeBusca || option.description === parametroDeBusca)\n    if (!opcao) {\n        return\n    }\n    menuOptions.find(option => option.id === opcao.id).title = title.slice(0, 24)\n    menuOptions.find(option => option.id === opcao.id).description = description.slice(0, 72) || ''\n}\n/**\n * @typedef {Object} PermissionCheck\n * @property {string} tituloDoBotao - Título ou descrição da opção que deseja verificar\n * @property {Array.<string>} permissoes - Permissões do usuário (usar o array de permissões da conta selecionada)\n * @property {string} permissoesNecessarias - Permissão necessária para exibir a opção\n */\n\n/**\n * @summary Essa função verifica se o usuário possui a permissão necessária para exibir a opção no menu.\n * @param {PermissionCheck} permission - Objeto contendo o título ou descrição da opção que deseja verificar, permissões do usuário e permissão necessária para exibir a opção\n * @example verificaPermissao({ tituloDoBotao: 'Conta Corrente', permissoes: ['extratoDeContaCorrente'], permissoesNecessarias: 'extratoDeContaCorrente' })\n */\nfunction verificaPermissao({ tituloDoBotao, permissoes, permissoesNecessarias }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao);\n\n    if (!opcao) {\n        return;\n    }\n\n    const hasPermission = permissoesNecessarias.some(necessaria => permissoes.includes(necessaria));\n\n    if (hasPermission) {\n        return;\n    }\n\n    const index = menuOptions.indexOf(opcao);\n    if (index > -1) {\n        menuOptions.splice(index, 1);\n    }\n}\n\nfunction removeOpcaoDoMenu({ tituloDoBotao }) {\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions.splice(index, 1)\n}\n\nfunction removeDescricaoDoBotao({ tituloDoBotao, parteASerRemovida, listaPermissoes, permissaoNecessaria }) {\n    if (listaPermissoes.includes(permissaoNecessaria)) {\n        return\n    }\n    const opcao = menuOptions.find(option => option.title === tituloDoBotao || option.description === tituloDoBotao)\n    if (!opcao) {\n        return\n    }\n    const index = menuOptions.indexOf(opcao)\n    menuOptions[index].description = menuOptions[index].description.replace(parteASerRemovida, '')\n}\n\n/**\n * @typedef {Object} ContaSelecionada\n * @property {number} codigoCliente\n * @property {string} baseDocumento\n * @property {string} agencia\n * @property {string} agenciaCadastroBacen\n * @property {string} conta\n * @property {(boolean|string)} contaCorrenteSPD\n * @property {string} canal\n * @property {string} shortname\n * @property {string} usuario\n * @property {number} codigoSegmento\n * @property {string} nivel\n * @property {string} nomeEmpresa\n * @property {string} tipoPessoa\n * @property {string} doc\n * @property {string} nomeCompleto\n * @property {string} primeiroNome\n * @property {string} filaGerente\n * @property {Array.<string>} permissoes\n * @property {string} cpfAppKey\n * @property {(boolean|string)} ec\n * @property {string} segmentoGerente\n */\n\n/**\n * @param {ContaSelecionada} contaSelecionada - Objeto contendo as informações da conta selecionada\n * @description Dentro do try, defina todas as regras de exibição, utilizando as funções disponiveis: \"verificaPermissao\", \"atualizaOpcaoMenu\", \"adicionaOpcaoNoMenu\"\n */\nfunction run(contaSelecionada) {\n    try {\n        const { ec, permissoes } = JSON.parse(contaSelecionada)\n        if (ec) {\n            adicionaOpcaoNoMenu({ posicao: 1, title: 'Taxas de venda', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 2, title: 'Taxas de antecipação', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 3, title: 'Taxas Pix na Safrapay', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 4, title: 'Consultar máquina', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 5, title: 'Domicilio bancário', description: '' })\n\n            adicionaOpcaoNoMenu({ posicao: 7, title: 'Contratar antecipação', description: '' })\n            adicionaOpcaoNoMenu({ posicao: 8, title: 'Conciliação', description: '' })\n        }\n        verificaPermissao({ tituloDoBotao: 'Taxas de antecipação', permissoesNecessarias: ['taxaDeAntecipacao'], permissoes })\n        verificaPermissao({ tituloDoBotao: 'Contratar antecipação', permissoesNecessarias: ['solicitarAntecipAuto', 'habilitarAntecipAutomatica', 'habilitarAntecipEventual'], permissoes })\n        return {\n            \"recipient_type\": \"individual\",\n            \"type\": \"interactive\",\n            \"interactive\": {\n                \"type\": \"list\",\n                \"header\": {\n                    \"type\": \"text\",\n                    \"text\": \"\"\n                },\n                \"body\": {\n                    \"text\": `Separei alguns tópicos sobre taxas e condições. \n\nDe qual deles você quer mais informações?`\n                },\n                \"action\": {\n                    \"button\": \"Ver opções\",\n                    \"sections\": [\n                        {\n                            \"title\": \"\",\n                            \"rows\": menuOptions\n                        }\n                    ]\n                }\n            }\n        }\n    } catch (err) {\n        return {\n            error: err.message,\n            exceptionType: 'reiniciarFluxo',\n            dynamicContent: {\n                \"type\": \"text/plain\",\n                \"content\": `Estamos fazendo alguns ajustes no sistema e alguns recursos podem estar temporariamente indisponíveis. Em breve, estaremos de volta ao normal.`\n            }\n        }\n    }\n}","inputVariables":["contaSelecionada"],"outputVariable":"dynamicContent","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"f8f33c1d-6b2f-4964-acbc-5c85c1005522","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"dynamicContent erro\"","$invalid":false,"settings":{"extras":{},"category":"dynamicContent erro","action":"{{config.serviceName}} | {{state.name}} | {{dynamicContent@error}} | {{contact.identity}} | {{idSessao}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"0497fe76-a6d8-4063-ae55-f38ac8a74cfc","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"dynamicContent\"","$invalid":false,"settings":{"variable":"exceptionType","value":"dynamicContent"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"de339439-5404-44c2-a91a-563a7c1e20f3","$typeOfContent":"","type":"SetVariable","$title":"Set \"dynamicContent\" to \"dynamicContent@dynamicContent\"","$invalid":false,"settings":{"variable":"dynamicContent","value":"{{dynamicContent@dynamicContent}}"},"conditions":[{"values":[],"source":"context","comparison":"exists","variable":"dynamicContent@error"}]},{"$id":"248704f8-5428-4b77-9d4f-6e211213ce34","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"selecaoMenuAnterior\"","$invalid":false,"settings":{"function":"run","source":"function run(stateId, serviceName) {\n\ttry {\n\t\treturn {\n\t\t\tstateId,\n\t\t\tserviceName\n\t\t}\n\t} catch (er) {\n\t\treturn {\n\t\t\tstateId: 'welcome',\n\t\t\tserviceName: 'Bot Main'\n\t\t}\n\t}\n}","inputVariables":["state.id","config.serviceName"],"outputVariable":"selecaoMenuAnterior","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-7c61ed83-f362-4b5f-b6ed-7cda6030c6e7","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c4508cf8-a975-42fb-add7-d09dd107f359","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ea1abc92-d4f8-4a52-a621-4b3fd50260d0","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-5965b4d2-7735-4618-93bd-7ac77de44e03","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"a5ddf643-13c0-4a81-a174-e1aa9dd86873","$title":"[TC.1.0.0][MSG] Menu Taxas e condições","$position":{"top":"11.6667px","left":"2417.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"a893a955-6a21-4015-bd79-42b681faa3ce":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:8"},"$invalid":false}],"$conditionOutputs":[{"stateId":"708a01ab-973e-404f-8e0f-fe4a312b5100","typeOfStateId":"state","$connId":"con_428","$id":"66cc2330-ecd8-4fae-8804-6a5918304e5d","conditions":[{"source":"context","comparison":"notEquals","values":["inatividade"],"variable":"userInput"},{"values":["Input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ff58f2fb-9134-4b51-a9c6-0f8c18db95be","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function escapeRegExp(string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n  }\n\nfunction run(inputUsuario, dynamicContent) {\n  const posicoes = {\n      \"1\": \"primeir[oa]|u[mn]\",\n      \"2\": \"segund[ao]|do[ie]s\",\n      \"3\": \"terceir[ao]|tr[eê]s\",\n      \"4\": \"quart[ao]|[qc]uat(r)?o\",\n      \"5\": \"quint[ao]|[sc]inc[ou]\",\n      \"6\": \"sext[ao]|[sc]inc[uo]\",\n      \"7\": \"s[eé]tim[ao]|[sc]et[ei]\",\n      \"8\": \"oitav[ao]|oit[ou]\",\n      \"9\": \"non[ao]|nov[ei]\",\n      \"10\": \"d[eé][cs]im[ou]|d[ée][sz]\"\n  }\n  try {\n      if (!inputUsuario) return 'inatividade'\n      const regexDictionary = {}\n      const { rows } = JSON.parse(dynamicContent).interactive.action.sections[0]\n      rows.forEach((button, index) => {\n            const key = `^(${index + 1}|${posicoes[index + 1]}|${escapeRegExp(button.title.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase())})$`\n          regexDictionary[key] = button.title\n      })\n      for (let regex in regexDictionary) {\n          if (new RegExp(regex, 'i').test(inputUsuario.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\"))) {\n              return regexDictionary[regex]\n          }\n      }\n      return 'input inesperado'\n  } catch (err) {\n      return 'input inesperado'\n  }\n}","inputVariables":["input.content","dynamicContent"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"12a40833-d247-4e44-bcf0-2bdba8ac1207","$typeOfContent":"","type":"SetVariable","$title":"SET \"assunto\" TO \"{userInput}\"","$invalid":false,"settings":{"variable":"assunto","value":"{{userInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"notEquals","variable":"userInput"}]},{"$id":"fcf8f81f-9420-4f56-8d83-0e0d398f8165","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"lista\"","$invalid":false,"settings":{"variable":"exceptionType","value":"lista"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"}]},{"$id":"ccb97f39-b531-4101-a552-4924b142b8cd","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} validação\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} validação","action":"{{userInput}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]},{"$id":"ef360673-a420-41df-a8d3-1970582a23df","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} input inesperado\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} input inesperado","action":"{{input.content}}"},"conditions":[{"values":["input inesperado"],"source":"context","comparison":"equals","variable":"userInput"},{"comparison":"exists","source":"context","values":[],"variable":"input.content"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-de59ea4d-f9f6-452c-b364-6f2b2582c303","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-54959e37-4ce7-4ff2-b193-f6287b757394","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-48843b8c-c53a-4e0a-a128-d5a0fecb8e93","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-d7de095a-c34d-4613-a542-4b99b011a2db","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"a893a955-6a21-4015-bd79-42b681faa3ce","$title":"[TC.1.0.0][INPUT] Menu Taxas e condições","$position":{"top":"11.6667px","left":"2770.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"invalidOutputs":true},"708a01ab-973e-404f-8e0f-fe4a312b5100":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"fc91a80b-e435-4824-a9a0-aef920267d7e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"600692ef-a2f0-4208-b2ca-3f6ab0b3ee71","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: '0e2bd49d-1b56-477b-883f-badf39288863',\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `autenticacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent,\n\t\t\tuserInput: intent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"870ef835-04b3-42dd-aa18-d945e8343f26","type":"Redirect","$title":"Redirect to {state} sending {userInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@userInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"state","stateId":"onboarding"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e908e8fd-6cef-4fe8-a028-55ecf1dde0cb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-acc11c00-7abb-46fa-a955-e33e98eb1e82","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"708a01ab-973e-404f-8e0f-fe4a312b5100","root":false,"$title":"[Redirect] To \"Autenticacao\" AND Return TC.1.0.0","$position":{"top":"0px","left":"3083px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"0e2bd49d-1b56-477b-883f-badf39288863":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"bc19e92a-5dec-4c18-8668-f309c11acbe2","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{taxMenuDestinationId}}","typeOfStateId":"variable","$id":"fd0178bc-b7e5-4d2a-8cfe-4eb954a47cdc","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1b70ffe8-7dfc-49a6-90ee-dd50830dbed9","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"taxMenuDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput) {\n\tswitch (userInput) {\n\t\tcase 'Taxas de venda':\n\t\t\treturn 'c4fec3d1-c20d-43de-9160-8a93f67989eb';\n\t\tcase 'Taxas de antecipação':\n\t\t\treturn 'cac63fde-6671-4aa1-9a67-efc2f5336711';\n\t\tcase 'Consultar máquina':\n\t\t\treturn '24ee326c-2f65-4cf1-944e-2b178eaf2a82';\n\t\tcase 'Domicilio bancário':\n\t\t\treturn 'ad3f23f8-0c79-4faf-8b19-06ad242f99d2';\n\t\tcase 'Taxas Pix na Safrapay':\n\t\t\treturn '91dec6e6-2e08-462d-8d81-d38d2b223594';\n\t\tcase 'Contratar antecipação':\n\t\t\treturn 'f2c4d052-2f9b-4aa8-9925-48aa824fc35c';\n\t\tcase 'Questionar cobrança':\n\t\t\treturn '4a101355-7808-4bb7-a96d-7053a966074a';\n\t\tcase 'Conciliação':\n\t\t\treturn '5724999e-4ebb-443e-8b1d-4c15ef40251e';\n\t\tdefault:\n\t\t\treturn 'a5ddf643-13c0-4a81-a174-e1aa9dd86873';\n\t}\n}","inputVariables":["userInput"],"outputVariable":"taxMenuDestinationId","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"79bdff00-cb9b-438d-8530-a31a660423f2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"{state.name} validação\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} validação","action":"{{userInput}} | {{taxMenuDestinationId}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"userInput"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-56e88cf0-eb49-467d-a158-3e98e1b3c669","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-346c17fd-f920-44f3-8e93-ffebc2235813","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"0e2bd49d-1b56-477b-883f-badf39288863","$title":"[TC.1.0.0][SET] Menu Taxas e condições","$position":{"top":"15px","left":"3282px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"invalidOutputs":true},"f2c4d052-2f9b-4aa8-9925-48aa824fc35c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `atendimentohumano ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-32ef0f73-5eb9-4516-9947-be29cfaac5ae","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-06d90032-7b8c-4b77-b097-1fcfb9bdd794","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","root":false,"$title":"[Redirect] to Atendimento Humano","$position":{"top":"6.33333px","left":"1363.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b9a7f027-209a-4d73-ab4d-aa0086d480dc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'ed2a5fb2-da6f-4961-b14d-e302fa57b991',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-986dd2e3-72e5-4b99-b4f7-1d375bbf63b2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6328dd4c-ef7a-40df-8cb4-dd5884d16406","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"b9a7f027-209a-4d73-ab4d-aa0086d480dc","root":false,"$title":"[Redirect] to Finalizacao (F.4.0.0)","$position":{"top":"11.25px","left":"1556.25px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"368ed6d2-36d7-4631-a0b5-982523a88008":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d3f33e59-2d1a-4743-8950-eab3409746a4","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"25531690-f43f-4a84-a2c9-29c446f676c8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"368ed6d2-36d7-4631-a0b5-982523a88008","root":false,"$title":"[GO TO] Finalização (F.5.0.0)","$position":{"top":"987px","left":"4366px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"7399f98b-a0d4-4892-901c-bb662285e254":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f479326b-16fe-435b-85df-257d6fc38333","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"7399f98b-a0d4-4892-901c-bb662285e254","root":false,"$title":"[GO TO] AH.0.0.0 Atendimento Humano","$position":{"top":"2105px","left":"2282.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"963357f4-8de8-458d-afe0-50c1236f9d40":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"f479326b-16fe-435b-85df-257d6fc38333","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"963357f4-8de8-458d-afe0-50c1236f9d40","root":false,"$title":"[GO TO] AH.0.0.0 Atendimento Humano","$position":{"top":"2589px","left":"1679px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4668cb14-a953-4cd6-a7c6-23dc18b0b548":{"$contentActions":[{"action":{"$id":"21fe62a9-9c8d-413f-bbf2-bc8ead0fb4a7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f2902829-285e-4e5a-a144-70456b126c3f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f2902829-285e-4e5a-a144-70456b126c3f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9f009deb-d06c-4dec-b5bf-bc5285dc2227","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7d26e1aa-9dc6-4181-8602-ad6b1faeec8f","type":"text/plain","content":"Vou te direcionar para quem pode te ajudar com isso.","metadata":{}},"$cardContent":{"document":{"id":"7d26e1aa-9dc6-4181-8602-ad6b1faeec8f","type":"text/plain","content":"Vou te direcionar para quem pode te ajudar com isso."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ee5edbd4-f130-4d58-8f5b-cf20cf214bc7","type":"text/plain","textContent":"User input","content":"User Input"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f2c4d052-2f9b-4aa8-9925-48aa824fc35c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3a9b7117-752e-4716-96b8-3a36b13c29c5","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"4668cb14-a953-4cd6-a7c6-23dc18b0b548","root":false,"$title":"[GO TO] Atendimento Humano ","$position":{"top":"3214px","left":"123px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"4b3dce83-c8a0-4de5-af41-e32f491ea7e2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b645224-db06-46da-9245-7ba2ddcaf403","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"820d335f-0c95-466f-9009-35cac24c6ea4","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"4b3dce83-c8a0-4de5-af41-e32f491ea7e2","root":false,"$title":"[GO TO] Finalizacao","$position":{"top":"3247px","left":"1133px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"103227ab-c79b-4daa-8667-77e2b8c3c5ff":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"0f7abaa5-92eb-4d10-9805-03ce00f8c41f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"cac63fde-6671-4aa1-9a67-efc2f5336711","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[],"id":"103227ab-c79b-4daa-8667-77e2b8c3c5ff","root":false,"$title":"[GO TO] [TC.3.0.0] Taxas de antecipacao","$position":{"top":"3431px","left":"908px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c1345065-0a66-4d0e-886b-b7f53b6a74e4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"de7d8593-8bd0-4fb0-9c8b-bce0561fcf51","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"b039b1aa-719e-462d-aefc-de01bc0ddd7b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `Bot Main ${env || ''}`.trim(),\n\t\t\tstateDestination: '30e39880-1d2a-439a-a0ed-1e7210966286',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\t// stateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"76749ce2-c212-4b7b-9e4d-818f5a12c7f1","$typeOfContent":"","type":"TrackEvent","$title":"Track \"\"{state.name}\" registro\"","$invalid":false,"settings":{"extras":{},"category":"{{state.name}} registro","action":"Registro"},"conditions":[]}],"$leavingCustomActions":[{"$id":"b329fc66-8d30-44ed-8449-df875c5a9eb2","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-6c232491-a3dd-4264-b658-4cd985c50dcb","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9d1aea97-1831-4901-a72b-8b429e9d30cd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-e41fc16a-3417-44e4-b3b9-ebba16bfd7ce","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"c1345065-0a66-4d0e-886b-b7f53b6a74e4","root":false,"$title":"[Redirect] to Main (Menu inicial)","$position":{"top":"1583px","left":"2008px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"43c00179-3b1f-4151-8ce4-bcf39135d351":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9ba908c-18ee-43c9-8df0-e67e932e5074","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"45ec8433-22a9-4498-8005-c3c52f7ce6bc","typeOfStateId":"state","$connId":"con_433","$id":"c3cccbbb-a3c1-4124-945b-420030956119","conditions":[{"source":"context","comparison":"equals","values":["0"],"variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"e66b1d69-3e83-4e4d-9f57-5c2d84cd1ce5","typeOfStateId":"state","$connId":"con_438","$id":"53da15ed-8049-4435-a181-80e69abf758e","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["A"],"source":"context","comparison":"equals","variable":"tipoMaquina"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"0e6bc8ca-977f-40d6-9ccf-23d15a44268b","typeOfStateId":"state","$connId":"con_443","$id":"2a189d77-5c94-47b5-bfbf-febebd903c24","conditions":[{"source":"context","comparison":"equals","values":["1"],"variable":"sizeMaquinas"},{"values":["C"],"source":"context","comparison":"equals","variable":"tipoMaquina"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"46f819c5-9a97-4c4c-9a09-e363d6736ae1","typeOfStateId":"state","$connId":"con_448","$id":"48a23afc-2c9c-4282-8bc9-376125d176ed","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["11"],"variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"bb74c3c9-73bc-4030-ae90-62acb134db5e","typeOfStateId":"state","$connId":"con_453","$id":"6a138384-8997-4175-9063-cb4f19baae61","conditions":[{"source":"context","comparison":"equals","values":["A"],"variable":"tipoMaquina"},{"values":["10"],"source":"context","comparison":"lessThanOrEquals","variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"bb74c3c9-73bc-4030-ae90-62acb134db5e","typeOfStateId":"state","$connId":"con_458","$id":"aec68847-2054-483c-8ae2-b5a28152d65e","conditions":[{"source":"context","comparison":"equals","values":["C"],"variable":"tipoMaquina"},{"values":["10"],"source":"context","variable":"sizeMaquinas","comparison":"lessThan"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"83910691-760e-4cc7-b210-e3aa8c707efa","typeOfStateId":"state","$connId":"con_463","$id":"1a8bd161-d3e3-4bcf-a358-1419b759434e","conditions":[{"source":"context","comparison":"lessThanOrEquals","values":["10"],"variable":"sizeMaquinas"},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false},{"stateId":"46f819c5-9a97-4c4c-9a09-e363d6736ae1","typeOfStateId":"state","$connId":"con_468","$id":"5b1b40ec-7586-4185-bd08-b6ebc8a72f32","conditions":[{"source":"input","comparison":"exists","values":[]},{"values":["ok"],"source":"context","comparison":"equals","variable":"apiStatus"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"eeb8160f-35db-40c7-9e1c-6f35beaea83b","$typeOfContent":"","type":"TrackEvent","$title":"Chamada de API","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"Chamada de API","action":"Consulta máquinas disponíveis para EC."},"conditions":[]},{"$id":"a13ebe5a-7f0a-4cda-9ee7-5cec03846cd2","$typeOfContent":"","type":"ProcessHttp","$title":"HTTP GET \"consultMaquina\" (Terminais)","$invalid":false,"settings":{"headers":{"Authorization":"Bearer {{bodyToken@access_token}}","User-Agent":"Fiddler","Content-Type":"application/json","Safra-Correlation-ID":"{{random.guid}}"},"method":"GET","uri":"{{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/terminais?codigoEstabelecimentoComercial={{selectedEc@codigoEc}}","responseStatusVariable":"consultMaquinaStatus","responseBodyVariable":"consultMaquina"},"conditions":[]},{"$id":"67249656-098d-40c5-bb65-ca13fcdc48a2","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"tipoMaquina\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(consultMaquina) {\n  try {\n    let consultMaquina = JSON.parse(consultMaquina);\n\n    function retronarModalidadeA(value) {\n      if (value.modalidade == 'A')\n        return value;\n    }\n    function retronarModalidadeC(value) {\n      if (value.modalidade == 'C')\n        return value;\n    }\n    function retronarModalidadeV(value) {\n      if (value.modalidade == 'V')\n        return value;\n    }\n\n    let var1 = consultMaquina.data.filter(retronarModalidadeA);\n    let var2 = consultMaquina.data.filter(retronarModalidadeC);\n    let var3 = consultMaquina.data.filter(retronarModalidadeV);\n    let retorno = \"\"\n    if (var1.length > 0 && var3.length > 0 || var2.length > 0 && var3.length > 0) {\n      retorno = \"A e C\"\n    } else if (var1.length > 0 || var2.length > 0) {\n      retorno = \"A\"\n    } else {\n      retorno = \"C\"\n    }\n    return retorno;\n  } catch (e) {\n    return e.message;\n  }\n\n}","inputVariables":["consultMaquina"],"outputVariable":"tipoMaquina","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]},{"$id":"54d01726-4eac-4f8a-ae09-305086f7178b","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"sizeMaquinas\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina) {\n\ttry {\n\t\tlet consultMaquina = JSON.parse(consultMaquina);\n\t\tlet sizeMaquina = consultMaquina.data.length\n\t\treturn sizeMaquina;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["consultMaquina"],"outputVariable":"sizeMaquinas","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]},{"$id":"6b251080-10aa-4802-b35c-6155039fd27f","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"modalidadeMaquina\"","$invalid":false,"settings":{"function":"run","source":"function run(tipoMaquina) {\n\ttry {\n\t\tif (tipoMaquina == \"A\") {\n\t\t\treturn \"Alugada\"\n\t\t}\n\t\telse {\n\t\t\treturn \"Comprada\"\n\t\t}\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}","inputVariables":["tipoMaquina"],"outputVariable":"modalidadeMaquina","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"16d4e121-6af2-46fe-afaf-4f31b54688fa","$typeOfContent":"","type":"SetVariable","$title":"Set \"pesquisa\" to \"ces\"","$invalid":false,"settings":{"variable":"pesquisa","value":"ces"},"conditions":[]},{"$id":"af2ef353-47c2-4a32-8408-672c7f3282f2","$typeOfContent":"","type":"TrackEvent","$title":"Track \"SPD Taxas e Condicoes {state.name} exibição\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"SPD Taxas e Condicoes {{state.name}} exibição","action":"Exibição"},"conditions":[]},{"$id":"08d7d24b-5e16-45e7-a4ee-70be9883bb6c","$typeOfContent":"","type":"TrackEvent","$title":"Track \"assuntos\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"assuntos","action":"{{assunto}}"},"conditions":[{"comparison":"exists","source":"context","values":[],"variable":"assunto"}]},{"$id":"e6862cf0-cf57-41e7-b2b1-07e5e6e90370","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"apiStatus\"","$invalid":false,"settings":{"function":"run","source":"function run(...apiStatus) {\n\ttry {\n\t\tif (apiStatus.some((status) => status == 401)) {\n\t\t\treturn 'unauthorized'\n\t\t}\n\t\tif (apiStatus.some((status) => status != 200)) {\n\t\t\treturn 'erro api'\n\t\t}\n\t\treturn 'ok'\n\t} catch (err) {\n\t\treturn \"erro api\"\n\t}\n}","inputVariables":["consultMaquinaStatus"],"outputVariable":"apiStatus","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"00575c53-9dc5-4af6-9d28-bd664c98d4d7","$typeOfContent":"","type":"TrackEvent","$title":"Tracking \"{state.name} api resumo\"","$invalid":false,"settings":{"extras":{"IdSessao":" {{idSessao}}","Identity":"{{contact.identity}}","Doc":"{{contaSelecionada@doc}}","EC":"{{selectedEc@codigoEc}}"},"category":"{{state.name}} api resumo","action":"{{idSessao}} | {{contact.identity}} | {{calendar.datetime}} | {{config.urlCHT}}/safrapay/dados-referencias/gerenciamento-produtos/catalogo-produtos/assistente-virtual/v1/terminais?codigoEstabelecimentoComercial={{selectedEc@codigoEc}} | GET| {{consultMaquinaStatus}} | {{consultMaquina}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"73b7890c-1d3b-4f50-a276-4eb5eb14699b","$typeOfContent":"","type":"SetVariable","$title":"Set \"exceptionType\" to \"erroApi\"","$invalid":false,"settings":{"variable":"exceptionType","value":"erroApi"},"conditions":[]},{"$id":"541ea020-0b25-478a-8e9d-6a0c97812fa6","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"nomeTipoEquipamento\"","$invalid":false,"settings":{"variable":"nomeTipoEquipamento"},"conditions":[]},{"$id":"acfd5218-7228-4815-9bde-46c364008291","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"numeroserie\"","$invalid":false,"settings":{"variable":"numeroserie"},"conditions":[]},{"$id":"9bc602fe-e7b0-4d49-8d78-ce76d9ff7e4f","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"valorTabela\"","$invalid":false,"settings":{"variable":"valorTabela"},"conditions":[]},{"$id":"6657d45e-9e92-40a2-b997-6cdb13bfde25","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"valorPago\"","$invalid":false,"settings":{"variable":"valorPago"},"conditions":[]},{"$id":"b7ca2944-7897-4bd5-95f9-9c991e1cae8c","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"faturamentoMensal\"","$invalid":false,"settings":{"variable":"faturamentoMensal"},"conditions":[]},{"$id":"9097bcd6-1bfb-4820-82c9-c6429263d9ed","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"faturamentoAnual\"","$invalid":false,"settings":{"variable":"faturamentoAnual"},"conditions":[]},{"$id":"e1befccd-127f-4747-bf79-3f4187753222","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"valorTabela\"","$invalid":false,"settings":{"variable":"valorTabela","value":""},"conditions":[]},{"$id":"44a9ebad-5310-449d-a68e-434c2188b576","$typeOfContent":"","type":"SetVariable","$title":"Set CLEAR \"faturamentoAnual\"","$invalid":false,"settings":{"variable":"faturamentoAnual","value":"0"},"conditions":[]},{"$id":"87389c53-a6da-472f-861b-d96b28a27607","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroSerie\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tlet numeroSerie = consultMaquina.data[0].numeroSerie\n\t\treturn numeroSerie;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["consultMaquina"],"outputVariable":"numeroSerie","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]},{"$id":"122234b9-5481-42a8-aa78-4808635e2a07","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"numeroLogico\"","$invalid":false,"settings":{"function":"run","source":"function run(consultMaquina) {\n\ttry {\n\t\tconsultMaquina = JSON.parse(consultMaquina);\n\t\tlet numeroLogico = consultMaquina.data[0].numeroLogico\n\t\treturn numeroLogico;\n\t}\n\tcatch (e) {\n\t\treturn e.message;\n\t}\n}\n\n","inputVariables":["consultMaquina"],"outputVariable":"numeroLogico","LocalTimeZoneEnabled":false},"conditions":[{"values":["200"],"source":"context","comparison":"equals","variable":"consultMaquinaStatus"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-daecb72a-4f08-47b9-b438-893d9ed2cbf0","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-48300d3e-15f8-4292-ba15-1dbd68ad2700","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-594556a3-ca71-4b02-ad99-8aae4488e22d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e893516d-c91c-4386-9d98-4d0a949d005c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"43c00179-3b1f-4151-8ce4-bcf39135d351","root":false,"$title":"[TC.4.0.0][HTTP] API Consultar Máquinas [Duplicate]","$position":{"top":"460px","left":"1156px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"25531690-f43f-4a84-a2c9-29c446f676c8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3a432035-25be-47a0-9375-c12071e5d655","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"c01ef50f-0400-45b9-b882-805edc3533c0","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\t\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `finalizacao ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'e50a98d9-c63a-4809-b820-647b7737687e',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin: previousStateName.replace(/.*\\[(.*?)\\].*/, '$1'),\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terror: err.message,\n\t\t\tlastInput\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"cc1d6a0c-4326-4288-96bf-aea4570ddbb4","$typeOfContent":"","type":"Redirect","$title":"Redirecionar a um serviço","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-986dd2e3-72e5-4b99-b4f7-1d375bbf63b2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-6328dd4c-ef7a-40df-8cb4-dd5884d16406","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"25531690-f43f-4a84-a2c9-29c446f676c8","root":false,"$title":"[Redirect] to Finalizacao (F.5.0.0)","$position":{"top":"0px","left":"1742px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"configuration":{"builder:minimumIntentScore":"0.65","builder:stateTrack":"true","builder:#localTimeZone":"E. South America Standard Time","builder:useTunnelOwnerContext":"true","builder:stateExpiration":"0.00:15:00","clientId":"BLIP","grantType":"client_credentials","urlToken":"urlToken/https://sts-api.safra.com.br","urlCHT":"https://api.safra.com.br","clientSecret":"ee1f5004-2400-4ab1-9af7-d9168d517204","domicilio":"true","serviceName":"Bot Taxas e Condições","TraceTargetType":"Http","TraceMode":"All","TraceTarget":"https://take-api-beholder.cs.blip.ai/api/traces/prodspdtaxasecondicoes","TraceCacheMode":0},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"04e03293-15b1-40c5-8c2d-b4b660510d4d","$typeOfContent":"","type":"ExecuteScript","$title":"PROCESS \"currentDate\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    return getFormatDate();\n}\n\nfunction getFormatDate() {\n    const dataAtual = new Date();\n\n    const getDay = String(dataAtual.getDate()).padStart(2, '0');\n    const getMonth = String(dataAtual.getMonth() + 1).padStart(2, '0');\n    const getYear = dataAtual.getFullYear();\n    const getHour = String(dataAtual.getHours()).padStart(2, '0');\n    const getMinutes = String(dataAtual.getMinutes()).padStart(2, '0');\n    const getSeconds = String(dataAtual.getSeconds()).padStart(2, '0');\n\n    return `${getDay}/${getMonth}/${getYear}`;\n}","inputVariables":[],"outputVariable":"currentDate","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"96e30c46-c895-45fa-9967-3f3ebfc638a4","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    if (!voltarState) {\n        const state = {}\n        state[botOrigin] = [blockId]\n        return state\n    }\n    const state = JSON.parse(voltarState)\n    try {\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}