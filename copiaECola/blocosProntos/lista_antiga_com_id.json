{"isCopyFromBlips":true,"originBot":"pffacilitaaicarteirizacao","blocksCode":"[{\"$contentActions\":[{\"action\":{\"$id\":\"73a18264-e9dc-4e0e-a8d7-e3894342f7e6\",\"$typeOfContent\":\"chat-state\",\"type\":\"SendMessage\",\"settings\":{\"id\":\"5f52a1ef-d722-480f-84f9-65bd969cb4bd\",\"type\":\"application/vnd.lime.chatstate+json\",\"content\":{\"state\":\"composing\",\"interval\":1000}},\"$cardContent\":{\"document\":{\"id\":\"5f52a1ef-d722-480f-84f9-65bd969cb4bd\",\"type\":\"application/vnd.lime.chatstate+json\",\"content\":{\"state\":\"composing\",\"interval\":1000}},\"editable\":true,\"deletable\":true,\"position\":\"left\"}},\"$invalid\":false,\"$$hashKey\":\"object:3869\"},{\"action\":{\"$id\":\"fbad4e2a-5df6-4e0f-82b5-98ad5732fc08\",\"$typeOfContent\":\"raw-content\",\"type\":\"SendRawMessage\",\"settings\":{\"metadata\":{},\"type\":\"application/json\",\"rawContent\":\"{{dynamicContent}}\"}},\"$invalid\":false,\"$$hashKey\":\"object:3870\"},{\"input\":{\"bypass\":false,\"$cardContent\":{\"document\":{\"id\":\"8a8b266a-0a4a-4b6b-a3a5-29e6338fc1eb\",\"type\":\"text/plain\",\"textContent\":\"User input\",\"content\":\"User Input\"},\"editable\":false,\"deletable\":true,\"position\":\"right\",\"editing\":false},\"$invalid\":false},\"$invalid\":false,\"$$hashKey\":\"object:3871\"}],\"$conditionOutputs\":[],\"$enteringCustomActions\":[{\"$id\":\"9e559f72-fa22-4686-b48c-e83e198676fc\",\"$typeOfContent\":\"\",\"type\":\"ExecuteScript\",\"$title\":\"Process \\\"dynamicContent\\\"\",\"$invalid\":false,\"settings\":{\"function\":\"run\",\"source\":\"function formatarData(dataStr) {\\n\\tconst [ano, mes, dia] = dataStr.split(\\\"-\\\");\\n\\treturn `${dia}/${mes}/${ano}`;\\n}\\nfunction formatarNomeTransferencia(dataStr) {\\n\\tif (dataStr == \\\"DOC\\\") {\\n\\t\\treturn \\\"DOC/TED\\\"\\n\\t}\\n\\treturn \\\"Tranferência\\\"\\n}\\nfunction formatarValor(number) {\\n\\treturn number\\n\\t\\t.toFixed(2) // Garantir que sempre tenha 2 casas decimais\\n\\t\\t.replace('.', ',') // Substituir ponto por vírgula\\n\\t\\t.replace(/(\\\\d)(?=(\\\\d{3})+(?=\\\\D))/g, '$1.'); // Adicionar separador de milhar\\n}\\n\\nconst run = (dataArray) => {\\n\\ttry {\\n\\t\\tlet { header, body, action } = menu(dataArray);\\n\\t\\treturn buildWhatsApp(header, body, action);\\n\\t}\\n\\tcatch (e) {\\n\\t\\treturn e.message;\\n\\t}\\n}\\n\\nconst buildWhatsApp = (header, body, action) => {\\n\\treturn {\\n\\t\\t'type': 'application/json',\\n\\t\\t'content': {\\n\\t\\t\\t\\\"recipient_type\\\": \\\"individual\\\",\\n\\t\\t\\t\\\"type\\\": \\\"interactive\\\",\\n\\t\\t\\t\\\"interactive\\\": {\\n\\t\\t\\t\\t\\\"type\\\": \\\"list\\\",\\n\\t\\t\\t\\t\\\"header\\\": header,\\n\\t\\t\\t\\t\\\"body\\\": body,\\n\\t\\t\\t\\t\\\"action\\\": action\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n}\\n\\nconst menu = (dataArray) => {\\n\\tdataArray = JSON.parse(dataArray).data;\\n\\tlet options = [];\\n\\tlet description = []\\n\\tlet objOpcoes = [];\\n\\n\\tdataArray.slice(0, 9).forEach((data, index) => {//Apenas os 9 Primeiros.\\n\\t\\tobjOpcoes.push({\\n\\t\\t\\t\\\"id\\\": `${data.operacao.numero}`,\\n\\t\\t\\t\\\"title\\\": `${formatarNomeTransferencia(data.operacao.tipo)}`,\\n\\t\\t\\t\\\"description\\\": `${formatarData(data.data)} - ${formatarValor(data.valor)}`\\n\\t\\t})\\n\\t});\\n\\n\\tlet textMenu = `De qual comprovante você precisa?\\n\\nÉ só tocar no botão abaixo que te mostro.`\\n\\treturn {\\n\\t\\t\\\"body\\\": {\\n\\t\\t\\t\\\"text\\\": textMenu\\n\\t\\t},\\n\\t\\t\\\"action\\\": {\\n\\t\\t\\t\\\"button\\\": \\\"Ver comprovante\\\",\\n\\t\\t\\t\\\"sections\\\": [\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\t\\\"rows\\\": objOpcoes\\n\\t\\t\\t\\t}\\n\\t\\t\\t]\\n\\t\\t}\\n\\t}\\n};\",\"inputVariables\":[\"listaDeComprovantes\"],\"outputVariable\":\"dynamicContent\",\"LocalTimeZoneEnabled\":false},\"conditions\":[]}],\"$leavingCustomActions\":[{\"$id\":\"d7b61f13-22b1-4dce-b601-01b5392b93a8\",\"$typeOfContent\":\"\",\"type\":\"ExecuteScript\",\"$title\":\"userInput\",\"$invalid\":false,\"settings\":{\"function\":\"run\",\"source\":\"const run = (listaDeComprovantes, input) => {\\n\\tconst jsonData = JSON.parse(input);\\n\\tconst numero = jsonData.metadata['#wa.interactive.list.id']; // Extrair o número a ser buscado\\n\\tlistaDeComprovantes = JSON.parse(listaDeComprovantes);\\n\\n\\t// Busca no array data usando o número de operação\\n\\tconst comprovanteEncontrado = listaDeComprovantes.data.find(item => item.operacao.numero === numero);\\n\\n\\t// Retorna o comprovante ou uma mensagem caso não seja encontrado\\n\\treturn comprovanteEncontrado || 'input inesperado';\\n}\",\"inputVariables\":[\"listaDeComprovantes\",\"input.message\"],\"outputVariable\":\"userInput\",\"LocalTimeZoneEnabled\":false},\"conditions\":[]}],\"$inputSuggestions\":[],\"$defaultOutput\":{\"stateId\":\"fallback\",\"$invalid\":false},\"isAiGenerated\":false,\"$tags\":[{\"id\":\"blip-tag-4c8a793a-5f64-466c-a6ec-e7e51cb67d87\",\"label\":\"ExecuteScript\",\"background\":\"#FF961E\",\"canChangeBackground\":false},{\"id\":\"blip-tag-0a8031d9-8820-4f44-bb14-25d2c30621a8\",\"label\":\"SendMessage\",\"background\":\"#EE82EE\",\"canChangeBackground\":false},{\"id\":\"blip-tag-df31513e-4e7b-4543-9ad3-a6c292cff5b1\",\"label\":\"UserInput\",\"background\":\"#000000\",\"canChangeBackground\":false}],\"id\":\"ac2c1231-bdb1-48ac-a61e-56fa5ff2ea94\",\"root\":false,\"$title\":\"Mais de um comprovante\",\"$position\":{\"top\":\"1594.57px\",\"left\":\"10352.1px\"},\"$invalidContentActions\":false,\"$invalidOutputs\":false,\"$invalidCustomActions\":false,\"$invalid\":false}]"}