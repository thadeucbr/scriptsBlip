{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d2712b4e-c844-4435-ba60-8364a32b3206","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3624"}],"$conditionOutputs":[{"stateId":"{{blockDestinationId}}","typeOfStateId":"variable","$id":"85d915aa-f1ca-4e54-9c06-04e60015756d","conditions":[{"source":"context","comparison":"notEquals","values":["false"],"$$hashKey":"object:3656","variable":"blockDestinationId"}],"$invalid":false,"$$hashKey":"object:3628"},{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"],"$$hashKey":"object:3642"}],"$id":"b5bef41d-16bb-4ea1-b8dc-ec17b6adc914","$connId":"con_3","$invalid":false,"$$hashKey":"object:3627"}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"78bdc058-ee64-454a-a1bc-caeb50bba482","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"blockDestinationId\"","$invalid":false,"settings":{"function":"run","source":"function run(state, serviceName) {\n\ttry {\n\t\tconst { botDestination, stateDestination } = JSON.parse(state)\n\n\t\tif (stateDestination.match(/^[0-9a-fA-F]{8}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{4}\\b-[0-9a-fA-F]{12}$/) && botDestination === serviceName) {\n\t\t\treturn stateDestination\n\t\t}\n\t\treturn false\n\t} catch (err) {\n\t\treturn false\n\t}\n}","inputVariables":["state","config.serviceName"],"outputVariable":"blockDestinationId","LocalTimeZoneEnabled":false},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-0928efbc-1b65-4ebf-b109-7dd11175e01e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-227a983c-4e6b-4ffc-aa34-94cb96cc791c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"120px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b687933a-994c-4382-8051-601710a0e8ea","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"928e1999-3310-4c4f-a25a-c051922b9862","typeOfStateId":"state","$connId":"con_8","$id":"d40c89b5-2225-49b2-b2f8-02689607aa97","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"74c0977e-fc70-432d-8f10-ae862389b161","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"userInput\" if input.content not exist","$invalid":false,"settings":{"function":"run","source":"function run(inputUsuario) {\n\tif (!inputUsuario) {\n\t\treturn 'inatividade'\n\t}\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[{"values":[],"source":"context","comparison":"notExists","variable":"input.content"}]},{"$id":"bda24a54-7cdc-41e9-a4da-bab2abdc8f8d","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"state\"","$invalid":false,"settings":{"function":"run","source":"function run(previousBlockid, previousStateName, lastInput, intent, serviceName, env) {\n\ttry {\n\t\tlet match = previousStateName.match(/\\[(.*?)\\]/);\n\t\tlet stateNameOrigin = match ? match[1] : previousStateName;\n\t\t\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tstateNameOrigin,\n\t\t\tbotDestination: `cascata ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\tlastInput: lastInput || intent,\n\t\t\tintent\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\tbotOrigin: serviceName,\n\t\t\tstateOrigin: previousBlockid,\n\t\t\tbotDestination: `Bot Main ${env || \"\"}`.trim(),\n\t\t\tstateDestination: 'welcome',\n\t\t\terr: err.message\n\t\t}\n\t}\n}","inputVariables":["state.previous.id","state.previous.name","input.content","userInput","config.serviceName","config.env"],"outputVariable":"state","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ea95a88a-5abd-4ed8-b4d2-3cb1a4ae8863","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"Exceções","$position":{"top":"120px","left":"877px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"dabd6618-5ba3-4b38-bb1b-19d8ae6f82cb","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false,"$$hashKey":"object:3397"},{"action":{"$id":"2d3bf2bd-54c6-4733-b4af-9cdac4714f51","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! {{contact.name}}!\nSeja bem-vindo(a)!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Olá! {{contact.name}}!\nSeja bem-vindo(a)!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false,"$$hashKey":"object:3398"},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1cf505e3-7cc1-4305-a44f-46d250ed27d5","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false,"$$hashKey":"object:3399"}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ae0c94bd-cd77-4f69-bb92-46154c1a9c19","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-31426500-d442-4712-a70c-f2b3a6996526","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"welcome","$title":"Boas vindas","$position":{"top":"278px","left":"643px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"928e1999-3310-4c4f-a25a-c051922b9862":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"5c1c7b30-f3c5-44d7-99a1-c0e259cae078","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"c8764fbc-31a8-4587-a403-f626f06e3151","type":"Redirect","$title":"Redirect to {service} sending {lastInput}","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{state@lastInput}}"},"address":"{{state@botDestination}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[{"id":"blip-tag-20e0aaf9-eb3d-4a57-9168-ac7580e06d9f","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"928e1999-3310-4c4f-a25a-c051922b9862","root":false,"$title":"[Redirect] To cascata","$position":{"top":"251px","left":"877px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"151450df-a066-47b5-a025-b141b63f5e59":{"$contentActions":[{"action":{"$id":"b3dc6fe0-5862-421a-8597-ca68ba1caf3e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a10fb9f6-38d4-42e2-8ae5-6c5e51c25640","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a10fb9f6-38d4-42e2-8ae5-6c5e51c25640","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"33e7fe3d-1d62-4fa8-bd31-bc308fb7548c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"302c1b7e-40ce-4d38-97ee-9b74259d6dad","type":"text/plain","content":"<b> Variaveis de configuração</b>\n\n1. <b>env</b> (criar apenas para o bot de <b>Dev</b> com valor <b>Dev</b>)\n\n2. serviceName (nome do serviço cadastrado no roteador para esse bot)\n\n<b>Para bots com chamada de api</b>\n\n3. <b>urlCHT</b>: https://api-hml.safra.com.br","metadata":{}},"$cardContent":{"document":{"id":"302c1b7e-40ce-4d38-97ee-9b74259d6dad","type":"text/plain","content":"<b> Variaveis de configuração</b>\n\n1. <b>env</b> (criar apenas para o bot de <b>Dev</b> com valor <b>Dev</b>)\n\n2. serviceName (nome do serviço cadastrado no roteador para esse bot)\n\n<b>Para bots com chamada de api</b>\n\n3. <b>urlCHT</b>: https://api-hml.safra.com.br"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff677ca8-6f21-4a8e-916e-915b33fd8716","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"ff14a9b1-5222-4d07-a89f-419bb44321f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ff14a9b1-5222-4d07-a89f-419bb44321f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c75ab037-cff6-45ae-bd79-4b0888eeb252","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8a01262b-98d3-4aab-b473-d5a1de0f3917","type":"text/plain","content":"<b>Conferir</b>\n1. Bot cadastrado no roteador?\n2. Contexto ativo?\n3. Trackings globais ativas?\n4. Process \"voltarState\" está nas ações globais?","metadata":{}},"$cardContent":{"document":{"id":"8a01262b-98d3-4aab-b473-d5a1de0f3917","type":"text/plain","content":"<b>Conferir</b>\n1. Bot cadastrado no roteador?\n2. Contexto ativo?\n3. Trackings globais ativas?\n4. Process \"voltarState\" está nas ações globais?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"b636ee01-9127-4380-b396-05f8bb431534","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-abde4334-c2c4-41e9-808e-d6167071ed1f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"151450df-a066-47b5-a025-b141b63f5e59","root":false,"$title":"CHECKLIST NOVO BOT","$position":{"top":"449px","left":"652px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"6847a189-7396-4144-b399-d99fac067b79","$typeOfContent":"","type":"ExecuteScript","$title":"Process \"voltarState\"","$invalid":false,"settings":{"function":"run","source":"function ignoreBlock(stateName) {\n    try {\n        const match = stateName.match(/\\[(.*?)\\]/);\n        const stateNameOrigin = match ? match[1] : stateName;\n        const regex = /Redirect|Redirecionar/i;\n        const ignore = !regex.test(stateNameOrigin);\n        return ignore;\n    } catch (err) {\n        return false\n    }\n}\n\n\nfunction run(voltarState, blockId, botOrigin, lastVoltarState, previousStateName) {\n    const state = JSON.parse(voltarState)\n    try {\n        if (!voltarState) {\n            const state = {}\n            state[botOrigin] = [blockId]\n            return state\n        }\n        const isIgnoredBlock = ignoreBlock(previousStateName)\n        if (state[botOrigin][state[botOrigin].length - 1] !== blockId && blockId !== 'onboarding' && !isIgnoredBlock && blockId !== lastVoltarState) {\n            state[botOrigin].push(blockId)\n        }\n        return state\n    } catch (err) {\n        state[botOrigin] = [blockId]\n        return state\n    }\n}","inputVariables":["voltarState","state.previous.id","config.serviceName","lastVoltarState","state.previous.name"],"outputVariable":"voltarState"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}